<?xml version="1.0" encoding="ISO-8859-1" ?>
<!-- Created from PDF via Acrobat SaveAsXML -->
<!-- Mapping Table version: 28-February-2003 -->
<TaggedPDF-doc>
<?xpacket begin='&#65279;' id='W5M0MpCehiHzreSzNTczkc9d'?>
<?xpacket begin="&#65279;" id="W5M0MpCehiHzreSzNTczkc9d"?>
<x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="Adobe XMP Core 5.2-c001 63.139439, 2010/09/27-13:37:26        ">
   <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
      <rdf:Description rdf:about=""
            xmlns:dc="http://purl.org/dc/elements/1.1/">
         <dc:format>xml</dc:format>
         <dc:creator>
            <rdf:Seq>
               <rdf:li>cpiercey</rdf:li>
            </rdf:Seq>
         </dc:creator>
      </rdf:Description>
      <rdf:Description rdf:about=""
            xmlns:xmp="http://ns.adobe.com/xap/1.0/">
         <xmp:CreateDate>2018-01-08T22:05:15-05:00</xmp:CreateDate>
         <xmp:CreatorTool>Microsoft® Office Word 2007</xmp:CreatorTool>
         <xmp:ModifyDate>2018-01-08T22:05:15-05:00</xmp:ModifyDate>
      </rdf:Description>
      <rdf:Description rdf:about=""
            xmlns:pdf="http://ns.adobe.com/pdf/1.3/">
         <pdf:Producer>Microsoft® Office Word 2007</pdf:Producer>
      </rdf:Description>
   </rdf:RDF>
</x:xmpmeta>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                           
<?xpacket end="w"?>
<?xpacket end='r'?>

<Sect>
<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_0.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 1: Input/Output Logical Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.1 </P>
</TD>

<TD>
<P>First public release </P>
</TD>

<TD>
<P>03/08/2001 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.2 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev. 1.1 errata rev. 1.1.1, errata 3 </P>
</TD>

<TD>
<P>06/26/2002 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev 1.2 errata 1 as applicable, the following errata showings: </P>

<P>03-05-00006.001, 03-12-00001.001, 04-02-00001.002 </P>

<P>and the following new features showings: </P>

<P>04-05-00005.001 </P>

<P>Converted to ISO-friendly templates, re-formatted </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: errata showings 06-11-00000.001, 06-11-00001.004 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Technical changes: errata showing 07-06-00000.010 </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Technical changes: errata showings 09-09-00001.002, 10-08-00000.003, </P>

<P>10-08-00001.005, Consolidated Comments on 11-01-00000.000 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction........................................................................................................... 11 </P>

<P>1.2 Overview............................................................................................................... 11 </P>

<P>1.3 Features of the Input/Output Specification ........................................................... 12 </P>

<P>1.3.1 Functional Features........................................................................................... 12 </P>

<P>1.3.2 Physical Features .............................................................................................. 12 </P>

<P>1.3.3 Performance Features ....................................................................................... 12 </P>

<P>1.4 Contents ................................................................................................................ 13 </P>

<P>1.5 Terminology.......................................................................................................... 13 </P>

<P>1.6 Conventions .......................................................................................................... 13 </P>

<P> </P>

<P> </P>

<P>Chapter 2 System Models </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 15 </P>

<P>2.2 Processing Element Models .................................................................................. 15 </P>

<P>2.2.1 Processor-Memory Processing Element Model................................................ 15 </P>

<P>2.2.2 Integrated Processor-Memory Processing Element Model .............................. 16 </P>

<P>2.2.3 Memory-Only Processing Element Model ....................................................... 16 </P>

<P>2.2.4 Processor-Only Processing Element ................................................................. 17 </P>

<P>2.2.5 I/O Processing Element .................................................................................... 17 </P>

<P>2.2.6 Switch Processing Element............................................................................... 17 </P>

<P>2.3 System Issues ........................................................................................................ 18 </P>

<P>2.3.1 Operation Ordering ........................................................................................... 18 </P>

<P>2.3.2 Transaction Delivery......................................................................................... 20 </P>

<P>2.3.2.1 Unordered Delivery System Issues............................................................... 20 </P>

<P>2.3.2.2 Ordered Delivery System Issues................................................................... 21 </P>

<P>2.3.3 Deadlock Considerations .................................................................................. 21 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Operation Descriptions </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 23 </P>

<P>3.2 I/O Operations Cross Reference ........................................................................... 24 </P>

<P>3.3 I/O Operations....................................................................................................... 24 </P>

<P>3.3.1 Read Operations................................................................................................ 25 </P>

<P>3.3.2 Write and Streaming-Write Operations ............................................................ 25 </P>

<P>3.3.3 Write-With-Response Operations..................................................................... 26 </P>

<P>3.3.4 Atomic (Read-Modify-Write) Operations ........................................................ 26 </P>

<P>3.4 System Operations ................................................................................................ 27 </P>

<P>3.4.1 Maintenance Operations ................................................................................... 27 </P>

<P>3.5 Endian, Byte Ordering, and Alignment ................................................................ 27 </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Chapter 4 Packet Format Descriptions </P>

<P> </P>

<P>4.1 Request Packet Formats ........................................................................................ 31 </P>

<P>4.1.1 Addressing and Alignment ............................................................................... 32 </P>

<P>4.1.2 Field Definitions for All Request Packet Formats............................................ 32 </P>

<P>4.1.3 Type 0 Packet Format (Implementation-Defined)............................................ 35 </P>

<P>4.1.4 Type 1 Packet Format (Reserved) .................................................................... 35 </P>

<P>4.1.5 Type 2 Packet Format (Request Class)............................................................. 35 </P>

<P>4.1.6 Type 3&#8211;4 Packet Formats (Reserved) ............................................................... 36 </P>

<P>4.1.7 Type 5 Packet Format (Write Class)................................................................. 36 </P>

<P>4.1.8 Type 6 Packet Format (Streaming-Write Class)............................................... 37 </P>

<P>4.1.9 Type 7 Packet Format (Reserved) .................................................................... 38 </P>

<P>4.1.10 Type 8 Packet Format (Maintenance Class) ..................................................... 38 </P>

<P>4.1.11 Type 9&#8211;11 Packet Formats (Reserved) ............................................................. 40 </P>

<P>4.2 Response Packet Formats ..................................................................................... 40 </P>

<P>4.2.1 Field Definitions for All Response Packet Formats ......................................... 40 </P>

<P>4.2.2 Type 12 Packet Format (Reserved) .................................................................. 41 </P>

<P>4.2.3 Type 13 Packet Format (Response Class) ........................................................ 41 </P>

<P>4.2.4 Type 14 Packet Format (Reserved) .................................................................. 42 </P>

<P>4.2.5 Type 15 Packet Format (Implementation-Defined).......................................... 42 </P>

<P> </P>

<P> </P>

<P>Chapter 5 Input/Output Registers </P>

<P> </P>

<P>5.1 Register Summary................................................................................................. 43 </P>

<P>5.2 Reserved Register, Bit and Bit Field Value Behavior .......................................... 44 </P>

<P>5.3 Extended Features Data Structure......................................................................... 45 </P>

<P>5.4 Capability Registers (CARs) ................................................................................ 47 </P>

<P>5.4.1 Device Identity CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x0)..................................................................47 </P>

<P>5.4.2 Device Information CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x4)..................................................................48 </P>

<P>5.4.3 Assembly Identity CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x8)..................................................................49 </P>

<P>5.4.4 Assembly Information CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0xC) .................................................................50 </P>

<P>5.4.5 Processing Element Features CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x10)................................................................51 </P>

<P>5.4.6 Switch Port Information CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x14)................................................................52 </P>

<P>5.4.7 Source Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x18)................................................................53 </P>

<P>5.4.8 Destination Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x1C) ...............................................................54 </P>

<P>5.5 Command and Status Registers (CSRs)................................................................ 55 </P>

<P>5.5.1 Processing Element Logical Layer Control CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x4C) ...............................................................55 </P>

<P> </P>

<P>4 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.2 Local Configuration Space Base Address 0 CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x58)................................................................56 </P>

<P>5.5.3 Local Configuration Space Base Address 1 CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x5C) ...............................................................57 </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>2-1 A Possible RapidIO-Based Computing System..............................................................15 </P>

<P>2-2 Processor-Memory Processing Element Example ..........................................................16 </P>

<P>2-3 Integrated Processor-Memory Processing Element Example.........................................16 </P>

<P>2-4 Memory-Only Processing Element Example .................................................................17 </P>

<P>2-5 Processor-Only Processing Element Example................................................................17 </P>

<P>2-6 Switch Processing Element Example .............................................................................18 </P>

<P>3-1 Read Operation ...............................................................................................................25 </P>

<P>3-2 Write and Streaming-Write Operations ..........................................................................26 </P>

<P>3-3 Write-With-Response Operation ....................................................................................26 </P>

<P>3-4 Atomic (Read-Modify-Write) Operation ........................................................................27 </P>

<P>3-5 Maintenance Operation ...................................................................................................27 </P>

<P>3-6 Byte Alignment Example................................................................................................28 </P>

<P>3-7 Half-Word Alignment Example......................................................................................28 </P>

<P>3-8 Word Alignment Example ..............................................................................................28 </P>

<P>3-9 Data Alignment Example................................................................................................29 </P>

<P>4-1 Type 2 Packet Bit Stream Format ...................................................................................36 </P>

<P>4-2 Type 5 Packet Bit Stream Format ...................................................................................37 </P>

<P>4-3 Type 6 Packet Bit Stream Format ...................................................................................38 </P>

<P>4-4 Type 8 Request Packet Bit Stream Format .....................................................................39 </P>

<P>4-5 Type 8 Response Packet Bit Stream Format ..................................................................40 </P>

<P>4-6 Type 13 Packet Bit Stream Format .................................................................................41 </P>

<P>5-1 Example Extended Features Data Structure ...................................................................46 </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>4-1 Request Packet Type to Transaction Type Cross Reference ..........................................31 </P>

<P>4-2 General Field Definitions for All Request Packets.........................................................33 </P>

<P>4-3 Read Size (rdsize) Definitions ........................................................................................33 </P>

<P>4-4 Write Size (wrsize) Definitions ......................................................................................34 </P>

<P>4-5 Transaction Fields and Encodings for Type 2 Packets ...................................................36 </P>

<P>4-6 Transaction Fields and Encodings for Type 5 Packets ...................................................37 </P>

<P>4-7 Specific Field Definitions and Encodings for Type 8 Packets .......................................39 </P>

<P>4-8 Response Packet Type to Transaction Type Cross Reference........................................40 </P>

<P>4-9 Field Definitions and Encodings for All Response Packets ...........................................40 </P>

<P>5-1 I/O Register Map ............................................................................................................43 </P>

<P>5-2 Configuration Space Reserved Access Behavior............................................................44 </P>

<P>5-3 Bit Settings for Device Identity CAR .............................................................................47 </P>

<P>5-4 Bit Settings for Device Information CAR ......................................................................48 </P>

<P>5-5 Bit Settings for Assembly Identity CAR ........................................................................49 </P>

<P>5-6 Bit Settings for Assembly Information CAR..................................................................50 </P>

<P>5-7 Bit Settings for Processing Element Features CAR........................................................51 </P>

<P>5-8 Bit Settings for Switch Port Information CAR ...............................................................52 </P>

<P>5-9 Bit Settings for Source Operations CAR ........................................................................53 </P>

<P>5-10 Bit Settings for Destination Operations CAR .................................................................54 </P>

<P>5-11 Bit Settings for Processing Element Logical Layer Control CSR ..................................55 </P>

<P>5-12 Bit Settings for Local Configuration Space Base Address 0 CSR .................................56 </P>

<P>5-13 Bit Settings for Local Configuration Space Base Address 1 CSR .................................57 </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>This chapter provides an overview of the RapidIO Part 1: Input/Output Logical Specification, including a description of the relationship between this specification and the other specifications of the RapidIO interconnect. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>The RapidIO Part 1: Input/Output Logical Specification is one of the RapidIO logical layer specifications that define the interconnect&#8217;s overall protocol and packet formats. This layer contains the information necessary for end points to process a transaction. Other RapidIO logical layer specifications include RapidIO Part 2: Message Passing Logical Specification and RapidIO Part 5: Globally Shared Memory Logical Specification. </P>

<P> </P>

<P>The logical specifications do not imply a specific transport or physical interface, therefore they are specified in a bit stream format. Necessary bits are added to the logical encodings for the transport and physical layers lower in the specification hierarchy. </P>

<P> </P>

<P>RapidIO is a definition of a system interconnect. System concepts such as processor programming models, memory coherency models and caching are beyond the scope of the RapidIO architecture. The support of memory coherency models, through caches, memory directories (or equivalent, to hold state and speed up remote memory access) is the responsibility of the end points (processors, memory, and possibly I/O devices), using RapidIO operations. RapidIO provides the operations to construct a wide variety of systems, based on programming models that range from strong   consistency   through   total   store   ordering   to   weak   ordering. Inter-operability between end points supporting different coherency/caching/directory  models  is  not  guaranteed.  However,  groups  of end-points with conforming models can be linked to others conforming to different models on the same RapidIO fabric. These different groups can communicate through RapidIO messaging or I/O operations. Any reference to these areas within the RapidIO architecture specification are for illustration only. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1.3 Features of the Input/Output Specification </P>

<P> </P>

<P>The following are features of the RapidIO I/O specification designed to satisfy the needs of various applications and systems: </P>

<P> </P>

<P> </P>

<P>1.3.1  Functional Features </P>

<P>&#8226; A rich variety of transaction types, such as DMA-style read and writes, that allow efficient I/O systems to be built. </P>

<P>&#8226; System sizes from very small to very large are supported in the same or compatible packet formats&#8212;RapidIO plans for future expansion and requirements. </P>

<P>&#8226; Read-modify-write atomic operations are useful for synchronization between processors or other system elements. </P>

<P>&#8226; The RapidIO architecture supports 50- and 66-bit addresses as well as 34-bit local addresses for smaller systems. </P>

<P>&#8226; DMA devices can improve the interconnect efficiency if larger non-coherent data quantities can be encapsulated within a single packet, so RapidIO supports a variety of data sizes within the packet formats. </P>

<P> </P>

<P> </P>

<P>1.3.2  Physical Features </P>

<P>&#8226; RapidIO packet definition is independent of the width of the physical interface to other devices on the interconnect fabric. </P>

<P>&#8226; The protocols and packet formats are independent of the physical interconnect topology. The protocols work whether the physical fabric is a point-to-point ring, a bus, a switched multi-dimensional network, a duplex serial connection, and so forth. </P>

<P>&#8226; RapidIO is not dependent on the bandwidth or latency of the physical fabric. </P>

<P>&#8226; The protocols handle out-of-order packet transmission and reception. </P>

<P>&#8226; Certain devices have bandwidth and latency requirements for proper operation. </P>

<P>RapidIO does not preclude an implementation from imposing these constraints within the system. </P>

<P> </P>

<P> </P>

<P>1.3.3  Performance Features </P>

<P>&#8226; Packet headers must be as small as possible to minimize the control overhead and be organized for fast, efficient assembly and disassembly. </P>

<P>&#8226; 48- and 64-bit addresses are required in the future, and must be supported initially. </P>

<P>&#8226; Multiple transactions must be allowed concurrently in the system, otherwise a majority of the potential system throughput is wasted. </P>

<P> </P>

<P> </P>

<P> </P>

<P>1.4 Contents </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Following  are  the  contents  of  the  RapidIO  Part  1:  Input/Output  Logical </P>

<P>Specification: </P>

<P> </P>

<P>&#8226; Chapter 1, &#8220;Overview&#8221; (this chapter) provides an overview of the specification </P>

<P>&#8226; Chapter 2, &#8220;System Models,&#8221; introduces some possible devices that could participate in a RapidIO system environment. Transaction ordering and deadlock prevention are discussed. </P>

<P>&#8226; Chapter 3, &#8220;Operation Descriptions,&#8221; describes the set of operations and transactions supported by the RapidIO I/O protocols. </P>

<P>&#8226; Chapter 4, &#8220;Packet Format Descriptions,&#8221; contains the packet format definitions for the I/O specification. The two basic types, request and response packets, with their sub-types and fields are defined. </P>

<P>&#8226; Chapter 5, &#8220;Input/Output Registers,&#8221; describes the visible register set that allows an external processing element to determine the I/O capabilities, configuration, and status of a processing element using this logical specification. Only registers or register bits specific to the I/O logical specification are explained. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and bit definitions. </P>

<P> </P>

<P> </P>

<P>1.5 Terminology </P>

<P> </P>

<P>Refer to the Glossary at the back of this document. </P>

<P> </P>

<P> </P>

<P>1.6 Conventions </P>

<P>|| Concatenation, used to indicate that two fields are physically associated as consecutive bits </P>

<P> </P>

<P>ACTIVE_HIGH Names of active high signals are shown in uppercase text with no overbar. Active-high signals are asserted when high and not asserted when low. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_3.jpg"/>
</Figure>

<P>ACTIVE_LOW Names of active low signals are shown in uppercase text with an overbar. Active low signals are asserted when low and not asserted when high. </P>

<P>italics Book titles in text are set in italics. </P>

<P> </P>

<P>REG[FIELD] Abbreviations or acronyms for registers are shown in uppercase text. Specific bits, fields, or ranges appear in brackets. </P>

<P>TRANSACTION Transaction types are expressed in all caps. operation Device operation types are expressed in plain text. n A decimal value. </P>

<P>RapidIO Trade Association 13 </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>[n-m] Used to express a numerical range from n to m. </P>

<P> </P>

<P>0bnn A binary value, the number of bits is determined by the number of digits. </P>

<P>0xnn A hexadecimal value, the number of bits is determined by the number of digits or from the surrounding context; for example, 0xnn may be a 5, 6, 7, or 8 bit value. </P>

<P>x This value is a don&#8217;t care </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 System Models </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This overview introduces some possible devices in a RapidIO system. </P>

<P> </P>

<P> </P>

<P>2.2 Processing Element Models </P>

<P> </P>

<P>Figure 2-1 describes a possible RapidIO-based computing system. The processing element is a computer device such as a processor attached to a local memory and to a RapidIO system interconnect. The bridge part of the system provides I/O subsystem services such as high-speed PCI interfaces and gigabit ethernet ports, interrupt control, and other system support functions. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_4.jpg"/>
</Figure>

<P>Processing </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_5.jpg"/>
</Figure>

<P>Element A </P>

<P>Processing </P>

<P>Element B </P>

<P>Processing </P>

<P>Element C </P>

<P>Processing </P>

<P>Element D </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_6.jpg"/>
</Figure>

<P>Memory </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_7.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_8.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_9.jpg"/>
</Figure>

<P>Memory </P>

<P>Memory </P>

<P>Memory </P>

<P> </P>

<P>RapidIO System Interconnect Fabric </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI A </P>

<P> </P>

<P> </P>

<P>Bridge </P>

<P>MPIC </P>

<P>PCI B XBUS </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_10.jpg"/>
</Figure>

<P>Firewire </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_11.jpg"/>
</Figure>

<P> </P>

<P>Figure 2-1. A Possible RapidIO-Based Computing System </P>

<P> </P>

<P>The following sections describe several possible processing elements. </P>

<P> </P>

<P> </P>

<P>2.2.1  Processor-Memory Processing Element Model </P>

<P> </P>

<P>Figure 2-2 shows an example of a processing element consisting of a processor connected to an agent device. The agent carries out several services on behalf of the processor. Most importantly, it provides access to a local memory that has much lower latency than memory that is local to another processing element (remote memory accesses). It also provides an interface to the RapidIO interconnect to </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>service those remote memory accesses. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_12.jpg"/>
</Figure>

<P>Local Interconnect </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_13.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_14.jpg"/>
</Figure>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-2. Processor-Memory Processing Element Example </P>

<P> </P>

<P>2.2.2  Integrated Processor-Memory Processing Element Model </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_15.jpg"/>
</Figure>

<P>Another form of a processor-memory processing element is a fully integrated component that is designed specifically to connect to a RapidIO interconnect system as shown in Figure 2-3. This type of device integrates a memory system and other support logic with a processor on the same piece of silicon or within the same package. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_16.jpg"/>
</Figure>

<P>Memory </P>

<P> </P>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-3. Integrated Processor-Memory Processing Element Example </P>

<P> </P>

<P> </P>

<P>2.2.3  Memory-Only Processing Element Model </P>

<P> </P>

<P>A different processing element may not contain a processor at all, but may be a memory-only device as shown in Figure 2-4. This type of device is much simpler than a processor; it only responds to requests from the external system, not to local requests as in the processor-based model. As such, its memory is remote for all processors in the system. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_17.jpg"/>
</Figure>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P>Control </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_18.jpg"/>
</Figure>

<P>Memory </P>

<P> </P>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-4. Memory-Only Processing Element Example </P>

<P> </P>

<P>2.2.4  Processor-Only Processing Element </P>

<P> </P>

<P>Similar to a memory-only element, a processor-only element has no local memory. A processor-only processing element is shown in Figure 2-5. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_19.jpg"/>
</Figure>

<P>Local Interconnect </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_20.jpg"/>
</Figure>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P>Processor </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P> </P>

<P>Agent </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-5. Processor-Only Processing Element Example </P>

<P> </P>

<P> </P>

<P>2.2.5  I/O Processing Element </P>

<P> </P>

<P>This type of processing element is shown as the bridge in Figure 2-1. This device has distinctly different behavior than a processor or a memory device. An I/O device only needs to move data into and out of local or remote memory. </P>

<P> </P>

<P> </P>

<P>2.2.6  Switch Processing Element </P>

<P> </P>

<P>A switch processing element is a device that allows communication with other processing elements through the switch. A switch may be used to connect a variety of RapidIO-compliant processing elements. A hybrid processing element may combine a switch with end point functionality. A possible switch is shown in Figure 2-6. Behavior of the switches, and the interconnect fabric in general, is addressed in the RapidIO Common Transport Specification. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Switch </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_21.jpg"/>
</Figure>

<P>Figure 2-6. Switch Processing Element Example </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_22.jpg"/>
</Figure>

<P> </P>

<P>2.3 System Issues </P>

<P> </P>

<P>The following sections describe transaction ordering and system deadlock considerations in a RapidIO system. </P>

<P> </P>

<P> </P>

<P>2.3.1  Operation Ordering </P>

<P> </P>

<P>Most operations in an I/O system do not have any requirements as far as completion ordering. There are, however, several tasks that require events to occur in a specific order. As an example, a processing element may wish to write a set of registers in another processing element. The sequence in which those writes are carried out may be critical to the operation of the target processing element. Without some specific system rules there would be no guarantee of completion ordering of these operations. Ordering is mostly a concern for operations between a specific source and destination pair. </P>

<P> </P>

<P>In certain cases a processing element may communicate with another processing element or set of processing elements in different contexts. A set or sequence of operations issued by a processing element may have requirements for completing in order at the target processing element. That same processing element may have another sequence of operations that also requires a completion order at the target processing element. However, the issuing processing element has no requirements for completion order between the two sequences of operations. Further, it may be desirable for one of the sequences of operations to complete at a higher priority than the other sequence. The term &#8220;transaction request flow&#8221; is defined as one of these sequences of operations. </P>

<P> </P>

<P>A transaction request flow is defined as an ordered sequence of non-maintenance request transactions from a given source (as indicated by the source identifier) to a given destination (as indicated by the transaction destination identifier), where a maintenance request is a special system support request. Each packet in a transaction request flow has the same source identifier and the same destination identifier. </P>

<P> </P>

<P>There may be multiple transaction request flows between a given source and destination pair. When multiple flows exist between a source and destination pair, </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>the flows are distinguished by a flow indicator (flowID). RapidIO allows multiple transaction request flows between any source and destination pair. The flows between each source and destination pair are identified with alphabetic characters beginning with A. </P>

<P> </P>

<P>The flows between each source and destination pair are prioritized. The flow priority increases alphabetically with flowID A having the lowest priority, flowID B having the next to lowest priority, etc. When multiple transaction request flows exist between a given source and destination pair, transactions of a higher priority flow may pass transactions of a lower priority flow, but transactions of a lower priority flow may not pass transactions of a higher priority flow. </P>

<P> </P>

<P>Maintenance transactions are not part of any transaction request flow. However, within a RapidIO fabric, maintenance transactions may not pass other maintenance transactions of the same or higher priority taking the same path through the fabric. </P>

<P> </P>

<P>Response transactions are not part of any transaction request flow. There is no ordering between any pair of response transactions and there is no ordering between any response transaction and any request transaction that did not cause the generation of the response. </P>

<P> </P>

<P>To support transaction request flows, all devices that support the RapidIO logical specification shall comply as applicable with the following Fabric Delivering Ordering and End point Completion Ordering rules. </P>

<P> </P>

<P>Fabric Delivery Ordering Rules </P>

<P> </P>

<P>1. Non-maintenance request transactions within a transaction request flow (same source identifier, same destination identifier, and same flowID) shall be delivered to the logical layer of the destination in the same order that they were issued by the logical layer of the source. </P>

<P>2. Non-maintenance request transactions that have the same source (same source identifier) and the same destination (same destination identifier) but different flowIDs shall be delivered to the logical layer of the destination as follows. </P>

<P>&#8211; A transaction of a higher priority transaction request flow that was issued by the logical layer of the source before a transaction of a lower priority transaction request flow shall be delivered to the logical layer of the destination before the lower priority transaction. </P>

<P>&#8211; A transaction of a higher priority transaction request flow that was issued by the logical layer of the source after a transaction of a lower priority transaction request flow may be delivered to the logical layer of the destination before the lower priority transaction. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3. Request transactions that have different sources (different source identifiers) or different destinations (different destination identifiers) are unordered with respect to each other. </P>

<P> </P>

<P>End point Completion Ordering Rules </P>

<P> </P>

<P>1. Write request transactions in a transaction request flow shall be completed at the logical layer of the destination in the same order that the transactions were delivered to the logical layer of the destination. </P>

<P>2. A read request transaction with source A and destination B shall force the completion at the logical layer of B of all write requests in the same transaction request flow that were received by the logical layer of B before the read request transaction. </P>

<P> </P>

<P>Read request transactions need not be completed in the same order that they were received by the logical layer of the destination. As a consequence, read response transactions need not be issued by the logical layer of the destination in the same order that the associated read request transactions were received. </P>

<P> </P>

<P>Write response transactions will likely be issued at the logical level in the order that the associated write request was received. However, since response transactions are not part of any flow, they are not ordered relative to one another and may not arrive at the logical level their destination in the same order as the associated write transactions were issued. Therefore, write response transactions need not be issued by the logical layer in the same order as the associated write request was received. </P>

<P> </P>

<P>It may be necessary to impose additional rules in order to provide for inter operability with other interface standards or programming models. However, such additional rules are beyond the scope of this specification. </P>

<P> </P>

<P> </P>

<P>2.3.2  Transaction Delivery </P>

<P> </P>

<P>There are two basic types of delivery schemes that can be built using RapidIO processing elements: unordered and ordered. The RapidIO logical protocols assume that all outstanding transactions to another processing element are delivered in an arbitrary order. In other words, the logical protocols do not rely on transaction interdependencies for operation. RapidIO also allows completely ordered delivery systems to be constructed. Each type of system puts different constraints on the implementation of the source and destination processing elements and any intervening hardware. The specific mechanisms and definitions of how RapidIO enforces transaction ordering are discussed in the appropriate physical layer specification. </P>

<P> </P>

<P>2.3.2.1  Unordered Delivery System Issues </P>

<P> </P>

<P>An unordered delivery system is defined as an interconnect fabric where transactions between a source and destination pair can arbitrarily pass each other during transmission through the intervening fabric. </P>

<P> </P>

<P>20 RapidIO Trade Association </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Operations in the unordered system that are required to complete in a specific order shall be properly managed at the source processing element. For example, enforcing a specific sequence for writing a series of configuration registers, or preventing a subsequent read from bypassing a preceding write to a specific address are cases of ordering that may need to be managed at the source. The source of these transactions shall issue them in a purely serial sequence, waiting for completion notification for a write before issuing the next transaction to the interconnect fabric. The destination processing element shall guarantee that all outstanding non-coherent operations from that source are completed before servicing a subsequent non-coherent request from that source. </P>

<P> </P>

<P>2.3.2.2  Ordered Delivery System Issues </P>

<P> </P>

<P>Ordered delivery systems place additional implementation constraints on both the source and destination processing elements as well as any intervening hardware. Typically an ordered system requires that all transactions between a source/destination pair be completed in the order generated, not necessarily the order in which they can be accepted by the destination or an intermediate device. In one example, if several requests are sent before proper receipt is acknowledged the destination or intermediate device shall retry all following transactions until the first retried packet is retransmitted and accepted. In this case, the source shall &#8220;unroll&#8221; its outstanding transaction list and retransmit the first one to maintain the proper system ordering. In another example, an interface may make use of explicit transaction tags which allow the destination to place the transactions in the proper order upon receipt. </P>

<P> </P>

<P> </P>

<P>2.3.3  Deadlock Considerations </P>

<P> </P>

<P>A deadlock can occur if a dependency loop exists. A dependency loop is a situation where a loop of buffering devices is formed, in which forward progress at each device is dependent upon progress at the next device. If no device in the loop can make progress then the system is deadlocked. </P>

<P> </P>

<P>The simplest solution to the deadlock problem is to discard a packet. This releases resources in the network and allows forward progress to be made. RapidIO is designed to be a reliable fabric for use in real time tightly coupled systems, therefore discarding packets is not an acceptable solution. </P>

<P> </P>

<P>In order to produce a system with no chance of deadlock it is required that a deadlock free topology be provided for response-less operations. Dependency loops to single direction packets can exist in unconstrained switch topologies. Often the dependency loop can be avoided with simple routing rules. Topologies like hypercubes or three-dimensional meshes physically contain loops. In both cases, routing is done in several dimensions (x,y,z). If routing is constrained to the x dimension, then y, then z (dimension ordered routing), topology related dependency loops are avoided in these structures. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>In addition, a processing element design shall not form dependency links between its input and output ports. A dependency link between input and output ports occurs if a processing element is unable to accept an input packet until a waiting packet can be issued from the output port. </P>

<P> </P>

<P>RapidIO supports operations, such as read operations, that require responses to complete. These operations can lead to a dependency link between a processing element&#8217;s input port and output port. </P>

<P> </P>

<P>As an example of a input to output port dependency, consider a processing element where the output port queue is full. The processing element can not accept a new request at its input port since there is no place to put the response in the output port queue. No more transactions can be accepted at the input port until the output port is able to free entries in the output queue by issuing packets to the system. </P>

<P> </P>

<P>The method by which a RapidIO system maintains a deadlock free environment is described in the appropriate Physical Layer specification. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Operation Descriptions </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This chapter describes the set of operations and their associated transactions supported by the I/O protocols of RapidIO. The transaction types, packet formats, and other necessary transaction information are described in Chapter 4, &#8220;Packet Format Descriptions.&#8221; </P>

<P> </P>

<P>The I/O operation protocols work using request/response transaction pairs through the interconnect fabric. A processing element sends a request transaction to another processing element if it requires an activity to be carried out. The receiving processing element responds with a response transaction when the request has been completed or if an error condition is encountered. Each transaction is sent as a packet through the interconnect fabric. For example, a processing element that requires data from another processing element sends an NREAD transaction in a request packet to that processing element, which reads its local memory at the requested address and returns the data in a DONE transaction in a response packet. Note that not all requests require responses; some requests assume that the desired activity will complete properly. </P>

<P> </P>

<P>Two possible response transactions can be received by a requesting processing element: </P>

<P> </P>

<P>&#8226; A DONE response indicates to the requestor that the desired transaction has completed and it also returns data for read-type transactions as described above. </P>

<P>&#8226; An ERROR response means that the target of the transaction encountered an unrecoverable error and could not complete the transaction. </P>

<P> </P>

<P>Packets may contain additional information that is interpreted by the interconnect fabric to route the packets through the fabric from the source to the destination, such as a device number. These requirements are described in the appropriate RapidIO transport layer specification, and are beyond the scope of this specification. </P>

<P> </P>

<P>Depending upon the interconnect fabric, other packets may be generated as part of the physical layer protocol to manage flow control, errors, etc. Flow control and other fabric-specific communication requirements are described in the appropriate RapidIO transport and physical layer specifications and are beyond the scope of this document. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>For most transaction types, a request transaction sent into the system is marked with a transaction ID that is unique for each requestor and responder processing element pair. This transaction ID allows a response to be easily matched to the original request when it is returned to the requestor. An end point cannot reuse a transaction ID value to the same destination until the response from the original transaction has been received by the requestor. The number of outstanding transactions that may be supported is implementation dependent. </P>

<P> </P>

<P>Transaction IDs may also be used to indicate sequence information if ordered reception of transactions is required by the destination processing element and the interconnect fabric can reorder packets. The receiving device must accept and not complete the subsequent out-of-order requests until the missing transactions in the sequence have been received and completed. </P>

<P> </P>

<P> </P>

<P>3.2 I/O Operations Cross Reference </P>

<P> </P>

<P>Table  contains a cross reference of the I/O operations defined in this RapidIO </P>

<P>specification and their system usage. </P>

<P>Table 2-1. I/O Operations Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Operation </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Transactions </P>

<P>Used </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Possible System Usage </P>
</TD>

<TD>
<P>Request Transaction Classification for Completion Ordering Rules </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Description </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Packet </P>

<P>Format </P>
</TD>
</TR>

<TR>
<TD>
<P>Read </P>
</TD>

<TD>
<P>NREAD, RESPONSE </P>
</TD>

<TD>
<P>Read operation </P>
</TD>

<TD>
<P>Read </P>
</TD>

<TD>
<P>Section 3.3.1 </P>
</TD>

<TD>
<P>Type 2 </P>

<P>Section 4.1.5 </P>
</TD>
</TR>

<TR>
<TD>
<P>Write </P>
</TD>

<TD>
<P>NWRITE </P>
</TD>

<TD>
<P>Write operation </P>
</TD>

<TD>
<P>Write </P>
</TD>

<TD>
<P>Section 3.3.2 </P>
</TD>

<TD>
<P>Type 5 </P>

<P>Section 4.1.7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Write-with-response </P>
</TD>

<TD>
<P>NWRITE_R, RESPONSE </P>
</TD>

<TD>
<P>Write operation </P>
</TD>

<TD>
<P>Write </P>
</TD>

<TD>
<P>Section 3.3.3 </P>
</TD>

<TD>
<P>Type 5 </P>

<P>Section 4.1.7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Streaming-write </P>
</TD>

<TD>
<P>SWRITE </P>
</TD>

<TD>
<P>Write operation </P>
</TD>

<TD>
<P>Write </P>
</TD>

<TD>
<P>Section 3.3.2 </P>
</TD>

<TD>
<P>Type 6 </P>

<P>Section 4.1.8 </P>
</TD>
</TR>

<TR>
<TD>
<P>Atomic </P>

<P>(read-modify-write) </P>
</TD>

<TD>
<P>ATOMIC, RESPONSE </P>
</TD>

<TD>
<P>Read-modify-write operation </P>
</TD>

<TD>
<P>Write </P>
</TD>

<TD>
<P>Section 3.3.4 </P>
</TD>

<TD>
<P>Type 2 </P>

<P>Section 4.1.5 </P>

<P>Type 5 </P>

<P>Section 4.1.7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Maintenance </P>
</TD>

<TD>
<P>MAINTENANCE </P>
</TD>

<TD>
<P>System exploration, initialization, and maintenance operation </P>
</TD>

<TD>
<P>not applicable </P>
</TD>

<TD>
<P>Section 3.4.1 </P>
</TD>

<TD>
<P>Type 8 </P>

<P>Section 4.1.10 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.3 I/O Operations </P>

<P> </P>

<P>The operations described in this section are used for I/O accesses to physical addresses in the target of the operation. Examples are accesses to non-coherent memory, ROM boot code, or to configuration registers that do not participate in any globally shared system memory protocol. These accesses may be of any specifiable size allowed by the system. </P>

<P> </P>

<P>24 RapidIO Trade Association </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>All data payloads that are less than 8 bytes shall be padded and have their bytes aligned to their proper byte position within the double-word, as in the examples shown in Figure 3-6 through Figure 3-8. </P>

<P> </P>

<P>The described behaviors are the same regardless of the actual target physical address. </P>

<P> </P>

<P> </P>

<P>3.3.1  Read Operations </P>

<P> </P>

<P>The read operation, consisting of the NREAD and RESPONSE transactions (typically a DONE response) as shown in Figure 3-1, is used by a processing element that needs to read data from the specified address. The data returned is of the size requested. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_23.jpg"/>
</Figure>

<P>If the read operation is to memory, data is returned from the memory regardless of the state of any system-wide cache coherence mechanism for the specified cache line or lines, although it may cause a snoop of any caches local to the memory controller. </P>

<P> </P>

<P>1  NREAD </P>

<P> </P>

<P> </P>

<P>Requestor Destination </P>

<P> </P>

<P>2  DONE, data </P>

<P> </P>

<P>Figure 3-1. Read Operation </P>

<P> </P>

<P> </P>

<P>3.3.2  Write and Streaming-Write Operations </P>

<P> </P>

<P>The write and streaming-write operations, consisting of the NWRITE and SWRITE transactions as shown in Figure 3-2, are used by a processing element that needs to write data to the specified address. The NWRITE transaction allows multiple double-word, word, half-word and byte writes with properly padded and aligned (to the 8-byte boundary) data payload. The SWRITE transaction is a double-word-only version of the NWRITE that has less header overhead. The write size and alignment for  the  NWRITE  transaction  are  specified  in  Table 4-4.  Non-contiguous  and unaligned writes are not supported. It is the requestor&#8217;s responsibility to break up a write operation into multiple transactions if the block is not aligned. </P>

<P> </P>

<P>NWRITE and SWRITE transactions do not receive responses, so there is no notification to the sender when the transaction has completed at the destination. </P>

<P> </P>

<P>If the write operation is to memory, data is written to the memory regardless of the state of any system-wide cache coherence mechanism for the specified cache line or lines, although it may cause a snoop of any caches local to the memory controller. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_24.jpg"/>
</Figure>

<P>1  NWRITE or SWRITE, data </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_25.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Requestor Destination </P>

<P> </P>

<P> </P>

<P>Figure 3-2. Write and Streaming-Write Operations </P>

<P> </P>

<P>3.3.3  Write-With-Response Operations </P>

<P> </P>

<P>The write-with-response operation, consisting of the NWRITE_R and RESPONSE transactions (typically a DONE response) as shown in Figure 3-3, is identical to the write operation except that it receives a response to notify the sender that the write has  completed  at  the  destination.  This  operation  is  useful  for  guaranteeing read-after-write and write-after-write ordering through a system that can reorder transactions and for enforcing other required system behaviors. </P>

<P> </P>

<P>1  NWRITE_R, data </P>

<P> </P>

<P> </P>

<P>Requestor </P>

<P>Destination </P>

<P> </P>

<P>2  DONE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_26.jpg"/>
</Figure>

<P>Figure 3-3. Write-With-Response Operation </P>

<P> </P>

<P> </P>

<P>3.3.4  Atomic (Read-Modify-Write) Operations </P>

<P> </P>

<P>The read-modify-write operation, consisting of the ATOMIC and RESPONSE transactions (typically a DONE response) as shown in Figure 3-4, is used by a number  of  cooperating processing elements to  perform  synchronization using non-coherent memory. The allowed specified data sizes are one word (4 bytes), one half-word (2 bytes) or one byte, with the size of the transaction specified in the same way as for an NWRITE transaction. Double-word (8-byte) and 3, 5, 6, and 7 byte ATOMIC transactions may not be specified. </P>

<P> </P>

<P>The atomic operation is a combination read and write operation. The destination reads the data at the specified address, returns the read data to the requestor, performs the required operation to the data, and then writes the modified data back to the specified address without allowing any intervening activity to that address. Defined operations are increment, decrement, test-and-swap, set, and clear (See bit settings in    Table 5-9    and    Table 5-10).    Of    these,    only    test-and-swap, compare-and-swap, and swap require the requesting processing element to supply data. The target data of an atomic operation may be initialized using an NWRITE transaction. </P>

<P> </P>

<P>If the atomic operation is to memory, data is written to the memory regardless of the state of any system-wide cache coherence mechanism for the specified cache line or </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>lines, although it may cause a snoop of any caches local to the memory controller. </P>

<P> </P>

<P>1  ATOMIC, data (opt.) </P>

<P> </P>

<P> </P>

<P>Requestor Destination </P>

<P> </P>

<P>2  DONE, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_27.jpg"/>
</Figure>

<P>Figure 3-4. Atomic (Read-Modify-Write) Operation </P>

<P> </P>

<P>3.4 System Operations </P>

<P> </P>

<P>All data payloads that are less than 8 bytes shall be padded and have their bytes aligned to their proper byte position within the double-word, as in the examples shown in Figure 3-6 through Figure 3-8. </P>

<P> </P>

<P> </P>

<P>3.4.1  Maintenance Operations </P>

<P> </P>

<P>The maintenance operation, which can consist of more than one MAINTENANCE transaction as shown in Figure 3-5, is used by a processing element that needs to read or write data to the specified CARs, CSRs, or locally-defined registers or data structures. If a response is required, MAINTENANCE requests receive a MAINTENANCE response rather than a normal response for both read and write operations. Supported accesses are in 32 bit quantities and may optionally be in double-word and multiple double-word quantities to a maximum of 64 bytes. </P>

<P> </P>

<P>1  MAINTENANCE, opt. data </P>

<P> </P>

<P> </P>

<P>Requestor Destination </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_28.jpg"/>
</Figure>

<P>2  opt. MAINTENANCE, opt. data </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_29.jpg"/>
</Figure>

<P> </P>

<P>Figure 3-5. Maintenance Operation </P>

<P> </P>

<P> </P>

<P>3.5 Endian, Byte Ordering, and Alignment </P>

<P> </P>

<P>RapidIO has double-word (8-byte) aligned big-endian data payloads. This means that the RapidIO interface to devices that are little-endian shall perform the proper endian transformation to format a data payload. </P>

<P> </P>

<P>Operations that specify data quantities that are less than 8 bytes shall have the bytes aligned to their proper byte position within the big-endian double-word, as in the examples shown in Figure 3-6 through Figure 3-8. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_30.jpg"/>
</Figure>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Byte address 0x0000_0002, the proper byte position is shaded. </P>

<P> </P>

<P>Figure 3-6. Byte Alignment Example </P>

<P> </P>

<P> </P>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>MSB </P>
</TD>

<TD>
<P>LSB </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Half-word address 0x0000_0002, the proper byte positions are shaded. </P>

<P> </P>

<P>Figure 3-7. Half-Word Alignment Example </P>

<P> </P>

<P> </P>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>MSB </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>LSB </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Word address 0x0000_0004, the proper byte positions are shaded. </P>

<P> </P>

<P>Figure 3-8. Word Alignment Example </P>

<P> </P>

<P>For write operations, a processing element shall properly align data transfers to a double-word boundary for transmission to the destination. This alignment may require breaking up a data stream into multiple transactions if the data is not naturally aligned. A number of data payload sizes and double-word alignments are defined to minimize this burden. Figure 3-9 shows a 48-byte data stream that a processing element wishes to write to another processing element through the interconnect fabric. The data displayed in the figure is big-endian and double-word aligned with the bytes to be written shaded in grey. Because the start of the stream and the end of the stream are not aligned to a double-word boundary, the sending processing element shall break the stream into three transactions as shown in the figure. </P>

<P> </P>

<P>The first transaction sends the first three bytes (in byte lanes 5, 6, and 7) and indicates a byte lane 5, 6, and 7 three-byte write. The second transaction sends all of the remaining data except for the final sub-double-word. The third transaction sends the final 5 bytes in byte lanes 0, 1, 2, 3, and 4 indicating a five-byte write in byte lanes 0, 1, 2, 3, and 4. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Byte </P>

<P>Lane </P>

<P>0 </P>

<P>Byte </P>

<P>Lane </P>

<P>1 </P>

<P>Byte </P>

<P>Lane </P>

<P>2 </P>

<P>Byte </P>

<P>Lane </P>

<P>3 </P>

<P>Byte </P>

<P>Lane </P>

<P>4 </P>

<P>Byte </P>

<P>Lane </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_31.jpg"/>
</Figure>

<P>5 </P>

<P> </P>

<P>MSB </P>

<P>Byte </P>

<P>Lane </P>

<P>6 </P>

<P>Byte </P>

<P>Lane </P>

<P>7 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>First transaction sends these three bytes with this double-word alignment </P>

<P> </P>

<P>Second transaction sends these five double-words </P>

<P> </P>

<P> </P>

<P> </P>

<P>LSB </P>

<P>Third transaction sends these five bytes with this double-word alignment </P>

<P> </P>

<P>Double-Word Boundary </P>

<P> </P>

<P> </P>

<P>Figure 3-9. Data Alignment Example </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Packet Format Descriptions </P>

<P> </P>

<P>This chapter contains the packet format definitions for the RapidIO Part 1: Input/Output Logical Specification. Four types of I/O packet formats exist: </P>

<P>&#8226; Request </P>

<P>&#8226; Response </P>

<P>&#8226; Implementation-defined </P>

<P>&#8226; Reserved </P>

<P> </P>

<P>The packet formats are intended to be interconnect fabric independent so the system interconnect can be anything required for a particular application. Reserved formats, unless defined in another logical specification, shall not be used by a device. </P>

<P> </P>

<P> </P>

<P>4.1 Request Packet Formats </P>

<P> </P>

<P>A request packet is issued by a processing element that needs a remote processing element to accomplish some activity on its behalf, such as a memory read operation. The request packet format types and their transactions for the I/O Logical Specification are shown in Table 4-1 below. </P>

<P>Table 4-1. Request Packet Type to Transaction Type Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Request Packet </P>

<P>Format Type </P>
</TD>

<TD>
<P> </P>

<P>Transaction Type </P>
</TD>

<TD>
<P> </P>

<P>Definition </P>
</TD>

<TD>
<P>Document </P>

<P>Section No. </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 0 </P>
</TD>

<TD>
<P>Implementation-&#61472;&#61472;</P>

<P>defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>

<TD>
<P>Section 4.1.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 1 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.1.4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 2 </P>
</TD>

<TD>
<P>ATOMIC set </P>
</TD>

<TD>
<P>Read-write 1&#8217;s to specified address </P>
</TD>

<TD>
<P>Section 4.1.5 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>ATOMIC clear </P>
</TD>

<TD>
<P>Read-write 0&#8217;s to specified address </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>ATOMIC increment </P>
</TD>

<TD>
<P>Read-increment-write to specified address </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>ATOMIC </P>

<P>decrement </P>
</TD>

<TD>
<P>Read-decrement-write to specified address </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>NREAD </P>
</TD>

<TD>
<P>Read specified address </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>Type 3-4 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.1.6 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-1. Request Packet Type to Transaction Type Cross Reference (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Request Packet </P>

<P>Format Type </P>
</TD>

<TD>
<P> </P>

<P>Transaction Type </P>
</TD>

<TD>
<P> </P>

<P>Definition </P>
</TD>

<TD>
<P>Document </P>

<P>Section No. </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 5 </P>
</TD>

<TD>
<P>ATOMIC </P>

<P>test-and-swap </P>
</TD>

<TD>
<P>Read-test=0-swap-write to specified address </P>
</TD>

<TD>
<P>Section 4.1.7 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>ATOMIC swap </P>
</TD>

<TD>
<P>Read-write to specified address </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>ATOMIC </P>

<P>compare-and-swap </P>
</TD>

<TD>
<P>Read-test=first data-write second data to specified address </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>NWRITE </P>
</TD>

<TD>
<P>Write specified address </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>NWRITE_R </P>
</TD>

<TD>
<P>Write specified address, notify source of completion </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>Type 6 </P>
</TD>

<TD>
<P>SWRITE </P>
</TD>

<TD>
<P>Write specified address </P>
</TD>

<TD>
<P>Section 4.1.8 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.1.9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 8 </P>
</TD>

<TD>
<P>MAINTENANCE </P>
</TD>

<TD>
<P>Read or write device configuration registers and perform other system maintenance tasks </P>
</TD>

<TD>
<P>Section 4.1.10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 9-11 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.1.11 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.1.1  Addressing and Alignment </P>

<P> </P>

<P>The size of the address is defined as a system-wide parameter; thus the packet formats do not support mixed local physical address fields simultaneously. The least three significant bits of all addresses are not specified and are assumed to be logic 0. </P>

<P> </P>

<P>All transactions are aligned to a byte, half-word, word, or double-word boundary. Read and write request addresses are aligned to any specifiable double-word boundary and are not aligned to the size of the data written or requested. Data payloads start at the first double-word and proceed linearly through the address space. Sub-double-word data payloads shall be padded and properly aligned within the 8-byte boundary. Non-contiguous or unaligned transactions that would ordinarily require a byte mask are not supported. A sending device that requires this behavior shall break the operation into multiple request transactions. An example of this is shown in Section 3.5, &#8220;Endian, Byte Ordering, and Alignment.&#8221; </P>

<P> </P>

<P> </P>

<P>4.1.2  Field Definitions for All Request Packet Formats </P>

<P> </P>

<P>Table 4-2 through Table 4-4 describe the field definitions for all request packet formats. Bit fields that are defined as &#8220;reserved&#8221; shall be assigned to logic 0s when generated and ignored when received. Bit field encodings that are defined as &#8220;reserved&#8221; shall not be assigned when the packet is generated. A received reserved encoding is regarded as an error if a meaningful encoding is required for the transaction and function, otherwise it is ignored. Implementation-defined fields shall be ignored unless the encoding is understood by the receiving device. All packets described are bit streams from the first bit to the last bit, represented in the </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>figures from left to right respectively. </P>

<P>Table 4-2. General Field Definitions for All Request Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>ftype </P>
</TD>

<TD>
<P>Format type, represented as a 4-bit value; is always the first four bits in the logical packet stream. </P>
</TD>
</TR>

<TR>
<TD>
<P>wdptr </P>
</TD>

<TD>
<P>Word pointer, used in conjunction with the data size (rdsize and wrsize) fields&#8212;see Table 4-3, Table 4-4 and </P>

<P>Section 3.5. </P>
</TD>
</TR>

<TR>
<TD>
<P>rdsize </P>
</TD>

<TD>
<P>Data size for read transactions, used in conjunction with the word pointer (wdptr) bit&#8212;see Table 4-3 and Section </P>

<P>3.5. </P>
</TD>
</TR>

<TR>
<TD>
<P>wrsize </P>
</TD>

<TD>
<P>Write data size for sub-double-word transactions, used in conjunction with the word pointer (wdptr) bit&#8212;see Table 4-4 and Section 3.5. For writes greater than one double-word, the size is the maximum payload that should be expected by the receiver. </P>
</TD>
</TR>

<TR>
<TD>
<P>rsrv </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>srcTID </P>
</TD>

<TD>
<P>The packet&#8217;s transaction ID </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>The specific transaction within the format class to be performed by the recipient; also called type or ttype. </P>
</TD>
</TR>

<TR>
<TD>
<P>extended address </P>
</TD>

<TD>
<P>Optional. Specifies the most significant 16 bits of a 50-bit physical address or 32 bits of a 66-bit physical address. </P>
</TD>
</TR>

<TR>
<TD>
<P>xamsbs </P>
</TD>

<TD>
<P>Extended address most significant bits. Further extends the address specified by the address and extended address fields by 2 bits. This field provides 34-, 50-, and 66-bit addresses to be specified in a packet with the xamsbs as the most significant bits in the address. </P>
</TD>
</TR>

<TR>
<TD>
<P>address </P>
</TD>

<TD>
<P>Bits [0-28] of byte address [0-31] of the double-word physical address </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P>Table 4-3. Read Size (rdsize) Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>wdptr </P>
</TD>

<TD>
<P> </P>

<P>rdsize </P>
</TD>

<TD>
<P>Number of </P>

<P>Bytes </P>
</TD>

<TD>
<P> </P>

<P>Byte Lanes </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b10000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b01000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00100000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00010000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00001000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000010 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000001 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b11000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0b11100000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00110000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0b11111000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00001100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0b00000111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00000011 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0b00011111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0b11110000 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-3. Read Size (rdsize) Definitions (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>wdptr </P>
</TD>

<TD>
<P> </P>

<P>rdsize </P>
</TD>

<TD>
<P>Number of </P>

<P>Bytes </P>
</TD>

<TD>
<P> </P>

<P>Byte Lanes </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0b00001111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0b11111100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0b00111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0b11111110 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0b01111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>0b11111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>16 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>32 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>64 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1101 </P>
</TD>

<TD>
<P>96 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1101 </P>
</TD>

<TD>
<P>128 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>160 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>192 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>224 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>256 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 4-4. Write Size (wrsize) Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>wdptr </P>
</TD>

<TD>
<P> </P>

<P>wrsize </P>
</TD>

<TD>
<P>Number of </P>

<P>Bytes </P>
</TD>

<TD>
<P> </P>

<P>Byte Lanes </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b10000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b01000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00100000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00010000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00001000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000010 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000001 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b11000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0b11100000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00110000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0b11111000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00001100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0b00000111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00000011 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0b00011111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0b11110000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0b00001111 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-4. Write Size (wrsize) Definitions (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>wdptr </P>
</TD>

<TD>
<P> </P>

<P>wrsize </P>
</TD>

<TD>
<P>Number of </P>

<P>Bytes </P>
</TD>

<TD>
<P> </P>

<P>Byte Lanes </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0b11111100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0b00111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0b11111110 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0b01111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>0b11111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>16 maximum </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>32 maximum </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>64 maximum </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>00b </P>
</TD>

<TD>
<P>0b1101 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1101 </P>
</TD>

<TD>
<P>128 maximum </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>256 maximum </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.1.3  Type 0 Packet Format (Implementation-Defined) </P>

<P> </P>

<P>The type 0 packet format is reserved for implementation-defined functions such as flow control. </P>

<P> </P>

<P> </P>

<P>4.1.4  Type 1 Packet Format (Reserved) </P>

<P> </P>

<P>The type 1 packet format is reserved. </P>

<P> </P>

<P> </P>

<P>4.1.5  Type 2 Packet Format (Request Class) </P>

<P> </P>

<P>The type 2 format is used for the NREAD and ATOMIC transactions as specified in the transaction field defined in Table 4-5. Type 2 packets never contain a data payload. </P>

<P> </P>

<P>The data payload size for the response to an ATOMIC transaction is 8 bytes. The addressing scheme defined for the read portion of the ATOMIC transaction also controls the size of the atomic operation in memory so the bytes shall be contiguous and shall be of size byte, half-word (2 bytes), or word (4 bytes), and be aligned to that boundary and byte lane as with a regular read transaction. Double-word (8-byte), 3, 5, 6, and 7 byte ATOMIC transactions are not allowed. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Note that type 2 packets don&#8217;t have any special fields. </P>

<P>Table 4-5. Transaction Fields and Encodings for Type 2 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Transaction Field </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0000&#8211;0011 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>NREAD transaction </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0101&#8211;1011 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>ATOMIC inc: post-increment the data </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1101 </P>
</TD>

<TD>
<P>ATOMIC dec: post-decrement the data </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>ATOMIC set: set the data (write 0b11111...&#8217;) </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>ATOMIC clr: clear the data (write 0b00000...&#8217;) </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 4-1 displays the type 2 packet with all its fields. The field value 0b0010 in </P>

<P>Figure 4-1 specifies that the packet format is of type 2. </P>

<P> </P>

<P>0 0 1 0 </P>

<P>transaction rdsize srcTID </P>

<P> </P>

<P>4 4 4 8 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>extended address </P>
</TD>

<TD>
<P>address </P>
</TD>

<TD>
<P>wdptr </P>
</TD>

<TD>
<P>xamsbs </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_32.jpg"/>
</Figure>

<P>0, 16, 32 </P>

<P>29 1 2 </P>

<P> </P>

<P>Figure 4-1. Type 2 Packet Bit Stream Format </P>

<P> </P>

<P> </P>

<P>4.1.6  Type 3&#8211;4 Packet Formats (Reserved) </P>

<P> </P>

<P>The type 3&#8211;4 packet formats are reserved. </P>

<P> </P>

<P> </P>

<P>4.1.7  Type 5 Packet Format (Write Class) </P>

<P> </P>

<P>Type 5 packets always contain a data payload. A data payload that consists of a single double-word or less has sizing information as defined in Table 4-4. The wrsize  field  specifies  the  maximum  size  of  the  data  payload  for  multiple double-word transactions. The data payload may not exceed that size but may be smaller if desired. The ATOMIC, NWRITE, and NWRITE_R transactions use the type 5 format as defined in Table 4-6. NWRITE request packets do not require a response. Therefore, the transaction ID (srcTID) field for a NWRITE request is undefined and may have an arbitrary value. </P>

<P> </P>

<P>The ATOMIC test-and-swap transaction is limited to one double-word (8 bytes) of data payload. The addressing scheme defined for the write transactions also controls the size of the atomic operation in memory so the bytes shall be contiguous and shall be of size byte, half-word (2 bytes), or word (4 bytes), and be aligned to that boundary and byte lane as with a regular write transaction. Double-word (8-byte) and 3, 5, 6, and 7 byte ATOMIC test-and-swap transactions are not allowed. </P>

<P> </P>

<P>The ATOMIC swap transaction has the same addressing scheme and data payload </P>

<P> </P>

<P>36 RapidIO Trade Association </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>restrictions as the ATOMIC test-and-swap transaction. </P>

<P> </P>

<P>The ATOMIC compare-and-swap operation is different from the other ATOMIC </P>

<P>operations in that it requires two double-words (16 bytes) of data payload. </P>

<P> </P>

<P>Note that type 5 packets don&#8217;t have any special fields. </P>

<P>Table 4-6. Transaction Fields and Encodings for Type 5 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Transaction Field </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0000&#8211;0011 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>NWRITE transaction </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>NWRITE_R transaction </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0110&#8211;1011 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>ATOMIC swap: read and return the data, unconditionally write with supplied data. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1101 </P>
</TD>

<TD>
<P>ATOMIC compare-and-swap: read and return the data, if the read data is equal to the first 8 bytes of data payload, write the second 8 bytes of data to the memory location. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>ATOMIC test-and-swap: read and return the data, compare to 0, write with supplied data if compare is true </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 4-2 displays the type 5 packet with all its fields. The field value 0b0101 in </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_33.jpg"/>
</Figure>

<P>Figure 4-2 specifies that the packet format is of type 5. </P>

<P> </P>

<P> </P>

<P>0 1 0 1 </P>

<P>transaction wrsize srcTID </P>

<P> </P>

<P>4 4 4 8 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_34.jpg"/>
</Figure>

<P>extended address </P>

<P> </P>

<P>0, 16, 32 </P>

<P>address </P>

<P> </P>

<P>29 </P>

<P>wdptr  xamsbs </P>

<P> </P>

<P>1 2 </P>

<P> </P>

<P> </P>

<P>double-word 0 </P>

<P> </P>

<P>64 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_35.jpg"/>
</Figure>

<P>&#8226;  &#8226; &#8226; </P>

<P>double-word 1 </P>

<P> </P>

<P>64 </P>

<P> </P>

<P>double-word n </P>

<P> </P>

<P>64 </P>

<P> </P>

<P>Figure 4-2. Type 5 Packet Bit Stream Format </P>

<P> </P>

<P> </P>

<P>4.1.8  Type 6 Packet Format (Streaming-Write Class) </P>

<P> </P>

<P>The type 6 packet is a special-purpose type that always contains data. The data payload    always    contains    a    minimum    of    one    complete    double-word. Sub-double-word data payloads shall use the type 5 NWRITE transaction. Type 6 transactions may contain any number of double-words up to the maximum defined in Table 4-4. </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 37 </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Because the SWRITE transaction is the only transaction to use format type 6, there is no need for the transaction field within the packet. There are also no size or transaction ID fields. </P>

<P> </P>

<P>Figure 4-3 displays the type 6 packet with all its fields. The field value 0b0110 in </P>

<P>Figure 4-3 specifies that the packet format is of type 6. </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0 1 1 0 </P>
</TD>

<TD>
<P>extended address </P>
</TD>

<TD>
<P>address </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>xamsbs </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>0, 16, 32 </P>
</TD>

<TD>
<P>29 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>double-word 0 </P>

<P>64 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_36.jpg"/>
</Figure>

<P>&#8226; &#8226;  &#8226; </P>

<P>double-word 1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_37.jpg"/>
</Figure>

<P>64 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_38.jpg"/>
</Figure>

<P>double-word n </P>

<P>64 </P>

<P> </P>

<P>Figure 4-3. Type 6 Packet Bit Stream Format </P>

<P> </P>

<P> </P>

<P>4.1.9  Type 7 Packet Format (Reserved) </P>

<P> </P>

<P>The type 7 packet format is reserved. </P>

<P> </P>

<P> </P>

<P>4.1.10  Type 8 Packet Format (Maintenance Class) </P>

<P> </P>

<P>The type 8 MAINTENANCE packet format is used to access the RapidIO capability and status registers (CARs and CSRs) and data structures. Unlike other request formats, the type 8 packet format serves as both the request and the response format for maintenance operations. Type 8 packets contain no addresses and only contain data payloads for write requests and read responses. All configuration register read accesses are performed in word (4-byte), and optionally double-word (8-byte) or specifiable multiple double-word quantities up to a limit of 64 bytes. All register write accesses are also performed in word (4-byte), and optionally double-word (8-byte) or multiple double-word quantities up to a limit of 64 bytes. </P>

<P> </P>

<P>Read and write data sizes are specified as shown in Table 4-3 and Table 4-4. The wrsize  field  specifies  the  maximum  size  of  the  data  payload  for  multiple double-word transactions. The data payload may not exceed that size but may be smaller if desired. Both the maintenance read and the maintenance write request generate the appropriate maintenance response. Maintenance read responses with a status of ERROR may optionally include data in the response. </P>

<P> </P>

<P>The maintenance port-write operation is a write operation that does not have guaranteed delivery and does not have an associated response. This maintenance operation is useful for sending messages such as error indicators or status information from a device that does not contain an end point, such as a switch. The data payload is typically placed in a queue in the targeted end point and an interrupt is typically generated to a local processor. A port-write request to a queue that is full </P>

<P> </P>

<P>38 RapidIO Trade Association </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>or busy servicing another request may be discarded. </P>

<P> </P>

<P>Definitions and encodings of fields specific to type 8 packets are provided in </P>

<P>Table 4-7. Fields that are not specific to type 8 packets are described in Table 4-2. </P>

<P> </P>

<P>Table 4-7. Specific Field Definitions and Encodings for Type 8 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Type 8 Fields </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>Specifies a maintenance read request </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>Specifies a maintenance write request </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>Specifies a maintenance read response </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>Specifies a maintenance write response </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>Specifies a maintenance port-write request </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0101&#8211;1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>config_offset </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Double-word offset into the CAR/CSR register block for reads and writes </P>
</TD>
</TR>

<TR>
<TD>
<P>srcTID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>The type 8 request packet&#8217;s transaction ID (reserved for port-write requests) </P>
</TD>
</TR>

<TR>
<TD>
<P>targetTID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>The corresponding type 8 response packet&#8217;s transaction ID </P>
</TD>
</TR>

<TR>
<TD>
<P>status </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>DONE&#8212;Requested transaction has completed successfully </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001&#8211;0110 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>ERROR&#8212;Unrecoverable error detected </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1000&#8211;1011 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1100&#8211;1111 </P>
</TD>

<TD>
<P>Implementation-defined&#8212;Can be used for additional information such as an error code </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_39.jpg"/>
</Figure>

<P>Figure 4-4 displays a type 8 request (read or write) packet with all its fields. The field value 0b1000 in Figure 4-4 specifies that the packet format is of type 8. The srcTID and config_offset fields are reserved for port-write requests. </P>

<P> </P>

<P>1 0 0 0 </P>

<P>transaction    rdsize/wrsize srcTID </P>

<P> </P>

<P>4 4 4 8 </P>

<P> </P>

<P> </P>

<P>config_offset </P>

<P> </P>

<P>21 </P>

<P>wdptr rsrv </P>

<P>1 2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_40.jpg"/>
</Figure>

<P>&#8226; &#8226; &#8226; </P>

<P>double-word 0 </P>

<P>64 </P>

<P> </P>

<P>double-word n </P>

<P>64 </P>

<P> </P>

<P>Figure 4-4. Type 8 Request Packet Bit Stream Format </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_41.jpg"/>
</Figure>

<P>Figure 4-5 displays a type 8 response packet with all its fields. </P>

<P> </P>

<P> </P>

<P>1 0 0 0 </P>

<P>transaction status targetTID </P>

<P> </P>

<P>4 4 4 8 </P>

<P> </P>

<P> </P>

<P>reserved </P>

<P> </P>

<P>24 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_42.jpg"/>
</Figure>

<P>&#8226;  &#8226; &#8226; </P>

<P>double-word 0 </P>

<P>64 </P>

<P> </P>

<P>double-word n </P>

<P> </P>

<P>64 </P>

<P> </P>

<P>Figure 4-5. Type 8 Response Packet Bit Stream Format </P>

<P> </P>

<P> </P>

<P>4.1.11  Type 9&#8211;11 Packet Formats (Reserved) </P>

<P> </P>

<P>The type 9&#8211;11 packet formats are reserved. </P>

<P> </P>

<P> </P>

<P>4.2 Response Packet Formats </P>

<P> </P>

<P>A response transaction is issued by a processing element when it has completed a request made to it by a remote processing element. Response packets are always directed and are transmitted in the same way as request packets. Currently two packet format types exist, as shown in Table 4-8. </P>

<P>Table 4-8. Response Packet Type to Transaction Type Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Response Packet </P>

<P>Format Type </P>
</TD>

<TD>
<P> </P>

<P>Transaction Type </P>
</TD>

<TD>
<P> </P>

<P>Definition </P>
</TD>

<TD>
<P>Document Section </P>

<P>Number </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 12 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.2.2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 13 </P>
</TD>

<TD>
<P>RESPONSE </P>
</TD>

<TD>
<P>Issued by a processing element when it completes a request by a remote element. </P>
</TD>

<TD>
<P>Section 4.2.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 14 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.2.4 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>Type 15 </P>
</TD>

<TD>
<P>Implementation-&#61472;&#61472;</P>

<P>defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>

<TD>
<P> </P>

<P>Section 4.2.5 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.2.1  Field Definitions for All Response Packet Formats </P>

<P> </P>

<P>The field definitions in Table 4-9 apply to more than one of the response packet formats. </P>

<P>Table 4-9. Field Definitions and Encodings for All Response Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Sub-Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>RESPONSE transaction with no data payload </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001&#8211;0111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>RESPONSE transaction with data payload </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1001&#8211;1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-9. Field Definitions and Encodings for All Response Packets (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>targetTID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>The corresponding request packet&#8217;s transaction ID </P>
</TD>
</TR>

<TR>
<TD>
<P>status </P>
</TD>

<TD>
<P>Type of status and encoding </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>DONE </P>
</TD>

<TD>
<P>Requested transaction has been successfully completed </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001&#8211;0110 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>ERROR </P>
</TD>

<TD>
<P>Unrecoverable error detected </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1000&#8211;1011 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1100&#8211;1111 </P>
</TD>

<TD>
<P>Implementation </P>
</TD>

<TD>
<P>Implementation defined&#8212;Can be used for additional information such as an error code </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.2.2  Type 12 Packet Format (Reserved) </P>

<P> </P>

<P>The type 12 packet format is reserved. </P>

<P> </P>

<P> </P>

<P>4.2.3  Type 13 Packet Format (Response Class) </P>

<P> </P>

<P>The type 13 packet format returns status, data (if required), and the requestor&#8217;s transaction ID. A RESPONSE packet with an &#8220;ERROR&#8221; status or a response that is not expected to have a data payload never has a data payload. The type 13 format is used  for  response  packets  to  all  request  packets  except  maintenance  and response-less writes. </P>

<P> </P>

<P>Note that type 13 packets do not have any special fields. </P>

<P> </P>

<P>When a RESPONSE packet is generated with an &#8220;ERROR&#8221; status, the Transaction field value may be 0 (RESPONSE transaction with no data) or 8 (RESPONSE transaction with data). In both cases, the RESPONSE packet with an &#8220;ERROR&#8221; status has no data payload. Processing elements which accept RESPONSE packets with an &#8220;ERROR&#8221; status shall accept Transaction field values of 0 (RESPONSE transaction with no data) and 8 (RESPONSE transaction with data). </P>

<P> </P>

<P>Figure 4-6 illustrates the format and fields of type 13 packets. The field value </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_43.jpg"/>
</Figure>

<P>0b1101 in Figure 4-6 specifies that the packet format is of type 13. </P>

<P> </P>

<P> </P>

<P>1 1 0 1 </P>

<P>transaction status targetTID </P>

<P> </P>

<P>4 4 4 8 </P>

<P> </P>

<P> </P>

<P>double-word 0 </P>

<P>64 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_44.jpg"/>
</Figure>

<P>&#8226; &#8226;  &#8226; </P>

<P>double-word 1 </P>

<P>64 </P>

<P> </P>

<P>double-word n </P>

<P>64 </P>

<P> </P>

<P>Figure 4-6. Type 13 Packet Bit Stream Format </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.2.4  Type 14 Packet Format (Reserved) </P>

<P> </P>

<P>The type 14 packet format is reserved. </P>

<P> </P>

<P> </P>

<P>4.2.5  Type 15 Packet Format (Implementation-Defined) </P>

<P> </P>

<P>The type 15 packet format is reserved for implementation-defined functions such as flow control. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 Input/Output Registers </P>

<P> </P>

<P>This chapter describes the visible register set that allows an external processing element to determine the capabilities, configuration, and status of a processing element using this logical specification. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and  bit  definitions. All  registers are  32-bits and  aligned to  a  32-bit boundary. </P>

<P> </P>

<P> </P>

<P>5.1 Register Summary </P>

<P> </P>

<P>Table 5-1 shows the register map for this RapidIO specification. These capability registers (CARs) and command and status registers (CSRs) can be accessed using RapidIO maintenance operations. Any register offsets not defined are considered reserved for this specification unless otherwise stated. Other registers required for a processing element are defined in other applicable RapidIO specifications and by the requirements of the specific device and are beyond the scope of this specification. Read and write accesses to reserved register offsets shall terminate normally and not cause an error condition in the target device. Writes to CAR (read-only) space shall terminate normally and not cause an error condition in the target device. </P>

<P> </P>

<P>Register bits defined as reserved are considered reserved for this specification only. Bits that are reserved in this specification may be defined in another RapidIO specification. </P>

<P> </P>

<P>Table 5-1. I/O Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0 </P>
</TD>

<TD>
<P>Device Identity CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x4 </P>
</TD>

<TD>
<P>Device Information CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x8 </P>
</TD>

<TD>
<P>Assembly Identity CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0xC </P>
</TD>

<TD>
<P>Assembly Information CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10 </P>
</TD>

<TD>
<P>Processing Element Features CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x14 </P>
</TD>

<TD>
<P>Switch Port Information CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x18 </P>
</TD>

<TD>
<P>Source Operations CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x1C </P>
</TD>

<TD>
<P>Destination Operations CAR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-1. I/O Register Map (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x20&#8211;48 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x4C </P>
</TD>

<TD>
<P>Processing Element Logical Layer Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x50 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Local Configuration Space Base Address 0 CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Local Configuration Space Base Address 1 CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x60&#8211;FC </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P> </P>

<P>Extended Features Space </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P> </P>

<P>Implementation-defined Space </P>
</TD>
</TR>
</Table>

<P> </P>

<P>5.2 Reserved Register, Bit and Bit Field Value Behavior </P>

<P> </P>

<P>Table 5-2 describes the required behavior for accesses to reserved register bits and reserved registers for the RapidIO register space, </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0&#8211;3C </P>
</TD>

<TD>
<P>Capability Register Space (CAR Space - this space is read-only) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value1 </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x40&#8211;FC </P>
</TD>

<TD>
<P>Command and Status Register Space (CSR Space) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value2 </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P>Extended Features Space </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P>Implementation-defined </P>

<P>Space </P>
</TD>

<TD>
<P>Reserved bit and register </P>
</TD>

<TD>
<P>All behavior implementation-defined </P>
</TD>
</TR>
</Table>

<P>1Do not depend on reserved bits being a particular value; use appropriate masks to extract defined bits from the read value. </P>

<P>2All register writes shall be in the form: read the register to obtain the values of all reserved bits, merge in the desired values for defined bits to be modified, and write the register, thus preserving the value of all reserved bits. </P>

<P> </P>

<P>When a writable bit field is set to a reserved value, device behavior is implementation specific. </P>

<P> </P>

<P> </P>

<P>5.3 Extended Features Data Structure </P>

<P> </P>

<P>The RapidIO capability and command and status registers implement an extended capability data structure. If the extended features bit (bit 28) in the processing element features register is set, the extended features pointer is valid and points to the first entry in the extended features data structure. This pointer is an offset into the standard 16 Mbyte capability register (CAR) and command and status register (CSR) space and is accessed with a maintenance read operation in the same way as when accessing CARs and CSRs. </P>

<P> </P>

<P>The extended features data structure is a singly linked list of double-word structures. Each of these contains a pointer to the next structure (EF_PTR) and an extended feature type identifier (EF_ID). The end of the list is determined when the next extended feature pointer has a value of logic 0. All pointers and extended features blocks shall index completely into the extended features space of the CSR space, and all shall be aligned to a double-word boundary so the three least significant bits shall equal logic 0. Pointer values not in extended features space or improperly aligned are illegal and shall be treated as the end of the data structure. Figure 5-1 shows an example of an extended features data structure. It is required that the extended features bit is set to logic 1 in the processing element features register. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>ExtendedFeaturesPtr </P>

<P> </P>

<P> </P>

<P>0 15  16 31  32 </P>

<P>47  48 63 </P>

<P>NextExtendedFeaturePtr </P>

<P>ExtendedFeatureID </P>

<P>reserved </P>

<P>reserved </P>

<P> </P>

<P> </P>

<P>0 15  16 31  32 </P>

<P>47  48 63 </P>

<P>NextExtendedFeaturePtr </P>

<P>ExtendedFeatureID </P>

<P>reserved </P>

<P>reserved </P>

<P> </P>

<P> </P>

<P>0 15  16 31  32 </P>

<P>47  48 63 </P>

<Table>
<TR>
<TD>
<P>0b0000000000000000 </P>
</TD>

<TD>
<P>ExtendedFeatureID </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>reserved </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_45.jpg"/>
</Figure>

<P>Figure 5-1. Example Extended Features Data Structure </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4 Capability Registers (CARs) </P>

<P> </P>

<P>Every processing element shall contain a set of registers that allows an external processing element to determine its capabilities through maintenance read operations. All registers are 32 bits wide and are organized and accessed in 32-bit (4 byte) quantities, although some processing elements may optionally allow larger accesses. CARs are read-only. Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>CARs are big-endian with bit 0 the most significant bit. </P>

<P> </P>

<P> </P>

<P>5.4.1  Device Identity CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x0) </P>

<P> </P>

<P>The DeviceVendorIdentity field identifies the vendor that manufactured the device containing the processing element. A value for the DeviceVendorIdentity field is uniquely assigned to a device vendor by the registration authority of the RapidIO Trade Association. </P>

<P> </P>

<P>The DeviceIdentity field is intended to uniquely identify the type of device from the vendor specified by the DeviceVendorIdentity field. The values for the DeviceIdentity field are assigned and managed by the respective vendor. See Table 5-3. </P>

<P>Table 5-3. Bit Settings for Device Identity CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;15 </P>
</TD>

<TD>
<P>DeviceIdentity </P>
</TD>

<TD>
<P>Device identifier </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;31 </P>
</TD>

<TD>
<P>DeviceVendorIdentity </P>
</TD>

<TD>
<P>Device vendor identifier </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.2  Device Information CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x4) </P>

<P> </P>

<P>The DeviceRev field is intended to identify the revision level of the device. The value for the DeviceRev field is assigned and managed by the vendor specified by the DeviceVendorIdentity field. See Table 5-4. </P>

<P>Table 5-4. Bit Settings for Device Information CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-31 </P>
</TD>

<TD>
<P>DeviceRev </P>
</TD>

<TD>
<P>Device revision level </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.3  Assembly Identity CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x8) </P>

<P> </P>

<P>The AssyVendorIdentity field identifies the vendor that manufactured the assembly or subsystem containing the device. A value for the AssyVendorIdentity field is uniquely assigned to a assembly vendor by the registration authority of the RapidIO Trade Association. </P>

<P> </P>

<P>The AssyIdentity field is intended to uniquely identify the type of assembly from the vendor specified by the AssyVendorIdentity field. The values for the AssyIdentity field are assigned and managed by the respective vendor. See Table 5-5. </P>

<P>Table 5-5. Bit Settings for Assembly Identity CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;15 </P>
</TD>

<TD>
<P>AssyIdentity </P>
</TD>

<TD>
<P>Assembly identifier </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;31 </P>
</TD>

<TD>
<P>AssyVendorIdentity </P>
</TD>

<TD>
<P>Assembly vendor identifier </P>
</TD>
</TR>
</Table>

<P> </P>

<P>If the value of the AssyIdentity and/or AssyVendorIdentity field is not uniquely known at the time of device fabrication, such field shall be writable through a path and mechanism independent from RapidIO and shall be written with the appropriate value before the register can be accessed through RapidIO.  The means for setting the values of these fields is independent of RapidIO and are outside the scope of this specification. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.4  Assembly Information CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0xC) </P>

<P> </P>

<P>This register contains additional information about the assembly; see Table 5-6 </P>

<P>Table 5-6. Bit Settings for Assembly Information CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;15 </P>
</TD>

<TD>
<P>AssyRev </P>
</TD>

<TD>
<P>Assembly revision level </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;31 </P>
</TD>

<TD>
<P>ExtendedFeaturesPtr </P>
</TD>

<TD>
<P>Pointer to the first entry in the extended features list </P>
</TD>
</TR>
</Table>

<P> </P>

<P>If the value of the AssyRev field is not uniquely known at the time of device fabrication, such field shall be writable through a path and mechanism independent from RapidIO and shall be written with the appropriate value before the register can be accessed through RapidIO.  The means for setting the values of this field is independent of RapidIO and are outside the scope of this specification. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.5  Processing Element Features CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x10) </P>

<P> </P>

<P>This register identifies the major functionality provided by the processing element; </P>

<P>see Table 5-7. </P>

<P>Table 5-7. Bit Settings for Processing Element Features CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Bridge </P>
</TD>

<TD>
<P>PE can bridge to another interface. Examples are PCI, proprietary processor buses, DRAM, etc. </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Memory </P>
</TD>

<TD>
<P>PE has physically addressable local address space and can be accessed as an end point through non-maintenance (i.e. non-coherent read and write) operations. This local address space may be limited to local configuration registers, or could be </P>

<P>on-chip SRAM, etc. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Processor </P>
</TD>

<TD>
<P>PE physically contains a local processor or similar device that executes code. A device that bridges to an interface that connects to a processor does not count (see bit 0 above). </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Switch </P>
</TD>

<TD>
<P>PE can bridge to another external RapidIO interface - an internal port to a local end point does not count as a switch port. For example, a device with two RapidIO ports and a local end point is a two port switch, not a three port switch, regardless of the internal architecture. </P>
</TD>
</TR>

<TR>
<TD>
<P>4&#8211;27 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Extended features </P>
</TD>

<TD>
<P>PE has extended features list; the extended features pointer is valid </P>
</TD>
</TR>

<TR>
<TD>
<P>29-31 </P>
</TD>

<TD>
<P>Extended addressing support </P>
</TD>

<TD>
<P>Indicates the number address bits supported by the PE both as a source and target of an operation. All PEs shall at minimum support 34 bit addresses. </P>

<P>0b111 - PE supports 66, 50, and 34 bit addresses&#61472;&#61472;</P>

<P>0b101 - PE supports 66 and 34 bit addresses&#61472;&#61472;</P>

<P>0b011 - PE supports 50 and 34 bit addresses&#61472;&#61472;</P>

<P>0b001 - PE supports 34 bit addresses </P>

<P>All other encodings reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.6  Switch Port Information CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x14) </P>

<P> </P>

<P>This register defines the switching capabilities of a processing element. This register is only valid if bit 3 is set in the processing element features CAR; see Table 5-8. </P>

<P> </P>

<P>Table 5-8. Bit Settings for Switch Port Information CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;15 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;23 </P>
</TD>

<TD>
<P>PortTotal </P>
</TD>

<TD>
<P>The maximum number of external RapidIO ports on the processing element </P>

<P>0b00000000 - Reserved&#61472;&#61472;</P>

<P>0b00000001 - Reserved&#61472;&#61472;</P>

<P>0b00000010 - 2 ports&#61472;&#61472;</P>

<P>0b00000011 - 3 ports&#61472;&#61472;</P>

<P>0b00000100 - 4 ports&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0b11111111 - 255 ports </P>
</TD>
</TR>

<TR>
<TD>
<P>24&#8211;31 </P>
</TD>

<TD>
<P>PortNumber </P>
</TD>

<TD>
<P>This is the external port number from which the maintenance read operation accessed this register. Ports are numbered starting with 0x00. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.7  Source Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x18) </P>

<P> </P>

<P>This register defines the set of RapidIO IO logical operations that can be issued by this processing element; see Table 5-9. It is assumed that a processing element can generate I/O logical maintenance read and write requests if it is required to access CARs and CSRs in other processing elements. For devices that have only switch functionality only bit 29 is valid. RapidIO switches shall be able to route any packet. </P>

<P>Table 5-9. Bit Settings for Source Operations CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14&#8211;15 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>Read </P>
</TD>

<TD>
<P>PE can support a read operation </P>
</TD>
</TR>

<TR>
<TD>
<P>17 </P>
</TD>

<TD>
<P>Write </P>
</TD>

<TD>
<P>PE can support a write operation </P>
</TD>
</TR>

<TR>
<TD>
<P>18 </P>
</TD>

<TD>
<P>Streaming-write </P>
</TD>

<TD>
<P>PE can support a streaming-write operation </P>
</TD>
</TR>

<TR>
<TD>
<P>19 </P>
</TD>

<TD>
<P>Write-with-response </P>
</TD>

<TD>
<P>PE can support a write-with-response operation </P>
</TD>
</TR>

<TR>
<TD>
<P>20-21 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>22 </P>
</TD>

<TD>
<P>Atomic (compare-and-swap) </P>
</TD>

<TD>
<P>PE can support an atomic compare-and-swap operation </P>
</TD>
</TR>

<TR>
<TD>
<P>23 </P>
</TD>

<TD>
<P>Atomic (test-and-swap) </P>
</TD>

<TD>
<P>PE can support an atomic test-and-swap operation </P>
</TD>
</TR>

<TR>
<TD>
<P>24 </P>
</TD>

<TD>
<P>Atomic (increment) </P>
</TD>

<TD>
<P>PE can support an atomic increment operation </P>
</TD>
</TR>

<TR>
<TD>
<P>25 </P>
</TD>

<TD>
<P>Atomic (decrement) </P>
</TD>

<TD>
<P>PE can support an atomic decrement operation </P>
</TD>
</TR>

<TR>
<TD>
<P>26 </P>
</TD>

<TD>
<P>Atomic (set) </P>
</TD>

<TD>
<P>PE can support an atomic set operation </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Atomic (clear) </P>
</TD>

<TD>
<P>PE can support an atomic clear operation </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Atomic (swap) </P>
</TD>

<TD>
<P>PE can support an atomic swap operation </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Port-write </P>
</TD>

<TD>
<P>PE can support a port-write operation </P>
</TD>
</TR>

<TR>
<TD>
<P>30&#8211;31 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.8  Destination Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x1C) </P>

<P> </P>

<P>This register defines the set of RapidIO I/O operations that can be supported by this processing element; see Table 5-10. It is required that all processing elements can respond to maintenance read and write requests in order to access these registers. The Destination Operations CAR is applicable for end point devices only. RapidIO switches shall be able to route any packet. </P>

<P>Table 5-10. Bit Settings for Destination Operations CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14-15 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>Read </P>
</TD>

<TD>
<P>PE can support a read operation </P>
</TD>
</TR>

<TR>
<TD>
<P>17 </P>
</TD>

<TD>
<P>Write </P>
</TD>

<TD>
<P>PE can support a write operation </P>
</TD>
</TR>

<TR>
<TD>
<P>18 </P>
</TD>

<TD>
<P>Streaming-write </P>
</TD>

<TD>
<P>PE can support a streaming-write operation </P>
</TD>
</TR>

<TR>
<TD>
<P>19 </P>
</TD>

<TD>
<P>Write-with-response </P>
</TD>

<TD>
<P>PE can support a write-with-response operation </P>
</TD>
</TR>

<TR>
<TD>
<P>20-21 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>22 </P>
</TD>

<TD>
<P>Atomic (compare-and-swap) </P>
</TD>

<TD>
<P>PE can support an atomic compare-and-swap operation </P>
</TD>
</TR>

<TR>
<TD>
<P>23 </P>
</TD>

<TD>
<P>Atomic (test-and-swap) </P>
</TD>

<TD>
<P>PE can support an atomic test-and-swap operation </P>
</TD>
</TR>

<TR>
<TD>
<P>24 </P>
</TD>

<TD>
<P>Atomic (increment) </P>
</TD>

<TD>
<P>PE can support an atomic increment operation </P>
</TD>
</TR>

<TR>
<TD>
<P>25 </P>
</TD>

<TD>
<P>Atomic (decrement) </P>
</TD>

<TD>
<P>PE can support an atomic decrement operation </P>
</TD>
</TR>

<TR>
<TD>
<P>26 </P>
</TD>

<TD>
<P>Atomic (set) </P>
</TD>

<TD>
<P>PE can support an atomic set operation </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Atomic (clear) </P>
</TD>

<TD>
<P>PE can support an atomic clear operation </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Atomic (swap) </P>
</TD>

<TD>
<P>PE can support an atomic swap operation </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Port-write </P>
</TD>

<TD>
<P>PE can support a port-write operation </P>
</TD>
</TR>

<TR>
<TD>
<P>30-31 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.5 Command and Status Registers (CSRs) </P>

<P> </P>

<P>A processing element shall contain a set of command and status registers (CSRs) that allows an external processing element to control and determine the status of its internal hardware. All registers are 32 bits wide and are organized and accessed in the same way as the CARs. Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P> </P>

<P>5.5.1  Processing Element Logical Layer Control CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x4C) </P>

<P> </P>

<P>The Processing Element Logical Layer Control CSR is used for general command and status information for the logical interface. </P>

<P>Table 5-11. Bit Settings for Processing Element Logical Layer Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;28 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>29-31 </P>
</TD>

<TD>
<P>Extended addressing control </P>
</TD>

<TD>
<P>Controls the number of address bits generated by the PE as a source and processed by the PE as the target of an operation. </P>

<P>0b100 - PE supports 66 bit addresses&#61472;&#61472;</P>

<P>0b010 - PE supports 50 bit addresses&#61472;&#61472;</P>

<P>0b001 - PE supports 34 bit addresses (default) All other encodings reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.2  Local Configuration Space Base Address 0 CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x58) </P>

<P> </P>

<P>The local configuration space base address 0 register specifies the most significant bits of the local physical address double-word offset for the processing element&#8217;s configuration register space. See Section 5.5.3 below for a detailed description. </P>

<P>Table 5-12. Bit Settings for Local Configuration Space Base Address 0 CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>1-16 </P>
</TD>

<TD>
<P>LCSBA </P>
</TD>

<TD>
<P>Reserved for a 34-bit local physical address&#61472; Reserved for a 50-bit local physical address&#61472; Bits 0-15 of a 66-bit local physical address </P>
</TD>
</TR>

<TR>
<TD>
<P>17-31 </P>
</TD>

<TD>
<P>LCSBA </P>
</TD>

<TD>
<P>Reserved for a 34-bit local physical address&#61472; Bits 0-14 of a 50-bit local physical address&#61472; Bits 16-30 of a 66-bit local physical address </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.3  Local Configuration Space Base Address 1 CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x5C) </P>

<P> </P>

<P>The local configuration space base address 1 register specifies the least significant bits of the local physical address double-word offset for the processing element&#8217;s configuration register space, allowing the configuration register space to be physically mapped in the processing element. This register allows configuration and maintenance of a processing element through regular read and write operations rather than maintenance operations. The double-word offset is right-justified in the register. </P>

<P>Table 5-13. Bit Settings for Local Configuration Space Base Address 1 CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>LCSBA </P>
</TD>

<TD>
<P>Reserved for a 34-bit local physical address&#61472;&#61472;</P>

<P>Bit 15 of a 50-bit local physical address&#61472;&#61472;</P>

<P>Bit 31 of a 66-bit local physical address </P>
</TD>
</TR>

<TR>
<TD>
<P>1-31 </P>
</TD>

<TD>
<P>LCSBA </P>
</TD>

<TD>
<P>Bits 0-30 of a 34-bit local physical address&#61472; Bits 16-46 of a 50-bit local physical address&#61472; Bits 32-62 of a 66-bit local physical address </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_46.jpg"/>
</Figure>

<P>A Agent. A processing element that provides services to a processor. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_47.jpg"/>
</Figure>

<P>B Big-endian. A byte-ordering method in memory where the address n of a word corresponds to the most significant byte. In an addressed memory word, the bytes are ordered (left to right) 0, 1, 2, 3, with 0 </P>

<P>being the most significant byte. </P>

<P> </P>

<P>Bridge. A processing element that connects one computer bus to another, allowing a processing element on one bus to access an processing element on the other. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_48.jpg"/>
</Figure>

<P>C Cache.  High-speed  memory  containing  recently  accessed  data  and/or instructions (subset of main memory) associated with a processor. </P>

<P> </P>

<P>Cache coherence. Caches are coherent if a processor performing a read from its cache is supplied with data corresponding to the most recent value written to memory or to another processor&#8217;s cache. In other words, a write operation to an address in the system is visible to all other caches in the system. </P>

<P> </P>

<P>Cache line. A contiguous block of data that is the standard memory access size for a processor within a system. </P>

<P> </P>

<P>Capability registers (CARs). A set of read-only registers that allows a processing element to determine another processing element&#8217;s capabilities. </P>

<P> </P>

<P>Command and status registers (CSRs). A set of registers that allows a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_49.jpg"/>
</Figure>

<P>D Deadlock. A situation in which two processing elements that are sharing resources prevent each other from accessing the resources, resulting in a halt of system operation. </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 59 </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Direct Memory Access (DMA). The process of accessing memory in a device by specifying the memory address directly. </P>

<P> </P>

<P>Double-word. An eight byte quantity, aligned on eight byte boundaries. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_50.jpg"/>
</Figure>

<P>E End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>End  point  device.  A  processing  element  which  contains  end  point functionality. </P>

<P> </P>

<P>End point free device. A processing element which does not contain end point functionality. </P>

<P> </P>

<P>Ethernet. A common local area network (LAN) technology. </P>

<P> </P>

<P>External  processing  element.  A  processing  element  other  than  the processing element in question. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_51.jpg"/>
</Figure>

<P>F Field or Field name. A sub-unit of a register, where bits in the register are named and defined. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_52.jpg"/>
</Figure>

<P>G Globally shared memory (GSM). Cache coherent system memory that can be shared between multiple processors in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_53.jpg"/>
</Figure>

<P>H Half-word. A two byte or 16 bit quantity, aligned on two byte boundaries. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_54.jpg"/>
</Figure>

<P>I Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P>I/O. Input-output. </P>

<P> </P>

<P> </P>

<P>L Little-endian. A byte-ordering method in memory where the address n of a word corresponds to the least significant byte. In an addressed memory word, the bytes are ordered (left to right) 3, 2, 1, 0, with 3 </P>

<P>being the most significant byte. </P>

<P> </P>

<P>Local memory. Memory associated with the processing element in question. </P>

<P> </P>

<P>LSB. Least significant byte. </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_55.jpg"/>
</Figure>

<P>M Message passing. An application programming model that allows processing elements to communicate via messages to mailboxes instead of via DMA or GSM. Message senders do not write to a memory address </P>

<P>in the receiver. </P>

<P> </P>

<P>MSB. Most significant byte. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_56.jpg"/>
</Figure>

<P>N Non-coherent. A transaction that does not participate in any system globally shared memory cache coherence mechanism. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_57.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_58.jpg"/>
</Figure>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>

<P>system. </P>

<P> </P>

<P>Peripheral component interface (PCI). A bus commonly used for connecting I/O devices in a system. </P>

<P> </P>

<P>Port-write. An address-less maintenance write operation. </P>

<P> </P>

<P>Priority. The relative importance of a transaction or packet; in most systems a higher priority transaction or packet will be serviced or transmitted before one of lower priority. </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P>Processor. The logic circuitry that responds to and processes the basic instructions that drive a computer. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_59.jpg"/>
</Figure>

<P>R Receiver. The RapidIO interface input port on a processing element. </P>

<P> </P>

<P>Remote memory. Memory associated with a processing element other than the processing element in question. </P>

<P> </P>

<P>ROM. Read-only memory. </P>

<P> </P>

<P> </P>

<P>S Sender. The RapidIO interface output port on a processing element. </P>

<P> </P>

<P>Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>SRAM. Static random access memory. </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on </P>

<P>RapidIO Part 1: Input/Output Logical Specification Rev. 2.2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_60.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P>Transaction request flow. A sequence of transactions between two processing elements that have a required completion order at the destination processing element. There are no ordering requirements between transaction request flows. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_61.jpg"/>
</Figure>

<P>W Word. A four byte or 32 bit quantity, aligned on four byte boundaries. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>62 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_62.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 2: Message Passing Logical Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_64.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.1 </P>
</TD>

<TD>
<P>First public release </P>
</TD>

<TD>
<P>03/08/2001 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.2 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>06/26/2002 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev 1.2 errata 1 as applicable, the following errata showings: </P>

<P>03-05-00006.001, 03-07-00001.001, 04-02-00001.002, 04-05-00001.002 and the following new features showings: </P>

<P>02-05-00013.001 </P>

<P>Converted to ISO-friendly templates; re-formatted </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Technical changes: errata showing: 10-08-00001.005, Consolidated Comments on 11-01-00000.000 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction............................................................................................................. 9 </P>

<P>1.2 Overview................................................................................................................. 9 </P>

<P>1.3 Features of the Message Passing Specification ...................................................... 9 </P>

<P>1.3.1 Functional Features............................................................................................. 9 </P>

<P>1.3.2 Physical Features .............................................................................................. 10 </P>

<P>1.3.3 Performance Features ....................................................................................... 10 </P>

<P>1.4 Contents ................................................................................................................ 10 </P>

<P>1.5 Terminology.......................................................................................................... 11 </P>

<P>1.6 Conventions .......................................................................................................... 11 </P>

<P> </P>

<P> </P>

<P>Chapter 2 System Models </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 13 </P>

<P>2.2 Processing Element Models .................................................................................. 13 </P>

<P>2.2.1 Processor-Memory Processing Element Model................................................ 13 </P>

<P>2.2.2 Integrated Processor-Memory Processing Element Model .............................. 14 </P>

<P>2.2.3 Memory-Only Processing Element Model ....................................................... 14 </P>

<P>2.2.4 Processor-Only Processing Element ................................................................. 15 </P>

<P>2.2.5 I/O Processing Element .................................................................................... 15 </P>

<P>2.2.6 Switch Processing Element............................................................................... 15 </P>

<P>2.3 Message Passing System Model ........................................................................... 16 </P>

<P>2.3.1 Data Message Operations ................................................................................. 17 </P>

<P>2.3.2 Doorbell Message Operations........................................................................... 18 </P>

<P>2.4 System Issues ........................................................................................................ 18 </P>

<P>2.4.1 Operation Ordering ........................................................................................... 18 </P>

<P>2.4.2 Transaction Delivery......................................................................................... 18 </P>

<P>2.4.3 Deadlock Considerations .................................................................................. 19 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Operation Descriptions </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 21 </P>

<P>3.2 Message Passing Operations Cross Reference ..................................................... 22 </P>

<P>3.3 Message Passing Operations................................................................................. 22 </P>

<P>3.3.1 Doorbell Operations.......................................................................................... 22 </P>

<P>3.3.2 Data Message Operations ................................................................................. 23 </P>

<P>3.4 Endian, Byte Ordering, and Alignment ................................................................ 24 </P>

<P> </P>

<P> </P>

<P>Chapter 4 Packet Format Descriptions </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 27 </P>

<P> </P>

<P>RapidIO Trade Association 3 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>4.2 Request Packet Formats ........................................................................................ 27 </P>

<P>4.2.1 Field Definitions for All Request Packet Formats............................................ 27 </P>

<P>4.2.2 Type 0 Packet Format (Implementation-Defined)............................................ 28 </P>

<P>4.2.3 Type 1&#8211;9 Packet Formats (Reserved) ............................................................... 28 </P>

<P>4.2.4 Type 10 Packet Formats (Doorbell Class) ........................................................ 28 </P>

<P>4.2.5 Type 11 Packet Format (Message Class).......................................................... 28 </P>

<P>4.3 Response Packet Formats ..................................................................................... 30 </P>

<P>4.3.1 Field Definitions for All Response Packet Formats ......................................... 30 </P>

<P>4.3.2 Type 12 Packet Format (Reserved) .................................................................. 31 </P>

<P>4.3.3 Type 13 Packet Format (Response Class) ........................................................ 31 </P>

<P>4.3.4 Type 14 Packet Format (Reserved) .................................................................. 32 </P>

<P>4.3.5 Type 15 Packet Format (Implementation-Defined).......................................... 32 </P>

<P> </P>

<P> </P>

<P>Chapter 5 Message Passing Registers </P>

<P> </P>

<P>5.1 Introduction........................................................................................................... 33 </P>

<P>5.2 Register Summary................................................................................................. 33 </P>

<P>5.3 Reserved Register, Bit and Bit Field Value Behavior .......................................... 34 </P>

<P>5.4 Capability Registers (CARs) ................................................................................ 36 </P>

<P>5.4.1 Source Operations CAR (Configuration Space Offset 0x18) ........................... 36 </P>

<P>5.4.2 Destination Operations CAR (Configuration Space Offset 0x1C) ................... 37 </P>

<P>5.5 Command and Status Registers (CSRs)................................................................ 38 </P>

<P>0.1 Introduction........................................................................................................... 39 </P>

<P>0.2 Definitions and Goals ........................................................................................... 39 </P>

<P>0.3 Message Operations .............................................................................................. 40 </P>

<P>0.4 Inbound Mailbox Structure ................................................................................... 41 </P>

<P>0.4.1 Simple Inbox..................................................................................................... 42 </P>

<P>0.4.2 Extended Inbox ................................................................................................. 42 </P>

<P>0.4.3 Received Messages ........................................................................................... 43 </P>

<P>0.5 Outbound Message Queue Structure .................................................................... 44 </P>

<P>0.5.1 Simple Outbox .................................................................................................. 44 </P>

<P>0.5.2 Extended Outbox .............................................................................................. 45 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>2-1 A Possible RapidIO-Based Computing System..............................................................13 </P>

<P>2-2 Processor-Memory Processing Element Example ..........................................................14 </P>

<P>2-3 Integrated Processor-Memory Processing Element Example.........................................14 </P>

<P>2-4 Memory-Only Processing Element Example .................................................................15 </P>

<P>2-5 Processor-Only Processing Element Example................................................................15 </P>

<P>2-6 Switch Processing Element Example .............................................................................16 </P>

<P>3-1 Doorbell Operation .........................................................................................................23 </P>

<P>3-2 Message Operation .........................................................................................................23 </P>

<P>3-3 Byte Alignment Example................................................................................................24 </P>

<P>3-4 Half-Word Alignment Example......................................................................................24 </P>

<P>3-5 Word Alignment Example ..............................................................................................25 </P>

<P>4-1 Type 10 Packet Bit Stream Format .................................................................................28 </P>

<P>4-2 Type 11 Packet Bit Stream Format .................................................................................30 </P>

<P>4-3 target_info Field for Message Responses .......................................................................32 </P>

<P>4-4 Type 13 Packet Bit Stream Format .................................................................................32 </P>

<P>A-1 Simple Inbound Mailbox Port Structure .........................................................................42 </P>

<P>A-2 Inbound Mailbox Structure .............................................................................................43 </P>

<P>A-3 Outbound Message Queue ..............................................................................................44 </P>

<P>A-4 Extended Outbound Message Queue ..............................................................................45 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>3-1 Message Passing Operations Cross Reference ...............................................................22 </P>

<P>4-1 Request Packet Type to Transaction Type Cross Reference ..........................................27 </P>

<P>4-2 General Field Definitions for All Request Packets.........................................................28 </P>

<P>4-3 Specific Field Definitions for Type 10 Packets ..............................................................28 </P>

<P>4-4 Specific Field Definitions and Encodings for Type 11 Packets .....................................29 </P>

<P>4-5 Response Packet Type to Transaction Type Cross Reference........................................30 </P>

<P>4-6 Field Definitions and Encodings for All Response Packets ...........................................31 </P>

<P>4-7 Specific Field Definitions for Type 13 Packets ..............................................................31 </P>

<P>5-1 Message Passing Register Map.......................................................................................33 </P>

<P>5-2 Configuration Space Reserved Access Behavior............................................................34 </P>

<P>5-3 Bit Settings for Source Operations CAR ........................................................................36 </P>

<P>5-4 Bit Settings for Destination Operations CAR .................................................................37 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>Part 2 is intended for users who need to understand the message passing architecture of the RapidIO interconnect. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>The RapidIO Part 2: Message Passing Logical Specification is part of RapidIO&#8217;s logical layer specifications that define the interconnect&#8217;s overall protocol and packet formats. This layer contains the transaction protocols necessary for end points to process a transaction. Other RapidIO logical layer specifications include RapidIO Part 1: Input/Output Logical Specification and RapidIO Part 5: Globally Shared Memory Logical Specification. </P>

<P> </P>

<P>The logical specifications do not imply a specific transport or physical interface, therefore they are specified in a bit stream format. Necessary bits are added to the logical  encoding  for  the  transport  and  physical  layers  lower  in  the  RapidIO three-layer hierarchy. </P>

<P> </P>

<P>RapidIO is targeted toward memory mapped distributed memory systems. A message passing programming model is supported to enable distributed I/O processing. </P>

<P> </P>

<P> </P>

<P>1.3 Features of the Message Passing Specification </P>

<P> </P>

<P>The following are features of the RapidIO I/O specification designed to satisfy the needs of various applications and systems: </P>

<P> </P>

<P> </P>

<P>1.3.1  Functional Features </P>

<P>&#8226; Many embedded systems are multiprocessor systems, not multiprocessing systems, and prefer a message passing or software-based coherency programming model over the traditional computer-style globally shared memory programming model in order to support their distributed I/O and processing requirements, especially in the networking and routing markets. RapidIO supports all of these programming models. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; System sizes from very small to very large are supported in the same or compatible packet formats&#8212;RapidIO plans for future expansion and requirements. </P>

<P>&#8226; Message passing devices can improve the interconnect efficiency if larger non-coherent data quantities can be encapsulated within a single packet, so RapidIO supports a variety of data sizes within the packet formats. </P>

<P>&#8226; Because the message passing programming model is fundamentally a </P>

<P>non-coherent non-shared memory model, RapidIO can assume that portions of the memory space are only directly accessible by a processor or device local to that memory space. A remote device that attempts to access that memory space must do so through a local device controlled message passing interface. </P>

<P> </P>

<P> </P>

<P>1.3.2  Physical Features </P>

<P>&#8226; RapidIO packet definition is independent of the width of the physical interface to other devices on the interconnect fabric. </P>

<P>&#8226; The protocols and packet formats are independent of the physical interconnect topology. The protocols work whether the physical fabric is a point-to-point ring, a bus, a switched multi-dimensional network, a duplex serial connection, and so forth. </P>

<P>&#8226; RapidIO is not dependent on the bandwidth or latency of the physical fabric. </P>

<P>&#8226; The protocols handle out-of-order packet transmission and reception. </P>

<P>&#8226; Certain devices have bandwidth and latency requirements for proper operation. </P>

<P>RapidIO does not preclude an implementation from imposing these constraints within the system. </P>

<P> </P>

<P> </P>

<P>1.3.3  Performance Features </P>

<P>&#8226; Packet headers must be as small as possible to minimize the control overhead and be organized for fast, efficient assembly and disassembly. </P>

<P>&#8226; Multiple transactions must be allowed concurrently in the system, otherwise a majority of the potential system throughput is wasted. </P>

<P> </P>

<P> </P>

<P>1.4 Contents </P>

<P> </P>

<P>Following  are  the  contents  of  RapidIO  Part  2:  Message  Passing  Logical </P>

<P>Specification: </P>

<P> </P>

<P>&#8226; Chapter 1, &#8220;Overview&#8221; (this chapter) provides an overview of the specification </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; Chapter 2, &#8220;System Models,&#8221; introduces some possible devices that might participate in a RapidIO message passing system environment. The chapter also explains the message passing model, detailing the data and doorbell message types used in a RapidIO system. System issues such as the lack of transaction ordering and deadlock prevention are presented. </P>

<P>&#8226; Chapter 3, &#8220;Operation Descriptions,&#8221; describes the set of operations and transactions supported by the RapidIO message passing protocols. </P>

<P>&#8226; Chapter 4, &#8220;Packet Format Descriptions,&#8221; contains the packet format definitions for the message passing specification. The two basic types, request and response packets, and their fields and sub-fields are explained. </P>

<P>&#8226; Chapter 5, &#8220;Message Passing Registers,&#8221; displays the RapidIO register map that allows an external processing element to determine the message passing capabilities, configuration, and status of a processing element using this logical specification. Only registers or register bits specific to the message passing logical specification are explained. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and bit definitions. </P>

<P>&#8226; Annex A, &#8220;Message Passing Interface (Informative),&#8221; contains an informative discussion on possible programming models for the message passing logical layer. </P>

<P> </P>

<P> </P>

<P>1.5 Terminology </P>

<P> </P>

<P>Refer to the Glossary at the back of this document. </P>

<P> </P>

<P> </P>

<P>1.6 Conventions </P>

<P>|| Concatenation, used to indicate that two fields are physically associated as consecutive bits </P>

<P> </P>

<P>ACTIVE_HIGH Names of active high signals are shown in uppercase text with no overbar. Active-high signals are asserted when high and not asserted when low. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_65.jpg"/>
</Figure>

<P>ACTIVE_LOW Names of active low signals are shown in uppercase text with an overbar. Active low signals are asserted when low and not asserted when high. </P>

<P>italics Book titles in text are set in italics. </P>

<P> </P>

<P>REG[FIELD] Abbreviations or acronyms for registers are shown in uppercase text. Specific bits, fields, or ranges appear in brackets. </P>

<P>TRANSACTION Transaction types are expressed in all caps. operation Device operation types are expressed in plain text. n A decimal value. </P>

<P> </P>

<P>RapidIO Trade Association 11 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>[n-m] Used to express a numerical range from n to m. </P>

<P> </P>

<P>0bnn A binary value, the number of bits is determined by the number of digits. </P>

<P>0xnn A hexadecimal value, the number of bits is determined by the number of digits or from the surrounding context; for example, 0xnn may be a 5, 6, 7, or 8 bit value. </P>

<P>x This value is a don&#8217;t care </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>12 RapidIO Trade Association </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 System Models </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This overview introduces some possible devices in a RapidIO system. </P>

<P> </P>

<P> </P>

<P>2.2 Processing Element Models </P>

<P> </P>

<P>Figure 2-1 describes a possible RapidIO-based system. The processing element is a computer device such as a processor attached to local memory and a RapidIO interconnect. The bridge part of the system provides I/O subsystem services such as high-speed PCI interfaces and Gbit ethernet ports, interrupt control, and other system support functions. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_66.jpg"/>
</Figure>

<P>Processing </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_67.jpg"/>
</Figure>

<P>Element A </P>

<P>Processing </P>

<P>Element B </P>

<P>Processing </P>

<P>Element C </P>

<P>Processing </P>

<P>Element D </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_68.jpg"/>
</Figure>

<P>Memory </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_69.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_70.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_71.jpg"/>
</Figure>

<P>Memory </P>

<P>Memory </P>

<P>Memory </P>

<P> </P>

<P>RapidIO System Interconnect Fabric </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI A </P>

<P> </P>

<P> </P>

<P>Bridge </P>

<P>MPIC </P>

<P>PCI B XBUS </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_72.jpg"/>
</Figure>

<P>Firewire </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_73.jpg"/>
</Figure>

<P> </P>

<P>Figure 2-1. A Possible RapidIO-Based Computing System </P>

<P> </P>

<P>The following sections describe several possible processing elements. </P>

<P> </P>

<P> </P>

<P>2.2.1  Processor-Memory Processing Element Model </P>

<P> </P>

<P>Figure 2-2 shows an example of a processing element consisting of a processor connected to an agent device. The agent carries out several services on behalf of the processor. Most importantly, it provides access to local memory. It also provides an interface to the RapidIO interconnect to service message requests that are used for communications with other processing elements. </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 13 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_74.jpg"/>
</Figure>

<P>Local Interconnect </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_75.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_76.jpg"/>
</Figure>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-2. Processor-Memory Processing Element Example </P>

<P> </P>

<P>2.2.2  Integrated Processor-Memory Processing Element Model </P>

<P> </P>

<P>Another form of a processor-memory processing element is a fully integrated component that is designed specifically to connect to a RapidIO interconnect system, Figure 2-3. This type of device integrates a memory system and other support logic with a processor on the same piece of silicon or within the same package. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_77.jpg"/>
</Figure>

<P>Memory </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_78.jpg"/>
</Figure>

<P>RapidIO-Based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-3. Integrated Processor-Memory Processing Element Example </P>

<P> </P>

<P>2.2.3  Memory-Only Processing Element Model </P>

<P> </P>

<P>A different processing element may not contain a processor at all, but may be a memory-only device as in Figure 2-4. This type of device is much simpler than a processor in that it is only responsible for responding to requests from the external system, not from local requests as in the processor-based model. As such, its memory is remote for all processors in the system. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P>Control </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_79.jpg"/>
</Figure>

<P>Memory </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_80.jpg"/>
</Figure>

<P>RapidIO-Based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-4. Memory-Only Processing Element Example </P>

<P> </P>

<P>2.2.4  Processor-Only Processing Element </P>

<P> </P>

<P>Similar to a memory-only element, a processor-only element has no local memory. A processor-only processing element is shown in Figure 2-5. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_81.jpg"/>
</Figure>

<P>Local Interconnect </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_82.jpg"/>
</Figure>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P>Processor </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P> </P>

<P>Agent </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-5. Processor-Only Processing Element Example </P>

<P> </P>

<P>2.2.5  I/O Processing Element </P>

<P> </P>

<P>This type of processing element is shown as the bridge in Figure 2-1. This device has distinctly different behavior than a processor or a memory. An I/O device only needs to move data into and out of local or remote memory. </P>

<P> </P>

<P> </P>

<P>2.2.6  Switch Processing Element </P>

<P> </P>

<P>A switch processing element is a device that allows communication with other processing elements through the switch. A switch may be used to connect a variety of  RapidIO-compliant  processing  elements. A  possible  switch  is  shown  in Figure 2-6. Behavior of the switches, and the interconnect fabric in general, is addressed in the RapidIO Common Transport Specification. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Switch </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_83.jpg"/>
</Figure>

<P>Figure 2-6. Switch Processing Element Example </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_84.jpg"/>
</Figure>

<P> </P>

<P>2.3 Message Passing System Model </P>

<P> </P>

<P>RapidIO supports a message passing programming model. Message passing is a programming model commonly used in distributed memory system machines. In this model, processing elements are only allowed to access memory that is local to themselves, and communication between processing elements is handled through specialized hardware manipulated through application or OS software. For two processors to communicate, the sending processor writes to a local message passing device that reads a section of the sender&#8217;s local memory and moves that information to the receiving processor&#8217;s local message passing device. The recipient message passing device then stores that information in local memory and informs the recipient processor that a message has arrived, usually via an interrupt. The recipient processor then accesses its local memory to read the message. </P>

<P> </P>

<P>For example, referring to Figure 2-1, processing element A can only access the memory attached to it, and cannot access the memory attached to processing elements B, C, or D. Correspondingly, processing element B can only access the memory attached to it and cannot access the memory attached to processing element A, C, or D, and so on. If  processing element A needs to communicate with processing element B, the application software accesses special message passing hardware (also called mailbox hardware) through operating system calls or API libraries and configure it to assemble the message and send it to processing element B. The message passing hardware for processing element B receives the message and puts it into local memory at a predetermined address, then notifies processing element B. </P>

<P> </P>

<P>Many times a message is required to be larger than a single packet allows, so the source needs to break up the message into multiple packets before transmitting it. At times it may also be useful to have more than one message being transmitted at a time. RapidIO has facilities for both of these features. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.1  Data Message Operations </P>

<P> </P>

<P>A source may generate a single message operation of up to 16 individual packets containing as much as 256 data bytes per packet. A variety of data payload sizes exist, allowing a source to choose a smaller size data payload if needed for an application. RapidIO defines all data message packets as containing the same amount of data with the exception of the last one, which can contain a smaller data payload if desired. The packets are formatted with three fields: </P>

<P>&#8226; One field specifies the size of the data payload for all except the last packet for the data message operation. </P>

<P>&#8226; The second field specifies the size of the data payload for that packet, and </P>

<P>&#8226; The third field contains the packet sequence order information. </P>

<P>The actual packet formats are shown in Chapter 4, &#8220;Packet Format Descriptions.&#8221; Because all packets except the last have the same data payload size, the receiver is </P>

<P>able to calculate the local memory storage addresses if the packets are received out of order, allowing operation with an interconnect fabric that does not guarantee packet delivery ordering. </P>

<P> </P>

<P>For multiple packet messages, a letter field and a mailbox field allow a source to simultaneously have up to four data message operations (or &#8220;letters&#8221;) in progress to each of four different mailboxes, allowing up to sixteen concurrent data message operations between a sender and a receiver. The mailbox field can be used to indicate the priority of a data message, allowing a higher priority message to interrupt a lower priority one at the sender, or it can be used as a simple mailbox identifier for a particular receiver if the receiver allows multiple mailbox addresses. If the mailbox number is used as a priority indicator, mailbox number 0 is the highest priority and mailbox 3 is the lowest. </P>

<P> </P>

<P>For single packet messages, the letter and mailbox fields instead allow four concurrent letters to sixty-four possible mailboxes. As for multiple packet messages, if the mailbox number is used as a priority indicator, mailbox number 0 is the highest priority and mailbox 63 is the lowest. </P>

<P> </P>

<P>The number of packets comprising a data message operation, the maximum data payload size, the number of concurrent letters, and the number of mailboxes that can be sent or received is determined by the implementation of a particular processing element. For example, a processing element could be designed to generate two concurrent letters of at most four packets with a maximum 64-byte data payload. That same processing element could also be designed to receive data messages in two mailboxes with two concurrent letters for each, all with the maximum data payload size and number of packets. </P>

<P> </P>

<P>There is further discussion of the data message operation programming model and the   necessary  hardware  support  in   Annex A,   &#8220;Message  Passing  Interface (Informative)&#8221;. </P>

<P> </P>

<P>RapidIO Trade Association 17 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.3.2  Doorbell Message Operations </P>

<P> </P>

<P>RapidIO supports a second message type, the doorbell message operation. The doorbell message operation sends a small amount of software-defined information to the receiver and the receiver controls all local memory addressing as with the data message operation. It is the responsibility of the processor receiving the doorbell message to determine the action to undertake by examining the ID of the sender and the received data. All information supplied in a doorbell message is embedded in the packet header so the doorbell message never has a data payload. </P>

<P> </P>

<P>The generation, transmission, and receipt of a doorbell message packet is handled in a fashion similar to a data message packet. If processing element A wants to send a doorbell message to processing element B, the application software accesses special doorbell message hardware through operating system calls or API libraries and configures it to assemble the doorbell message and send it to processing element B. The doorbell message hardware for processing element B receives the doorbell message and puts it into local memory at a predetermined address, then notifies processing element B, again, usually via an interrupt. </P>

<P> </P>

<P>There is further discussion of the doorbell message operation programming model and  the  necessary hardware support  in  Annex A,  &#8220;Message Passing  Interface (Informative)&#8221;. </P>

<P> </P>

<P> </P>

<P>2.4 System Issues </P>

<P> </P>

<P>The following sections describe transaction ordering and system deadlock considerations in a RapidIO system. </P>

<P> </P>

<P> </P>

<P>2.4.1  Operation Ordering </P>

<P> </P>

<P>The RapidIO Part 2: Message Passing Logical Specification requires no special system operation ordering. Message operation completion is managed by the overlying system software. </P>

<P> </P>

<P>It is important to recognize that systems may contain a mix of transactions that are maintained under the message passing model as well as under another model. As an example, I/O traffic may be interspersed with message traffic. In this case, the shared I/O traffic may require strong ordering rules to maintain coherency. This may set an operation ordering precedence for that implementation, especially in the case where the connection fabric cannot discern between one type of operation and another. </P>

<P> </P>

<P> </P>

<P>2.4.2  Transaction Delivery </P>

<P> </P>

<P>There are two basic types of delivery schemes that can be built using RapidIO processing elements: unordered and ordered. The RapidIO logical protocols assume that all outstanding transactions to another processing element are delivered in an arbitrary order. In other words, the logical protocols do not rely on transaction </P>

<P> </P>

<P>18 RapidIO Trade Association </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>interdependencies for operation. RapidIO also allows completely ordered delivery systems to be constructed. Each type of system puts different constraints on the implementation of the source and destination processing elements and any intervening hardware. </P>

<P> </P>

<P>A message operation may consist of several transactions. It is possible for these transactions to arrive at a target mailbox in an arbitrary order. A message transaction contains explicit tagging information to allow the message to be reconstructed as it arrives at the target processing element. </P>

<P> </P>

<P> </P>

<P>2.4.3  Deadlock Considerations </P>

<P> </P>

<P>A deadlock can occur if a dependency loop exists. A dependency loop is a situation where a loop of buffering devices is formed, in which forward progress at each device is dependent upon progress at the next device. If no device in the loop can make progress then the system is deadlocked. </P>

<P> </P>

<P>The simplest solution to the deadlock problem is to discard a packet. This releases resources in the network and allows forward progress to be made. RapidIO is designed to be a reliable fabric for use in real time tightly coupled systems, therefore discarding packets is not an acceptable solution. </P>

<P> </P>

<P>In order to produce a system with no chance of deadlock it is required that a deadlock free topology be provided for response-less operations. Dependency loops to single direction packets can exist in unconstrained switch topologies. Often the dependency loop can be avoided with simple routing rules. Topologies like hypercubes or three-dimensional meshes, physically contain loops. In both cases, routing is done in several dimensions (x,y,z). If routing is constrained to the x dimension, then y, then z (dimension ordered routing) then topology related dependency loops are avoided in these structures. </P>

<P> </P>

<P>In addition, a processing element design must not form dependency links between its input and output port. A dependency link between input and output ports occurs if a processing element is unable to accept an input packet until a waiting packet can be issued from the output port. </P>

<P> </P>

<P>RapidIO supports operations, such as read operations, that require responses to complete. These operations can lead to a dependency link between an processing element&#8217;s input port and output port. </P>

<P> </P>

<P>As an example of a input to output port dependency, consider a processing element where the output port queue is full. The processing element cannot accept a new request at its input port since there is no place to put the response in the output port queue. No more transactions can be accepted at the input port until the output port is able to free entries in the output queue by issuing packets to the system. </P>

<P> </P>

<P>The method by which a RapidIO system maintains a deadlock free environment is </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 19 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>described in the appropriate Physical Layer specification. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Operation Descriptions </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This chapter describes the set of operations and transactions supported by the RapidIO message passing protocols. The opcodes and packet formats are described in Chapter 4, &#8220;Packet Format Descriptions&#8221;. </P>

<P> </P>

<P>The RapidIO operation protocols use request/response transaction pairs through the interconnect fabric. A processing element sends a request transaction to another processing element if it requires an activity to be carried out. The receiving processing element responds with a response transaction when the request has been completed or if an error condition is encountered. Each transaction is sent as a packet through the interconnect fabric. For example, a processing element that needs to send part of a message operation to another processing element sends a MESSAGE request packet to that processing element, which processes the message packet and returns a DONE response packet. </P>

<P> </P>

<P>Three possible response transactions can be received by a requesting processing element: </P>

<P> </P>

<P>&#8226; A DONE response indicates to the requestor that the desired transaction has completed. </P>

<P>&#8226; A RETRY response shall be generated for a message transaction that attempts to access a mailbox that is busy servicing another message operation, as can a doorbell transaction that encounters busy doorbell hardware. A transaction request which receives a RETRY response must be re-transmitted in order to complete the operation. </P>

<P>&#8226; An ERROR response means that the target of the transaction encountered an unrecoverable error and could not complete the transaction. </P>

<P> </P>

<P>Packets may contain additional information that is interpreted by the interconnect fabric to route the packets through the fabric from the source to the destination, such as a device number. These requirements are described in the appropriate RapidIO transport layer specification, and are beyond the scope of this specification. </P>

<P> </P>

<P>Depending upon the interconnect fabric, other packets may be generated as part of the physical layer protocol to manage flow control, errors, etc. Flow control and other fabric-specific communication requirements are described in the appropriate RapidIO physical layer specification and are beyond the scope of this document. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Each request transaction sent into the system is marked with a transaction ID that is unique for each requestor and responder processing element pair. This transaction ID allows a response to be easily matched to the original request when it is returned to the requestor. An end point cannot reuse a transaction ID value to the same destination until the response from the original transaction has been received by the requestor. The number of outstanding transactions that may be supported is implementation dependent. </P>

<P> </P>

<P> </P>

<P>3.2 Message Passing Operations Cross Reference </P>

<P> </P>

<P>Table 3-1 contains a cross-reference list of the message passing operations defined in this RapidIO specification and their system usage. </P>

<P> </P>

<P>Table 3-1. Message Passing Operations Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Operation </P>
</TD>

<TD>
<P>Transactions </P>

<P>Used </P>
</TD>

<TD>
<P> </P>

<P>Possible System Usage </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>

<TD>
<P> </P>

<P>Packet Format </P>
</TD>
</TR>

<TR>
<TD>
<P>Doorbell </P>
</TD>

<TD>
<P>DOORBELL, RESPONSE </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Section 3.3.1 </P>
</TD>

<TD>
<P>Type 10 </P>

<P>Section 4.2.4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Message </P>
</TD>

<TD>
<P>MESSAGE, RESPONSE </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Section 3.3.2 </P>
</TD>

<TD>
<P>Type 11 </P>

<P>Section 4.2.5 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.3 Message Passing Operations </P>

<P> </P>

<P>The two kinds of message passing transactions are described in this section and defined as follows: </P>

<P> </P>

<P>&#8226; Doorbell </P>

<P>&#8226; Data Message </P>

<P> </P>

<P> </P>

<P>3.3.1  Doorbell Operations </P>

<P> </P>

<P>The doorbell operation, consisting of the DOORBELL and RESPONSE transactions (typically a DONE response) as shown in Figure 3-1, is used by a processing element to send a very short message to another processing element through the interconnect fabric. The DOORBELL transaction contains the info field to hold information and does not have a data payload. This field is software-defined and can be used for any desired purpose; see Section 4.2.4, &#8220;Type 10 Packet Formats (Doorbell Class),&#8221; for information about the info field. </P>

<P> </P>

<P>A processing element that receives a doorbell transaction takes the packet and puts it in a doorbell message queue within the processing element. This queue may be implemented in hardware or in local memory. This behavior is similar to that of typical message passing mailbox hardware. The local processor is expected to read the queue to determine the sending processing element and the info field and determine what action to take based on that information. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>1  DOORBELL </P>

<P> </P>

<P> </P>

<P>Requestor Destination </P>

<P> </P>

<P>2  DONE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_85.jpg"/>
</Figure>

<P>Figure 3-1. Doorbell Operation </P>

<P> </P>

<P> </P>

<P>3.3.2  Data Message Operations </P>

<P> </P>

<P>The data message operation, consisting of the MESSAGE and RESPONSE transactions (typically a DONE response) as shown in Figure 3-2, is used by a processing element&#8217;s message passing support hardware to send a data message to other processing elements. Completing a data message operation can consist of up to 16 individual MESSAGE transactions. MESSAGE transaction data payloads are always multiples of doubleword quantities. </P>

<P> </P>

<P>1  MESSAGEs, data </P>

<P> </P>

<P> </P>

<P>Requestor Destination </P>

<P> </P>

<P>2  DONEs </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_86.jpg"/>
</Figure>

<P>Figure 3-2. Message Operation </P>

<P> </P>

<P>The processing element&#8217;s message passing hardware that is the recipient of a data message operation examines a number of fields in order to place an individual MESSAGE packet data in local memory: </P>

<P>&#8226; Message length (msglen) field&#8212;Specifies the number of transactions that comprise the data message operation. </P>

<P>&#8226; Message segment (msgseg) field&#8212;Identifies which part of the data message operation is contained in this transaction. The message length and segment fields allow the individual packets of a data message to be sent or received out of order. </P>

<P>&#8226; Mailbox (mbox) field&#8212;Specifies which mailbox is the target of the data message. </P>

<P>&#8226; Letter (letter) field &#8212;Allows receipt of multiple concurrent data message operations from the same source to the same mailbox. </P>

<P>&#8226; Standard size (ssize) field&#8212;Specifies the data size of all of the transactions except (possibly) the last transaction in the data message. </P>

<P> </P>

<P>From this information, the message passing hardware of the recipient processing element can calculate to which local memory address the transaction data should be placed. </P>

<P> </P>

<P>RapidIO Trade Association 23 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>For example, assume that the mailbox starting addresses for the recipient processing element are at addresses 0x1000 for mailbox 0, 0x2000 for mailbox 1, 0x3000 for mailbox 2, and 0x4000 for mailbox 3, and that the processing element receives a message transaction with the following fields: </P>

<P>&#8226; message length of 6 packets </P>

<P>&#8226; message segment is 3rd packet </P>

<P>&#8226; mailbox is mailbox 2 </P>

<P>&#8226; letter is 1 </P>

<P>&#8226; standard size is 32 bytes </P>

<P>&#8226; data payload is 32 bytes (it shall be 32 bytes since this is not the last transaction) </P>

<P> </P>

<P>Using this information, the processing element&#8217;s message passing hardware can determine that the 32 bytes contained in this part of the data message shall be put into local memory at address 0x3040. </P>

<P> </P>

<P>The message passing hardware may also snoop the local processing element&#8217;s caching hierarchy when writing local memory if the mailbox memory is defined as being cacheable by that processing element. </P>

<P> </P>

<P> </P>

<P>3.4 Endian, Byte Ordering, and Alignment </P>

<P> </P>

<P>RapidIO has double-word (8-byte) aligned big-endian data payloads. This means that the RapidIO interface to devices that are little-endian shall perform the proper endian transformation at the output to format a data payload. </P>

<P> </P>

<P>Operations that specify data quantities that are less than 8 bytes shall have the bytes aligned to their proper byte position within the big-endian double-word, as in the examples shown in Figure 3-3 through Figure 3-5. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_87.jpg"/>
</Figure>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Byte address 0x0000_0002, the proper byte position is shaded. </P>

<P> </P>

<P>Figure 3-3. Byte Alignment Example </P>

<P> </P>

<P> </P>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>MSB </P>
</TD>

<TD>
<P>LSB </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Half-word address 0x0000_0002, the proper byte positions are shaded. </P>

<P> </P>

<P>Figure 3-4. Half-Word Alignment Example </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>MSB </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>LSB </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Word address 0x0000_0004, the proper byte positions are shaded. </P>

<P> </P>

<P>Figure 3-5. Word Alignment Example </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Packet Format Descriptions </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>

<P>This chapter contains the packet format definitions for the RapidIO Part 2: Message Passing Logical Specification. There are four types of message passing packet formats: </P>

<P>&#8226; Request </P>

<P>&#8226; Response </P>

<P>&#8226; Implementation-defined </P>

<P>&#8226; Reserved </P>

<P> </P>

<P>The packet formats are intended to be interconnect fabric independent so the system interconnect can be anything required for a particular application. Reserved formats, unless defined in another logical specification, shall not be used by a device. </P>

<P> </P>

<P> </P>

<P>4.2 Request Packet Formats </P>

<P> </P>

<P>A request packet is issued by a processing element that needs a remote processing element to accomplish some activity on its behalf, such as a doorbell operation. The request packet format types and their transactions for the RapidIO Part 2: Message Passing Logical Specification are shown in Table 4-1. </P>

<P> </P>

<P>Table 4-1. Request Packet Type to Transaction Type Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Request Packet </P>

<P>Format Type </P>
</TD>

<TD>
<P> </P>

<P>Transaction Type </P>
</TD>

<TD>
<P> </P>

<P>Definition </P>
</TD>

<TD>
<P>Document Section </P>

<P>Number </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 0 </P>
</TD>

<TD>
<P>Implementation-&#61472;&#61472;</P>

<P>defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>

<TD>
<P>Section 4.2.2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 1&#8211;9 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.2.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 10 </P>
</TD>

<TD>
<P>DOORBELL </P>
</TD>

<TD>
<P>Send a short message </P>
</TD>

<TD>
<P>Section 4.2.4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 11 </P>
</TD>

<TD>
<P>MESSAGE </P>
</TD>

<TD>
<P>Send a message </P>
</TD>

<TD>
<P>Section 4.2.5 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.2.1  Field Definitions for All Request Packet Formats </P>

<P> </P>

<P>The field definitions in Table 4-2 apply to all of the request packet formats. Fields that are unique to type 10 and type 11 formats are defined in the sections that describe each type. Bit fields that are defined as &#8220;reserved&#8221; shall be assigned to logic </P>

<P>0s when generated and ignored when received. Bit field encodings that are defined </P>

<P> </P>

<P>RapidIO Trade Association 27 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>as &#8220;reserved&#8221; shall not be assigned when the packet is generated. A received reserved encoding is regarded as an error if a meaningful encoding is required for the transaction and function, otherwise it is ignored. Implementation-defined fields shall be ignored unless the encoding is understood by the receiving device. All packets described are bit streams from the first bit to the last bit, represented in the figures from left to right respectively. </P>

<P> </P>

<P>Table 4-2. General Field Definitions for All Request Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>ftype </P>
</TD>

<TD>
<P>Format type&#8212;Represented as a 4-bit value; is always the first four bits in the logical packet stream. </P>
</TD>
</TR>

<TR>
<TD>
<P>rsrv </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.2.2  Type 0 Packet Format (Implementation-Defined) </P>

<P> </P>

<P>The type 0 packet format is reserved for implementation-defined functions such as flow control. </P>

<P> </P>

<P> </P>

<P>4.2.3  Type 1&#8211;9 Packet Formats (Reserved) </P>

<P> </P>

<P>The type 1&#8211;9 formats are reserved. </P>

<P> </P>

<P> </P>

<P>4.2.4  Type 10 Packet Formats (Doorbell Class) </P>

<P> </P>

<P>The type 10 packet format is the DOORBELL transaction format. Type 10 packets never have data payloads. The field value 0b1010 in Figure 4-1 specifies that the packet format is of type 10. </P>

<P> </P>

<P>Definitions and encodings of fields specific to type 10 packets are provided in </P>

<P>Table 4-3. Fields that are not specific to type 10 packets are described in Table 4-2. </P>

<P> </P>

<P>Table 4-3. Specific Field Definitions for Type 10 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>info </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Software-defined information field </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 4-1 displays a type 10 packet with all its fields. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1 0 1 0 </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>srcTID </P>
</TD>

<TD>
<P>info (msb) </P>
</TD>

<TD>
<P>info (lsb) </P>
</TD>
</TR>
</Table>

<P>4 8 8 8 8 </P>

<P> </P>

<P>Figure 4-1. Type 10 Packet Bit Stream Format </P>

<P> </P>

<P>4.2.5  Type 11 Packet Format (Message Class) </P>

<P> </P>

<P>The type 11 packet is the MESSAGE transaction format. Type 11 packets always have a data payload. Sub-double-word messages are not specifiable and must be managed in software. </P>

<P> </P>

<P>28 RapidIO Trade Association </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Definitions and encodings of fields specific to type 11 packets are provided in </P>

<P>Table 4-4. Fields that are not specific to type 11 packets are described in Table 4-2. </P>

<P> </P>

<P>Table 4-4. Specific Field Definitions and Encodings for Type 11 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>msglen </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Total number of packets comprising this message operation. A value of 0 indicates a </P>

<P>single-packet message. A value of 15 (0xF) indicates a 16-packet message, etc. See example in </P>

<P>Section 3.3.2, &#8220;Data Message Operations&#8221;. </P>
</TD>
</TR>

<TR>
<TD>
<P>msgseg </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>For multiple packet data message operations, specifies the part of the message supplied by this packet. A value of 0 indicates that this is the first packet in the message. A value of 15 (0xF) indicates that this is the sixteenth packet in the message, etc. See example in Section 3.3.2, &#8220;Data Message Operations&#8221;. </P>
</TD>
</TR>

<TR>
<TD>
<P>xmbox </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>For single packet data message operations, specifies the upper 4 bits of the mailbox targeted by the packet. </P>

<P>xmbox || mbox are specified as follows: </P>

<P>0000 00 - mailbox 0&#61472;&#61472;</P>

<P>0000 01 - mailbox 1&#61472;&#61472;</P>

<P>0000 10 - mailbox 2&#61472;&#61472;</P>

<P>0000 11 - mailbox 3&#61472;&#61472;</P>

<P>0001 00 - mailbox 4&#61472;&#61472;</P>

<P>....&#61472;&#61472;</P>

<P>1111 11 - mailbox 63 </P>
</TD>
</TR>

<TR>
<TD>
<P>ssize </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Standard message packet data size. This field informs the receiver of a message the size of the data payload to expect for all of the packets for a single message operations except for the last packet in the message. This prevents the sender from having to pad the data field excessively for the last packet and allows the receiver to properly put the message in local memory. See example in Section 3.3.2, &#8220;Data Message Operations&#8221;. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0000&#8211;1000 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>8 bytes </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>16 bytes </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>32 bytes </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>64 bytes </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1101 </P>
</TD>

<TD>
<P>128 bytes </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>256 bytes </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>mbox </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Specifies the recipient mailbox in the target processing element </P>
</TD>
</TR>

<TR>
<TD>
<P>letter </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Identifies a slot within a mailbox. This field allows a sending processing element to concurrently send up to four messages to the same mailbox on the same processing element. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Figure 4-2 displays a type 11 packet with all its fields. The value 0b1011 in </P>

<P>Figure 4-2 specifies that the packet format is of type 11. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1 0 1 1 </P>
</TD>

<TD>
<P>msglen </P>
</TD>

<TD>
<P>ssize </P>
</TD>

<TD>
<P>letter </P>
</TD>

<TD>
<P>mbox </P>
</TD>

<TD>
<P>msgseg/xmbox </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>4 </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_88.jpg"/>
</Figure>

<P>double-word 0 </P>

<P> </P>

<P>64 </P>

<P> </P>

<P> </P>

<P> </P>

<P>&#8226;  &#8226; &#8226; </P>

<P>double-word 1 </P>

<P> </P>

<P>64 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_89.jpg"/>
</Figure>

<P>double-word n </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_90.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_91.jpg"/>
</Figure>

<P>64 </P>

<P> </P>

<P>Figure 4-2. Type 11 Packet Bit Stream Format </P>

<P> </P>

<P>The combination of the letter, mbox, and the msgseg or xmbox fields uniquely identifies the message packet in the system for each requestor and responder processing element pair in the same way as the transaction ID is used for other request types. Care must be taken to prevent aliasing of the combination of these values. </P>

<P> </P>

<P> </P>

<P>4.3 Response Packet Formats </P>

<P> </P>

<P>A response transaction is issued by a processing element when it has completed a request made by a remote processing element. Response packets are always directed and are transmitted in the same way as request packets. Currently two response packet format types exist, as shown in Table 4-5. </P>

<P> </P>

<P>Table 4-5. Response Packet Type to Transaction Type Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Response Packet </P>

<P>Format Type </P>
</TD>

<TD>
<P> </P>

<P>Transaction Type </P>
</TD>

<TD>
<P> </P>

<P>Definition </P>
</TD>

<TD>
<P>Document Section </P>

<P>Number </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 12 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.3.2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 13 </P>
</TD>

<TD>
<P>RESPONSE </P>
</TD>

<TD>
<P>Issued by a processing element when it completes a request by a remote element. </P>
</TD>

<TD>
<P>Section 4.3.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 14 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.3.4 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>Type 15 </P>
</TD>

<TD>
<P>Implementation-&#61472;&#61472;</P>

<P>defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>

<TD>
<P> </P>

<P>Section 4.3.5 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.3.1  Field Definitions for All Response Packet Formats </P>

<P> </P>

<P>The field definitions in Table 4-6 apply to more than one of the response packet formats. Fields that are unique to the type 13 format are defined in Section 4.3.3, &#8220;Type 13 Packet Format (Response Class).&#8221; </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-6. Field Definitions and Encodings for All Response Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Sub-Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>RESPONSE transaction with no data payload (including DOORBELL RESPONSE) </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>MESSAGE RESPONSE transaction </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0010&#8211;1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>status </P>
</TD>

<TD>
<P>Type of status and encoding </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>DONE </P>
</TD>

<TD>
<P>Requested transaction has been successfully completed </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001&#8211;0010 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>RETRY </P>
</TD>

<TD>
<P>Requested transaction is not accepted; re-transmission of the request is needed to complete the transaction </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0100&#8211;0110 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>ERROR </P>
</TD>

<TD>
<P>Unrecoverable error detected </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1000&#8211;1011 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1100&#8211;1111 </P>
</TD>

<TD>
<P>Implementation </P>
</TD>

<TD>
<P>Implementation defined&#8212;Can be used for additional information such as an error code </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.3.2  Type 12 Packet Format (Reserved) </P>

<P> </P>

<P>The type 12 packet format is reserved. </P>

<P> </P>

<P> </P>

<P>4.3.3  Type 13 Packet Format (Response Class) </P>

<P> </P>

<P>The type 13 packet format returns status and the requestor&#8217;s transaction ID or message segment and mailbox information. The type 13 format is used for response packets to all request packets. Responses to message and doorbell packets never contain data. </P>

<P> </P>

<P>Definitions and encodings of fields specific to type 13 packets are provided in </P>

<P>Table 4-7. Fields that are not specific to type 13 packets are described in Table 4-6. </P>

<P> </P>

<P>Table 4-7. Specific Field Definitions for Type 13 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Sub-Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>target_info </P>
</TD>

<TD>
<P>As shown in Figure 4-3, when the response is the target_info field, these three sub-fields are used: </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>msgseg </P>
</TD>

<TD>
<P>Specifies the part of the message supplied by the corresponding message packet. A value of </P>

<P>0 indicates that this is the response for the first packet in the message. A value of 15 (0xF) </P>

<P>indicates that this is the response for the sixteenth (and last) packet in the message, etc. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>mbox </P>
</TD>

<TD>
<P>Specifies the recipient mailbox from the corresponding message packet. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>letter </P>
</TD>

<TD>
<P>Identifies the slot within the target mailbox. This field allows a sending processing element to concurrently send up to four messages to the same mailbox on the same processing element. </P>
</TD>
</TR>

<TR>
<TD>
<P>targetTID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Transaction ID of the request that caused this response (except for message responses defined in Figure 4-3). </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 4-3 shows the format of the target_info field for message responses. </P>

<P> </P>

<P>RapidIO Trade Association 31 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>letter </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_92.jpg"/>
</Figure>

<P>2 </P>

<P>mbox </P>

<P> </P>

<P>2 </P>

<P>msgseg </P>

<P> </P>

<P>4 </P>

<P> </P>

<P>Figure 4-3. target_info Field for Message Responses </P>

<P> </P>

<P>Figure 4-4 displays a type 13 packet with all its fields. The value 0b1101 in </P>

<P>Figure 4-4 specifies that the packet format is of type 13. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1 1 0 1 </P>
</TD>

<TD>
<P>transaction </P>
</TD>

<TD>
<P>status </P>
</TD>

<TD>
<P>target_info/targetTID </P>
</TD>
</TR>
</Table>

<P>4 4 4 8 </P>

<P> </P>

<P>Figure 4-4. Type 13 Packet Bit Stream Format </P>

<P> </P>

<P>4.3.4  Type 14 Packet Format (Reserved) </P>

<P> </P>

<P>The type 14 packet format is reserved. </P>

<P> </P>

<P> </P>

<P>4.3.5  Type 15 Packet Format (Implementation-Defined) </P>

<P> </P>

<P>The type 15 packet format is reserved for implementation-defined functions such as flow control. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 Message Passing Registers </P>

<P> </P>

<P> </P>

<P>5.1 Introduction </P>

<P> </P>

<P>This chapter describes the visible register set that allows an external processing element to determine the capabilities, configuration, and status of a processing element using this logical specification. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and  bit  definitions. All  registers are  32-bits and  aligned to  a  32-bit boundary. </P>

<P> </P>

<P> </P>

<P>5.2 Register Summary </P>

<P> </P>

<P>Table 5-1 shows the register map for this RapidIO specification. These capability registers (CARs) and command and status registers (CSRs) can be accessed using Part 1: Input/Output Logical Specification maintenance operations. Any register offsets not defined are considered reserved for this specification unless otherwise stated. Other registers required for a processing element are defined in other applicable RapidIO specifications and by the requirements of the specific device and are beyond the scope of this specification. Read and write accesses to reserved register offsets shall terminate normally and not cause an error condition in the target device. Writes to CAR (read-only) space shall terminate normally and not cause an error condition in the target device. </P>

<P> </P>

<P>Register bits defined as reserved are considered reserved for this specification only. Bits that are reserved in this specification may be defined in another RapidIO specification. </P>

<P> </P>

<P>Table 5-1. Message Passing Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0-14 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x18 </P>
</TD>

<TD>
<P>Source Operations CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x1C </P>
</TD>

<TD>
<P>Destination Operations CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x20&#8211;FC </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-1. Message Passing Register Map (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P> </P>

<P>Extended Features Space </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P> </P>

<P>Implementation-defined Space </P>
</TD>
</TR>
</Table>

<P> </P>

<P>5.3 Reserved Register, Bit and Bit Field Value Behavior </P>

<P> </P>

<P>Table 5-2 describes the required behavior for accesses to reserved register bits and reserved registers for the RapidIO register space, </P>

<P> </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0&#8211;3C </P>
</TD>

<TD>
<P>Capability Register Space (CAR Space - this space is read-only) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value1 </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined </P>

<P>function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x40&#8211;FC </P>
</TD>

<TD>
<P>Command and Status Register Space (CSR Space) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value2 </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined </P>

<P>function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P>Extended Features Space </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P>Implementation-defined </P>

<P>Space </P>
</TD>

<TD>
<P>Reserved bit and register </P>
</TD>

<TD>
<P>All behavior implementation-defined </P>
</TD>
</TR>
</Table>

<P>1Do not depend on reserved bits being a particular value; use appropriate masks to extract defined bits from the read value. </P>

<P>2All register writes shall be in the form: read the register to obtain the values of all reserved bits, merge in the desired values for defined bits to be modified, and write the register, thus preserving the value of all reserved bits. </P>

<P> </P>

<P>When  a  writable  bit  field  is  set  to  a  reserved  value,  device  behavior  is implementation specific. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.4 Capability Registers (CARs) </P>

<P> </P>

<P>Every processing element shall contain a set of registers that allows an external processing element to determine its capabilities using the I/O logical maintenance read operation. All registers are 32 bits wide and are organized and accessed in </P>

<P>32-bit (4 byte) quantities, although some processing elements may optionally allow larger accesses. CARs are read-only. Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>CARs are big-endian with bit 0 the most significant bit. </P>

<P> </P>

<P> </P>

<P>5.4.1  Source Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x18) </P>

<P> </P>

<P>This register defines the set of RapidIO message passing logical operations that can be issued by this processing element; see Table 5-3. It is assumed that a processing element can generate I/O logical maintenance read and write requests if it is required to access CARs and CSRs in other processing elements. RapidIO switches shall be able to route any packet. </P>

<P> </P>

<P>Table 5-3. Bit Settings for Source Operations CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14&#8211;15 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;19 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>20 </P>
</TD>

<TD>
<P>Data message </P>
</TD>

<TD>
<P>PE can support a data message operation </P>
</TD>
</TR>

<TR>
<TD>
<P>21 </P>
</TD>

<TD>
<P>Doorbell </P>
</TD>

<TD>
<P>PE can support a doorbell operation </P>
</TD>
</TR>

<TR>
<TD>
<P>22&#8211;29 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>30&#8211;31 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.2  Destination Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x1C) </P>

<P> </P>

<P>This register defines the set of RapidIO message passing operations that can be supported by this processing element; see Table 5-4. It is required that all processing elements can respond to I/O logical maintenance read and write requests in order to access these registers. The Destination Operations CAR is applicable for end point devices only. RapidIO switches shall be able to route any packet. </P>

<P> </P>

<P>Table 5-4. Bit Settings for Destination Operations CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14&#8211;15 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;19 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>20 </P>
</TD>

<TD>
<P>Data message </P>
</TD>

<TD>
<P>PE can support a data message operation </P>
</TD>
</TR>

<TR>
<TD>
<P>21 </P>
</TD>

<TD>
<P>Doorbell </P>
</TD>

<TD>
<P>PE can support a doorbell operation </P>
</TD>
</TR>

<TR>
<TD>
<P>22&#8211;29 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>30&#8211;31 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.5 Command and Status Registers (CSRs) </P>

<P> </P>

<P>A processing element shall contain a set of command and status registers (CSRs) that allows an external processing element to control and determine the status of its internal hardware. All registers are 32 bits wide and are organized and accessed in the same way as the CARs. Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>Currently there are no CSRs defined by the message passing logical layer specification. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex A Message Passing Interface </P>

<P>(Informative) </P>

<P> </P>

<P> </P>

<P>A.1 Introduction </P>

<P> </P>

<P>The RapidIO Part 2: Message Passing Logical Specification defines several packet formats that are useful for sending messages from a source device to a destination. These formats do not describe a specific programming model but are instantiated as an example packetizing mechanism. Because the actual programming models for message passing can vary greatly in both capability and complexity, they have been deemed beyond the scope of this specification. This appendix is provided as a reference model for message passing and is not intended to be all encompassing. </P>

<P> </P>

<P> </P>

<P>A.2 Definitions and Goals </P>

<P> </P>

<P>A system may be made up of several processors and distributed memory elements. These processors may be tightly coupled and operating under a monolithic operating system in certain applications. When this is true the operating system is tasked with managing the pool of processors and memory to solve a set of tasks. In most of these cases,  it  is  most  efficient  for  the  processors  to  work  out  of  a  common hardware-maintained coherent memory space. This allows processors to communicate initialization and completion of tasks through the use of semaphores, spin locks, and inter-process interrupts. Memory is managed centrally by the operating system with a paging protection scheme. </P>

<P> </P>

<P>In other such distributed systems, processors and memory may be more loosely coupled. Several operating systems or kernels may be coexistent in the system, each kernel being responsible for a small part of the entire system. It is necessary to have a communication mechanism whereby kernels can communicate with other kernels in a system of this nature. Since this is a shared nothing environment, it is also desirable to have a common hardware and software interface mechanism to accomplish this communication. This model is typically called message passing. </P>

<P> </P>

<P>In these message passing systems, two mechanisms typically are used to move data from one portion of memory space to another. The first mechanism is called direct memory access (DMA), the second is messaging. The primary difference between the two models is that DMA transactions are steered by the source whereas messages are steered by the target. This means that a DMA source not only requires access to a target but must also have visibility into the target&#8217;s address space. The message </P>

<P> </P>

<P>RapidIO Trade Association 39 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>source only requires access to the target and does not need visibility into the target&#8217;s address space. In distributed systems it is common to find a mix of DMA and messaging deployed. </P>

<P> </P>

<P>The RapidIO architecture contains a packet transport mechanism that can aid in the distributed shared nothing environment. The RapidIO message passing model meets several goals: </P>

<P>&#8226; A message is constructed of one or more transactions that can be sent and received through a possibly unordered interconnect </P>

<P>&#8226; A sender can have a number of outstanding messages queued for sending </P>

<P>&#8226; A sender can send a higher priority message before a lower priority message and can also preempt a lower priority message to send a higher priority one and have the lower priority message resume when the higher is complete (prioritized concurrency) </P>

<P>&#8226; A sender requires no knowledge of the receiver&#8217;s internal structure or memory map </P>

<P>&#8226; A receiver of a message has complete control over it&#8217;s local address space </P>

<P>&#8226; A receiver can have a number of outstanding messages queued for servicing if desired </P>

<P>&#8226; A receiver can receive a number of concurrent multiple-transaction messages if desired </P>

<P> </P>

<P> </P>

<P>A.3 Message Operations </P>

<P> </P>

<P>The RapidIO Part 2: Message Passing Logical Specification defines the type 11 packet as the MESSAGE transaction format. The transaction may be used in a number of different ways dependent on the specific system architecture. The transaction header contains the following field definitions: </P>

<P>mbox               Specifies the recipient mailbox in the target processing element. </P>

<P>RapidIO allows up to four mailbox ports in each target device. This can be useful for defining blocks of different message frame sizes or different local delivery priority levels. </P>

<P>letter A RapidIO message operation may be made up of several transactions. It may be desirable in some systems to have more than one multi-transaction message concurrently in transit to the target mailbox. The letter identifies the specific message within the mailbox. This field allows a sending of up to four messages to the same mailbox in the same target device. </P>

<P>multi-transaction fieldsIn cases where message operations are made up of multiple transactions, the following fields allow reconstruction of a message transported through an unordered interconnect </P>

<P> </P>

<P>40 RapidIO Trade Association </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>fabric: </P>

<P> </P>

<P>msglen            Specifies the total number of transactions comprising this message. </P>

<P>A value of 0 indicates a single transaction message. A value of 15 (0xF) indicates a 16 transaction message, and so forth. </P>

<P> </P>

<P>msgseg Specifies the part of the message operation supplied by this transaction. A value of 0 indicates that this is the first transaction in the message. A value of 15 (0xF) indicates that this is the sixteenth transaction in the message, and so on. </P>

<P>ssize Standard message transaction data size. This field tells the receiver to expect a message the size of the data field for all of the transactions except the last one. This prevents the sender from having to pad the data field excessively for the last transaction and allows the receiver to properly put the message in local memory; otherwise, if the last transaction is the first one received, the address calculations will be in error when writing the transaction to memory. </P>

<P> </P>

<P>For a more detailed description of the message packet format, refer to Section 4.2.5, &#8220;Type 11 Packet Format (Message Class).&#8221; </P>

<P> </P>

<P>The second type of message packet is the type 10 doorbell transaction packet. The doorbell transaction is a lightweight transaction that contains only a 16-bit information field that is completely software defined. The doorbell is intended to be an in-band mechanism to send interrupts between processors. In this usage the information field would be used to convey interrupt level and target information to the recipient. For a more detailed description of the doorbell packet format, refer to Section 4.2.4, &#8220;Type 10 Packet Formats (Doorbell Class).&#8221; </P>

<P> </P>

<P>There are two transaction format models described in this appendix, a simple model and an extended model. The simple model is recommended for both the type 10 (doorbell) and type 11 (message) packet format messages. The extended model is only recommended for the type 11 (message) packet format messages. </P>

<P> </P>

<P> </P>

<P>A.4 Inbound Mailbox Structure </P>

<P> </P>

<P>RapidIO provides two message transaction packet formats. By nature of having such formats it is possible for one device to pass a message to another device without a specific memory mapped transaction. The transaction allows for the concept of a memory map independent port. As mentioned earlier, how the transactions are generated and what is done with them at the destination is beyond the scope of the RapidIO Part 2: Message Passing Logical Specification. There are, however, a few examples as to how they could be deployed. First, look at the destination of the message. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>A.4.1  Simple Inbox </P>

<P> </P>

<P>Probably the most simple inbound mailbox structure is that of a single-register port or direct map into local memory space (see Figure A-1). </P>

<P> </P>

<P> </P>

<P>Local Memory </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Local Processor </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_93.jpg"/>
</Figure>

<P>Read </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_94.jpg"/>
</Figure>

<P>Transactions from </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P>Tail Pointer </P>
</TD>

<TD>
<P> </P>

<P>Tail Pointer </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Head Pointer </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>Inbound Mailbox Port </P>
</TD>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_95.jpg"/>
</Figure>

<P>RapidIO Interface </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_96.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure A-1. Simple Inbound Mailbox Port Structure </P>

<P> </P>

<P>In this structure, the inbound single transaction message is posted to either a register, set of registers, or circular queue in local memory. In the case of the circular queue, hardware maintains a head and tail pointer that points at a  fixed window of pre-partitioned message frames in memory. Whenever the head pointer equals the tail pointer, no more messages can be accepted and they are retried on the RapidIO interface. When messages are posted, the local processor is interrupted. The interrupt service routine reads the mailbox port that contains the message located at the tail pointer. The message frame is equal to the largest message operation that can be received. </P>

<P> </P>

<P>The RapidIO MESSAGE transaction allows up to four such inbound mailbox ports per target address. The DOORBELL transaction is defined as a single mailbox port. </P>

<P> </P>

<P> </P>

<P>A.4.2  Extended Inbox </P>

<P> </P>

<P>A second more extensible structure similar to that used in the intelligent I/O (I2O) </P>

<P>specification, but managed differently, also works for the receiver (see Figure A-2). </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Transactions from </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_97.jpg"/>
</Figure>

<P>RapidIO Interface </P>

<P> </P>

<P> </P>

<P>Optional Letter Slots allow multiple </P>

<P>multi-transaction messages to </P>

<P>arrive in the </P>

<P>Inbox concurrently </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Local Processor </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_98.jpg"/>
</Figure>

<P>Write </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Letter Slot </P>
</TD>

<TD>
<P> </P>

<P>Inbound Mailbox Port </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Letter Slot </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Letter Slot </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Letter Slot </P>
</TD>

<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Head Pointer </P>

<P> </P>

<P> </P>

<P> </P>

<P>Tail Pointer </P>

<P> </P>

<P> </P>

<P>Head Pointer </P>

<P>Local Memory Local Memory </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>MFA </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>MFA </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>MFA </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Inbound </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_99.jpg"/>
</Figure>

<P>Free </P>

<P>List </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_100.jpg"/>
</Figure>

<P>FIFO </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Inbound </P>

<P>Post </P>

<P>List </P>

<P>FIFO </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Local Processor </P>

<P>Read </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Tail Pointer </P>

<P>MFA </P>

<P>MFA MFA MFA MFA </P>

<P> </P>

<P>Figure A-2. Inbound Mailbox Structure </P>

<P> </P>

<P>One of these structures is required for each priority level supported in an implementation. There are inbound post and free list FIFOs which function as circular queues of a fixed size. The message frames are of a size equal to the maximum message size that can be accepted by the receiver. Smaller messages can be accepted if allowed by the overlaying software. The sender only specifies the mailbox and does not request the frame pointer and perform direct memory access as with I2O, although the I2O model can be supported in software with this structure. All pointers are managed by the inbound hardware and the local processor. Message priority and letter number are managed by software. </P>

<P> </P>

<P>The advantage of the extended structure is that it allows local software to service message frames in any order. It also allows memory regions to be moved in and out of the message structure instead of forcing software to copy the message to a different memory location. </P>

<P> </P>

<P> </P>

<P>A.4.3  Received Messages </P>

<P> </P>

<P>When a message transaction is received, the inbound mailbox port takes the message frame address (MFA) pointed at by the inbound free list tail pointer and increments that pointer (this may cause a memory read to prefetch the next MFA), effectively taking the MFA from the free list. Subsequent message transactions from a different sender or with a different letter number are now retried until all of the transactions for this message operation have been received, unless there is additional hardware to handle multiple concurrent message operations for the same mailbox, differentiated by the letter slots. </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 43 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The inbound mailbox port uses the MFA to write the transaction data into local memory at that base address with the exact address calculated as described in Section 2.3.1,  &#8220;Data  Message  Operations&#8221;  and  Section 3.3.2,  &#8220;Data  Message Operations.&#8221; When the entire message is received and written into memory, the inbound post list pointer is incremented and the MFA is written into that location. If the queue was previously empty, an interrupt is generated to the local processor to indicate that there is a new message pending. This causes a window where the letter hardware is busy and cannot service a new operation between the receipt of the final transaction and the MFA being committed to the local memory. </P>

<P> </P>

<P>When the local processor services a received message, it reads the MFA indicated by the inbound post FIFO tail pointer and increments the tail pointer. When the message has been processed (or possibly deferred), it puts a new MFA in the memory address indicated by the inbound free list head pointer and increments that pointer, adding the new MFA to the free list for use by the inbound message hardware. </P>

<P> </P>

<P>If the free list head and tail pointer are the same, the FIFO is empty and there are no more MFAs available and all new messages are retried. If the post list head and tail pointers are the same, there are no outstanding messages awaiting service from the local processor. Underflow conditions are fatal since they indicate improper system behavior. This information can be part of an associated status register. </P>

<P> </P>

<P> </P>

<P>A.5 Outbound Message Queue Structure </P>

<P> </P>

<P>Queueing messages in RapidIO is accomplished either through a simple or a more extended outbox. </P>

<P> </P>

<P> </P>

<P>A.5.1  Simple Outbox </P>

<P> </P>

<P>Generation of a message can be as simple as writing to a memory-mapped descriptor structure either in local registers or memory. The outbound message queue (see Figure A-3) looks similar to the inbox. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Transactions to </P>

<P>RapidIO Interface </P>

<P> </P>

<P> </P>

<P>Local Processor </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_101.jpg"/>
</Figure>

<P>Write </P>

<P> </P>

<P> </P>

<P> </P>

<P>Outbound Mailbox Port </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Head Pointer </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Tail Pointer </P>

<P>Local Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure A-3. Outbound Message Queue </P>

<P> </P>

<P>44 RapidIO Trade Association </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>The local processor reads a port in the outbound mailbox to obtain the position of a head pointer in local memory. If the read results in a pre-determined pattern the message queue is full. The processor then writes a descriptor structure and message to that location. When it is done, it writes the message port to advance the head point and mark the message as queued. The outbound mailbox hardware then reads the messages pointed to by the tail pointer and transfers them to the target device pointed at by the message descriptor. </P>

<P> </P>

<P>One of these structures is required for each priority level of outbound messages supported. </P>

<P> </P>

<P> </P>

<P>A.5.2  Extended Outbox </P>

<P> </P>

<P>A more extensible method of queueing messages is again a two-level approach (see Figure A-4). Multiple structures are required if concurrent operation is desired in an implementation. The FIFO is a circular queue of some fixed size. The message frames are of a size that is equal to the maximum message operation size that can be accepted by the receivers in the system. Smaller message operations can be sent if allowed by the hardware and the overlaying software. As with the receive side, the outbound slots can be virtual and any letter number can be handled by an arbitrary letter slot. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Transactions to </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_102.jpg"/>
</Figure>

<P>RapidIO Interface </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_103.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Local Processor </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_104.jpg"/>
</Figure>

<P>Write </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_105.jpg"/>
</Figure>

<P>Head Pointer </P>

<P> </P>

<P> </P>

<P>Local Memory </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_106.jpg"/>
</Figure>

<P>Outbound </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>MFD </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>MFD </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>MFD </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>MFD </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>MFD </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Post </P>

<P>List </P>

<P>FIFO </P>

<P>Local Memory </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_107.jpg"/>
</Figure>

<P>Tail Pointer </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>

<TR>
<TD>
<P>Message </P>

<P>Frame </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<Textbox>
<Table>
<TR>
<TD>
<P>Letter Slot </P>
</TD>

<TD>
<P> </P>

<P>Outbound Mailbox Port </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Letter Slot </P>
</TD>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Letter Slot </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Letter Slot </P>
</TD>

<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_108.jpg"/>
</Figure>

<P>Figure A-4. Extended Outbound Message Queue </P>

<P> </P>

<P>When the local processor wishes to send a message, it stores the message in local memory, writes the message frame descriptor (MFD) to the outbound mailbox port (which in-turn writes it to the location indicated by the outbound post FIFO head pointer), and increments the head pointer. </P>

<P> </P>

<P>The advantage of this method is that software can have pre-set messages stored in local memory. Whenever it needs to communicate an event to a specific end point it writes the address of the message frame to the outbound mailbox, and the outbound mailbox generates the message transactions and completes the operation. </P>

<P> </P>

<P>If the outbound post list FIFO head and tail pointers are not equal, there is a message waiting to be sent. This causes the outbound mailbox port to read the MFD pointed </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 45 </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>to by the outbound post list tail pointer and then increment the pointer (this may cause a memory read to prefetch the next MFD). The hardware then uses the information stored in the MFD to read the message frame, packetize it, and transmit it to the receiver. Multiple messages can be transmitted concurrently if there is hardware to support them, differentiated by the letter slots in Figure A-4. </P>

<P> </P>

<P>If the free list head and tail pointer are the same, the FIFO is empty and there are no more MFDs to be processed. Underflow conditions are fatal because they indicate improper system behavior. This information can also be part of a status register. </P>

<P> </P>

<P>Because the outbound and inbound hardware are independent entities, it is possible for more complex outbound mailboxes to communicate with less complex inboxes by simply reducing the complexity of the message descriptor to match. Likewise simple outboxes can communicate with complex inboxes. Software can determine the capabilities of a device during initial system setup. The capabilities of a devices message hardware are stored in the port configuration registers. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_109.jpg"/>
</Figure>

<P>A Agent. A processing element that provides services to a processor. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_110.jpg"/>
</Figure>

<P>B Big-endian. A byte-ordering method in memory where the address n of a word corresponds to the most significant byte. In an addressed memory word, the bytes are ordered (left to right) 0, 1, 2, 3, with 0 </P>

<P>being the most significant byte. </P>

<P> </P>

<P>Bridge. A processing element that connects one computer bus to another, allowing a processing element on one bus to access an processing element on the other. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_111.jpg"/>
</Figure>

<P>C Capability registers (CARs). A set  of  read-only registers that  allows  a processing  element  to  determine  another  processing  element&#8217;s </P>

<P>capabilities. </P>

<P> </P>

<P>CCITT. Consultive Communication for International  Telegraph and </P>

<P>Telephone. </P>

<P> </P>

<P>Command and status registers (CSRs). A set of registers that allows a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_112.jpg"/>
</Figure>

<P>D Deadlock. A situation in which two processing elements that are sharing resources prevent each other from accessing the resources, resulting in a halt of system operation. </P>

<P> </P>

<P>Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Direct Memory Access (DMA). The process of accessing memory in a device by specifying the memory address directly. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Distributed memory. System memory that is distributed throughout the system, as opposed to being centrally located. </P>

<P> </P>

<P>Doorbell. A port on a device that is capable of generating an interrupt to a processor. </P>

<P> </P>

<P>Double-word. An eight byte quantity, aligned on eight byte boundaries. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_113.jpg"/>
</Figure>

<P>E End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>End  point  device.  A  processing  element  which  contains  end  point functionality. </P>

<P> </P>

<P>Ethernet. A common local area network (LAN) technology. </P>

<P> </P>

<P>External  processing  element.  A  processing  element  other  than  the processing element in question. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_114.jpg"/>
</Figure>

<P>F Field or Field name. A sub-unit of a register, where bits in the register are named and defined. </P>

<P> </P>

<P>FIFO. First in, first out. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_115.jpg"/>
</Figure>

<P>G Globally shared memory (GSM). Cache coherent system memory that can be shared between multiple processors in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_116.jpg"/>
</Figure>

<P>H Half-word. A two byte or 16 bit quantity, aligned on two byte boundaries. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_117.jpg"/>
</Figure>

<P>I I2O. Intelligent I/O architecture specification. </P>

<P> </P>

<P>Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P>I/O. Input-output. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_118.jpg"/>
</Figure>

<P>L Little-endian. A byte-ordering method in memory where the address n of a word corresponds to the least significant byte. In an addressed memory word, the bytes are ordered (left to right) 3, 2, 1, 0, with 3 </P>

<P>being the most significant byte. </P>

<P> </P>

<P>Local memory. Memory associated with the processing element in question. </P>

<P> </P>

<P>LSB. Least significant byte. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_119.jpg"/>
</Figure>

<P>M Mailbox. Dedicated hardware that receives messages. </P>

<P> </P>

<P>48 RapidIO Trade Association </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Message passing. An application programming model that allows processing elements to communicate via messages to mailboxes instead of via DMA or GSM. Message senders do not write to a memory address in the receiver. </P>

<P> </P>

<P>MFA. Message frame address. </P>

<P> </P>

<P>MFD. Message frame descriptor. </P>

<P> </P>

<P>MSB. Most significant byte. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_120.jpg"/>
</Figure>

<P>N Non-coherent. A transaction that does not participate in any system globally shared memory cache coherence mechanism. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_121.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_122.jpg"/>
</Figure>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>

<P>system. </P>

<P> </P>

<P>PCB. Printed circuit board. </P>

<P> </P>

<P>Peripheral component interface (PCI). A bus commonly used for connecting I/O devices in a system. </P>

<P> </P>

<P>Priority. The relative importance of a transaction or packet; in most systems a higher priority transaction or packet will be serviced or transmitted before one of lower priority. </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P>Processor. The logic circuitry that responds to and processes the basic instructions that drive a computer. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_123.jpg"/>
</Figure>

<P>R Receiver. The RapidIO interface input port on a processing element. </P>

<P> </P>

<P>Remote memory. Memory associated with a processing element other than the processing element in question. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_124.jpg"/>
</Figure>

<P>S Sender. The RapidIO interface output port on a processing element. </P>

<P> </P>

<P>Semaphore. A technique for coordinating activities in which multiple processing elements compete for the same resource, typically requiring atomic operations. </P>

<P>RapidIO Part 2: Message Passing Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on one of its input ports to one of its output ports. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_125.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_126.jpg"/>
</Figure>

<P>W Word. A four byte or 32 bit quantity, aligned on four byte boundaries. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_127.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 3: Common Transport Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_128.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.1 </P>
</TD>

<TD>
<P>First public release </P>
</TD>

<TD>
<P>03/08/2001 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.2 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>06/26/2002 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: the following new features showings: </P>

<P>03-01-00002.006, 03-03-00002.002 </P>

<P>Converted to ISO-friendly templates; re-formatted </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: errata showing 06-02-00001.005 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Technical changes: errata showings 10-08-00000.003, 10-08-00001.005, Consolidated Comments on 11-01-00000.000 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction............................................................................................................. 9 </P>

<P>1.2 Overview................................................................................................................. 9 </P>

<P>1.3 Transport Layer Features ........................................................................................ 9 </P>

<P>1.3.1 Functional Features............................................................................................. 9 </P>

<P>1.3.2 Physical Features .............................................................................................. 10 </P>

<P>1.3.3 Performance Features ....................................................................................... 10 </P>

<P>1.4 Contents ................................................................................................................ 10 </P>

<P>1.5 Terminology.......................................................................................................... 10 </P>

<P>1.6 Conventions .......................................................................................................... 10 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Transport Format Description </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 13 </P>

<P>2.2 System Topology .................................................................................................. 13 </P>

<P>2.2.1 Switch-Based Systems ...................................................................................... 13 </P>

<P>2.2.2 Ring-Based Systems ......................................................................................... 14 </P>

<P>2.3 System Packet Routing ......................................................................................... 15 </P>

<P>2.4 Field Alignment and Definition ............................................................................ 16 </P>

<P>2.5 Routing Maintenance Packets............................................................................... 16 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Common Transport Registers </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 19 </P>

<P>3.2 Register Summary................................................................................................. 19 </P>

<P>3.3 Reserved Register, Bit and Bit Field Value Behavior .......................................... 20 </P>

<P>3.4 Capability Registers (CARs) ................................................................................ 22 </P>

<P>3.4.1 Processing Element Features CAR (Configuration Space Offset 0x10) .......... 22 </P>

<P>3.4.2 Switch Route Table Destination ID Limit CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x34)................................................................23 </P>

<P>3.5 Command and Status Registers (CSRs)................................................................ 24 </P>

<P>3.5.1 Base Device ID CSR (Configuration Space Offset 0x60) ................................ 24 </P>

<P>3.5.2 Host Base Device ID Lock CSR (Configuration Space Offset 0x68) .............. 25 </P>

<P>3.5.3 Component Tag CSR (Configuration Space Offset 0x6C)............................... 26 </P>

<P>3.5.4 Standard Route Configuration Destination ID Select CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x70)................................................................27 </P>

<P>3.5.5 Standard Route Configuration Port Select CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x74)................................................................28 </P>

<P>3.5.6 Standard Route Default Port CSR (Configuration Space Offset 0x78)............ 29 </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>2-1 A Small Switch-Based System .......................................................................................14 </P>

<P>2-2 A Small Ring-Based System...........................................................................................15 </P>

<P>2-3 Destination-Source Transport Bit Stream .......................................................................16 </P>

<P>2-4 Maintenance Packet Transport Bit Stream .....................................................................17 </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>2-1 tt Field Definition............................................................................................................16 </P>

<P>3-1 Common Transport Register Map ..................................................................................19 </P>

<P>3-2 Configuration Space Reserved Access Behavior............................................................20 </P>

<P>3-3 Bit Settings for Processing Element Features CAR........................................................22 </P>

<P>3-4 Bit Settings for Switch Route Table Destination ID Limit CAR ...................................23 </P>

<P>3-5 Bit Settings for Base Device ID CSR .............................................................................24 </P>

<P>3-6 Bit Settings for Host Base Device ID Lock CSR ...........................................................25 </P>

<P>3-7 Bit Settings for Component ID CSR...............................................................................26 </P>

<P>3-8 Bit Settings for Standard Route Configuration Destination ID Select CSR ...................27 </P>

<P>3-9 Bit Settings for Standard Route Configuration Port Select CSR ....................................28 </P>

<P>3-10 Bit Settings for Standard Route Default Port CSR .........................................................29 </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>This chapter provides an overview of the RapidIO Part 3: Common Transport Specification, including a description of the relationship between this specification and the other specifications of the RapidIO interconnect. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>The RapidIO Part 3: Common Transport Specification defines a standard transport mechanism. In doing so, it specifies the header information added to a RapidIO logical packet and the way the header information is interpreted by a switching fabric. The RapidIO interconnect defines this mechanism independent of a physical implementation. The physical features of an implementation using RapidIO are defined by the requirements of the implementation, such as I/O signaling levels, interconnect topology, physical layer protocol, and error detection. These requirements are specified in the appropriate RapidIO physical layer specification. </P>

<P> </P>

<P>This transport specification is also independent of any RapidIO logical layer specification. </P>

<P> </P>

<P> </P>

<P>1.3 Transport Layer Features </P>

<P> </P>

<P>The transport layer functions of the RapidIO interconnect have been addressed by incorporating the following functional, physical, and performance features. </P>

<P> </P>

<P> </P>

<P>1.3.1  Functional Features </P>

<P> </P>

<P>Functional features at the transport layer include the following: </P>

<P> </P>

<P>&#8226; System sizes from very small to very large are supported in the same or compatible packet formats. </P>

<P>&#8226; Because RapidIO has only a single transport specification, compatibility among implementations is assured. </P>

<P>&#8226; The transport specification is flexible, so that it can be adapted to future applications. </P>

<P>&#8226; Packets are assumed, but not required, to be directed from a single source to a single destination. </P>

<P> </P>

<P>RapidIO Trade Association 9 </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1.3.2  Physical Features </P>

<P> </P>

<P>The following are physical features of the RapidIO fabric that apply at the transport layer: </P>

<P> </P>

<P>&#8226; The transport definition is independent of the width of the physical interface between devices in the interconnect fabric. </P>

<P>&#8226; No requirement exists in RapidIO for geographical addressing; a device&#8217;s identifier does not depend on its location in the address map but can be assigned by other means. </P>

<P> </P>

<P> </P>

<P>1.3.3  Performance Features </P>

<P> </P>

<P>Performance features that apply to the transport layer include the following: </P>

<P> </P>

<P>&#8226; Packet headers are as small as possible to minimize the control overhead and are organized for fast, efficient assembly and disassembly. </P>

<P>&#8226; Broadcasting and multicasting can be implemented by interpreting the transport information in the interconnect fabric. </P>

<P>&#8226; Certain devices have bandwidth and latency requirements for proper operation. </P>

<P>RapidIO does not preclude an implementation from imposing these constraints within the system. </P>

<P> </P>

<P> </P>

<P>1.4 Contents </P>

<P> </P>

<P>RapidIO Part 3: Common Transport Specification contains three chapters: </P>

<P> </P>

<P>&#8226; Chapter 1, &#8220;Overview&#8221; (this chapter) provides an overview of the specification </P>

<P>&#8226; Chapter 2, &#8220;Transport Format Description,&#8221; describes the routing methods used in RapidIO for sending packets across the systems of switches described in this chapter. </P>

<P>&#8226; Chapter 3, &#8220;Common Transport Registers,&#8221; describes the visible register set that allows an external processing element to determine the capabilities, configuration, and status of a processing element using this RapidIO transport layer definition. </P>

<P> </P>

<P> </P>

<P>1.5 Terminology </P>

<P> </P>

<P>Refer to the Glossary at the back of this document. </P>

<P> </P>

<P> </P>

<P>1.6 Conventions </P>

<P>|| Concatenation, used to indicate that two fields are physically associated as consecutive bits </P>

<P> </P>

<P>ACTIVE_HIGH Names of active high signals are shown in uppercase text with </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>no overbar. Active-high signals are asserted when high and not asserted when low. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_129.jpg"/>
</Figure>

<P>ACTIVE_LOW Names of active low signals are shown in uppercase text with an overbar. Active low signals are asserted when low and not asserted when high. </P>

<P>italics Book titles in text are set in italics. </P>

<P> </P>

<P>REG[FIELD] Abbreviations or acronyms for registers are shown in uppercase text. Specific bits, fields, or ranges appear in brackets. </P>

<P>TRANSACTION Transaction types are expressed in all caps. operation Device operation types are expressed in plain text. n A decimal value. </P>

<P>[n-m] Used to express a numerical range from n to m. </P>

<P> </P>

<P>0bnn A binary value, the number of bits is determined by the number of digits. </P>

<P>0xnn A hexadecimal value, the number of bits is determined by the number of digits or from the surrounding context; for example, 0xnn may be a 5, 6, 7, or 8 bit value. </P>

<P>x This value is a don&#8217;t care </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Transport Format Description </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This chapter contains the transport format definition for the RapidIO Part 3: Common Transport Specification. Three transport fields are added to the packet formats described in the RapidIO logical specifications. The transport formats are intended to be fabric independent so the system interconnect can be anything required for a particular application; therefore all descriptions of the transport fields and their relationship with the logical packets are shown as bit streams. </P>

<P> </P>

<P> </P>

<P>2.2 System Topology </P>

<P> </P>

<P>RapidIO is intended to be interconnect fabric independent. This section describes several of the possible system topologies and routing methodologies allowed by the processing element models described in the Models chapters of the different Logical Specifications. </P>

<P> </P>

<P> </P>

<P>2.2.1  Switch-Based Systems </P>

<P> </P>

<P>A RapidIO system can be organized around the concept of switches. Figure 2-1 shows a small system in which five processing elements are interconnected through two switches. A logical packet sent from one processing element to another is routed through the interconnect fabric by the switches by interpreting the transport fields. Because a request usually requires a response, the transport fields must somehow indicate the return path from the requestor to the responder. </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_130.jpg"/>
</Figure>

<P>ID=12 </P>

<P>Processing </P>

<P>Element </P>

<P>Processing </P>

<P>Element </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_131.jpg"/>
</Figure>

<P>ID=4 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_132.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_133.jpg"/>
</Figure>

<P>ID=7 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_134.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_135.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Processing </P>

<P>Element </P>

<P>Switch </P>

<P>Element </P>

<P>Switch </P>

<P>Element </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_136.jpg"/>
</Figure>

<P>ID=2 </P>

<P>Processing </P>

<P>Element </P>

<P>Processing </P>

<P>Element </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_137.jpg"/>
</Figure>

<P>ID=9 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 2-1. A Small Switch-Based System </P>

<P> </P>

<P>2.2.2  Ring-Based Systems </P>

<P> </P>

<P>A simplification of the switch structure is a ring as shown in Figure 2-2. A ring is a point-to-point version of a common bus; therefore, it is required to have a unique identifier for each processing element in the system. A packet put onto the ring contains the source and destination identifier in the transport fields. Each packet issued is examined by the downstream processing element. If that processing element&#8217;s identifier matches that of the destination, it removes the packet from the ring for processing. If the destination identifier does not match the packet, it is passed to the next processing element in the ring. </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>ID=12 </P>

<P>Processing </P>

<P>Element </P>

<P>Processing </P>

<P>Element </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_138.jpg"/>
</Figure>

<P>ID=4 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_139.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>ID=7 </P>

<P>Processing </P>

<P>Element </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_140.jpg"/>
</Figure>

<P>ID=2 </P>

<P>Processing </P>

<P>Element </P>

<P>Processing </P>

<P>Element </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_141.jpg"/>
</Figure>

<P>ID=9 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 2-2. A Small Ring-Based System </P>

<P> </P>

<P>2.3 System Packet Routing </P>

<P> </P>

<P>There are many algorithms that can be used for routing through a system. The RapidIO Part 3: Common Transport Specification requires device identifier based packet routing. Each directly addressable device in the system shall have one or more unique device identifiers. When a packet is generated, the device ID of the destination of the packet is put in the packet header. The device ID of the source of the packet is also put in the packet header for use by the destination when generating response packets. All devices must provide a mechanism such that the receiver of a request shall process any received supported request regardless of device ID values. When the destination of a request packet generates a response packet, it swaps the source and destination fields from the request, making the original source the new destination. Many applications and system designers may require that devices also provide some means to restrict processing requests to a list of acceptable device IDs. For those applications, it is recommended, however, that a device process all maintenance read requests. The behavior when a request is received with a device ID that is not on the acceptable list is implementation-dependant. Packets are routed through the fabric based on the destination device ID. </P>

<P> </P>

<P>One method of routing packets in a switch fabric using device ID information incorporates routing tables. Each switch in the interconnect fabric contains a table that tells the switch how to route every destination ID from an input port to the proper output port. The simplest form of this method allows only a single path from every processing element to every other processing element. More complex forms of this method may allow adaptive routing for redundancy and congestion relief. However, the actual method by which packets are routed between the input of a switch and the output of a switch is implementation dependent. </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.4 Field Alignment and Definition </P>

<P> </P>

<P>The RapidIO Part 3: Common Transport Specification adds a transport type (tt) field to the logical specification packet that allows four different transport packet types to be specified. The tt field indicates which type of additional transport fields are added to the packet. </P>

<P> </P>

<P>The three fields (tt, destinationID, and sourceID) added to the logical packets allow for two different sizes of the device ID fields, a large (16-bit), and a small (8-bit), as shown in Table 2-1. The two sizes of device ID fields allow two different system scalability points to optimize packet header overhead, and only affix additional transport field overhead if the additional addressing is required. The small device ID fields allow a maximum of 256 devices to be attached to the fabric. The large device ID fields allow systems with up to 65,536 devices. </P>

<P> </P>

<P>Table 2-1. tt Field Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>tt </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00 </P>
</TD>

<TD>
<P>8-bit deviceID fields </P>
</TD>
</TR>

<TR>
<TD>
<P>0b01 </P>
</TD>

<TD>
<P>16-bit deviceID fields </P>
</TD>
</TR>

<TR>
<TD>
<P>0b10 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b11 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_142.jpg"/>
</Figure>

<P>Figure 2-3 shows the transport header definition bit stream. The shaded fields are the bits associated with the logical packet definition that are related to the transport bits. Specifically, the field labeled &#8220;Logical ftype&#8221; is the format type field defined in the logical specifications. This field comprises the first four bits of the logical packet. The second logical field shown (&#8220;Remainder of logical packet&#8221;) is the remainder of the logical packet of a size determined by the logical specifications, not including the logical ftype field which has already been included in the combined bit stream. The unshaded fields (tt=0b00 or tt=0b01 and destinationID and sourceID fields) are the transport fields added to the logical packet by the common transport specification. </P>

<P> </P>

<P> </P>

<P>tt=0m </P>

<P>Logical ftype destinationID </P>

<P>sourceID </P>

<P> </P>

<P>2 4 8 or 16 </P>

<P> </P>

<P>8 or 16 </P>

<P> </P>

<P> </P>

<P>Remainder of logical packet </P>

<P> </P>

<P>n </P>

<P> </P>

<P>Figure 2-3. Destination-Source Transport Bit Stream </P>

<P> </P>

<P>2.5 Routing Maintenance Packets </P>

<P> </P>

<P>Routing maintenance packets in a switch-based network may be difficult because a switch processing element may not have its own device ID. An alternative method </P>

<P> </P>

<P> </P>

<P>16 RapidIO Trade Association </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>of addressing for maintenance packets for these devices uses an additional hop_count field in the packet to specify the number of switches (or hops) into the network from the issuing processing element that is being addressed. Whenever a switch processing element that does not have as associated device ID receives a maintenance packet it examines the hop_count field. If the received hop_count is zero, the access is for that switch. If the hop_count is not zero, it is decremented and the packet is sent out of the switch according to the destinationID field. This method allows easy access to any intervening switches in the path between two addressable processing elements. However, since maintenance response packets are always targeted at an end point, the hop_count field shall always be assigned a value of </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_143.jpg"/>
</Figure>

<P>0xFF by the source of the packets to prevent them from being inadvertently accepted by an intervening device. Figure 2-4 shows the transport layer fields added to a maintenance logical packet. Maintenance logical packets can be found in the RapidIO Part 1: Input/Output Logical Specification. </P>

<P> </P>

<P> </P>

<P>tt=0m </P>

<P>ftype=0b1000 destinationID </P>

<P>sourceID </P>

<P> </P>

<P>2 4 8 or 16 </P>

<P> </P>

<P>8 or 16 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Logical transaction, dsize/status, TID fields </P>
</TD>

<TD>
<P>hop_count </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>16 8 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Remainder of logical packet </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_144.jpg"/>
</Figure>

<P>n </P>

<P> </P>

<P>Figure 2-4. Maintenance Packet Transport Bit Stream </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Common Transport Registers </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This chapter describes the visible register set that allows an external processing element to determine the capabilities, configuration, and status of a processing element using this transport layer definition. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and  bit  definitions. All  registers are  32-bits and  aligned to  a  32-bit boundary. </P>

<P> </P>

<P> </P>

<P>3.2 Register Summary </P>

<P> </P>

<P>Table 3-1 shows the register address map for this RapidIO specification. These capability registers (CARs) and command and status registers (CSRs) can be accessed using RapidIO Part 1: Input/Output Logical Specification maintenance operations. Any register offsets not defined are considered reserved for this specification unless otherwise stated. Other registers required for a processing element are defined in other applicable RapidIO specifications and by the requirements of the specific device and are beyond the scope of this specification. Read and write accesses to reserved register offsets shall terminate normally and not cause an error condition in the target device. Writes to CAR (read-only) space shall terminate normally and not cause an error condition in the target device. </P>

<P> </P>

<P>Register bits defined as reserved are considered reserved for this specification only. Bits that are reserved in this specification may be defined in another RapidIO specification. </P>

<P> </P>

<P>Table 3-1. Common Transport Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0-C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10 </P>
</TD>

<TD>
<P>Processing Element Features CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x14&#8211;30 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x34 </P>
</TD>

<TD>
<P>Switch Route Table Destination ID Limit CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x38-5C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 3-1. Common Transport Register Map (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x60 </P>
</TD>

<TD>
<P>Base Device ID CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x64 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x68 </P>
</TD>

<TD>
<P>Host Base Device ID Lock CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x6C </P>
</TD>

<TD>
<P>Component Tag CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x70 </P>
</TD>

<TD>
<P>Standard Route Configuration Destination ID Select CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x74 </P>
</TD>

<TD>
<P>Standard Route Configuration Port Select CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Standard Route Default Port CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x7C&#8211;FC </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P> </P>

<P>Extended Features Space </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P> </P>

<P>Implementation-defined Space </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.3 Reserved Register, Bit and Bit Field Value Behavior </P>

<P> </P>

<P>Table 3-2 describes the required behavior for accesses to reserved register bits and reserved registers for the RapidIO register space, </P>

<P> </P>

<P>Table 3-2. Configuration Space Reserved Access Behavior </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0&#8211;3C </P>
</TD>

<TD>
<P>Capability Register Space (CAR Space - this space is read-only) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value1 </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>Table 3-2. Configuration Space Reserved Access Behavior (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x40&#8211;FC </P>
</TD>

<TD>
<P>Command and Status Register Space (CSR Space) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value2 </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P>Extended Features Space </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P>Implementation-defined </P>

<P>Space </P>
</TD>

<TD>
<P>Reserved bit and register </P>
</TD>

<TD>
<P>All behavior implementation-defined </P>
</TD>
</TR>
</Table>

<P>1Do not depend on reserved bits being a particular value; use appropriate masks to extract defined bits from the read value. </P>

<P>2All register writes shall be in the form: read the register to obtain the values of all reserved bits, merge in the desired values for defined bits to be modified, and write the register, thus preserving the value of all reserved bits. </P>

<P> </P>

<P>When  a  writable  bit  field  is  set  to  a  reserved  value,  device  behavior  is implementation specific. </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.4 Capability Registers (CARs) </P>

<P> </P>

<P>Every processing element shall contain a set of registers that allows an external processing element to determine its capabilities using the I/O logical maintenance read operation. All registers are 32 bits wide and are organized and accessed in </P>

<P>32-bit (4 byte) quantities, although some processing elements may optionally allow larger accesses. CARs are read-only. Refer to Table 3-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>CARs are big-endian with bit 0 the most significant bit. </P>

<P> </P>

<P> </P>

<P>3.4.1  Processing Element Features CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x10) </P>

<P> </P>

<P>The processing element features CAR identifies the major functionality provided by the processing element. The bit settings are shown in Table 3-3. </P>

<P> </P>

<P>Table 3-3. Bit Settings for Processing Element Features CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bits </P>
</TD>

<TD>
<P>Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;21 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>22 </P>
</TD>

<TD>
<P>Extended route table configuration support </P>
</TD>

<TD>
<P>0b0 - Switch PE does not support the extended route table configuration mechanism&#61472;&#61472;</P>

<P>0b1 - Switch PE supports the extended route table configuration mechanism (can only be set if bit 23 is set) </P>
</TD>
</TR>

<TR>
<TD>
<P>23 </P>
</TD>

<TD>
<P>Standard route table configuration support </P>
</TD>

<TD>
<P>0b0 - Switch PE does not support the standard route table configuration mechanism&#61472;&#61472;</P>

<P>0b1 - Switch PE supports the standard route table configuration mechanism </P>
</TD>
</TR>

<TR>
<TD>
<P>24&#8211;26 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Common transport large system support </P>
</TD>

<TD>
<P>0b0 - PE does not support common transport large systems&#61472;&#61472;</P>

<P>0b1 - PE supports common transport large systems </P>
</TD>
</TR>

<TR>
<TD>
<P>28&#8211;31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>3.4.2  Switch Route Table Destination ID Limit CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x34) </P>

<P> </P>

<P>The Switch Route Table Destination ID Limit CAR specifies the maximum destination ID value that can be programmed with the standard route table configuration mechanism, and thereby indirectly defining the size of the route table. A route table access or extended route table access attempt to destination IDs greater than that specified in this register will have undefined results. This register is required if bit 23 of the Processing Element Features CAR is set. The bit settings are shown in Table 3-4. </P>

<P> </P>

<P>Table 3-4. Bit Settings for Switch Route Table Destination ID Limit CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bits </P>
</TD>

<TD>
<P>Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;15 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;31 </P>
</TD>

<TD>
<P>Max_destID </P>
</TD>

<TD>
<P>Maximum configurable destination ID </P>

<P>0x0000 - 1 destination ID&#61472;&#61472;</P>

<P>0x0001 - 2 destination IDs&#61472;&#61472;</P>

<P>0x0002 - 3 destination IDs&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xFFFF - 65536 destination IDs </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.5 Command and Status Registers (CSRs) </P>

<P> </P>

<P>A processing element shall contain a set of registers that allows an external processing element to control and determine status of its internal hardware. All registers are 32 bits wide and are organized and accessed in the same way as the CARs. Refer to Table 3-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P> </P>

<P>3.5.1  Base Device ID CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x60) </P>

<P> </P>

<P>The base device ID CSR contains the base device ID values for the processing element. A device may have multiple device ID values, but these are not defined in a standard CSR. The bit settings are shown in Table 3-5. </P>

<P> </P>

<P>Table 3-5. Bit Settings for Base Device ID CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>Base_deviceID </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>This is the base ID of the device in a small common transport system (end point devices only) </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;31 </P>
</TD>

<TD>
<P>Large_base_deviceID </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>This is the base ID of the device in a large common transport system (only valid for end point device and if bit 27 of the Processing Element Features CAR is set) </P>
</TD>
</TR>
</Table>

<P>1The Base_deviceID reset value is implementation dependent </P>

<P>2The Large_base_deviceID reset value is implementation dependent </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>3.5.2  Host Base Device ID Lock CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x68) </P>

<P> </P>

<P>The host base device ID lock CSR contains the base device ID value for the processing element in the system that is responsible for initializing this processing element. The Host_base_deviceID field is a write-once/reset-able field which provides a lock function. Once the Host_base_deviceID field is written, all subsequent writes to the field are ignored, except in the case that the value written matches the value contained in the field. In this case, the register is re-initialized to </P>

<P>0xFFFF. After writing the Host_base_deviceID field a processing element must then read the Host Base Device ID Lock CSR to verify that it owns the lock before attempting to initialize this processing element. The bit settings are shown in Table 3-6. </P>

<P> </P>

<P>Table 3-6. Bit Settings for Host Base Device ID Lock CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;31 </P>
</TD>

<TD>
<P>Host_base_deviceID </P>
</TD>

<TD>
<P>0xFFFF </P>
</TD>

<TD>
<P>This is the base device ID for the PE that is initializing this PE. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>3.5.3  Component Tag CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x6C) </P>

<P> </P>

<P>The component tag CSR contains a component tag value for the processing element and can be assigned by software when the device is initialized. It is especially useful for labeling and identifying devices that are not end points and do not have device ID registers. The bit settings are shown in Table 3-7. </P>

<P> </P>

<P>Table 3-7. Bit Settings for Component ID CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;31 </P>
</TD>

<TD>
<P>component_tag </P>
</TD>

<TD>
<P>All 0s </P>
</TD>

<TD>
<P>This is a component tag for the PE. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>3.5.4  Standard Route Configuration Destination ID Select CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x70) </P>

<P> </P>

<P>The Standard Route Configuration Destination ID Select CSR specifies the destination ID entry in the switch routing table to access when the Standard Route Configuration Port Select CSR is read or written. </P>

<P> </P>

<P>The Ext_config_en bit controls whether the extended route table configuration mechanism is enabled. If the extended route table configuration mechanism is enabled, the specified destination ID and the next three sequential destination IDs are written or read when the Standard Route Configuration Port Select CSR accessed. Extended accesses that increment past the maximum specifiable destination ID (for example, starting an extended access at device ID 0xFF in a small transport system), has undefined results. </P>

<P> </P>

<P>This register is required if bit 22 of the Processing Element Features CAR is set. The bit settings are shown in Table 3-8. </P>

<P> </P>

<P>Table 3-8. Bit Settings for Standard Route Configuration Destination ID Select CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Ext_config_en </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Extended Configuration Enable&#61472;&#61472;</P>

<P>0b0 - Extended configuration support is disabled&#61472;&#61472;</P>

<P>0b1 - Extended configuration support is enabled (only valid if bit 22 of the </P>

<P>Processing Element Features CAR is set) </P>
</TD>
</TR>

<TR>
<TD>
<P>1-15 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>16-23 </P>
</TD>

<TD>
<P>Config_destID_msb </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Configuration destination ID most significant byte (only valid if bit 27 of the Processing Element Features CAR is set and the processing element is configured to operate in large transport mode) </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>Config_destID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Configuration destination ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>3.5.5  Standard Route Configuration Port Select CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x74) </P>

<P> </P>

<P>When written, the Standard Route Configuration Port Select CSR updates the switch output port configuration for packets with the destination ID selected by the Standard Route Configuration Destination ID Select CSR. When read, the Standard Route Configuration Port Select CSR returns the switch output port configuration for packets with the destination ID selected by the Standard Route Configuration Destination ID Select CSR. </P>

<P> </P>

<P>If the extended route table configuration mechanism is enabled, when the Standard Route Configuration Port Select register is written the following route table configurations are carried out: </P>

<P>&#8226; destination ID Config_destID is routed to output port Config_output_port </P>

<P>&#8226; destination ID Config_destID+1 is routed to output port Config_output_port1 </P>

<P>&#8226; destination ID Config_destID+2 is routed to output port Config_output_port2 </P>

<P>&#8226; destination ID Config_destID+3 is routed to output port Config_output_port3 </P>

<P> </P>

<P>For reads of the Standard Route Configuration Port Select CSR, the configuration information is returned in the corresponding fashion. </P>

<P> </P>

<P>After complete system initialization the switch output port route configuration information read may not be consistant with previously read values due to the capabilities and features of the particular switch. This register is required if bit 23 of the Processing Element Features CAR is set. The bit settings are shown in Table 3-9. </P>

<P> </P>

<P>Table 3-9. Bit Settings for Standard Route Configuration Port Select CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-7 </P>
</TD>

<TD>
<P>Config_output_port3 </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Configuration output port3 - This field is reserved if extended route table mechanism is not enabled </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>Config_output_port2 </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Configuration output port2 - This field is reserved if extended route table mechanism is not enabled </P>
</TD>
</TR>

<TR>
<TD>
<P>16-23 </P>
</TD>

<TD>
<P>Config_output_port1 </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Configuration output port1 - This field is reserved if extended route table mechanism is not enabled </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>Config_output_port </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Configuration output port </P>
</TD>
</TR>
</Table>

<P>1The Config_output_port reset value is implementation dependent </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P>3.5.6  Standard Route Default Port CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x78) </P>

<P> </P>

<P>The Standard Route Default Port CSR specifies the port to which packets with destinations IDs that are greater than that specified in the Switch Route Table Destination ID Limit CAR are routed. This register is required if bit 23 of the Processing Element Features CAR is set. The bit settings are shown in Table 3-10. </P>

<P> </P>

<P>Table 3-10. Bit Settings for Standard Route Default Port CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-23 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>24&#8211;31 </P>
</TD>

<TD>
<P>Default_output_port </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Default output port </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_145.jpg"/>
</Figure>

<P>B Big-endian. A byte-ordering method in memory where the address n of a word corresponds to the most significant byte. In an addressed memory word, the bytes are ordered (left to right) 0, 1, 2, 3, with 0 </P>

<P>being the most significant byte. </P>

<P> </P>

<P>Broadcast. The concept of sending a packet to all processing elements in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_146.jpg"/>
</Figure>

<P>C Capability registers (CARs). A set of read-only registers that allows a processing  element  to  determine  another  processing  element&#8217;s </P>

<P>capabilities. </P>

<P> </P>

<P>Command and status registers (CSRs). A set of registers that allows a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_147.jpg"/>
</Figure>

<P>D Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Device ID. The identifier of an end point processing element connected to the </P>

<P>RapidIO interconnect. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_148.jpg"/>
</Figure>

<P>E End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>End point device. A processing element which contains end point functionality. </P>

<P> </P>

<P>External processing element. A processing element other than the processing element in question. </P>

<P>RapidIO Part 3: Common Transport Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_149.jpg"/>
</Figure>

<P>F Field or Field name. A sub-unit of a register, where bits in the register are named and defined. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_150.jpg"/>
</Figure>

<P>H Host. A processing element responsible for exploring and initializing all or a portion of a RapidIO based system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_151.jpg"/>
</Figure>

<P>I Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P>I/O. Input-output. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_152.jpg"/>
</Figure>

<P>M MSB. Most significant byte. </P>

<P> </P>

<P>Multicast. The concept of sending a packet to more than one processing elements in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_153.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_154.jpg"/>
</Figure>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>

<P>system. </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_155.jpg"/>
</Figure>

<P>S Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on one of its input ports to one of its output ports. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_156.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO&#8482; Interconnect Specification </P>

<P>Part 4: Physical Layer 8/16 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_157.jpg"/>
</Figure>

<P>LP-LVDS Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.1 </P>
</TD>

<TD>
<P>First public release </P>
</TD>

<TD>
<P>03/08/2001 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.2 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev. 1.1 errata rev. 1.1.1, errata 3, showing 02-02-00009 </P>
</TD>

<TD>
<P>06/26/2002 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev 1.2 errata 1 as applicable, the following errata showings: </P>

<P>03-07-00000.002, 03-12-00000.002, 03-12-00002.004 and the following new features showings: </P>

<P>02-06-00001.004, 02-03-00003.004, 04-08-00013.002, 04-09-00022.002 </P>

<P>Convert to ISO-friendly templates; re-formatted </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: errata showing 06-04-00000.003 new features showing 05-04-00001.005 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Technical changes: errata showing 10-08-00001.005, Consolidated Comments on 11-01-00000.000 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_158.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P> </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction........................................................................................................... 15 </P>

<P>1.2 Overview............................................................................................................... 15 </P>

<P>1.3 Features of the Input/Output Specification ........................................................... 15 </P>

<P>1.3.1 Functional features............................................................................................ 15 </P>

<P>1.3.2 Physical Features .............................................................................................. 16 </P>

<P>1.3.3 Performance Features ....................................................................................... 16 </P>

<P>1.4 Contents ................................................................................................................ 16 </P>

<P>1.5 Terminology.......................................................................................................... 17 </P>

<P>1.6 Conventions .......................................................................................................... 17 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Physical Layer Protocol </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 19 </P>

<P>2.2 Packet Exchange Protocol .................................................................................... 19 </P>

<P>2.2.1 Packet and Control Alignment.......................................................................... 20 </P>

<P>2.2.2 Acknowledge Identification.............................................................................. 21 </P>

<P>2.3 Field Placement and Definition ............................................................................ 21 </P>

<P>2.3.1 Flow Control Fields Format.............................................................................. 21 </P>

<P>2.3.2 Packet Priority and Transaction Request Flows ............................................... 23 </P>

<P>2.3.3 Transaction and Packet Delivery ...................................................................... 24 </P>

<P>2.3.3.1 Transaction and Packet Delivery Ordering Rules ........................................ 25 </P>

<P>2.3.3.2 Deadlock Avoidance..................................................................................... 26 </P>

<P>2.3.4 Resource Allocation.......................................................................................... 28 </P>

<P>2.3.4.1 Receiver-Controlled Flow Control ............................................................... 28 </P>

<P>2.3.4.2 Transmitter-Controlled Flow Control........................................................... 30 </P>

<P>2.3.4.3 Receive Buffer Management ........................................................................ 31 </P>

<P>2.3.4.4 Effective Number of Free Receive Buffers .................................................. 32 </P>

<P>2.3.4.5 Speculative Packet Transmission ................................................................. 33 </P>

<P>2.3.5 Flow Control Mode Negotiation....................................................................... 33 </P>

<P>2.4 Error Detection and Recovery .............................................................................. 34 </P>

<P>2.4.1 Control Symbol Protection ............................................................................... 34 </P>

<P>2.4.2 Packet Protection .............................................................................................. 35 </P>

<P>2.4.3 Lost Packet Detection ....................................................................................... 36 </P>

<P>2.4.4 Implementation Note: Transactional Boundaries ............................................. 37 </P>

<P>2.4.5 Link Behavior Under Error............................................................................... 37 </P>

<P>2.4.5.1 Recoverable Errors ....................................................................................... 37 </P>

<P>2.4.5.1.1 Packet Errors............................................................................................. 38 </P>

<P>2.4.5.1.2 Control Symbol Errors.............................................................................. 38 </P>

<P>2.4.5.1.3 Indeterminate errors.................................................................................. 39 </P>

<P>2.4.5.1.4 Timeout Error ........................................................................................... 39 </P>

<P> </P>

<P>RapidIO Trade Association 5 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>2.4.6 CRC Operation ................................................................................................. 39 </P>

<P>2.4.7 CRC Code ......................................................................................................... 42 </P>

<P>2.5 Maximum Packet Size .......................................................................................... 44 </P>

<P>2.6 Link Maintenance Protocol................................................................................... 44 </P>

<P>2.6.1 Command Descriptions..................................................................................... 45 </P>

<P>2.6.1.1 Reset and Safety Lockouts............................................................................ 45 </P>

<P>2.6.1.2 Input-status ................................................................................................... 46 </P>

<P>2.6.1.3 Send-training................................................................................................. 46 </P>

<P>2.6.2 Status Descriptions ........................................................................................... 46 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Packet and Control Symbol Transmission </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 49 </P>

<P>3.2 Packet Start and Control Symbol Delineation ...................................................... 49 </P>

<P>3.3 Packet Termination ............................................................................................... 51 </P>

<P>3.4 Packet Pacing ........................................................................................................ 52 </P>

<P>3.5 Embedded Control Symbols ................................................................................. 54 </P>

<P>3.6 Packet to Port Alignment ...................................................................................... 54 </P>

<P>3.7 System Maintenance ............................................................................................. 58 </P>

<P>3.7.1 Port and Link Initialization ............................................................................... 58 </P>

<P>3.7.1.1 Sampling Window Alignment ...................................................................... 58 </P>

<P>3.7.1.1.1 Port Width Mode Selection ...................................................................... 58 </P>

<P>3.7.1.1.2 Input Sampling Window Alignment......................................................... 59 </P>

<P>3.7.1.1.3 Training Pattern ........................................................................................ 59 </P>

<P>3.7.1.1.4 Training Pattern Transmission.................................................................. 60 </P>

<P>3.7.1.1.5 Ports Not Requiring Port Initialization ..................................................... 60 </P>

<P>3.7.1.1.6 Ports Requiring Port Initialization ............................................................ 61 </P>

<P>3.7.1.1.7 Port Initialization Process ......................................................................... 61 </P>

<P>3.7.1.2 Link Initialization ......................................................................................... 62 </P>

<P>3.7.1.3 Maintenance Training ................................................................................... 62 </P>

<P>3.7.1.4 Unexpected Training Pattern Reception ....................................................... 63 </P>

<P>3.7.2 Multicast-Event................................................................................................. 63 </P>

<P>3.8 Power Management .............................................................................................. 64 </P>

<P> </P>

<P> </P>

<P>Chapter 4 Control Symbol Formats </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 65 </P>

<P>4.2 Acknowledgment Control Symbol Formats ......................................................... 65 </P>

<P>4.2.1 Packet-Accepted Control Symbol..................................................................... 66 </P>

<P>4.2.2 Packet-Retry Control Symbol ........................................................................... 66 </P>

<P>4.2.3 Packet-Not-Accepted Control Symbol ............................................................. 66 </P>

<P>4.2.4 Canceling Packets ............................................................................................. 67 </P>

<P>4.3 Packet Control Symbol Formats ........................................................................... 68 </P>

<P>4.4 Link Maintenance Control Symbol Formats ........................................................ 69 </P>

<P>4.5 Reserved Symbol Formats .................................................................................... 72 </P>

<P>4.6 Implementation-defined Symbol Formats ............................................................ 72 </P>

<P> </P>

<P>6 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>4.7 Control Symbol to Port Alignment ....................................................................... 72 </P>

<P> </P>

<P> </P>

<P>Chapter 5  8/16 LP-LVDS Registers </P>

<P> </P>

<P>5.1 Introduction........................................................................................................... 75 </P>

<P>5.2 Register Map ......................................................................................................... 75 </P>

<P>5.3 Reserved Register, Bit and Bit Field Value Behavior .......................................... 76 </P>

<P>5.4 Capability Registers (CARs) ................................................................................ 78 </P>

<P>5.4.1 Processing Element Features CAR (Configuration Space Offset 0x10) .......... 78 </P>

<P>5.5 Generic End Point Devices ................................................................................... 79 </P>

<P>5.5.1 Register Map..................................................................................................... 79 </P>

<P>5.5.2 Command and Status Registers (CSRs) ........................................................... 80 </P>

<P>5.5.2.1 8/16 LP-LVDS Register Block Header (Block Offset 0x0) ......................... 80 </P>

<P>5.5.2.2 Port Link Timeout Control CSR (Block Offset 0x20).................................. 81 </P>

<P>5.5.2.3 Port Response Timeout Control CSR (Block Offset 0x24).......................... 82 </P>

<P>5.5.2.4 Port General Control CSR (Block Offset 0x3C) .......................................... 83 </P>

<P>5.5.2.5 Port n Error and Status CSRs (Block Offsets 0x58, 78, ..., 238) .................. 84 </P>

<P>5.5.2.6 Port n Control CSR (Block Offsets 0x5C, 7C, ..., 23C) ............................... 85 </P>

<P>5.6 Generic End Point Devices, software assisted error recovery option ................... 87 </P>

<P>5.6.1 Register Map..................................................................................................... 87 </P>

<P>5.6.2 Command and Status Registers (CSRs) ........................................................... 89 </P>

<P>5.6.2.1 8/16 LP-LVDS Register Block Header (Block Offset 0x0) ......................... 89 </P>

<P>5.6.2.2 Port Link Timeout Control CSR (Block Offset 0x20).................................. 90 </P>

<P>5.6.2.3 Port Response Timeout Control CSR (Block Offset 0x24).......................... 91 </P>

<P>5.6.2.4 Port General Control CSR (Block Offset 0x3C) .......................................... 92 </P>

<P>5.6.2.5 Port n Link Maintenance Request CSRs (Block Offsets 0x40, 60, ..., 220). 93 </P>

<P>5.6.2.6 Port n Link Maintenance Response CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x44, 64, ..., 224) ..............................................................94 </P>

<P>5.6.2.7 Port n Local ackID Status CSRs (Block Offsets 0x48, 68, ..., 228) ............. 95 </P>

<P>5.6.2.8 Port n Error and Status CSRs (Block Offsets 0x58, 78, ..., 238) .................. 96 </P>

<P>5.6.2.9 Port n Control CSR (Block Offsets 0x5C, 7C, ..., 23C) ............................... 97 </P>

<P>5.7 Generic End Point Free Devices ........................................................................... 99 </P>

<P>5.7.1 Register Map..................................................................................................... 99 </P>

<P>5.7.2 Command and Status Registers (CSRs) ......................................................... 100 </P>

<P>5.7.2.1 8/16 LP-LVDS Register Block Header (Block Offset 0x0) ....................... 100 </P>

<P>5.7.2.2 Port Link Timeout Control CSR (Block Offset 0x20)................................ 101 </P>

<P>5.7.2.3 Port General Control CSR (Block Offset 0x3C) ........................................ 102 </P>

<P>5.7.2.4 Port n Error and Status CSRs (Block Offsets 0x58, 78, ..., 238) ................ 103 </P>

<P>5.7.2.5 Port n Control CSR (Block Offsets 0x5C, 7C, ..., 23C) ............................. 104 </P>

<P>5.8 Generic End Point Free Devices, software assisted error recovery option......... 106 </P>

<P>5.8.1 Register Map................................................................................................... 106 </P>

<P>5.8.2 Command and Status Registers (CSRs) ......................................................... 108 </P>

<P>5.8.2.1 8/16 LP-LVDS Register Block Header (Block Offset 0x0) ....................... 108 </P>

<P>5.8.2.2 Port Link Timeout Control CSR (Block Offset 0x20)................................ 109 </P>

<P>5.8.2.3 Port General Control CSR (Block Offset 0x3C) ........................................ 110 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>5.8.2.4 Port n Link Maintenance Request CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x40, 60, ..., 220) ............................................................111 </P>

<P>5.8.2.5 Port n Link Maintenance Response CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x44, 64, ..., 224) ............................................................112 </P>

<P>5.8.2.6 Port n Local ackID Status CSRs (Block Offsets 0x48, 68, ..., 228) ........... 113 </P>

<P>5.8.2.7 Port n Error and Status CSRs (Block Offsets 0x58, 78, ..., 238) ................ 114 </P>

<P>5.8.2.8 Port n Control CSR (Block Offsets 0x5C, 7C, ..., 23C) ............................. 115 </P>

<P> </P>

<P> </P>

<P>Chapter 6 System Clocking Considerations </P>

<P> </P>

<P>6.1 Introduction......................................................................................................... 117 </P>

<P>6.2 Example Clock Distribution ............................................................................... 117 </P>

<P>6.3 Elasticity Mechanism.......................................................................................... 118 </P>

<P> </P>

<P> </P>

<P>Chapter 7 Board Routing Guidelines </P>

<P> </P>

<P>7.1 Introduction......................................................................................................... 121 </P>

<P>7.2 Impedance ........................................................................................................... 121 </P>

<P>7.3 Skew.................................................................................................................... 121 </P>

<P>7.4 PCB Stackup ....................................................................................................... 122 </P>

<P>7.5 Termination......................................................................................................... 123 </P>

<P>7.6 Additional Considerations .................................................................................. 123 </P>

<P>7.6.1 Single Board Environments ............................................................................ 123 </P>

<P>7.6.2 Single Connector Environments ..................................................................... 123 </P>

<P>7.6.3 Backplane Environments ................................................................................ 124 </P>

<P>7.7 Recommended pin escape ordering .................................................................... 124 </P>

<P> </P>

<P> </P>

<P>Chapter 8 Signal Descriptions </P>

<P> </P>

<P>8.1 Introduction......................................................................................................... 127 </P>

<P>8.2 Signal Definitions ............................................................................................... 127 </P>

<P>8.3 RapidIO Interface Diagrams ............................................................................... 129 </P>

<P> </P>

<P> </P>

<P>Chapter 9 Electrical Specifications </P>

<P> </P>

<P>9.1 Introduction......................................................................................................... 131 </P>

<P>9.2 Overview............................................................................................................. 131 </P>

<P>9.3 DC Specifications ............................................................................................... 132 </P>

<P>9.4 AC Specifications ............................................................................................... 134 </P>

<P>9.4.1 Concepts and Definitions................................................................................ 134 </P>

<P>9.4.2 Driver Specifications ...................................................................................... 137 </P>

<P>9.4.3 Receiver Specifications................................................................................... 143 </P>

<P> </P>

<P> </P>

<P>Annex A  Interface Management (Informative) </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>A.1 Introduction......................................................................................................... 151 </P>

<P>A.2 Link Initialization and Maintenance Mechanism ............................................... 151 </P>

<P>A.2.1 Input port training state machine .................................................................... 151 </P>

<P>A.2.2 Output port training state machine.................................................................. 154 </P>

<P>A.3 Packet Retry Mechanism .................................................................................... 157 </P>

<P>A.3.1 Input port retry recovery state machine .......................................................... 157 </P>

<P>A.3.2 Output port retry recovery state machine ....................................................... 158 </P>

<P>A.4 Error Recovery.................................................................................................... 161 </P>

<P>A.4.1 Input port error recovery state machine .......................................................... 161 </P>

<P>A.4.2 Output port error recovery state machine ....................................................... 162 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>2-1 Example Transaction with Acknowledge .......................................................................20 </P>

<P>2-2 Packet Physical Layer Fields Format..............................................................................22 </P>

<P>2-3 Control Symbol Physical Layer Fields Format...............................................................22 </P>

<P>2-4 Flow Control Fields Bit Stream ......................................................................................23 </P>

<P>2-5 Receiver-Controlled Flow Control .................................................................................30 </P>

<P>2-6 Transmitter-Controlled Flow Control .............................................................................31 </P>

<P>2-7 Error Coverage of First 16 Bits of Packet Header ..........................................................35 </P>

<P>2-8 Naturally Aligned Packet Bit Stream..............................................................................35 </P>

<P>2-9 Naturally Aligned Packet Bit Stream Example 1 ...........................................................41 </P>

<P>2-10 Naturally Aligned Packet Bit Stream Example 2 ...........................................................41 </P>

<P>2-11 Padded Aligned Packet Bit Stream Example 1...............................................................41 </P>

<P>2-12 Padded Aligned Packet Bit Stream Example 2...............................................................42 </P>

<P>2-13 CRC Generation Pipeline................................................................................................43 </P>

<P>3-1 Framing Signal Maximum Toggle Rate for 8-bit Port ...................................................50 </P>

<P>3-2 Framing Signal Maximum Toggle Rate for 16-bit Port .................................................50 </P>

<P>3-3 Control Symbol Delineation Example for 8-bit Port ......................................................50 </P>

<P>3-4 Control Symbol Delineation Example for 16-bit Port ....................................................51 </P>

<P>3-5 Header Marked End of Packet (8-bit Port) .....................................................................52 </P>

<P>3-6 End-Of-Packet Control Symbol Marked End of Packet (16-bit Port) ............................52 </P>

<P>3-7 Pacing Idle Insertion in Packet (8-bit Port) ....................................................................53 </P>

<P>3-8 Embedded Control Symbols for 8-bit Port .....................................................................54 </P>

<P>3-9 Embedded Control Symbols for 16-bit Port ...................................................................54 </P>

<P>3-10 Request Packet Transmission Example 1 .......................................................................55 </P>

<P>3-11 Request Packet Transmission Example 2 .......................................................................55 </P>

<P>3-12 Request Packet Transmission Example 3 .......................................................................56 </P>

<P>3-13 Request Packet Transmission Example 4 .......................................................................56 </P>

<P>3-14 Response Packet Transmission Example 1.....................................................................57 </P>

<P>3-15 Response Packet Transmission Example 2.....................................................................57 </P>

<P>4-1 Type 0 Packet-Accepted Control Symbol Format ..........................................................66 </P>

<P>4-2 Type 1 Packet-Retry Control Symbol Format ................................................................66 </P>

<P>4-3 Type 2 Packet-Not-Accepted Control Symbol Format...................................................67 </P>

<P>4-4 Type 4 Packet Control Symbol Format ..........................................................................68 </P>

<P>4-5 Type 5 Link-Request Control Symbol Format ...............................................................70 </P>

<P>4-6 Type 6 Link-Response Control Symbol Format .............................................................70 </P>

<P>4-7 Control Symbol Transmission Example 1 ......................................................................72 </P>

<P>4-8 Control Symbol Transmission Example 2 ......................................................................73 </P>

<P>6-1 Clock Distribution in a Small System...........................................................................117 </P>

<P>6-2 Clock Distribution in a Larger System .........................................................................118 </P>

<P>6-3 Clock Distribution Through the Interconnect ...............................................................118 </P>

<P>7-1 Routing for Equalized Skew for Several Placements ...................................................122 </P>

<P>7-2 Potential PCB Stackups ................................................................................................122 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>7-3 Recommended device pin escape, input port, top view of device ................................124 </P>

<P>7-4 Recommended device pin escape, output port, top view of device ..............................124 </P>

<P>7-5 Opposed orientation, same side of board ......................................................................125 </P>

<P>7-6 Opposed orientation, opposite sides of board ...............................................................125 </P>

<P>7-7 Recommended device pin escape, output port reversed, top view of device ...............126 </P>

<P>7-8 Opposed orientation, output port reversed, opposite sides of board.............................126 </P>

<P>8-1 RapidIO 8-bit Device to 8-bit Device Interface Diagram.............................................129 </P>

<P>8-2 RapidIO 8-bit Device to 16-bit Device Interface Diagram...........................................129 </P>

<P>8-3 RapidIO 16-bit Device to 16-bit Device Interface Diagram.........................................130 </P>

<P>9-1 DC driver signal levels .................................................................................................133 </P>

<P>9-2 Differential Peak-Peak Voltage of Transmitter or Receiver.........................................134 </P>

<P>9-3 Example Compliance Mask ..........................................................................................136 </P>

<P>9-4 RapidIO Transmit Mask ...............................................................................................141 </P>

<P>9-5 Example Driver Output Eye Pattern .............................................................................142 </P>

<P>9-6 RapidIO Receive Mask .................................................................................................145 </P>

<P>9-7 Example Receiver Input Eye Pattern ............................................................................147 </P>

<P>9-8 Data to Clock Skew ......................................................................................................148 </P>

<P>9-9 Clock to Clock Skew ....................................................................................................149 </P>

<P>9-10 Static Skew Diagram ....................................................................................................150 </P>

<P>A-1 Input port training state machine ..................................................................................152 </P>

<P>A-2 Output port training state machine................................................................................154 </P>

<P>A-3 Input port retry recovery state machine ........................................................................157 </P>

<P>A-4 Output port retry recovery state machine .....................................................................159 </P>

<P>A-5 Input port error recovery state machine ........................................................................161 </P>

<P>A-6 Output port error recovery state machine .....................................................................163 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>2-1 Fields that Control Packet Flow......................................................................................21 </P>

<P>2-2 buf_status Field Definition .............................................................................................22 </P>

<P>2-3 Transaction Request Flow to Priority Mapping .............................................................23 </P>

<P>2-4 Transaction Request Flow to Priority and Critical Request Flow Mapping ...................24 </P>

<P>2-5 Parallel CRC Intermediate Value Equations ..................................................................42 </P>

<P>2-6 Maximum Packet Size ....................................................................................................44 </P>

<P>2-7 Secondary Link Maintenance Command Summary .......................................................45 </P>

<P>2-8 Link Status Indicators .....................................................................................................46 </P>

<P>4-1 Field Definitions for Acknowledgment Control Symbols ..............................................65 </P>

<P>4-2 cause Field Definition .....................................................................................................67 </P>

<P>4-3 sub_type and contents Field Definitions.........................................................................68 </P>

<P>4-4 Throttle Control Symbol contents Field Definition ........................................................69 </P>

<P>4-5 cmd Field Definition .......................................................................................................70 </P>

<P>4-6 ackID_status Field Definition .........................................................................................71 </P>

<P>4-7 link_status Field Definition ............................................................................................71 </P>

<P>5-1 8/16 LP-LVDS Register Map .........................................................................................76 </P>

<P>5-2 Configuration Space Reserved Access Behavior............................................................76 </P>

<P>5-3 Bit Settings for Processing Element Features CAR........................................................78 </P>

<P>5-4 8/16 LP-LVDS Register Map - Generic End Point Devices ..........................................79 </P>

<P>5-5 Bit Settings for 8/16 LP-LVDS Register Block Header .................................................80 </P>

<P>5-6 Bit Settings for Port Link Timeout Control CSR ...........................................................81 </P>

<P>5-7 Bit Settings for Port Response Timeout Control CSR....................................................82 </P>

<P>5-8 Bit Settings for Port General Control CSRs ...................................................................83 </P>

<P>5-9 Bit Settings for Port n Error and Status CSRs ................................................................84 </P>

<P>5-10 Bit Settings for Port n Control CSRs ..............................................................................85 </P>

<P>5-11 8/16 LP-LVDS Register Map - Generic End Point Devices (SW assisted) ...................87 </P>

<P>5-12 Bit Settings for 8/16 LP-LVDS Register Block Header .................................................89 </P>

<P>5-13 Bit Settings for Port Link Timeout Control CSR ...........................................................90 </P>

<P>5-14 Bit Settings for Port Response Timeout Control CSR....................................................91 </P>

<P>5-15 Bit Settings for Port General Control CSRs ...................................................................92 </P>

<P>5-16 Bit Settings for Port n Link Maintenance Request CSRs ...............................................93 </P>

<P>5-17 Bit Settings for Port n Link Maintenance Response CSRs.............................................94 </P>

<P>5-18 Bit Settings for Port n Local ackID Status CSRs............................................................95 </P>

<P>5-19 Bit Settings for Port n Error and Status CSRs ................................................................96 </P>

<P>5-20 Bit Settings for Port n Control CSRs ..............................................................................97 </P>

<P>5-21 8/16 LP-LVDS Register Map - Generic End Point Free Devices ..................................99 </P>

<P>5-22 Bit Settings for 8/16 LP-LVDS Register Block Header ...............................................100 </P>

<P>5-23 Bit Settings for Port Link Timeout Control CSR .........................................................101 </P>

<P>5-24 Bit Settings for Port General Control CSRs .................................................................102 </P>

<P>5-25 Bit Settings for Port n Error and Status CSRs ..............................................................103 </P>

<P>5-26 Bit Settings for Port n Control CSRs ............................................................................104 </P>

<P>5-27 8/16 LP-LVDS Register Map - Generic End Point-free Devices (SW assisted) ..........106 </P>

<P> </P>

<P>RapidIO Trade Association 13 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>5-28 Bit Settings for 8/16 LP-LVDS Register Block Header ...............................................108 </P>

<P>5-29 Bit Settings for Port Link Timeout Control CSR .........................................................109 </P>

<P>5-30 Bit Settings for Port General Control CSRs .................................................................110 </P>

<P>5-31 Bit Settings for Port n Link Maintenance Request CSRs .............................................111 </P>

<P>5-32 Bit Settings for Port n Link Maintenance Response CSRs...........................................112 </P>

<P>5-33 Bit Settings for Port n Local ackID Status CSRs..........................................................113 </P>

<P>5-34 Bit Settings for Port n Error and Status CSRs ..............................................................114 </P>

<P>5-35 Bit Settings for Port n Control CSRs ............................................................................115 </P>

<P>8-1 8/16 LP-LVDS Signal Descriptions .............................................................................127 </P>

<P>9-1 RapidIO 8/16 LP-LVDS Driver Specifications (DC) ...................................................132 </P>

<P>9-2 RapidIO 8/16 LP-LVDS Receiver Specifications (DC) ...............................................132 </P>

<P>9-3 Driver AC Timing Specifications - 500Mbps Data Rate/250MHz Clock Rate ...........137 </P>

<P>9-4 Driver AC Timing Specifications - 750Mbps Data Rate/375MHz Clock Rate ...........138 </P>

<P>9-5 Driver AC Timing Specifications - 1000Mbps Data Rate/500MHz Clock Rate .........138 </P>

<P>9-6 Driver AC Timing Specifications - 1500Mbps Data Rate/750MHz Clock Rate .........139 </P>

<P>9-7 Driver AC Timing Specifications - 2000Mbps Data Rate/1000MHz Clock Rate .......140 </P>

<P>9-8 Receiver AC Timing Specifications - 500Mbps Data Rate/250MHz Clock Rate........143 </P>

<P>9-9 Receiver AC Timing Specifications - 750Mbps Data Rate/375MHz Clock Rate........143 </P>

<P>9-10 Receiver AC Timing Specifications - 1000Mbps Data Rate/500MHz Clock Rate......144 </P>

<P>9-11 Receiver AC Timing Specifications - 1500Mbps Data Rate/750MHz Clock Rate......144 </P>

<P>9-12 Receiver AC Timing Specifications - 2000Mbps Data Rate/1000MHz Clock Rate....145 </P>

<P>A-1 Input port training state machine transition table .........................................................152 </P>

<P>A-2 Output port training state machine transition table.......................................................155 </P>

<P>A-3 Input port retry recovery state machine transition table ...............................................158 </P>

<P>A-4 Output port retry recovery state machine transition table.............................................159 </P>

<P>A-5 Input port error recovery state machine transition table ...............................................162 </P>

<P>A-6 Output port error recovery state machine transition table ............................................163 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>This chapter provides an overview of the RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification, including a description of the relationship between this specification and the other specifications of the RapidIO interconnect. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>The RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification is one of the RapidIO physical layer specifications that define the device to device communications protocol and packet formats. Other RapidIO physical layer specifications include the RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specification. </P>

<P> </P>

<P>The physical layer defines the signal definitions, flow control and error management for RapidIO. An 8-bit and 16-bit parallel (8/16 LP-LVDS), point-to-point interface is defined in this specification. An 8/16 LP-LVDS device interface contains a dedicated 8- or 16-bit input port with clock and frame signals, and a 8- or 16-bit output port with clock and frame signals. A source-synchronous-clock signal clocks packet data on the rising and falling edges. A frame signal provides a control reference. Differential signaling is used to reduce interface complexity, provide robust signal quality, and promote good frequency scalability across printed circuit boards and connectors. </P>

<P> </P>

<P> </P>

<P>1.3 Features of the Input/Output Specification </P>

<P> </P>

<P>The following are features of the RapidIO I/O specification designed to satisfy the needs of various applications and systems: </P>

<P> </P>

<P> </P>

<P>1.3.1  Functional features </P>

<P>&#8226; RapidIO provides a flow control mechanism between devices that communicate on the RapidIO interconnect fabric, because infinite data buffering is not available in a device. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1.3.2  Physical Features </P>

<P>&#8226; Connections are point-to-point unidirectional, one in and one out, with 8-bit or </P>

<P>16-bit ports </P>

<P>&#8226; Physical layer protocols and packet formats are to some degree independent of the topology of the physical interconnect; however; the physical structure is assumed to be link-based. </P>

<P>&#8226; There is no dependency in RapidIO on the bandwidth or latency of the physical fabric. </P>

<P>&#8226; Physical layer protocols handle out-of-order and in-order packet transmission and reception. </P>

<P>&#8226; Physical layer protocols are tolerant of transient errors caused by high frequency operation of the interface or excessive noise in the system environment. </P>

<P> </P>

<P> </P>

<P>1.3.3  Performance Features </P>

<P>&#8226; Physical protocols and packet formats allow for the smallest to the largest data payload sizes </P>

<P>&#8226; Packet headers are as small as possible to minimize the control overhead and are organized for fast, efficient assembly and disassembly. </P>

<P>&#8226; Multiple transactions are allowed concurrently in the system, preventing much potential system input from being wasted. </P>

<P>&#8226; The electrical specification allows for the fastest possible speed of operation for future devices. </P>

<P> </P>

<P> </P>

<P>1.4 Contents </P>

<P> </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification contains nine chapters and an appendix: </P>

<P> </P>

<P>&#8226; Chapter 1, &#8220;Overview&#8221; (this chapter) provides an overview of the specification </P>

<P>&#8226; Chapter 2, &#8220;Physical Layer Protocol,&#8221; describes the physical layer protocol for packet delivery to the RapidIO fabric, including packet transmission, flow control, error management, and link maintenance protocols. </P>

<P>&#8226; Chapter 3, &#8220;Packet and Control Symbol Transmission,&#8221; defines packet and control symbol delineation and alignment on the physical port and mechanisms to control the pacing of a packet. </P>

<P>&#8226; Chapter 4, &#8220;Control Symbol Formats,&#8221; explains the physical layer control formats that manage the packet delivery protocols mentioned in Chapter 2. </P>

<P>&#8226; Chapter 5, &#8220;8/16 LP-LVDS Registers,&#8221; describes the register set that allows an external processing element to determine the physical capabilities and status of an 8/16 LP-LVDS RapidIO implementation. </P>

<P> </P>

<P> </P>

<P>16 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; Chapter 6, &#8220;System Clocking Considerations,&#8221; discusses the RapidIO </P>

<P>synchronous clock and how it is distributed in a typical switch configuration. </P>

<P>&#8226; Chapter 7, &#8220;Board Routing Guidelines,&#8221; explains board layout guidelines and application environment considerations for the RapidIO architecture. </P>

<P>&#8226; Chapter 8, &#8220;Signal Descriptions,&#8221; contains the signal pin descriptions for a </P>

<P>RapidIO end point device. </P>

<P>&#8226; Chapter 9, &#8220;Electrical Specifications,&#8221; describes the low voltage differential signaling (LVDS) electrical specifications of the RapidIO 8/16 LP-LVDS device. </P>

<P>&#8226; Annex A, &#8220;Interface Management (Informative),&#8221; contains information pertinent to interface management in a RapidIO system, including SECDED error tables, error recovery, link initialization, and packet retry state machines. </P>

<P> </P>

<P> </P>

<P>1.5 Terminology </P>

<P> </P>

<P>Refer to the Glossary at the back of this document. </P>

<P> </P>

<P> </P>

<P>1.6 Conventions </P>

<P>|| Concatenation, used to indicate that two fields are physically associated as consecutive bits </P>

<P>ACTIVE_HIGH Names of active high signals are shown in uppercase text with no overbar. Active-high signals are asserted when high and not asserted when low. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_159.jpg"/>
</Figure>

<P>ACTIVE_LOW Names of active low signals are shown in uppercase text with an overbar. Active low signals are asserted when low and not asserted when high. </P>

<P> </P>

<P>italics Book titles in text are set in italics. </P>

<P> </P>

<P>REG[FIELD] Abbreviations or acronyms for registers are shown in uppercase text. Specific bits, fields, or ranges appear in brackets. </P>

<P>TRANSACTION Transaction types are expressed in all caps. operation Device operation types are expressed in plain text. n A decimal value. </P>

<P>[n-m] Used to express a numerical range from n to m. </P>

<P> </P>

<P>0bnn A binary value, the number of bits is determined by the number of digits. </P>

<P>0xnn A hexadecimal value, the number of bits is determined by the number of digits or from the surrounding context; for </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>example, 0xnn may be a 5, 6, 7, or 8 bit value. x This value is a don&#8217;t care </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Physical Layer Protocol </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This chapter describes the RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification physical layer protocol for packet delivery to the interconnect fabric including packet transmission, flow control, error management, and other system functions. See the user&#8217;s manual or implementation specification for specific implementation details of a device. </P>

<P> </P>

<P> </P>

<P>2.2 Packet Exchange Protocol </P>

<P> </P>

<P>The RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification defines an exchange of packet and acknowledgment control symbols in which a destination or intermediate processing element (such as a switch) acknowledges receipt of a request or response packet from a source. </P>

<P> </P>

<P>If a packet cannot be accepted for any reason, an acknowledgment control symbol indicates that the original packet and any already transmitted subsequent packets should be resent. This behavior provides a flow control and transaction ordering mechanism  between  processing  elements.  Figure 2-1  shows  an  example  of transporting a request and response packet pair across an interconnect fabric with acknowledgments between the link transmitter/receiver pairs along the way. This allows flow control and error handling to be managed between each electrically connected device pair rather than between the original source and final target of the transaction. An end point device shall transmit an acknowledge control symbol for a request before the response transaction corresponding to that request. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Initiator (Source) </P>

<P> </P>

<P>Operation </P>

<P> </P>

<P> </P>

<P> </P>

<P>Request </P>

<P> </P>

<P> </P>

<P> </P>

<P>Acknowledge </P>

<P>Data </P>

<P>Returned </P>

<P> </P>

<P> </P>

<P> </P>

<P>Operation </P>

<P>Issued By </P>

<P>Master </P>

<P>Packet Issued </P>

<P>Control Symbol </P>

<P>Completed for </P>

<P>Master </P>

<P> </P>

<P> </P>

<P> </P>

<P>Fabric </P>

<P> </P>

<P> </P>

<P>Acknowledge </P>

<P>Control Symbol </P>

<P> </P>

<P>Response </P>

<P>Packet Forwarded </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Request </P>

<P>Packet Forwarded </P>

<P>Acknowledge </P>

<P>Control Symbol </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Target Destination </P>

<P> </P>

<P> </P>

<P>Acknowledge </P>

<P>Control Symbol </P>

<P> </P>

<P> </P>

<P>Response </P>

<P>Packet Issued </P>

<P> </P>

<P>Target Completes Operation </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_160.jpg"/>
</Figure>

<P>Figure 2-1. Example Transaction with Acknowledge </P>

<P> </P>

<P>2.2.1  Packet and Control Alignment </P>

<P> </P>

<P>All packets defined by the combination of this specification and the appropriate logical and transport specifications are aligned to 16-bit boundaries, however, all packets and control symbols sent over the 8-bit and 16-bit ports are aligned to 32-bit boundaries. This alignment allows devices to work on packets using a larger internal width thus requiring lower core operating frequencies. Packets that are not naturally aligned to a 32-bit boundary are padded. See Figure 2-11 and Figure 2-12 for examples of padded packets. Control symbols are nominally 16-bit quantities, but are defined as a 16-bit control symbol followed by a bit-wise inverted copy of itself to align it to the 32-bit boundary. This, in turn, adds error detection capability to the interface. These 32-bit quantities are referred to as aligned control symbols. </P>

<P> </P>

<P>The 16-bit wide port is compatible with an 8-bit wide port. If an 8-bit wide port is properly connected to a 16-bit wide port, the port will function as an 8-bit interface between the devices. Port width connections are described in Chapter 8, &#8220;Signal Descriptions&#8221;. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>2.2.2  Acknowledge Identification </P>

<P> </P>

<P>A packet requires an identifier to uniquely identify its acknowledgment. This identifier, known as the acknowledge ID (or ackID), is three bits, allowing for a range of one to eight outstanding unacknowledged request or response packets between adjacent processing elements, however only up to seven outstanding unacknowledged packets are allowed at any one time. The ackIDs are assigned sequentially (in increasing order, wrapping back to 0 on overflow) to indicate the order of the packet transmission. The acknowledgments themselves are a number of aligned control symbols defined in Chapter 4, &#8220;Control Symbol Formats.&#8221; </P>

<P> </P>

<P> </P>

<P>2.3 Field Placement and Definition </P>

<P> </P>

<P>This section contains the 8/16 LP-LVDS specification for the additional physical layer bit fields and control symbols required to implement the flow control, error management, and other specified system functions. </P>

<P> </P>

<P> </P>

<P>2.3.1  Flow Control Fields Format </P>

<P> </P>

<P>The fields used to control packet flow in the system are described in Table 2-1. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_161.jpg"/>
</Figure>

<P>Table 2-1. Fields that Control Packet Flow </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>S </P>
</TD>

<TD>
<P>0b0 - RapidIO request or response packet&#61472;&#61472;</P>

<P>0b1 - Physical layer control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>S </P>
</TD>

<TD>
<P>Inverse of S-bit for redundancy (odd parity bit) </P>
</TD>
</TR>

<TR>
<TD>
<P>ackID </P>
</TD>

<TD>
<P>Acknowledge ID is the packet identifier for acknowledgments back to the packet sender&#8212;see </P>

<P>Section 2.2.2 </P>
</TD>
</TR>

<TR>
<TD>
<P>CRF </P>
</TD>

<TD>
<P>Critical Request Flow is an optional bit that differentiates between flows of equal priority </P>

<P>If Critical Request Flow is not supported, this bit is reserved </P>

<P>See Section 2.3.2 for an explanation of prioritizing packets </P>
</TD>
</TR>

<TR>
<TD>
<P>prio </P>
</TD>

<TD>
<P>Sets packet priority: </P>

<P>0b00 - lowest priority&#61472;&#61472;</P>

<P>0b01 - medium priority&#61472;&#61472;</P>

<P>0b10 - high priority&#61472;&#61472;</P>

<P>0b11 - highest priority </P>

<P>See Section 2.3.2 for an explanation of prioritizing packets </P>
</TD>
</TR>

<TR>
<TD>
<P>buf_status </P>
</TD>

<TD>
<P>Specifies the number of available packet buffers in the receiving device. See Section 2.3.4 and </P>

<P>Table 2-2. </P>
</TD>
</TR>

<TR>
<TD>
<P>stype </P>
</TD>

<TD>
<P>Control symbol type&#8212;see Chapter 4, &#8220;Control Symbol Formats&#8221; for definition. </P>
</TD>
</TR>

<TR>
<TD>
<P>rsrv </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 2-2. buf_status Field Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>buf_status Encoding Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0000 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Specifies the number of maximum length packets that the port can accept without issuing a retry due to a lack of resources. The value of buf_status in a control symbol is the number of maximum packets that can be accepted, inclusive of the effect of the packet being accepted or retried. </P>

<P>Value  0-13: The  encoding  value  specifies  the  number  of  new  maximum  sized packets the receiving device can receive. The value 0, for example, signifies that the downstream device has no available packet buffers (thus is not able to hold any new packets). </P>

<P>Value 14: The value 14 signifies that the downstream device can receive 14 or more new maximum sized packets. </P>

<P>Value 15: The downstream device can receive an undefined number of maximum sized packets, and relies on the retry protocol for flow control. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0001 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b0010 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b0011 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b0100 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b0101 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b0110 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b0111 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b1000 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b1001 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b1010 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b1011 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b1100 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b1101 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b1110 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b1111 </P>
</TD>

<TD/>
</TR>
</Table>

<P> </P>

<P>Figure 2-2 shows the format for the physical layer fields for packets. In order to pad packets to the 16-bit boundary there are two reserved bits in a packet&#8217;s physical layer fields. These bits are assigned to logic 0 when generated and ignored when received. </P>

<P> </P>

<Table>
<TR>
<TD>
<P>S=0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>rsrv=0 </P>
</TD>

<TD>
<P>S=1 </P>
</TD>

<TD>
<P>rsrv=0 </P>
</TD>

<TD>
<P>CRF </P>
</TD>

<TD>
<P>prio </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_162.jpg"/>
</Figure>

<P>1 3 1 1 1 1 2 </P>

<P> </P>

<P>Figure 2-2. Packet Physical Layer Fields Format </P>

<P> </P>

<P> </P>

<P>Figure 2-3 shows the basic format for the physical layer fields for control symbols. In order to pad the control symbol to the 16-bit boundary there are four reserved bits in the control symbol. These bits are assigned to logic 0 when generated and ignored when received. The field formats for all control symbols are defined in Chapter 4, &#8220;Control Symbol Formats.&#8221; </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>S=1 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>rsrv=0 </P>
</TD>

<TD>
<P>S=0 </P>
</TD>

<TD>
<P>rsrv=000 </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_163.jpg"/>
</Figure>

<P>1 3 1 1 3 4 3 </P>

<P> </P>

<P>Figure 2-3. Control Symbol Physical Layer Fields Format </P>

<P> </P>

<P>Figure 2-4 shows how the physical layer fields are prefixed to the combined </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>transport and logical layer packet. </P>

<P> </P>

<Table>
<TR>
<TD>
<P>S=0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>rsrv=0 </P>
</TD>

<TD>
<P>S=1 </P>
</TD>

<TD>
<P>rsrv=0 </P>
</TD>

<TD>
<P>CRF </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>ftype </P>
</TD>

<TD>
<P>Remainder of transport &amp; logical fields </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_164.jpg"/>
</Figure>

<P>1 3 1 </P>

<P>1 1 1 2 2 4 n </P>

<P> </P>

<P>Figure 2-4. Flow Control Fields Bit Stream </P>

<P> </P>

<P>The unshaded fields are the physical layer fields defined by this physical specification. The shaded fields are the bits associated with the combined transport and logical transaction definitions. The first transport and logical field shown is the two bit tt field specified in the RapidIO Part 3: Common Transport Specification. The second field is the four bit format type (ftype) defined in the logical specifications. The third combined field is the remainder of the transport and logical packet of a size determined by those specifications. </P>

<P> </P>

<P> </P>

<P>2.3.2  Packet Priority and Transaction Request Flows </P>

<P> </P>

<P>Each packet has a priority, and optionally a critical request flow, that is assigned by the end point processing element that is the source of (initiates) the packet. The priority is carried in the prio field of the packet and has four possible values, 0, 1, 2 or 3. Packet priority increases with the priority value with 0 being the lowest priority and 3 being the highest. Packet priority is used in RapidIO for several purposes which include transaction ordering and deadlock prevention. The critical request flow is carried in the CRF bit. It allows a flow to be designated as a critical or preferred flow with respect to other flows of the same priority. Support for critical request flows is strongly encouraged. </P>

<P> </P>

<P>When a transaction is encapsulated in a packet for transmission, the transaction request flow indicator (flowID) of the transaction is mapped into the prio field (and optionally the CRF bit) of the packet. If the CRF bit is not supported, transaction request flows A and B are mapped to priorities 0 and 1 respectively and transaction request flows C and above are mapped to priority 2 as specified in Table 2-3. </P>

<P> </P>

<P>Table 2-3. Transaction Request Flow to Priority Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Flow </P>
</TD>

<TD>
<P> </P>

<P>System Priority </P>
</TD>

<TD>
<P>Request </P>

<P>Packet Priority </P>
</TD>

<TD>
<P>Response </P>

<P>Packet Priority </P>
</TD>
</TR>

<TR>
<TD>
<P>C or higher </P>
</TD>

<TD>
<P>Highest </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>B </P>
</TD>

<TD>
<P>Next </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>A </P>
</TD>

<TD>
<P>Lowest </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1, 2, or 3 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>If the CRF bit is supported, the transaction request flows are mapped similarily as specified in Table 2-4. Devices that do not support the CRF bit treat it as reserved, setting it to logic 0 on transmit and ignoring it on receive. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 2-4. Transaction Request Flow to Priority and Critical Request Flow Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Flow </P>
</TD>

<TD>
<P> </P>

<P>System Priority </P>
</TD>

<TD>
<P> </P>

<P>CRF Bit Setting </P>
</TD>

<TD>
<P>Request </P>

<P>Packet Priority </P>
</TD>

<TD>
<P>Response </P>

<P>Packet Priority </P>
</TD>
</TR>

<TR>
<TD>
<P>F or higher </P>
</TD>

<TD>
<P>Highest </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>E </P>
</TD>

<TD>
<P>Higher than A, B, C, D </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>D </P>
</TD>

<TD>
<P>Higher than A, B, C </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>C </P>
</TD>

<TD>
<P>Higher than A, B </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>B </P>
</TD>

<TD>
<P>Higher than A </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1, 2, or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>A </P>
</TD>

<TD>
<P>Lowest </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1, 2, or 3 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The mapping of transaction request flows allows a RapidIO transport fabric to maintain transaction request flow ordering without the fabric having any knowledge of transaction types or their interdependencies. This allows a RapidIO fabric to be forward compatible as the types and functions of transactions evolve. A fabric can maintain transaction request flow ordering by simply maintaining the order of packets with the same priority and critical request flow for each path through the fabric and can maintain transaction request flow priority by never allowing a lower priority packet to pass a higher priority packet taking the same path through the fabric. In the case of congestion or some other restriction, a set CRF bit indicates that a flow of a priority can pass a flow of the same priority without the CRF bit set. </P>

<P> </P>

<P> </P>

<P>2.3.3  Transaction and Packet Delivery </P>

<P> </P>

<P>Certain physical layer fields and a number of control symbols are used for handling flow control. One physical layer field contains the ackID field (Table 2-1), which is assigned by the sending processing element, and expected by the receiving processing element, in a sequential fashion. </P>

<P> </P>

<P>Packets shall be accepted by the receiving processing element only when ackID values of successive packets occur in the specified sequence. The receiving processing   element   signals   the   acceptance   of   a   packet   by   returning   a packet-accepted control symbol to the sender. This order allows a device to detect when a packet has been lost and also provides a mechanism to maintain ordering. </P>

<P> </P>

<P>A device that retries a packet (by returning a packet-retry control symbol to the sender) due to some temporary internal condition shall silently discard all new incoming packets until it receives a restart-from-retry control symbol from the sender. The sender then retransmits all packets starting from the retried ackID, reestablishing the proper ordering between the devices. The packet sent with the retried ackID may be the original retried packet or a higher priority packet, if one is available, allowing higher priority packets to bypass lower priority packets across the link. This behavior is shown in an example state machine in Section A.3, &#8220;Packet Retry Mechanism.&#8221; </P>

<P> </P>

<P>Similarly, if a receiving processing element encounters an error condition, it shall </P>

<P> </P>

<P>24 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>return a packet-not-accepted control symbol, indicating an error condition, to the sender. It shall also silently discard all new incoming packets. If the error condition is due to a transmission error the sender may able to recover from the effects of the error condition. The error recovery mechanism is described in Section 2.4.5. </P>

<P> </P>

<P>A retried transaction shall eventually be retransmitted by the sending device. </P>

<P> </P>

<P>2.3.3.1  Transaction and Packet Delivery Ordering Rules </P>

<P> </P>

<P>The rules specified in this section are required for the physical layer to support the transaction ordering rules specified in the logical layer specifications. </P>

<P> </P>

<P>Transaction Delivery Ordering Rules: </P>

<P> </P>

<P>1. The physical layer of an end point processing element port shall encapsulate in packets and forwarded to the RapidIO fabric transactions comprising a given transaction request flow in the same order that the transactions were received from the transport layer of the processing element. </P>

<P>2. The physical layer of an end point processing element port shall ensure that a higher priority request transaction that it receives from the transport layer of the processing element before a lower priority request transaction with the same sourceID and the same destinationID is forwarded to the fabric before the lower priority transaction. </P>

<P>3. The physical layer of an end point processing element port shall deliver transactions to the transport layer of the processing element in the same order that the packetized transactions were received by the port. </P>

<P> </P>

<P>Packet Delivery Ordering Rules: </P>

<P> </P>

<P>1. A packet initiated by a processing element shall not be considered committed to the RapidIO fabric and does not participate in the packet delivery ordering rules until the packet has been accepted by the device at the other end of the link. (RapidIO does not have the concept of delayed or deferred transactions. Once a packet is accepted into the fabric, it is committed.) </P>

<P>2. A switch shall not alter the priority or critical request flow of a packet. </P>

<P>3. Packet forwarding decisions made by a switch processing element shall provide a consistent output port selection which is based solely on the value of the destinationID field carried in the packet. </P>

<P>4. A switch processing element shall not change the order of packets comprising a transaction request flow (packets with the same sourceID, the same destinationID, the same priority, the same critical request flow, and ftype != 8) as the packets pass through the switch. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 25 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5. A switch processing element shall not allow lower priority non-maintenance packets (ftype != 8) to pass higher priority </P>

<P>non-maintenance packets with the same sourceID and destinationID as the packets pass through the switch. </P>

<P>6. A switch processing element shall not allow a priority N maintenance packet (ftype = 8) to pass another maintenance packet of priority N or greater that takes the same path through the switch (same switch input port and same switch output port). </P>

<P> </P>

<P>2.3.3.2  Deadlock Avoidance </P>

<P>To allow a RapidIO protocol to evolve without changing the switching fabric, switch processing elements are not required, with the sole exception of ftype 8 maintenance transactions, to discern between packet types, their functions or their interdependencies. Switches, for instance, are not required to discern between packets carrying request transactions and packets carrying response transactions. As a result, it is possible for two end points, A and B to each fill all of their output buffers, the fabric connecting them and the other end point&#8217;s input buffers with read requests. This would result in an input to output dependency loop in each end point in which there would be no buffer space to hold the responses necessary to complete any of the outstanding read requests. </P>

<P> </P>

<P>To break input to output dependencies, end point processing elements must have the ability to issue outbound response packets even if outbound request packets awaiting transmission are congestion blocked by the connected device. Two techniques are provided to break input to output dependencies. First, a response packet (a packet carry a response transaction) is always assigned an initial priority one priority level greater than the priority of the associated request packet (the packet carrying the associated request transaction). The CRF bit setting is assigned the same value as was received in the associated request packet if the CRF bit is supported by the receiving end point. </P>

<P> </P>

<P>This requirement is specified in Table 1-3 and Table 2-4. It breaks the dependency cycle at the request flow level. Second, the end point processing element that is the source of the response packet may additionally raise the priority of the response packet to a priority higher than the minimum required by Table 1-3 and Table 2-4 if necessary for the packet to be accepted by the connected device. This additional increase in response packet priority above the minimum required by Table 1-3 and Table 2-4 is called promotion. An end point processing element may promote a response packet only to the degree necessary for the packet to be accepted by the connected device. </P>

<P> </P>

<P>The following rules define the deadlock prevention mechanism: </P>

<P> </P>

<P>Deadlock Prevention Rules: </P>

<P> </P>

<P>1.   A RapidIO fabric shall be dependency cycle free for all operations that do not require a response. (This rule is necessary as there are no mechanisms provided in the fabric to break dependency cycles for operations not requiring responses.) </P>

<P> </P>

<P>26 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.   A packet carrying a request transaction that requires a response shall not be issued at the highest priority. (This rule ensures that an end point processing element can issue a response packet at a priority higher then the priority of the associated request. This rule in combination with rule 3 are basis for the priority assignments in Table 1-3 and Table 2-4.) </P>

<P> </P>

<P>3.   A packet carrying a response shall have a priority at least one priority level higher than the priority of the associated request. (This rule in combination with rule 2 are basis for the priority assignments in Table 1-3 and Table 2-4.) </P>

<P> </P>

<P>4.   A  switch  processing  element  port  shall  accept  an  error-free  packet  of priority N if there is no packet of priority greater than or equal to N that was previously received by the port and is still waiting in the switch to be forwarded. (This rule has multiple implications which include but are not limited to the following. First, a switch processing element port must have at least as many maximum length packet input buffers as there are priority levels. Second, a minimum of one maximum length packet input buffer must be reserved for each priority level. A input buffer reserved for priority N might be restricted to only priority N packets or might be allowed to hold packets of priority greater than or equal to N, either approach complies with the rule.) </P>

<P> </P>

<P>5.   A switch processing element port that transmits a priority N packet that is forced to retry by the connected device shall select a packet of priority greater than N, if one is available, for transmission. (This guarantees that packets of a given priority will not block higher priority packets.) </P>

<P> </P>

<P>6.   An end point processing element port shall accept an error-free packet of priority N if the port has enough space for the packet in the input buffer space of the port allocated for packets of priority N. (Lack of input buffer space is the only reason an end point may retry a packet.) </P>

<P> </P>

<P>7.   The decision of  an  end point processing element to  accept or retry an error-free packet of priority N shall not be dependent on the ability of the end point to issue request packets of priority less than or equal to N from any of its ports. (This rule works in conjunction with rule 6. It prohibits a device&#8217;s inability to issue packets of priority less than or equal to N, due to congestion in the connected device, from resulting in a lack of buffers to receive inbound packets of priority greater than or equal to N which in turn would result in packets of priority greater than or equal to N being forced to retry. The implications and some ways of complying with this rule are presented in the following paragraphs.) </P>

<P>One implication of Rule 7 is that a port may not fill all of its buffers that can be used to hold packets awaiting transmission with packets carrying request transactions. If this situation was allowed to occur and the output was blocked due to congestion in the connected device, read transactions could not be processed (no place to put the response packet), input buffer space would become filled and all subsequent inbound request packets would be forced to retry violating Rule 7. </P>

<P> </P>

<P>Another implication is that a port must have a way of preventing output blockage at priority less than or equal to N, due to congestion in the connected device, from resulting in a lack of input buffer space for inbound packets of priority greater than or equal to N. There are multiple ways of doing this. </P>

<P> </P>

<P>One way is to provide a port with input buffer space for at least four maximum </P>

<P> </P>

<P>RapidIO Trade Association 27 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>length packets and reserve input buffer space for higher priority packets in a manner similar to that required by Rule 4 for switches. In this case, output port blockage at priority less than or equal to N will not result in blocking inbound packets of priority greater than or equal to N as any responses packets they generate will be of priority greater than N which is not congestion blocked. The port must however have the ability to select packets of priority greater than N for transmission from the packets awaiting transmission. This approach does not require the use of response packet priority promotion. </P>

<P> </P>

<P>Alternatively, a port that does not have enough input buffer space for at least four maximum length packets or that does not reserve space for higher priority packets can use the promotion mechanism to increase the priority of response packets until they are accepted by the connected device. This allows output buffer space containing response packets to be freed even though all request packets awaiting transmission are congestion blocked. </P>

<P> </P>

<P>As an example, suppose an end point processing element has a blocked input port because all available resources are being used for a response packet that the processing element is trying to send. If the response packet is retried by the downstream processing element, raising the priority of the response packet until it is accepted allows the processing element&#8217;s input port to unblock so the system can make forward progress. </P>

<P> </P>

<P> </P>

<P>2.3.4  Resource Allocation </P>

<P> </P>

<P>This section defines RapidIO LP-LVDS link level flow control. The flow control operates between each pair of ports connected by an LP-LVDS link. The purpose of link level flow control is to prevent the loss of packets due to a lack of buffer space in a link receiver. </P>

<P> </P>

<P>The LP-LVDS protocol defines two methods or modes of flow control. These are named receiver-controlled flow control and transmitter-controlled flow control. Every  RapidIO  LP-LVDS  port  shall  support  receiver-controlled flow  control. LP-LVDS ports may optionally support transmitter-controlled flow control. </P>

<P> </P>

<P>2.3.4.1  Receiver-Controlled Flow Control </P>

<P>Receiver-controlled flow control is the simplest and most basic method of flow control. In this method, the input side of a port controls the flow of packets from its link partner by accepting or rejecting (retrying) packets on a packet by packet basis. The receiving port provides no information to its link partner about the amount of buffer space it has available for packet reception. </P>

<P> </P>

<P>As a result, its link partner transmits packets with no a priori expectation as to whether a given packet will be accepted or rejected. A port signals its link partner that it is operating in receiver-controlled flow control mode by setting the buf_status field to all 1&#8217;s in every control symbol containing the field that the port transmits. This method is named receiver-controlled flow control because the receiver makes all of the decisions about how buffers in the receiver are allocated for packet reception. </P>

<P> </P>

<P>28 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>A port operating in receiver-controlled flow control mode accepts or rejects each inbound packet based on whether the receiving port has enough buffer space available at the priority level of the packet. If there is enough buffer space available, the port accepts the packet and transmits a packet-accepted control symbol to its link partner that contains the ackID of the accepted packet in its packet_ackID field. This informs the port&#8217;s link partner that the packet has been received without detected errors and that it has been accepted by the port. On receiving the packet-accepted control symbol, the link partner discards its copy of the accepted packet freeing buffer space in the partner. </P>

<P> </P>

<P>If buffer space is not available, the port rejects the packet. When a port rejects (retries) a packet, it behaves as described in Section 2.3.3, &#8220;Transaction and Packet Delivery&#8221;. As part of the recovery process, the port sends a packet-retry control symbol to its link partner indicating that the packet whose ackID is in the packet_ackID field of the control symbol and all packets subsequently transmitted by the port have been discarded by the link partner and must all be retransmitted. The control symbol also indicates that the link partner is temporarily out of buffers for packets of priority less than or equal to the priority of the retried packet. </P>

<P> </P>

<P>A port that receives a packet-retry control symbol also behaves as described in Section 2.3.3. As part of the recovery process, the port receiving the packet-retry control symbol sends a restart-from-retry control symbol which causes its link partner to resume packet reception. The ackID assigned to that first packet transmitted after the restart-from-retry control symbol is the ackID of the packet that was retried. </P>

<P> </P>

<P>Figure 2-5 shows an example of receiver-controlled flow control operation. In this example the transmitter is capable of sending packets faster than the receiver is able to absorb them. Once the transmitter has received a retry for a packet, the transmitter may elect to cancel any packet that is presently being transmitted since it will be discarded anyway. This makes bandwidth available for any higher priority packets that may be pending transmission. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 29 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Figure 2-5. Receiver-Controlled Flow Control </P>

<P> </P>

<P> </P>

<P>Transmitter Receiver </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_165.jpg"/>
</Figure>

<P>Time Write 0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_166.jpg"/>
</Figure>

<P>Write 1  Ack 0 </P>

<P>Write 2 </P>

<P> </P>

<P>Write 3 </P>

<P>Write 4 </P>

<P>Write 5 </P>

<P>Write 2 </P>

<P>Write 3 </P>

<P>Write 4 </P>

<P>Ack 1 </P>

<P> </P>

<P> </P>

<P>Rtry 2 </P>

<P> </P>

<P> </P>

<P>Ack 2 </P>

<P>Write 5  Ack 3 </P>

<P> </P>

<P>Ack 4 </P>

<P> </P>

<P> </P>

<P>Ack 5 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>2.3.4.2  Transmitter-Controlled Flow Control </P>

<P>In transmitter-controlled flow control, the receiving port provides information to its link partner about the amount of buffer space it has available for packet reception. With this information, the sending port can allocate the use of the receiving port&#8217;s receive buffers according to the number and priority of packets that the sending port has waiting for transmission without concern that one or more of the packets shall be forced to retry. </P>

<P> </P>

<P>A port signals its link partner that it is operating in transmitter-controlled flow control mode by setting the buf_status field to a value different from all 1&#8217;s in every control symbol containing the field that the port transmits. This method is named transmitter-controlled flow control because the transmitter makes almost all of the decisions about how the buffers in the receiver are allocated for packet reception. </P>

<P> </P>

<P>The number of free buffers that a port has available for packet reception is conveyed to its link partner by the value of the buf_status field in control symbols that the port transmits. The value conveyed by the buf_status field is the number of maximum length packet buffers currently available for packet reception up to the limit that can be reported in the field. If a port has more buffers available than the maximum value that can be reported in the buf_status field, the port sets the field to that maximum value. A port may report a smaller number of buffers than it actually has available, but it shall not report a greater number. </P>

<P> </P>

<P>A port informs its link partner when the number of free buffers available for packet reception changes. The new value of buf_status is conveyed in the buf_status field in every control symbol containing the field that the port transmits. Each change in </P>

<P> </P>

<P>30 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>the number of free buffers a port has available for packet reception need not be conveyed to the link partner. </P>

<P> </P>

<P>A port whose link partner is operating in transmitter-control flow control mode should never receive a packet-retry control symbol from its link partner unless the port has transmitted more packets than its link partner has receive buffers, violated the rules that all input buffer may not be filled with low priority packets or there is some fault condition. If a port whose link partner is operating in transmitter-control flow control mode receives a packet-retry control symbol, the output side of the port behaves as described in Section 2.3.3. </P>

<P> </P>

<P>A simple example of transmitter-controlled flow control is shown in Figure 2-6. </P>

<P> </P>

<P>Figure 2-6. Transmitter-Controlled Flow Control </P>

<P> </P>

<P>Transmitter Receiver </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_167.jpg"/>
</Figure>

<P>Time Write 0 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_168.jpg"/>
</Figure>

<P>Write 1 </P>

<P> </P>

<P> </P>

<P>Write 2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Write 3 </P>

<P>Write 4 </P>

<P>Write 5 </P>

<P>Ack 0, 2 buffers avail </P>

<P> </P>

<P>Ack 1, 1 buffer avail </P>

<P> </P>

<P> </P>

<P>Ack 2, 0 buffers avail Idle, 0 buffers avail Idle, 0 buffers avail Idle, 2 buffers avail </P>

<P> </P>

<P>Ack 3, 3 buffers avail </P>

<P> </P>

<P>Ack 4, 2 buffers avail </P>

<P> </P>

<P>Ack 5, 1 buffers avail </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>2.3.4.3  Receive Buffer Management </P>

<P>In transmitter-controlled flow control, the transmitter manages the packet receive buffers in the receiver. This may be done in a number of ways, but the selected method shall not violate the rules in Section 2.3.2, &#8220;Packet Priority and Transaction Request Flows&#8221; concerning the acceptance of packets by ports. </P>

<P> </P>

<P>One possible implementation to organize the buffers is establish watermarks and use them to progressively limit the packet priorities that can be transmitted as the effective number of free buffers in the receiver decreases. For example, RapidIO LP-LVDS has four priority levels. Three non-zero watermarks are needed to progressively limit the packet priorities that may be transmitted as the effective number of free buffers decreases. Designate the three watermarks as WM0, WM1, and WM2 where WM0 &gt; WM1 &gt; WM2 &gt; 0 and employ the following rules. </P>

<P> </P>

<P>If free_buffer_count &gt;= WM0, all priority packets may be transmitted. </P>

<P> </P>

<P>RapidIO Trade Association 31 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>If WM0 &gt; free_buffer_count &gt;= WM1, only priority 1, 2, and 3 packets may be transmitted. </P>

<P> </P>

<P>If WM1 &gt; free_buffer_count &gt;= WM2, only priority 2 and 3 packets may be transmitted. </P>

<P> </P>

<P>If  WM2  &gt;  free_buffer_count,  only  priority  3  packets  may  be transmitted. </P>

<P> </P>

<P>If this method is implemented, the initial values of the watermarks may be set by the hardware at reset as follows. </P>

<P> </P>

<P>WM0 = 4 </P>

<P> </P>

<P>WM1 = 3 </P>

<P> </P>

<P>WM2 = 2 </P>

<P> </P>

<P>These initial values may be modified by hardware or software. The modified watermark values shall be based on the number of free buffers reported in the buf_status field of idle control symbols received by the port following link initialization and before the start of packet transmission. </P>

<P> </P>

<P>The three watermark values and the number of free buffers reported in the buf_status field of idle control symbols received by the port following link initialization and before the start of packet transmission may be stored in a CSR. Since the maximum value of each of these four items is 14, each will fit in an 8-bit field and all four will fit in a single 32-bit CSR. If the watermarks are software setable, the three watermark fields in the CSR should be writable. For the greatest flexibility, a watermark register should be provided for each port on a device. </P>

<P> </P>

<P>2.3.4.4  Effective Number of Free Receive Buffers </P>

<P>The number of buffers available in a port&#8217;s link partner for packet reception is typically less than the value of the buf_status field most recently received from the link partner. The value in the buf_status field does not account for packets that have been transmitted by the port but not acknowledged by its link partner. The variable free_buffer_count is defined to be the effective number of free buffers available in the link partner for packet reception. The value of free_buffer_count shall be determined according to the following rules. </P>

<P> </P>

<P>The port shall maintain a count of the packets that it has transmitted but that have not been acknowledged by its link partner. This count is named the outstanding_packet_count. </P>

<P> </P>

<P>After link initialization and before the start of packet transmission, </P>

<P> </P>

<P>If (received_buf_status &lt; 15) { flow_control_mode = transmitter; free_buffer_count = received_buf_status; outstanding_packet_count = 0; </P>

<P> </P>

<P>32 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>} </P>

<P>else </P>

<P> </P>

<P> </P>

<P> </P>

<P>flow_control_mode = receiver; </P>

<P> </P>

<P>When a packet is transmitted by the port, </P>

<P> </P>

<P>outstanding_packet_count = </P>

<P> </P>

<P> </P>

<P>outstanding_packet_count + 1; </P>

<P> </P>

<P>When a control symbol containing a buf_status field is received by the port, </P>

<P> </P>

<P>free_buffer_count = received_buf_status - outstanding_packet_count; </P>

<P> </P>

<P>When  a  packet-accepted control  symbol  is  received by  the  port indicating that a packet has been accepted by the link partner, </P>

<P> </P>

<P>Outstanding_packet_count = </P>

<P> </P>

<P> </P>

<P>Outstanding_packet_count - 1; </P>

<P>free_buffer_count = received_buf_status - outstanding_packet_count; </P>

<P> </P>

<P>When a packet-retry control symbol is received by the port indicating that a packet has been forced by the link partner to retry, </P>

<P> </P>

<P>Outstanding_packet_count = 0; </P>

<P>free_buffer_count = received_buf_status; </P>

<P> </P>

<P>When a packet-not-accepted control symbol is received by the port indicating that a packet has been rejected by the link partner because of one or more detected errors, </P>

<P> </P>

<P>Outstanding_packet_count = 0; </P>

<P>free_buffer_count = received_buf_status; </P>

<P> </P>

<P>2.3.4.5  Speculative Packet Transmission </P>

<P>A port whose link partner is operating in transmitter-controlled flow control mode may send more packets than the number of free buffers indicated by the link partner. Packets transmitted in excess of the free_buffer_count are transmitted on a speculative basis and are subject to retry by the link partner. The link partner accepts or rejects these packets on a packet by packet basis in exactly the same way it would if operating in receiver-controlled flow control mode. A port may use such speculative transmission in an attempt to maximize the utilization of the link. However, speculative transmission that results in a significant number of retries and discarded packets can reduce the effective bandwidth of the link. </P>

<P> </P>

<P> </P>

<P>2.3.5  Flow Control Mode Negotiation </P>

<P> </P>

<P>Immediately following the initialization of a link, each port begins sending idle control symbols to its link partner. The value of the buf_status field in these control </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 33 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>symbols indicates to the link partner the flow control mode supported by the sending port. </P>

<P> </P>

<P>The flow control mode negotiation rule is as follows: </P>

<P> </P>

<P>If the port and its link partner both support transmitter-controlled flow control, then both ports shall use transmitter-controlled flow control. Otherwise, both ports shall use receiver-controlled flow control. </P>

<P> </P>

<P> </P>

<P>2.4 Error Detection and Recovery </P>

<P> </P>

<P>Error detection and recovery is becoming a more important issue for many systems as operational frequencies increase and system electrical margins are reduced. The </P>

<P>8/16 LP-LVDS specification provides extensive error detection and recovery by combining retry protocols, cyclic redundancy codes, and single and multiple error detect capabilities, thereby tolerating all single-bit errors and many multiple bit errors. One goal of the error protection strategy is to keep the interconnect fabric from having to regenerate a CRC value as the packet moves through the fabric. All RapidIO ports require error checking. </P>

<P> </P>

<P> </P>

<P>2.4.1  Control Symbol Protection </P>

<P> </P>

<P>The control symbols defined in this specification are protected in two ways: </P>

<P> </P>

<P>&#8226; The S bit, distinguishing a control symbol from a packet header, has an odd parity bit to protect a control symbol from being interpreted as a packet. </P>

<P>&#8226; The entire aligned control symbol is protected by the bit-wise inversion of the control symbol used to align it to the 32-bit boundary described in Section </P>

<P>2.2.1. This allows extensive error detection. </P>

<P> </P>

<P>A transmission error in the buf_status field, regardless of the control symbol type, may optionally not be treated as an error condition because it is always a reserved or an information only field that is not critical for proper system behavior. For example, if a corrupt value of buf_status is used, a low value may temporarily prevent a packet from being issued, or a high value may result in a packet being issued when it should not have been, causing a retry. In either case the problems are temporary and will properly resolve themselves through the existing protocol. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>2.4.2  Packet Protection </P>

<P> </P>

<P>The packets specified in the RapidIO Common Transport Specification and the RapidIO Logical Specification are protected with a CRC code that also covers the two bit priority field of this specification. The S bit is duplicated as in the control symbols to protect the packet from being interpreted as a control symbol, and the packet is also protected by protocol as described below. </P>

<P> </P>

<P>Figure 2-7 shows the error coverage for the first 16 bits of a packet header. CRC protects the prio, tt, and ftype fields and one of the reserved bits as well as the remainder of the transport and logical fields. Since a new packet has an expected value for the ackID field at the receiver, bit errors on this field are easily detected and the packet is not accepted due to the unexpected value. An error on the S bit is detected with the redundant inverted S parity bit. </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>S=0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>S=1 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>CRF </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>ftype </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_169.jpg"/>
</Figure>

<P>1 3 1 1 1 1 2 2 4 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_170.jpg"/>
</Figure>

<P>Protected by protocol </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_171.jpg"/>
</Figure>

<P>Protected by CRC Protected by parity </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_172.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_173.jpg"/>
</Figure>

<P> </P>

<P>Figure 2-7. Error Coverage of First 16 Bits of Packet Header </P>

<P> </P>

<P>This structure does not require that a packet&#8217;s CRC value be regenerated when the uncovered physical fields are assigned in the fabric. </P>

<P> </P>

<P>NOTE: </P>

<P>All packets defined in the combination of this specification and the RapidIO interconnect logical and common transport specifications are now evenly divisible by 16 bits, or the complete packets are now naturally 16-bit aligned. This is illustrated in Figure 2-8. The leading </P>

<P>16 bits of the packet are referred to as the first symbol of the packet. The first symbol of a packet shall always land on the most significant half of the 32-bit boundary. Other aligned 16-bit packet quantities are also referred to as symbols. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>S=0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>S=1 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>CRF </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>ftype </P>
</TD>

<TD>
<P>Remainder of transport &amp; logical fields </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_174.jpg"/>
</Figure>

<P>1 3 1 1 1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_175.jpg"/>
</Figure>

<P>1 2 2 4 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_176.jpg"/>
</Figure>

<P>16 bits </P>

<P>n*16 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_177.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P>16-bit boundary </P>

<P> </P>

<P>Figure 2-8. Naturally Aligned Packet Bit Stream </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.4.3  Lost Packet Detection </P>

<P> </P>

<P>Some types of errors, such as a lost request or response packet or a lost acknowledgment, result in a system with hung resources. To detect this type of error there shall be timeout counters that expire when sufficient time has elapsed without receiving the expected response from the system. Because the expiration of one of these timers should indicate to the system that there is a problem, this time interval should be set long enough so that a false timeout is not signaled. The response to this error condition is implementation dependent. </P>

<P> </P>

<P>The RapidIO specifications assume an implementation has timeout counters for the physical layer, the port link timeout counters, and counters for the logical layer, the port response timeout counters. The logical layer timers are discussed here in the physical layer specification because the packet delivery mechanism is an artifact of the physical layer. The values for these counters are specified in the physical layer registers in Chapter  5, &#8220;8/16 LP-LVDS Registers,&#8221; on page 75. The interpretation of the values is implementation dependent, based on a number of factors including link clock rate, the internal clock rate of the device, and the desired system behavior. </P>

<P> </P>

<P>The physical layer timeout occurs between the transmission of a packet and the receipt of an acknowledgment control symbol. This timeout interval is likely to be comparatively short because the packet and acknowledgment pair must only traverse a single link. For the purpose of error recovery, a port link timeout should be treated as a packet acknowledge error. </P>

<P> </P>

<P>The logical layer timeout occurs between the issuance of a request packet that requires a response packet and the receipt of that response packet. This timeout is counted from the time that the logical layer issues the packet to the physical layer to the time that the associated response packet is delivered from the physical layer to the logical layer. Should the physical layer fail to complete the delivery of the packet, the logical layer timeout will occur. This timeout interval is likely to be comparatively long because the packet and response pair have to traverse the fabric at least twice and be processed by the target. Error handling for a response timeout is implementation dependent. </P>

<P> </P>

<P>Certain GSM operations may require two response transactions, and both must be received for the operation to be considered complete. In the case of a device implementation with multiple links, one response packet may be returned on the same link where the operation was initiated and the other response packet may be returned on a different link. If this is behavior is supported by the issuing processing element, the port response timeout implementation must look for both responses, regardless of which links they are returned on. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>2.4.4  Implementation Note: Transactional Boundaries </P>

<P> </P>

<P>A system address map usually contains memory boundaries that separate one type of memory space from another. Memory spaces are typically allocated with a preset minimum granularity. These spaces are often called page boundaries. Page boundaries allow the operating system to manage the entire address space through a standard mechanism. These boundaries are often used to mark the start and end of read-only space, peripheral register space, data space, and so forth. </P>

<P> </P>

<P>RapidIO allows DMA streaming of data between two processing elements. Typically, in system interfaces that allow streaming, the targeted device of the transaction has a way to disconnect from the master once a transactional boundary has been crossed. The RapidIO specifications do not define a page boundary, nor a mechanism by which a target can disconnect part way through a transaction. Therefore, it is up to the system software and/or hardware implementation to guarantee that a transaction can complete gracefully to the address space requested. </P>

<P> </P>

<P>As an example, a RapidIO write transaction does not necessarily have a size associated with it. Given a bus error condition whereby a packet delimiting control symbol is missed, the target hardware could continue writing data beyond the intended address space, thus possibly corrupting memory. Hardware implementations should set up page boundaries so this condition does not occur. In such an implementation, should a transaction cross the boundary, an error should be indicated and the transaction discarded. </P>

<P> </P>

<P> </P>

<P>2.4.5  Link Behavior Under Error </P>

<P> </P>

<P>Transmission error detection is done at the input port, and all transmission error recovery is also initiated at the input port. Error detection can be done in a number of ways and at differing levels of complexity depending upon the requirements and implementation of a device. </P>

<P> </P>

<P>2.4.5.1  Recoverable Errors </P>

<P> </P>

<P>Four basic types of errors are detected by a port: an error on a packet, an error on a control symbol, an indeterminate error (an S bit parity failure), and a timeout waiting for a control symbol. A detailed state machine description of the behavior described in the sections below is included in Section A.2, &quot;Error Recovery&quot;. The error recovery mechanism requires that a copy of each transmitted data packet be retained by the sending port so that the packet can be retransmitted if it is not accepted by the receiving  port. The  copy  is  retained  until  the  sending  port  either  receives  a packet-accepted control symbol for the packet or determines that the packet has encountered an unrecoverable error condition. </P>

<P> </P>

<P>When a sending port detects that the receiving port has not accepted a packet because one or more of the errors listed above has occurred (or the port has received a retry control symbol), the sending port resets the link timeout counters for the </P>

<P> </P>

<P>RapidIO Trade Association 37 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>affected packet and all subsequently transmitted data packets. This prevents the generation of spurious timeout errors. </P>

<P> </P>

<P>Any awaiting higher priority data packets are transmitted and all unaccepted data packets are retransmitted by the sending port. The number of times a data packet is retransmitted due to a recoverable error before the sending port declares an unrecoverable error condition exists is implementation dependent. </P>

<P> </P>

<P>2.4.5.1.1  Packet Errors </P>

<P> </P>

<P>Three types of packet errors exist: a packet with an unexpected ackID value, a corrupted packet indicated by a bad CRC value, and a packet that overruns some defined boundary such as the maximum data payload or a transactional boundary as described in Section 2.4.4. A processing element that detects a packet error immediately transitions into an &#8220;Input Error-stopped&#8221; state and silently discards all new packets until it receives a restart-from-error control symbol from the sender. The device also sends a packet-not-accepted control symbol with an undefined ackID value back to the sender. The sender then initiates recovery as described in Section 2.4.5.1.2 for a packet acknowledge error. </P>

<P> </P>

<P>2.4.5.1.2  Control Symbol Errors </P>

<P> </P>

<P>There are three types of detectable control symbol errors: a packet acknowledge error, a corrupt control symbol error, and an uncorrupted protocol violating control symbol. </P>

<P> </P>

<P>A packet acknowledge error is a packet-accepted or packet-retry control symbol which has an unexpected ackID value or an unexpected packet-not-accepted control symbol.  This  error  shall  cause  the  receiving  device  to  enter  an  &#8220;Output Error-stopped&#8221; state, immediately stop transmitting new packets, and issue a restart-from-error control symbol. The restart-from-error control symbol receives a response containing receiver internal state, including the expected ackID. This expected ackID indicates to the sender where to begin re-transmission because the interface may have gotten out of sequence. The sender shall then back up to the appropriate unaccepted packet and begin re-transmission. </P>

<P> </P>

<P>The following is an example of a packet acknowledge error and recovery from that error. The sender transmits packets labeled ackID 2, 3, 4, and 5. It receives acknowledgments for packets 2, 4 and 5, indicating a probable error associated with ackID   3.  The   sender   then   stops   transmitting  new   packets   and   sends   a restart-from-error control symbol to the receiver. The receiver then returns a response control symbol indicating which packets it has received properly. These are the possible responses and the sender&#8217;s resulting behavior: </P>

<P> </P>

<P>&#8226; expecting ackID = 3 - sender must re-transmit packets 3, 4, and 5 </P>

<P>&#8226; expecting ackID = 4 - sender must re-transmit packets 4 and 5 </P>

<P>&#8226; expecting ackID = 5 - sender must re-transmit packet 5 </P>

<P>&#8226; expecting ackID = 6 - receiver got all packets, resume operation </P>

<P> </P>

<P>38 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; expecting ackID = anything else - fatal (non-recoverable) error </P>

<P> </P>

<P>A corrupt control symbol is detected as a mismatch between the true and complement 16-bit halves of the aligned control symbol. A corrupt control symbol shall  cause  the  receiver  to  enter  the  &#8220;Input  Error-stopped&#8221; state  and  send  a packet-not-accepted control symbol. This informs the sending device that a transmission error has occurred and the sender shall enter the recovery process described above, sending a restart-from-error control symbol. </P>

<P> </P>

<P>An uncorrupted protocol violating control symbol is a control symbol that is received unexpectedly. Some examples of this type of error are: </P>

<P>&#8226; an unsolicited packet-accepted or packet-retry control symbol </P>

<P>&#8226; a restart-from-retry control symbol received while in the Input OK state, </P>

<P>&#8226; a 2nd link-request received before returning a link-response, or </P>

<P>&#8226; a packet-accepted received before packet transmission has completed </P>

<P> </P>

<P>Such errors are an indication of either an otherwise undetectable multi-bit error on the link or a blatant protocol violation by the sender. Such errors may cause unpredictable behavior and the link may not be recoverable. Upon detecting such an error, the receiver shall enter Input Error-stopped state and/or Output Error-stopped state if attempting to recover from these types of errors. </P>

<P> </P>

<P>2.4.5.1.3  Indeterminate errors </P>

<P> </P>

<P>An indeterminate error is an S bit parity error in which it is unclear whether the information being received is for a packet or a control symbol. These errors shall be handled as a corrupt control symbols. </P>

<P> </P>

<P>2.4.5.1.4  Timeout Error </P>

<P> </P>

<P>A link timeout on an acknowledge control symbol for a packet is treated like an acknowledge control symbol with an unexpected ackID value. </P>

<P> </P>

<P> </P>

<P>2.4.6  CRC Operation </P>

<P> </P>

<P>A 16-bit CRC is selected as the method of error detection for the 8/16 LP-LVDS physical layer. This CRC is generated over all of a packet header, and all of the data payload except the first 6 bits of the added physical layer fields as shown in Figure 2-7. This checksum is appended to a packet in one of two ways. For a packet that has up to 80 bytes of header (including all logical, transport, and 8/16 LP-LVDS fields) and logical data payload, a single CRC value is appended to the packet. For packets with greater than 80 bytes of header and logical data payload, a CRC value is inserted after the first 80 bytes, aligning it to the first half of the 32-bit alignment boundary, and a second CRC value is appended at the end of the packet. The second CRC value is a continuation of the first and included in the running calculation, meaning that the running CRC value is not re-initialized after it is inserted after the first 80 bytes of the packet. This allows intervening devices to regard the embedded </P>

<P> </P>

<P>RapidIO Trade Association 39 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>CRC value as 2 bytes of packet payload for CRC checking purposes. </P>

<P> </P>

<P>NOTE: </P>

<P>The embedded CRC value is itself used in the running CRC. As a result, from the CRC generator&#8217;s point of view the running CRC value is guaranteed to be all logic 0&#8217;s because the running CRC is XORed with itself. This fact may be useful in an implementation. </P>

<P> </P>

<P>The early CRC value can be used by the receiving processing element to validate the header of a large packet and start processing the data before the entire packet has been received, freeing up resources earlier and reducing transaction completion latency. If the final appended CRC value does not cause the total packet to align to the 32-bit boundary, a 2 byte pad of all logic 0s is postpended to the packet. The pad of logic 0s allows the CRC check to always be done at the 32-bit boundary. A corrupt pad may or may not cause a CRC error to be detected, depending upon the implementation. </P>

<P> </P>

<P>NOTE: </P>

<P>While the embedded CRC value can be used by a processing element to start processing the data within a packet before receiving the entire packet, it is possible that upon reception of the end of the packet the final CRC value for the packet is incorrect. This would result in a processing element that has processed data that may have been corrupted. Outside of the error recovery mechanism described in Section 1.3.5, the RapidIO Interconnect Specification does not address the occurrence of such situations nor does it suggest a means by which a processing element would handle such situations. Instead, the mechanism for handling this situation is left to be addressed by the device manufacturers for devices that implement the functionality of early processing of packet data. </P>

<P> </P>

<P>Switch devices shall maintain the packet error coverage internally in order to preserve the integrity of the packets though the fabric. This will prevent undetected device internal errors such as SRAM bit errors from silently corrupting the system. The simplest method for preserving error coverage is to pass the CRC values through the switch as part of the packet. This works well for all non-maintenance packets whose CRC does not change as the packets are transported from source to destination thought the fabric. Maintaining error detection coverage is more complicated for maintenance packets as their hop_count and CRC change every time they pass through a switch. </P>

<P> </P>

<P>Figure 2-9 is an example of a naturally 32-bit aligned packet of less than or equal to </P>

<P>80 bytes. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>First symbol Remainder of packet </P>

<P>CRC </P>

<P> </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>

<P>Even # of 16-bit multiples 16 </P>

<P>32-bit boundary </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_178.jpg"/>
</Figure>

<P>Figure 2-9. Naturally Aligned Packet Bit Stream Example 1 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_179.jpg"/>
</Figure>

<P>Figure 2-10 is an example of a naturally 32-bit aligned packet of greater than 80 bytes. </P>

<P> </P>

<P> </P>

<P>First symbol Remainder of packet header </P>

<P> </P>

<P>16 (bytes 1 and 2) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_180.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P> </P>

<P>Odd # of 16-bit multiples </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Logical data </P>
</TD>

<TD>
<P>CRC </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Even # of 16-bit multiples 16 (bytes 81 and 82) </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Remainder of logical data CRC </P>

<P> </P>

<P>Even # of 16-bit multiples </P>

<P> </P>

<P>16 </P>

<P>32-bit boundary </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_181.jpg"/>
</Figure>

<P>Figure 2-10. Naturally Aligned Packet Bit Stream Example 2 </P>

<P> </P>

<P>Figure 2-11 is an example of a padded 32-bit aligned packet of less than or equal to </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_182.jpg"/>
</Figure>

<P>80 bytes. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_183.jpg"/>
</Figure>

<P>First symbol Remainder of packet </P>

<P>Odd # of 16-bit multiples </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_184.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P> </P>

<P> </P>

<P>CRC value Logic 0 pad </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_185.jpg"/>
</Figure>

<P>16 16 </P>

<P>32-bit boundary </P>

<P> </P>

<P>Figure 2-11. Padded Aligned Packet Bit Stream Example 1 </P>

<P> </P>

<P>Figure 2-12 is an example of a padded 32-bit aligned packet of greater than 80 bytes. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_186.jpg"/>
</Figure>

<P>First symbol Remainder of packet header </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_187.jpg"/>
</Figure>

<P>16 (bytes 1 and 2) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_188.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P> </P>

<P>Even # of 16-bit multiples </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>

<P> </P>

<P>Logical data CRC </P>

<P> </P>

<P>Odd # of 16-bit multiples </P>

<P> </P>

<P>16 (bytes 81 and 82) </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_189.jpg"/>
</Figure>

<P>Remainder of logical data CRC </P>

<P> </P>

<P>Odd # of 16-bit multiples 16 </P>

<P> </P>

<P> </P>

<P>Logic 0 pad </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_190.jpg"/>
</Figure>

<P>16 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_191.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P> </P>

<P>Figure 2-12. Padded Aligned Packet Bit Stream Example 2 </P>

<P> </P>

<P>2.4.7  CRC Code </P>

<P> </P>

<P>The CCITT polynomial X16+X12+X5+1 is a popular CRC code. The initial value of the CRC is 0xFFFF (all logic 1s). For the CRC calculation, the uncovered 6 bits are treated as logic 0s. As an example, a 16-bit wide parallel calculation is described in the equations in Table 2-5. Equivalent implementations of other widths can be employed. </P>

<P> </P>

<P>Table 2-5. Parallel CRC Intermediate Value Equations </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Check Bit </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>0 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>1 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>2 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>3 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>4 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>5 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>6 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>7 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>8 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>9 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>0 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>1 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>2 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>3 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>4 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>5 </P>
</TD>
</TR>

<TR>
<TD>
<P>C00 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C01 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C02 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C03 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>C04 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C05 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C06 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C07 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C08 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C09 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C10 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>C11 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C12 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C13 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 2-5. Parallel CRC Intermediate Value Equations (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Check Bit </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>0 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>1 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>2 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>3 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>4 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>5 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>6 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>7 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>8 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>9 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>0 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>1 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>2 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>3 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>4 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>5 </P>
</TD>
</TR>

<TR>
<TD>
<P>C14 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C15 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>
</Table>

<P> </P>

<P>where: </P>

<P> </P>

<P>C00&#8211;C15 contents of the new check symbol </P>

<P>e00&#8211;e15 contents of the intermediate value symbol&#61472;&#61472;</P>

<P>e00 = d00 XOR c00&#61472;&#61472;</P>

<P>e01 = d01 XOR c01&#61472;&#61472;</P>

<P>through&#61472;&#61472;</P>

<P>e15 = d15 XOR c15 </P>

<P> </P>

<P>d00&#8211;d15 contents of the next 16 bits of the packet c00&#8211;c15 contents of the previous check symbol </P>

<P>assuming the pipeline described in Figure 2-13 </P>

<P> </P>

<P> </P>

<P>d00&#8211;d15 </P>

<P> </P>

<P>c XOR d </P>

<P> </P>

<P>e00&#8211;e15 </P>

<P> </P>

<P>XOR </P>

<P>equations network </P>

<P> </P>

<P>C00&#8211;C15 </P>

<P> </P>

<P> </P>

<P>c00&#8211;c15 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_192.jpg"/>
</Figure>

<P>Figure 2-13. CRC Generation Pipeline </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.5 Maximum Packet Size </P>

<P> </P>

<P>The maximum packet size permitted by the 8/16 LP-LVDS specification is 276 bytes. This includes all packet logical, transport, and physical layer header information, data payload, and required CRC bytes. </P>

<P> </P>

<P>The maximum packet size of 276 bytes is achieved as shown below: </P>

<P> </P>

<P>Table 2-6. Maximum Packet Size </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Field </P>
</TD>

<TD>
<P>Size </P>

<P>(bytes) </P>
</TD>

<TD>
<P> </P>

<P>Layer </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD>
<P>Header </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>Physical, Transport, Logical </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Source ID </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>Transport </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Destination ID </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>Transport </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Trans/wrsize </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Logical </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>srcTID </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Logical </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Address </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>Logical </P>
</TD>

<TD>
<P>Includes Extended_address, Address, Wdptr, and Xambs </P>
</TD>
</TR>

<TR>
<TD>
<P>Payload </P>
</TD>

<TD>
<P>256 </P>
</TD>

<TD>
<P>Logical </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>Physical </P>
</TD>

<TD>
<P>Extra two CRC bytes for packets greater than 80 bytes </P>
</TD>
</TR>

<TR>
<TD>
<P>Total </P>
</TD>

<TD>
<P>276 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>2.6 Link Maintenance Protocol </P>

<P> </P>

<P>To initialize, explore, and recover from errors it is necessary to have a secondary mechanism to communicate between connected system devices. This mechanism is used  to  establish  communications  between  connected  devices  (described  in Section 3.7.1, &#8220;Port and Link Initialization&#8221;), attempt automatic error recovery as described  above  in  Section 2.4.5,  &#8220;Link  Behavior  Under  Error,&#8221;  and  allows software-managed link maintenance operations. </P>

<P> </P>

<P>This protocol involves a request and response pair between electrically connected (linked) devices in the system. For software management, the request is generated through ports in the configuration space of the sending device. An external processing element write of a command to the link-request register with a RapidIO Part 1: Input/Output Logical Specification maintenance write transaction causes an aligned link-request control symbol to be issued onto the output port of the device, but only one link-request can be outstanding on a link at a time. The device that is </P>

<P> </P>

<P>44 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>linked to the sending device shall respond with an aligned link-response control symbol if the link-request command required it to do so. The external processing element retrieves the link-response by polling the link-response register with I/O logical maintenance read transactions. A device with multiple RapidIO interfaces has a link-request and a link-response register pair for each corresponding RapidIO interface. </P>

<P> </P>

<P>The automatic recovery mechanism relies on the hardware generating link-request control symbols under the transmission error conditions described in Section 2.4.5.1 and using the corresponding link-response information to attempt recovery. </P>

<P> </P>

<P>Automatic link initialization also depends upon hardware generation of the appropriate link-requests and link-responses. </P>

<P> </P>

<P> </P>

<P>2.6.1  Command Descriptions </P>

<P> </P>

<P>Table 2-7 contains a summary of the link maintenance commands that use the link maintenance protocol described above. Three link request commands are defined currently. The input-status command generates a paired link-response control symbol; the reset and send-training commands do not. </P>

<P>Table 2-7. Secondary Link Maintenance Command Summary </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Command </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>Reset </P>
</TD>

<TD>
<P>Resets the device </P>
</TD>
</TR>

<TR>
<TD>
<P>Input-status </P>
</TD>

<TD>
<P>Returns input port status; functions as a restart-from-error control symbol under error conditions. </P>

<P>Generates a paired link-response control symbol. </P>
</TD>
</TR>

<TR>
<TD>
<P>Send-training </P>
</TD>

<TD>
<P>Stops normal operation and transmits 256 training pattern iterations </P>
</TD>
</TR>
</Table>

<P> </P>

<P>2.6.1.1  Reset and Safety Lockouts </P>

<P> </P>

<P>The reset command causes the receiving device to go through its hard reset or power up sequence. All state machines and the configuration registers reset to the original power on states. The reset command does not generate a link-response control symbol. </P>

<P> </P>

<P>Due to the undefined reliability of system designs it is necessary to put a safety lockout on the reset function of the link request control symbol. A device receiving a reset command in a link-request control symbol shall not perform the reset function unless it has received four reset commands in a row without any other intervening packets or control symbols, except idle control symbols. This will prevent spurious reset commands inadvertently resetting a device. </P>

<P> </P>

<P>When issuing a reset with four consecutive reset commands, care must be taken to account for all effects associated with the reset event. Consult RapidIO Part 8: Error Management Extensions Specification for more information. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.6.1.2  Input-status </P>

<P> </P>

<P>The input-status command requests the receiving device to return the ackID value it expects to next receive from the sender on its input port and the current input port operational status for informational purposes. This command causes the receiver to flush its output port of all control symbols generated by packets received before the input-status command. The receiver then responds with a link-response control symbol. </P>

<P> </P>

<P>The input-status command is the command used by the hardware to recover from transmission errors. If the input port had stopped due to a transmission error that generated a packet-not-accepted control symbol back to the sender, this input-status command acts as a restart-from-error control symbol, and the receiver is re-enabled to receive new packets after generating the link-response control symbol. This restart-from-error control symbol may also be used to restart the receiving device if it is waiting for a restart-from-retry control symbol after retrying a packet. This situation  can  occur  if  transmission  errors  are  encountered  while  trying  to re-synchronize the sending and receiving devices after the retry. </P>

<P> </P>

<P>2.6.1.3  Send-training </P>

<P> </P>

<P>The send-training command causes the recipient device to suspend normal operation and begin transmitting a special training pattern. The receiving device transmits a total of 256 iterations of the training pattern followed by at least one idle control symbol and then resumes operation. The usage of this command is described in Section 3.7.1.1, &#8220;Sampling Window Alignment.&#8221; The send-training command does not generate a link-response control symbol. </P>

<P> </P>

<P> </P>

<P>2.6.2  Status Descriptions </P>

<P> </P>

<P>The input-status request generates two pieces of information that are returned in the link-response: </P>

<P> </P>

<P>&#8226; link status </P>

<P>&#8226; ackID usage </P>

<P> </P>

<P>The first type of data is the current operational status of the interface. These status indicators are described in Table 2-8. </P>

<P> </P>

<P>Table 2-8. Link Status Indicators </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Status Indicator </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>OK </P>
</TD>

<TD>
<P>The port is working properly. </P>
</TD>
</TR>

<TR>
<TD>
<P>Error </P>
</TD>

<TD>
<P>The port has encountered an unrecoverable error and has shut down. </P>
</TD>
</TR>

<TR>
<TD>
<P>Retry-stopped1 </P>
</TD>

<TD>
<P>The port has been stopped due to a retry. </P>
</TD>
</TR>

<TR>
<TD>
<P>Error-stopped1 </P>
</TD>

<TD>
<P>The port has been stopped due to a transmission error. </P>
</TD>
</TR>
</Table>

<P>1Valid only with the Stopped indicator </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The retry-stopped state indicates that the port has retried a packet and is waiting to be    restarted.   This    state    is    cleared    when    a    restart-from-retry   (or    a link-request/input-status) control symbol is received. The error-stopped state indicates that the port has encountered a transmission error and is waiting to be restarted. This state is cleared when a link-request/input-status control symbol is received. </P>

<P> </P>

<P>The second field returned in the link-response control symbol is state information about the acknowledge identifier usage. The input port returns a value indicating the next ackID expected to be received by the port. The automatic error recovery mechanism uses   this   information   to   determine   where   to   begin   packet re-transmission after a transmission error condition has been encountered. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Packet and Control Symbol </P>

<P>Transmission </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This RapidIO chapter defines the RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification packet and control symbol delineation and alignment on the physical port and mechanisms to control the pacing of a packet. Each input and output port is either one or two bytes wide. All 8/16 LP-LVDS defined protocols are used identically for both the 8- and 16-bit wide versions of the physical interface. The only difference is the number of pins used to transmit the packets and aligned control symbols. </P>

<P> </P>

<P> </P>

<P>3.2 Packet Start and Control Symbol Delineation </P>

<P> </P>

<P>The control framing signal used to delineate the start of a packet or a control symbol on the physical port is a no-return-to-zero, or NRZ signal. This frame signal is toggled for the first symbol (see the Note in Section 2.4.2, &#8220;Packet Protection&#8221;) of each packet and for the first control symbol of each aligned control symbol. Therefore, if a 16-bit symbol contains a RapidIO logical packet format type (the ftype field in the RapidIO logical specifications) or a control symbol (stype) field, the frame signal shall toggle. In order for the receiving processing element to sample the data and frame signals, a data reference signal is supplied that toggles on all possible transitions of the interface pins. This type of data reference signal is also known as a double-data-rate clock. These received clocks on devices with multiple RapidIO ports have no required frequency or phase relationship. </P>

<P> </P>

<P>The framing signal is not toggled for other symbols such as those containing remaining packet header and data bytes. However, it is toggled for all idle control symbols between packets. This means that the maximum toggle rate of the control framing signal is every 4 bytes, and the framing signal is only allowed to toggle on every fourth byte. Therefore, the framing signal is aligned to a 32-bit boundary as are all of the packets and aligned control symbols. Additionally, the data reference signal shall transition from low to high on this same boundary. Examples of these constraints are shown in Figure 3-1 and Figure 3-3 for an 8-bit port and Figure 3-2 and Figure 3-4 for a 16-bit port. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_193.jpg"/>
</Figure>

<P>Byte stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_194.jpg"/>
</Figure>

<P> </P>

<P>Control </P>

<P> </P>

<P>Control </P>

<P> </P>

<P>C=ontrol </P>

<P> </P>

<P>C=ontrol Packet </P>

<P> </P>

<P>Packet </P>

<P> </P>

<P>Packet </P>

<P> </P>

<P>Packet </P>

<P> </P>

<P>Packet </P>

<P>byte byte </P>

<P>byte 0 </P>

<P>byte 1 </P>

<P>byte 0 </P>

<P>byte 1 </P>

<P>byte </P>

<P>byte </P>

<P>byte </P>

<P>byte </P>

<P>byte </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_195.jpg"/>
</Figure>

<P>Framing signal </P>

<P>Framing signal </P>

<P>toggles toggles </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_196.jpg"/>
</Figure>

<P>Data reference signal rises </P>

<P>aligned to framing signal transition and 32-bit boundary </P>

<P> </P>

<P>Figure 3-1. Framing Signal Maximum Toggle Rate for 8-bit Port </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_197.jpg"/>
</Figure>

<P>Symbol stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_198.jpg"/>
</Figure>

<P> </P>

<P>symbol symbol </P>

<P> </P>

<P>Control symbol </P>

<P> </P>

<P>Control symbol </P>

<P> </P>

<P>Packet symbol </P>

<P> </P>

<P>Packet symbol </P>

<P> </P>

<P>Packet symbol </P>

<P> </P>

<P>Packet symbol </P>

<P> </P>

<P>Packet symbol </P>

<P> </P>

<P>Packet symbol </P>

<P> </P>

<P>Packet symbol </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_199.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P> </P>

<P>Framing signal toggles </P>

<P> </P>

<P> </P>

<P>Framing signal toggles </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_200.jpg"/>
</Figure>

<P>Data reference signal rises </P>

<P>aligned to framing signal transition and 32-bit boundary </P>

<P> </P>

<P>Figure 3-2. Framing Signal Maximum Toggle Rate for 16-bit Port </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_201.jpg"/>
</Figure>

<P>Byte stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_202.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>byte </P>

<P>Control byte 0 </P>

<P>Control byte 1 </P>

<P>Control byte 0 </P>

<P>Control byte 1 </P>

<P>Idle byte 0 </P>

<P>Idle byte 1 </P>

<P>Idle byte 0 </P>

<P>Idle byte 1 </P>

<P>Control byte 0 </P>

<P>Control byte 1 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_203.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_204.jpg"/>
</Figure>

<P>Framing signal </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_205.jpg"/>
</Figure>

<P>Data reference signal </P>

<P> </P>

<P>Figure 3-3. Control Symbol Delineation Example for 8-bit Port </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_206.jpg"/>
</Figure>

<P>Symbol stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_207.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>symbol </P>

<P>Control symbol </P>

<P>Control symbol </P>

<P>Control symbol </P>

<P>Control symbol </P>

<P>Idle symbol </P>

<P>Idle symbol </P>

<P>Control symbol </P>

<P>Control symbol </P>

<P>symbol symbol </P>

<P> </P>

<P>32-bit boundary </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_208.jpg"/>
</Figure>

<P>Framing signal </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_209.jpg"/>
</Figure>

<P>Data reference signal </P>

<P> </P>

<P>Figure 3-4. Control Symbol Delineation Example for 16-bit Port </P>

<P> </P>

<P>Errors on the framing and data reference signals can be detected either directly by verifying that the signals transition only when they are allowed and expected to transition, or indirectly by depending upon detection of packet header or CRC or control symbol corruption, etc. if these signals behave improperly. Either method of error detection on the framing and data reference signals allows error recovery by following the mechanisms described in Section 2.4.5.1, &#8220;Recoverable Errors&#8221; and Section A.4, &#8220;Error Recovery.&#8221; </P>

<P> </P>

<P>For simplicity, the data reference signal will not be included in any additional figures in this document. It is always rising on the 32-bit boundary when it is legal for the frame signal to toggle as shown in Figure 3-1 through Figure 3-4. </P>

<P> </P>

<P> </P>

<P>3.3 Packet Termination </P>

<P> </P>

<P>A packet is terminated in one of two ways: </P>

<P> </P>

<P>&#8226; The beginning of a new packet marks the end of a previous packet. </P>

<P>&#8226; The end of a packet may be marked with one of the following: an aligned end-of-packet (eop), restart-from-retry, link-request, or stomp control symbol. </P>

<P> </P>

<P>The stomp control symbol is used if a transmitting processing element detects a problem with the transmission of a packet. It may choose to cancel the packet by sending the stomp control symbol instead of terminating it in a different, possibly system fatal, fashion like corrupting the CRC value. </P>

<P> </P>

<P>The restart-from-retry control symbol can cancel the current packet as well as be transmitted on an idle link. This control symbol is used to enable the receiver to start accepting packets after the receiver has retried a packet. </P>

<P> </P>

<P>The link-request control symbol can cancel the current packet as well as be transmitted on an idle link and has several applications. It can be used by software for system observation and maintenance, and it can be used by software or hardware to enable the receiver to start accepting packets after the receiver has refused a packet due to a transmission error as described in Section 2.4, &#8220;Error Detection and </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 51 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Recovery.&#8221; </P>

<P> </P>

<P>A port receiving a canceled packet shall drop the packet. The cancelation of a packet shall not result in the generation of any errors. If the packet was canceled because the sender received a packet-not-accepted control symbol, the error that caused the packet-not-accepted to be sent shall be reported in the normal manner. </P>

<P> </P>

<P>If a port receiving a canceled packet has not previously acknowledged the packet and is not in an &#8220;Input Stopped&#8221; stopped state (Retry-Stopped or Error-Stopped), the port shall immediately enter the Input Retry-stopped state and follow the Packet Retry mechanism specified in Section 2.3.3, &#8220;Transaction and Packet Delivery&#8221;, if the packet was canceled with a control symbol other than a restart-from-retry or a link-request/input-status control symbol. As part of the Packet Retry mechanism, the port sends a packet-retry control symbol to the sending port indicating that the canceled packet was not accepted. </P>

<P> </P>

<P>Figure 3-5 is an example of a new packet marking the end of a packet. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_210.jpg"/>
</Figure>

<P>Byte stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_211.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>byte byte </P>

<P> </P>

<P>byte byte byte byte </P>

<P> </P>

<P>byte </P>

<P>Header byte 0 </P>

<P> </P>

<P>byte 1 byte 2 </P>

<P> </P>

<P>byte 3 </P>

<P> </P>

<P>Byte stream for a packet </P>

<P> </P>

<P>Last byte for packet </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_212.jpg"/>
</Figure>

<P>Start header for new packet </P>

<P> </P>

<P>Figure 3-5. Header Marked End of Packet (8-bit Port) </P>

<P> </P>

<P>Figure 3-6 is an example of an aligned end-of-packet control symbol marking the end of a packet. The stomp, link-request, and restart-from-retry control symbol cases look similar. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_213.jpg"/>
</Figure>

<P>Symbol stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_214.jpg"/>
</Figure>

<P> </P>

<P>symbol symbol </P>

<P>symbol symbol symbol </P>

<P> </P>

<P>Symbol stream </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Eop </P>
</TD>

<TD>
<P>  Eop   </P>
</TD>

<TD>
<P>Idle </P>
</TD>

<TD>
<P>  Idle  </P>
</TD>

<TD>
<P>Idle </P>
</TD>

<TD>
<P>  Idle  </P>
</TD>
</TR>

<TR>
<TD>
<P>symbol </P>
</TD>

<TD>
<P>symbol </P>
</TD>

<TD>
<P>symbol </P>
</TD>

<TD>
<P>symbol </P>
</TD>

<TD>
<P>symbol </P>
</TD>

<TD>
<P>symbol </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Last symbol </P>

<P>for a packet for packet 32-bit boundary </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_215.jpg"/>
</Figure>

<P>Start end-of-packet symbol </P>

<P> </P>

<P>Figure 3-6. End-Of-Packet Control Symbol Marked End of Packet (16-bit Port) </P>

<P> </P>

<P>3.4 Packet Pacing </P>

<P> </P>

<P>If a device cannot transmit a packet as a contiguous stream of control symbols, it may force wait states by inserting idle control symbols called pacing idles. As with the other control symbols, the pacing idle control symbols are always followed by a bit-wise inverted copy and are then called aligned pacing idle control symbols. Any number  of  aligned  pacing  idle  control  symbols  can  be  inserted,  up  to  some </P>

<P> </P>

<P>52 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>implementation defined limit, at which point the sender should instead send a stomp control symbol and cancel the packet in order to attempt to transmit a different packet. Figure 3-7 shows an example of packet pacing. These idle control symbols are ignored by the receiving device, and more data is sent when it becomes available. Pacing idle control symbols can be embedded anywhere in a packet where they can be legally delineated. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_216.jpg"/>
</Figure>

<P>Byte stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_217.jpg"/>
</Figure>

<P> </P>

<P>Idle byte 1 </P>

<P>Header byte 0 </P>

<P> </P>

<P>byte 1 </P>

<P> </P>

<P>byte 2 byte 3 </P>

<P>Idle byte 0 </P>

<P>Idle byte 1 </P>

<P>Idle byte 0 </P>

<P>Idle byte 1 </P>

<P> </P>

<P>byte 4 </P>

<P> </P>

<P>byte 5 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Start of </P>

<P>packet header </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_218.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P>Inserted pacing idle symbol </P>

<P>More bytes for the packet </P>

<P> </P>

<P>Figure 3-7. Pacing Idle Insertion in Packet (8-bit Port) </P>

<P> </P>

<P>The receiver of a packet may request that the sender insert pacing idle control symbols on its behalf by sending a throttle control symbol specifying the number of aligned pacing idle control symbols to delay. The packet sender then inserts that number of aligned pacing idles into the packet stream. If additional delay is needed, the receiver can send another throttle control symbol. </P>

<P> </P>

<P>If the receiver requests too many aligned pacing idles indicating an excessive delay, determined by some implementation defined limit, it should terminate the packet transmission by issuing a packet-retry acknowledge control symbol. Alternatively, the sender may issue a stomp control symbol to cancel the packet if too many aligned pacing idle control symbols are requested by the receiver. The throttle control symbol shall be honored because it is used to force insertion of idle control symbols for clock re-synchronization in the receiver as described in Chapter 6, &#8220;System Clocking Considerations.&#8221; </P>

<P> </P>

<P>The maximum allowed response time from the receipt of the last byte of an aligned throttle control symbol at the input pins to the appearance of the first byte of an aligned pacing idle control symbol on the output pins is 40 interface clocks (80 data ticks). </P>

<P> </P>

<P>Note that for CRC values for a packet, the aligned pacing idle control symbols are not included in the calculation. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.5 Embedded Control Symbols </P>

<P> </P>

<P>Control symbols can be embedded anywhere in a packet in the same fashion as pacing idle control symbols, as long as all delineation and alignment rules are followed. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_219.jpg"/>
</Figure>

<P>Byte stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_220.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>byte byte </P>

<P> </P>

<P>byte byte </P>

<P>Control byte 0 </P>

<P>Control byte 1 </P>

<P>Control byte 0 </P>

<P>Control byte 1 </P>

<P> </P>

<P>byte byte </P>

<P> </P>

<P>byte </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_221.jpg"/>
</Figure>

<P>Bytes for a packet </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>

<P>Packet continues </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_222.jpg"/>
</Figure>

<P>Embedded control symbol </P>

<P> </P>

<P>Figure 3-8. Embedded Control Symbols for 8-bit Port </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_223.jpg"/>
</Figure>

<P>Symbol stream through time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_224.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>symbol symbol </P>

<P> </P>

<P>symbol symbol </P>

<P>Control symbol </P>

<P>Control symbol </P>

<P> </P>

<P>symbol </P>

<P> </P>

<P>symbol </P>

<P> </P>

<P>symbol symbol </P>

<P> </P>

<P>symbol </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_225.jpg"/>
</Figure>

<P>Symbols for a packet </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>

<P>Packet continues </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_226.jpg"/>
</Figure>

<P>Embedded control symbol </P>

<P> </P>

<P>Figure 3-9. Embedded Control Symbols for 16-bit Port </P>

<P> </P>

<P>As with the pacing idle control symbols, the embedded aligned control symbols are not included in the CRC value calculation for the packet. </P>

<P> </P>

<P>A special error case exists when a corrupt embedded control symbol is detected. In this case a packet-not-accepted control symbol shall be generated and the embedding packet is discarded. </P>

<P> </P>

<P> </P>

<P>3.6 Packet to Port Alignment </P>

<P> </P>

<P>This section shows examples of packet transmission over the 8-bit and 16-bit interfaces. The corresponding control symbol alignment is shown in Section 4.7, &#8220;Control Symbol to Port Alignment.&#8221; </P>

<P> </P>

<P>Figure 3-10 shows the byte transmission ordering on a port through time using a small transport format ftype 2 packet from the RapidIO Part 1: Input/Output Logical Specification and RapidIO Part 3: Common Transport Specification. Note that for this example the two bytes following the CRC would indicate some form of packet termination such as a new packet or an eop. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_227.jpg"/>
</Figure>

<P>Port bit numbers </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_228.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_229.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_230.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_231.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_232.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_233.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_234.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_235.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_236.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_237.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_238.jpg"/>
</Figure>

<P>Time </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_239.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_240.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_241.jpg"/>
</Figure>

<Textbox>
<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Preceding byte </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>0 0 1 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>destinationID </P>
</TD>
</TR>

<TR>
<TD>
<P>sourceID </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>rdsize </P>
</TD>
</TR>

<TR>
<TD>
<P>srcTID </P>
</TD>
</TR>

<TR>
<TD>
<P>address[0&#8211;7] </P>
</TD>
</TR>

<TR>
<TD>
<P>address[8&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>address[16&#8211;23] </P>
</TD>
</TR>

<TR>
<TD>
<P>address[24&#8211;28] </P>
</TD>

<TD>
<P>wdptr </P>
</TD>

<TD>
<P>xamsbs </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[0&#8211;7] </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[8&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>Following byte </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 3-10. Request Packet Transmission Example 1 </P>

<P> </P>

<P>Figure 3-11 shows the same packet transmitted over a 16-bit port. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_242.jpg"/>
</Figure>

<P>Port bit numbers </P>

<Textbox>
<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>9 </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P>11 </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>13 </P>
</TD>

<TD>
<P>14 </P>
</TD>

<TD>
<P>15 </P>
</TD>
</TR>

<TR>
<TD>
<P>Preceding symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 0 </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>0 0 1 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>destinationID </P>
</TD>

<TD>
<P>sourceID </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>rdsize </P>
</TD>

<TD>
<P>srcTID </P>
</TD>
</TR>

<TR>
<TD>
<P>address[0&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>address[16&#8211;28] </P>
</TD>

<TD>
<P>wdptr </P>
</TD>

<TD>
<P>xamsbs </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[0&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>Following symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>9 </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P>11 </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>13 </P>
</TD>

<TD>
<P>14 </P>
</TD>

<TD>
<P>15 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_243.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_244.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_245.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 3-11. Request Packet Transmission Example 2 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Figure 3-12 shows the same example again but with the large transport format over the 8-bit port. Note that for this example the two bytes following the CRC of the packet are all logic 0 pads. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_246.jpg"/>
</Figure>

<P>Port bit numbers </P>

<P> </P>

<P>32-bit boundary, </P>

<P>0 1 2 3 4 5 6 7 </P>

<P> </P>

<P>Preceding byte </P>

<P>Time </P>

<P>framing signal toggles </P>

<P>0 </P>

<P> </P>

<P>prio </P>

<P>ackID </P>

<P> </P>

<P>tt </P>

<P>0 1 0 0 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_247.jpg"/>
</Figure>

<P>0 0 1 0 </P>

<P> </P>

<P>destinationID[0&#8211;7] destinationID[8&#8211;15] sourceID[0&#8211;7] sourceID[8&#8211;15] </P>

<P>transaction  rdsize srcTID </P>

<P>address[0&#8211;7] </P>

<P> </P>

<P>address[8&#8211;15] </P>

<P> </P>

<P>address[16&#8211;23] </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>32-bit boundary, framing signal toggles </P>

<P> </P>

<P>address[24&#8211;28] CRC[0&#8211;7] CRC[8&#8211;15] </P>

<P>0 0 0 0 0 0 0 0 </P>

<P>0 0 0 0 0 0 0 0 </P>

<P> </P>

<P>Following byte </P>

<P> </P>

<P>wdptr </P>

<P> </P>

<P>xamsbs </P>

<P> </P>

<P>0 1 2 3 4 5 6 7 </P>

<P> </P>

<P>Figure 3-12. Request Packet Transmission Example 3 </P>

<P> </P>

<P>Figure 3-13 is the same packet as for Figure 3-12 but over the 16-bit port. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_248.jpg"/>
</Figure>

<P>Port bit numbers </P>

<Textbox>
<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>9 </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P>11 </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>13 </P>
</TD>

<TD>
<P>14 </P>
</TD>

<TD>
<P>15 </P>
</TD>
</TR>

<TR>
<TD>
<P>Preceding symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 0 </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>0 0 1 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>destinationID </P>
</TD>
</TR>

<TR>
<TD>
<P>sourceID </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>rdsize </P>
</TD>

<TD>
<P>srcTID </P>
</TD>
</TR>

<TR>
<TD>
<P>address[0&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>address[16&#8211;28] </P>
</TD>

<TD>
<P>wdptr </P>
</TD>

<TD>
<P>xamsbs </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[0&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Following symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>9 </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P>11 </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>13 </P>
</TD>

<TD>
<P>14 </P>
</TD>

<TD>
<P>15 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_249.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_250.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_251.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_252.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_253.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Figure 3-13. Request Packet Transmission Example 4 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Figure 3-14 and Figure 3-15 show the ftype 13 response packet for request example&#8212;the small transport format packet. Note that the two bytes following the packet CRC may be logic 0 pads depending on the size of the packet. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_254.jpg"/>
</Figure>

<P>Port bit numbers </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_255.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_256.jpg"/>
</Figure>

<P>Time </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_257.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_258.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_259.jpg"/>
</Figure>

<Textbox>
<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Preceding byte </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>1 1 0 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>destinationID </P>
</TD>
</TR>

<TR>
<TD>
<P>sourceID </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>status </P>
</TD>
</TR>

<TR>
<TD>
<P>targetTID </P>
</TD>
</TR>

<TR>
<TD>
<P>byte 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>byte 1 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>&#8226; </P>

<P>&#8226; </P>

<P>&#8226; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>byte n </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[0&#8211;7] </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[8&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>Following byte </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 3-14. Response Packet Transmission Example 1 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_260.jpg"/>
</Figure>

<P>Port bit numbers </P>

<Textbox>
<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>9 </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P>11 </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>13 </P>
</TD>

<TD>
<P>14 </P>
</TD>

<TD>
<P>15 </P>
</TD>
</TR>

<TR>
<TD>
<P>Preceding symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 0 </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>1 1 0 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>destinationID </P>
</TD>

<TD>
<P>sourceID </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>status </P>
</TD>

<TD>
<P>targetTID </P>
</TD>
</TR>

<TR>
<TD>
<P>byte 0 </P>
</TD>

<TD>
<P>byte 1 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>&#8226; </P>

<P>&#8226; </P>

<P>&#8226; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>byte n-1 </P>
</TD>

<TD>
<P>byte n </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[0&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>Following symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>9 </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P>11 </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>13 </P>
</TD>

<TD>
<P>14 </P>
</TD>

<TD>
<P>15 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_261.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_262.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_263.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_264.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Figure 3-15. Response Packet Transmission Example 2 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.7 System Maintenance </P>

<P> </P>

<P>A necessary part of any system are methods for initializing, configuring, and maintaining the system during operation. </P>

<P> </P>

<P> </P>

<P>3.7.1  Port and Link Initialization </P>

<P> </P>

<P>Before an LP-LVDS port can exchange packets with the port to which it is connected, the port may require initialization and the link connecting the two ports must be initialized. </P>

<P> </P>

<P>Many ports, especially those operating at higher data rates, must adjust the timing of when they sample input data from the link in order to achieve an acceptable or optimal received bit error rate. This process is called training and is executed while the port is receiving a special training pattern. In addition, each 16-bit wide port must decide whether to operate in 8-bit or 16-bit unless it has been statically configured for 8-bit or 16-mode. </P>

<P> </P>

<P>Link initialization requires that each port must receive at least one idle control symbol from the connected port before beginning normal operation. </P>

<P> </P>

<P>The state of a port is indicated by bits 30 (Port OK) and 31 (Port Uninitialized) of the associated Port n Error and Status Register. Bit 31 is set when the port is in the Uninitialized state and cleared when the port initialization process is completed and the port is initialized. Bit 30 is set when the port has received an idle control symbol from the connected port and the port is in the normal operation mode and is cleared if the port or the connected port is uninitialized or if there is no connected port (the port is not receiving valid input signals). </P>

<P> </P>

<P>3.7.1.1  Sampling Window Alignment </P>

<P> </P>

<P>Any port whose link receiver input sample timing is not fixed and any 16-bit port whose width mode is not statically configured require port initialization. </P>

<P> </P>

<P>3.7.1.1.1  Port Width Mode Selection </P>

<P> </P>

<P>All 16-bit LP-LVDS ports shall be capable of operating in both 8-bit and 16-bit modes.The width mode in which a 16-bit port operates may be either statically or dynamically configured. If the width mode of a port is statically configured, the port will operate correctly only if connected to a port operating in the same width mode. If the width mode of a 16-bit port is not statically configured, the width mode is determined as part of the port initialization process. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_265.jpg"/>
</Figure>

<P>When operating in 8-bit mode, only the signal pairs CLK0/CLK0, FRAME/FRAME and D[0-7]/D[0-7] shall be used. The 16-bit mode output signal pairs TCLK1/TCLK1, and TD[8-15]/TD[8-15] may be driven as outputs, but the input signal pairs RCLK1/RCLK1 and RD[8-15]/RD[8-16] shall be ignored as inputs. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_266.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_267.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_268.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_269.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_270.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_271.jpg"/>
</Figure>

<P> </P>

<P>Dynamic port width selection shall be based on the presence of valid signals at the </P>

<P> </P>

<P>58 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>inputs of the CLK0, CLK1, FRAME D[0-7] and D[8-15] receivers. If valid signals are present at the inputs of the CLK0, CLK1, FRAME D[0-7] and D[8-15] receivers, the port shall operate in 16-bit mode. If valid signals are present at the inputs of the CLK0, FRAME and D[0-7] receivers, but not at the inputs of the CLK1 and D[8-15] receivers, the port shall operate in 8-bit mode. If valid signals are not present at the inputs of the CLK0, FRAME and D[0-7] receivers, the width mode is undefined and the port shall not exit Uninitialized state. </P>

<P> </P>

<P>3.7.1.1.2  Input Sampling Window Alignment </P>

<P> </P>

<P>Input sampling window alignment is the process in which a port adjusts the timing of when input data is sample by the link receiver. The timing is adjusted to achieve an acceptable or optimal received bit error rate. The process is also called &#8220;training&#8221;. When the process is successfully completed, the port is said to be &#8220;aligned&#8221; or &#8220;trained&#8221;. The process or algorithm used by a port to align the input sampling window is not specified. </P>

<P> </P>

<P>Sampling window alignment is done while the port is receiving a special data pattern called the training pattern. A special data pattern is required to ensure that enough transition timing information is available to the receiver to correctly adjust the input sample timing and to ensure that bytes transmitted by a port operating in 8-bit or that half-words transmitted by a port operating in 16-bit are correctly recovered by the link receiver. </P>

<P> </P>

<P>There are two types of training, initialization training and maintenance training. Initialization training is used when a device powers up or is reset or when a port loses input sampling window alignment due to events such as excessive system noise or power fluctuations. Maintenance training is used when a port is nominally input sampling window aligned, but in need of some &#8220;fine-tuning&#8221; of the input sampling window timing to maintain an acceptable or optimum received bit error rate. </P>

<P> </P>

<P>3.7.1.1.3  Training Pattern </P>

<P> </P>

<P>The training pattern shall be the bit sequence 0b11110000. The training pattern shall be transmitted left to right with the left most bit transmitted first and the right most bit transmitted last. </P>

<P> </P>

<P>When transmitted, the training pattern shall be transmitted simultaneously on all of the data signals, D[0-7] for an 8-bit port or a 16-bit port statically configured to operate in 8-bit mode, D[0-15] for a 16-port not statically configured to operate in </P>

<P>8-bit mode, and the training pattern or is complement shall be transmitted on the FRAME signal. The training pattern or its complement is selected for transmission on the FRAME signal such that the FRAME signal shall toggle at the beginning of training pattern transmission. The training pattern shall never be transmitted on a CLK signal. The training pattern shall never be transmitted on signals D[8-15] of a </P>

<P>16-bit port if the port is statically configured to operate in 8-bit mode. </P>

<P> </P>

<P>The result of these rules is that during training pattern transmission, FRAME and </P>

<P> </P>

<P>RapidIO Trade Association 59 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>data signals transmitted by the port have the following properties. </P>

<P> </P>

<P>&#8226; The FRAME signal toggles at the beginning of training pattern transmission. (Individual data bits may or may not toggle at the beginning of training pattern transmission depending on their value during the bit time immediately preceding the training pattern.) </P>

<P>&#8226; After the first bit of the training pattern, FRAME and all data bits all toggle at the same nominal time. </P>

<P>&#8226; Each byte transmitted by a port transmitting in 8-bit mode is either all ones, </P>

<P>0xFF, or all zeros, 0x00. </P>

<P>&#8226; Each half-word transmitted by a port transmitting in 16-bit mode is either all ones, 0xFFFF, or all zeros, 0x0000. </P>

<P> </P>

<P>The reception of the training pattern by an initialized port is readily identified by looking at RD[0-7] when FRAME toggles. If the received value of RD[0-7] is either all ones, 0xFF, or all zeros, 0x00, the training pattern is being received. </P>

<P> </P>

<P>3.7.1.1.4  Training Pattern Transmission </P>

<P> </P>

<P>When transmitted, the training pattern shall be transmitted in bursts. Each burst shall contain 256 repetitions of the training pattern. Each burst shall be followed by either a link-request/send-training or an idle control symbol. </P>

<P> </P>

<P>The training pattern shall be transmitted by an initialized port only at request of the connected port. The link-request/send-training control symbol is used to request that the connected port transmit the training pattern. A port that is not initialized and therefore unable to reliably receive control symbols assumes that the connected port is sending link-request/send-training control symbols and therefore continuously transmits    training    sequence    bursts    with    each    burst    followed    by    a link-request/send-training control symbol as specified by the Port Initialization Process. </P>

<P> </P>

<P>The training pattern shall neither be embedded in a packet nor used to terminate a packet. </P>

<P> </P>

<P>3.7.1.1.5  Ports Not Requiring Port Initialization </P>

<P> </P>

<P>Similarly, a 16-bit port with fixed input sampling window timing and whose width mode  is  statically  configured  does  not  require  port  initialization.  On  device power-up and on device reset, such ports shall enter and remain in the Initialized state and shall never be in the Uninitialized state. Such ports shall transmit idle control symbols until an idle control symbol is received from the connected port. Upon the reception of an idle control symbol from the connected port, the port shall transmit an idle control symbol, set the &#8220;port OK&#8221; bit in its Port n Control and Status Register, enter the normal operation state and may then begin the transmission of packets and non-idle control symbols. </P>

<P> </P>

<P>If while waiting to receive an idle control symbol from the connected port, the </P>

<P> </P>

<P> </P>

<P>60 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>reception by the port of a link-request/send-training control symbol from the connected port immediately followed by the training pattern indicates that the connected port in not initialized. When this occurs, the port shall stop sending idle control symbols and repeatedly send training pattern bursts, each burst followed by an idle control symbol, until an idle control symbol is received from the connected port indicating that the connected port is now initialized. Upon receiving an idle control symbol from the connected port, the port shall complete transmission of the current training pattern burst, transmit an idle control symbol, set the &#8220;port OK&#8221; bit in its Port n Control and Status Register and enter the normal operation state. The port may then transmit packets and non-idle control symbols. </P>

<P> </P>

<P>3.7.1.1.6  Ports Requiring Port Initialization </P>

<P> </P>

<P>Ports that do not have fixed input sampling window timing and 16-bit ports whose width mode is not statically configured require port initialization. Such ports shall enter the Uninitialized state on device power-up and device reset. Such a port shall also enter the Uninitialized state if the port loses correct input sampling window timing due to events such as excessive system noise or power fluctuations. The algorithm used to determine when a port has lost input sample window alignment is not specified. A port in the Uninitialized state shall execute the Port Initialization Process to exit the Uninitialized state. </P>

<P> </P>

<P>The output signals of a LP-LVDS port may be erratic when the device containing the port is powering up or being reset. For example, the output drivers may be temporarily disabled, the signals may have erratic HIGH or LOW times and/or the clock signals may stop toggling. A LP-LVDS port must be tolerant of such behavior and shall properly initialize after the signals from the connected port return to normal and comply with the LP-LVDS electrical specifications. </P>

<P> </P>

<P>3.7.1.1.7  Port Initialization Process </P>

<P> </P>

<P>Upon entering the Uninitialized state, a port shall execute the following Port </P>

<P>Initialization Process. </P>

<P> </P>

<P>&#8226; The port sets the &#8220;Port Uninitialized&#8221; bit and clears the &#8220;Port OK&#8221; bit in its Port </P>

<P>n Control and Status Register. </P>

<P>&#8226; The port transmits a link-request/send-training control symbol followed by one or more bursts of the training sequence. The port continuously transmits training pattern bursts, each followed by a link-request/send-training or idle control symbol, until the port has achieved input sample timing alignment and has received an idle control symbol from the connected port. </P>

<P>&#8226; The port attempts to detect a valid clock signal on its CLK0 input and, if present, on its CLK1 input and to detect the training pattern on its FRAME and D[0-7] inputs and, if present, on its D[8-15] inputs. </P>

<P>&#8226; Once valid input signals are detected, a 16-bit ports whose width mode is not statically configured determines the width of the connected port and selects the matching width mode. </P>

<P> </P>

<P>RapidIO Trade Association 61 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Once the width mode of the port is established, either statically or dynamically, the port attempts to achieve input sampling window timing alignment. While attempting to achieve input sampling window timing alignment, the port shall transmit a link-request/send-training control symbol after each training pattern burst. </P>

<P>&#8226; When the port achieves input sampling window timing alignment, it clears the &#8220;Port Uninitialized&#8221; bit in the Port n Control and Status Register and transmits an idle control symbol after each training pattern burst instead of a link-request/send-training control symbol. This indicates to the connected port that the port has completed input sampling window alignment. </P>

<P>&#8226; Upon receiving an idle control symbol from the connected port, indicating that the connected port has completed input sampling window alignment, the port completes transmitting the current training pattern burst, sends an idle control symbol, sets the &#8220;Port OK&#8221; bit in the Port n Control and Status Register and enters normal operation. </P>

<P> </P>

<P>3.7.1.2  Link Initialization </P>

<P> </P>

<P>After a port is in the Initialized state, the port shall not begin transmission of packets and control symbols other than the idle control until it has received an idle control symbol from the connected port. The reception of an idle control symbol indicates that the connected port is in the Initialized state and is ready to receive packets and non-idle control symbols. When both ports connected by a link have received an idle control symbol from the connected port, the link is initialized. </P>

<P> </P>

<P>3.7.1.3  Maintenance Training </P>

<P> </P>

<P>Depending upon their implementation, some ports may require occasional adjustment of their input sampling window timing while in the Initialized state to maintain an optimal received bit error rate. Such adjustment is called maintenance training. A port requiring maintenance training shall do the following. </P>

<P>&#8226; The port shall transmit a single link-request/send-training control symbol and then resume normal transmit operation. </P>

<P>&#8226; If the port is not able to complete maintenance training with one burst of the training pattern, the port may transmit additional link-request/send-training control symbols and shall resume normal transmit operation after transmitting each link-request/send-training control symbol. </P>

<P> </P>

<P>A port requiring maintenance training shall not transmit the training pattern after transmitting a link-request/send-training control symbol. (The transmission by a port of a link-request/send-training control symbol followed by the training pattern indicates that the port has become uninitialized.) </P>

<P> </P>

<P>A port receiving a link-request/send-training control symbol that is not followed by the training pattern shall end the transmission of packets and control symbols as quickly as possible without violating the link protocol, transmit one burst of the </P>

<P> </P>

<P>62 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>training pattern followed by an idle control symbol and then resume normal operation. </P>

<P> </P>

<P>3.7.1.4  Unexpected Training Pattern Reception </P>

<P> </P>

<P>At any time, the reception by an initialized port of unsolicited training pattern, whether or not preceded by a link-request/sent-training control symbol, indicates that the connected port is in the Uninitialized state. When this occurs, the port receiving the unsolicited training pattern shall repeatedly transmit training pattern bursts, each burst followed by an idle control symbol, until an idle control symbol is received from the connected port indicating that the connected port is now initialized. Upon receiving an idle control symbol from the connected port, the port shall complete transmission of the current training pattern burst, transmit an idle control symbol, set the &#8220;port OK&#8221; bit in its Port n Control and Status Register and enter the normal operation state. The port may then transmit packets and non-idle control symbols. </P>

<P> </P>

<P>Once a link has been initialized, the reception of unsolicited training pattern is a protocol violation. It indicates that the sending port has lost input sampling window alignment and has most likely not received some previously sent packets and control symbols. Once the link has been initialized, a port receiving an unsolicited training pattern shall enter the output Error-stopped state. The port shall execute the Output Error-stopped recovery process specified in Section 2.4.5.1.2, &#8220;Control Symbol Errors&#8221; once communication with the connected port has been re-established. </P>

<P> </P>

<P> </P>

<P>3.7.2  Multicast-Event </P>

<P> </P>

<P>The Multicast-Event control symbol provides a mechanism through which notice that some system defined event has occurred, can be selectively multicast throughout the system. Refer to Section 4.3 for the format of the multicast-event control symbol. </P>

<P> </P>

<P>When a switch processing element receives a Multicast-Event control symbol, the switch shall forward the Multicast-Event by issuing a Multicast-Event control symbol from each port that is designated in the port's CSR as a Multicast-Event output port. A switch port shall never forward a Multicast-Event control symbol back to the device from which it received a Multicast-Event control symbol regardless of whether the port is designated a Multicast-Event output or not. </P>

<P> </P>

<P>It is intended that at any given time, Multicast-Event control symbols will be sourced by a single device. However, the source device can change (in case of failover, for example). In the event that two or more Multicast-Event control symbols are received by a switch processing element close enough in time that more than one is present in the switch at the same time, at least one of the Multicast-Event control symbols shall be forwarded. The others may be forwarded or discarded (device dependent). </P>

<P>The system defined event whose occurrence Multicast-Event gives notice of has no </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>required temporal characteristics. It may occur randomly, periodically, or anything in between. For instance, Multicast-Event may be used for a heartbeat function or for a clock synchronization function in a multiprocessor system. </P>

<P> </P>

<P>In an application such as clock synchronization in a multiprocessor system, both the propagation time of the notification through the system and the variation in propagation time from Multicast-Event to Multicast-Event are of concern. For these reasons  and  the  need  to  multicast,  control  symbols  are  used  to  convey Multicast-Events as control symbols have the highest priority for transmission on a link and can be embedded in packets. </P>

<P> </P>

<P>While this specification places no limits on Multicast-Event forwarding delay or forwarding delay variation, switch functions should be designed to minimize these characteristics. In addition, switch functions shall include in their specifications the maximum value of Multicast-Event forwarding delay (the maximum value of Multicast-Event forwarding delay through the switch) and the maximum value of Multicast-Event forwarding delay variation (the maximum value of Multicast-Event forwarding delay through the switch minus the minimum value of Multicast-Event forwarding delay through the switch). </P>

<P> </P>

<P> </P>

<P>3.8 Power Management </P>

<P> </P>

<P>Power management is currently beyond the scope of this specification and is implementation dependent. A device that supports power management features can make these features accessible to the rest of the system in the device&#8217;s local configuration registers. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Control Symbol Formats </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_272.jpg"/>
</Figure>

<P>This chapter defines the RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification control symbols described in Chapter 2, &#8220;Physical Layer Protocol.&#8221; Note that the S bit defined in Section 2.3.1 is always set to logic 1 and the S bit (also defined in Section 2.3.1) is always set to logic 0 for the physical layer control symbols. All control symbols are aligned to 32 bits with the last 16 bits as a bit-wise inverse of the first 16. For forward compatibility, control symbols received by a port with a reserved field encoding shall be ignored and not cause an error to be reported. </P>

<P> </P>

<P> </P>

<P>4.2 Acknowledgment Control Symbol Formats </P>

<P> </P>

<P>An acknowledgment control symbol is a transmission status indicator issued by a processing element when it has received a packet from another processing element to which it is electrically connected. Acknowledgment control symbols are used for flow control and resource de-allocation between adjacent devices. The following are the different acknowledgment control symbols that can be transmitted back to sending elements from receiving elements: </P>

<P> </P>

<P>&#8226; Packet-accepted </P>

<P>&#8226; Packet-retry </P>

<P>&#8226; Packet-not-accepted </P>

<P> </P>

<P>Because receipt of an acknowledgment control symbol does not imply the end of a packet, a control symbol can be embedded in a packet, as well as sent when the interconnect is  idle.  Embedded control  symbols  are  discussed  in  Section 3.5, &#8220;Embedded Control Symbols.&#8221; </P>

<P> </P>

<P>Field definitions for the acknowledgment control symbols are shown in Table 4-1. </P>

<P> </P>

<P>Table 4-1. Field Definitions for Acknowledgment Control Symbols </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>Acknowledgment ID is the packet identifier for acknowledgments back to the request or response packet sender. </P>
</TD>
</TR>

<TR>
<TD>
<P>buf_status </P>
</TD>

<TD>
<P>buf_status field indicates the number of maximally sized packets that can be received, described in Section 2.3.1 </P>
</TD>
</TR>

<TR>
<TD>
<P>cause </P>
</TD>

<TD>
<P>cause field indicates the type of error encountered by an input port, defined in Table 4-2 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.2.1  Packet-Accepted Control Symbol </P>

<P> </P>

<P>The packet-accepted acknowledgment control symbol indicates that the adjacent device in the interconnect fabric has taken responsibility for sending the packet to its final destination and that resources allocated by the sending device can be released. This control symbol shall be generated only after the entire packet has been received and found to be free of detectable errors. This control symbol format is displayed in Figure 4-1. </P>

<P> </P>

<P> </P>

<P>Preceding bits   1 </P>

<P>packet_ackID    0 </P>

<P>0 0 0 0 </P>

<P>buf_status </P>

<P>0 0 0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_273.jpg"/>
</Figure>

<P>1 3 </P>

<P>32-bit boundary, framing signal toggles </P>

<P>1 1 3 4 3 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 1 1 </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>1 1 1 </P>
</TD>

<TD>
<P>Following bits </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_274.jpg"/>
</Figure>

<P>1 3 1 1 3 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_275.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_276.jpg"/>
</Figure>

<P>4 3 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_277.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>

<P>Figure 4-1. Type 0 Packet-Accepted Control Symbol Format </P>

<P> </P>

<P> </P>

<P>4.2.2  Packet-Retry Control Symbol </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_278.jpg"/>
</Figure>

<P>A packet-retry acknowledgment control symbol indicates that the adjacent device in the interconnect fabric was not able to accept the packet due to some temporary resource conflict such as insufficient buffering and the source should retransmit the packet. This control symbol can be generated at any time after the start of a packet, which allows the sender to cancel the packet and try sending a packet with a different priority or destination. This will avoid wasting bandwidth by transmitting all of the rejected packet. This control symbol format is displayed in Figure 4-2. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_279.jpg"/>
</Figure>

<P>Preceding bits </P>

<Textbox>
<Table>
<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 0 0 </P>
</TD>

<TD>
<P>0 0 0 0 </P>
</TD>

<TD>
<P>0 0 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P>32-bit boundary, framing signal toggles </P>

<P> </P>

<P> </P>

<P>0   packet_ackID </P>

<P>1 1 1 1 1 </P>

<P>1 1 1 1 </P>

<P>1 1 0 </P>

<P>Following bits </P>

<P>1 3 1 1 3 </P>

<P>4 3 </P>

<P>       32-bit boundary, </P>

<P>framing signal toggles </P>

<P> </P>

<P>Figure 4-2. Type 1 Packet-Retry Control Symbol Format </P>

<P> </P>

<P> </P>

<P>4.2.3  Packet-Not-Accepted Control Symbol </P>

<P> </P>

<P>A packet-not-accepted acknowledgment control symbol means that the receiving device could not accept the packet due to an error condition, and that the source should retransmit the packet. This control symbol can be generated at any time after the start of a packet, which allows the sender to cancel the packet and try sending a </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>packet with a different priority or destination. Generating this control symbol at any point in packet transmission avoids wasting bandwidth by transmitting all of the rejected packet. The packet-not-accepted control symbol contains a field describing the cause of the error condition, shown in Table 4-2. If the receiving device is not able to specify the cause for some reason, or the cause is not one of defined options, the general error encoding shall be used. This control symbol format is displayed in Figure 4-3. </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 0 0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>0 1 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Preceding bits </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_280.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 1 1 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>1 0 1 </P>
</TD>

<TD>
<P>Following bits </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_281.jpg"/>
</Figure>

<P>1 3 1 1 3 1 3 </P>

<P>3        32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_282.jpg"/>
</Figure>

<P>Figure 4-3. Type 2 Packet-Not-Accepted Control Symbol Format </P>

<P> </P>

<P>The cause field shall be used to display informational fields useful for debug. Table 4-2 displays the reasons a packet may not be accepted, indicated by the cause field. </P>

<P> </P>

<P>Table 4-2. cause Field Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Encountered internal error </P>
</TD>
</TR>

<TR>
<TD>
<P>0b001 </P>
</TD>

<TD>
<P>Received unexpected ackID on packet </P>
</TD>
</TR>

<TR>
<TD>
<P>0b010 </P>
</TD>

<TD>
<P>Received error on control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0b011 </P>
</TD>

<TD>
<P>Non-maintenance packet reception is stopped </P>
</TD>
</TR>

<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>Received bad CRC on packet </P>
</TD>
</TR>

<TR>
<TD>
<P>0b101 </P>
</TD>

<TD>
<P>Received S bit parity error on packet/control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0b110 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b111 </P>
</TD>

<TD>
<P>General error </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.2.4  Canceling Packets </P>

<P> </P>

<P>A packet-retry or packet-not-accepted acknowledgment control symbol that is received for a packet that is still being transmitted may result with the sender canceling the packet. </P>

<P> </P>

<P>The sending device can use the stomp (see Chapter 3, &#8220;Packet and Control Symbol Transmission&#8221;), restart-from-retry (in response to a packet-retry control symbol), or link-request (in response to a packet-not-accepted control symbol) control symbol to cancel the packet. Because the receiver has already rejected the packet, it will not detect any induced error. Alternatively, the sending device can choose to complete transmission of the packet normally. </P>

<P> </P>

<P>RapidIO Trade Association 67 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3 Packet Control Symbol Formats </P>

<P> </P>

<P>Packet control symbols are used for packet delineation, transmission, pacing, and other link interface control functions as described in Chapter 3, &#8220;Packet and Control Symbol Transmission.&#8221; </P>

<P> </P>

<P>The packet control symbols are the throttle, stomp, restart-from-retry control symbols, idle, end-of-packet (eop), and multicast-event control symbols, which are specified in the sub_type field of the type 4 control symbol format. The packet control symbols also have a contents field, which has a different meaning depending upon the particular control symbol. Of these control symbols, all control symbols that are not defined as terminating a packet may be embedded within a packet. </P>

<P> </P>

<P>This control symbol format is displayed in Figure 4-4. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_283.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Preceding bits </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>sub_type </P>
</TD>

<TD>
<P>0 0 </P>
</TD>

<TD>
<P>0 0 0 </P>
</TD>

<TD>
<P>contents </P>
</TD>

<TD>
<P>1 0 0 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_284.jpg"/>
</Figure>

<P>0 sub_type 1 1 </P>

<P>1 1 1 </P>

<P>contents </P>

<P>0 1 1 </P>

<P>Following bits </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_285.jpg"/>
</Figure>

<P>1 3 1 1 3 </P>

<P> </P>

<P>4 3 </P>

<P>32-bit boundary, </P>

<P>framing signal toggles </P>

<P>Figure 4-4. Type 4 Packet Control Symbol Format </P>

<P> </P>

<P>Table 4-3 shows how sub_type values function with values of the contents field. For the idle, eop, and multicast-event control symbols the contents field is used as the buf_status field  described in  Section 2.3.1,  whose  encodings are  specified in Table 2-2. For a throttle control symbol, the contents field specifies the number of aligned pacing idle control symbols that the sender should insert in the packet. One of the specified encodings indicates to the sender that it can immediately begin to resume packet transmission, as  can  be  seen  in  Table 4-4.  For  the  stomp and restart-from-retry control symbols, the contents field is unused and shall be tied to all logic 0&#8217;s and ignored by the receiving device. </P>

<P> </P>

<P>Table 4-3. sub_type and contents Field Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>sub_type Field </P>

<P>Definition </P>
</TD>

<TD>
<P>sub_type </P>

<P>Encoding </P>
</TD>

<TD>
<P> </P>

<P>contents Field Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>idle </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Used as a buf_status field that indicates the number of maximum-sized packets that can be received. Described in Section 2.3.1, encodings are defined in </P>

<P>Table 2-2. </P>
</TD>
</TR>

<TR>
<TD>
<P>stomp </P>
</TD>

<TD>
<P>0b001 </P>
</TD>

<TD>
<P>Unused, contents=0b0000 </P>
</TD>
</TR>

<TR>
<TD>
<P>eop </P>
</TD>

<TD>
<P>0b010 </P>
</TD>

<TD>
<P>Used as a buf_status field that indicates the number of maximum-sized packets that can be received. Described in Section 2.3.1, encodings are defined in </P>

<P>Table 2-2. </P>
</TD>
</TR>

<TR>
<TD>
<P>restart-from-retry </P>
</TD>

<TD>
<P>0b011 </P>
</TD>

<TD>
<P>Unused, contents=0b0000 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-3. sub_type and contents Field Definitions (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>sub_type Field </P>

<P>Definition </P>
</TD>

<TD>
<P>sub_type </P>

<P>Encoding </P>
</TD>

<TD>
<P> </P>

<P>contents Field Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>throttle </P>
</TD>

<TD>
<P>0b100 </P>
</TD>

<TD>
<P>Specifies the number of aligned pacing idles that the sender inserts in a packet. The encodings are defined in Table 4-4. </P>
</TD>
</TR>

<TR>
<TD>
<P>Multicast-event </P>
</TD>

<TD>
<P>0b101 </P>
</TD>

<TD>
<P>Used as a buf_status field that indicates the number of maximally sized packets that can be received. Described in Section 2.3.1, encodings are defined in </P>

<P>Table 2-2. </P>
</TD>
</TR>

<TR>
<TD>
<P>Reserved </P>
</TD>

<TD>
<P>0b110-111 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The pacing idle count content field for a throttle control symbol is defined in </P>

<P>Table 4-4. </P>

<P> </P>

<P>Table 4-4. Throttle Control Symbol contents Field Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 aligned pacing idle control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>2 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>4 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>8 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>16 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>32 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>64 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>128 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>256 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>512 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>1024 aligned pacing idle control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1011- </P>

<P>1101 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>1 aligned pacing idle control symbol for oscillator drift compensation </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>Stop transmitting pacing idles, can immediately resume packet transmission </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.4 Link Maintenance Control Symbol Formats </P>

<P> </P>

<P>Maintenance of a link is controlled by link-request/link-response control symbol pairs as described in the link maintenance protocol of Section 2.6. Each of the control symbols is described below: </P>

<P> </P>

<P>&#8226; A link-request control symbol issues a command to or requests status from the device that is electrically connected, or linked, to the issuing device. The link-request control symbol is followed by a complemented version of itself as with the other control symbols. A link-request control symbol always cancels a packet whose transmission is in progress and can also be sent </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>between packets. Under error conditions a link-request/input-status control symbol acts as a restart-from-error control symbol as described in </P>

<P>Section 2.4.5.1, &#8220;Recoverable Errors.&#8221; This control symbol format is displayed in Figure 4-5. </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 0 0 </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>1 0 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Preceding bits </P>

<P> </P>

<P>32-bit boundary, framing signal toggles </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 1 1 </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>0 1 0 </P>
</TD>

<TD>
<P>Following bits </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_286.jpg"/>
</Figure>

<P>1 3 1    1 3 </P>

<P>4 3 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_287.jpg"/>
</Figure>

<P>32-bit boundary, </P>

<P>framing signal toggles </P>

<P>Figure 4-5. Type 5 Link-Request Control Symbol Format </P>

<P> </P>

<P>The cmd, or command, field of the link-request control symbol format is defined in </P>

<P>Table 4-5. </P>

<P> </P>

<P>Table 4-5. cmd Field Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>cmd </P>

<P>Encoding </P>
</TD>

<TD>
<P> </P>

<P>Command Name </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Send-training </P>
</TD>

<TD>
<P>Send 256 iterations of the training pattern </P>
</TD>
</TR>

<TR>
<TD>
<P>0b001-010 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b011 </P>
</TD>

<TD>
<P>Reset </P>
</TD>

<TD>
<P>Reset the receiving device </P>
</TD>
</TR>

<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>Input-status </P>
</TD>

<TD>
<P>Return input port status; functions as a restart-from-error control symbol under error conditions </P>
</TD>
</TR>

<TR>
<TD>
<P>0b101-111 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P> </P>

<P>&#8226; The link-response control symbol is used by a device to respond to a </P>

<P>link-request control symbol as described in the link maintenance protocol described in Section 2.6. The link-response control symbol is the same as all other control symbols in that the second 16 bits are a bit-wise inversion of the first 16 bits. A link-response control symbol can be embedded in a packet. This control symbol format is displayed in Figure 4-6. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_288.jpg"/>
</Figure>

<P>Preceding bits </P>

<Textbox>
<Table>
<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 0 0 </P>
</TD>

<TD>
<P>link_status </P>
</TD>

<TD>
<P>1 1 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_289.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_290.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>0   ackID_status 1 1 </P>

<P>1 1 1 </P>

<P>link_status </P>

<P>0 0 1 </P>

<P>Following bits </P>

<P>1 3 1 1 3 </P>

<P>4 3 </P>

<P>32-bit boundary, </P>

<P>framing signal toggles </P>

<P> </P>

<P>Figure 4-6. Type 6 Link-Response Control Symbol Format </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The ackID_status field of the link-response format is defined in Table 4-6. </P>

<P> </P>

<P>Table 4-6. ackID_status Field Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Expecting ackID 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b001 </P>
</TD>

<TD>
<P>Expecting ackID 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b010 </P>
</TD>

<TD>
<P>Expecting ackID 2 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b011 </P>
</TD>

<TD>
<P>Expecting ackID 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>Expecting ackID 4 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b101 </P>
</TD>

<TD>
<P>Expecting ackID 5 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b110 </P>
</TD>

<TD>
<P>Expecting ackID 6 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b111 </P>
</TD>

<TD>
<P>Expecting ackID 7 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The link_status field is defined in Table 4-7. Note that the ackID information is included in both fields for additional error coverage if the receiver is working properly (encodings </P>

<P>8-15). </P>

<P> </P>

<P>Table 4-7. link_status Field Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>link_status </P>

<P>Encoding </P>
</TD>

<TD>
<P> </P>

<P>Port Status </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0000 -&#61472;&#61472;</P>

<P>0b0001 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>Error </P>
</TD>

<TD>
<P>Unrecoverable error encountered. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>Retry-stopped </P>
</TD>

<TD>
<P>The port has been stopped due to a retry. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>Error-stopped </P>
</TD>

<TD>
<P>The port has been stopped due to a transmission error; this state is cleared after the link-request/input-status command is completed. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0110 -&#61472;&#61472;</P>

<P>0b0111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>OK, ackID0 </P>
</TD>

<TD>
<P>Working properly, expecting ackID 0. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>OK, ackID1 </P>
</TD>

<TD>
<P>Working properly, expecting ackID 1. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>OK, ackID2 </P>
</TD>

<TD>
<P>Working properly, expecting ackID 2. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>OK, ackID3 </P>
</TD>

<TD>
<P>Working properly, expecting ackID 3. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>OK, ackID4 </P>
</TD>

<TD>
<P>Working properly, expecting ackID 4. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1101 </P>
</TD>

<TD>
<P>OK, ackID5 </P>
</TD>

<TD>
<P>Working properly, expecting ackID 5. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1110 </P>
</TD>

<TD>
<P>OK, ackID6 </P>
</TD>

<TD>
<P>Working properly, expecting ackID 6. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1111 </P>
</TD>

<TD>
<P>OK, ackID7 </P>
</TD>

<TD>
<P>Working properly, expecting ackID 7. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.5 Reserved Symbol Formats </P>

<P> </P>

<P>The control symbol corresponding to stype 0b011 is reserved. </P>

<P> </P>

<P> </P>

<P>4.6 Implementation-defined Symbol Formats </P>

<P> </P>

<P>The control symbol corresponding to stype 0b111 is implementation defined. In general, implementation-defined control symbols will result in inter-operability problems with devices that are not designed to handle them. Inter-operability problems can include undefined and/or inconsistant behavior, data corruption, or system failure. </P>

<P> </P>

<P> </P>

<P>4.7 Control Symbol to Port Alignment </P>

<P> </P>

<P>This section shows examples of control symbol transmission over the 8-bit and </P>

<P>16-bit interfaces. The corresponding packet transmission alignment is shown in </P>

<P>Section 3.6, &#8220;Packet to Port Alignment.&#8221; </P>

<P> </P>

<P>Figure 4-7 shows the byte transmission ordering on an 8-bit port through time using an aligned packet-accepted control symbol as an example. </P>

<P> </P>

<P> </P>

<P>Port bit numbers </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_291.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>

<P>0 1 2 3 4 5 6 7 </P>

<P> </P>

<P>Preceding byte </P>

<P>Time </P>

<P>1 packet_ackID 0 0 0 0 </P>

<P> </P>

<P>0 buf_status 0 0 0 </P>

<P> </P>

<P>0 packet_ackID </P>

<P>1 1 1 1 </P>

<P> </P>

<P>32-bit boundary, 1 framing signal toggles </P>

<P>buf_status </P>

<P> </P>

<P>Following byte </P>

<P>1 1 1 </P>

<P> </P>

<P>0 1 2 3 4 5 6 7 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_292.jpg"/>
</Figure>

<P>Figure 4-7. Control Symbol Transmission Example 1 </P>

<P> </P>

<P>Figure 4-8 shows the same control symbol over the 16-bit interface. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_293.jpg"/>
</Figure>

<P>Port bit numbers </P>

<P>0 1 2 3 4 5 6 7 </P>

<P>8 9 10 11 12 13 14 15 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_294.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_295.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>

<P> </P>

<P> </P>

<P>1 packet_ackID </P>

<P> </P>

<P>0 packet_ackID </P>

<P>Preceding symbol </P>

<P> </P>

<P>0 0 0 0 0 </P>

<P> </P>

<P>1 1 1 1 1 </P>

<P> </P>

<P>Following symbol </P>

<P> </P>

<P> </P>

<P>buf_status buf_status </P>

<P> </P>

<P> </P>

<P>0 0 0 </P>

<P> </P>

<P>1 1 1 </P>

<P> </P>

<P>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 </P>

<P> </P>

<P>Figure 4-8. Control Symbol Transmission Example 2 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 8/16 LP-LVDS Registers </P>

<P> </P>

<P> </P>

<P>5.1 Introduction </P>

<P> </P>

<P>This chapter describes the RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification visible register set that allows an external processing element to determine the capabilities, configuration, and status of a processing element using this physical layer specification. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and bit definitions. All registers are 32-bits and aligned to a 32-bit boundary. </P>

<P> </P>

<P>There are four types of 8/16 LP-LVDS devices, an end point device, an end point device with additional software recovery registers, an end point free (or switch) device, and an end point free device with additional software recovery registers. Each has a different set of CSRs, specified in Section 5.5, Section 5.6, Section 5.7, and Section 5.8, respectively. All four device types have the same CARs, specified in Section 5.4. </P>

<P> </P>

<P> </P>

<P>5.2 Register Map </P>

<P> </P>

<P>These registers utilize the Extended Features blocks and can be accessed using RapidIO Part 1: Input/Output Logical Specification maintenance operations. Any register offsets not defined are considered reserved for this specification unless otherwise stated. Other registers required for a processing element are defined in other applicable RapidIO specifications and by the requirements of the specific device and are beyond the scope of this specification. Read and write accesses to reserved register offsets shall terminate normally and not cause an error condition in the target device. </P>

<P> </P>

<P>The Extended Features pointer (EF_PTR) defined in the RapidIO logical specifications contains the offset of the first Extended Features block in the Extended Features data structure for a device. The 8/16 LP-LVDS physical features block shall exist in any position in the Extended Features data structure and shall exist in any portion of the Extended Features Space in the register address map for the device. </P>

<P> </P>

<P>Register bits defined as reserved are considered reserved for this specification only. Bits that are reserved in this specification may be defined in another RapidIO specification. </P>

<P> </P>

<P>RapidIO Trade Association 75 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-1. 8/16 LP-LVDS Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0-C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10 </P>
</TD>

<TD>
<P>Processing Element Features CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x14&#8211;FC </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P> </P>

<P>Extended Features Space </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P> </P>

<P>Implementation-defined Space </P>
</TD>
</TR>
</Table>

<P> </P>

<P>5.3 Reserved Register, Bit and Bit Field Value Behavior </P>

<P> </P>

<P>Table 5-2 describes the required behavior for accesses to reserved register bits and reserved registers for the RapidIO register space, </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0&#8211;3C </P>
</TD>

<TD>
<P>Capability Register Space (CAR Space - this space is read-only) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value1 </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined </P>

<P>function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x40&#8211;FC </P>
</TD>

<TD>
<P>Command and Status Register Space (CSR Space) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value2 </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined </P>

<P>function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P>Extended Features Space </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P>Implementation-defined </P>

<P>Space </P>
</TD>

<TD>
<P>Reserved bit and register </P>
</TD>

<TD>
<P>All behavior implementation-defined </P>
</TD>
</TR>
</Table>

<P>1Do not depend on reserved bits being a particular value; use appropriate masks to extract defined bits from the read value. </P>

<P>2All register writes shall be in the form: read the register to obtain the values of all reserved bits, merge in the desired values for defined bits to be modified, and write the register, thus preserving the value of all reserved bits. </P>

<P> </P>

<P>When  a  writable  bit  field  is  set  to  a  reserved  value,  device  behavior  is implementation specific. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.4 Capability Registers (CARs) </P>

<P> </P>

<P>Every processing element shall contain a set of registers that allows an external processing element to determine its capabilities using the I/O logical maintenance read operation. All registers are 32 bits wide and are organized and accessed in </P>

<P>32-bit (4 byte) quantities, although some processing elements may optionally allow larger accesses. CARs are read-only. Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>CARs are big-endian with bit 0 the most significant bit. </P>

<P> </P>

<P> </P>

<P>5.4.1  Processing Element Features CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x10) </P>

<P> </P>

<P>The processing element features CAR identifies the major functionality provided by the processing element. The bit settings are shown in Table 5-3. </P>

<P> </P>

<P>Table 5-3. Bit Settings for Processing Element Features CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bits </P>
</TD>

<TD>
<P>Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;24 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>25 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>
</TR>

<TR>
<TD>
<P>26 </P>
</TD>

<TD>
<P>CRF Support </P>
</TD>

<TD>
<P>PE supports the Critical Request Flow (CRF) indicator </P>

<P>0b0 - Critical Request Flow is not supported&#61472;&#61472;</P>

<P>0b1 - Critical Request Flow is supported </P>
</TD>
</TR>

<TR>
<TD>
<P>27&#8211;31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.5 Generic End Point Devices </P>

<P> </P>

<P>This section describes the 8/16 LP-LVDS registers for a general end point device. This Extended Features register block is assigned Extended Features block ID=0x0001. </P>

<P> </P>

<P> </P>

<P>5.5.1  Register Map </P>

<P> </P>

<P>Table 5-4 shows the register map for generic RapidIO 8/16 LP-LVDS end point devices. The Block Offset is the offset based on the Extended Features pointer (EF_PTR) to this block. This register map is currently only defined for devices with up to 16 RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + 0xBC]. Register map offset [EF_PTR + 0xC0] can be used for another Extended Features block. </P>

<P> </P>

<P>Table 5-4. 8/16 LP-LVDS Register Map - Generic End Point Devices </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>8/16 LP-LVDS Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port Link Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24 </P>
</TD>

<TD>
<P>Port Response Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x28-38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Port General Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40-54 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Port 0 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x60-74 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Port 1 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x7C </P>
</TD>

<TD>
<P>Port 1 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x80&#8211;218 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x220-234 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x238 </P>
</TD>

<TD>
<P>Port 15 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x23C </P>
</TD>

<TD>
<P>Port 15 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.5.2  Command and Status Registers (CSRs) </P>

<P> </P>

<P>Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>5.5.2.1  8/16 LP-LVDS Register Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The 8/16 LP-LVDS register block header register contains the EF_PTR to the next EF_BLK and the EF_ID that identifies this as the generic end point 8/16 LP-LVDS register block header. </P>

<P> </P>

<P>Table 5-5. Bit Settings for 8/16 LP-LVDS Register Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P>0x0001 </P>
</TD>

<TD>
<P>Hard wired Extended Features ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.2.2  Port Link Timeout Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x20) </P>

<P> </P>

<P>The port link timeout control register contains the timeout timer value for all ports on a device. This timeout is for link events such as sending a packet to receiving the corresponding acknowledge, and sending a link-request to receiving the corresponding link-response. The reset value is the maximum timeout interval, and represents between 3 and 5 seconds. </P>

<P>Table 5-6. Bit Settings for Port Link Timeout Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;23 </P>
</TD>

<TD>
<P>timeout_value </P>
</TD>

<TD>
<P>All 1s </P>
</TD>

<TD>
<P>timeout interval value </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.5.2.3  Port Response Timeout Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x24) </P>

<P> </P>

<P>The port response timeout control register contains the timeout timer count for all ports on a device. This timeout is for sending a request packet to receiving the corresponding response packet.The reset value is the maximum timeout interval, and represents between 3 and 5 seconds. </P>

<P>Table 5-7. Bit Settings for Port Response Timeout Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;23 </P>
</TD>

<TD>
<P>timeout_value </P>
</TD>

<TD>
<P>All 1s </P>
</TD>

<TD>
<P>timeout interval value </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.2.4  Port General Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x3C) </P>

<P> </P>

<P>The bits accessible through the Port General Control CSR are bits that apply to all ports on a device. There is a single copy of each such bit per device. These bits are also accessible through the Port General Control CSR of any other physical layers implemented on a device. </P>

<P>Table 5-8. Bit Settings for Port General Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Host </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>A Host device is a device that is responsible for system exploration, initialization, and maintenance. Agent or slave devices are typically initialized by Host devices. </P>

<P>0b0 - agent or slave device&#61472;&#61472;</P>

<P>0b1 - host device </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Master Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>The Master Enable bit controls whether or not a device is allowed to issue requests into the system. If the Master Enable is not set, the device may only respond to requests. </P>

<P>0b0 - processing element cannot issue requests&#61472;&#61472;</P>

<P>0b1 - processing element can issue requests </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Discovered </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>This device has been located by the processing element responsible for system configuration&#61472;&#61472;</P>

<P>0b0 - The device has not been previously discovered&#61472;&#61472;</P>

<P>0b1 - The device has been discovered by another processing element </P>
</TD>
</TR>

<TR>
<TD>
<P>3-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>1The Host reset value is implementation dependent </P>

<P>2The Master Enable reset value is implementation dependent </P>

<P>3The Discovered reset value is implementation dependent </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.5.2.5  Port n Error and Status CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x58, 78, ..., 238) </P>

<P> </P>

<P>These registers are accessed when a local processor or an external device wishes to examine the port error and status information. </P>

<P> </P>

<P>Table 5-9. Bit Settings for Port n Error and Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-10 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Output </P>

<P>Retry-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered a retry condition. This bit is set when bit 13 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Output Retried </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and can not make forward progress. This bit is set when bit 13 is set and is cleared when a packet-accepted or a packet-not-accepted control symbol is received (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Output Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and is in the </P>

<P>&#8220;output retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Output </P>

<P>Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 15 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Output Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port is in the &#8220;output error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>16-20 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>21 </P>
</TD>

<TD>
<P>Input Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>22 </P>
</TD>

<TD>
<P>Input Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 23 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>23 </P>
</TD>

<TD>
<P>Input Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>24-26 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Port-write Pending </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Port has encountered a condition which required it to initiate a Maintenance Port-write operation.This bit is only valid if the device is capable of issuing a maintenance port-write transaction. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Port Present </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>The port is receiving the free-running clock on the input port. </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Port Error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input or output port has encountered an error from which hardware was unable to recover. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Port OK </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input and output ports are initialized and can communicate with the adjacent device. This bit and bit 31 are mutually exclusive (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Uninitialized </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Input and output ports are not initialized and is in training mode. This bit and bit 30 are mutually exclusive (read-only). </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.2.6  Port n Control CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x5C, 7C, ..., 23C) </P>

<P> </P>

<P>The port n control registers contain control register bits for individual ports on a processing element. </P>

<P>Table 5-10. Bit Settings for Port n Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Output Port Width </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Operating width of the port (read-only): </P>

<P>0b0 - 8-bit port&#61472;&#61472;</P>

<P>0b1 - 16-bit port </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Output Port Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Output port transmit enable: </P>

<P>0b0 - port is stopped and not enabled to issue any packets except to route or respond to I/O logical MAINTENANCE packets. Control symbols are not affected and are sent normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to issue any packets </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Output Port Driver </P>

<P>Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port driver disable: </P>

<P>0b0 - output port drivers are turned on and will drive the pins normally&#61472;&#61472;</P>

<P>0b1 - output port drivers are turned off and will not drive the pins&#61472;&#61472;</P>

<P>This is useful for power management. </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Input Port Width </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>Operating width of the port (read-only): </P>

<P>0b0 - 8-bit port&#61472;&#61472;</P>

<P>0b1 - 16-bit port </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Input Port Enable </P>
</TD>

<TD>
<P>see footnote4 </P>
</TD>

<TD>
<P>Input port receive enable: </P>

<P>0b0 - port is stopped and only enabled to route or respond I/O logical MAINTENANCE packets. Other packets generate packet-not-accepted control symbols to force an error condition to be signaled by the sending device. Control symbols are not affected and are received and handled normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to respond to any packet </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Input Port Receiver </P>

<P>Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port receiver enable: </P>

<P>0b0 - input port receivers are enabled&#61472;&#61472;</P>

<P>0b1 - input port receivers are disabled and are unable to receive to any packets or control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Error Checking Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit disables all RapidIO transmission error checking </P>

<P>0b0 - Error checking and recovery is enabled&#61472;&#61472;</P>

<P>0b1 - Error checking and recovery is disabled </P>

<P>Device behavior when error checking and recovery is disabled and an error condition occurs is undefined </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Multicast-event </P>

<P>Participant </P>
</TD>

<TD>
<P>see footnote5 </P>
</TD>

<TD>
<P>Send incoming multicast-event control symbols to this port (multiple port devices only) </P>
</TD>
</TR>

<TR>
<TD>
<P>10-13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Enumeration Boundary </P>
</TD>

<TD>
<P>see footnote6 </P>
</TD>

<TD>
<P>An enumeration boundary aware system enumeration algorithm shall honor this flag. The algorithm, on either the ingress or the egress port, shall not enumerate past a port with this bit set. This provides for software enforced enumeration domains within the RapidIO fabric. </P>
</TD>
</TR>

<TR>
<TD>
<P>15-19 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-10. Bit Settings for Port n Control CSRs (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>20-27 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>
</TR>

<TR>
<TD>
<P>28-30 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Type </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This indicates the port type (read only) </P>

<P>0b0 - Parallel port&#61472;&#61472;</P>

<P>0b1 - Reserved </P>
</TD>
</TR>
</Table>

<P>1The output port width reset value is implementation dependent </P>

<P>2The output port enable reset value is implementation dependent </P>

<P>3The input port width reset value is implementation dependent </P>

<P>4The Input port enable reset value is implementation dependent </P>

<P>5The multicast-event participant reset value is implementation dependent </P>

<P>6The enumeration boundary reset value is implementation dependent. Provision shall be made to allow the reset value of this bit to be configurable on a per system basis if this feature is supported. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.6 Generic End Point Devices, software assisted error recovery option </P>

<P> </P>

<P>This section describes the 8/16 LP-LVDS registers for a general end point device that supports software assisted error recovery. This is most useful for devices that for whatever reason do not want to implement error recovery in hardware and to allow software to generate link request control symbols and see the results of the responses. This Extended Features register block is assigned Extended Features block ID=0x0002. </P>

<P> </P>

<P> </P>

<P>5.6.1  Register Map </P>

<P> </P>

<P>Table 5-11 shows the register map for generic RapidIO 8/16 LP-LVDS end point devices with software assisted error recovery. The Block Offset is the offset based on the Extended Features pointer (EF_PTR) to this block. This register map is currently only defined for devices with up to 16 RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + 0xBC]. Register map offset [EF_PTR + 0xC0] can be used for another Extended Features block. </P>

<P> </P>

<P>Table 5-11. 8/16 LP-LVDS Register Map - Generic End Point Devices (SW assisted) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>8/16 LP-LVDS Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port Link Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24 </P>
</TD>

<TD>
<P>Port Response Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x28-38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Port General Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40 </P>
</TD>

<TD>
<P>Port 0 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x44 </P>
</TD>

<TD>
<P>Port 0 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x48 </P>
</TD>

<TD>
<P>Port 0 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4C-54 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Port 0 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x60 </P>
</TD>

<TD>
<P>Port 1 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x64 </P>
</TD>

<TD>
<P>Port 1 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x68 </P>
</TD>

<TD>
<P>Port 1 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x6C-74 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Port 1 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x7C </P>
</TD>

<TD>
<P>Port 1 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-11. 8/16 LP-LVDS Register Map - Generic End Point Devices (SW assisted) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x80&#8211;218 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x220 </P>
</TD>

<TD>
<P>Port 15 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x224 </P>
</TD>

<TD>
<P>Port 15 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x228 </P>
</TD>

<TD>
<P>Port 15 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x22C-234 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x238 </P>
</TD>

<TD>
<P>Port 15 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x23C </P>
</TD>

<TD>
<P>Port 15 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.6.2  Command and Status Registers (CSRs) </P>

<P> </P>

<P>Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>5.6.2.1  8/16 LP-LVDS Register Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The 8/16 LP-LVDS register block header register contains the EF_PTR to the next EF_BLK and the EF_ID that identifies this as the generic end point 8/16 LP-LVDS register block header. </P>

<P> </P>

<P>Table 5-12. Bit Settings for 8/16 LP-LVDS Register Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P>0x0002 </P>
</TD>

<TD>
<P>Hard wired Extended Features ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.6.2.2  Port Link Timeout Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x20) </P>

<P> </P>

<P>The port link timeout control register contains the timeout timer value for all ports on a device. This timeout is for link events such as sending a packet to receiving the corresponding acknowledge and sending a link-request to receiving the corresponding link-response. The reset value is the maximum timeout interval, and represents between 3 and 5 seconds. </P>

<P>Table 5-13. Bit Settings for Port Link Timeout Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;23 </P>
</TD>

<TD>
<P>timeout_value </P>
</TD>

<TD>
<P>All 1s </P>
</TD>

<TD>
<P>timeout interval value </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.6.2.3  Port Response Timeout Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x24) </P>

<P> </P>

<P>The port response timeout control register contains the timeout timer count for all ports on a device. This timeout is for sending a request packet to receiving the corresponding response packet.The reset value is the maximum timeout interval, and represents between 3 and 5 seconds. </P>

<P>Table 5-14. Bit Settings for Port Response Timeout Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;23 </P>
</TD>

<TD>
<P>timeout_value </P>
</TD>

<TD>
<P>All 1s </P>
</TD>

<TD>
<P>timeout interval value </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.6.2.4  Port General Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x3C) </P>

<P> </P>

<P>The bits accessible through the Port General Control CSR are bits that apply to all ports on a device. There is a single copy of each such bit per device. These bits are also accessible through the Port General Control CSR of any other physical layers implemented on a device. </P>

<P>Table 5-15. Bit Settings for Port General Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Host </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>A Host device is a device that is responsible for system exploration, initialization, and maintenance. Agent or slave devices are initialized by Host devices. </P>

<P>0b0 - agent or slave device&#61472;&#61472;</P>

<P>0b1 - host device </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Master Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>The Master Enable bit controls whether or not a device is allowed to issue requests into the system. If the Master Enable is not set, the device may only respond to requests. </P>

<P>0b0 - processing element cannot issue requests&#61472;&#61472;</P>

<P>0b1 - processing element can issue requests </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Discovered </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>This device has been located by the processing element responsible for system configuration&#61472;&#61472;</P>

<P>0b0 - The device has not been previously discovered&#61472;&#61472;</P>

<P>0b1 - The device has been discovered by another processing element </P>
</TD>
</TR>

<TR>
<TD>
<P>3-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>1The Host reset value is implementation dependent </P>

<P>2The Master Enable reset value is implementation dependent </P>

<P>3The Discovered reset value is implementation dependent </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.6.2.5  Port n Link Maintenance Request CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x40, 60, ..., 220) </P>

<P> </P>

<P>The port link maintenance request registers are accessible both by a local processor and an external device. A write to one of these registers generates a link-request control symbol on the corresponding RapidIO port interface. </P>

<P>Table 5-16. Bit Settings for Port n Link Maintenance Request CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;28 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>29-31 </P>
</TD>

<TD>
<P>Command </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Command to be sent in the link-request control symbol. If read, this field returns the last written value. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.6.2.6  Port n Link Maintenance Response CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x44, 64, ..., 224) </P>

<P> </P>

<P>The port link maintenance response registers are accessible both by a local processor and an external device. A read to this register returns the status received in a link-response control symbol. The link_status and ackID_status fields are defined in Section 4.4,  &#8220;Link  Maintenance  Control  Symbol  Formats.&#8221;  This  register  is read-only. </P>

<P>Table 5-17. Bit Settings for Port n Link Maintenance Response CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>response_valid </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>If the link-request causes a link-response, this bit indicates that the link-response has been received and the status fields are valid. </P>

<P>If the link-request does not cause a link-response, this bit indicates that the link-request has been transmitted. </P>

<P>This bit automatically clears on read. </P>
</TD>
</TR>

<TR>
<TD>
<P>1-24 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>25-27 </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>ackID status field from the link-response control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>28-31 </P>
</TD>

<TD>
<P>link_status </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>link status field from the link-response control symbol </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.6.2.7  Port n Local ackID Status CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x48, 68, ..., 228) </P>

<P> </P>

<P>The port link local ackID status registers are accessible both by a local processor and an external device. A read to this register returns the local ackID status for both the out and input ports of the device. </P>

<P>Table 5-18. Bit Settings for Port n Local ackID Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Clr_outstanding_ackIDs </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Writing 0b1 to this bit causes all outstanding unacknowleged packets to be discarded. This bit should only be written when trying to recover a failed link. This bit is always logic 0 when read. </P>
</TD>
</TR>

<TR>
<TD>
<P>1-4 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>5-7 </P>
</TD>

<TD>
<P>Inbound_ackID </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Input port next expected ackID value </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>16-23 </P>
</TD>

<TD>
<P>Outstanding_ackID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Output port unacknowledged ackID status. A set bit indicates that the corresponding ackID value has been used to send a packet to an attached device but a corresponding acknowledge control symbol has not been received. 0b1xxx_xxxx indicates ackID 0, 0bx1xx_xxxx indicates ackID 1, </P>

<P>0bxx1x_xxxx indicates ackID 2, etc. </P>
</TD>
</TR>

<TR>
<TD>
<P>24-28 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>29-31 </P>
</TD>

<TD>
<P>Outbound_ackID </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Output port next transmitted ackID value. Software writing this value can force re-transmission of outstanding unacknowledged packets in order to manually implement error recovery. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.6.2.8  Port n Error and Status CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x58, 78, ..., 238) </P>

<P> </P>

<P>These registers are accessed when a local processor or an external device wishes to examine the port error and status information. </P>

<P> </P>

<P>Table 5-19. Bit Settings for Port n Error and Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-10 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Output </P>

<P>Retry-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered a retry condition. This bit is set when bit 13 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Output Retried </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and can not make forward progress. This bit is set when bit 13 is set and is cleared when a packet-accepted or a packet-not-accepted control symbol is received (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Output Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and is in the </P>

<P>&#8220;output retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Output </P>

<P>Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 15 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Output Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port is in the &#8220;output error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>16-20 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>21 </P>
</TD>

<TD>
<P>Input Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>22 </P>
</TD>

<TD>
<P>Input Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 23 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>23 </P>
</TD>

<TD>
<P>Input Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>24-26 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Port-write Pending </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Port has encountered a condition which required it to initiate a Maintenance Port-write operation.This bit is only valid if the device is capable of issuing a maintenance port-write transaction. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Port Present </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>The port is receiving the free-running clock on the input port. </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Port Error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input or output port has encountered an error from which hardware was unable to recover. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Port OK </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input and output ports are initialized and can communicate with the adjacent device. This bit and bit 31 are mutually exclusive (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Uninitialized </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Input and output ports are not initialized and is in training mode. This bit and bit 30 are mutually exclusive (read-only). </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.6.2.9  Port n Control CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x5C, 7C, ..., 23C) </P>

<P> </P>

<P>The port n control registers contain control register bits for individual ports on a processing element. </P>

<P>Table 5-20. Bit Settings for Port n Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Output Port Width </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Operating width of the port (read-only): </P>

<P>0b0 - 8-bit port&#61472;&#61472;</P>

<P>0b1 - 16-bit port </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Output Port Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Output port transmit enable: </P>

<P>0b0 - port is stopped and not enabled to issue any packets except to route or respond to I/O logical MAINTENANCE packets. Control symbols are not affected and are sent normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to issue any packets </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Output Port Driver </P>

<P>Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port driver disable: </P>

<P>0b0 - output port drivers are turned on and will drive the pins normally&#61472;&#61472;</P>

<P>0b1 - output port drivers are turned off and will not drive the pins&#61472;&#61472;</P>

<P>This is useful for power management. </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Input Port Width </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>Operating width of the port (read-only): </P>

<P>0b0 - 8-bit port&#61472;&#61472;</P>

<P>0b1 - 16-bit port </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Input Port Enable </P>
</TD>

<TD>
<P>see footnote4 </P>
</TD>

<TD>
<P>Input port receive enable: </P>

<P>0b0 - port is stopped and only enabled to route or respond I/O logical MAINTENANCE packets. Other packets generate packet-not-accepted control symbols to force an error condition to be signaled by the sending device. Control symbols are not affected and are received and handled normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to respond to any packet </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Input Port Receiver </P>

<P>Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port receiver enable: </P>

<P>0b0 - input port receivers are enabled&#61472;&#61472;</P>

<P>0b1 - input port receivers are disabled and are unable to receive to any packets or control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Error Checking Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit disables all RapidIO transmission error checking </P>

<P>0b0 - Error checking and recovery is enabled&#61472;&#61472;</P>

<P>0b1 - Error checking and recovery is disabled </P>

<P>Device behavior when error checking and recovery is disabled and an error condition occurs is undefined </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Multicast-event </P>

<P>Participant </P>
</TD>

<TD>
<P>see footnote5 </P>
</TD>

<TD>
<P>Send incoming multicast-event control symbols to this port (multiple port devices only) </P>
</TD>
</TR>

<TR>
<TD>
<P>10-13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Enumeration Boundary </P>
</TD>

<TD>
<P>see footnote6 </P>
</TD>

<TD>
<P>An enumeration boundary aware system enumeration algorithm shall honor this flag. The algorithm, on either the ingress or the egress port, shall not enumerate past a port with this bit set. This provides for software enforced enumeration domains within the RapidIO fabric. </P>
</TD>
</TR>

<TR>
<TD>
<P>15-19 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-20. Bit Settings for Port n Control CSRs (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>20-27 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>
</TR>

<TR>
<TD>
<P>28-30 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Type </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This indicates the port type (read only) </P>

<P>0b0 - Parallel port&#61472;&#61472;</P>

<P>0b1 - Reserved </P>
</TD>
</TR>
</Table>

<P>1The output port width reset value is implementation dependent </P>

<P>2The output port enable reset value is implementation dependent </P>

<P>3The input port width reset value is implementation dependent </P>

<P>4The Input port enable reset value is implementation dependent </P>

<P>5The multicast-event participant reset value is implementation dependent </P>

<P>6The enumeration boundary reset value is implementation dependent. Provision shall be made to allow the reset value of this bit to be configurable on a per system basis if this feature is supported. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.7 Generic End Point Free Devices </P>

<P> </P>

<P>This section describes the 8/16 LP-LVDS registers for a general devices that do not contain end point functionality. Typically these devices are switches. This Extended Features register block uses extended features block ID=0x0003. </P>

<P> </P>

<P> </P>

<P>5.7.1  Register Map </P>

<P> </P>

<P>Table 5-21  shows  the  register  map  for  generic  RapidIO  8/16  LP-LVDS  end point-free devices. The Block Offset is the offset based on the Extended Features pointer (EF_PTR) to this block. This register map is currently only defined for devices with up to 16 RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + 0xBC]. Register map offset [EF_PTR + </P>

<P>0xC0] can be used for another Extended Features block. </P>

<P> </P>

<P>Table 5-21. 8/16 LP-LVDS Register Map - Generic End Point Free Devices </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>8/16 LP-LVDS Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port Link Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24-38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Port General Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40-54 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Port 0 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x60-74 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Port 1 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x7C </P>
</TD>

<TD>
<P>Port 1 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x80&#8211;218 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x220-234 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x238 </P>
</TD>

<TD>
<P>Port 15 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x23C </P>
</TD>

<TD>
<P>Port 15 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.7.2  Command and Status Registers (CSRs) </P>

<P> </P>

<P>Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>5.7.2.1  8/16 LP-LVDS Register Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The 8/16 LP-LVDS register block header register contains the EF_PTR to the next EF_BLK and the EF_ID that identifies this as the generic end point 8/16 LP-LVDS register block header. </P>

<P> </P>

<P>Table 5-22. Bit Settings for 8/16 LP-LVDS Register Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P>0x0003 </P>
</TD>

<TD>
<P>Hard wired Extended Features ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.7.2.2  Port Link Timeout Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x20) </P>

<P> </P>

<P>The port link timeout control register contains the timeout timer value for all ports on a device. This timeout is for link events such as sending a packet to receiving the corresponding acknowledge and sending a link-request to receiving the corresponding link-response. The reset value is the maximum timeout interval, and represents between 3 and 5 seconds. </P>

<P>Table 5-23. Bit Settings for Port Link Timeout Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;23 </P>
</TD>

<TD>
<P>timeout_value </P>
</TD>

<TD>
<P>All 1s </P>
</TD>

<TD>
<P>timeout interval value </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.7.2.3  Port General Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x3C) </P>

<P> </P>

<P>The bits accessible through the Port General Control CSR are bits that apply to all ports on a device. There is a single copy of each such bit per device. These bits are also accessible through the Port General Control CSR of any other physical layers implemented on a device. </P>

<P>Table 5-24. Bit Settings for Port General Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-1 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Discovered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This device has been located by the processing element responsible for system configuration&#61472;&#61472;</P>

<P>0b0 - The device has not been previously discovered&#61472;&#61472;</P>

<P>0b1 - The device has been discovered by another processing element </P>
</TD>
</TR>

<TR>
<TD>
<P>3-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.7.2.4  Port n Error and Status CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x58, 78, ..., 238) </P>

<P> </P>

<P>These registers are accessed when a local processor or an external device wishes to examine the port error and status information. </P>

<P> </P>

<P>Table 5-25. Bit Settings for Port n Error and Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-10 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Output </P>

<P>Retry-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered a retry condition. This bit is set when bit 13 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Output Retried </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and can not make forward progress. This bit is set when bit 13 is set and is cleared when a packet-accepted or a packet-not-accepted control symbol is received (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Output Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and is in the </P>

<P>&#8220;output retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Output </P>

<P>Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 15 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Output Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port is in the &#8220;output error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>16-20 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>21 </P>
</TD>

<TD>
<P>Input Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>22 </P>
</TD>

<TD>
<P>Input Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 23 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>23 </P>
</TD>

<TD>
<P>Input Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>24-26 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Port-write Pending </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Port has encountered a condition which required it to initiate a Maintenance Port-write operation.This bit is only valid if the device is capable of issuing a maintenance port-write transaction. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Port Present </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>The port is receiving the free-running clock on the input port. </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Port Error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input or output port has encountered an error from which hardware was unable to recover. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Port OK </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input and output ports are initialized and can communicate with the adjacent device. This bit and bit 31 are mutually exclusive (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Uninitialized </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Input and output ports are not initialized and is in training mode. This bit and bit 30 are mutually exclusive (read-only). </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.7.2.5  Port n Control CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x5C, 7C, ..., 23C) </P>

<P> </P>

<P>The port n control registers contain control register bits for individual ports on a processing element. </P>

<P>Table 5-26. Bit Settings for Port n Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Output Port Width </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Operating width of the port (read-only): </P>

<P>0b0 - 8-bit port&#61472;&#61472;</P>

<P>0b1 - 16-bit port </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Output Port Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Output port transmit enable: </P>

<P>0b0 - port is stopped and not enabled to issue any packets except to route or respond to I/O logical MAINTENANCE packets. Control symbols are not affected and are sent normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to issue any packets </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Output Port Driver </P>

<P>Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port driver disable: </P>

<P>0b0 - output port drivers are turned on and will drive the pins normally&#61472;&#61472;</P>

<P>0b1 - output port drivers are turned off and will not drive the pins&#61472;&#61472;</P>

<P>This is useful for power management. </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Input Port Width </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>Operating width of the port (read-only): </P>

<P>0b0 - 8-bit port&#61472;&#61472;</P>

<P>0b1 - 16-bit port </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Input Port Enable </P>
</TD>

<TD>
<P>see footnote4 </P>
</TD>

<TD>
<P>Input port receive enable: </P>

<P>0b0 - port is stopped and only enabled to route or respond I/O logical MAINTENANCE packets. Other packets generate packet-not-accepted control symbols to force an error condition to be signaled by the sending device. Control symbols are not affected and are received and handled normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to respond to any packet </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Input Port Receiver </P>

<P>Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port receiver enable: </P>

<P>0b0 - input port receivers are enabled&#61472;&#61472;</P>

<P>0b1 - input port receivers are disabled and are unable to receive to any packets or control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Error Checking Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit disables all RapidIO transmission error checking </P>

<P>0b0 - Error checking and recovery is enabled&#61472;&#61472;</P>

<P>0b1 - Error checking and recovery is disabled </P>

<P>Device behavior when error checking and recovery is disabled and an error condition occurs is undefined </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Multicast-event </P>

<P>Participant </P>
</TD>

<TD>
<P>see footnote5 </P>
</TD>

<TD>
<P>Send incoming multicast-event control symbols to this output port </P>

<P>(multiple port devices only) </P>
</TD>
</TR>

<TR>
<TD>
<P>10-13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Enumeration Boundary </P>
</TD>

<TD>
<P>see footnote6 </P>
</TD>

<TD>
<P>An enumeration boundary aware system enumeration algorithm shall honor this flag. The algorithm, on either the ingress or the egress port, shall not enumerate past a port with this bit set. This provides for software enforced enumeration domains within the RapidIO fabric. </P>
</TD>
</TR>

<TR>
<TD>
<P>15-19 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 5-26. Bit Settings for Port n Control CSRs (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>20-27 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>
</TR>

<TR>
<TD>
<P>28-30 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Type </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This indicates the port type (read only) </P>

<P>0b0 - Parallel port&#61472;&#61472;</P>

<P>0b1 - Reserved </P>
</TD>
</TR>
</Table>

<P>1The output port width reset value is implementation dependent </P>

<P>2The output port enable reset value is implementation dependent </P>

<P>3The input port width reset value is implementation dependent </P>

<P>4The Input port enable reset value is implementation dependent </P>

<P>5The multicast-event participant reset value is implementation dependent </P>

<P>6The enumeration boundary reset value is implementation dependent. Provision shall be made to allow the reset value of this bit to be configurable on a per system basis if this feature is supported. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.8 Generic End Point Free Devices, software assisted error recovery option </P>

<P> </P>

<P>This section describes the 8/16 LP-LVDS registers for a general device that does not contain end point device functionality that supports software assisted error recovery. Typically these devices are switches. This is most useful for devices that for whatever reason do not want to implement error recovery in hardware and to allow software to generate link request control symbols and see the results of the responses. This Extended Features register block is assigned Extended Features block ID=0x0009. </P>

<P> </P>

<P> </P>

<P>5.8.1  Register Map </P>

<P> </P>

<P>Table 5-11  shows  the  register  map  for  generic  RapidIO  8/16  LP-LVDS  end point-free devices with software assisted error recovery. The Block Offset is the offset based on the Extended Features pointer (EF_PTR) to this block. This register map is currently only defined for devices with up to 16 RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + 0xBC]. Register map offset [EF_PTR + 0xC0] can be used for another Extended Features block. </P>

<P> </P>

<P>Table 5-27. 8/16 LP-LVDS Register Map - Generic End Point-free Devices (SW assisted) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>8/16 LP-LVDS Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port Link Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24-38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Port General Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40 </P>
</TD>

<TD>
<P>Port 0 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x44 </P>
</TD>

<TD>
<P>Port 0 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x48 </P>
</TD>

<TD>
<P>Port 0 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4C-54 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Port 0 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x60 </P>
</TD>

<TD>
<P>Port 1 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x64 </P>
</TD>

<TD>
<P>Port 1 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x68 </P>
</TD>

<TD>
<P>Port 1 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x6C-74 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Port 1 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x7C </P>
</TD>

<TD>
<P>Port 1 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 5-27. 8/16 LP-LVDS Register Map - Generic End Point-free Devices (SW assisted) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x80&#8211;218 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x220 </P>
</TD>

<TD>
<P>Port 15 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x224 </P>
</TD>

<TD>
<P>Port 15 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x228 </P>
</TD>

<TD>
<P>Port 15 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x22C-234 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x238 </P>
</TD>

<TD>
<P>Port 15 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x23C </P>
</TD>

<TD>
<P>Port 15 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.8.2  Command and Status Registers (CSRs) </P>

<P> </P>

<P>Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>5.8.2.1  8/16 LP-LVDS Register Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The 8/16 LP-LVDS register block header register contains the EF_PTR to the next EF_BLK and the EF_ID that identifies this as the generic end point 8/16 LP-LVDS register block header. </P>

<P> </P>

<P>Table 5-28. Bit Settings for 8/16 LP-LVDS Register Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P>0x0009 </P>
</TD>

<TD>
<P>Hard wired Extended Features ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.8.2.2  Port Link Timeout Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x20) </P>

<P> </P>

<P>The port link timeout control register contains the timeout timer value for all ports on a device. This timeout is for link events such as sending a packet to receiving the corresponding acknowledge and sending a link-request to receiving the corresponding link-response. The reset value is the maximum timeout interval, and represents between 3 and 5 seconds. </P>

<P>Table 5-29. Bit Settings for Port Link Timeout Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;23 </P>
</TD>

<TD>
<P>timeout_value </P>
</TD>

<TD>
<P>All 1s </P>
</TD>

<TD>
<P>timeout interval value </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.8.2.3  Port General Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x3C) </P>

<P> </P>

<P>The bits accessible through the Port General Control CSR are bits that apply to all ports on a device. There is a single copy of each such bit per device. These bits are also accessible through the Port General Control CSR of any other physical layers implemented on a device. </P>

<P>Table 5-30. Bit Settings for Port General Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-1 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Discovered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This device has been located by the processing element responsible for system configuration&#61472;&#61472;</P>

<P>0b0 - The device has not been previously discovered&#61472;&#61472;</P>

<P>0b1 - The device has been discovered by another processing element </P>
</TD>
</TR>

<TR>
<TD>
<P>3-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.8.2.4  Port n Link Maintenance Request CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x40, 60, ..., 220) </P>

<P> </P>

<P>The port link maintenance request registers are accessible both by a local processor and an external device. A write to one of these registers generates a link-request control symbol on the corresponding RapidIO port interface. </P>

<P>Table 5-31. Bit Settings for Port n Link Maintenance Request CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;28 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>29-31 </P>
</TD>

<TD>
<P>Command </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Command to be sent in the link-request control symbol. If read, this field returns the last written value. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.8.2.5  Port n Link Maintenance Response CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x44, 64, ..., 224) </P>

<P> </P>

<P>The port link maintenance response registers are accessible both by a local processor and an external device. A read to this register returns the status received in a link-response control symbol. The link_status and ackID_status fields are defined in Section 4.4,  &#8220;Link  Maintenance  Control  Symbol  Formats.&#8221;  This  register  is read-only. </P>

<P>Table 5-32. Bit Settings for Port n Link Maintenance Response CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>response_valid </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>If the link-request causes a link-response, this bit indicates that the link-response has been received and the status fields are valid. </P>

<P>If the link-request does not cause a link-response, this bit indicates that the link-request has been transmitted. </P>

<P>This bit automatically clears on read. </P>
</TD>
</TR>

<TR>
<TD>
<P>1-24 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>25-27 </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>ackID status field from the link-response control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>28-31 </P>
</TD>

<TD>
<P>link_status </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>link status field from the link-response control symbol </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.8.2.6  Port n Local ackID Status CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x48, 68, ..., 228) </P>

<P> </P>

<P>The port link local ackID status registers are accessible both by a local processor and an external device. A read to this register returns the local ackID status for both the out and input ports of the device. </P>

<P>Table 5-33. Bit Settings for Port n Local ackID Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Clr_outstanding_ackIDs </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Writing 0b1 to this bit causes all outstanding unacknowleged packets to be discarded. This bit should only be written when trying to recover a failed link. This bit is always logic 0 when read. </P>
</TD>
</TR>

<TR>
<TD>
<P>1-4 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>5-7 </P>
</TD>

<TD>
<P>Inbound_ackID </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Input port next expected ackID value </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>16-23 </P>
</TD>

<TD>
<P>Outstanding_ackID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Output port unacknowledged ackID status. A set bit indicates that the corresponding ackID value has been used to send a packet to an attached device but a corresponding acknowledge control symbol has not been received. 0b1xxx_xxxx indicates ackID 0, 0bx1xx_xxxx indicates ackID 1, </P>

<P>0bxx1x_xxxx indicates ackID 2, etc. </P>
</TD>
</TR>

<TR>
<TD>
<P>24-28 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>29-31 </P>
</TD>

<TD>
<P>Outbound_ackID </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Output port next transmitted ackID value. Software writing this value can force re-transmission of outstanding unacknowledged packets in order to manually implement error recovery. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.8.2.7  Port n Error and Status CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x58, 78, ..., 238) </P>

<P> </P>

<P>These registers are accessed when a local processor or an external device wishes to examine the port error and status information. </P>

<P> </P>

<P>Table 5-34. Bit Settings for Port n Error and Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-10 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Output </P>

<P>Retry-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered a retry condition. This bit is set when bit 13 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Output Retried </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and can not make forward progress. This bit is set when bit 13 is set and is cleared when a packet-accepted or a packet-not-accepted control symbol is received (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Output Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and is in the </P>

<P>&#8220;output retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Output </P>

<P>Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 15 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Output Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port is in the &#8220;output error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>16-20 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>21 </P>
</TD>

<TD>
<P>Input Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>22 </P>
</TD>

<TD>
<P>Input Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 23 is set. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>23 </P>
</TD>

<TD>
<P>Input Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>24-26 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Port-write Pending </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Port has encountered a condition which required it to initiate a Maintenance Port-write operation.This bit is only valid if the device is capable of issuing a maintenance port-write transaction. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Port Present </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>The port is receiving the free-running clock on the input port. </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Port Error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input or output port has encountered an error from which hardware was unable to recover. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Port OK </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input and output ports are initialized and can communicate with the adjacent device. This bit and bit 31 are mutually exclusive (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Uninitialized </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Input and output ports are not initialized and is in training mode. This bit and bit 30 are mutually exclusive (read-only). </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.8.2.8  Port n Control CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x5C, 7C, ..., 23C) </P>

<P> </P>

<P>The port n control registers contain control register bits for individual ports on a processing element. </P>

<P>Table 5-35. Bit Settings for Port n Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Output Port Width </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Operating width of the port (read-only): </P>

<P>0b0 - 8-bit port&#61472;&#61472;</P>

<P>0b1 - 16-bit port </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Output Port Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Output port transmit enable: </P>

<P>0b0 - port is stopped and not enabled to issue any packets except to route or respond to I/O logical MAINTENANCE packets. Control symbols are not affected and are sent normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to issue any packets </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Output Port Driver </P>

<P>Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port driver disable: </P>

<P>0b0 - output port drivers are turned on and will drive the pins normally&#61472;&#61472;</P>

<P>0b1 - output port drivers are turned off and will not drive the pins&#61472;&#61472;</P>

<P>This is useful for power management. </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Input Port Width </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>Operating width of the port (read-only): </P>

<P>0b0 - 8-bit port&#61472;&#61472;</P>

<P>0b1 - 16-bit port </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Input Port Enable </P>
</TD>

<TD>
<P>see footnote4 </P>
</TD>

<TD>
<P>Input port receive enable: </P>

<P>0b0 - port is stopped and only enabled to route or respond I/O logical MAINTENANCE packets. Other packets generate packet-not-accepted control symbols to force an error condition to be signaled by the sending device. Control symbols are not affected and are received and handled normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to respond to any packet </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Input Port Receiver </P>

<P>Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port receiver enable: </P>

<P>0b0 - input port receivers are enabled&#61472;&#61472;</P>

<P>0b1 - input port receivers are disabled and are unable to receive to any packets or control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Error Checking Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit disables all RapidIO transmission error checking </P>

<P>0b0 - Error checking and recovery is enabled&#61472;&#61472;</P>

<P>0b1 - Error checking and recovery is disabled </P>

<P>Device behavior when error checking and recovery is disabled and an error condition occurs is undefined </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Multicast-event </P>

<P>Participant </P>
</TD>

<TD>
<P>see footnote5 </P>
</TD>

<TD>
<P>Send incoming multicast-event control symbols to this port (multiple port devices only) </P>
</TD>
</TR>

<TR>
<TD>
<P>10-13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Enumeration Boundary </P>
</TD>

<TD>
<P>see footnote6 </P>
</TD>

<TD>
<P>An enumeration boundary aware system enumeration algorithm shall honor this flag. The algorithm, on either the ingress or the egress port, shall not enumerate past a port with this bit set. This provides for software enforced enumeration domains within the RapidIO fabric. </P>
</TD>
</TR>

<TR>
<TD>
<P>15-19 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-35. Bit Settings for Port n Control CSRs (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>20-27 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>
</TR>

<TR>
<TD>
<P>28-30 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Type </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This indicates the port type (read only) </P>

<P>0b0 - Parallel port&#61472;&#61472;</P>

<P>0b1 - Reserved </P>
</TD>
</TR>
</Table>

<P>1The output port width reset value is implementation dependent </P>

<P>2The output port enable reset value is implementation dependent </P>

<P>3The input port width reset value is implementation dependent </P>

<P>4The Input port enable reset value is implementation dependent </P>

<P>5The multicast-event participant reset value is implementation dependent </P>

<P>6The enumeration boundary reset value is implementation dependent. Provision shall be made to allow the reset value of this bit to be configurable on a per system basis if this feature is supported. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 6 System Clocking Considerations </P>

<P> </P>

<P> </P>

<P>6.1 Introduction </P>

<P> </P>

<P>The RapidIO parallel physical interface can be deployed in a variety of system configurations. A fundamental aspect to the successful deployment of RapidIO is clock distribution. This section is provided to point out the issues of distributing clocks in a system. </P>

<P> </P>

<P> </P>

<P>6.2 Example Clock Distribution </P>

<P> </P>

<P>Clock distribution in a small system is straightforward. It is assumed that clocking is provided from a single clock source (Figure 6-1). </P>

<P> </P>

<P> </P>

<P>Clock </P>

<P>Source </P>

<P> </P>

<P> </P>

<P> </P>

<P>End </P>

<P>Point </P>

<P>Switch </P>

<P>Fabric </P>

<P>End </P>

<P>Point </P>

<P> </P>

<P> </P>

<P> </P>

<P>End </P>

<P>Point </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_296.jpg"/>
</Figure>

<P>Figure 6-1. Clock Distribution in a Small System </P>

<P> </P>

<P>In this case the timing budget must account for any skew and jitter component between each point. Skew and jitter are introduced owing to the end point clock regeneration circuitry (PLL or DLL) and to transmission line effects. </P>

<P> </P>

<P>Distributing a clock from a central source may not be practical in larger or more robust systems. In these cases it may be desirable to have multiple clock sources or to distribute the clock through the interconnect. Figure 6-2 displays the clock distribution in a larger system. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Clock </P>

<P>Source 0 </P>

<P>Clock </P>

<P>Source 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P>End </P>

<P>Point </P>

<P>Switch </P>

<P>Fabric </P>

<P>Switch </P>

<P>Fabric </P>

<P>End </P>

<P>Point </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_297.jpg"/>
</Figure>

<P>To Other End Points </P>

<P>To Other End Points </P>

<P> </P>

<P>Figure 6-2. Clock Distribution in a Larger System </P>

<P> </P>

<P>In such a system the clock sources may be of the same relative frequency; however, they are not guaranteed to be always at exact frequency. Clock sources will drift in phase relationship with each other over time. This adds an additional component because it is possible that one device may be slightly faster than its companion device. This requires a packet elasticity mechanism. </P>

<P> </P>

<P>If the clock is transported through the interconnect as shown in Figure 6-3, then additive clock jitter must be taken into account. </P>

<P> </P>

<P> </P>

<P>Clock </P>

<P>Source 0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>End </P>

<P>Point </P>

<P> </P>

<P> </P>

<P>PLL </P>

<P>Switch </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_298.jpg"/>
</Figure>

<P>Fabric </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_299.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_300.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_301.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>PLL </P>

<P>Switch </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_302.jpg"/>
</Figure>

<P>Fabric </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_303.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_304.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_305.jpg"/>
</Figure>

<P> </P>

<P>End </P>

<P>Point </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_306.jpg"/>
</Figure>

<P>To Other End Points </P>

<P>To Other End Points </P>

<P> </P>

<P>Figure 6-3. Clock Distribution Through the Interconnect </P>

<P> </P>

<P>Assuming that each device gets a clock that was regenerated by its predecessor, and each device adds a certain jitter component to the clock, the resulting clock at the end point may be greatly unstable. This factor must be added to the timing budget. </P>

<P> </P>

<P> </P>

<P>6.3 Elasticity Mechanism </P>

<P> </P>

<P>In systems with multiple clock sources, clocks may be of the same relative frequency but not exact. Their phase will drift over time. An elasticity mechanism is therefore required to keep devices from missing data beats. For example, if the received clock is faster than the internal clock, then it may be necessary to delete an inbound symbol. If the received clock is slower than the internal clock, then it may be necessary to insert an inbound symbol. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>This RapidIO 8/16 LP-LVDS interface is source synchronous; therefore, it is guaranteed that a data element will have an associated clock strobe with which to synchronize. A clock boundary is crossed in the receive logic of the end point as the inbound data is synchronized to the internal clock. It must be guaranteed in the end point that a drift between the two clock sources does not cause a setup hold violation resulting in metastability in capturing the data. </P>

<P> </P>

<P>To ensure that data is not missed, an end point implements an elasticity buffer. RapidIO uses idle control symbols as the elasticity mechanism. If a receiver needs to skip a symbol during receipt of a large packet, it can issue a throttle control symbol to cause the sender to insert an aligned pacing idle control symbol in the byte stream. </P>

<P> </P>

<P>A data beat is clocked into the elasticity buffer with the external clock. The data beat is pulled out of the elasticity buffer using the internal clock delayed by a number of clocks behind the external clock event. This allows the data to become stable before it is synchronized to the internal clock. If the two clock events drift too close together then it is necessary for the synchronization logic to reset the tap and essentially skip a symbol. By guaranteeing a periodic idle control symbol, it is possible for the receive logic to skip a data beat and not miss a critical symbol element. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 7 Board Routing Guidelines </P>

<P> </P>

<P> </P>

<P>7.1 Introduction </P>

<P> </P>

<P>This chapter contains board design guidelines for RapidIO based systems. The information here is presented as a guide for implementing a RapidIO board design. It is noted that the board designer may have constraints such as standard design practices, vendor selection criteria, and design methodology that must be followed. Therefore appropriate diligence must be applied by the designer. </P>

<P> </P>

<P>RapidIO is a source-synchronous differential point-to-point interconnect, so routing considerations are minimal. The very high clock rate places a premium on minimizing skew and discontinuities, such as vias and bends. Generally, layouts should be as straight and free of vias as possible using controlled impedance differential pairs. </P>

<P> </P>

<P> </P>

<P>7.2 Impedance </P>

<P> </P>

<P>Interconnect design should follow standard practice for differential pairs. To minimize reflections from the receiver&#8217;s 100 Ohm termination, each side of the coupled pair should have a characteristic impedence of 50 Ohms (i..e. 100 Ohms differential impedence). The two signals forming the differential pair should be tightly coupled. The differential pairs should be widely spaced, consistent with skew control and quality routing, so that the crosstalk noise is common mode. </P>

<P> </P>

<P> </P>

<P>7.3 Skew </P>

<P> </P>

<P>To minimize the skew on a RapidIO channel the total electrical length for each trace within each unidirectional channel should be equal. Several layouts are suggested in </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_307.jpg"/>
</Figure>

<P>Figure 7-1. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_308.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_309.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_310.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_311.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_312.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_313.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_314.jpg"/>
</Figure>

<P>Side-by-Side Right Angle Opposed </P>

<P> </P>

<P>Figure 7-1. Routing for Equalized Skew for Several Placements </P>

<P> </P>

<P>Because the RapidIO model is source synchronous, the total length is not critical. Best signal integrity is achieved using a clean layout between opposed parts due to routing on a single layer. </P>

<P> </P>

<P>The side-by-side layout requires two routing layers and has reduced signal integrity due to the vias between layers. To keep the total electrical length equal, both layers must have the same phase velocity. </P>

<P> </P>

<P>Finally, right angle routing requires meandering to equalize delay, and meandered sections reduce signal integrity while increasing radiation. It may be necessary to place meandered sections on a second routing layer to keep the routing clean. </P>

<P> </P>

<P>All skew calculations should be taken to the edge of the package. The package layout and PCB breakout are co-designed to minimize skew, and a recommended PCB breakout is provided. </P>

<P> </P>

<P> </P>

<P>7.4 PCB Stackup </P>

<P> </P>

<P>PCB stackup has a significant effect on EMI generated by the high frequency of operation of a RapidIO channel, so EMI control must be planned from the start. Several stackups are shown in Figure 7-2. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_315.jpg"/>
</Figure>

<P>S1 </P>

<P> </P>

<P>GND PWR S2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>GND S1 </P>

<P>S2 </P>

<P> </P>

<P>PWR </P>

<P>GND S1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_316.jpg"/>
</Figure>

<P>PWR S2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_317.jpg"/>
</Figure>

<Textbox>
<P>Stripline Stripline </P>
</Textbox>

<P>GND </P>

<P> </P>

<P>S3 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_318.jpg"/>
</Figure>

<P>Traditional four layer </P>

<P>EMI-control four layer </P>

<P>EMI-control </P>

<P>high signal integrity </P>

<P>six layer </P>

<P> </P>

<P>Figure 7-2. Potential PCB Stackups </P>

<P> </P>

<P>122 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The traditional four-layer stackup provides equal phase velocities on the two routing layers, but the placement of routing on the outside layers allows for easier radiation. This stackup is suitable for very short interconnects or for applications using an add-on shield. </P>

<P> </P>

<P>The four-layer stackup can be rearranged to help with EMI control by placing the power and ground layers on the outside. Each routing layer still has equal phase velocities, but orthogonal routing can degrade signal integrity at very high speeds. The power distribution inductance is approximately tripled due to the larger spacing between the power and ground planes, so applications using this stackup should plan on using more and higher quality bypass capacitance. </P>

<P> </P>

<P>The six-layer stackup shows one of many possible stackups. High-speed routing is on S1 and S2 in stripline, so signal quality is excellent with EMI control. S3 is for low-speed signals. Both S1 and S2 have equal phase velocities, good impedance control, and excellent isolation. Power distribution inductance is comparable to the four-layer stackup since the extra GND plane makes up for the extra (2X) spacing between PWR and GND. This example stackup is not balanced with respect to metal loading. </P>

<P> </P>

<P> </P>

<P>7.5 Termination </P>

<P> </P>

<P>Depending upon the individual device characteristics and the requirements of the particular application, the board route may be required to encompass external devices such as terminating resistors or networks. The effect of such devices on the board route must be carefully analyzed and controlled. </P>

<P> </P>

<P> </P>

<P>7.6 Additional Considerations </P>

<P> </P>

<P>The application environment for a RapidIO channel may place additional constraints on the PCB design. </P>

<P> </P>

<P> </P>

<P>7.6.1  Single Board Environments </P>

<P> </P>

<P>A RapidIO channel completely constructed onto a single board offers the highest performance in terms of clock rate and signal integrity. The primary issues are clean routing with minimal skew. Higher clock rates put greater emphasis on the use of quality sockets (in terms of electrical performance) or on eliminating sockets altogether. </P>

<P> </P>

<P> </P>

<P>7.6.2  Single Connector Environments </P>

<P> </P>

<P>The high clock rate of the 8/16 LP-LVDS physical layer requires the use of an impedance-controlled edge connector. The number of pins dedicated to power should equal the number dedicated to ground, and the distribution of power and ground pins should be comparable. If ground pins greatly outnumber power pins, </P>

<P> </P>

<P>RapidIO Trade Association 123 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>then bypass capacitors along the length of each side of the connector should be provided. Place the connector as close to one end of the RapidIO interconnect as possible. </P>

<P> </P>

<P> </P>

<P>7.6.3  Backplane Environments </P>

<P> </P>

<P>With two connectors, the design considerations from the single connector environment apply but with greater urgency. The two connectors should either be located as close together or as far apart as possible. </P>

<P> </P>

<P> </P>

<P>7.7 Recommended pin escape ordering </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_319.jpg"/>
</Figure>

<P>Given the source-synchronous nature of the 8/16 LP-LVDS physical layer and the clock to data pin skew concern for maximum operating frequency, the recommended bit escape ordering (assuming the device and port orientation shown in Figure 7-1) is shown graphically in Figure 7-3 and Figure 7-4. The figures assume that the device is being viewed from the top. For BGA-style packaged devices the recommended bit escape wire route should be supplied to the board designer. The signal names are defined in Chapter 8, &#8220;Signal Descriptions&#8221;. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_320.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_321.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_322.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_323.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_324.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_325.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_326.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_327.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_328.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_329.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_330.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_331.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_332.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_333.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_334.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_335.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_336.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_337.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_338.jpg"/>
</Figure>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P>R R R R  R R R R R R R R R R  R R R R R R R R R R  R R R R R R R R R R  R R R R D D D D  D D D D C C D D D D  D D D D F F D D D D  D D D D C C D D D D  D D D D </P>

<P>0  0  1  1   2  2  3  3  L L 4  4  5  5   6  6  7  7  R R 8  8  9  9   1  1  1  1  L L 1  1  1  1   1  1  1  1 </P>

<P>K K A A 0  0   1  1  K K 2  2  3  3   4  4   5  5   </P>

<P>0  0 M M 1  1   </P>

<P>E E </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_339.jpg"/>
</Figure>

<P>Figure 7-3. Recommended device pin escape, input port, top view of device </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_340.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_341.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_342.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_343.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_344.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_345.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_346.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_347.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_348.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_349.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_350.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_351.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_352.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_353.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_354.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_355.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_356.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_357.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_358.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_359.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_360.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_361.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_362.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_363.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_364.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_365.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_366.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_367.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_368.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_369.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_370.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_371.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_372.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_373.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_374.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_375.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_376.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_377.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_378.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_379.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_380.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_381.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_382.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>T T T T  T T T T T T T T  T T  T T T T T T T T T T  T T T T T T T T T T  T T T T D D D D  D D D D C C D D D D  D D D D F F D D D D  D D D D C C D D D D  D D D D </P>

<P>1  1  1  1   1  1  1  1  L L  1  1  1  1   9  9  8 _8 R R  7  7  6  6   5  5  4  4  L L 3  3  2  2   1  1  0  0 </P>

<P>5  5  4  4   3  3  2  2 K K  1  1  0  0 A A K K </P>

<P>1  1 M M 0  0 </P>

<P>E E </P>
</TD>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_383.jpg"/>
</Figure>

<P>Figure 7-4. Recommended device pin escape, output port, top view of device </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_384.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_385.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_386.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_387.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_388.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_389.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_390.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_391.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_392.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_393.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_394.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_395.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_396.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_397.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_398.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_399.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_400.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_401.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_402.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_403.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_404.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_405.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_406.jpg"/>
</Figure>

<P> </P>

<P>These pin escapes allow clean board routes that provide maximum performance connections between two devices as can be seen in the example in Figure 7-5 below. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_407.jpg"/>
</Figure>

<P>T T T T  F F </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_408.jpg"/>
</Figure>

<P> </P>

<P>              </P>

<P>    C C                    R R </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_409.jpg"/>
</Figure>

<P>T T T T  T T T T L L T T T T  T T T T A A D D D D  D D D D K K D D D D  D D D D M M </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_410.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_411.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_412.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_413.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_414.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_415.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_416.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_417.jpg"/>
</Figure>

<P>0  0  1  1 </P>

<P>2  2  3  3  0 0  4  4  5  5 </P>

<P>6  6  7  7  E E </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_418.jpg"/>
</Figure>

<P>R R R R  R R R R R R R R R R  R R R R R R D D D D  D D D D C C D D D D  D D D D F F </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_419.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_420.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_421.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_422.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_423.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_424.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_425.jpg"/>
</Figure>

<P>0  0  1  1 </P>

<P>2  2  3  3  L L 4  4  5  5 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_426.jpg"/>
</Figure>

<P>K K </P>

<P>0  0   </P>

<P>6  6  7  7  R R </P>

<P>A A </P>

<P>M M </P>

<P>E E </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_427.jpg"/>
</Figure>

<P>Figure 7-5. Opposed orientation, same side of board </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_428.jpg"/>
</Figure>

<P>If the attached devices are mounted with certain device orientations the bit wires become  crossed. An  example  of  this  situation  is  shown  in  Figure 7-6.  It  is permissible for a device to also allow a bit-reversing option on the output (or input) port to support these orientations, as shown in Figure 7-6 and Figure 7-7. </P>

<P> </P>

<P> </P>
<Figure Alt="T T T T  T T T T T T T T T T  T T T T T T">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_429.jpg"/>
</Figure>

<P>Device on bottom of board </P>
<Figure Alt="D D D D  D D D D C C D D D D  D D D D F F">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_430.jpg"/>
</Figure>
<Figure Alt="0  0  1  1   2  2  3  3  L L 4  4  5  5   6  6  7  7  R R">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_431.jpg"/>
</Figure>
<Figure Alt="K K">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_432.jpg"/>
</Figure>
<Figure Alt="0  0  ">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_433.jpg"/>
</Figure>
<Figure Alt="A A">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_434.jpg"/>
</Figure>
<Figure Alt="M M">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_435.jpg"/>
</Figure>
<Figure Alt="E E">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_436.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_437.jpg"/>
</Figure>

<P>R R R R  R R R R R R R R R R  R R R R R R D D D D  D D D D C C D D D D  D D D D F F </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_438.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_439.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_440.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_441.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_442.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_443.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_444.jpg"/>
</Figure>

<P>0  0  1  1 </P>

<P>2  2  3  3  L L 4  4  5  5 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_445.jpg"/>
</Figure>

<P>K K </P>

<P>0  0   </P>

<P>6  6  7  7  R R </P>

<P>A A </P>

<P>M M </P>

<P>E E </P>

<P> </P>

<P> </P>

<P>Device on top of board </P>

<P> </P>

<P>Figure 7-6. Opposed orientation, opposite sides of board </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_446.jpg"/>
</Figure>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>T T T T  T T T T T T T T T T  T T T T T T T T T T  T T T T T T T T T T  T T T T D D D D  D D D D C C D D D D  D D D D F F D D D D  D D D D C C D D D D  D D D D </P>

<P>0  0  1  1   2  2  3  3  L L 4  4  5  5   6  6  7  7  R R 8  8  9  9   1  1  1  1  L L 1  1  1  1   1  1  1  1 </P>

<P>K K A A 0  0   1  1  K K 2  2  3  3   4  4   5  5   </P>

<P>0  0 M M 1  1   </P>

<P>E E </P>
</TD>

<TD>
<P> </P>
</TD>

<TD/>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_447.jpg"/>
</Figure>

<P>Figure 7-7. Recommended device pin escape, output port reversed, top view of device </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_448.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_449.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_450.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_451.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_452.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_453.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_454.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_455.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_456.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_457.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_458.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_459.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_460.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_461.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_462.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_463.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_464.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_465.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_466.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_467.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_468.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_469.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_470.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_471.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_472.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_473.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_474.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_475.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_476.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_477.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_478.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_479.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_480.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_481.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_482.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_483.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="T T T T T T  T T T T T T T T T T  T T T T">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_484.jpg"/>
</Figure>

<P>Device on bottom of board, output port reversed </P>
<Figure Alt="F F D D D D  D D D D C C D D D D  D D D D">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_485.jpg"/>
</Figure>
<Figure Alt="R R  7  7  6  6   5  5  4  4 L L  3  3  2  2   1  1  0  0">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_486.jpg"/>
</Figure>
<Figure Alt="A A">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_487.jpg"/>
</Figure>
<Figure Alt="M M">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_488.jpg"/>
</Figure>
<Figure Alt="E E">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_489.jpg"/>
</Figure>
<Figure Alt="K K">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_490.jpg"/>
</Figure>
<Figure Alt="0  0">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_491.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_492.jpg"/>
</Figure>

<P>R R R R  R R R R R R R R R R  R R R R R R D D D D  D D D D C C D D D D  D D D D F F </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_493.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_494.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_495.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_496.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_497.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_498.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_499.jpg"/>
</Figure>

<P>0  0  1  1 </P>

<P>2  2  3  3  L L 4  4  5  5 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_500.jpg"/>
</Figure>

<P>K K </P>

<P>0  0   </P>

<P>6  6  7  7  R R </P>

<P>A A </P>

<P>M M </P>

<P>E E </P>

<P> </P>

<P>Device on top of board </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_501.jpg"/>
</Figure>

<P>Figure 7-8. Opposed orientation, output port reversed, opposite sides of board </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_502.jpg"/>
</Figure>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_503.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_504.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 8 Signal Descriptions </P>

<P> </P>

<P> </P>

<P>8.1 Introduction </P>

<P> </P>

<P>This chapter contains the signal pin descriptions for a RapidIO 8/16 LP-LVDS port. The interface is defined as a parallel 10 bit full duplex point-to-point interface using differential LVDS signaling. The LVDS electrical details are described in Chapter 9, &#8220;Electrical Specifications.&#8221; </P>

<P> </P>

<P> </P>

<P>8.2 Signal Definitions </P>

<P> </P>

<P>Table 8-1 provides a summary of the RapidIO signal pins as well as a short description of their functionality. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_505.jpg"/>
</Figure>

<P>Table 8-1. 8/16 LP-LVDS Signal Descriptions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Signal Name </P>
</TD>

<TD>
<P>I/O </P>
</TD>

<TD>
<P>Signal Meaning </P>
</TD>

<TD>
<P>Timing Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>TCLK0 </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Clock&#8212;Free-running clock for the </P>

<P>8-bit port and the most significant half of the </P>

<P>16-bit port. TCLK0 connects to RCLK0 of the receiving device. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>TCLK0 </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Clock complement&#8212;This signal is the differential pair of the TCLK0 signal. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>TD[0-7] </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Data&#8212;The transmit data is a unidirectional point to point bus designed to transmit the packet information along with the associated TCLK0 and TFRAME. The TD bus of one device is connected to the RD bus of the receiving device. </P>
</TD>

<TD>
<P>Assertion of TD[0-7] is always done with a fixed relationship to TCLK0 as defined in the AC section </P>
</TD>
</TR>

<TR>
<TD>
<P>TD[0-7] </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Data complement&#8212;This vector is the differential pair of TD[0-7]. </P>
</TD>

<TD>
<P>Same as TD </P>
</TD>
</TR>

<TR>
<TD>
<P>TFRAME </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit framing signal&#8212;When issued as active this signal indicates a packet control event. TFRAME is connected to RFRAME of the receiving device. </P>
</TD>

<TD>
<P>Assertion of TFRAME is always done with a fixed relationship to TCLK0 as defined in the AC section </P>
</TD>
</TR>

<TR>
<TD>
<P>TFRAME </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit frame complement&#8212;This signal is the differential pair of the TFRAME signal. </P>
</TD>

<TD>
<P>Same as TFRAME </P>
</TD>
</TR>

<TR>
<TD>
<P>TCLK1 </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Clock&#8212;Free-running clock for the least significant half of the 16-bit port </P>

<P>(TD[8-15]). TCLK1 connects to RCLK1 of the receiving device. This signal is not used when connected to an 8-bit device. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>TCLK1 </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Clock complement&#8212;This signal is the differential pair of the TCLK1 signal. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_506.jpg"/>
</Figure>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_507.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_508.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_509.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_510.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_511.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_512.jpg"/>
</Figure>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_513.jpg"/>
</Figure>

<P>Table 8-1. 8/16 LP-LVDS Signal Descriptions (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Signal Name </P>
</TD>

<TD>
<P>I/O </P>
</TD>

<TD>
<P>Signal Meaning </P>
</TD>

<TD>
<P>Timing Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>TD[8-15] </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Data&#8212;least significant half of the </P>

<P>16-bit port. These signals are not used when connected to an 8-bit device. </P>
</TD>

<TD>
<P>Assertion of TD[8-15] is always done with a fixed relationship to TCLK0 and TCLK1 as defined in the AC section </P>
</TD>
</TR>

<TR>
<TD>
<P>TD[8-15] </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Data complement&#8212;This vector is the differential pair of TD[8-15] </P>
</TD>

<TD>
<P>Same as TD[8-15] </P>
</TD>
</TR>

<TR>
<TD>
<P>RCLK0 </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Clock&#8212;Free-running input clock for the </P>

<P>8-bit port and the most significant half of the </P>

<P>16-bit port. RCLK0 connects to TCLK0 of the transmitting device. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RCLK0 </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Clock complement&#8212;This signal is the differential pair of the RCLK signal. RCLK0 connects to TCLK0 of the transmitting device. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RD[0-7] </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Data&#8212;The Receive data is a unidirectional packet data input bus. It is connected to the TD bus of the transmitting device. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RD[0-7] </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Data complement&#8212;This vector is the differential pair of the RD vector. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RFRAME </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Frame&#8212;This control signal indicates a special packet framing event on the RD pins. </P>
</TD>

<TD>
<P>RFRAME is sampled with respect to </P>

<P>RCLK0 </P>
</TD>
</TR>

<TR>
<TD>
<P>RFRAME </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Frame complement&#8212;This signal is the differential pair of the RFRAME signal. </P>
</TD>

<TD>
<P>Same as RFRAME </P>
</TD>
</TR>

<TR>
<TD>
<P>RCLK1 </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Clock&#8212;Free-running input clock for the least significant half of the 16-bit port </P>

<P>(RD[8-15]). RCLK1 connects to TCLK1 of the transmitting device. This signal is not used when connected to an 8-bit device. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RCLK1 </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Clock complement&#8212;This signal is the differential pair of the RCLK1 signal. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RD[8-15] </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Data&#8212;Least significant half of the </P>

<P>16-bit port. These signals are not used when connected to an 8-bit device. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RD[8-15] </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Data complement&#8212;This vector is the differential pair of the RD[8-15] vector. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>8.3 RapidIO Interface Diagrams </P>

<P> </P>

<P>Figure 8-1 shows the signal interface diagram connecting two 8-bit devices together with the RapidIO 8/16 LP-LVDS interconnect. </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P>DEVICE B </P>

<P> </P>

<P>RCLK0 </P>

<P>RCLK0 </P>

<P>RFRAME RFRAME RD[0&#8211;7] RD[0&#8211;7] </P>

<P> </P>

<P>TCLK0 </P>

<P>TCLK0 </P>

<P>TFRAME TFRAME TD[0&#8211;7] TD[0&#8211;7] </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>
</Table>

<P> </P>
</Textbox>

<P>DEVICE A </P>

<P> </P>

<P>TCLK0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_514.jpg"/>
</Figure>

<P>TCLK0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_515.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_516.jpg"/>
</Figure>

<P>TFRAME TFRAME TD[0&#8211;7] TD[0&#8211;7] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_517.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_518.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_519.jpg"/>
</Figure>

<P> </P>

<P>RCLK0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_520.jpg"/>
</Figure>

<P>RCLK0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_521.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_522.jpg"/>
</Figure>

<P>RFRAME RFRAME RD[0&#8211;7] RD[0&#8211;7] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_523.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_524.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_525.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_526.jpg"/>
</Figure>

<P>Figure 8-1. RapidIO 8-bit Device to 8-bit Device Interface Diagram </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_527.jpg"/>
</Figure>

<P>Figure 8-2 shows the connections between an 8-bit wide 8/16 LP-LVDS device and a 16-bit wide device. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_528.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_529.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_530.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_531.jpg"/>
</Figure>

<P>N.C. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_532.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_533.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_534.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_535.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_536.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_537.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_538.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_539.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_540.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_541.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_542.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_543.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_544.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_545.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_546.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_547.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_548.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_549.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_550.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_551.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_552.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_553.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_554.jpg"/>
</Figure>

<P>Figure 8-2. RapidIO 8-bit Device to 16-bit Device Interface Diagram </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_555.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_556.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_557.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_558.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_559.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_560.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_561.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_562.jpg"/>
</Figure>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P>DEVICE A </P>

<P> </P>

<P>TCLK0 </P>

<P>TCLK0 </P>

<P>TFRAME TFRAME TD[0&#8211;7] TD[0&#8211;7] TCLK1 </P>

<P>TCLK1 </P>

<P>TD[8-15] TD[8-15] </P>

<P> </P>

<P>RCLK0 </P>

<P>RCLK0 </P>

<P>RFRAME RFRAME RD[0&#8211;7] RD[0&#8211;7] RCLK1 </P>

<P>RCLK1 </P>

<P>RD[8-15] RD[8-15] </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>
</Table>

<P> </P>
</Textbox>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P>DEVICE B </P>

<P> </P>

<P>RCLK0 </P>

<P>RCLK0 </P>

<P>RFRAME RFRAME RD[0&#8211;7] RD[0&#8211;7] </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>TCLK0 </P>

<P>TCLK0 </P>

<P>TFRAME TFRAME TD[0&#8211;7] TD[0&#8211;7] </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>

<P> </P>

<P>N.C. </P>
</TD>

<TD/>
</TR>
</Table>

<P> </P>
</Textbox>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_563.jpg"/>
</Figure>

<P>Figure 8-3 shows the connections between two 16-bit wide 8/16 LP-LVDS devices. </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P>DEVICE B </P>

<P> </P>

<P>RCLK0 </P>

<P>RCLK0 </P>

<P>RFRAME RFRAME RD[0&#8211;7] RD[0&#8211;7] RCLK1 </P>

<P>RCLK1 </P>

<P>RD[8-15] RD[8-15] </P>

<P> </P>

<P>TCLK0 </P>

<P>TCLK0 </P>

<P>TFRAME TFRAME TD[0&#8211;7] TD[0&#8211;7] TCLK1 </P>

<P>TCLK1 </P>

<P>TD[8-15] TD[8-15] </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>
</TR>
</Table>

<P> </P>
</Textbox>

<P>DEVICE A </P>

<P> </P>

<P>TCLK0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_564.jpg"/>
</Figure>

<P>TCLK0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_565.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_566.jpg"/>
</Figure>

<P>TFRAME TFRAME TD[0&#8211;7] TD[0&#8211;7] TCLK1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_567.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_568.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_569.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_570.jpg"/>
</Figure>

<P>TCLK1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_571.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_572.jpg"/>
</Figure>

<P>TD[8-15] TD[8-15] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_573.jpg"/>
</Figure>

<P> </P>

<P>RCLK0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_574.jpg"/>
</Figure>

<P>RCLK0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_575.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_576.jpg"/>
</Figure>

<P>RFRAME RFRAME RD[0&#8211;7] RD[0&#8211;7] RCLK1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_577.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_578.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_579.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_580.jpg"/>
</Figure>

<P>RCLK1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_581.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_582.jpg"/>
</Figure>

<P>RD[8-15] RD[8-15] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_583.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Figure 8-3. RapidIO 16-bit Device to 16-bit Device Interface Diagram </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 9 Electrical Specifications </P>

<P> </P>

<P> </P>

<P>9.1 Introduction </P>

<P> </P>

<P>This chapter contains the driver and receiver AC and DC electrical specifications for a RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification compliant device. The interface defined is a parallel differential low-power high-speed signal interface. </P>

<P> </P>

<P> </P>

<P>9.2 Overview </P>

<P> </P>

<P>To allow more general compatibility with a variety of silicon solutions, the RapidIO parallel interface builds on the low voltage differential signaling (LVDS) standard. For reference refer to ANSI/TIA/EIA-644-A, Electrical Characteristics of Low Voltage Differential Signaling (LVDS) Interface Circuits. The goal of the interface is to allow two devices to communicate with each other within a monolithic system, and key factors in choosing an interface are electrical performance, power consumption (both at the end point and in the switch fabric), signal robustness, circuit complexity, pin count, future scalability, and industry acceptance. LVDS satisfies these requirements. </P>

<P> </P>

<P>Although differential signaling requires twice as many signals as single-ended signaling, the total pin count including power and ground pins for high-speed differential and single-ended interfaces are more comparable. Single-ended interfaces  require  large  numbers  of  power  and  ground  pins  to  provide  a low-impedance AC  return  path.  Since  LVDS  uses  constant-current drivers,  a low-impedance AC return path is not needed, allowing for a dramatic reduction in the   number   of   power   and   ground   pins   dedicated  to   the   interface.  The constant-current drivers also generate very small switching transients leading to lower noise and lower EMI. Differential signaling is also not as susceptible to imperfections in transmission lines and connectors. </P>

<P> </P>

<P>LVDS provides for a low-voltage swing (less than 1 Volt), process independent, point-to-point differential interface. The intent of this signaling specification is for device-to-device and board-to-board applications, but it may not be suitable for cable applications owing to the stringent signal-to-signal skew requirements. </P>

<P> </P>

<P>LVDS is an end point self-terminated interface. It is assumed that each receiver provides its own termination resistors. LVDS can tolerate ground potential differences between transmitter and receiver of +/- 1V. </P>

<P> </P>

<P>RapidIO Trade Association 131 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>9.3 DC Specifications </P>

<P> </P>

<P>RapidIO driver and receiver DC specifications are displayed in Table 9-1 and </P>

<P>Table 9-2. Power variation is +/- 5%. Resistor tolerances are +/- 1%. </P>

<P> </P>

<P>Table 9-1. RapidIO 8/16 LP-LVDS Driver Specifications (DC) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Unit </P>
</TD>

<TD>
<P>Notes </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential output high voltage </P>
</TD>

<TD>
<P>VOHD </P>
</TD>

<TD>
<P>247 </P>
</TD>

<TD>
<P>454 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>Bridged 100&#61527; load </P>

<P>See Figure 9-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential output low voltage </P>
</TD>

<TD>
<P>VOLD </P>
</TD>

<TD>
<P>-454 </P>
</TD>

<TD>
<P>-247 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>Bridged 100&#61527; load </P>

<P>See Figure 9-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential offset voltage </P>
</TD>

<TD>
<P>&#61508;VOD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>50 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>Bridged 100&#61527; load </P>

<P>|VOHD+VOLD|. See </P>

<P>Figure 9-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Output high common mode voltage </P>
</TD>

<TD>
<P>VOSH </P>
</TD>

<TD>
<P>1.125 </P>
</TD>

<TD>
<P>1.375 </P>
</TD>

<TD>
<P>V </P>
</TD>

<TD>
<P>Bridged 100&#61527; load </P>
</TD>
</TR>

<TR>
<TD>
<P>Output low common mode voltage </P>
</TD>

<TD>
<P>VOSL </P>
</TD>

<TD>
<P>1.125 </P>
</TD>

<TD>
<P>1.375 </P>
</TD>

<TD>
<P>V </P>
</TD>

<TD>
<P>Bridged 100&#61527; load </P>
</TD>
</TR>

<TR>
<TD>
<P>Common mode offset voltage </P>
</TD>

<TD>
<P>&#61508;VOS </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>50 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>Bridged 100&#61527; load </P>

<P>|VOSH-VOSL|. See </P>

<P>Figure 9-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Short circuit current </P>

<P>(either output) </P>
</TD>

<TD>
<P>|ISS| </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>24 </P>
</TD>

<TD>
<P>mA </P>
</TD>

<TD>
<P>Outputs shorted to VDD </P>

<P>or VSS </P>
</TD>
</TR>

<TR>
<TD>
<P>Bridged short circuit current </P>
</TD>

<TD>
<P>|ISB| </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>mA </P>
</TD>

<TD>
<P>Outputs shorted together </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P>Table 9-2. RapidIO 8/16 LP-LVDS Receiver Specifications (DC) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Unit </P>
</TD>

<TD>
<P>Notes </P>
</TD>
</TR>

<TR>
<TD>
<P>Voltage at either input </P>
</TD>

<TD>
<P>VI </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>2.4 </P>
</TD>

<TD>
<P>V </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential input high voltage </P>
</TD>

<TD>
<P>VIHD </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>600 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>Over the common mode range </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential input low voltage </P>
</TD>

<TD>
<P>VILD </P>
</TD>

<TD>
<P>-600 </P>
</TD>

<TD>
<P>-100 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>Over the common mode range </P>
</TD>
</TR>

<TR>
<TD>
<P>Common mode input range </P>

<P>(referenced to receiver ground) </P>
</TD>

<TD>
<P>VIS </P>
</TD>

<TD>
<P>0.050 </P>
</TD>

<TD>
<P>2.350 </P>
</TD>

<TD>
<P>V </P>
</TD>

<TD>
<P>Limited by VI </P>
</TD>
</TR>

<TR>
<TD>
<P>Input differential resistance </P>
</TD>

<TD>
<P>RIN </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>

<TD>
<P>For on-chip termina- tion.1 </P>
</TD>
</TR>
</Table>

<P>1Off-chip termination value and tolerance is vendor defined consistant with the return loss specification. </P>

<P>Receiver input impedance shall exhibit a differential return loss better than 10 dB from DC to (1.6 * AC Clock Frequency). The differential return loss must measured at and include effects due to the receiver itself, associated circuitry such as ESD structures, chip packaging, and any external termination structures related to the receiver. The reference impedance for measurement is 100 ohms. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>DC driver signal levels are displayed in Figure 9-1. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_584.jpg"/>
</Figure>

<P>Voa </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Vob </P>

<P> </P>

<P>(a) </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_585.jpg"/>
</Figure>

<P>RTERM </P>

<P>100&#61527; V Vod = Voa - Vob </P>

<P>(nom) </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_586.jpg"/>
</Figure>

<P>Vod = Voa - Vob </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_587.jpg"/>
</Figure>

<P>v </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_588.jpg"/>
</Figure>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_589.jpg"/>
</Figure>

<P>454mV </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_590.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_591.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_592.jpg"/>
</Figure>

<P>247mV </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_593.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_594.jpg"/>
</Figure>

<P>VOHD </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_595.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_596.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_597.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_598.jpg"/>
</Figure>

<P>Vos = (Voa + Vob)/2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_599.jpg"/>
</Figure>

<P>VOSH </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_600.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_601.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_602.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_603.jpg"/>
</Figure>

<P>or </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_604.jpg"/>
</Figure>

<P>VOSL                      </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_605.jpg"/>
</Figure>

<P>1.375V </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_606.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_607.jpg"/>
</Figure>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_608.jpg"/>
</Figure>

<P>1.125V </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_609.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_610.jpg"/>
</Figure>

<P> </P>

<P>&#61508;VOS </P>

<P> </P>

<P> </P>

<P> </P>

<P>-v+&#61508;Vod </P>

<P>   -247mV </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_611.jpg"/>
</Figure>

<P>-v </P>

<P>-v-&#61508;V </P>

<P>                  VOLD  0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_612.jpg"/>
</Figure>

<P>od </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_613.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_614.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_615.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_616.jpg"/>
</Figure>

<P>-454mV </P>

<P> </P>

<P>Differential Specification Common-mode Specifications </P>

<P> </P>

<P>(b) </P>

<P> </P>

<P>(c) </P>

<P> </P>

<P>Figure 9-1. DC driver signal levels </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>9.4 AC Specifications </P>

<P> </P>

<P>This section contains the AC electrical specifications for a RapidIO 8/16 LP-LVDS interface. The interface defined is a parallel differential low-power high-speed signal interface. RapidIO specifies operation at specific nominal frequencies only. Correct operation at other frequencies is not implied, even if the frequency is lower than the specified frequency. </P>

<P> </P>

<P> </P>

<P>9.4.1  Concepts and Definitions </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_617.jpg"/>
</Figure>

<P>This section specifies signals using differential voltages. Figure 9-2 shows how the signals are defined. The figure shows waveforms for either a transmitter output (TD and TD) or a receiver input (RD and RD). Each signal swings between A volts and B volts where A &gt; B. Using these waveforms, the definitions are as follows: </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_618.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_619.jpg"/>
</Figure>

<P>1. The transmitter output and receiver input signals TD, TD, RD and RD each have a peak-to-peak swing of A-B Volts. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_620.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_621.jpg"/>
</Figure>

<P>2. The differential output signal of the transmitter, VOD, is defined as VTD-VTD. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_622.jpg"/>
</Figure>

<P>3. The differential input signal of the receiver, VID, is defined as VRD-VRD. </P>

<P>4. The differential output signal of the transmitter, or input signal of the receiver, ranges from A - B Volts to -(A - B) Volts. </P>

<P>5. The peak differential signal of the transmitter output, or receiver input, is A - B Volts. </P>

<P>6. The peak to peak differential signal of the transmitter output, or receiver input, is 2*(A - B) Volts. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_623.jpg"/>
</Figure>

<P>A Volts  TD or RD </P>

<P> </P>

<P> </P>

<P> </P>

<P>B Volts </P>

<P>TD or RD </P>

<P> </P>

<P> </P>

<P>Figure 9-2. Differential Peak-Peak Voltage of Transmitter or Receiver </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_624.jpg"/>
</Figure>

<P>To illustrate these definitions using numerical values, consider the case where a LVDS transmitter has a common mode voltage of 1.2V and each signal has a swing that goes between 1.4V and 1.0V. Using these values, the peak-to-peak voltage swing of the signals TD, TD, RD and RD is 400 mV. The differential signal ranges between 400mV and -400mV. The peak differential signal is 400mV, and the peak to peak differential signal is 800mV. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_625.jpg"/>
</Figure>

<P> </P>

<P>A timing edge is the zero-crossing of a differential signal. Each skew timing parameter on a parallel bus is synchronously measured on two signals relative to each other in the same cycle, such as data to data, data to clock, or clock to clock. A skew timing parameter may be relative to the edge of a signal or to the middle of two </P>

<P> </P>

<P>134 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>sequential edges. </P>

<P> </P>

<P>Static skew represents the timing difference between signals that does not vary over time regardless of system activity or data pattern. Path length differences are a primary source of static skew. </P>

<P> </P>

<P>Dynamic skew represents the amount of timing difference between signals that is dependent on the activity of other signals and varies over time. Crosstalk between signals is a source of dynamic skew. </P>

<P> </P>

<P>Eye diagrams and compliance masks are a useful way to visualize and specify driver and receiver performance. This technique is used in several serial bus specifications. An example compliance mask is shown in Figure 9-3. The key difference in the application of this technique for a parallel bus is that the data is source synchronous to its bus clock while serial data is referenced to its embedded clock. Eye diagrams reveal the quality (&#8220;cleanness&#8221;, &#8220;openness&#8221;, &#8220;goodness&#8221;) of a driver output or receiver input. An advantage of using an eye diagram and a compliance mask is that it allows specifying the quality of a signal without requiring separate specifications for effects such as rise time, duty cycle distortion, data dependent dynamic skew, random dynamic skew, etc. This allows the individual semiconductor manufacturer maximum flexibility to trade off various performance criteria while keeping the system performance constant. </P>

<P> </P>

<P>In using the eye pattern and compliance mask approach, the quality of the signal is specified by the compliance mask. The mask specifies the maximum permissible magnitude of the signal and the minimum permissible eye opening. The eye diagram for the signal under test is generated according to the specification. Compliance is determined by whether the compliance mask can be positioned over the eye diagram such that the eye pattern falls entirely within the unshaded portion of the mask. </P>

<P> </P>

<P>Serial specifications have clock encoded with the data, but the LP-LVDS physical layer defined by RapidIO is a source synchronous parallel port so additional specifications to include effects that are not found in serial links are required. Specifications for the effect of bit to bit timing differences caused by static skew have been added and the eye diagrams specified are measured relative to the associated clock in order to include clock to data effects. With the transmit output (or receiver input) eye diagram, the user can determine if the transmitter output (or receiver input) is compliant with an oscilloscope with the appropriate software. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_626.jpg"/>
</Figure>

<P>Z </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Y </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_627.jpg"/>
</Figure>

<P>0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_628.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_629.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_630.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_631.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_632.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_633.jpg"/>
</Figure>

<Textbox>
<P>Volts Differential </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P>-Y </P>

<P> </P>

<P> </P>

<P>DV </P>

<P> </P>

<P>-Z </P>

<P> </P>

<P> </P>

<P>0 X1 X2 </P>

<P> </P>

<P>Time in UI </P>

<P>1-X2 1-X1 1 </P>

<P> </P>

<P>Figure 9-3. Example Compliance Mask </P>

<P> </P>

<P>Y = Minimum data valid amplitude </P>

<P>Z = Maximum amplitude </P>

<P>1 UI = 1 Unit Interval = 1/Baud rate </P>

<P>X1 = End of zero crossing region </P>

<P>X2 = Beginning of Data Valid window </P>

<P>DV = Data Valid window = 1 - 2*X2 </P>

<P> </P>

<P>The waveform of the signal under test must fall within the unshaded area of the mask to be compliant. Different masks are used for the driver output and the receiver input allowing each to be separately specified. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>9.4.2  Driver Specifications </P>

<P> </P>

<P>Driver AC timing specifications are given in Table 9-3 through Table 9-7 below. A driver shall comply with the specifications for each data rate/frequency for which operation of the driver is specified. Unless otherwise specified, these specifications are subject to the following conditions. </P>

<P> </P>

<P>The specifications apply over the supply voltage and ambient temperature ranges specified by the device vendor. </P>

<P>The specifications apply for any combination of data patterns on the data signals. The output of a driver shall be connected to a 100 Ohm, +/- 1%, differential </P>

<P>(bridged) resistive load. </P>

<P>Clock specifications apply only to clock signals (CLK0 and, if present, CLK1). Data  specifications apply only to data signals (FRAME, D[0-7], and, if present, </P>

<P>D[8-15]). </P>

<P> </P>

<P>FRAME and D[0-7] are the data signals associated with CLK0, D[8-5] are the data signals associated with CLK1. </P>

<P> </P>

<P>Driver DC termination is not specified (in accordance with TIA/EIA-644-A), but is recommended for devices targeting higher data rates. This termination is intended to reduce data reflections in the matched data interconnect. The value and location of this termination and the methods of test and measurement are left to the individual vendor. </P>

<P> </P>

<P> </P>

<P>Table 9-3. Driver AC Timing Specifications - 500Mbps Data Rate/250MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Differential output high voltage </P>
</TD>

<TD>
<P>VOHD </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P>540 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential output low voltage </P>
</TD>

<TD>
<P>VOLD </P>
</TD>

<TD>
<P>-540 </P>
</TD>

<TD>
<P>-200 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Unit interval </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>2000 </P>
</TD>

<TD>
<P>2000 </P>
</TD>

<TD>
<P>ps </P>
</TD>

<TD>
<P>Requires +/-100ppm long term frequency stability </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock output </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>48 </P>
</TD>

<TD>
<P>52 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VOD=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD fall time, 20-80% of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tFALL </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD rise time, 20-80%of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tRISE </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.63 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Transmit Mask shown in Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data outputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.09 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 9-3. Driver AC Timing Specifications - 500Mbps Data Rate/250MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Allowable static skew of data outputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.09 </P>
</TD>

<TD>
<P>.09 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.09 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>Table 9-4. Driver AC Timing Specifications - 750Mbps Data Rate/375MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Differential output high voltage </P>
</TD>

<TD>
<P>VOHD </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P>540 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential output low voltage </P>
</TD>

<TD>
<P>VOLD </P>
</TD>

<TD>
<P>-540 </P>
</TD>

<TD>
<P>-200 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Unit interval </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1333 </P>
</TD>

<TD>
<P>1333 </P>
</TD>

<TD>
<P>ps </P>
</TD>

<TD>
<P>Requires +/-100ppm long term frequency stability </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock output </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>48 </P>
</TD>

<TD>
<P>52 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VOD=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD fall time, 20-80% of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tFALL </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD rise time, 20-80%of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tRISE </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Transmit Mask shown in Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data outputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data outputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.1 </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>Table 9-5. Driver AC Timing Specifications - 1000Mbps Data Rate/500MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Differential output high voltage </P>
</TD>

<TD>
<P>VOHD </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P>540 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential output low voltage </P>
</TD>

<TD>
<P>VOLD </P>
</TD>

<TD>
<P>-540 </P>
</TD>

<TD>
<P>-200 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Unit interval </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1000 </P>
</TD>

<TD>
<P>1000 </P>
</TD>

<TD>
<P>ps </P>
</TD>

<TD>
<P>Requires +/-100ppm long term frequency stability </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock output </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>48 </P>
</TD>

<TD>
<P>52 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VOD=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD fall time, 20-80% of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tFALL </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 9-5. Driver AC Timing Specifications - 1000Mbps Data Rate/500MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>VOD rise time, 20-80%of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tRISE </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.575 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Transmit Mask shown in Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data outputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data outputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.1 </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>Table 9-6. Driver AC Timing Specifications - 1500Mbps Data Rate/750MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Differential output high voltage </P>
</TD>

<TD>
<P>VOHD </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P>540 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential output low voltage </P>
</TD>

<TD>
<P>VOLD </P>
</TD>

<TD>
<P>-540 </P>
</TD>

<TD>
<P>-200 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Unit interval </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>667 </P>
</TD>

<TD>
<P>667 </P>
</TD>

<TD>
<P>ps </P>
</TD>

<TD>
<P>Requires +/-100ppm long term frequency stability </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock output </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>48 </P>
</TD>

<TD>
<P>52 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VOD=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD fall time, 20-80% of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tFALL </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD rise time, 20-80% of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tRISE </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.525 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Transmit Mask shown in Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data outputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data outputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.2 </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table 9-7. Driver AC Timing Specifications - 2000Mbps Data Rate/1000MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Differential output high voltage </P>
</TD>

<TD>
<P>VOHD </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P>540 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential output low voltage </P>
</TD>

<TD>
<P>VOLD </P>
</TD>

<TD>
<P>-540 </P>
</TD>

<TD>
<P>-200 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>See Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Unit interval </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>500 </P>
</TD>

<TD>
<P>500 </P>
</TD>

<TD>
<P>ps </P>
</TD>

<TD>
<P>Requires +/-100ppm long term frequency stability </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock output </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>48 </P>
</TD>

<TD>
<P>52 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VOD=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD fall time, 20-80% of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tFALL </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>VOD rise time, 20-80% of the peak to peak differential signal swing </P>
</TD>

<TD>
<P>tRISE </P>
</TD>

<TD>
<P>.1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.5 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Transmit Mask shown in Figure 9-4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data outputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data outputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.2 </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The compliance of driver output signals TD[0-15] and TFRAME with their minimum Data Valid window (DV) specification shall be determined by generating an eye pattern for each of the data signals and comparing the eye pattern of each data signal with the RapidIO Transmit Mask shown in Figure 9-4. The value of X2 used to construct the mask shall be (1 - DVmin)/2. A signal is compliant with the Data Valid window specification if and only if the Transmit Mask can be positioned on the signal&#8217;s eye pattern such that the eye pattern falls entirely within the unshaded portion of the mask. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_634.jpg"/>
</Figure>

<P>VOHDmax </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_635.jpg"/>
</Figure>

<P>VOHDmin </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_636.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_637.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_638.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_639.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_640.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_641.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_642.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_643.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_644.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_645.jpg"/>
</Figure>

<P>0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_646.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_647.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_648.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_649.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_650.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_651.jpg"/>
</Figure>

<Textbox>
<P>VOD in mV </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_652.jpg"/>
</Figure>

<P>VOLDmax </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_653.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_654.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_655.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_656.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_657.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_658.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_659.jpg"/>
</Figure>

<P>DV </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_660.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_661.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_662.jpg"/>
</Figure>

<P> </P>

<P>VOLDmin </P>

<P> </P>

<P> </P>

<P>0 X2 </P>

<P>Time in UI </P>

<P>1-X2 1 </P>

<P> </P>

<P>Figure 9-4. RapidIO Transmit Mask </P>

<P> </P>

<P>The eye pattern for a data signal is generated by making a large number of recordings of the signal and then overlaying the recordings. The number of recordings used to generate the eye shall be large enough that further increasing the number of recordings used does not cause the resulting eye pattern to change from one that complies with the RapidIO Transmit Mask to one that does not. Each data signal in the interface shall be carrying random or pseudo-random data when the recordings  are  made.  If   pseudo-random  data  is   used,  the  length  of  the pseudo-random sequence (repeat length) shall be long enough that increasing the length of the sequence does not cause the resulting eye pattern to change from one that complies with the RapidIO Transmit Mask to one that does not comply with the mask. The data carried by any given data signal in the interface may not be correlated with the data carried by any other data signal in the interface. The zero-crossings of the clock associated with a data signal shall be used as the timing reference for aligning the multiple recordings of the data signal when the recordings are overlaid. </P>

<P> </P>

<P>While the method used to make the recordings and overlay them to form the eye pattern is not specified, the method used shall be demonstrably equivalent to the following method. The signal under test is repeatedly recorded with a digital oscilloscope  in  infinite  persistence  mode.  Each  recording  is  triggered  by  a zero-crossing of the clock associated with the data signal under test. Roughly half of the recordings are triggered by positive-going clock zero-crossings and roughly half are triggered by negative-going clock zero-crossings. Each recording is at least 1.9 </P>

<P>UI in length (to ensure that at least one complete eye is formed) and begins 0.5 UI </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>before the trigger point (0.5 UI before the associated clock zero-crossing). Depending on the length of the individual recordings used to generate the eye pattern, one or more complete eyes will be formed. Regardless of the number of eyes, the eye whose center is immediately to the right of the trigger point is the eye used for compliance testing. </P>

<P> </P>

<P>An example of an eye pattern generated using the above method with recordings 3 </P>

<P>UI in length is shown in Figure 9-5. In this example, there is no skew between the signal under test and the associated clock used to trigger the recordings. If skew was present, the eye pattern would be shifted to the left or right relative to the oscilloscope trigger point. </P>

<P> </P>

<P>. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_663.jpg"/>
</Figure>

<P>0.5 UI </P>

<P>1 UI 1 UI </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+ VOD  0 </P>

<P>- </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_664.jpg"/>
</Figure>

<P>Oscilloscope (recording) trigger point </P>

<P>Eye used for compliance testing </P>

<P> </P>

<P>Eye patterm </P>

<P> </P>

<P> </P>

<P>Figure 9-5. Example Driver Output Eye Pattern </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>9.4.3  Receiver Specifications </P>

<P> </P>

<P>Receiver AC timing specifications are given in Table 9-8 through Table 9-12 below. A receiver shall comply with the specifications for each data rate/frequency for which operation of the receiver is specified. Unless otherwise specified, these specifications are subject to the following conditions. </P>

<P> </P>

<P>The specifications apply over the supply voltage and ambient temperature ranges specified by the device vendor. </P>

<P>The specifications apply for any combination of data patterns on the data signals. The specifications apply over the receiver common mode and differential input </P>

<P>voltage ranges. </P>

<P>Clock specifications apply only to clock signals (CLK0 and, if present, CLK1). Data  specifications apply only to data signals (FRAME, D[0-7], and, if present, </P>

<P>D[8-15]). </P>

<P> </P>

<P>FRAME and D[0-7] are the data signals associated with CLK0, D[8-5] are the data signals associated with CLK1. </P>

<P> </P>

<P> </P>

<P>Table 9-8. Receiver AC Timing Specifications - 500Mbps Data Rate/250MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock input </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>47 </P>
</TD>

<TD>
<P>53 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VID=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.54 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Receive Mask shown in Figure 9-6 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data inputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.19 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data inputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.15 </P>
</TD>

<TD>
<P>.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.14 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>Table 9-9. Receiver AC Timing Specifications - 750Mbps Data Rate/375MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock input </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>47 </P>
</TD>

<TD>
<P>53 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VID=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.45 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Receive Mask shown in Figure 9-6 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 9-9. Receiver AC Timing Specifications - 750Mbps Data Rate/375MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data inputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data inputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.2 </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>Table 9-10. Receiver AC Timing Specifications - 1000Mbps Data Rate/500MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock input </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>47 </P>
</TD>

<TD>
<P>53 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VID=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.425 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Receive Mask shown in Figure 9-6 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data inputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data inputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.2 </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.2 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>Table 9-11. Receiver AC Timing Specifications - 1500Mbps Data Rate/750MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock input </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>47 </P>
</TD>

<TD>
<P>53 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VID=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.375 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Receive Mask shown in Figure 9-6 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data inputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.4 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data inputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.25 </P>
</TD>

<TD>
<P>.25 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table 9-12. Receiver AC Timing Specifications - 2000Mbps Data Rate/1000MHz Clock Rate </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristic </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Range </P>
</TD>

<TD>
<P> </P>

<P>Unit </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>Duty cycle of the clock input </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>47 </P>
</TD>

<TD>
<P>53 </P>
</TD>

<TD>
<P>% </P>
</TD>

<TD>
<P>Measured at VID=0V </P>
</TD>
</TR>

<TR>
<TD>
<P>Data Valid </P>
</TD>

<TD>
<P>DV </P>
</TD>

<TD>
<P>.35 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>Measured using the RapidIO Receive Mask shown in Figure 9-6 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew between any two data inputs within a 8 bit/9 bit group </P>
</TD>

<TD>
<P>tDPAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.4 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Allowable static skew of data inputs to associated clock </P>
</TD>

<TD>
<P>tSKEW,PAIR </P>
</TD>

<TD>
<P>-.25 </P>
</TD>

<TD>
<P>.25 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-8, Figure 9-10 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock static skew </P>
</TD>

<TD>
<P>tCSKEW, PAIR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock to clock dynamic skew </P>
</TD>

<TD>
<P>tCSKEW, PAIRD </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>.3 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P>See Figure 9-9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The compliance of receiver input signals RD[0-15] and RFRAME with their minimum Data Valid window (DV) specification shall be determined by generating an eye pattern for each of the data signals and comparing the eye pattern of each data signal with the RapidIO Receive Mask shown in Figure 9-6. The value of X2 used to construct the mask shall be (1 - DVmin)/2. The +/- 100mV minimum data valid and +/- 600mV maximum input voltage values are from the DC specification. A signal is compliant with the Data Valid window specification if and only if the Receive Mask can be positioned on the signal&#8217;s eye pattern such that the eye pattern falls entirely within the unshaded portion of the mask. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_665.jpg"/>
</Figure>

<P>600 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>100 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_666.jpg"/>
</Figure>

<P>0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_667.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_668.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_669.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_670.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_671.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_672.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_673.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_674.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_675.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_676.jpg"/>
</Figure>

<Textbox>
<P>VID in mV </P>
</Textbox>

<P> </P>

<P>-100 </P>

<P> </P>

<P> </P>

<P>DV </P>

<P> </P>

<P> </P>

<P>-600 </P>

<P> </P>

<P> </P>

<P>0 X2 1-X2 1 </P>

<P>Time in UI </P>

<P> </P>

<P>Figure 9-6. RapidIO Receive Mask </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 145 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The eye pattern for a data signal is generated by making a large number of recordings of the signal and then overlaying the recordings. The number of recordings used to generate the eye shall be large enough that further increasing the number of recordings used does not cause the resulting eye pattern to change from one that complies with the RapidIO Receive Mask to one that does not. Each data signal in the interface shall be carrying random or pseudo-random data when the recordings  are  made.  If   pseudo-random  data  is   used,  the  length  of  the pseudo-random sequence (repeat length) shall be long enough that increasing the length of the sequence does not cause the resulting eye pattern to change from one that complies with the RapidIO Receive Mask to one that does not comply with the mask. The data carried by any given data signal in the interface may not be correlated with the data carried by any other data signal in the interface. The zero-crossings of the clock associated with a data signal shall be used as the timing reference for aligning the multiple recordings of the data signal when the recordings are overlaid. </P>

<P> </P>

<P>While the method used to make the recordings and overlay them to form the eye pattern is not specified, the method used shall be demonstrably equivalent to the following method. The signal under test is repeatedly recorded with a digital oscilloscope  in  infinite  persistence  mode.  Each  recording  is  triggered  by  a zero-crossing of the clock associated with the data signal under test. Roughly half of the recordings are triggered by positive-going clock zero-crossings and roughly half are triggered by negative-going clock zero-crossings. Each recording is at least 1.9 </P>

<P>UI in length (to ensure that at least one complete eye is formed) and begins 0.5 UI before the trigger point (0.5 UI before the associated clock zero-crossing). Depending on the length of the individual recordings used to generate the eye pattern, one or more complete eyes will be formed. Regardless of the number of eyes, the eye whose center is immediately to the right of the trigger point is the eye used for compliance testing. </P>

<P> </P>

<P>An example of an eye pattern generated using the above method with recordings 3 </P>

<P>UI in length is shown in Figure 9-7. In this example, there is no skew between the signal under test and the associated clock used to trigger the recordings. If skew was present, the eye pattern would be shifted to the left or right relative to the oscilloscope trigger point. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_677.jpg"/>
</Figure>

<P>0.5 UI </P>

<P>1 UI 1 UI </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+ </P>

<P> </P>

<P>VID   0 </P>

<P>- </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_678.jpg"/>
</Figure>

<P>Oscilloscope (recording) trigger point </P>

<P>Eye used for compliance testing </P>

<P> </P>

<P>Eye pattern </P>

<P> </P>

<P> </P>

<P>Figure 9-7. Example Receiver Input Eye Pattern </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Figure 9-8  shows  the  definitions  of  the  data  to  clock  static  skew  parameter tSKEW,PAIR  and the Data Valid window parameter DV. The data and frame bits are those that are associated with the clock. The figure applies for all zero-crossings of the clock. All of the signals are differential signals. VD  represents VOD  for the transmitter and VID for the receiver. The center of the eye is defined as the midpoint of the region in which the magnitude of the signal voltage is greater than or equal to the minimum DV voltage. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_679.jpg"/>
</Figure>

<P>VD clock x VD = 0V </P>

<P> </P>

<P>1 UI nominal </P>

<P> </P>

<P> </P>

<P>VD clock x              </P>

<P>VD = 0V </P>

<P> </P>

<P> </P>

<P>0.5 UI </P>

<P> </P>

<P>tSKEW,PAIR </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>D[0-7]/D[8-15], FRAME </P>

<P>0.5 DV 0.5 DV </P>

<P> </P>

<P> </P>

<P>eye opening </P>

<P> </P>

<P> </P>

<P>DV </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_680.jpg"/>
</Figure>

<P>VHDmin </P>

<P> </P>

<P> </P>

<P>VLDmax </P>

<P> </P>

<P>Figure 9-8. Data to Clock Skew </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Figure 9-9 shows the definitions of the clock to clock static skew parameter tCSKEW, PAIR and the clock to clock dynamic skew parameter tCSKEW,  PAIRD . All of the signals shown are differential signals. VD represents VOD for the transmitter and VID for the receiver. These two parameters, tCSKEW, PAIR and tCSKEW, PAIRD, only apply to 16 bit interfaces. </P>

<P> </P>

<P> </P>

<P>1 UI nominal </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_681.jpg"/>
</Figure>

<P>VD clock x VD = 0V </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_682.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_683.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_684.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_685.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_686.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_687.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_688.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_689.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_690.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_691.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_692.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_693.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_694.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_695.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_696.jpg"/>
</Figure>

<P> </P>

<P>tCSKEW, PAIR </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_697.jpg"/>
</Figure>

<P>VD clock y VD = 0V </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_698.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_699.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_700.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_701.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_702.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_703.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_704.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_705.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_706.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_707.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_708.jpg"/>
</Figure>

<P> </P>

<P>0.5 tCSKEW, PAIRD </P>

<P> </P>

<P> </P>

<P>tCSKEW, PAIRD </P>

<P> </P>

<P> </P>

<P>VD clock x VD = 0V </P>

<P> </P>

<P> </P>

<P>tCSKEW, PAIR </P>

<P> </P>

<P> </P>

<P>VD clock y VD = 0V </P>

<P> </P>

<P>0.5 tCSKEW, PAIRD </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_709.jpg"/>
</Figure>

<P>tCSKEW, PAIRD </P>

<P> </P>

<P> </P>

<P>Figure 9-9. Clock to Clock Skew </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Figure 9-10 shows the definition of the data to data static skew parameter tDPAIR and how the skew parameters are applied. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_710.jpg"/>
</Figure>

<P>center point for clock </P>

<P>1 UI nominal </P>

<P> </P>

<P>0.5 UI </P>

<P> </P>

<P>CLK0(CLK1) </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_711.jpg"/>
</Figure>

<P>center point of the data valid window of the earliest allowed data bit for data grouped late with respect to clock </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_712.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_713.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>FRAME, D[0-7](D[8-15]) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_714.jpg"/>
</Figure>

<P>tDPAIR </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_715.jpg"/>
</Figure>

<P>center point of the data valid window of the latest allowed data bit for data grouped </P>

<P>late with respect to clock </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_716.jpg"/>
</Figure>

<P>tSKEW,PAIR </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_717.jpg"/>
</Figure>

<P>center point of the data valid window of the earliest allowed data bit for data grouped early with respect to clock </P>

<P> </P>

<P>tSKEW,PAIR </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>FRAME, D[0-7]([D8-15]) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>tDPAIR </P>

<P>center point of the data valid window of the latest allowed data bit for data grouped </P>

<P>early with respect to clock </P>

<P> </P>

<P>Figure 9-10. Static Skew Diagram </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex A Interface Management (Informative) </P>

<P> </P>

<P> </P>

<P>A.1 Introduction </P>

<P> </P>

<P>This appendix contains state machine descriptions that illustrate a number of behaviors that are described in the RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification. They are included as examples and are believed to be correct, however, actual implementations should not use the examples directly. </P>

<P> </P>

<P> </P>

<P>A.2 Link Initialization and Maintenance Mechanism </P>

<P> </P>

<P>This section contains the link training and initialization state machine referred to in Section 3.7.1.1,  &#8220;Sampling  Window Alignment.&#8221;  Training  takes  place  in  two circumstances; when coming out of reset and after the loss of reliable input port sampling during system operation. </P>

<P> </P>

<P>Link initialization and maintenance actually requires two inter-dependent state machines in order to operate, one associated with the input port and the other with the output port. The two state machines work together to complete the link training. The state machines are intended for a device with an 8-bit port or a device with a </P>

<P>16-bit port. The port can only transition from the &#8220;Port Uninitialized&#8221; status to the &#8220;Port OK&#8221; status in the Port n Error and Status CSR when both halves of the state machine are in their OK state. </P>

<P> </P>

<P> </P>

<P>A.2.1  Input port training state machine </P>

<P> </P>

<P>Figure A-1 illustrates the input port training state machine. Error conditions are only detectable while in the &#8220;OK&#8221; states (OK and OK_maint_trn). The optional OK_maint_trn state, shaded in Figure A-1, is used to adjust the device input port sampling circuitry during system operation. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_718.jpg"/>
</Figure>

<P>1 </P>

<P> </P>

<P>reset </P>

<P> </P>

<P>2 </P>

<P>3 </P>

<P> </P>

<P>wait_good_pttn </P>

<P> </P>

<P>7 4 </P>

<P>5 </P>

<P> </P>

<P>wait_for_idle </P>

<P> </P>

<P>14 </P>

<P>6 </P>

<P>10 </P>

<P>8 OK </P>

<P> </P>

<P>12 9 </P>

<P>13 </P>

<P> </P>

<P>11 </P>

<P>OK_maint_trn </P>

<P> </P>

<P>Figure A-1. Input port training state machine </P>

<P> </P>

<P>Table A-1 describes the state transition arcs for Figure A-1. </P>

<P> </P>

<P>Table A-1. Input port training state machine transition table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>reset </P>
</TD>

<TD>
<P>reset </P>
</TD>

<TD>
<P>Start training condition not met. </P>
</TD>

<TD>
<P>Remain in the reset state until the start training condition is met. Typically, this is after reset has been applied to the device and all other necessary initialization activity has completed. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>reset </P>
</TD>

<TD>
<P>wait_good_pttn </P>
</TD>

<TD>
<P>Start training condition met. </P>
</TD>

<TD>
<P>This state is entered after all initialization activity has completed for the device. </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_good_pttn </P>
</TD>

<TD>
<P>wait_good_pttn </P>
</TD>

<TD>
<P>Wait for the sampling circuitry to indicate that it is calibrated. </P>
</TD>

<TD>
<P>Remain in this state until the sampling circuitry is calibrated. </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_good_pttn </P>
</TD>

<TD>
<P>wait_for_idle </P>
</TD>

<TD>
<P>Sampling circuitry is calibrated and the defined training pattern has been received. </P>
</TD>

<TD>
<P>Upon recognizing the defined training pattern, a 16-bit port can decide whether it&#8217;s output port needs to be downgraded to drive in 8-bit mode. Request the output port to start sending idle control symbols. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_idle </P>
</TD>

<TD>
<P>wait_for_idle </P>
</TD>

<TD>
<P>Remain in this state until an exit condition occurs. </P>
</TD>

<TD>
<P>In this state, only training patterns </P>

<P>and link-request/send-training control symbols are legal. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table A-1. Input port training state machine transition table (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>wait_for_idle </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>Idle control symbol has been received </P>
</TD>

<TD>
<P>This transition indicates that the input port is ready to start receiving packets and other control symbols. Due to input/link delays the input port may see an extra idle/training pattern sequence when finishing the alignment sequence. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>wait_for_idle </P>
</TD>

<TD>
<P>wait_good_pttn </P>
</TD>

<TD>
<P>The input port receives something besides a training pattern, idle, or link-request/send-training control symbol, or the sampling circuitry is no longer calibrated. </P>
</TD>

<TD>
<P>Receiving something unexpected or when the sampling circuitry is no longer able to reliably sample the device pins causes both the input port and output port to start restart the training sequence. </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>Sampling circuitry remains calibrated and is not drifting. </P>
</TD>

<TD>
<P>This is a functional state in which packets and control symbols can be accepted. Errors are also reported in this state. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>ready_maint_trn </P>
</TD>

<TD>
<P>Sampling circuitry drift. </P>
</TD>

<TD>
<P>This transition takes place when the sampling circuitry can still reliably sample the device pins, but adjustment is required to prevent eventual loss of calibration. </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>wait_good_pttn </P>
</TD>

<TD>
<P>Sampling circuitry is no longer calibrated. </P>
</TD>

<TD>
<P>Both the input port and output port restart the training sequence when the sampling circuitry is no longer able to reliably sample the device pins. This error invokes the error recovery algorithm when the OK state is </P>

<P>re-entered to attempt to recover possible lost data. </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>OK_maint_trn </P>
</TD>

<TD>
<P>OK_maint_trn </P>
</TD>

<TD>
<P>Training patterns have not been received, and the sampling circuitry is still calibrated. </P>
</TD>

<TD>
<P>This is a functional state in which packets and control symbols can be accepted. Errors are also reported in this state. In this state, the device adjusts the sampling circuitry when the training patterns are received. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>OK_maint_trn </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>The complete sequence of 256 training patterns followed by an idle has been received and the sampling circuitry is still calibrated. </P>
</TD>

<TD>
<P>Sampling circuitry has been adjusted. </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>OK_maint_trn </P>
</TD>

<TD>
<P>wait_good_pttn </P>
</TD>

<TD>
<P>Sampling circuitry is no longer calibrated. </P>
</TD>

<TD>
<P>Both the input port and output port restart the alignment sequence when the sampling circuitry is no longer able to reliably sample the device pins. This error invokes the error recovery algorithm when the ready state is re-entered to attempt to recover possible lost data. </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>wait_for_idle </P>
</TD>

<TD>
<P>The input port receives a </P>

<P>link-request/send-training control symbol immediately followed by a training pattern </P>
</TD>

<TD>
<P>The attached device is no longer calibrated and has re-started the alignment sequence. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>A.2.2  Output port training state machine </P>

<P> </P>

<P>Figure A-2 illustrates the output port training state machine. Packets can only be transmitted when both the input port and output port are in their &#8220;OK&#8221; states (OK and OK_maint_trn for the input port, and OK, OK_send_trn_req and OK_send_trn_pttn for the output port). The optional OK_send_trn state, lightly shaded in Figure A-2, is used to adjust the device input port sampling circuitry during system operation, and is associated with the OK_maint_trn state in the input port state machine. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_719.jpg"/>
</Figure>

<P>1 </P>

<P> </P>

<P>reset </P>

<P> </P>

<P> </P>

<P>2 </P>

<P> </P>

<P> </P>

<P>send_trn_req </P>

<P> </P>

<P> </P>

<Textbox>
<P>9 </P>
</Textbox>

<P>6 3 4 </P>

<P> </P>

<P>send_trn_pttn </P>

<P> </P>

<P> </P>

<P>5 8 </P>

<P> </P>

<P>13 </P>

<P>send_idle 14 </P>

<P> </P>

<P> </P>

<P>17 </P>

<P> </P>

<P>18 </P>

<P>OK_send_trn_req </P>

<P>12 </P>

<P>7 10 </P>

<P> </P>

<P>OK </P>

<P>15 </P>

<P> </P>

<P>16 </P>

<P>OK_send_trn_pttn </P>

<P>11 </P>

<P> </P>

<P>Figure A-2. Output port training state machine </P>

<P> </P>

<P>Table A-2 describes the state transition arcs for Figure A-2. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table A-2. Output port training state machine transition table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>reset </P>
</TD>

<TD>
<P>reset </P>
</TD>

<TD>
<P>Start training condition not met. </P>
</TD>

<TD>
<P>Remain in the reset state until the start training condition is met. Typically, this is after reset has been applied to the device and all other necessary initialization activity has completed. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>reset </P>
</TD>

<TD>
<P>send_trn_req </P>
</TD>

<TD>
<P>Start training condition met. </P>
</TD>

<TD>
<P>This state is entered after all initialization activity has completed for the device. The output port will send a link-request/send-training control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>send_trn_req </P>
</TD>

<TD>
<P>send_trn_pttn </P>
</TD>

<TD>
<P>Unconditional transition. </P>
</TD>

<TD>
<P>The output port will send 256 iterations of the training pattern </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>send_trn_pttn </P>
</TD>

<TD>
<P>send_trn_pttn </P>
</TD>

<TD>
<P>The 256 iterations of the training pattern is not completed. </P>
</TD>

<TD>
<P>The input port is waiting to calibrate and receive the defined training pattern. The output port is sending training patterns. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>send_trn_pttn </P>
</TD>

<TD>
<P>send_idles </P>
</TD>

<TD>
<P>The 256 iterations of the training pattern is completed and the input port has requested to send idle control symbols. </P>
</TD>

<TD>
<P>The input port sampling circuitry is calibrated. In the send_idle state, one idle control symbol is sent out on the output port. </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>send_trn_pttn </P>
</TD>

<TD>
<P>send_trn_req </P>
</TD>

<TD>
<P>The 256 iterations of the training pattern are completed but the input port has not requested to send idle control symbols. </P>
</TD>

<TD>
<P>Remain in the send_trn_req - send_trn_pttn loop until the input port sampling circuitry is calibrated and the input port recognizes the defined training pattern and then requests to send idle control symbols. A </P>

<P>link-request/send-training control symbol is sent out in state send_trn_req. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>send_idle </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>The input port is in state OK </P>
</TD>

<TD>
<P>Ready to start sending packets and any control symbol. </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>send_idle </P>
</TD>

<TD>
<P>send_trn_pttn </P>
</TD>

<TD>
<P>The input port is not in OK or wait_good_pttn state </P>
</TD>

<TD>
<P>The output port will send 256 iterations of the of the training pattern </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>send_idle </P>
</TD>

<TD>
<P>send_trn_req </P>
</TD>

<TD>
<P>The input port is in state wait_good_pttn </P>
</TD>

<TD>
<P>Transition to send_trn_req and start over. </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>A link-request/send-training is not received on the input port and the input port does not ask for a reset to the beginning of the training sequence. </P>
</TD>

<TD>
<P>This is a functional state in which packets and control symbols are transmitted. Errors are detected and reported in this state. </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>OK_send_trn_pttn </P>
</TD>

<TD>
<P>link-request/send-training followed by a packet or control symbol is received on the input port. </P>
</TD>

<TD>
<P>This transition occurs when in the OK state and a maintenance training request is received from the attached device. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>OK_send_trn_req </P>
</TD>

<TD>
<P>The input port wants the attached device to send 256 iterations of the training pattern. </P>
</TD>

<TD>
<P>This transition occurs when in the OK state and input port sampling circuitry needs to be adjusted, and is </P>

<P>associated with the optional input port OK_maint_trn state. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table A-2. Output port training state machine transition table (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>send_trn_req </P>
</TD>

<TD>
<P>The input port asks for a reset to the beginning of the training sequence. </P>
</TD>

<TD>
<P>Transition to send_trn_req and start over. This occurs when the sampling circuitry is no longer able to reliably sample the device pins. </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>send_trn_pttn </P>
</TD>

<TD>
<P>A link-request/send-training followed by the training pattern is received on the input port. </P>
</TD>

<TD>
<P>The attached device has lost synchronization. </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>OK_send_trn_pttn </P>
</TD>

<TD>
<P>OK_send_trn_pttn </P>
</TD>

<TD>
<P>The 256 iterations of the training pattern is not completed. </P>
</TD>

<TD>
<P>The output port is sending training patterns. Errors are detected and reported in this state. Must send at least one idle control symbol after the </P>

<P>256 iterations. </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>OK_send_trn_pttn </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>The 256 iterations of the training pattern are completed and followed by at least one idle control symbol. </P>
</TD>

<TD>
<P>This is a normal operating case where the attached device requested that we send training patterns yet it maintained alignment. </P>
</TD>
</TR>

<TR>
<TD>
<P>17 </P>
</TD>

<TD>
<P>OK_send_trn_req </P>
</TD>

<TD>
<P>OK_send_trn_req </P>
</TD>

<TD>
<P>Waiting to send the &#61472;&#61472;</P>

<P>link-request/send-training </P>
</TD>

<TD>
<P>Might have to wait for the end of the current packet because link-request control symbols can not be embedded. Errors are detected and reported in this state. </P>
</TD>
</TR>

<TR>
<TD>
<P>18 </P>
</TD>

<TD>
<P>OK_send_trn_req </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>link-request/send-training sent out on the output port as requested by the input port. </P>
</TD>

<TD>
<P>Input port is requesting training patterns from the other end to adjust its sampling circuitry. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>A.3 Packet Retry Mechanism </P>

<P> </P>

<P>This section contains the example packet retry mechanism state machine referred to in Section 2.3.3, &#8220;Transaction and Packet Delivery&#8221;. </P>

<P> </P>

<P>Packet retry recovery actually requires two inter-dependent state machines in order to operate, one associated with the input port and the other with the output port on the two connected devices. The two state machines work together to attempt recovery from a retry condition. </P>

<P> </P>

<P> </P>

<P>A.3.1  Input port retry recovery state machine </P>

<P> </P>

<P>If a packet cannot be accepted by a receiver for reasons other than error conditions, such as a full input buffer, the receiver follows the state sequence shown in Figure A-3. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_720.jpg"/>
</Figure>

<P>reset </P>

<P>1 </P>

<P> </P>

<P>recovery_disabled </P>

<P> </P>

<P>2 5 </P>

<P>3 </P>

<P> </P>

<P>wait_for_retry </P>

<P> </P>

<P> </P>

<P>4 </P>

<P>6 </P>

<P> </P>

<P>stop_input </P>

<P>9 </P>

<P> </P>

<P>7 8 </P>

<P> </P>

<P>retry_stopped </P>

<P> </P>

<P> </P>

<P>Figure A-3. Input port retry recovery state machine </P>

<P> </P>

<P>Table A-3 describes the state transition arcs for Figure A-3. The states referenced in the comments in quotes are the RapidIO 8/16 LP-LVDS defined status states, not states in this state machine. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table A-3. Input port retry recovery state machine transition table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Remain in this state until the input port is enabled to receive packets. </P>
</TD>

<TD>
<P>This is the initial state after reset. The input port can&#8217;t be enabled before the training sequence has been completed, and may be controlled through other mechanisms as well, such as a software enable bit. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Input port is enabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Remain in this state until a packet retry situation has been detected. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>A packet retry situation has been detected. </P>
</TD>

<TD>
<P>Usually this is due to an internal resource problem such as not having packet buffers available for low priority packets. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Input port is disabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>Remain in this state until described input port stop activity is completed. </P>
</TD>

<TD>
<P>Send a packet-retry control symbol with the expected ackID, discard the packet, and don&#8217;t change the expected ackID. This will force the attached device to initiate recovery starting at the expected ackID. Clear the &#8220;Port ready&#8221; state and set the &#8220;Input </P>

<P>Retry-stopped&#8221; state. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>retry_stopped </P>
</TD>

<TD>
<P>Input port stop activity is complete. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>retry_stopped </P>
</TD>

<TD>
<P>retry_stopped </P>
</TD>

<TD>
<P>Remain in this state until a restart-from-retry or </P>

<P>restart-from-error control symbol is received or an input port error is encountered. </P>
</TD>

<TD>
<P>The &#8220;Input Retry-stopped&#8221; state causes the input port to silently discard all incoming packets and not change the expected ackID value. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>retry_stopped </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Received a restart-from-retry or a restart-from-error control symbol or an input port error is encountered. </P>
</TD>

<TD>
<P>The restart-from-error control symbol is a link-request/input-status control symbol. Clear the &#8220;Input </P>

<P>Retry-stopped&#8221; state and set the &#8220;Port ready&#8221; state. An input port error shall cause a clean transition between the retry recovery state machine and the error recovery state machine. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>A.3.2  Output port retry recovery state machine </P>

<P> </P>

<P>On receipt of an error-free packet-retry acknowledge control symbol, the attached output port follows the behavior shown in Figure A-4. The states referenced in the comments in quotes are the RapidIO 8/16 LP-LVDS defined status states, not states </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>in this state machine. </P>

<P> </P>

<P> </P>

<P> </P>

<P>reset </P>

<P>1 </P>

<P> </P>

<P>recovery_disabled </P>

<P> </P>

<P>2 5 </P>

<P>3 </P>

<P> </P>

<P>wait_for_retry </P>

<P> </P>

<P> </P>

<P>4 </P>

<P>6 </P>

<P> </P>

<P>stop_output </P>

<P> </P>

<P>9 </P>

<P>8 7 </P>

<P> </P>

<P>recover </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_721.jpg"/>
</Figure>

<P>Figure A-4. Output port retry recovery state machine </P>

<P> </P>

<P>Table A-4 describes the state transition arcs for Figure A-4. </P>

<P> </P>

<P>Table A-4. Output port retry recovery state machine transition table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Remain in this state until the output port is enabled to receive packets. </P>
</TD>

<TD>
<P>This is the initial state after reset. The output port can&#8217;t be enabled before the training sequence has been completed, and may be controlled through other mechanisms as well, such as a software enable bit. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Output port is enabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Remain in this state until a packet-retry control symbol is received. </P>
</TD>

<TD>
<P>The packet-retry control symbol shall be error free. </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>A packet-retry control symbol has been received. </P>
</TD>

<TD>
<P>Start the output port stop procedure. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Output port is disabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>Remain in this state until the output port stop procedure is completed. </P>
</TD>

<TD>
<P>Clear the &#8220;Port ready&#8221; state, set the &#8220;Output Retry-stopped&#8221; state, and stop transmitting new packets. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>Output port stop procedure is complete. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table A-4. Output port retry recovery state machine transition table (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>Remain in this state until the internal recovery procedure is completed. </P>
</TD>

<TD>
<P>The packet sent with the ackID value returned in the packet-retry control symbol and all subsequent packets shall be re-transmitted. Output port state machines and the outstanding ackID scoreboard shall be updated with this information, then clear the &#8220;Output Retry-stopped&#8221; state and set the &#8220;Port ready&#8221; state to restart the output port. </P>

<P>Receipt of a packet-not-accepted control symbol or other output port error during this procedure shall cause a clean transition between the retry recovery state machine and the error recovery state machine. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Internal recovery procedure is complete. </P>
</TD>

<TD>
<P>Re-transmission has started, so return to the wait_for_retry state to wait for the next packet-retry control symbol. </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P>A.4 Error Recovery </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>This section contains the error recovery state machine referred to in Section 2.4.5, &#8220;Link Behavior Under Error.&#8221; </P>

<P> </P>

<P>Error recovery actually requires two inter-dependent state machines in order to operate, one associated with the input port and the other with the output port on the two connected devices. The two state machines work together to attempt recovery. </P>

<P> </P>

<P> </P>

<P>A.4.1  Input port error recovery state machine </P>

<P> </P>

<P>There are a variety of recoverable error types described in detail in Section 2.4.5, &#8220;Link Behavior Under Error&#8221;. The first group of errors are associated with the input port, and consists mostly of corrupt packet and control symbols. An example of a corrupt packet is a packet with an incorrect CRC. An example of a corrupt control symbol is a control symbol where the second 16 bits are not an inversion of the first </P>

<P>16 bits. The recovery state machine for the input port of a RapidIO link is shown in </P>

<P>Figure A-5. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_722.jpg"/>
</Figure>

<P>reset </P>

<P>1 </P>

<P> </P>

<P>recovery_disabled </P>

<P> </P>

<P>2 5 </P>

<P>3 </P>

<P> </P>

<P>wait_for_error </P>

<P> </P>

<P> </P>

<P>4 </P>

<P>6 </P>

<P> </P>

<P>stop_input </P>

<P>9 </P>

<P> </P>

<P>7 8 </P>

<P> </P>

<P>error_stopped </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure A-5. Input port error recovery state machine </P>

<P> </P>

<P>Table A-5 describes the state transition arcs for Figure A-5. The states referenced in the comments in quotes are the RapidIO 8/16 LP-LVDS defined status states, not states in this state machine. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table A-5. Input port error recovery state machine transition table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Remain in this state until error recovery is enabled. </P>
</TD>

<TD>
<P>This is the initial state after reset. Error recovery can&#8217;t be enabled before the training sequence has been completed, and may be controlled through other mechanisms as well, such as a software enable bit. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Error recovery is enabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Remain in this state until a recoverable error is detected. </P>
</TD>

<TD>
<P>Detected errors and the level of coverage is implementation dependent. </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>A recoverable error has been detected. </P>
</TD>

<TD>
<P>An output port associated error will not cause this transition, only an input port associated error. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Error recovery is disabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>Remain in this state until described input port stop activity is completed. </P>
</TD>

<TD>
<P>Send a packet-not-accepted control symbol and, if the error was on a packet, discard the packet and don&#8217;t change the expected ackID value. This will force the attached device to initiate recovery. Clear the &#8220;Port ready&#8221; state and set the &#8220;Input </P>

<P>Error-stopped&#8221; state. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>error_stopped </P>
</TD>

<TD>
<P>Input port stop activity is complete. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>error_stopped </P>
</TD>

<TD>
<P>error_stopped </P>
</TD>

<TD>
<P>Remain in this state until a </P>

<P>restart-from-error control symbol is received. </P>
</TD>

<TD>
<P>The &#8220;Input Error-stopped&#8221; state causes the input port to silently discard all subsequent incoming packets and ignore all subsequent input port errors. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>error_stopped </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Received a restart-from-error control symbol. </P>
</TD>

<TD>
<P>The restart-from-error control symbol is a link-request/input-status control symbol. Clear the &#8220;Input </P>

<P>Error-stopped&#8221; state and set the &#8220;Port ready&#8221; state, which will put the input port back in normal operation. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>A.4.2  Output port error recovery state machine </P>

<P> </P>

<P>The second recoverable group of errors described in Section 2.4.5, &#8220;Link Behavior Under Error&#8221; is associated with the output port, and is comprised of control symbols that are error-free and indicate that the attached input port has detected a transmission error or some other unusual situation has occurred. An example of this situation is indicated by the receipt of a packet-not-accepted control symbol. Another example is the receipt of a link-request/send-training control symbol, which should cause the error recovery procedure to be followed after responding to the </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>request. The state machine for the output port is shown in Figure A-6. </P>

<P> </P>

<P> </P>

<P> </P>

<P>reset </P>

<P>1 </P>

<P> </P>

<P>recovery_disabled </P>

<P> </P>

<P>2 5 </P>

<P>3 </P>

<P> </P>

<P>wait_for_error </P>

<P> </P>

<P> </P>

<P>4 </P>

<P>6 </P>

<P> </P>

<P>stop_output </P>

<P> </P>

<P>10 </P>

<P>9 7 </P>

<P> </P>

<P>recover </P>

<P>12 </P>

<P>8 11 </P>

<P> </P>

<P>fatal_error </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_723.jpg"/>
</Figure>

<P>Figure A-6. Output port error recovery state machine </P>

<P> </P>

<P>Table A-6 describes the state transition arcs for Figure A-6. The states referenced in the comments in quotes are the RapidIO 8/16 LP-LVDS defined status states, not states in this state machine. </P>

<P> </P>

<P>Table A-6. Output port error recovery state machine transition table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Remain in this state until error recovery is enabled. </P>
</TD>

<TD>
<P>This is the initial state after reset. Error recovery can&#8217;t be enabled before the training sequence has been completed, and may be controlled through other mechanisms as well, such as a software enable bit. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Error recovery is enabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Remain in this state until a recoverable error is detected. </P>
</TD>

<TD>
<P>Detected errors and the level of coverage is implementation dependent. </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>A recoverable error has been detected. </P>
</TD>

<TD>
<P>An input port associated error will not cause this transition, only an output port associated error. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Error recovery is disabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table A-6. Output port error recovery state machine transition table (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>Remain in this state until an exit condition occurs. </P>
</TD>

<TD>
<P>Clear the &#8220;Port ready&#8221; state, set the &#8220;Output Error-stopped&#8221; state, stop transmitting new packets, and send a link-request/input-status control symbol. Ignore all subsequent output port errors. </P>

<P>The input on the attached device is in the &#8220;Input Error-stopped&#8221; state and is waiting for a link-request/input-status in order to be re-enabled to receive packets. </P>

<P>An implementation may wish to timeout several times before regarding a timeout as fatal using a threshold counter or some other mechanism. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>The link-response is received and returned an outstanding ackID value </P>
</TD>

<TD>
<P>An outstanding ackID is a value sent out on a packet that has not been acknowledged yet. In the case where no ackIDs are outstanding the returned ackID value shall match the next expected/next assigned ackID value, indicating that the devices are synchronized. </P>

<P>Recovery is possible, so follow recovery procedure. </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>fatal_error </P>
</TD>

<TD>
<P>The link-response is received and returned an ackID value that is not outstanding, or timed out waiting for the link-response. </P>
</TD>

<TD>
<P>Recovery is not possible, so start error shutdown procedure. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>Remain in this state until the internal recovery procedure is completed. </P>
</TD>

<TD>
<P>The packet sent with the ackID value returned in the link-response and all subsequent packets shall be </P>

<P>re-transmitted. All packets transmitted with ackID values preceding the returned value were received by the attached device, so they are treated as if packet-accepted control symbols have been received for them. Output port state machines and the outstanding ackID scoreboard shall be updated with this information, then clear the &#8220;Output Error-stopped&#8221; state and set the &#8216;Port ready&#8221; state to restart the output port. </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>The internal recovery procedure is complete. </P>
</TD>

<TD>
<P>Re-transmission (if any was necessary) has started, so return to the wait_for_error state to wait for the next error. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table A-6. Output port error recovery state machine transition table (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>fatal_error </P>
</TD>

<TD>
<P>fatal_error </P>
</TD>

<TD>
<P>Remain in this state until error shutdown procedure is completed. </P>
</TD>

<TD>
<P>Clear the &#8220;Output Error-stopped&#8221; state, set the &#8220;Port Error&#8221; state, and signal a system error. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>fatal_error </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Error shutdown procedure is complete. </P>
</TD>

<TD>
<P>Return to the wait_for_error state even though the output port is shut off. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_724.jpg"/>
</Figure>

<P>A Agent. A processing element that provides services to a processor. </P>

<P>ANSI. American National Standards Institute. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_725.jpg"/>
</Figure>

<P>B Big-endian. A byte-ordering method in memory where the address n of a word corresponds to the most significant byte. In an addressed memory word, the bytes are ordered (left to right) 0, 1, 2, 3, with 0 </P>

<P>being the most significant byte. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_726.jpg"/>
</Figure>

<P>C Capability registers (CARs). A set of read-only registers that allows a processing  element  to  determine  another  processing  element&#8217;s </P>

<P>capabilities. </P>

<P> </P>

<P>CCITT. Consultive Communication for International  Telegraph and </P>

<P>Telephone. </P>

<P> </P>

<P>Command and status registers (CSRs). A set of registers that allows a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P>Control symbol. A quantum of information transmitted between two linked devices to manage packet flow between the devices. </P>

<P> </P>

<P>CRC. Cyclic redundancy code </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_727.jpg"/>
</Figure>

<P>D Deadlock. A situation in which two processing elements that are sharing resources prevent each other from accessing the resources, resulting in a halt of system operation. </P>

<P> </P>

<P>Deferred or delayed transaction. The process of the target of a transaction capturing the transaction and completing it after responding to the source with a retry. </P>

<P> </P>

<P>Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>RapidIO Trade Association 167 </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Device ID. The identifier of an end point processing element connected to the </P>

<P>RapidIO interconnect. </P>

<P> </P>

<P>Direct Memory Access (DMA). The process of accessing memory in a device by specifying the memory address directly. </P>

<P> </P>

<P>DLL. Delay lock loop. </P>

<P> </P>

<P>Doorbell. A port on a device that is capable of generating an interrupt to a processor. </P>

<P> </P>

<P>Double-data-rate clock. A data reference signal that indicates new valid data on both low-to-high and high-to-low transitions of the clock. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_728.jpg"/>
</Figure>

<P>E EMI. Electromagnetic Interference. </P>

<P>End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>End  point  device.  A  processing  element  which  contains  end  point functionality. </P>

<P> </P>

<P>End point free device. A processing element which does not contain end point functionality. </P>

<P> </P>

<P>EOP. End of packet. </P>

<P> </P>

<P>External  processing  element.  A  processing  element  other  than  the processing element in question. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_729.jpg"/>
</Figure>

<P>F Field or Field name. A sub-unit of a register, where bits in the register are named and defined. </P>

<P> </P>

<P>First symbol. The leading 16 bits of a packet. </P>

<P> </P>

<P>Full-duplex. Data can be transmitted in both directions between connected processing elements at the same time. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_730.jpg"/>
</Figure>

<P>G Globally shared memory (GSM). Cache coherent system memory that can be shared between multiple processors in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_731.jpg"/>
</Figure>

<P>H Half-word. A two byte or 16 bit quantity, aligned on two byte boundaries. </P>

<P> </P>

<P>Host. A processing element responsible for exploring and initializing all or a portion of a RapidIO based system. </P>

<P> </P>

<P> </P>

<P>168 RapidIO Trade Association </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_732.jpg"/>
</Figure>

<P>I Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P>I/O. Input-output. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_733.jpg"/>
</Figure>

<P>L LVDS. Low voltage differential signaling. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_734.jpg"/>
</Figure>

<P>M Multicast. The concept of sending a packet to more than one processing elements in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_735.jpg"/>
</Figure>

<P>N NRZ signal. No return to zero signal. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_736.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_737.jpg"/>
</Figure>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>

<P>system. </P>

<P> </P>

<P>PCB. Printed circuit board. </P>

<P> </P>

<P>PLL. Phase lock loop. </P>

<P> </P>

<P>Port-write. An address-less maintenance write operation. </P>

<P> </P>

<P>Priority. The relative importance of a transaction or packet; in most systems a higher priority transaction or packet will be serviced or transmitted before one of lower priority. </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P>Processor. The logic circuitry that responds to and processes the basic instructions that drive a computer. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_738.jpg"/>
</Figure>

<P>R Receiver. The RapidIO interface input port on a processing element. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_739.jpg"/>
</Figure>

<P>S SECDED. Single error correction, double error detection. </P>

<P> </P>

<P>Sender. The RapidIO interface output port on a processing element. </P>

<P> </P>

<P>Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>SRAM. Static random access memory. </P>

<P>RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on one of its input ports to one of its output ports. </P>

<P> </P>

<P>Symbol. A 16-bit quantity. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_740.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P>Transaction request flow. A sequence of transactions between two processing elements that have a required completion order at the destination processing element. There are no ordering requirements between transaction request flows. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_741.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 5: Globally Shared Memory Logical Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_742.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.1 </P>
</TD>

<TD>
<P>Incorporate comment review changes </P>
</TD>

<TD>
<P>03/08/2001 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.2 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev. 1.1 errata rev. 1.1.1, errata 3 </P>
</TD>

<TD>
<P>06/26/2002 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev 1.2 errata 1 as applicable </P>

<P>Converted to ISO-friendly templates </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Technical changes: errata showing: 10-08-00001.005, Consolidated Comments on 11-01-00000.000 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction........................................................................................................... 11 </P>

<P>1.2 Overview............................................................................................................... 11 </P>

<P>1.2.1 Memory System ................................................................................................ 12 </P>

<P>1.3 Features of the Globally Shared Memory Specification....................................... 13 </P>

<P>1.3.1 Functional Features........................................................................................... 13 </P>

<P>1.3.2 Physical Features .............................................................................................. 14 </P>

<P>1.3.3 Performance Features ....................................................................................... 14 </P>

<P>1.4 Contents ................................................................................................................ 14 </P>

<P>1.5 Terminology.......................................................................................................... 15 </P>

<P>1.6 Conventions .......................................................................................................... 15 </P>

<P> </P>

<P> </P>

<P>Chapter 2 System Models </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 17 </P>

<P>2.2 Processing Element Models .................................................................................. 17 </P>

<P>2.2.1 Processor-Memory Processing Element Model................................................ 18 </P>

<P>2.2.2 Integrated Processor-Memory Processing Element Model .............................. 19 </P>

<P>2.2.3 Memory-Only Processing Element Model ....................................................... 19 </P>

<P>2.2.4 Processor-Only Processing Element ................................................................. 20 </P>

<P>2.2.5 I/O Processing Element .................................................................................... 20 </P>

<P>2.2.6 Switch Processing Element............................................................................... 20 </P>

<P>2.3 Programming Models ........................................................................................... 21 </P>

<P>2.3.1 Globally Shared Memory System Model ......................................................... 21 </P>

<P>2.3.1.1 Software-Managed Cache Coherence Programming Model ........................ 23 </P>

<P>2.4 System Issues ........................................................................................................ 23 </P>

<P>2.4.1 Operation Ordering ........................................................................................... 23 </P>

<P>2.4.2 Transaction Delivery......................................................................................... 23 </P>

<P>2.4.3 Deadlock Considerations .................................................................................. 24 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Operation Descriptions </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 25 </P>

<P>3.2 GSM Operations Cross Reference ........................................................................ 26 </P>

<P>3.3 GSM Operations ................................................................................................... 27 </P>

<P>3.3.1 Read Operations................................................................................................ 28 </P>

<P>3.3.2 Instruction Read Operations ............................................................................. 29 </P>

<P>3.3.3 Read-for-Ownership Operations....................................................................... 31 </P>

<P>3.3.4 Data Cache Invalidate Operations .................................................................... 33 </P>

<P>3.3.5 Castout Operations............................................................................................ 34 </P>

<P>3.3.6 TLB Invalidate-Entry Operations ..................................................................... 35 </P>

<P> </P>

<P>RapidIO Trade Association 3 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>3.3.7 TLB Invalidate-Entry Synchronization Operations .......................................... 35 </P>

<P>3.3.8 Instruction Cache Invalidate Operations........................................................... 35 </P>

<P>3.3.9 Data Cache Flush Operations ........................................................................... 36 </P>

<P>3.3.10 I/O Read Operations ......................................................................................... 38 </P>

<P>3.4 Endian, Byte Ordering, and Alignment ................................................................ 40 </P>

<P> </P>

<P> </P>

<P>Chapter 4 Packet Format Descriptions </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 43 </P>

<P>4.2 Request Packet Formats ........................................................................................ 43 </P>

<P>4.2.1 Addressing and Alignment ............................................................................... 44 </P>

<P>4.2.2 Data Payloads ................................................................................................... 44 </P>

<P>4.2.3 Field Definitions for All Request Packet Formats............................................ 47 </P>

<P>4.2.4 Type 0 Packet Format (Implementation-Defined)............................................ 49 </P>

<P>4.2.5 Type 1 Packet Format (Intervention-Request Class) ........................................ 50 </P>

<P>4.2.6 Type 2 Packet Format (Request Class)............................................................. 51 </P>

<P>4.2.7 Type 3&#8211;4 Packet Formats (Reserved) ............................................................... 52 </P>

<P>4.2.8 Type 5 Packet Format (Write Class)................................................................. 52 </P>

<P>4.2.9 Type 6&#8211;11 Packet Formats (Reserved) ............................................................. 53 </P>

<P>4.3 Response Packet Formats ..................................................................................... 53 </P>

<P>4.3.1 Field Definitions for All Response Packet Formats ......................................... 53 </P>

<P>4.3.2 Type 12 Packet Format (Reserved) .................................................................. 54 </P>

<P>4.3.3 Type 13 Packet Format (Response Class) ........................................................ 54 </P>

<P>4.3.4 Type 14 Packet Format (Reserved) .................................................................. 54 </P>

<P>4.3.5 Type 15 Packet Format (Implementation-Defined).......................................... 55 </P>

<P> </P>

<P> </P>

<P>Chapter 5 Globally Shared Memory Registers </P>

<P> </P>

<P>5.1 Introduction........................................................................................................... 57 </P>

<P>5.2 Register Summary................................................................................................. 57 </P>

<P>5.3 Reserved Register, Bit and Bit Field Value Behavior .......................................... 58 </P>

<P>5.4 Capability Registers (CARs) ................................................................................ 60 </P>

<P>5.4.1 Source Operations CAR (Configuration Space Offset 0x18) ........................... 60 </P>

<P>5.4.2 Destination Operations CAR (Configuration Space Offset 0x1C) ................... 61 </P>

<P>5.5 Command and Status Registers (CSRs)................................................................ 62 </P>

<P> </P>

<P> </P>

<P>Chapter 6 Communication Protocols </P>

<P> </P>

<P>6.1 Introduction........................................................................................................... 63 </P>

<P>6.2 Definitions ............................................................................................................ 63 </P>

<P>6.2.1 General Definitions........................................................................................... 64 </P>

<P>6.2.2 Request and Response Definitions ................................................................... 66 </P>

<P>6.2.2.1 System Request............................................................................................. 66 </P>

<P>6.2.2.2 Local Request ............................................................................................... 66 </P>

<P>6.2.2.3 System Response .......................................................................................... 67 </P>

<P> </P>

<P> </P>

<P>4 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>6.2.2.4 Local Response ............................................................................................. 67 </P>

<P>6.3 Operation to Protocol Cross Reference ................................................................ 67 </P>

<P>6.4 Read Operations.................................................................................................... 68 </P>

<P>6.4.1 Internal Request State Machine ........................................................................ 68 </P>

<P>6.4.2 Response State Machine ................................................................................... 68 </P>

<P>6.4.3 External Request State Machine ....................................................................... 70 </P>

<P>6.5 Instruction Read Operations ................................................................................. 72 </P>

<P>6.5.1 Internal Request State Machine ........................................................................ 72 </P>

<P>6.5.2 Response State Machine ................................................................................... 72 </P>

<P>6.5.3 External Request State Machine ....................................................................... 73 </P>

<P>6.6 Read for Ownership Operations ........................................................................... 75 </P>

<P>6.6.1 Internal Request State Machine ........................................................................ 75 </P>

<P>6.6.2 Response State Machine ................................................................................... 75 </P>

<P>6.6.3 External Request State Machine ....................................................................... 78 </P>

<P>6.7 Data Cache and Instruction Cache Invalidate Operations .................................... 79 </P>

<P>6.7.1 Internal Request State Machine ........................................................................ 79 </P>

<P>6.7.2 Response State Machine ................................................................................... 79 </P>

<P>6.7.3 External Request State Machine ....................................................................... 80 </P>

<P>6.8 Castout Operations................................................................................................ 82 </P>

<P>6.8.1 Internal Request State Machine ........................................................................ 82 </P>

<P>6.8.2 Response State Machine ................................................................................... 82 </P>

<P>6.8.3 External Request State Machine ....................................................................... 82 </P>

<P>6.9 TLB Invalidate Entry, TLB Invalidate Entry Synchronize Operations ................ 83 </P>

<P>6.9.1 Internal Request State Machine ........................................................................ 83 </P>

<P>6.9.2 Response State Machine ................................................................................... 83 </P>

<P>6.9.3 External Request State Machine ....................................................................... 83 </P>

<P>6.10 Data Cache Flush Operations ............................................................................... 84 </P>

<P>6.10.1 Internal Request State Machine ........................................................................ 84 </P>

<P>6.10.2 Response State Machine ................................................................................... 84 </P>

<P>6.10.3 External Request State Machine ....................................................................... 86 </P>

<P>6.11 I/O Read Operations ............................................................................................. 88 </P>

<P>6.11.1 Internal Request State Machine ........................................................................ 88 </P>

<P>6.11.2 Response State Machine ................................................................................... 88 </P>

<P>6.11.3 External Request State Machine ....................................................................... 89 </P>

<P> </P>

<P> </P>

<P>Chapter 7 Address Collision Resolution Tables </P>

<P> </P>

<P>7.1 Introduction........................................................................................................... 91 </P>

<P>7.2 Resolving an Outstanding READ_HOME Transaction ....................................... 92 </P>

<P>7.3 Resolving an Outstanding IREAD_HOME Transaction ...................................... 93 </P>

<P>7.4 Resolving an Outstanding READ_OWNER Transaction .................................... 94 </P>

<P>7.5 Resolving an Outstanding READ_TO_OWN_HOME Transaction .................... 95 </P>

<P>7.6 Resolving an Outstanding READ_TO_OWN_OWNER Transaction.................. 97 </P>

<P>7.7 Resolving an Outstanding DKILL_HOME Transaction ...................................... 98 </P>

<P>7.8 Resolving an Outstanding DKILL_SHARER Transaction ................................ 100 </P>

<P>7.9 Resolving an Outstanding IKILL_HOME Transaction ...................................... 101 </P>

<P> </P>

<P>RapidIO Trade Association 5 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>7.10 Resolving an Outstanding IKILL_SHARER Transaction .................................. 102 </P>

<P>7.11 Resolving an Outstanding CASTOUT Transaction............................................ 103 </P>

<P>7.12 Resolving an Outstanding TLBIE or TLBSYNC Transaction ........................... 104 </P>

<P>7.13 Resolving an Outstanding FLUSH Transaction ................................................. 105 </P>

<P>7.14 Resolving an Outstanding IO_READ_HOME Transaction ............................... 107 </P>

<P>7.15 Resolving an Outstanding IO_READ_OWNER Transaction ............................ 109 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>1-1 A Snoopy Bus-Based System .........................................................................................12 </P>

<P>1-2 A Distributed Memory System .......................................................................................13 </P>

<P>2-1 A Possible RapidIO-Based Computing System..............................................................17 </P>

<P>2-2 Processor-Memory Processing Element Example ..........................................................18 </P>

<P>2-3 Integrated Processor-Memory Processing Element Example.........................................19 </P>

<P>2-4 Memory-Only Processing Element Example .................................................................19 </P>

<P>2-5 Processor-Only Processing Element Example................................................................20 </P>

<P>2-6 Switch Processing Element Example .............................................................................21 </P>

<P>3-1 Read Operation to Remote Shared Coherence Granule..................................................28 </P>

<P>3-2 Read Operation to Remote Modified Coherence Granule ..............................................28 </P>

<P>3-3 Read Operation to Local Modified Coherence Granule .................................................29 </P>

<P>3-4 Instruction Read Operation to Remote Shared Coherence Granule ...............................30 </P>

<P>3-5 Instruction Read Operation to Remote Modified Coherence Granule ...........................30 </P>

<P>3-6 Instruction Read Operation to Local Modified Coherence Granule ...............................30 </P>

<P>3-7 Instruction Read Operation Paradox Case ......................................................................31 </P>

<P>3-8 Read-for-Ownership Operation to Remote Shared Coherence Granule.........................31 </P>

<P>3-9 Read-for-Ownership Operation to Remote Modified Coherence Granule .....................32 </P>

<P>3-10 Read-for-Ownership Operation to Local Shared Coherence Granule ............................32 </P>

<P>3-11 Read-for-Ownership Operation to Local Modified Coherence Granule ........................32 </P>

<P>3-12 Data Cache Invalidate Operation to Remote Shared Coherence Granule ......................33 </P>

<P>3-13 Data Cache Invalidate Operation to Local Shared Coherence Granule..........................34 </P>

<P>3-14 Castout Operation on Remote Modified Coherence Granule .........................................34 </P>

<P>3-15 TLB Invalidate-Entry Operation.....................................................................................35 </P>

<P>3-16 TLB Invalidate-Entry Synchronization Operation .........................................................35 </P>

<P>3-17 Instruction Cache Invalidate Operation to Remote Sharable Coherence Granule..........36 </P>

<P>3-18 Instruction Cache Invalidate Operation to Local Sharable Coherence Granule .............36 </P>

<P>3-19 Flush Operation to Remote Shared Coherence Granule .................................................37 </P>

<P>3-20 Flush Operation to Remote Modified Coherence Granule .............................................38 </P>

<P>3-21 Flush Operation to Local Shared Coherence Granule ....................................................38 </P>

<P>3-22 Flush Operation to Local Modified Coherence Granule ................................................38 </P>

<P>3-23 I/O Read Operation to Remote Shared Coherence Granule ...........................................39 </P>

<P>3-24 I/O Read Operation to Remote Modified Coherence Granule .......................................39 </P>

<P>3-25 I/O Read Operation to Local Modified Coherence Granule ...........................................39 </P>

<P>3-26 Byte Alignment Example................................................................................................40 </P>

<P>3-27 Half-Word Alignment Example......................................................................................40 </P>

<P>3-28 Word Alignment Example ..............................................................................................40 </P>

<P>3-29 Data Alignment Example................................................................................................41 </P>

<P>4-1 Type 1 Packet Bit Stream Format ...................................................................................50 </P>

<P>4-2 Type 2 Packet Bit Stream Format ...................................................................................52 </P>

<P>4-3 Type 5 Packet Bit Stream Format ...................................................................................52 </P>

<P>4-4 Type 13 Packet Bit Stream Format .................................................................................54 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>2-1 RapidIO Memory Directory Definition ..........................................................................22 </P>

<P>3-1 GSM Operations Cross Reference ..................................................................................26 </P>

<P>4-1 Request Packet Type to Transaction Type Cross Reference ..........................................43 </P>

<P>4-2 Coherent 32-Byte Read Data Return Ordering ...............................................................45 </P>

<P>4-3 Coherent 64-Byte Read Data Return Ordering ...............................................................45 </P>

<P>4-4 Coherent 32-Byte Write Data Payload ...........................................................................46 </P>

<P>4-5 Coherent 64-Byte Write Data Payloads ..........................................................................46 </P>

<P>4-6 General Field Definitions for All Request Packets.........................................................47 </P>

<P>4-7 Read Size (rdsize) Definitions ........................................................................................48 </P>

<P>4-8 Write Size (wrsize) Definitions ......................................................................................49 </P>

<P>4-9 Specific Field Definitions and Encodings for Type 1 Packets .......................................50 </P>

<P>4-10 Transaction Field Encodings for Type 2 Packets ...........................................................51 </P>

<P>4-11 Transaction Field Encodings for Type 5 Packets ...........................................................52 </P>

<P>4-12 Request Packet Type to Transaction Type Cross Reference ..........................................53 </P>

<P>4-13 Field Definitions and Encodings for All Response Packets ...........................................53 </P>

<P>5-1 GSM Register Map .........................................................................................................57 </P>

<P>5-2 Configuration Space Reserved Access Behavior............................................................58 </P>

<P>5-3 Bit Settings for Source Operations CAR ........................................................................60 </P>

<P>5-4 Bit Settings for Destination Operations CAR .................................................................61 </P>

<P>6-1 Operation to Protocol Cross Reference ..........................................................................67 </P>

<P>7-1 Address Collision Resolution for READ_HOME ..........................................................92 </P>

<P>7-2 Address Collision Resolution for IREAD_HOME.........................................................93 </P>

<P>7-3 Address Collision Resolution for READ_OWNER .......................................................94 </P>

<P>7-4 Address Collision Resolution for READ_TO_OWN_HOME .......................................95 </P>

<P>7-5 Address Collision Resolution for READ_TO_OWN_OWNER ....................................97 </P>

<P>7-6 Address Collision Resolution for DKILL_HOME .........................................................98 </P>

<P>7-7 Address Collision Resolution for DKILL_SHARER ...................................................100 </P>

<P>7-8 Address Collision Resolution for IKILL_HOME ........................................................101 </P>

<P>7-9 Address Collision Resolution for IKILL_SHARER ....................................................102 </P>

<P>7-10 Address Collision Resolution for CASTOUT ..............................................................103 </P>

<P>7-11 Address Collision Resolution for Software Coherence Operations..............................104 </P>

<P>7-12 Address Collision Resolution for Participant FLUSH..................................................105 </P>

<P>7-13 Address Collision Resolution for Non-participant FLUSH..........................................106 </P>

<P>7-14 Address Collision Resolution for Participant IO_READ_HOME ...............................107 </P>

<P>7-15 Address Collision Resolution for Non-participant IO_READ_HOME .......................108 </P>

<P>7-16 Address Collision Resolution for Participant IO_READ_OWNER.............................109 </P>

<P>7-17 Address Collision Resolution for Non-participant IO_READ_OWNER.....................110 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>This chapter provides an overview of the RapidIO Part 5: Globally Shared Memory Logical Specification, including a description of the relationship between this specification and the other specifications of the RapidIO interconnect. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>Although RapidIO is targeted toward the message passing programming model, it supports a globally shared distributed memory (GSM) model as defined by this specification. The globally shared memory programming model is the preferred programming model for modern general-purpose multiprocessing computer systems, which requires cache coherency support in hardware. This addition of GSM enables both distributed I/O processing and general purpose multiprocessing to co-exist under the same protocol. </P>

<P> </P>

<P>The RapidIO Part 5: Globally Shared Memory Logical Specification is one of the RapidIO logical layer specifications that define the interconnect&#8217;s overall protocol and packet formats. This layer contains the information necessary for end points to process a transaction. Other RapidIO logical layer specifications include RapidIO Part 1: Input/Output Logical Specification and RapidIO Part 2: Message Passing Logical Specification. </P>

<P> </P>

<P>The logical specifications do not imply a specific transport or physical interface, therefore they are specified in a bit stream format. Necessary bits are added to the logical encodings for the transport and physical layers lower in the specification hierarchy. </P>

<P> </P>

<P>RapidIO is a definition of a system interconnect. System concepts such as processor programming models, memory coherency models and caching are beyond the scope of the RapidIO architecture. The support of memory coherency models, through caches, memory directories (or equivalent, to hold state and speed up remote memory access) is the responsibility of the end points (processors, memory, and possibly I/O devices), using RapidIO operations. RapidIO provides the operations to construct a wide variety of systems, based on programming models that range from strong   consistency   through   total   store   ordering   to   weak   ordering. </P>

<Table>
<TR>
<TD>
<P>Inter-operability between end </P>
</TD>

<TD>
<P>points supporting </P>
</TD>

<TD>
<P>different </P>
</TD>
</TR>

<TR>
<TD>
<P>coherency/caching/directory  models  is </P>
</TD>

<TD>
<P>not  guaranteed.  However, </P>
</TD>

<TD>
<P>groups  of </P>
</TD>
</TR>
</Table>

<P> </P>

<P>RapidIO Trade Association 11 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>end-points with conforming models can be linked to others conforming to different models on the same RapidIO fabric. These different groups can communicate through RapidIO messaging or I/O operations. Any reference to these areas within the RapidIO architecture specification are for illustration only. </P>

<P> </P>

<P>The RapidIO Interconnect Globally Shared Memory Logical Specification assumes that the reader is familiar with the concepts and terminology of cache coherent systems in general and with CC-NUMA systems in specific. Further information on shared memory concepts can be found in: </P>

<P> </P>

<P>Daniel   E.   Lenoski   and   Wolf-Dietrich   Weber,   &#8220;Scalable   Shared-Memory </P>

<P>Multiprocessing&#8221;, Morgan Kaufmann, 1995. and </P>

<P>David  Culler,  Jaswinder  Pal  Singh,  and  Anoop  Gupta:  &#8220;Parallel  Computer </P>

<P>Architecture: A Hardware/Software Approach&#8221;, Morgan Kaufmann, 1998 </P>

<P> </P>

<P> </P>

<P>1.2.1  Memory System </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_743.jpg"/>
</Figure>

<P>Under the globally shared distributed memory programming model, memory may be physically located in different places in the machine yet may be shared amongst different processing elements. Typically, mainstream system architectures have addressed  shared  memory  using  transaction  broadcasts  sometimes  known  as bus-based snoopy protocols. These are usually implemented through a centralized memory controller for which all devices have equal or uniform access. Figure 1-1 shows a typical bus-based shared memory system. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_744.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_745.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_746.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P>A </P>

<P>Processor </P>

<P>B </P>

<P>Processor </P>

<P>C </P>

<P>Processor </P>

<P>D </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_747.jpg"/>
</Figure>

<P>Snoopy-bus </P>

<P> </P>

<P> </P>

<P> </P>

<P>Bridge </P>

<P>MPIC </P>

<P> </P>

<P> </P>

<P>XBUS </P>

<P> </P>

<P>Memory </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_748.jpg"/>
</Figure>

<P>PCI </P>

<P> </P>

<P>Figure 1-1. A Snoopy Bus-Based System </P>

<P> </P>

<P>Super computers, massively parallel, and clustered machines that have distributed memory systems must use a different technique from broadcasting for maintaining memory coherency. Because a broadcast snoopy protocol in these machines is not efficient given the number of devices that must participate and the latency and transaction overhead involved, coherency mechanisms such as memory directories </P>

<P> </P>

<P>12 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>or distributed linked lists are required to keep track of where the most current copy of data resides. These schemes are often referred to as cache coherent non-uniform memory access (CC-NUMA) protocols. A typical distributed memory system architecture is shown in Figure 1-2. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P>A </P>

<P>Processor </P>

<P>B </P>

<P>Processor </P>

<P>A </P>

<P>Processor </P>

<P>B </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_749.jpg"/>
</Figure>

<P>Snoopy-bus </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_750.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_751.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_752.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_753.jpg"/>
</Figure>

<P>Snoopy-bus </P>

<P> </P>

<P> </P>

<P>Bridge </P>

<P> </P>

<P>Interconnect </P>

<P>Fabric </P>

<P>Bridge </P>

<P> </P>

<P>Memory </P>

<P> </P>

<P> </P>

<P>PCI </P>

<P> </P>

<P> </P>

<P>PCI </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_754.jpg"/>
</Figure>

<P>Memory </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_755.jpg"/>
</Figure>

<P>Figure 1-2. A Distributed Memory System </P>

<P> </P>

<P>For RapidIO, a relatively simple directory-based coherency scheme is chosen. For this method each memory controller is responsible for tracking where the most current copy of each data element resides in the system. RapidIO furnishes a variety of ISA specific cache control and operating system support operations such as block flushes and TLB synchronization mechanisms. </P>

<P> </P>

<P>To reduce the directory overhead required, the architecture is optimized around small clusters of 16 processors known as coherency domains. With the concept of domains, it is possible for multiple coherence groupings to coexist in the interconnect as tightly coupled processing clusters. </P>

<P> </P>

<P> </P>

<P>1.3 Features of the Globally Shared Memory Specification </P>

<P> </P>

<P>The following are features of the RapidIO GSM specification designed to satisfy the needs of various applications and systems: </P>

<P> </P>

<P> </P>

<P>1.3.1  Functional Features </P>

<P>&#8226; A cache coherent non-uniform memory access (CC-NUMA) system architecture is supported to provide a globally shared memory model because physics is forcing component interfaces in many high-speed designs to be point-to-point instead of traditional bus-based. </P>

<P>&#8226; The size of processor memory requests are either in the cache coherence granularity, or smaller. The coherence granule size may be different for different processor families or implementations. </P>

<P> </P>

<P>RapidIO Trade Association 13 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Instruction sets in RapidIO support a variety of cache control and other operations such as block flushes. These functions are supported to run legacy applications and operating systems. </P>

<P> </P>

<P> </P>

<P>1.3.2  Physical Features </P>

<P>&#8226; RapidIO packet definition is independent of the width of the physical interface to other devices on the interconnect fabric. </P>

<P>&#8226; The protocols and packet formats are independent of the physical interconnect topology. The protocols work whether the physical fabric is a point-to-point ring, a bus, a switched multi-dimensional network, a duplex serial connection, and so forth. </P>

<P>&#8226; RapidIO is not dependent on the bandwidth or latency of the physical fabric. </P>

<P>&#8226; The protocols handle out-of-order packet transmission and reception. </P>

<P>&#8226; Certain devices have bandwidth and latency requirements for proper operation. </P>

<P>RapidIO does not preclude an implementation from imposing these constraints within the system. </P>

<P> </P>

<P> </P>

<P>1.3.3  Performance Features </P>

<P>&#8226; Packet headers must be as small as possible to minimize the control overhead and be organized for fast, efficient assembly and disassembly. </P>

<P>&#8226; 48- and 64-bit addresses are required in the future, and must be supported initially. </P>

<P>&#8226; An interventionist (non-memory owner, direct-to-requestor data transfer, analogous to a cache-to-cache transfer) protocol saves a large amount of latency for memory accesses that cause another processing element to provide the requested data. </P>

<P>&#8226; Multiple transactions must be allowed concurrently in the system, otherwise a majority of the potential system throughput is wasted. </P>

<P> </P>

<P> </P>

<P>1.4 Contents </P>

<P> </P>

<P>Following are the contents of the RapidIO Interconnect Globally Shared Memory </P>

<P>Logical Specification: </P>

<P> </P>

<P>&#8226; Chapter 1, &#8220;Overview,&#8221; describes the set of operations and transactions supported by the RapidIO globally shared memory protocols. </P>

<P>&#8226; Chapter 2, &#8220;System Models,&#8221; introduces some possible devices that could participate in a RapidIO GSM system environment. The chapter explains the memory directory-based mechanism that tracks memory accesses and maintains cache coherence. Transaction ordering and deadlock prevention are also covered. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; Chapter 3, &#8220;Operation Descriptions,&#8221; describes the set of operations and transactions supported by the RapidIO globally-shared memory (GSM) protocols. </P>

<P>&#8226; Chapter 4, &#8220;Packet Format Descriptions,&#8221; contains the packet format definitions for the GSM specification. The two basic types, request and response packets, with their sub-types and fields are defined. The chapter explains how memory read latency is handled by RapidIO. </P>

<P>&#8226; Chapter 5, &#8220;Globally Shared Memory Registers,&#8221; describes the visible register set that allows an external processing element to determine the globally shared memory capabilities, configuration, and status of a processing element using this logical specification. Only registers or register bits specific to the GSM logical specification are explained. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and bit definitions. </P>

<P>&#8226; Chapter 6, &#8220;Communication Protocols,&#8221; contains the communications protocol definitions for this GSM specification. </P>

<P>&#8226; Chapter 7, &#8220;Address Collision Resolution Tables,&#8221; explains the actions necessary under the RapidIO GSM model to resolve address collisions. </P>

<P> </P>

<P> </P>

<P>1.5 Terminology </P>

<P> </P>

<P>Refer to the Glossary at the back of this document. </P>

<P> </P>

<P> </P>

<P>1.6 Conventions </P>

<P>|| Concatenation, used to indicate that two fields are physically associated as consecutive bits </P>

<P> </P>

<P>ACTIVE_HIGH Names of active high signals are shown in uppercase text with no overbar. Active-high signals are asserted when high and not asserted when low. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_756.jpg"/>
</Figure>

<P>ACTIVE_LOW Names of active low signals are shown in uppercase text with an overbar. Active low signals are asserted when low and not asserted when high. </P>

<P>italics Book titles in text are set in italics. </P>

<P> </P>

<P>REG[FIELD] Abbreviations or acronyms for registers are shown in uppercase text. Specific bits, fields, or ranges appear in brackets. </P>

<P>TRANSACTION Transaction types are expressed in all caps. operation Device operation types are expressed in plain text. n A decimal value. </P>

<P>[n-m] Used to express a numerical range from n to m. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>0bnn A binary value, the number of bits is determined by the number of digits. </P>

<P>0xnn A hexadecimal value, the number of bits is determined by the number of digits or from the surrounding context; for example, 0xnn may be a 5, 6, 7, or 8 bit value. </P>

<P>x This value is a don&#8217;t care </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 System Models </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This overview introduces some possible devices in a RapidIO system. </P>

<P> </P>

<P> </P>

<P>2.2 Processing Element Models </P>

<P> </P>

<P>Figure 2-1 describes a possible RapidIO-based computing system. The processing element is a computer device such as a processor attached to a local memory and also attached to a RapidIO system interconnect. The bridge part of the system provides I/O subsystem services such as high-speed PCI interfaces and gigabit ethernet ports, interrupt control, and other system support functions. Multiple processing elements require cache coherence support in the RapidIO protocol to preserve the traditional globally shared memory programming model (discussed in Section 2.3.1, &#8220;Globally Shared Memory System Model&#8221;). </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_757.jpg"/>
</Figure>

<P>Processing </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_758.jpg"/>
</Figure>

<P>Element A </P>

<P>Processing </P>

<P>Element B </P>

<P>Processing </P>

<P>Element C </P>

<P>Processing </P>

<P>Element D </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_759.jpg"/>
</Figure>

<P>Memory </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_760.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_761.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_762.jpg"/>
</Figure>

<P>Memory </P>

<P>Memory </P>

<P>Memory </P>

<P> </P>

<P>RapidIO System Interconnect Fabric </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI A </P>

<P> </P>

<P> </P>

<P>Bridge </P>

<P>MPIC </P>

<P>PCI B XBUS </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_763.jpg"/>
</Figure>

<P>USB </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_764.jpg"/>
</Figure>

<P> </P>

<P>Figure 2-1. A Possible RapidIO-Based Computing System </P>

<P> </P>

<P>A processing element containing a processor typically has associated with it a caching hierarchy to improve system performance. The RapidIO protocol supports a set of operations sufficient to fulfill the requirements of a processor with a caching hierarchy and associated support logic such as a processing element. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>RapidIO is defined so that many types of devices can be designed for specific applications and connected to the system interconnect. These devices may participate in the cache coherency protocol, act as a DMA device, utilize the message passing facilities to communicate with other devices on the interconnect, and so forth. A bridge could be designed, for example, to use the message passing facility to pass ATM packets to and from a processing element for route processing. The following sections describe several possible processing elements. </P>

<P> </P>

<P> </P>

<P>2.2.1  Processor-Memory Processing Element Model </P>

<P> </P>

<P>Figure 2-2 shows an example of a processing element consisting of a processor connected to an agent device. The agent carries out several services on behalf of the processor. Most importantly, it provides access to a local memory that has much lower latency than memory that is local to another processing element (remote memory accesses). It also provides an interface to the RapidIO interconnect to service those remote memory accesses. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_765.jpg"/>
</Figure>

<P>Local Interconnect </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_766.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_767.jpg"/>
</Figure>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P>Remote </P>

<P>Cache </P>

<P> </P>

<P>Figure 2-2. Processor-Memory Processing Element Example </P>

<P> </P>

<P>In support of the remote accesses, the agent maintains a cache of remote accesses that includes all remote data currently residing in and owned by the local processor. This cache may be either external or internal to the agent device. </P>

<P> </P>

<P>Agent caching is necessary due to the construction of the RapidIO cache coherence protocol combined with the cache hierarchy behavior in modern processors. Many modern processors have multiple level non-inclusive caching structures that are maintained independently. This implies that when a coherence granule is cast out of the processor, it may or may not be returning ownership of the granule to the memory system. The RapidIO protocol requires that ownership of a coherence granule be guaranteed to be returned to the system on demand and without ambiguous cache state changes as with the castout behavior. The remote cache can guarantee that a coherence granule requested by the system is owned locally and can be returned to the home memory (the physical memory containing the coherence </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>granule) on demand. A processing element that is fully integrated would also need to support this behavior. </P>

<P> </P>

<P> </P>

<P>2.2.2  Integrated Processor-Memory Processing Element Model </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_768.jpg"/>
</Figure>

<P>Another form of a processor-memory processing element is a fully integrated component that is designed specifically to connect to a RapidIO interconnect system as shown in Figure 2-3. This type of device integrates a memory system and other support logic with a processor on the same piece of silicon or within the same package. Because such a device is designed specifically for RapidIO, a remote cache is not required because the proper support can be designed into the processor and its associated logic rather than requiring an agent to compensate for a stand alone processor&#8217;s behavior. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_769.jpg"/>
</Figure>

<P>Memory </P>

<P> </P>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-3. Integrated Processor-Memory Processing Element Example </P>

<P> </P>

<P>2.2.3  Memory-Only Processing Element Model </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_770.jpg"/>
</Figure>

<P>A different processing element may not contain a processor at all, but may be a memory-only device as in Figure 2-4. This type of device is much simpler than a processor as it is only responsible for responding to requests from the external system, not from local requests as in the processor-based model. As such, its memory is remote for all processors in the system. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P>Control </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_771.jpg"/>
</Figure>

<P>Memory </P>

<P> </P>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P> </P>

<P>Figure 2-4. Memory-Only Processing Element Example </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.2.4  Processor-Only Processing Element </P>

<P> </P>

<P>Similar to a memory-only element, a processor-only element has no local memory. A processor-only processing element is shown in Figure 2-5. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_772.jpg"/>
</Figure>

<P>Local Interconnect </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_773.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_774.jpg"/>
</Figure>

<P>RapidIO-based </P>

<P>System Interconnect </P>

<P>Remote </P>

<P>Cache </P>

<P> </P>

<P>Figure 2-5. Processor-Only Processing Element Example </P>

<P> </P>

<P>2.2.5  I/O Processing Element </P>

<P> </P>

<P>This type of processing element is shown as the bridge in Figure 2-1. This device has distinctly different behavior than a processor or a memory. An I/O device only needs to move data into and out of local or remote memory in a cache coherent fashion. This means that if the I/O device needs to read from memory, it only needs to obtain a known good copy of the data to write to the external device (such as a disk drive or video display). If the I/O device needs to write to memory, it only needs to get ownership of the coherence granule returned to the home memory and not take ownership for itself. Both of these operations have special support in the RapidIO protocol. </P>

<P> </P>

<P> </P>

<P>2.2.6  Switch Processing Element </P>

<P> </P>

<P>A switch processing element is a device that allows communication with other processing elements through the switch. A switch may be used to connect a variety of  RapidIO  compliant  processing  elements. A  possible  switch  is  shown  in Figure 2-6. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Switch </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_775.jpg"/>
</Figure>

<P>Figure 2-6. Switch Processing Element Example </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_776.jpg"/>
</Figure>

<P> </P>

<P>2.3 Programming Models </P>

<P> </P>

<P>RapidIO supports applications developed under globally shared memory and software-managed cache coherence programming models. </P>

<P> </P>

<P> </P>

<P>2.3.1  Globally Shared Memory System Model </P>

<P> </P>

<P>The preferred programming model for modern computer systems provides memory that is accessible from all processors in a cache coherent fashion. This model is also known as GSM, or globally shared memory. For traditional bus-based computer systems this is not a difficult technical problem to solve because all participants in the cache coherence mechanism see all memory activity simultaneously, meaning that communication between processors is very fast and handled without explicit software control. However, in a non-uniform memory access system, this simultaneous memory access visibility is not the case. </P>

<P> </P>

<P>With a distributed memory system, cache coherence needs to be maintained through some tracking mechanism that keeps records of memory access activity and explicitly notifies specific cache coherence participant processing elements when a cache coherence hazard is detected. For example, if a processing element wishes to write to a memory address, all participant processing elements that have accessed that coherence granule are notified to invalidate that address in their caches. Only when all of the participant processing elements have completed the invalidate operation and replied back to the tracking mechanism is the write allowed to proceed. </P>

<P> </P>

<P>The tracking mechanism preferred for the RapidIO protocol is the memory directory based system model. This system model allows efficient, moderate scalability with a reasonable amount of information storage required for the tracking mechanism. </P>

<P> </P>

<P>Cache coherence is defined around the concept of domains. The RapidIO protocol assumes a memory directory based cache coherence mechanism. Because the storage requirements for the directory can be high, the protocol was optimized assuming a 16-participant domain size as a reasonable coherence scalability limit. With this limit in mind, a moderately scalable system of 16 participants can be </P>

<P> </P>

<P>RapidIO Trade Association 21 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>designed, possibly using a multicast mechanism in the transport layer for better efficiency. This size does not limit a system designer from defining a larger or a smaller coherent system such as the four processing element system in Figure 2-1 on page 17 since the number of domains and the number of participants is flexible. The total number of coherence domains and the scalability limit are determined by the number of transport bits allowed by the appropriate transport layer specification. </P>

<P> </P>

<P>Table 2-1 describes an example of the directory states assumed for the RapidIO protocol for a small four-processing element cache coherent system (the table assumes that processor 0 is the local processor). Every coherence granule that is accessible by a remote processing element has this 4-bit field associated with it, so some state storage is required for each globally shared granule. The least significant bit (the right most, bit 3) indicates that a processing element has taken ownership of a coherence granule. The remaining three bits indicate that processing elements have accessed that coherence granule, or the current owner if the granule has been modified, with bit 0 corresponding to processor 3, bit 1 corresponding to processor </P>

<P>2, and bit 2 corresponding to processor 1. These bits are also known as the sharing mask or sharing list. </P>

<P> </P>

<P>Owing to the encoding of the bits, the local processing element is always assumed to have accessed the granule even if it has not. This definition allows us to know exactly which processing elements have participated in the cache coherency protocol for each shared coherence granule at all times. Other state definitions can be implemented as long as they encompass the MSL (modified, shared, local) state functionality described here. </P>

<P> </P>

<P>Table 2-1. RapidIO Memory Directory Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>State </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0000 </P>
</TD>

<TD>
<P>Processor 0 (local) shared </P>
</TD>
</TR>

<TR>
<TD>
<P>0001 </P>
</TD>

<TD>
<P>Processor 0 (local) modified </P>
</TD>
</TR>

<TR>
<TD>
<P>0010 </P>
</TD>

<TD>
<P>Processor 1, 0 shared </P>
</TD>
</TR>

<TR>
<TD>
<P>0011 </P>
</TD>

<TD>
<P>Processor 1 modified </P>
</TD>
</TR>

<TR>
<TD>
<P>0100 </P>
</TD>

<TD>
<P>Processor 2, 0 shared </P>
</TD>
</TR>

<TR>
<TD>
<P>0101 </P>
</TD>

<TD>
<P>Processor 2 modified </P>
</TD>
</TR>

<TR>
<TD>
<P>0110 </P>
</TD>

<TD>
<P>Processor 2, 1, 0 shared </P>
</TD>
</TR>

<TR>
<TD>
<P>0111 </P>
</TD>

<TD>
<P>Illegal </P>
</TD>
</TR>

<TR>
<TD>
<P>1000 </P>
</TD>

<TD>
<P>Processor 3, 0 shared </P>
</TD>
</TR>

<TR>
<TD>
<P>1001 </P>
</TD>

<TD>
<P>Processor 3 modified </P>
</TD>
</TR>

<TR>
<TD>
<P>1010 </P>
</TD>

<TD>
<P>Processor 3, 1, 0 shared </P>
</TD>
</TR>

<TR>
<TD>
<P>1011 </P>
</TD>

<TD>
<P>Illegal </P>
</TD>
</TR>

<TR>
<TD>
<P>1100 </P>
</TD>

<TD>
<P>Processor 3, 2, 0 shared </P>
</TD>
</TR>

<TR>
<TD>
<P>1101 </P>
</TD>

<TD>
<P>Illegal </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 2-1. RapidIO Memory Directory Definition (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1110 </P>
</TD>

<TD>
<P>Processor 3, 2, 1, 0 shared </P>
</TD>
</TR>

<TR>
<TD>
<P>1111 </P>
</TD>

<TD>
<P>Illegal </P>
</TD>
</TR>
</Table>

<P> </P>

<P>When a coherence granule is referenced, the corresponding 4-bit coherence state is examined by the memory controller to determine if the access can be handled in memory, or if data must be obtained from the current owner (a shared granule is owned by the home memory). Coherence activity in the system is started using the cache coherence protocol, if it is necessary to do so, to complete the memory operation. </P>

<P> </P>

<P>2.3.1.1  Software-Managed Cache Coherence Programming Model </P>

<P> </P>

<P>The software-managed cache coherence programming model depends upon the application programmer to guarantee that the same coherence granule is not resident in more than one cache in the system simultaneously if it is possible for that coherence granule to be written by one of the processors. The application software allows sharing of written data by using cache manipulation instructions to flush these coherence granules to memory before they are read by another processor. This programming model is useful in transaction and distributed processing types of systems. </P>

<P> </P>

<P> </P>

<P>2.4 System Issues </P>

<P> </P>

<P>The following sections describe transaction ordering and system deadlock considerations in a RapidIO GSM system. </P>

<P> </P>

<P> </P>

<P>2.4.1  Operation Ordering </P>

<P> </P>

<P>Operation completion ordering in a globally shared memory system is managed by the completion units of the processing elements participating in the coherence protocol and by the coherence protocol itself. </P>

<P> </P>

<P> </P>

<P>2.4.2  Transaction Delivery </P>

<P> </P>

<P>There are two basic types of delivery schemes that can be built using RapidIO processing elements: unordered and ordered. The RapidIO logical protocols assume that all outstanding transactions to another processing element are delivered in an arbitrary order. In other words, the logical protocols do not rely on transaction interdependencies for operation. RapidIO also allows completely ordered delivery systems to be constructed. Each type of system puts different constraints on the implementation of the source and destination processing elements and any intervening hardware. The specific mechanisms and definitions of how RapidIO enforces transaction ordering are discussed in the appropriate physical layer specification. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.4.3  Deadlock Considerations </P>

<P> </P>

<P>A deadlock can occur if a dependency loop exists. A dependency loop is a situation where a loop of buffering devices is formed, in which forward progress at each device is dependent upon progress at the next device. If no device in the loop can make progress then the system is deadlocked. </P>

<P> </P>

<P>The simplest solution to the deadlock problem is to discard a packet. This releases resources in the network and allows forward progress to be made. RapidIO is designed to be a reliable fabric for use in real time tightly coupled systems, therefore, discarding packets is not an acceptable solution. </P>

<P> </P>

<P>In order to produce a system with no chance of deadlock it is required that a deadlock free topology be provided for response-less operations. Dependency loops to single direction packets can exist in unconstrained switch topologies. Often the dependency loop can be avoided with simple routing rules. Topologies like hypercubes or three-dimensional meshes, physically contain loops. In both cases, routing is done in several dimensions (x,y,z). If routing is constrained to the x dimension, then y, then z (dimension ordered routing), then topology related dependency loops are avoided in these structures. </P>

<P> </P>

<P>In addition, a processing element design shall not form dependency links between its input and output port. A dependency link between input and output ports occurs if a processing element is unable to accept an input packet until a waiting packet can be issued from the output port. </P>

<P> </P>

<P>RapidIO supports operations, such as coherent read-for-ownership operations, that require responses to complete. These operations can lead to a dependency link between an processing element&#8217;s input port and output port. </P>

<P> </P>

<P>As an example of an input to output port dependency, consider a processing element where the output port queue is full. The processing element can not accept a new request at its input port since there is no place to put the response in the output port queue. No more transactions can be accepted at the input port until the output port is able to free entries in the output queue by issuing packets to the system. </P>

<P> </P>

<P>A further consideration is that of the read-for-ownership operation colliding with a castout of the requested memory address by another processing element. In order for the read-for-ownership operation to complete the underlying castout operation must complete. Therefore the castout must be given higher preference in the system in order to move ahead of other operations in order to break up the dependency. </P>

<P> </P>

<P>The method by which a RapidIO system maintains a deadlock free environment is described in the appropriate Physical Layer specification. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Operation Descriptions </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This chapter describes the set of operations and transactions supported by the RapidIO globally-shared memory (GSM) protocols. The opcodes and packet formats are described in Chapter 4, &#8220;Packet Format Descriptions.&#8221; The complete protocols are described in Chapter 6, &#8220;Communication Protocols.&#8221; </P>

<P> </P>

<P>The RapidIO operation protocols use request/response transaction pairs through the interconnect fabric. A processing element sends a request transaction to another processing element if it requires an activity to be carried out. The receiving processing element responds with a response transaction when the request has been completed or if an error condition is encountered. Each transaction is sent as a packet through the interconnect fabric. For example, a processing element that requires data from home memory in another processing element sends a READ_HOME transaction in a request packet. The receiving element then reads its local memory at the requested address and returns the data in a DONE transaction via a response packet. Note that not all requests require responses; some requests assume that the desired activity will complete properly. </P>

<P> </P>

<P>A number of possible response transactions can be received by a requesting processing element: </P>

<P> </P>

<P>&#8226; A DONE response indicates to the requestor that the desired transaction has completed and also returns data for read-type transactions as described above. </P>

<P>&#8226; The INTERVENTION, DONE_INTERVENTION, and DATA_ONLY responses are generated as part of the processing element-to-processing element (as opposed to processing element-to-home memory) data transfer mechanism defined by the cache coherence protocol. The INTERVENTION and DONE_INTERVENTION responses are abbreviated as INTERV and DONE_INTERV in this chapter. </P>

<P>&#8226; The NOT_OWNER and RETRY responses are received when there are address conflicts within the system that need resolution. </P>

<P>&#8226; An ERROR response means that the target of the transaction encountered an unrecoverable error and could not complete the transaction. </P>

<P> </P>

<P>Packets may contain additional information that is interpreted by the interconnect fabric to route the packets through the fabric from the source to the destination, such </P>

<P> </P>

<P>RapidIO Trade Association 25 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>as a device number. These requirements are described in the appropriate RapidIO </P>

<P>transport layer specification and are beyond the scope of this specification. </P>

<P> </P>

<P>Depending upon the interconnect fabric, other packets may be generated as part of the physical layer protocol to manage flow control, errors, etc. Flow control and other fabric-specific communication requirements are described in the appropriate RapidIO physical layer specification and are beyond the scope of this document. </P>

<P> </P>

<P>Each request transaction sent into the system is marked with a transaction ID that is unique for each requestor and responder processing element pair. This transaction ID allows a response to be easily matched to the original request when it is returned to the requestor. An end point cannot reuse a transaction ID value to the same destination until the response from the original transaction has been received by the requestor. The number of outstanding transactions that may be supported is implementation dependent. </P>

<P> </P>

<P>The transaction behaviors are also described as state machine behavior in Chapter 6, &#8220;Communication Protocols&#8221;. </P>

<P> </P>

<P> </P>

<P>3.2 GSM Operations Cross Reference </P>

<P> </P>

<P>Table 3-1 contains a cross reference of the GSM operations defined in this RapidIO </P>

<P>specification and their system usage. </P>

<P> </P>

<P>Table 3-1. GSM Operations Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Operation </P>
</TD>

<TD>
<P>Transactions </P>

<P>Used </P>
</TD>

<TD>
<P> </P>

<P>Possible System Usage </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>

<TD>
<P> </P>

<P>Packet Format </P>
</TD>

<TD>
<P> </P>

<P>Protocol </P>
</TD>
</TR>

<TR>
<TD>
<P>Read </P>
</TD>

<TD>
<P>READ_HOME, READ_OWNER, RESPONSE </P>
</TD>

<TD>
<P>CC-NUMA operation </P>
</TD>

<TD>
<P>Section 3.3.1 page 28 </P>
</TD>

<TD>
<P>Types 1 and 2: Section 4.2.5 page 50 and Section 4.2.6 page 51 </P>
</TD>

<TD>
<P>Section 6.4 page 68 </P>
</TD>
</TR>

<TR>
<TD>
<P>Instruction read </P>
</TD>

<TD>
<P>IREAD_HOME, READ_OWNER, RESPONSE </P>
</TD>

<TD>
<P>Combination of CC-NUMA and software-maintained coherence of instruction caches </P>
</TD>

<TD>
<P>Section 3.3.2 page 29 </P>
</TD>

<TD>
<P>Type 2 </P>

<P>Section 4.2.6 page 51 </P>
</TD>

<TD>
<P>Section 6.4 page 68 </P>
</TD>
</TR>

<TR>
<TD>
<P>Read-for- ownership </P>
</TD>

<TD>
<P>READ_TO_OWN_ HOME, READ_TO_OWN_ OWNER, DKILL_SHARER RESPONSE </P>
</TD>

<TD>
<P>CC-NUMA operation </P>
</TD>

<TD>
<P>Section 3.3.3 page 31 </P>
</TD>

<TD>
<P>Types 1 and 2: Section 4.2.5 page 50 and Section 4.2.6 page 51 </P>
</TD>

<TD>
<P>Section 6.6 page 75 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data cache invalidate </P>
</TD>

<TD>
<P>DKILL_HOME, DKILL_SHARER, RESPONSE </P>
</TD>

<TD>
<P>CC-NUMA operation; software-maintained coherence operation </P>
</TD>

<TD>
<P>Section 3.3.4 page 33 </P>
</TD>

<TD>
<P>Type 2 </P>

<P>Section 4.2.6 page 51 </P>
</TD>

<TD>
<P>Section 6.7 page 79 </P>
</TD>
</TR>

<TR>
<TD>
<P>Castout </P>
</TD>

<TD>
<P>CASTOUT, RESPONSE </P>
</TD>

<TD>
<P>CC-NUMA operation </P>
</TD>

<TD>
<P>Section 3.3.5 page 34 </P>
</TD>

<TD>
<P>Type 5 </P>

<P>Section 4.2.8 page 52 </P>
</TD>

<TD>
<P>Section 6.8 page 82 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 3-1. GSM Operations Cross Reference (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Operation </P>
</TD>

<TD>
<P>Transactions </P>

<P>Used </P>
</TD>

<TD>
<P> </P>

<P>Possible System Usage </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>

<TD>
<P> </P>

<P>Packet Format </P>
</TD>

<TD>
<P> </P>

<P>Protocol </P>
</TD>
</TR>

<TR>
<TD>
<P>TLB </P>

<P>invalidate-entry </P>
</TD>

<TD>
<P>TLBIE, RESPONSE </P>
</TD>

<TD>
<P>Software-maintained coherence of page table entries </P>
</TD>

<TD>
<P>Section 3.3.6 </P>
</TD>

<TD>
<P>Type 2 </P>

<P>Section 4.2.6 </P>
</TD>

<TD>
<P>Section 6.9 </P>
</TD>
</TR>

<TR>
<TD>
<P>TLB </P>

<P>invalidate-entry synchronize </P>
</TD>

<TD>
<P>TLBSYNC, RESPONSE </P>
</TD>

<TD>
<P>Software-maintained coherence of page table entries </P>
</TD>

<TD>
<P>Section 3.3.7 </P>
</TD>

<TD>
<P>Type 2 </P>

<P>Section 4.2.6 </P>
</TD>

<TD>
<P>Section 6.9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Instruction </P>

<P>cache invalidate </P>
</TD>

<TD>
<P>IKILL_HOME, IKILL_SHARER, RESPONSE, </P>
</TD>

<TD>
<P>Software-maintained coherence of instruction caches </P>
</TD>

<TD>
<P>Section 3.3.8 </P>
</TD>

<TD>
<P>Type 2 </P>

<P>Section 4.2.6 </P>
</TD>

<TD>
<P>Section 6.7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data cache flush </P>
</TD>

<TD>
<P>FLUSH, DKILL_SHARER, READ_TO_OWN_ OWNER, RESPONSE </P>
</TD>

<TD>
<P>CC-NUMA flush instructions; </P>

<P>CC-NUMA write-through cache support; </P>

<P>CC-NUMA DMA I/O device </P>

<P>support; </P>

<P>software-maintained coherence operation. </P>
</TD>

<TD>
<P>Section 3.3.9 </P>
</TD>

<TD>
<P>Types 2 and 5: Section 4.2.6 and </P>

<P>Section 4.2.8 </P>
</TD>

<TD>
<P>Section 6.10 </P>
</TD>
</TR>

<TR>
<TD>
<P>I/O read </P>
</TD>

<TD>
<P>IO_READ_HOME, IO_READ_ OWNER, INTERV, RESPONSE </P>
</TD>

<TD>
<P>CC-NUMA DMA, I/O DMA </P>

<P>device support </P>
</TD>

<TD>
<P>Section 3.3.10 </P>
</TD>

<TD>
<P>Types 1 and 2: Section 4.2.5 and </P>

<P>Section 4.2.6 </P>
</TD>

<TD>
<P>Section 6.11 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.3 GSM Operations </P>

<P> </P>

<P>A set of transactions are used to support GSM (cache coherence) operations to cacheable memory space. The following descriptions assume that all requests are to system memory rather than to some other type of device. </P>

<P> </P>

<P>GSM operations occur based on the size of the coherence granule. Changes in the coherence granule for a system do not change any of the operation protocols, only the data payload size. The only exceptions to this are flush and I/O read operations, which may request (in the case of an I/O read), or have (in the case of a flush) a sub-coherence granule to support coherent I/O and write-through caches. Flush operations may also have no data payload in order to support cache manipulation instructions. </P>

<P> </P>

<P>Some transactions are sent to multiple recipients in the process of completing an operation. These transactions can be sent either as a number of directed transactions or as a single transaction if the transport layer has multicast capability. Multicast capability and operation is defined in the appropriate RapidIO transport layer specification. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.3.1  Read Operations </P>

<P> </P>

<P>The READ_HOME, READ_OWNER, and RESPONSE transactions are used during a read operation by a processing element that needs a shared copy of cache-coherent data from the memory system. A read operation always returns one coherence granule-sized data payload. </P>

<P> </P>

<P>The READ_HOME transaction is used by a processing element that needs to read a shared copy of a coherence granule from a remote home memory on another processing element. </P>

<P> </P>

<P>The READ_OWNER transaction is used by a home memory processing element that needs to read a shared copy of a coherence granule that is owned by a remote processing element. </P>

<P> </P>

<P>The following types of read operations are possible: </P>

<P> </P>

<P>&#8226; If the requested data exists in the memory directory as shared, the data can be returned immediately from memory with a DONE RESPONSE transaction and the requesting processing element&#8217;s device ID is added to the sharing mask as shown in Figure 3-1. </P>

<P> </P>

<P> </P>

<P>1  READ_HOME </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>2  DONE, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_777.jpg"/>
</Figure>

<P>Figure 3-1. Read Operation to Remote Shared Coherence Granule </P>

<P> </P>

<P>&#8226; If the requested data exists in the memory directory as modified, the up-to-date (current) data must be obtained from the owner. The home memory then sends a READ_OWNER request to the processing element that owns the coherence granule. The owner passes a copy of the data to the original requestor and to memory, memory is updated, and the directory state is changed from modified and owner to shared by the previous owner and the requesting processing element&#8217;s device ID as shown in Figure 3-2. </P>

<P> </P>

<P> </P>

<P>1  READ_HOME </P>

<P>2  READ_OWNER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Owner </P>

<P> </P>

<P>5  DONE_INTERV </P>

<P> </P>

<P>4  INTERV, data </P>

<P> </P>

<P> </P>

<P>3  DATA_ONLY, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_778.jpg"/>
</Figure>

<P>Figure 3-2. Read Operation to Remote Modified Coherence Granule </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; If the processing element requesting a modified coherence granule happens to be the home for the memory, some of the transactions can be eliminated as shown in Figure 3-3. </P>

<P> </P>

<P>1  READ_OWNER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  INTERV, data </P>

<P> </P>

<P>Owner </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_779.jpg"/>
</Figure>

<P>Figure 3-3. Read Operation to Local Modified Coherence Granule </P>

<P> </P>

<P>3.3.2  Instruction Read Operations </P>

<P> </P>

<P>Some processors have instruction caches that do not participate in the system cache coherence mechanism. Additionally, the instruction cache load may also load a shared instruction and data cache lower in the cache hierarchy. This can lead to a situation where the instruction cache issues a shared read operation to the system for a coherence granule that is owned by that processor&#8217;s data cache, resulting in a cache coherence paradox to the home memory directory. </P>

<P> </P>

<P>Due to this situation, an instruction read operation must behave like a coherent shared read relative to the memory directory and as a non-coherent operation relative to the requestor. Therefore, the behavior of the instruction read operation is nearly identical to a data read operation with the only difference being the way that the apparent coherence paradox is managed. </P>

<P> </P>

<P>The IREAD_HOME and RESPONSE transactions are used during an instruction read operation by a processing element that needs a copy of sharable instructions from the memory system. An instruction read operation always returns one coherence granule-sized data payload. Use of the IREAD_HOME transaction rather than the READ_HOME transaction allows the memory directory to properly handle the paradox case without sacrificing coherence error detection in the system. The IREAD_HOME transaction participates in address collision detection at the home memory but does not participate in address collision detection at the requestor. </P>

<P> </P>

<P>The following types of instruction read operations are possible: </P>

<P> </P>

<P>&#8226; If the requested instructions exists in the memory directory as shared, the instructions can be returned immediately from memory and the requesting processing element&#8217;s device ID is added to the sharing mask as shown in Figure 3-4. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>1  IREAD_HOME </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>2  DONE, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_780.jpg"/>
</Figure>

<P>Figure 3-4. Instruction Read Operation to Remote Shared Coherence Granule </P>

<P> </P>

<P>&#8226; If the requested data exists in the memory directory as modified, the up-to-date (current) data must be obtained from the owner. The home memory then sends a READ_OWNER request to the processing element that owns the coherence granule. The owner passes a copy of the data to the original requestor and to memory, memory is updated, and the directory state is changed from modified and owner to shared by the previous owner and the requesting processing element&#8217;s device ID as shown in Figure 3-5. </P>

<P> </P>

<P> </P>

<P>1  IREAD_HOME </P>

<P>2  READ_OWNER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Owner </P>

<P> </P>

<P>5  DONE_INTERV </P>

<P>4  INTERV, data </P>

<P> </P>

<P> </P>

<P>3  DATA_ONLY, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_781.jpg"/>
</Figure>

<P>Figure 3-5. Instruction Read Operation to Remote Modified Coherence Granule </P>

<P> </P>

<P>&#8226; If the processing element requesting a modified coherence granule happens to be the home for the memory the READ_OWNER transaction is used to obtain the coherence granule as shown in Figure 3-6. </P>

<P> </P>

<P>1  READ_OWNER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  INTERV, data </P>

<P> </P>

<P>Owner </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_782.jpg"/>
</Figure>

<P>Figure 3-6. Instruction Read Operation to Local Modified Coherence Granule </P>

<P> </P>

<P>&#8226; The apparent paradox case is if the requesting processing element is the owner of the coherence granule as shown in Figure 3-7. The home memory sends a READ_OWNER transaction back to the requesting processing element with the source and secondary ID set to the home memory ID, which indicates that the response behavior should be an INTERVENTION transaction rather than an INTERVENTION and a DATA_ONLY transaction as shown in </P>

<P>Figure 3-5. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1  IREAD_HOME </P>

<P> </P>

<P> </P>

<P>Requestor and Owner </P>

<P>3  INTERV, data </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  READ_OWNER </P>

<P> </P>

<P> </P>

<P>Home </P>

<P>Memory </P>

<P> </P>

<P> </P>

<P>4  DONE, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_783.jpg"/>
</Figure>

<P>Figure 3-7. Instruction Read Operation Paradox Case </P>

<P> </P>

<P>3.3.3  Read-for-Ownership Operations </P>

<P> </P>

<P>The READ_TO_OWN_HOME, READ_TO_OWN_OWNER, DKILL_SHARER, and RESPONSE transactions are used during read-for-ownership operations by a processing element that needs to write to a coherence granule that does not exist in its caching hierarchy. A read-for-ownership operation always returns one coherence granule-sized data payload. These transactions are used as follows: </P>

<P>&#8226; The READ_TO_OWN_HOME transaction is used by a processing element that needs to read a writable copy of a coherence granule from a remote home memory on another processing element. This transaction causes a copy of the data to be returned to the requestor, from memory if the data is shared, or from the owner if it is modified. </P>

<P>&#8226; The READ_TO_OWN_OWNER transaction is used by a home memory processing element that needs to read a writable copy of a coherence granule that is owned by a remote processing element. </P>

<P>&#8226; The DKILL_SHARER transaction is used by the home memory processing element to invalidate shared copies of the coherence granule in remote processing elements. </P>

<P> </P>

<P>Following are descriptions of the read-for-ownership operations: </P>

<P> </P>

<P>&#8226; If the coherence granule is shared, DKILL_SHARER transactions are sent to the participants indicated in the sharing mask, which results in a cache invalidate operation for the recipients as shown in Figure 3-8. </P>

<P> </P>

<P> </P>

<P>1  READ_TO_OWN_HOME </P>

<P>2  DKILL_SHARER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Sharers </P>

<P> </P>

<P>4  DONE, data </P>

<P> </P>

<P>3  DONEs </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_784.jpg"/>
</Figure>

<P>Figure 3-8. Read-for-Ownership Operation to Remote Shared Coherence Granule </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; If the coherence granule is modified, a READ_TO_OWN_OWNER transaction is sent to the owner, who sends a copy of the data to the requestor (intervention) and marks the address as invalid as shown in Figure 3-9. The final memory directory state shows that the coherence granule is modified and owned by the requestor&#8217;s device ID. </P>

<P>Because the coherence granule in the memory directory was marked as modified, home memory does not necessarily need to be updated. However, the RapidIO protocol requires that a processing element return the modified data and update the memory, allowing some attempt for data recovery if a coherence problem occurs. </P>

<P> </P>

<P>1  READ_TO_OWN_HOME </P>

<P>2  READ_TO_OWN_OWNER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Owner </P>

<P> </P>

<P>5  DONE_INTERV </P>

<P> </P>

<P>4  INTERV, data </P>

<P> </P>

<P> </P>

<P>3  DATA_ONLY, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_785.jpg"/>
</Figure>

<P>Figure 3-9. Read-for-Ownership Operation to Remote Modified Coherence Granule </P>

<P> </P>

<P>&#8226; If the requestor is on the same processing element as the home memory and the coherence granule is shared, a DKILL_SHARER transaction is sent to all sharing processing elements (see Figure 3-10). The final directory state is marked as modified and owned by the local requestor. </P>

<P> </P>

<P> </P>

<P>1  DKILL_SHARER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  DONEs </P>

<P> </P>

<P>Sharers </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_786.jpg"/>
</Figure>

<P>Figure 3-10. Read-for-Ownership Operation to Local Shared Coherence Granule </P>

<P> </P>

<P>&#8226; If the requestor is on the same processing element as the home memory and the coherence granule is owned by a remote processing element, a READ_TO_OWN_OWNER transaction is sent to the owner (see </P>

<P>Figure 3-11). The final directory state is marked as modified and owned by the local requestor. </P>

<P> </P>

<P>1  READ_TO_OWN_OWNER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  INTERV, data </P>

<P> </P>

<P>Owner </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_787.jpg"/>
</Figure>

<P>Figure 3-11. Read-for-Ownership Operation to Local Modified Coherence Granule </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>3.3.4  Data Cache Invalidate Operations </P>

<P> </P>

<P>The DKILL_HOME, DKILL_SHARER, and RESPONSE transactions are requests to invalidate a coherence granule in all of the participants in the coherence domain as follows: </P>

<P> </P>

<P>&#8226; The DKILL_HOME transaction is used by a processing element to invalidate a data coherence granule that has home memory in a remote processing element. </P>

<P>&#8226; The DKILL_SHARER transaction is used by the home memory processing element to invalidate shared copies of the data coherence granule in remote processing elements. </P>

<P> </P>

<P>Data cache invalidate operations are also useful for systems that implement software-maintained cache coherence. In this case, a requestor may send DKILL_HOME and DKILL_SHARER transactions directly to other processing elements without going through home memory as in a CC-NUMA system. The transactions used for the data cache invalidate operation depend on whether the requestor is on the same processing element as the home memory of the coherence granule as follows: </P>

<P>&#8226; If the requestor is not on the same processing element as the home memory of the coherence granule, a DKILL_HOME transaction is sent to the remote home memory processing element. This causes the home memory for the shared coherence granule to send a DKILL_SHARER to all processing elements marked as sharing the granule in the memory directory state except for the requestor (see Figure 3-12). The final memory state shows that the coherence granule is modified and owned by the requesting processing element&#8217;s device ID. </P>

<P> </P>

<P>1  DKILL_HOME </P>

<P>2  DKILL_SHARER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Sharers </P>

<P> </P>

<P>4  DONE </P>

<P> </P>

<P>3  DONEs </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_788.jpg"/>
</Figure>

<P>Figure 3-12. Data Cache Invalidate Operation to Remote Shared Coherence Granule </P>

<P> </P>

<P>&#8226; If the requestor is on the same processing element as the home memory of the coherence granule, the home memory sends a DKILL_SHARER transaction to all processing elements marked as sharing the coherence granule in the memory directory. The final memory state shows the coherence granule modified and owned by the local processor (see Figure 3-13). </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1  DKILL_SHARER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  DONEs </P>

<P> </P>

<P>Sharers </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_789.jpg"/>
</Figure>

<P>Figure 3-13. Data Cache Invalidate Operation to Local Shared Coherence Granule </P>

<P> </P>

<P>3.3.5  Castout Operations </P>

<P> </P>

<P>The CASTOUT and RESPONSE transactions are used in a castout operation by a processing element to relinquish its ownership of a coherence granule and return it to the home memory. The CASTOUT can be treated as a low-priority transaction unless there is an address collision with an incoming request, at which time it must become a high-priority transaction. The CASTOUT causes the home memory to be updated with the most recent data and changes the directory state to owned by home memory and shared (or owned, depending upon the default directory state) by the local processing element (see Figure 3-14). </P>

<P> </P>

<P> </P>

<P>1  CASTOUT, data </P>

<P> </P>

<P> </P>

<P>Requestor Home </P>

<P>Memory </P>

<P> </P>

<P>2  DONE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_790.jpg"/>
</Figure>

<P>Figure 3-14. Castout Operation on Remote Modified Coherence Granule </P>

<P> </P>

<P>A CASTOUT transaction does not participate in address collision detection at the home memory to prevent deadlocks or cache paradoxes caused by packet-to-packet timing in the interconnect fabric. For example, consider a case where processing element A is performing a CASTOUT that collides with an incoming READ_OWNER transaction. If the CASTOUT is not allowed to complete at the home memory, the system will deadlock. If the read operation that caused the READ_OWNER completes (through intervention) before the CASTOUT transaction is received at the home memory, the CASTOUT will appear to be illegal because the directory state will have changed. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>3.3.6  TLB Invalidate-Entry Operations </P>

<P> </P>

<P>The TLBIE and RESPONSE transactions are used for TLB invalidate-entry operations. If the processor TLBs do not participate in the cache coherence protocol, the TLB invalidate-entry operation is used when page table translation entries need to be modified. The TLBIE transaction is sent to all participants in the coherence domain except for the original requestor. A TLBIE transaction has no effect on the memory directory state for the specified address and does not participate in address collisions (see Figure 3-15). </P>

<P> </P>

<P> </P>

<P>1  TLBIE </P>

<P> </P>

<P> </P>

<P> </P>

<P>Requestor </P>

<P>All </P>

<P>Part ts </P>

<P>2  DONEs </P>

<P>icipan </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_791.jpg"/>
</Figure>

<P>Figure 3-15. TLB Invalidate-Entry Operation </P>

<P> </P>

<P>3.3.7  TLB Invalidate-Entry Synchronization Operations </P>

<P> </P>

<P>The TLBSYNC and RESPONSE transactions are used for TLB invalidate-entry synchronization operations. It is used to force the completion of outstanding TLBIE transactions at the participants. The DONE response for a TLBSYNC transaction is only sent when all preceding TLBIE transactions have completed. This operation is necessary due to possible indeterminate completion of individual TLBIE transactions when multiple TLBIE transactions are being executed simultaneously. The TLBSYNC transaction is sent to all participants in the coherence domain except for the original requestor. The transaction has no effect on the memory directory state for the specified address and does not participate in address collisions (see Figure 3-16). </P>

<P> </P>

<P> </P>

<P>1  TLBSYNC </P>

<P> </P>

<P> </P>

<P> </P>

<P>Requestor </P>

<P>All </P>

<P>Part ts </P>

<P>2  DONEs </P>

<P>icipan </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_792.jpg"/>
</Figure>

<P>Figure 3-16. TLB Invalidate-Entry Synchronization Operation </P>

<P> </P>

<P>3.3.8  Instruction Cache Invalidate Operations </P>

<P> </P>

<P>The IKILL_HOME, IKILL_SHARER, and RESPONSE transactions are used during instruction cache invalidate operations to invalidate shared copies of an instruction coherence granule in remote processing elements. Instruction cache invalidate operations are needed if the processor instruction caches do not participate in the cache coherence protocol, requiring instruction cache coherence to </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>be maintained by software. </P>

<P> </P>

<P>An instruction cache invalidate operation has no effect on the memory directory state for the specified address and does not participate in address collisions. Following are descriptions of the instruction cache invalidate operations: </P>

<P> </P>

<P>&#8226; If the requestor is not on the same processing element as the home memory of the coherence granule, an IKILL_HOME transaction is sent to the remote home memory processing element. This causes the home memory for the shared coherence granule to send an IKILL_SHARER to all processing element participants in the coherence domain because the memory directory state only properly tracks data, not instruction, accesses. (See Figure 3-17.) </P>

<P> </P>

<P> </P>

<P>1  IKILL_HOME </P>

<P>2  IKILL_SHARER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Participants </P>

<P> </P>

<P>4  DONE </P>

<P> </P>

<P>3  DONEs </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_793.jpg"/>
</Figure>

<P>Figure 3-17. Instruction Cache Invalidate Operation to Remote Sharable Coherence Granule </P>

<P> </P>

<P>&#8226; If the requestor is on the same processing element as the home memory of the coherence granule, the home memory sends an IKILL_SHARER transaction to all processing element participants in the coherence domain as shown in Figure 3-18. </P>

<P> </P>

<P>1  IKILL_SHARER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  DONEs </P>

<P> </P>

<P>Participants </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_794.jpg"/>
</Figure>

<P>Figure 3-18. Instruction Cache Invalidate Operation to Local Sharable Coherence Granule </P>

<P> </P>

<P>3.3.9  Data Cache Flush Operations </P>

<P> </P>

<P>The FLUSH, DKILL_SHARER, READ_TO_OWN_OWNER, and RESPONSE transactions are used for data cache flush operations, which return ownership of a coherence granule back to the home memory if it is modified and invalidate all copies if the granule is shared. A flush operation with associated data can be used to implement an I/O system write operation and to implement processor write-through and cache manipulation operations. These transactions are used as follows: </P>

<P> </P>

<P>&#8226; The FLUSH transaction is used by a processing element to return the ownership and current data of a coherence granule to home memory. The data payload for the FLUSH transaction is typically the size of the coherence granule for the system but may be multiple double-words or one double-word or less. FLUSH transactions without a data payload are used to support cache </P>

<P> </P>

<P> </P>

<P>36 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>manipulation operations. The memory directory state is changed to owned by home memory and shared (or modified, depending upon the processing element&#8217;s normal default state) by the local processing element. </P>

<P>&#8226; The DKILL_SHARER transaction is used by the home memory processing element to invalidate shared copies of the data coherence granule in remote processing elements. </P>

<P>&#8226; The READ_TO_OWN_OWNER transaction is used by a home memory processing element that needs to retrieve ownership of a coherence granule that is owned by a remote processing element. </P>

<P> </P>

<P>The   FLUSH   transaction   is   able   to   specify   multiple   double-word   and sub-double-word data payloads; however, they must be aligned to byte, half-word, word, or double-word boundaries. Multiple double-word FLUSH transactions cannot exceed the number of double-words in the coherence granule. The write size and alignment for the FLUSH transaction are specified in Table 4-8. Unaligned and non-contiguous operations are not supported and must be broken into multiple FLUSH transactions by the sending processing element. </P>

<P> </P>

<P>A flush operation internal to a processing element that would cause a FLUSH transaction for a remote coherence granule owned by that processing element (for example, attempting a cache write-through operation to a locally owned remote coherence granule) must generate a CASTOUT rather than a FLUSH transaction to properly implement the RapidIO protocol. Issuing a FLUSH under these circumstances generates a memory directory state paradox error in the home memory processing element. </P>

<P> </P>

<P>Following are descriptions of the flush operations: </P>

<P> </P>

<P>&#8226; If a flush operation is to a remote shared coherence granule, the FLUSH transaction is sent to the home memory, which sends a DKILL_SHARER transaction to all of the processing elements marked in the sharing list except for the requesting processing element. The processing elements that receive the DKILL_SHARER transaction invalidate the specified address if it is found shared in their caching hierarchy (see Figure 3-19). </P>

<P> </P>

<P>1  FLUSH, data (opt.) </P>

<P>2  DKILL_SHARER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Sharers </P>

<P> </P>

<P>4  DONE </P>

<P> </P>

<P>3  DONEs </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_795.jpg"/>
</Figure>

<P>Figure 3-19. Flush Operation to Remote Shared Coherence Granule </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 37 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; If the coherence granule is owned by a remote processing element, the home memory sends a READ_TO_OWN_OWNER transaction to it with the secondary (intervention) ID set to the home memory ID instead of the requestor ID. The owner then invalidates the coherence granule in its caching hierarchy and returns the coherence granule data (see Figure 3-20). </P>

<P> </P>

<P> </P>

<P>1  FLUSH, data (opt.) </P>

<P>2  READ_TO_OWN_OWNER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Owner </P>

<P> </P>

<P>4  DONE </P>

<P>3  INTERV, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_796.jpg"/>
</Figure>

<P>Figure 3-20. Flush Operation to Remote Modified Coherence Granule </P>

<P> </P>

<P>&#8226; If the requestor and the home memory for the coherence granule are in the same processing element, DKILL_SHARER transactions are sent to all participants marked in the sharing list (see Figure 3-21). </P>

<P> </P>

<P>1  DKILL_SHARER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2   DONEs </P>

<P> </P>

<P>Sharers </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_797.jpg"/>
</Figure>

<P>Figure 3-21. Flush Operation to Local Shared Coherence Granule </P>

<P> </P>

<P>&#8226; If the requestor and the home memory for the coherence granule are in the same processing element but the coherence granule is owned by a remote processing element, a READ_TO_OWN_OWNER transaction is sent to the owner (see Figure 3-22). </P>

<P> </P>

<P>1  READ_TO_OWN_OWNER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  INTERV, data </P>

<P> </P>

<P>Owner </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_798.jpg"/>
</Figure>

<P>Figure 3-22. Flush Operation to Local Modified Coherence Granule </P>

<P> </P>

<P>3.3.10  I/O Read Operations </P>

<P> </P>

<P>The IO_READ_HOME, IO_READ_OWNER, and RESPONSE transactions are used during I/O read operations by a processing element that needs a current copy of cache-coherent data from the memory system, but does not need to be added to the sharing list in the memory directory state. The I/O read operation is most useful for DMA I/O devices. An I/O read operation always returns the requested size data payload. The requested data payload size can not exceed the size of the coherence </P>

<P> </P>

<P>38 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>granule. These transactions are used as follows: </P>

<P> </P>

<P>&#8226; The IO_READ_HOME transaction is used by a requestor that is not in the same processing element as the home memory for the coherence granule. </P>

<P>&#8226; The IO_READ_OWNER transaction is used by a home memory processing element that needs to read a copy of a coherence granule owned by a remote processing element. </P>

<P> </P>

<P>Following are descriptions of the I/O operations: </P>

<P> </P>

<P>&#8226; If the requested data exists in the memory directory as shared, the data can be returned immediately from memory and the sharing mask is not modified (see Figure 3-24). </P>

<P> </P>

<P>1  IO_READ_HOME </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>2  DONE, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_799.jpg"/>
</Figure>

<P>Figure 3-23. I/O Read Operation to Remote Shared Coherence Granule </P>

<P> </P>

<P>&#8226; If the requested data exists in the memory directory as modified, the home memory sends an IO_READ_OWNER transaction to the processing element that owns the coherence granule. The owner passes a copy of the data to the requesting processing element (intervention) but retains ownership of and responsibility for the coherence granule (see Figure 3-24 and Figure 3-25). </P>

<P> </P>

<P> </P>

<P>1  IO_READ_HOME </P>

<P>2  IO_READ_OWNER </P>

<P> </P>

<P> </P>

<Textbox>
<P>Memory </P>
</Textbox>

<P>Requestor Home </P>

<P> </P>

<P>Owner </P>

<P> </P>

<P>5  DONE_INTERV </P>

<P> </P>

<P>4  INTERV </P>

<P> </P>

<P> </P>

<P>3  DATA_ONLY, data </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_800.jpg"/>
</Figure>

<P>Figure 3-24. I/O Read Operation to Remote Modified Coherence Granule </P>

<P> </P>

<P> </P>

<P>1  IO_READ_OWNER </P>

<P> </P>

<P> </P>

<P>Requestor, Home Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>2  INTERV, data </P>

<P> </P>

<P>Owner </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_801.jpg"/>
</Figure>

<P>Figure 3-25. I/O Read Operation to Local Modified Coherence Granule </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 39 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.4 Endian, Byte Ordering, and Alignment </P>

<P> </P>

<P>RapidIO has double-word (8-byte) aligned big-endian data payloads. This means that the RapidIO interface to devices that are little-endian shall perform the proper endian transformation to format a data payload. </P>

<P> </P>

<P>Operations that specify data quantities that are less than 8 bytes shall have the bytes aligned to their proper byte position within the big-endian double-word, as in the examples shown in Figure 3-26 through Figure 3-28. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_802.jpg"/>
</Figure>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Byte address 0x0000_0002, the proper byte position is shaded. </P>

<P> </P>

<P>Figure 3-26. Byte Alignment Example </P>

<P> </P>

<P> </P>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>MSB </P>
</TD>

<TD>
<P>LSB </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Half-word address 0x0000_0002, the proper byte positions are shaded. </P>

<P> </P>

<P>Figure 3-27. Half-Word Alignment Example </P>

<P> </P>

<P> </P>

<P>Byte 0 1 2 3 4 5 6 7 </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>MSB </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>LSB </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Word address 0x0000_0004, the proper byte positions are shaded. </P>

<P> </P>

<P>Figure 3-28. Word Alignment Example </P>

<P> </P>

<P>For write operations, a processing element shall properly align data transfers to a double-word boundary for transmission to the destination. This alignment may require breaking up a data stream into multiple transactions if the data is not naturally aligned. A number of data payload sizes and double-word alignments are defined to minimize this burden. Figure 3-29 shows a 48-byte data stream that a processing element wishes to write to another processing element through the interconnect fabric. The data displayed in the figure is big-endian and double-word aligned with the bytes to be written shaded in grey. Because the start of the stream and the end of the stream are not aligned to a double-word boundary, the sending processing element shall break the stream into three transactions as shown in the figure. </P>

<P> </P>

<P>The first transaction sends the first three bytes (in byte lanes 5, 6, and 7) and indicates a byte lane 5, 6, and 7 three-byte write. The second transaction sends all of the remaining data except for the final sub-double-word. The third transaction sends the final 5 bytes in byte lanes 0, 1, 2, 3, and 4 indicating a five-byte write in byte </P>

<P> </P>

<P>40 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>lanes 0, 1, 2, 3, and 4. </P>

<P> </P>

<P>Byte </P>

<P>Lane </P>

<P>0 </P>

<P>Byte </P>

<P>Lane </P>

<P>1 </P>

<P>Byte </P>

<P>Lane </P>

<P>2 </P>

<P>Byte </P>

<P>Lane </P>

<P>3 </P>

<P>Byte </P>

<P>Lane </P>

<P>4 </P>

<P>Byte </P>

<P>Lane </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_803.jpg"/>
</Figure>

<P>5 </P>

<P>MSB </P>

<P>Byte </P>

<P>Lane </P>

<P>6 </P>

<P>Byte </P>

<P>Lane </P>

<P>7 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>First transaction sends these three bytes with this double-word alignment </P>

<P> </P>

<P>Second transaction sends these five double-words </P>

<P> </P>

<P> </P>

<P> </P>

<P>LSB </P>

<P>Third transaction sends these five bytes with this double-word alignment </P>

<P> </P>

<P>Double-Word Boundary </P>

<P> </P>

<P> </P>

<P>Figure 3-29. Data Alignment Example </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Packet Format Descriptions </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>

<P>This chapter contains the packet format definitions for the RapidIO Interconnect Globally Shared Memory Logical Specification. There are four types of globally shared memory packet formats: </P>

<P>&#8226; Request </P>

<P>&#8226; Response </P>

<P>&#8226; Implementation-defined </P>

<P>&#8226; Reserved </P>

<P> </P>

<P>The packet formats are intended to be interconnect fabric independent, so the system interconnect can be anything required for a particular application. Reserved formats, unless defined in another logical specification, shall not be used by a device. </P>

<P> </P>

<P> </P>

<P>4.2 Request Packet Formats </P>

<P> </P>

<P>A request packet is issued by a processing element that needs a remote processing element to accomplish some activity on its behalf, such as a memory read operation. The request packet format types and their transactions for the RapidIO Interconnect Globally Shared Memory Logical Specification are shown in Table 4-1. </P>

<P> </P>

<P>Table 4-1. Request Packet Type to Transaction Type Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Request Packet Format Type </P>
</TD>

<TD>
<P> </P>

<P>Transaction Type </P>
</TD>

<TD>
<P> </P>

<P>Definition </P>
</TD>

<TD>
<P> </P>

<P>Document </P>

<P>Section No. </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 0 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>

<TD>
<P>Section 4.2.4 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P> </P>

<P>Type 1 </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Read shared copy of remotely owned coherence granule </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Section 4.2.5 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Read for store of remotely owned coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Read for I/O of remotely owned coherence granule </P>
</TD>

<TD/>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-1. Request Packet Type to Transaction Type Cross Reference (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Request Packet Format Type </P>
</TD>

<TD>
<P> </P>

<P>Transaction Type </P>
</TD>

<TD>
<P> </P>

<P>Definition </P>
</TD>

<TD>
<P> </P>

<P>Document </P>

<P>Section No. </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Type 2 </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Read for store of home memory for coherence granule </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Section 4.2.6 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Read shared copy of home memory for coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Read for I/O of home memory for coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Invalidate to home memory of coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Invalidate to home memory of coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>Invalidate TLB entry </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>Synchronize TLB invalidates </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Read shared copy of home memory for instruction cache </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Force return of ownership of coherence granule to home memory, no update to coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>Invalidate cached copy of coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Invalidate cached copy of coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>Type 3&#8211;4 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.2.7 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P> </P>

<P>Type 5 </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Return ownership of coherence granule to home memory </P>
</TD>

<TD>
<P> </P>

<P>Section 4.2.8 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>FLUSH (with data) </P>
</TD>

<TD>
<P>Force return of ownership of coherence granule to home memory, update returned coherence granule </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>Type 6&#8211;11 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.2.9 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.2.1  Addressing and Alignment </P>

<P> </P>

<P>The size of the address is defined as a system-wide parameter; thus the packet formats do not support mixed local physical address fields simultaneously. The least three significant bits of all addresses are not specified and are assumed to be logic 0. </P>

<P> </P>

<P>The coherence-granule-sized cache-coherent write requests and read responses are aligned to a double-word boundary within the coherence granule, with the specified data payload size matching that of the coherence granule. Sub-double-word data payloads  must  be  padded  and  properly  aligned  within  the  8-byte  boundary. Non-contiguous or unaligned transactions that would ordinarily require a byte mask are not supported. A sending device that requires this behavior must break the operation into  multiple request  transactions. An  example of  this  is  shown  in Section 3.4, &#8220;Endian, Byte Ordering, and Alignment.&#8221; </P>

<P> </P>

<P> </P>

<P>4.2.2  Data Payloads </P>

<P> </P>

<P>Cache coherent systems are very sensitive to memory read latency. One way of reducing the latency is by returning the requested, or critical, double-word first upon a read request. Subsequent double-words are then returned in a sequential fashion. Table 4-2 and Table 4-3 show the return ordering for 32- and 64-byte coherence </P>

<P> </P>

<P>44 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>granules. Sub-double-word data payloads due to I/O read operations start with the requested size as shown. </P>

<P> </P>

<P>Table 4-2. Coherent 32-Byte Read Data Return Ordering </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Requested Double-word </P>
</TD>

<TD>
<P>Double-word Return Ordering </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0, 1, 2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>1, 2, 3, 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>2, 3, 0, 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>3, 0, 1, 2 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 4-3. Coherent 64-Byte Read Data Return Ordering </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Requested Double-word </P>
</TD>

<TD>
<P>Double-word Return Ordering </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0, 1, 2, 3, 4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>1, 2, 3, 0, 4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>2, 3, 0, 1, 4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>3, 0, 1, 2, 4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>4, 5, 6, 7, 0, 1, 2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>5, 6, 7, 4, 0, 1, 2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>6, 7, 4, 5, 0, 1, 2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>7, 4, 5, 6, 0, 1, 2, 3 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Data payloads for cache coherent write-type transactions are always linear starting with the specified address at the first double-word to be written, (including flush transactions that are not the size of the coherence granule). Data payloads that cross the coherence granule boundary can not be specified. This implies that all castout transactions start with the first double-word in the coherence granule. Table 4-4 and Table 4-5  show  the  cache-coherent  write-data  ordering  for  32-  and  64-byte coherence granules, respectively. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-4. Coherent 32-Byte Write Data Payload </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Starting </P>

<P>Double-word </P>
</TD>

<TD>
<P>Number of </P>

<P>Double-words </P>
</TD>

<TD>
<P>Double-word Data Ordering </P>

<P>Within Coherence Granule </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0, 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0, 1, 2 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0, 1, 2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>1, 2 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1, 2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 4-5. Coherent 64-Byte Write Data Payloads </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Starting </P>

<P>Double-word </P>
</TD>

<TD>
<P>Number of </P>

<P>Double-words </P>
</TD>

<TD>
<P>Double-word Data Ordering </P>

<P>Within Coherence Granule </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0, 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0, 1, 2 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0, 1, 2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0, 1, 2, 3, 4 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0, 1, 2, 3, 4, 5 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0, 1, 2, 3, 4, 5, 6 </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>0, 1, 2, 3, 4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>1, 2 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1, 2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>1, 2, 3, 4 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>1, 2, 3, 4, 5 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>1, 2, 3, 4, 5, 6 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>1, 2, 3, 4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>2, 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>2, 3, 4 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>2, 3, 4, 5 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>2, 3, 4, 5, 6 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>2, 3, 4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3, 4 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-5. Coherent 64-Byte Write Data Payloads (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Starting </P>

<P>Double-word </P>
</TD>

<TD>
<P>Number of </P>

<P>Double-words </P>
</TD>

<TD>
<P>Double-word Data Ordering </P>

<P>Within Coherence Granule </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>3, 4, 5 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>3, 4, 5, 6 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>3, 4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>4 </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>4, 5 </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4, 5, 6 </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>4, 5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>5 </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>5, 6 </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>5, 6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>6 </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>6, 7 </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.2.3  Field Definitions for All Request Packet Formats </P>

<P> </P>

<P>Fields that are unique to type 1, type 2, and type 5 formats are defined in their sections. Bit fields that are defined as &#8220;reserved&#8221; shall be assigned to logic 0s when generated and ignored when received. Bit field encodings that are defined as &#8220;reserved&#8221; shall not be assigned when the packet is generated. A received reserved encoding is regarded as an error if a meaningful encoding is required for the transaction and function, otherwise it is ignored. Implementation-defined fields shall be ignored unless the encoding is understood by the receiving device. All packets described are bit streams from the first bit to the last bit, represented in the figures from left to right respectively. </P>

<P> </P>

<P>The following field definitions in Table 4-6 apply to all of the request packet formats. </P>

<P> </P>

<P>Table 4-6. General Field Definitions for All Request Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>ftype </P>
</TD>

<TD>
<P>Format type, represented as a 4-bit value; is always the first four bits in the logical packet stream. </P>
</TD>
</TR>

<TR>
<TD>
<P>wdptr </P>
</TD>

<TD>
<P>Word pointer, used in conjunction with the data size (rdsize and wrsize) fields&#8212;see Table 4-7, Table 4-8, and </P>

<P>Section 3.4. </P>
</TD>
</TR>

<TR>
<TD>
<P>rdsize </P>
</TD>

<TD>
<P>Data size for read transactions, used in conjunction with the word pointer (wdptr) bit&#8212;see Table 4-7 and Section </P>

<P>3.4. </P>
</TD>
</TR>

<TR>
<TD>
<P>wrsize </P>
</TD>

<TD>
<P>Write data size for sub-double-word transactions, used in conjunction with the word pointer (wdptr) bit&#8212;see </P>

<P>Table 4-8 and Section 3.4. For writes greater than one double-word, the size is the maximum payload. </P>
</TD>
</TR>

<TR>
<TD>
<P>rsrv </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>srcTID </P>
</TD>

<TD>
<P>The packet&#8217;s transaction ID. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-6. General Field Definitions for All Request Packets (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>The specific transaction within the format class to be performed by the recipient; also called type or ttype. </P>
</TD>
</TR>

<TR>
<TD>
<P>extended address </P>
</TD>

<TD>
<P>Optional. Specifies the most significant 16 bits of a 50-bit physical address or 32 bits of a 66-bit physical address. </P>
</TD>
</TR>

<TR>
<TD>
<P>xamsbs </P>
</TD>

<TD>
<P>Extended address most significant bits. Further extends the address specified by the address and extended address fields by 2 bits. This field provides 34-, 50-, and 66-bit addresses to be specified in a packet with the xamsbs as the most significant bits in the address. </P>
</TD>
</TR>

<TR>
<TD>
<P>address </P>
</TD>

<TD>
<P>Least significant 29 bits (bits [0-28] of byte address [0-31]) of the double-word physical address </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 4-7. Read Size (rdsize) Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>wdptr </P>
</TD>

<TD>
<P> </P>

<P>rdsize </P>
</TD>

<TD>
<P>Number of </P>

<P>Bytes </P>
</TD>

<TD>
<P> </P>

<P>Byte Lanes </P>
</TD>

<TD>
<P> </P>

<P>Comment </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b10000000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b01000000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00100000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00010000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00001000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000100 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000010 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000001 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b11000000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0b11100000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00110000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0b11111000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00001100 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0b00000111 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00000011 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0b00011111 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0b11110000 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0b00001111 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0b11111100 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0b00111111 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0b11111110 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0b01111111 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>0b11111111 </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>16 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>I/O read only </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>32 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>64 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0-1 </P>
</TD>

<TD>
<P>0b1101&#61472;&#61472;</P>

<P>0b1111 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-8. Write Size (wrsize) Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>wdptr </P>
</TD>

<TD>
<P> </P>

<P>wrsize </P>
</TD>

<TD>
<P>Number of </P>

<P>Bytes </P>
</TD>

<TD>
<P> </P>

<P>Byte Lanes </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b10000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b01000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00100000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00010000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00001000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000010 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00000001 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b11000000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0b11100000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00110000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0b11111000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00001100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>0b00000111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00000011 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>0b00011111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0b11110000 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>0b00001111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0b11111100 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>0b00111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0b11111110 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>0b01111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>0b11111111 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>16 maximum </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>32 maximum </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1100 </P>
</TD>

<TD>
<P>64 maximum </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0-1 </P>
</TD>

<TD>
<P>0b1101-1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.2.4  Type 0 Packet Format (Implementation-Defined) </P>

<P> </P>

<P>The type 0 packet format is reserved for implementation-defined functions such as flow control. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.2.5  Type 1 Packet Format (Intervention-Request Class) </P>

<P> </P>

<P>Type 1 request packets never include data. They are the only request types that can cause an intervention, so the secondary domain, secondary ID, and secondary transaction ID fields are required. The total number of bits available for the secondary domain and secondary ID fields (shown in Figure 4-1) is determined by the size of the transport field defined in the appropriate transport layer specification, so the size (labeled m and n, respectively) of these fields are not specified. The division of the bits between the logical coherence domain and device ID fields is determined by the specific application. For example, an 8 bit transport field allows </P>

<P>16 coherence domains of 16 participants. </P>

<P> </P>

<P>The type 1 packet format is used for the READ_OWNER, READ_TO_OWN_OWNER, and IO_READ_OWNER transactions that are specified in the transaction sub-field column defined in Table 4-9. Type 1 packets are issued only by a home memory controller to allow the third party intervention data transfer. </P>

<P> </P>

<P>Definitions and encodings of fields specific to type 1 packets are displayed in </P>

<P>Table 4-9. Fields that are not specific to type 1 packets are described in Table 4-6. </P>

<P> </P>

<P>Table 4-9. Specific Field Definitions and Encodings for Type 1 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Sub-Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>secID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Original requestor&#8217;s, or secondary, ID for intervention </P>
</TD>
</TR>

<TR>
<TD>
<P>secTID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Original requestor&#8217;s, or secondary, transaction ID for intervention </P>
</TD>
</TR>

<TR>
<TD>
<P>sec_domain </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Original requestor&#8217;s, or secondary, domain for intervention </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0011&#8211;1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 4-1 displays a type 1 packet with all its fields. The field value 0b0001 in </P>

<P>Figure 4-1 specifies that the packet format is of type 1. </P>

<P> </P>

<P> </P>

<P>0 0 0 1 </P>

<P>transaction rdsize srcTID </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_804.jpg"/>
</Figure>

<P>4 4 4 8 </P>

<P> </P>

<P> </P>

<P>sec_domain </P>

<P>secID secTID </P>

<P>extended address </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_805.jpg"/>
</Figure>

<P>m n 8 </P>

<P> </P>

<P>0, 16, 32 </P>

<P> </P>

<P> </P>

<P>address </P>

<P> </P>

<P>29 </P>

<P>wdptr  xamsbs </P>

<P> </P>

<P>1 2 </P>

<P> </P>

<P>Figure 4-1. Type 1 Packet Bit Stream Format </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>4.2.6  Type 2 Packet Format (Request Class) </P>

<P> </P>

<P>Type 2 request packets never include data. They cannot cause an intervention so the secondary domain and ID fields specified in the intervention-request format are not required. This format is used for the READ_HOME, IREAD_HOME, READ_TO_OWN_HOME, IO_READ_HOME, DKILL_HOME, DKILL_SHARER, IKILL_HOME, IKILL_SHARER, TLBIE, and TLBSYNC transactions as specified in the transaction field defined in Table 4-10. Type 2 packets for READ_HOME, IREAD_HOME, READ_TO_OWN_HOME, IO_READ_HOME, FLUSH without data, DKILL_HOME, and IKILL_HOME transactions are issued to home memory by a processing element. DKILL_SHARER and IKILL_SHARER transactions are issued by a home memory to the sharers of a coherence granule. DKILL_HOME, DKILL_SHARER, IKILL_HOME,   IKILL_SHARER,   FLUSH   without   data,   and   TLBIE   are address-only transactions so the rdsize and wdptr fields are ignored and shall be set to logic 0. TLBSYNC is a transaction-type-only transaction so both the address, xamsbs, rdsize, and wdptr fields shall be set to logic 0. </P>

<P> </P>

<P>The transaction field encodings for type 2 packets are displayed in Table 4-10. Fields that are not specific to type 2 packets are described in Table 4-6. </P>

<P> </P>

<P>Table 4-10. Transaction Field Encodings for Type 2 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Transaction Field </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1001 </P>
</TD>

<TD>
<P>FLUSH without data </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1010 </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1011 </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1100&#8211;1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 4-2 displays a type 2 packet with all its fields. The field value 0b0010 in </P>

<P>Figure 4-2 specifies that the packet format is of type 2. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0 0 1 0 </P>
</TD>

<TD>
<P>transaction </P>
</TD>

<TD>
<P>rdsize </P>
</TD>

<TD>
<P>srcTID </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>4 4 4 8 </P>
</TD>
</TR>
</Table>

<P> </P>

<Table>
<TR>
<TD>
<P>extended address </P>
</TD>

<TD>
<P>address </P>
</TD>

<TD>
<P>wdptr </P>
</TD>

<TD>
<P>xamsbs </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_806.jpg"/>
</Figure>

<P>0, 16, 32 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_807.jpg"/>
</Figure>

<P>29 1 2 </P>

<P> </P>

<P>Figure 4-2. Type 2 Packet Bit Stream Format </P>

<P> </P>

<P> </P>

<P>4.2.7  Type 3&#8211;4 Packet Formats (Reserved) </P>

<P> </P>

<P>The type 3&#8211;4 packet formats are reserved. </P>

<P> </P>

<P> </P>

<P>4.2.8  Type 5 Packet Format (Write Class) </P>

<P> </P>

<P>Type 5 packets always contain data. A data payload that consists of a single double-word or less has sizing information as defined in Table 4-8. The wrsize field specifies the maximum size of the data payload for multiple double-word transactions. The FLUSH with data and CASTOUT transactions use type 5 packets as defined in Table 4-11. Note that type 5 transactions always contain data. </P>

<P> </P>

<P>Fields that are not specific to type 5 packets are described in Table 4-6. </P>

<P> </P>

<P>Table 4-11. Transaction Field Encodings for Type 5 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Transaction Field </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>FLUSH with data </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0010&#8211;1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 4-3 displays a type 5 packet with all its fields. The field value 0b0101 in </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_808.jpg"/>
</Figure>

<P>Figure 4-3 specifies that the packet format is of type 5. </P>

<P> </P>

<P> </P>

<P>0 1 0 1 </P>

<P>transaction wrsize srcTID </P>

<P> </P>

<P>4 4 4 8 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_809.jpg"/>
</Figure>

<P>extended address </P>

<P>0, 16, 32 </P>

<P>address </P>

<P>29 </P>

<P>wdptr  xamsbs </P>

<P>1 2 </P>

<P> </P>

<P> </P>

<P>double-word 0 </P>

<P>64 </P>

<P> </P>

<P> </P>

<P> </P>

<P>&#8226;  &#8226; &#8226; </P>

<P>double-word 1 </P>

<P>64 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_810.jpg"/>
</Figure>

<P>double-word n </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_811.jpg"/>
</Figure>

<P>64 </P>

<P> </P>

<P>Figure 4-3. Type 5 Packet Bit Stream Format </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>4.2.9  Type 6&#8211;11 Packet Formats (Reserved) </P>

<P> </P>

<P>The type 6&#8211;11 packet formats are reserved. </P>

<P> </P>

<P> </P>

<P>4.3 Response Packet Formats </P>

<P> </P>

<P>A response transaction is issued by a processing element when it has completed a request made by a remote processing element. Response packets are always directed and are transmitted in the same way as request packets. Currently two response packet format types exist, as shown in Table 4-12. </P>

<P> </P>

<P>Table 4-12. Request Packet Type to Transaction Type Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Request Packet Format Type </P>
</TD>

<TD>
<P> </P>

<P>Transaction Type </P>
</TD>

<TD>
<P> </P>

<P>Definition </P>
</TD>

<TD>
<P> </P>

<P>Document </P>

<P>Section No. </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 12 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.3.2 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>Type 13 </P>
</TD>

<TD>
<P>RESPONSE </P>
</TD>

<TD>
<P>Issued by a processing element when it completes a request by a remote element. </P>
</TD>

<TD>
<P> </P>

<P>Section 4.3.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 14 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>Section 4.3.4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Type 15 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>

<TD>
<P>Section 4.3.5 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.3.1  Field Definitions for All Response Packet Formats </P>

<P> </P>

<P>The field definitions in Table 4-13 apply to more than one of the response packet formats. </P>

<P> </P>

<P>Table 4-13. Field Definitions and Encodings for All Response Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Sub-Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>transaction </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>RESPONSE transaction with no data payload </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001&#8211;0111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1000 </P>
</TD>

<TD>
<P>RESPONSE transaction with data payload </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1001&#8211;1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>targetTID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>The corresponding request packet&#8217;s transaction ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-13. Field Definitions and Encodings for All Response Packets (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>status </P>
</TD>

<TD>
<P>Type of status and encoding </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>DONE </P>
</TD>

<TD>
<P>Requested transaction has been successfully completed </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>DATA_ONLY </P>
</TD>

<TD>
<P>This is a data only response </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>NOT_OWNER </P>
</TD>

<TD>
<P>Not owner of requested coherence granule </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>RETRY </P>
</TD>

<TD>
<P>Requested transaction is not accepted; must retry the request </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0100 </P>
</TD>

<TD>
<P>INTERVENTION </P>
</TD>

<TD>
<P>Update home memory with intervention data </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0101 </P>
</TD>

<TD>
<P>DONE_INTERVENTION </P>
</TD>

<TD>
<P>Done for a transaction that resulted in an intervention </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0110 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0111 </P>
</TD>

<TD>
<P>ERROR </P>
</TD>

<TD>
<P>Unrecoverable error detected </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1000&#8211;1011 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1100&#8211;1111 </P>
</TD>

<TD>
<P>Implementation </P>
</TD>

<TD>
<P>Implementation defined&#8212;Can be used for additional information such as an error code </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.3.2  Type 12 Packet Format (Reserved) </P>

<P> </P>

<P>The type 12 packet format is reserved. </P>

<P> </P>

<P> </P>

<P>4.3.3  Type 13 Packet Format (Response Class) </P>

<P> </P>

<P>The type 13 packet format returns status, data (if required), and the requestor&#8217;s transaction ID. A RESPONSE packet with an &#8220;ERROR&#8221; status or a response that is not expected to have a data payload never has a data payload. The type 13 format is used for response packets to all request transactions. </P>

<P> </P>

<P>Note that type 13 packets do not have any special fields. </P>

<P> </P>

<P>Figure 4-4 illustrates the format and fields of type 13 packets. The field value </P>

<P>0b1101 in Figure 4-4 specifies that the packet format is of type 13. </P>

<P> </P>

<P> </P>

<P>1 1 0 1 </P>

<P>transaction status targetTID </P>

<P> </P>

<P>4 4 4 8 </P>

<P> </P>

<P> </P>

<P>double-word 0 </P>

<P> </P>

<P>64 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_812.jpg"/>
</Figure>

<P>&#8226; &#8226;  &#8226; </P>

<P>double-word 1 </P>

<P> </P>

<P>64 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_813.jpg"/>
</Figure>

<P>double-word n </P>

<P> </P>

<P>64 </P>

<P> </P>

<P>Figure 4-4. Type 13 Packet Bit Stream Format </P>

<P> </P>

<P>4.3.4  Type 14 Packet Format (Reserved) </P>

<P> </P>

<P>The type 14 packet format is reserved. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.5  Type 15 Packet Format (Implementation-Defined) </P>

<P> </P>

<P>The type 15 packet format is reserved for implementation-defined functions such as flow control. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 Globally Shared Memory Registers </P>

<P> </P>

<P> </P>

<P>5.1 Introduction </P>

<P> </P>

<P>This chapter describes the visible register set that allows an external processing element to determine the capabilities, configuration, and status of a processing element using this logical specification. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and  bit  definitions. All  registers are  32-bits and  aligned to  a  32-bit boundary. </P>

<P> </P>

<P> </P>

<P>5.2 Register Summary </P>

<P> </P>

<P>Table 5-1 shows the register map for this RapidIO specification. These capability registers (CARs) and command and status registers (CSRs) can be accessed using the RapidIO Part 1: Input/Output Logical Specification maintenance operations. Any register offsets not defined are considered reserved for this specification unless otherwise stated. Other registers required for a processing element are defined in other applicable RapidIO specifications and by the requirements of the specific device and are beyond the scope of this specification. Read and write accesses to reserved register offsets shall terminate normally and not cause an error condition in the target device. Writes to CAR (read-only) space shall terminate normally and not cause an error condition in the target device. </P>

<P> </P>

<P>Register bits defined as reserved are considered reserved for this specification only. Bits that are reserved in this specification may be defined in another RapidIO specification. </P>

<P> </P>

<P>Table 5-1. GSM Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0-14 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x18 </P>
</TD>

<TD>
<P>Source Operations CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x1C </P>
</TD>

<TD>
<P>Destination Operations CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x20-FC </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-1. GSM Register Map (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100-&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P> </P>

<P>Extended Features Space </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000- FFFFFC </P>
</TD>

<TD>
<P> </P>

<P>Implementation-defined Space </P>
</TD>
</TR>
</Table>

<P> </P>

<P>5.3 Reserved Register, Bit and Bit Field Value Behavior </P>

<P> </P>

<P>Table 5-2 describes the required behavior for accesses to reserved register bits and reserved registers for the RapidIO register space, </P>

<P> </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0-3C </P>
</TD>

<TD>
<P>Capability Register Space (CAR Space - this space is read-only) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value1 </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined </P>

<P>function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x40-FC </P>
</TD>

<TD>
<P>Command and Status Register Space (CSR Space) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value2 </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined </P>

<P>function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100-&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P>Extended Features Space </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000-&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P>Implementation-defined </P>

<P>Space </P>
</TD>

<TD>
<P>Reserved bit and register </P>
</TD>

<TD>
<P>All behavior implementation-defined </P>
</TD>
</TR>
</Table>

<P>1    Do not depend on reserved bits being a particular value; use appropriate masks to extract defined bits from the read value. </P>

<P>2    All register writes shall be in the form: read the register to obtain the values of all reserved bits, merge in the desired values for defined bits to be modified, and write the register, thus preserving the value of all reserved bits. </P>

<P> </P>

<P>When  a  writable  bit  field  is  set  to  a  reserved  value,  device  behavior  is implementation specific. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.4 Capability Registers (CARs) </P>

<P> </P>

<P>Every processing element shall contain a set of registers that allows an external processing element to determine its capabilities using the I/O logical maintenance read operation. All registers are 32 bits wide and are organized and accessed in </P>

<P>32-bit (4 byte) quantities, although some processing elements may optionally allow larger accesses. CARs are read-only. Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>CARs are big-endian with bit 0 the most significant bit. </P>

<P> </P>

<P> </P>

<P>5.4.1  Source Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x18) </P>

<P> </P>

<P>This register defines the set of RapidIO GSM logical operations that can be issued by this processing element; see Table 5-3. It is assumed that a processing element can generate I/O logical maintenance read and write requests if it is required to access CARs and CSRs in other processing elements. RapidIO switches shall be able to route any packet. </P>

<P> </P>

<P>Table 5-3. Bit Settings for Source Operations CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Read </P>
</TD>

<TD>
<P>PE can support a read operation </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Instruction read </P>
</TD>

<TD>
<P>PE can support an instruction read operation </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Read-for-ownership </P>
</TD>

<TD>
<P>PE can support a read-for-ownership operation </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Data cache invalidate </P>
</TD>

<TD>
<P>PE can support a data cache invalidate operation </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Castout </P>
</TD>

<TD>
<P>PE can support a castout operation </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Data cache flush </P>
</TD>

<TD>
<P>PE can support a data cache flush operation </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>I/O read </P>
</TD>

<TD>
<P>PE can support an I/O read operation </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>Instruction cache invalidate </P>
</TD>

<TD>
<P>PE can support an instruction cache invalidate operation </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>TLB invalidate-entry </P>
</TD>

<TD>
<P>PE can support a TLB invalidate-entry operation </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>TLB invalidate-entry sync </P>
</TD>

<TD>
<P>PE can support a TLB invalidate-entry sync operation </P>
</TD>
</TR>

<TR>
<TD>
<P>10&#8211;13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14&#8211;15 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;29 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>30&#8211;31 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.4.2  Destination Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x1C) </P>

<P> </P>

<P>This register defines the set of RapidIO GSM operations that can be supported by this processing element; see Table 5-4. It is required that all processing elements can respond to I/O logical maintenance read and write requests in order to access these registers. The Destination Operations CAR is applicable for end point devices only. RapidIO switches shall be able to route any packet. </P>

<P> </P>

<P>Table 5-4. Bit Settings for Destination Operations CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Read </P>
</TD>

<TD>
<P>PE can support a read operation </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Instruction read </P>
</TD>

<TD>
<P>PE can support an instruction read operation </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Read-for-ownership </P>
</TD>

<TD>
<P>PE can support a read-for-ownership operation </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Data cache invalidate </P>
</TD>

<TD>
<P>PE can support a data cache invalidate operation </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Castout </P>
</TD>

<TD>
<P>PE can support a castout operation </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Data cache flush </P>
</TD>

<TD>
<P>PE can support a flush operation </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>I/O read </P>
</TD>

<TD>
<P>PE can support an I/O read operation </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>Instruction cache invalidate </P>
</TD>

<TD>
<P>PE can support an instruction cache invalidate operation </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>TLB invalidate-entry </P>
</TD>

<TD>
<P>PE can support a TLB invalidate-entry operation </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>TLB invalidate-entry sync </P>
</TD>

<TD>
<P>PE can support a TLB invalidate-entry sync operation </P>
</TD>
</TR>

<TR>
<TD>
<P>10&#8211;13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14-15 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>

<TR>
<TD>
<P>16-29 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>30-31 </P>
</TD>

<TD>
<P>Implementation Defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.5 Command and Status Registers (CSRs) </P>

<P> </P>

<P>The RapidIO Globally Shared Memory Logical Specification does not define any command and status registers (CSRs). </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 6 Communication Protocols </P>

<P> </P>

<P> </P>

<P>6.1 Introduction </P>

<P> </P>

<P>This chapter contains the RapidIO globally shared memory (GSM) communications protocol definitions. Three state machines are required for a processing element on the RapidIO interface: one for local system accesses to local and remote space, one for remote accesses to local space, and one for handling responses made by the remote system to requests from the local system. The protocols are documented as pseudo-code partitioned by operation type. The RapidIO protocols as defined here assume a directory state definition that uses a modified bit with the local processor always sharing as described in Chapter 2, &#8220;System Models.&#8221; The protocols can be easily modified to use an alternate directory scheme that allows breaking the SHARED state         into         a         REMOTE_SHARED         and         a REMOTE_AND_LOCAL_SHARED state pair. </P>

<P> </P>

<P>Similarly, it may be desirable for an implementation to have an UNOWNED state instead of defaulting to LOCAL_SHARED or LOCAL_MODIFIED. These optimizations only affect the RapidIO transaction issuing behavior within a processing element, not the globally shared memory protocol itself. This flexibility allows a variety of local processor cache state coherence definitions such as MSI or MESI. </P>

<P> </P>

<P>Some designs may not have a source of local system requests, for example, the memory  only  processing  element  described  in  Section 2.2.3,  &#8220;Memory-Only Processing Element Model&#8221;. The protocols for these devices are much less complicated, only requiring the external request state machine and a portion of the response state machine. Similarly, a design may not have a local memory controller, which is also a much less complicated device, requiring only a portion of the internal request and response state machines. The protocols assume a processor element and memory processing element as described in Figure 2-2. </P>

<P> </P>

<P> </P>

<P>6.2 Definitions </P>

<P> </P>

<P>The general definitions of Section 6.2.1 apply throughout the protocol, and the requests and responses of state machines are defined in Section 6.2.2, &#8220;Request and Response Definitions.&#8221; </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.2.1  General Definitions </P>

<P>address_collisionAn address match between the new request and an address currently being serviced by the state machines or some other address-based internal hazard. This frequently causes a retry of the new request. </P>

<P>assign_entry() Assign resources (such as a queue entry) to service a request, mark the address as able to participate in address collision detection (if appropriate), and assign a transaction ID </P>

<P> </P>

<P>data Any data associated with the transaction; this field is frequently null directory_state The memory directory state for the address being serviced </P>

<P>error() Signal an error (usually through an interrupt structure) to software, usually to indicate a coherence violation problem </P>

<P> </P>

<P>free_entry() Release all resources assigned to this transaction, remove it from address collision detection, and deallocate the transaction ID </P>

<P>local Memory local to the processing element </P>

<P> </P>

<P>local_request(m,n,...)A local request to a local processor caused by an incoming external request that requires a snoop of the processor&#8217;s caches </P>

<P> </P>

<P>local_response(m,n,.)A local response to a local request; usually indicates the cache state for the requesting processor to mark the requested data </P>

<P>LOCAL_RTYPEThis is the response from the local agent to the local processor in response to a local request. </P>

<P>LOCAL_TTYPEThis is the transaction type for a request passed from the RapidIO </P>

<P>interconnect to a local device. (mask &lt;= (mask ~= received_srcid))&#61472;&#61472;</P>

<P>&#8220;Assign the mask field to the old mask field with the received </P>

<P>ID bit cleared.&#8221; This result is generated when a response to a multicast is received and it is not the last one expected. </P>

<P>((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P>&#8220;The mask field not including my ID or the received ID equals 0.&#8221; This result indicates that we have received all of the expected responses to a multicast request. </P>

<P>(mask ~= my_id)&#8220;The sharing mask not including my ID.&#8221; This result is used for multicast operations where the requestor is in the sharing list but does not need to be included in the multicast transaction because it is the source of the transaction. </P>

<P>(mask &lt;= (participant_list ~= my_id))&#61472;&#61472;</P>

<P>&#8220;The sharing mask includes all participants except my ID.&#8221; This result is used for the IKILL operation, which does not </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>use the memory directory information. (mask &lt;= (participant_list ~= (received_srcid AND my_id)))&#61472;&#61472;</P>

<P>&#8220;The sharing mask includes all participants except the </P>

<P>requestor&#8217;s and my IDs.&#8221; This result is used for the IKILL operation, which does not use the memory directory information. </P>

<P>(mask == received_srcid)&#61472;&#61472;</P>

<P>&#8220;The sharing mask only includes the requestor&#8217;s ID.&#8221; This result is used for the DKILL operation to detect a </P>

<P>write-hit-on-shared case where the requestor has the only remote copy of the coherence granule. </P>

<P>original_srcid The ID of the initial requestor for a transaction, saved in the state associated with the transaction ID </P>

<P> </P>

<P>received_data The response contained data received_data_only_message&#61472;&#61472;</P>

<P>Flag set by set_received_data_only_message() </P>

<P>received_done_message&#61472;&#61472;</P>

<P>Flag set by set_received_done_message() </P>

<P>remote_request(m,n,...) &#61472;&#61472;</P>

<P>Make a request to the interconnect fabric remote_response(m,n,...) &#61472;&#61472;</P>

<P>Send a response to the interconnect fabric </P>

<P>RESPONSE_TTYPE &#61472;&#61472;</P>

<P>This is the RapidIO transaction type for a response to a request </P>

<P> </P>

<P>return_data() Return data to the local requesting processor, either from memory or from a interconnect fabric buffer; the source can be determined from the context </P>

<P>secondary_id  The third party identifier for intervention responses; the processing element ID concatenated with the processing element domain. </P>

<P>set_received_data_only_message() &#61472;&#61472;</P>

<P>Remember that a DATA_ONLY response was received for this transaction ID </P>

<P>set_received_done_message() &#61472;&#61472;</P>

<P>Remember that a DONE response was received for this transaction ID </P>

<P>source_id The source device identifier; the processing element ID concatenated with the processing element domain </P>

<P> </P>

<P>target_id The destination device identifier; the processing element ID </P>

<P> </P>

<P>RapidIO Trade Association 65 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>concatenated with the processing element domain TRANSACTIONThe RapidIO transaction type code for the request update_memory()Write memory with data received from a response </P>

<P>update_state(m,n,...)Modify the memory directory state to reflect the new system status </P>

<P> </P>

<P> </P>

<P>6.2.2  Request and Response Definitions </P>

<P> </P>

<P>Following are the formats used in the pseudocode to describe request and response transactions sent between processing elements and the formats of local requests and responses between the cache coherence controller and the local cache hierarchy and memory controllers. </P>

<P> </P>

<P>6.2.2.1  System Request </P>

<P>The system request format is: </P>

<P> </P>

<P>remote_request(TRANSACTION, target_id, source_id, secondary_id, data) </P>

<P> </P>

<P>which describes the necessary RapidIO request to implement the protocol. </P>

<P> </P>

<P>6.2.2.2  Local Request </P>

<P> </P>

<P>The local request format is: </P>

<P> </P>

<P>local_request(LOCAL_TTYPE) </P>

<P> </P>

<P>that is the necessary local processor request to implement the protocol; the pseudocode assumes a generic local bus. A local request also examines the remote cache as part of the processing element&#8217;s caching hierarchy. The local transactions are defined as: </P>

<P> </P>

<P>DKILL Causes the processor to transition the coherence granule to invalid regardless of the current state; data is not pushed if current state is modified </P>

<P>IKILL Causes the processor to invalidate the coherence granule in the instruction cache </P>

<P>READ Causes the processor to transition the coherence granule to shared and push data if necessary </P>

<P> </P>

<P>READ_LATESTCauses the processor to push data if modified but not transition the cache state </P>

<P>READ_TO_OWNCauses the processor to transition the coherence granule to invalid and push data </P>

<P> </P>

<P>TLBIE Causes the processor to invalidate the specified translation look-aside buffer entry </P>

<P>TLBSYNC Causes the processor to indicate when all outstanding TLBIEs have completed </P>

<P> </P>

<P>66 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>6.2.2.3  System Response </P>

<P> </P>

<P>The system response format is: </P>

<P> </P>

<P>remote_response(RESPONSE_TTYPE, target_id, source_id, data (opt.)) </P>

<P> </P>

<P>which is the proper response to implement the protocol. </P>

<P> </P>

<P>6.2.2.4  Local Response </P>

<P> </P>

<P>The local response format is: </P>

<P> </P>

<P>local_response(LOCAL_RTYPE) </P>

<P> </P>

<P>In general, a transaction ID (TID) is associated with each device ID in order to uniquely identify a request. This TID is frequently a queue index in the source processing element. These TIDs are not explicitly called out in the pseudocode below. The local responses are defined as: </P>

<P>EXCLUSIVE The processor has exclusive access to the coherence granule </P>

<P> </P>

<P>OK The transaction requested by the processor has or will complete properly </P>

<P>RETRY Causes the processor to re-issue the transaction; this response may cause a local bus spin loop until the protocol allows a different response </P>

<P>SHARED        The processor has a shared copy of the coherence granule </P>

<P> </P>

<P> </P>

<P>6.3 Operation to Protocol Cross Reference </P>

<P> </P>

<P>Table 6-1 contains a cross reference of the operations defined in the RapidIO Interconnect Globally Shared Memory Logical Specification and their system usage. </P>

<P> </P>

<P>Table 6-1. Operation to Protocol Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Operations </P>
</TD>

<TD>
<P>Protocol </P>
</TD>
</TR>

<TR>
<TD>
<P>Read </P>
</TD>

<TD>
<P>Section 6.4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Instruction read </P>
</TD>

<TD>
<P>Section 6.4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Read for ownership </P>
</TD>

<TD>
<P>Section 6.6 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data cache invalidate </P>
</TD>

<TD>
<P>Section 6.7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Instruction cache invalidate </P>
</TD>

<TD>
<P>Section 6.7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Castout </P>
</TD>

<TD>
<P>Section 6.8 </P>
</TD>
</TR>

<TR>
<TD>
<P>TLB invalidate entry </P>
</TD>

<TD>
<P>Section 6.9 </P>
</TD>
</TR>

<TR>
<TD>
<P>TLB invalidate entry synchronize </P>
</TD>

<TD>
<P>Section 6.9 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data cache flush </P>
</TD>

<TD>
<P>Section 6.10 </P>
</TD>
</TR>

<TR>
<TD>
<P>I/O read </P>
</TD>

<TD>
<P>Section 6.11 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 67 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.4 Read Operations </P>

<P> </P>

<P>This operation is a coherent data cache read; refer to the description in Section 3.3.1. </P>

<P> </P>

<P> </P>

<P>6.4.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to both local and remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external request&#61472;&#61472;</P>

<P>// in progress or a cache&#61472;&#61472;</P>

<P>local_response(RETRY); // index hazard from a previous request&#61472;&#61472;</P>

<P>elseif (local) // our local memory&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED: // local modified is OK if we default &#61472;&#61472;</P>

<P>// local memory to owned&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>case LOCAL_SHARED, // local, owned by memory&#61472;&#61472;</P>

<P>case SHARED: // shared local and remote&#61472;&#61472;</P>

<P>local_response(SHARED);&#61472;&#61472;</P>

<P>return_data(); // keep directory state &#61472;&#61472;</P>

<P>// the way it was&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>local_response(SHARED);&#61472;&#61472;</P>

<P>assign_entry(); // this means to assign &#61472;&#61472;</P>

<P>// a transaction ID,&#61472;&#61472;</P>

<P>// usually a queue entry&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, mask_id, my_id, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go &#61472;&#61472;</P>

<P>// to another processing element&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY); // can&#8217;t guarantee data before a&#61472;&#61472;</P>

<P>// snoop yet&#61472;&#61472;</P>

<P>remote_request(READ_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P>6.4.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local system or a third party. </P>

<P> </P>

<P>if (my_id == mem_id == original_srcid) // original requestor is home memory&#61472;&#61472;</P>

<P>switch(remote_response) // matches my_id only for &#61472;&#61472;</P>

<P>// REMOTE_MODIFIED case&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER, // due to address collision or&#61472;&#61472;</P>

<P>case RETRY: // passing requests&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>// when processor re-requests&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P> </P>

<P>68 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>local_response(SHARED);&#61472;&#61472;</P>

<P>// when processor re-requests&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // mask_id must match received_srcid </P>

<P> </P>

<P>//or error; spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>elseif(my_id == mem_id ~== original_id // i&#8217;m home memory working for&#61472;&#61472;</P>

<P>// a third party&#61472;&#61472;</P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER, // data comes from memory, &#61472;&#61472;</P>

<P>// mimic intervention&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // my_id ~= mem_id - I&#8217;m &#61472;&#61472;</P>

<P>// requesting a remote &#61472;&#61472;</P>

<P>// memory location&#61472;&#61472;</P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>local_response(SHARED); // when processor re-requests&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case DONE_INTERVENTION: // must be from third party&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_only_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>// wait for a DATA_ONLY&#61472;&#61472;</P>

<P>case DATA_ONLY: // this is due to an intervention, a&#61472;&#61472;</P>

<P>// DONE_INTERVENTION should come&#61472;&#61472;</P>

<P>// separately&#61472;&#61472;</P>

<P>local_response(SHARED);&#61472;&#61472;</P>

<P>set_received_data_only_message();&#61472;&#61472;</P>

<P>if (received_done_message)&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 69 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>remote_request(READ_HOME, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>6.4.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory or the local system. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif (READ_HOME) // remote request to our local memory&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_request(READ);&#61472;&#61472;</P>

<P>update_state(SHARED, received_srcid);&#61472;&#61472;</P>

<P>// after possible push completes&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>update_state(SHARED, received_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>if (mask_id ~= received_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>// intervention case&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, mask_id,&#61472;&#61472;</P>

<P>my_id, received_srcid);&#61472;&#61472;</P>

<P> </P>

<P>error(); // he already owned it; &#61472;&#61472;</P>

<P>// cache paradox (or I-fetch after d-&#61472;&#61472;</P>

<P>// store if not fixed elsewhere)&#61472;&#61472;</P>

<P>else // READ_OWNER request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ); // spin until a valid response&#61472;&#61472;</P>

<P>// from caches &#61472;&#61472;</P>

<P>switch (local_response) &#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push;&#61472;&#61472;</P>

<P>// wait for it&#61472;&#61472;</P>

<P>cache_state(SHARED or INVALID);&#61472;&#61472;</P>

<P>// surrender ownership&#61472;&#61472;</P>

<P>if (received_srcid == received_secid)&#61472;&#61472;</P>

<P>// original requestor is also home&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>else &#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>remote_response(DATA_ONLY, received_secid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>case INVALID: // must have cast it out&#61472;&#61472;</P>

<P> </P>

<P>70 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>default;&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 71 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.5 Instruction Read Operations </P>

<P> </P>

<P>This operation is a partially coherent instruction cache read; refer to the description in Section 3.3.2. </P>

<P> </P>

<P> </P>

<P>6.5.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to both local and remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external &#61472;&#61472;</P>

<P>// request in progress or a cache&#61472;&#61472;</P>

<P>local_response(RETRY); // index hazard from a previous request&#61472;&#61472;</P>

<P>elseif (local) // our local memory&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED: // local modified is OK if we default&#61472;&#61472;</P>

<P>// local memory to owned&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>case LOCAL_SHARED, // local, owned by memory&#61472;&#61472;</P>

<P>case SHARED: // shared local and remote&#61472;&#61472;</P>

<P>local_response(SHARED);&#61472;&#61472;</P>

<P>return_data(); // keep directory state the way it was&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>local_response(SHARED);&#61472;&#61472;</P>

<P>assign_entry(); // this means to assign a transaction&#61472;&#61472;</P>

<P>// ID, usually a queue entry&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, mask_id, my_id, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go&#61472;&#61472;</P>

<P>// to another processing element&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>// can&#8217;t guarantee data before a&#61472;&#61472;</P>

<P>// snoop yet&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>remote_request(IREAD_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P>6.5.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local system or a third party. </P>

<P> </P>

<P>if (my_id == mem_id == original_srcid) // original requestor is home memory&#61472;&#61472;</P>

<P>error();&#61472;&#61472;</P>

<P>elseif(my_id == mem_id ~== original_id) // i&#8217;m home memory working for a&#61472;&#61472;</P>

<P>// third party&#61472;&#61472;</P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER, // data comes from memory, &#61472;&#61472;</P>

<P>// mimic intervention&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>72 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // my_id ~= mem_id - I&#8217;m requesting&#61472;&#61472;</P>

<P>// a remote memory location&#61472;&#61472;</P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>local_response(SHARED); // when processor re-requests&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case DONE_INTERVENTION: // must be from third party&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_only_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>// wait for a DATA_ONLY&#61472;&#61472;</P>

<P>case DATA_ONLY: // this is due to an intervention; a&#61472;&#61472;</P>

<P>// DONE_INTERVENTION should come&#61472;&#61472;</P>

<P>// separately&#61472;&#61472;</P>

<P>local_response(SHARED);&#61472; set_received_data_only_message();&#61472; if (received_done_message)&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>remote_request(IREAD_HOME, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>6.5.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory or the local system. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif(IREAD_HOME) // remote request to our local memory&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_request(READ);&#61472;&#61472;</P>

<P>update_state(SHARED, received_srcid);&#61472;&#61472;</P>

<P>// after possible push completes&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>update_state(SHARED, received_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 73 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>if (mask_id ~= received_srcid) &#61472;&#61472;</P>

<P>// intervention case&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, mask_id,&#61472;&#61472;</P>

<P>my_id, received_srcid);&#61472;&#61472;</P>

<P>else // he already owned it in his &#61472;&#61472;</P>

<P>//data cache; cache paradox case&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, mask_id, my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>74 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>6.6 Read for Ownership Operations </P>

<P> </P>

<P>This is the coherent cache store miss operation. </P>

<P> </P>

<P> </P>

<P>6.6.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to both local and remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external request&#61472;&#61472;</P>

<P>// in progress or a cache index&#61472;&#61472;</P>

<P>local_response(RETRY); // hazard from a previous request&#61472;&#61472;</P>

<P>elseif (local) // our local memory&#61472;&#61472;</P>

<P>switch (directory_state&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED, // local modified is OK if we&#61472;&#61472;</P>

<P>// default memory to owned locally&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE); // give ownership to processor&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>if (directory_state == LOCAL_SHARED)&#61472;&#61472;</P>

<P>update_state(LOCAL_MODIFIED)&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // owned by another, get a copy&#61472;&#61472;</P>

<P>// and ownership&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY); // retry&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, mask_id, my_id, my_id);&#61472;&#61472;</P>

<P>case SHARED: // invalidate the sharing list&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY);  // retry&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, (mask ~= my_id), my_id, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go to another&#61472;&#61472;</P>

<P>// processing element&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY);&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P>6.6.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local system or a third party. </P>

<P> </P>

<P>if (my_id == mem_id == original_srcid) // original requestor is home memory&#61472;&#61472;</P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE: // SHARED, so invalidate case&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0) &#61472;&#61472;</P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>update_state(LOCAL_MODIFIED);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip the responder&#8217;s shared&#61472;&#61472;</P>

<P>// bit and wait for next DONE&#61472;&#61472;</P>

<P>case NOT_OWNER: // due to address collision with&#61472;&#61472;</P>

<P>// CASTOUT or FLUSH&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 75 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>update_state(LOCAL_MODIFIED);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: &#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>// spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, mask_id,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P>error();&#61472;&#61472;</P>

<P>case INTERVENTION: // remotely owned&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>update_state(LOCAL_MODIFIED);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>update_state(LOCAL_MODIFIED);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: //mask_id must match received_srcid&#61472;&#61472;</P>

<P>// or error condition&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, received_srcid, my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>elseif (my_id == mem_id ~= original_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>switch(received_response)&#61472;&#61472;</P>

<P> </P>

<P>// i&#8217;m home memory working&#61472;&#61472;</P>

<P>// for a third party&#61472;&#61472;</P>

<P>case DONE: // invalidates for shared &#61472;&#61472;</P>

<P>// directory states&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip the responder&#8217;s shared bit&#61472;&#61472;</P>

<P>endif; // and wait for next DONE&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>// remote_modified case&#61472;&#61472;</P>

<P>update_memory(); // for possible coherence error&#61472;&#61472;</P>

<P>// recovery&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_id);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_id, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER: // data comes from memory, mimic&#61472;&#61472;</P>

<P>// intervention&#61472;&#61472;</P>

<P> </P>

<P>76 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>switch(directory_state)&#61472; case LOCAL_SHARED:&#61472; case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, original_srcid);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472; case LOCAL_MODIFIED,&#61472; case LOCAL_SHARED:&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // mask_id must match received_srcid&#61472;&#61472;</P>

<P>// or error condition&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, received_srcid, my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // my_id ~= mem_id - I&#8217;m requesting&#61472;&#61472;</P>

<P>// a remote memory location&#61472;&#61472;</P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case DONE_INTERVENTION:&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case DATA_ONLY:&#61472;&#61472;</P>

<P>set_received_data_message();&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>if (received_done_message)&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>// wait for DATA_ONLY&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P>endif; // and wait for a DONE&#61472;&#61472;</P>

<P>case RETRY: // lost at remote memory so retry&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 77 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.6.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the interconnect to the local memory or the local system. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables&#61472;&#61472;</P>

<P>// in Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif (READ_TO_OWN_HOME) // remote request to our local memory&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// after possible push&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, received_srcid);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>if (mask_id ~= received_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>//intervention case&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, mask_id, my_id,&#61472;&#61472;</P>

<P>received_srcid);&#61472;&#61472;</P>

<P> </P>

<P>error(); // he already owned it!&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P>if (mask == received_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>//requestor is only remote sharer&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, received_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// from memory&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else //there are other remote sharers&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, (mask ~= received_srcid),&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>elseif(READ_TO_OWN_OWNER) // request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN); // spin until a valid response from&#61472;&#61472;</P>

<P>// the caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push&#61472;&#61472;</P>

<P>cache_state(INVALID);&#61472;&#61472;</P>

<P>// surrender ownership&#61472;&#61472;</P>

<P>if (received_srcid == received_secid)&#61472;&#61472;</P>

<P>//the original request is from the home&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>else // the original request is from a&#61472;&#61472;</P>

<P>// third party&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, received_secid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case INVALID: // castout address collision&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>78 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>6.7 Data Cache and Instruction Cache Invalidate </P>

<P>Operations </P>

<P> </P>

<P>This operation is used with coherent cache store-hit-on-shared, cache operations; </P>

<P>refer to the description in Section 3.3.4. </P>

<P> </P>

<P> </P>

<P>6.7.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to both local and remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external request in &#61472;&#61472;</P>

<P>// progress or a cache index&#61472;&#61472;</P>

<P>local_response(RETRY); // hazard from a previous request&#61472;&#61472;</P>

<P>elseif (local) // our local memory and we won&#61472;&#61472;</P>

<P>if (DKILL) // DKILL checks the directory&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED, // local modified is OK if we default&#61472;&#61472;</P>

<P>// memory to owned locally&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472; local_response(EXCLUSIVE);&#61472; if (LOCAL_SHARED)&#61472;&#61472;</P>

<P>update_state(LOCAL_MODIFIED, my_id);&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // cache paradox; DKILL is&#61472;&#61472;</P>

<P>// write-hit-on-shared&#61472;&#61472;</P>

<P>error();&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>local_response(RETRY);&#61472;&#61472;</P>

<P>assign_entry(); // Multicast if possible otherwise &#61472;&#61472;</P>

<P>// issue direct to each sharer&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, (mask ~= my_id), my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // IKILL always goes to everyone&#61472;&#61472;</P>

<P>remote_request(IKILL_SHARER,&#61472;&#61472;</P>

<P>(mask &lt;= (participant_list ~= my_id)), my_id);&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go to another&#61472;&#61472;</P>

<P>// processing element&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY);&#61472;&#61472;</P>

<P>remote_request({DKILL_HOME, IKILL_HOME}, mem_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P>6.7.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local system or a third party. </P>

<P> </P>

<P>if (my_id == mem_id == original_srcid) // original requestor is home memory&#61472;&#61472;</P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE: // shared cases&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P>if (DKILL) // don&#8217;t update state for IKILLs&#61472;&#61472;</P>

<P>update_state(LOCAL_MODIFIED);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 79 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip the responder&#8217;s shared bit and&#61472;&#61472;</P>

<P>endif; // wait for next DONE&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>remote_request({DKILL_SHARER, IKILL_SHARER}, received_srcid,&#61472;&#61472;</P>

<P>my_id); // retry the transaction&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>elseif (my_id == mem_id ~= original_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>switch(received_response)&#61472;&#61472;</P>

<P> </P>

<P>// i&#8217;m home memory working&#61472;&#61472;</P>

<P>// for a third party&#61472;&#61472;</P>

<P>case DONE: // invalidates for shared &#61472;&#61472;</P>

<P>// directory states&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P>if (DKILL) // don&#8217;t update state for IKILLs&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_srcid);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip the responder&#8217;s shared bit&#61472;&#61472;</P>

<P>endif; // and wait for next DONE&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>remote_request({DKILL_SHARER, IKILL_SHARER}, received_srcid,&#61472;&#61472;</P>

<P>my_id); // retry&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // my_id ~= mem_id - I&#8217;m requesting&#61472;&#61472;</P>

<P>// a remote memory location&#61472;&#61472;</P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472; local_response(EXCLUSIVE);&#61472; free_entry();&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>remote_request({DKILL_HOME, IKILL_HOME}, received_srcid,&#61472;&#61472;</P>

<P>my_id); // retry the transaction&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>6.7.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory or the local system. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif (DKILL_HOME || IKILL_HOME) // remote request to our local memory&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>if (DKILL_HOME)&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED, // cache paradoxes; DKILL is&#61472;&#61472;</P>

<P>// write-hit-on-shared&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>error();&#61472;&#61472;</P>

<P>case SHARED: // this is the right case, send&#61472;&#61472;</P>

<P>// invalidates to the sharing list&#61472;&#61472;</P>

<P>local_request(DKILL);&#61472;&#61472;</P>

<P>if (mask == received_srcid&#61472;&#61472;</P>

<P>// requestor is only remote sharer&#61472;&#61472;</P>

<P> </P>

<P>80 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>received_srcid);&#61472;&#61472;</P>

<P>if (DKILL) // don&#8217;t update state for (IKILLs)&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, </P>

<P>endif;&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else // there are other remote sharers&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER,&#61472;&#61472;</P>

<P>(mask ~= received_srcid), my_id, NULL);&#61472;&#61472;</P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // IKILL goes to everyone except the&#61472;&#61472;</P>

<P>// requestor&#61472;&#61472;</P>

<P>remote_request(IKILL_SHARER,&#61472;&#61472;</P>

<P>(mask &lt;= (participant_list ~=&#61472;&#61472;</P>

<P>(received_srcid AND my_id), my_id);&#61472;&#61472;</P>

<P>else // DKILL_SHARER or IKILL_SHARER to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request({READ_TO_OWN, IKILL});&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case SHARED,&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>// spin until a valid response from the&#61472;&#61472;</P>

<P>// caches&#61472;&#61472;</P>

<P>case INVALID: // invalidating for shared cases&#61472;&#61472;</P>

<P>cache_state(INVALID); // surrender copy&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.8 Castout Operations </P>

<P> </P>

<P>This operation is used to return ownership of a coherence granule to home memory, leaving it invalid in the cache; refer to the description in Section 3.3.5. </P>

<P> </P>

<P> </P>

<P>6.8.1  Internal Request State Machine </P>

<P> </P>

<P>A castout is always done to remote memory space. A castout may require local activity to flush all caches in the hierarchy. </P>

<P> </P>

<P>if (local) // our local memory&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED: // if the processor is doing a castout&#61472;&#61472;</P>

<P>// this is the only legal state&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>local_response(OK);&#61472; update_memory();&#61472; update_state(LOCAL_SHARED);&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go to another&#61472;&#61472;</P>

<P>// processing element&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>remote_request(CASTOUT, mem_id, my_id, data);&#61472;&#61472;</P>

<P> </P>

<P>6.8.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local system or a third party. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>6.8.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory or the local system. This may require making further external requests. </P>

<P> </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>state_update(LOCAL_SHARED, my_id); // may be LOCAL_MODIFIED if the&#61472;&#61472;</P>

<P>// default is owned locally&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry(); </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>6.9 TLB Invalidate Entry, TLB Invalidate Entry </P>

<P>Synchronize Operations </P>

<P> </P>

<P>These operations are used for software coherence management of the TLBs; refer to the descriptions in Section 3.3.6 and Section 3.3.7. </P>

<P> </P>

<P> </P>

<P>6.9.1  Internal Request State Machine </P>

<P> </P>

<P>The TLBIE and TLBSYNC transactions are always sent to all domain participants except the sender and are always to the processor not home memory. </P>

<P> </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>remote_request({TLBIE, TLBSYNC}, participant_id, my_id);&#61472;&#61472;</P>

<P>endif; </P>

<P> </P>

<P>6.9.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local system. The responses are always from a coherence participant, not a home memory. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P> </P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip the responder&#8217;s participant&#61472;&#61472;</P>

<P>// bit and wait for next DONE&#61472;&#61472;</P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>remote_request({TLBIE, TLBSYNC}, received_srcid, my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>6.9.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory or the local system. The requests are always to the local caching hierarchy. </P>

<P> </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request({TLBIE, TLBSYNC}); // spin until a valid response&#61472;&#61472;</P>

<P>// from the caches&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry(); </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.10 Data Cache Flush Operations </P>

<P> </P>

<P>This operation returns ownership of a coherence granule to home memory and performs a coherent write; refer to the description in Section 3.3.9. </P>

<P> </P>

<P> </P>

<P>6.10.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to both local and remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external&#61472;&#61472;</P>

<P>// request in progress or a cache index&#61472;&#61472;</P>

<P>local_response(RETRY); // hazard from a previous request&#61472;&#61472;</P>

<P>elseif (local) // our local memory&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, mask_id, my_id, my_id);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, (mask ~= my_id), my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go to &#61472;&#61472;</P>

<P>// another processing element&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>remote_request(FLUSH, mem_id, my_id, data);&#61472;&#61472;</P>

<P>// data is optional&#61472;&#61472;</P>

<P> </P>

<P>6.10.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local system or a third party. </P>

<P> </P>

<P>if (my_id == mem_id == original_srcid) // original requestor is home memory &#61472;&#61472;</P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P>if (received_data) &#61472;&#61472;</P>

<P> </P>

<P>// with local request or response&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED); // or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip responder&#8217;s shared bit&#61472;&#61472;</P>

<P>endif; // and wait for next DONE&#61472;&#61472;</P>

<P>case NOT_OWNER:&#61472;&#61472;</P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>if (received_data)&#61472;&#61472;</P>

<P>// with local request from memory&#61472;&#61472;</P>

<P> </P>

<P>84 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>my_id);&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED); // or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, mask_id, my_id, </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472; case LOCAL_MODIFIED,&#61472; case LOCAL_SHARED:&#61472;&#61472;</P>

<P>if (received_data)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>// with local request&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>// if there was some write data&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED); // or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // mask_id must match &#61472;&#61472;</P>

<P>// received_srcid or error&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, received_srcid, my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>elseif (my_id == mem_id ~= original_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>switch(received_response)&#61472;&#61472;</P>

<P> </P>

<P>// i&#8217;m home memory working for a third&#61472;&#61472;</P>

<P>// party&#61472;&#61472;</P>

<P>case DONE: // invalidates for shared directory&#61472;&#61472;</P>

<P>// states&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id, my_id);&#61472;&#61472;</P>

<P>if (received_data)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>// with original request or response&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED);// or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip responder&#8217;s shared bit&#61472;&#61472;</P>

<P>endif; // and wait for next DONE&#61472;&#61472;</P>

<P>case NOT_OWNER:&#61472;&#61472;</P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>if (received_data)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>// with original request&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 85 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472; switch(directory_state)&#61472; case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>if (received_data)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>// with original request&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // my_id ~= mem_id - I&#8217;m requesting&#61472;&#61472;</P>

<P>// a remote memory location&#61472;&#61472;</P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>remote_request(FLUSH, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// data is optional&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>6.10.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory or the local system. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision table in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif (FLUSH) // remote request to our local memory&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>// after snoop completes&#61472;&#61472;</P>

<P>if (received_data) // from request or local response&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED, my_id);&#61472;&#61472;</P>

<P>// or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>if (mask_id ~= received_srcid) // owned elsewhere&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, mask_id, my_id,&#61472;&#61472;</P>

<P>my_id); // secondary TID is a don&#8217;t care since data is&#61472;&#61472;</P>

<P>// not forwarded to original requestor&#61472;&#61472;</P>

<P>else // requestor owned it; shouldn&#8217;t&#61472;&#61472;</P>

<P>// generate a flush&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>error();&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P> </P>

<P>86 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>if (mask == received_srcid) // requestor is only remote sharer&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>// after snoop completes&#61472;&#61472;</P>

<P>if (received_data) // from request or response&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED, my_id); // or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else //there are other remote sharers&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, (mask ~= received_srcid), my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 87 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.11 I/O Read Operations </P>

<P> </P>

<P>This operation is used for I/O reads of globally shared memory space; refer to the description in Section 3.3.10. </P>

<P> </P>

<P> </P>

<P>6.11.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to both local and remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external request&#61472;&#61472;</P>

<P>// in progress or a cache index hazard&#61472;&#61472;</P>

<P>local_response(RETRY); // from a previous request&#61472;&#61472;</P>

<P>elseif (local) // our local memory&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED: // local modified is OK if we default&#61472;&#61472;</P>

<P>// local memory to owned&#61472;&#61472;</P>

<P>local_request(READ_LATEST);&#61472;&#61472;</P>

<P>return_data()) // after possible push&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>return_data(); // keep directory state the way it was&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>remote_request(IO_READ_OWNER, mask_id, my_id, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go to &#61472;&#61472;</P>

<P>// another processing element&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>remote_request(IO_READ_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P>6.11.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local system or a third party. </P>

<P> </P>

<P>if (my_id == mem_id == original_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>// original requestor is home memory&#61472;&#61472;</P>

<P>switch(remote_response) // matches my_id only for &#61472;&#61472;</P>

<P>// REMOTE_MODIFIED case&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472; return_data();&#61472; free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER, // due to address collision or &#61472;&#61472;</P>

<P>// passing requests&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>case LOCAL_SHARED&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // mask_id must match received_srcid or&#61472;&#61472;</P>

<P>// error; spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(IO_READ_OWNER, received_srcid, my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>88 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>elseif(my_id == mem_id ~== original_id) // i&#8217;m home memory working for a third&#61472;&#61472;</P>

<P>// party&#61472;&#61472;</P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER, // data comes from memory, mimic&#61472;&#61472;</P>

<P>// intervention&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(IO_READ_OWNER, received_srcid, my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // my_id ~= mem_id - I&#8217;m requesting a&#61472;&#61472;</P>

<P>// remote memory location&#61472;&#61472;</P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case DONE_INTERVENTION: // must be from third party&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_only_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>// wait for a DATA_ONLY&#61472;&#61472;</P>

<P>case DATA_ONLY: // this is due to an intervention, a&#61472;&#61472;</P>

<P>// DONE_INTERVENTION should come&#61472;&#61472;</P>

<P>// separately&#61472;&#61472;</P>

<P>set_received_data_only_message();&#61472;&#61472;</P>

<P>if (received_done_message)&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>remote_request(IO_READ_HOME, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>6.11.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory or the local system. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif (IO_READ_HOME) // remote request to our local memory&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 89 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_request(READ_LATEST);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// after push completes&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(IO_READ_OWNER, mask_id, my_id, received_srcid);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // IO_READ_OWNER request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ_LATEST); // spin until a valid response from&#61472;&#61472;</P>

<P>// the caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push;&#61472;&#61472;</P>

<P>// wait for it&#61472;&#61472;</P>

<P>if (received_srcid == received_secid)&#61472;&#61472;</P>

<P>// original requestor is also home&#61472;&#61472;</P>

<P>// memory&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>remote_response(DATA_ONLY, received_secid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id);&#61472;&#61472;</P>

<P>case INVALID: // must have cast it out during&#61472;&#61472;</P>

<P>// an address collision&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>free_entry();&#61472;&#61472;</P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 7 Address Collision Resolution Tables </P>

<P> </P>

<P> </P>

<P>7.1 Introduction </P>

<P> </P>

<P>Address collisions are conflicts between incoming cache coherence requests to a processing element and outstanding cache coherence requests within it. A collision is usually due to a match between the associated addresses, but also may be because of a conflict for some internal resource such as a cache index. Within a processing element, actions taken in response to an address collision vary depending upon the outstanding request and the incoming request. These actions are described in Table 7-1  through  Table 7-17.  Non-cache  coherent  transactions  (transactions specified in other RapidIO logical specifications) do not cause address collisions. </P>

<P> </P>

<P>Some of the table entries specify that an outstanding request should be canceled at the local processor and that the incoming transaction then be issued immediately to the processor. This choosing between transactions is necessary to prevent deadlock conditions between multiple processing elements vying for ownership of a coherence granule. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>7.2 Resolving an Outstanding READ_HOME Transaction </P>

<P> </P>

<P>Table 7-1 describes the address collision resolution for an incoming transaction that collides with an outstanding READ_HOME transaction. </P>

<P> </P>

<P>Table 7-1. Address Collision Resolution for READ_HOME </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221;, return data if necessary and forward DKILL_SHARER to processor then generate a &#8220;DONE&#8221; response. If final response is &#8220;RETRY&#8221;, cancel the read at the processor and forward DKILL_SHARED to processor then generate a &#8220;DONE&#8221; response </P>

<P>If no outstanding request, cancel the read at the processor and forward DKILL_SHARER to processor then generate a &#8220;DONE&#8221; response (this case should be very rare). </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>7.3  Resolving an Outstanding IREAD_HOME Transaction </P>

<P> </P>

<P>Table 7-2 describes the address collision resolution for an incoming transaction that collides with an outstanding IREAD_HOME transaction. </P>

<P> </P>

<P>Table 7-2. Address Collision Resolution for IREAD_HOME </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>7.4  Resolving an Outstanding READ_OWNER Transaction </P>

<P> </P>

<P>Table 7-3 describes the address collision resolution for an incoming transaction that collides with an outstanding READ_OWNER transaction. </P>

<P> </P>

<P>Table 7-3. Address Collision Resolution for READ_OWNER </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>No collision, update directory state, generate &#8220;DONE&#8221; response (CASTOUT bypasses address collision detection) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>No collision, forward to processor, send IKILL_SHARER to all participants except requestor (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>7.5  Resolving an Outstanding READ_TO_OWN_HOME Transaction </P>

<P> </P>

<P>Table 7-4 describes the address collision resolution for an incoming transaction that collides with an outstanding READ_TO_OWN_HOME transaction. </P>

<P> </P>

<P>Table 7-4. Address Collision Resolution for READ_TO_OWN_HOME </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221;, return data if necessary and forward READ_OWNER to processor and generate an &#8220;DONE_INTERVENTION&#8221; with data response and a &#8220;DATA_ONLY&#8221; to originator as in Section 3.3.1. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response </P>

<P>If no outstanding request generate an &#8220;NOT_OWNER&#8221; </P>

<P>response. </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221;, return data if necessary and forward READ_TO_OWN_OWNER to processor and generate an &#8220;DONE_INTERVENTION&#8221; with data response and a &#8220;DATA_ONLY&#8221; to originator as in Section 3.3.3. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221; generate an &#8220;ERROR&#8221; response (we own the coherence granule and should never see a DKILL). If final response is &#8220;RETRY&#8221; generate a &#8220;DONE&#8221; response and continue the READ_TO_OWN_HOME. </P>

<P>If no outstanding request generate a &#8220;DONE&#8221; response. </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 7-4. Address Collision Resolution for READ_TO_OWN_HOME (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221;, return data if necessary and forward FLUSH to processor and generate a &#8220;DONE&#8221; with data response as in Section 3.3.9. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response (we didn&#8217;t own the data and we lost at home memory) </P>

<P>If no outstanding request generate an &#8220;ERROR&#8221; response </P>

<P>(we didn&#8217;t own the data). </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221;, return data if necessary and forward IO_READ_OWNER to processor then generate a &#8220;DONE&#8221; with data response, etc. as in Section 3.3.10. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response (we didn&#8217;t own the data and we lost at home memory) </P>

<P>If no outstanding request generate an &#8220;NOT_OWNER&#8221; </P>

<P>response. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>7.6 Resolving an Outstanding </P>

<P>READ_TO_OWN_OWNER Transaction </P>

<P> </P>

<P>Table 7-5 describes the address collision resolution for an incoming transaction that collides with an outstanding READ_TO_OWN_OWNER transaction. </P>

<P> </P>

<P>Table 7-5. Address Collision Resolution for READ_TO_OWN_OWNER </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>No collision, update directory state, generate &#8220;DONE&#8221; response (CASTOUT bypasses address collision detection) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>No collision, forward to processor, send IKILL_SHARER to all participants except requestor (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>7.7 Resolving an Outstanding DKILL_HOME Transaction </P>

<P> </P>

<P>Table 7-6 describes the address collision resolution for an incoming transaction that collides with an outstanding DKILL_HOME transaction. </P>

<P> </P>

<P>Table 7-6. Address Collision Resolution for DKILL_HOME </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221;, return data if necessary and forward READ_OWNER to processor and generate a &#8220;DONE_INTERVENTION&#8221; with data response and a &#8220;DATA_ONLY&#8221; to originator as in Section 3.3.1. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response (we didn&#8217;t own the data and we lost at home memory) </P>

<P>If no outstanding request generate an &#8220;ERROR&#8221; response </P>

<P>(we didn&#8217;t own the data). </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221; forward READ_TO_OWN_OWNER to processor and generate a &#8220;DONE_INTERVENTION&#8221; with data response and a &#8220;DATA_ONLY&#8221; to originator as in Section 3.3.3. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response (we didn&#8217;t own the data and we lost at home memory) </P>

<P>If no outstanding request generate an &#8220;ERROR&#8221; response </P>

<P>(we didn&#8217;t own the data). </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221; generate an &#8220;ERROR&#8221; response (we should never see a DKILL_SHARER if we own the coherence granule). If final response is &#8220;RETRY&#8221; cancel the data cache invalidate at the processor and forward DKILL_SHARER to processor then generate a &#8220;DONE&#8221; response </P>

<P>If no outstanding request, cancel the data cache invalidate at the processor and forward DKILL_SHARER to processor then generate a &#8220;DONE&#8221; response. </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (cache paradox, can&#8217;t have a SHARED granule also MODIFIED in another processing element) </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 7-6. Address Collision Resolution for DKILL_HOME (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221; forward IO_READ_OWNER to processor then generate a &#8220;DONE&#8221; with data response, etc. as in Section 3.3.10. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response (we didn&#8217;t own the data and we lost at home memory) </P>

<P>If no outstanding request generate an &#8220;ERROR&#8221; response </P>

<P>(we didn&#8217;t own the data). </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>7.8  Resolving an Outstanding DKILL_SHARER Transaction </P>

<P> </P>

<P>Table 7-7 describes the address collision resolution for an incoming transaction that collides with an outstanding DKILL_SHARER transaction. </P>

<P> </P>

<P>Table 7-7. Address Collision Resolution for DKILL_SHARER </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (cache paradox, can&#8217;t have a SHARED granule also MODIFIED in another processing element) </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>No collision, forward to processor, send IKILL_SHARER to all participants except requestor (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>If processing element is HOME: generate a &#8220;RETRY&#8221; </P>

<P>response </P>

<P>If processing element is not HOME: If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221; forward IO_READ to processor then generate a &#8220;DONE&#8221; with data response, etc. as in Section 3.3.10. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response (we didn&#8217;t own the data and we lost at home memory) </P>

<P>If no outstanding request generate an &#8220;ERROR&#8221; response </P>

<P>(we didn&#8217;t own the data). </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>7.9 Resolving an Outstanding IKILL_HOME Transaction </P>

<P> </P>

<P>Table 7-8 describes the address collision resolution for an incoming transaction that collides with an outstanding IKILL_HOME transaction. </P>

<P> </P>

<P>Table 7-8. Address Collision Resolution for IKILL_HOME </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>7.10 Resolving an Outstanding IKILL_SHARER Transaction </P>

<P> </P>

<P>Table 7-9 describes the address collision resolution for an incoming transaction that collides with an outstanding IKILL_SHARER transaction. </P>

<P> </P>

<P>Table 7-9. Address Collision Resolution for IKILL_SHARER </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>No collision, forward to processor, send IKILL_SHARER to all participants except requestor (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>No collision, process normally </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>If processing element is HOME: generate a &#8220;RETRY&#8221; </P>

<P>response </P>

<P>If processing element is not HOME: If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221; forward IO_READ to processor then generate a &#8220;DONE&#8221; with data response, etc. as in Section 3.3.10. If final response is &#8220;RETRY&#8221; generate an &#8220;ERROR&#8221; response (we didn&#8217;t own the data and we lost at home memory) </P>

<P>If no outstanding request generate an &#8220;ERROR&#8221; response </P>

<P>(we didn&#8217;t own the data). </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>7.11 Resolving an Outstanding CASTOUT Transaction </P>

<P> </P>

<P>Table 7-10 describes the address collision resolution for an incoming transaction that collides with an outstanding CASTOUT transaction. </P>

<P> </P>

<P>Table 7-10. Address Collision Resolution for CASTOUT </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response; the CASTOUT will bypass address collision at home memory and modify the directory state </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response; the CASTOUT will bypass address collision at home memory and modify the directory state </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response; the CASTOUT will bypass address collision at home memory and modify the directory state </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>7.12  Resolving an Outstanding TLBIE or TLBSYNC Transaction </P>

<P> </P>

<P>Table 7-11 describes the address collision resolution for an incoming transaction that collides with an outstanding TLBIE or TLBSYNC transaction. </P>

<P> </P>

<P>Table 7-11. Address Collision Resolution for Software Coherence Operations </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>TLBIE, TLBSYNC </P>
</TD>

<TD>
<P>ANY </P>
</TD>

<TD>
<P>No collision, process request as described in Chapter 6, &#8220;Communication Protocols&#8221; </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>7.13 Resolving an Outstanding FLUSH Transaction </P>

<P> </P>

<P>The flush operation has two distinct versions. The first is for processing elements that participate in the coherence protocol such as a processor and it&#8217;s associated agent, which may also have a local I/O device. The second is for processing elements that do not participate in the coherence protocols such as a pure I/O device that does not have a corresponding bit in the directory sharing mask. Table 7-12 describes the address collision resolution for an incoming transaction that collides with an outstanding participant FLUSH transaction. </P>

<P> </P>

<P>Table 7-12. Address Collision Resolution for Participant FLUSH </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response (we are not allowed to issue FLUSH to an owned coherence granule - should be a CASTOUT) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response (we are not allowed to issue FLUSH to an owned coherence granule - should be a CASTOUT) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221; generate an &#8220;ERROR&#8221; response (we should never see a DKILL_SHARER if we own the coherence granule). If final response is &#8220;RETRY&#8221; cancel the flush at the processor and forward DKILL_SHARER to processor then generate a &#8220;DONE&#8221; response </P>

<P>If no outstanding request, cancel the data cache invalidate at the processor and forward DKILL_SHARER to processor then generate a &#8220;DONE&#8221; response. </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response (we are not allowed to issue FLUSH to an owned coherence granule - should be a CASTOUT) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 7-13 describes the address collision resolution for an incoming transaction that collides with an outstanding non-participant FLUSH transaction. </P>

<P> </P>

<P>Table 7-13. Address Collision Resolution for Non-participant FLUSH </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain TLB entry coherence) - non-participant may have page table hardware. </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain TLB entry coherence) - non-participant may have page table hardware. </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) - non-participant may have software coherence. </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>7.14 Resolving an Outstanding IO_READ_HOME Transaction </P>

<P> </P>

<P>The I/O read operation is used by processing elements that do not want to participate in the coherence protocol but do want to get current copies of cached data. There are two versions of this operation, one for processing elements that have both processors and I/O devices, the second for pure I/O devices that do not have a corresponding bit  in  the  directory  sharing  mask.  Table 7-14  describes  the  address  collision resolution for an incoming transaction that collides with an outstanding participant IO_READ_HOME transaction. </P>

<P> </P>

<P>Table 7-14. Address Collision Resolution for Participant IO_READ_HOME </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response (we don&#8217;t own the data otherwise we could have obtained a copy locally) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response (we don&#8217;t own the data otherwise we could have obtained a copy locally) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>If outstanding request, wait for all expected responses. If final response is &#8220;DONE&#8221;, return data if necessary and forward DKILL_SHARER to processor then generate a &#8220;DONE&#8221; response. If final response is &#8220;RETRY&#8221; forward DKILL_SHARED to processor then generate a &#8220;DONE&#8221; response </P>

<P>If no outstanding request forward DKILL_SHARER to processor then generate a &#8220;DONE&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;NOT_OWNER&#8221; response (we don&#8217;t own the data otherwise we could have obtained a copy locally) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 7-15 describes the address collision resolution for an incoming transaction that collides with an outstanding non-participant IO_READ_HOME transaction. </P>

<P> </P>

<P>Table 7-15. Address Collision Resolution for Non-participant IO_READ_HOME </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain TLB entry coherence) - broadcast operation and non-participant may have page table hardware. </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain TLB entry coherence) - broadcast operation and non-participant may have page table hardware. </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain instruction cache coherence) - broadcast operation and non-participant may have software coherence. </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>7.15  Resolving an Outstanding IO_READ_OWNER Transaction </P>

<P> </P>

<P>The I/O read operation is used by processing elements that do not want to participate in the coherence protocol but do want to get current copies of cached data. There are two versions of this operation, one for processing elements that have both processors and I/O devices, the second for pure I/O devices that do not have a corresponding bit  in  the  directory  sharing  mask.  Table 7-16  describes  the  address  collision resolution for an incoming transaction that collides with an outstanding IO_READ_OWNER transaction. </P>

<P> </P>

<P>Table 7-16. Address Collision Resolution for Participant IO_READ_OWNER </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>No collision, update directory state and memory, generate DONE response (CASTOUT bypasses address collision detection) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; </P>

<P>response (software must maintain TLB entry coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>No collision, forward to processor, send IKILL_SHARER to all participants except requestor (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;RETRY&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (we don&#8217;t own the data otherwise we could have obtained a copy locally) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 7-17 describes the address collision resolution for an incoming transaction that collides with an outstanding non-participant IO_READ_OWNER transaction. </P>

<P> </P>

<P>Table 7-17. Address Collision Resolution for Non-participant IO_READ_OWNER </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Outstanding Request </P>
</TD>

<TD>
<P>Incoming Request </P>
</TD>

<TD>
<P>Resolution </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain TLB entry coherence) - non-participant may have page table hardware. </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>No collision, forward to processor then generate &#8220;DONE&#8221; response (software must maintain TLB entry coherence) - non-participant may have page table hardware. </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>No collision, forward to processor, send IKILL_SHARER to all participants except requestor (software must maintain instruction cache coherence) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>FLUSH </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>Generate &#8220;ERROR&#8221; response (should never receive coherent operation) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_814.jpg"/>
</Figure>

<P>A Address collision. An address based conflict between two or more cache coherence operations when referencing the same coherence granule. </P>

<P> </P>

<P>Agent. A processing element that provides services to a processor. </P>

<P> </P>

<P>Asychronous transfer mode (ATM). A standard networking protocol which dynamically allocates bandwidth using a fixed-size packet. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_815.jpg"/>
</Figure>

<P>B Big-endian. A byte-ordering method in memory where the address n of a word corresponds to the most significant byte. In an addressed memory word, the bytes are ordered (left to right) 0, 1, 2, 3, with 0 </P>

<P>being the most significant byte. </P>

<P> </P>

<P>Block flush. An operation that returns the latest copy of a block of data from caches within the system to memory. </P>

<P> </P>

<P>Bridge. A processing element that connects one computer bus to another, allowing a processing element on one bus to access an processing element on the other. </P>

<P> </P>

<P>Broadcast. The concept of sending a packet to all processing elements in a system. </P>

<P> </P>

<P>Bus-based snoopy protocol. A broadcast cache coherence protocol that assumes that all caches in the system are on a common bus. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_816.jpg"/>
</Figure>

<P>C Cache.  High-speed  memory  containing  recently  accessed  data  and/or instructions (subset of main memory) associated with a processor. </P>

<P> </P>

<P>Cache coherence. Caches are coherent if a processor performing a read from its cache is supplied with data corresponding to the most recent value written to memory or to another processor&#8217;s cache. In other words, a write operation to an address in the system is visible to all other caches in the system. Also referred to as memory coherence. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Cache coherent-non uniform memory access (CC-NUMA). A cache coherent system in which memory accesses have different latencies depending upon the physical location of the accessed address. </P>

<P> </P>

<P>Cache paradox. A circumstance in which the caches in a system have an undefined or disallowed state for a coherence granule, for example, two caches have the same coherence granule marked &#8220;modified&#8221;. </P>

<P> </P>

<P>Capability registers (CARs). A set of read-only registers that allows a processing element to determine another processing element&#8217;s capabilities. </P>

<P> </P>

<P>Castout operation. An operation used by a processing element to relinquish its ownership of a coherence granule and return it to home memory. </P>

<P> </P>

<P>Coherence domain. A logically associated group of processing elements that participate in the globally shared memory protocol and are able to maintain cache coherence among themselves. </P>

<P> </P>

<P>Coherence granule. A contiguous block of data associated with an address for the purpose of guaranteeing cache coherence. </P>

<P> </P>

<P>Command and status registers (CSRs). A set  of  registers that  allows a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_817.jpg"/>
</Figure>

<P>D Deadlock. A situation in which two processing elements that are sharing resources prevent each other from accessing the resources, resulting in a halt of system operation. </P>

<P> </P>

<P>Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Device ID. The identifier of an end point processing element connected to the </P>

<P>RapidIO interconnect. </P>

<P> </P>

<P>Direct Memory Access (DMA). The process of accessing memory in a device by specifying the memory address directly. </P>

<P> </P>

<P>Distributed memory. System memory that  is  distributed throughout the system, as opposed to being centrally located. </P>

<P> </P>

<P>Domain. A logically associated group of processing elements. </P>

<P> </P>

<P>Double-word. An eight byte quantity, aligned on eight byte boundaries. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_818.jpg"/>
</Figure>

<P>E End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>Ethernet. A common local area network (LAN) technology. </P>

<P> </P>

<P>Exclusive. A processing element has the only cached copy of a sharable coherence granule. The exclusive state allows the processing element to modify the coherence granule without notifying the rest of the system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_819.jpg"/>
</Figure>

<P>F Field or Field name. A sub-unit of a register, where bits in the register are named and defined. </P>

<P> </P>

<P>Flush operation. An operation used by a processing element to return the ownership and current data of a coherence granule to home memory. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_820.jpg"/>
</Figure>

<P>G Globally shared memory (GSM). Cache coherent system memory that can be shared between multiple processors in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_821.jpg"/>
</Figure>

<P>H Half-word. A two byte or 16 bit quantity, aligned on two byte boundaries. </P>

<P> </P>

<P>Home memory. The physical memory corresponding to the physical address of a coherence granule. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_822.jpg"/>
</Figure>

<P>I Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P>Instruction cache. High-speed memory containing recently accessed instructions (subset of main memory) associated with a processor. </P>

<P> </P>

<P>Instruction cache invalidate operation. An operation that is used if the instruction cache coherence must be maintained by software. </P>

<P> </P>

<P>Instruction read operation. An operation used to obtain a globally shared copy of a coherence granule specifically for an instruction cache. </P>

<P> </P>

<P>Instruction set architecture (ISA). The instruction set for a certain processor or family of processors. </P>

<P> </P>

<P>Intervention. A data transfer between two processing elements that does not go through the coherence granule&#8217;s home memory, but directly between the requestor of the coherence granule and the current owner. </P>

<P> </P>

<P>Invalidate operation. An operation used to remove a coherence granule from caches within the coherence domain. </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>I/O. Input-output. </P>

<P> </P>

<P>I/O read operation. An operation used by an I/O processing element to obtain a globally shared copy of a coherence granule without disturbing the coherence state of the granule. </P>

<P> </P>

<P> </P>

<Textbox>
<P>K </P>
</Textbox>

<P>L Little-endian. A byte-ordering method in memory where the address n of a word corresponds to the least significant byte. In an addressed memory word, the bytes are ordered (left to right) 3, 2, 1, 0, with 3 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_823.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_824.jpg"/>
</Figure>

<P>being the most significant byte. </P>

<P> </P>

<P>Local memory. Memory associated with the processing element in question. </P>

<P> </P>

<P>LSB. Least significant byte. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_825.jpg"/>
</Figure>

<P>M Memory coherence. Memory is coherent if a processor performing a read from its cache is supplied with data corresponding to the most recent value written to memory or to another processor&#8217;s cache. In other </P>

<P>words, a write operation to an address in the system is visible to all other caches in the system. Also referred to as cache coherence. </P>

<P> </P>

<P>Memory controller. The point through which home memory is accessed. </P>

<P> </P>

<P>Memory directory. A table of information associated with home memory that is used to track the location and state of coherence granules cached by coherence domain participants. </P>

<P> </P>

<P>Message passing. An application programming model that allows processing elements to communicate via messages to mailboxes instead of via DMA or GSM. Message senders do not write to a memory address in the receiver. </P>

<P> </P>

<P>Modified. A processing element has written to a locally cached coherence granule and so has the only valid copy of the coherence granule in the system. </P>

<P> </P>

<P>Modified exclusive shared invalid (MESI). A standard 4 state cache coherence definition. </P>

<P> </P>

<P>Modified shared invalid (MSI). A standard 3 state cache coherence definition. </P>

<P> </P>

<P>Modified shared local (MSL). A standard 3 state cache coherence definition. </P>

<P> </P>

<P>MSB. Most significant byte. </P>

<P> </P>

<P>Multicast. The concept of sending a packet to more than one processing elements in a system. </P>

<P> </P>

<P>114 RapidIO Trade Association </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_826.jpg"/>
</Figure>

<P>N Non-coherent. A transaction that does not participate in any system globally shared memory cache coherence mechanism. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_827.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P>Ownership. A processing element has the only valid copy of a coherence granule and is responsible for returning it to home memory. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_828.jpg"/>
</Figure>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>

<P>system. </P>

<P> </P>

<P>Peripheral component interface (PCI). A bus commonly used for connecting I/O devices in a system. </P>

<P> </P>

<P>Priority. The relative importance of a packet; in most systems a higher priority packet will be serviced or transmitted before one of lower priority. </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P>Processor. The logic circuitry that responds to and processes the basic instructions that drive a computer. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_829.jpg"/>
</Figure>

<P>R Read operation. An operation used to obtain a globally shared copy of a coherence granule. </P>

<P> </P>

<P>Read-for-ownership operation. An operation used to obtain ownership of a coherence granule for the purposes of performing a write operation. </P>

<P> </P>

<P>Remote access. An access by a processing element to memory located in another processing element. </P>

<P> </P>

<P>Remote memory. Memory associated with a processing element other than the processing element in question. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_830.jpg"/>
</Figure>

<P>S Shared. A processing element has a cached copy of a coherence granule that may be cached by other processing elements and is consistent with the copy in home memory. </P>

<P> </P>

<P>Sharing mask. The state associated with a coherence granule in the memory directory that tracks the processing elements that are sharing the coherence granule. </P>

<P> </P>

<P>Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>RapidIO Trade Association 115 </P>

<P>RapidIO Part 5: Globally Shared Memory Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Sub-double-word. Aligned on eight byte boundaries. </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on one of its input ports to one of its output ports. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_831.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P>Translation look-aside buffer (TLB).   Part of a processor&#8217;s memory management unit; a TLB contains a set of virtual to physical page address translations, along with a set of attributes that describe access behavior for that portion of physical memory. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_832.jpg"/>
</Figure>

<P>W Write-through. A cache policy that passes all write operations through the caching hierarchy directly to home memory. </P>

<P> </P>

<P>Word. A four byte or 32 bit quantity, aligned on four byte boundaries. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>116 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_833.jpg"/>
</Figure>

<P>RapidIOTM Interconnect Specification Part 6: LP-Serial Physical Layer Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.1 </P>
</TD>

<TD>
<P>First release </P>
</TD>

<TD>
<P>12/17/2001 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.2 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev. 1.1 errata rev. 1.1.1, errata 3 </P>
</TD>

<TD>
<P>06/26/2002 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev 1.2 errata 1 as applicable, </P>

<P>the following errata showings: 03-03-00004.002, 03-07-00002.001, 03-12-00000.002, </P>

<P>03-12-00002.004, 04-02-00000.001, 04-05-00000.003, 04-05-00006.002 (partial), </P>

<P>04-05-00007.001 </P>

<P>and the following new features showings: 02-03-0003.004, 02-06-00001.004, </P>

<P>04-08-00013.002, 04-09-00022.002 </P>

<P>Converted to ISO-friendly templates </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Significant editorial changes </P>

<P>Technical changes: errata showings 04-11-00031.001, 06-04-00000.003, </P>

<P>06-07-00001.001, 07-03-00000.002, 07-03-00001.001 </P>

<P>new features showings 05-04-00001.005, 05-04-00003.004, new speed bin and width definitions with supporting protocol </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0.1 </P>
</TD>

<TD>
<P>Very minor editorial changes </P>
</TD>

<TD>
<P>08/29/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Significant editorial changes </P>

<P>Technical changes: errata showings 07-09-00000.003, 07-06-00000.010, </P>

<P>08-05-00001.003, 08-03-00000.001, 08-02-00000.008, 08-06-00001.004, </P>

<P>07-11-00001.010, 08-10-00000.003, 08-11-00001.000 </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Significant editorial changes </P>

<P>Technical changes: errata showings 09-08-00000.005, 09-09-00000.004, </P>

<P>10-02-00000.001, 10-03-00000.004, 10-01-00003.006, 10-08-00000.003, </P>

<P>10-08-00001.005, 10-10-00000.002, 10-10-00001.004, 10-11-00002.001, </P>

<P>11-02-00000.002, Consolidated Comments on 11-01-00000.000 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_834.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P> </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction........................................................................................................... 25 </P>

<P>1.2 Contents ................................................................................................................ 26 </P>

<P>1.3 Terminology.......................................................................................................... 27 </P>

<P>1.4 Conventions .......................................................................................................... 27 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Packets </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 29 </P>

<P>2.2 Packet Field Definitions........................................................................................ 29 </P>

<P>2.3 Packet Format ....................................................................................................... 31 </P>

<P>2.4 Packet Protection .................................................................................................. 31 </P>

<P>2.4.1 Packet CRC Operation...................................................................................... 32 </P>

<P>2.4.2 CRC-16 Code.................................................................................................... 34 </P>

<P>2.5 Maximum Packet Size .......................................................................................... 36 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Control Symbols </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 37 </P>

<P>3.2 Control Symbol Field Definitions......................................................................... 39 </P>

<P>3.3 Control Symbol Format ........................................................................................ 39 </P>

<P>3.4 Stype0 Control Symbols ....................................................................................... 40 </P>

<P>3.4.1 Packet-Accepted Control Symbol..................................................................... 42 </P>

<P>3.4.2 Packet-Retry Control Symbol ........................................................................... 42 </P>

<P>3.4.3 Packet-Not-Accepted Control Symbol ............................................................. 43 </P>

<P>3.4.4 Status Control Symbol ...................................................................................... 44 </P>

<P>3.4.5 VC-Status Control Symbol ............................................................................... 44 </P>

<P>3.4.6 Link-Response Control Symbol ....................................................................... 45 </P>

<P>3.5 Stype1 Control Symbols ....................................................................................... 46 </P>

<P>3.5.1 Start-of-Packet Control Symbol........................................................................ 48 </P>

<P>3.5.2 Stomp Control Symbol ..................................................................................... 48 </P>

<P>3.5.3 End-of-Packet Control Symbol......................................................................... 48 </P>

<P>3.5.4 Restart-From-Retry Control Symbol ................................................................ 49 </P>

<P>3.5.5 Link-Request Control Symbol .......................................................................... 49 </P>

<P>3.5.5.1 Reset-Device Command ............................................................................... 50 </P>

<P>3.5.5.2 Input-Status Command ................................................................................. 50 </P>

<P>3.5.6 Multicast-Event Control Symbol ...................................................................... 50 </P>

<P>3.6 Control Symbol Protection ................................................................................... 51 </P>

<P>3.6.1 CRC-5 Code...................................................................................................... 51 </P>

<P>3.6.2 CRC-5 Parallel Code Generation...................................................................... 51 </P>

<P>3.6.3 CRC-13 Code.................................................................................................... 53 </P>

<P> </P>

<P>RapidIO Trade Association 5 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>3.6.4 CRC-13 Parallel Code Generation.................................................................... 53 </P>

<P> </P>

<P> </P>

<P>Chapter 4 PCS and PMA Layers </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 55 </P>

<P>4.2 PCS Layer Functions ............................................................................................ 55 </P>

<P>4.3 PMA Layer Functions........................................................................................... 56 </P>

<P>4.4 Definitions ............................................................................................................ 56 </P>

<P>4.5 8B/10B Transmission Code .................................................................................. 57 </P>

<P>4.5.1 Character and Code-Group Notation ................................................................ 58 </P>

<P>4.5.2 Running Disparity............................................................................................. 59 </P>

<P>4.5.3 Running Disparity Rules................................................................................... 59 </P>

<P>4.5.4 8B/10B Encoding.............................................................................................. 60 </P>

<P>4.5.5 Transmission Order........................................................................................... 60 </P>

<P>4.5.6 8B/10B Decoding ............................................................................................. 61 </P>

<P>4.5.7 Special Characters and Columns ...................................................................... 70 </P>

<P>4.5.7.1 Packet Delimiter Control Symbol (/PD/)...................................................... 70 </P>

<P>4.5.7.2 Start of Control Symbol (/SC/) ..................................................................... 71 </P>

<P>4.5.7.3 Idle (/I/) ......................................................................................................... 71 </P>

<P>4.5.7.4 Sync (/K/)...................................................................................................... 71 </P>

<P>4.5.7.5 Skip (/R/) ...................................................................................................... 71 </P>

<P>4.5.7.6 Align (/A/) .................................................................................................... 71 </P>

<P>4.5.7.7 Mark (/M/) .................................................................................................... 71 </P>

<P>4.5.7.8 Illegal ............................................................................................................ 71 </P>

<P>4.5.8 Effect of Single Bit Code-Group Errors ........................................................... 71 </P>

<P>4.6 LP-Serial Link Widths .......................................................................................... 72 </P>

<P>4.7 Idle Sequence ........................................................................................................ 73 </P>

<P>4.7.1 Clock Compensation Sequence ........................................................................ 74 </P>

<P>4.7.2 Idle Sequence 1 (IDLE1) .................................................................................. 74 </P>

<P>4.7.3 Idle Sequence 1 Generation .............................................................................. 75 </P>

<P>4.7.4 Idle Sequence 2 (IDLE2) .................................................................................. 77 </P>

<P>4.7.4.1 Idle Frame ..................................................................................................... 78 </P>

<P>4.7.4.1.1 IDLE Sequence 2 Random Data Field ..................................................... 78 </P>

<P>4.7.4.1.2 IDLE Sequence 2 CS Field Marker .......................................................... 79 </P>

<P>4.7.4.1.3 IDLE2 Command and Status Field (CS field) .......................................... 81 </P>

<P>4.7.4.1.4 IDLE2 CS Field Use ................................................................................. 83 </P>

<P>4.7.5 Idle Sequence Selection .................................................................................... 86 </P>

<P>4.8 Scrambling ............................................................................................................ 87 </P>

<P>4.8.1 Scrambling Rules .............................................................................................. 87 </P>

<P>4.8.2 Descrambler Synchronization........................................................................... 89 </P>

<P>4.8.3 Descrambler Synchronization Verification ...................................................... 90 </P>

<P>4.9 1x Mode Transmission Rules ............................................................................... 91 </P>

<P>4.9.1 1x Ports ............................................................................................................. 91 </P>

<P>4.9.2 Nx Ports Operating in 1x Mode ........................................................................ 93 </P>

<P>4.10 Nx Link Striping and Transmission Rules............................................................ 94 </P>

<P>4.11 Retimers and Repeaters ........................................................................................ 96 </P>

<P> </P>

<P>6 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>4.11.1 Retimers ............................................................................................................ 97 </P>

<P>4.11.2 Repeaters........................................................................................................... 97 </P>

<P>4.12 Port Initialization .................................................................................................. 98 </P>

<P>4.12.1 1x Mode Initialization....................................................................................... 98 </P>

<P>4.12.2 1x/Nx Mode Initialization................................................................................. 98 </P>

<P>4.12.3 Baud Rate Discovery ........................................................................................ 99 </P>

<P>4.12.4 State Machines ................................................................................................ 101 </P>

<P>4.12.4.1 State Machine Conventions, Functions and Variables ............................... 101 </P>

<P>4.12.4.1.1 State Machine Conventions .................................................................... 101 </P>

<P>4.12.4.1.2 State Machine Functions ........................................................................ 101 </P>

<P>4.12.4.1.3 State Machine Variables ......................................................................... 101 </P>

<P>4.12.4.2 Lane Synchronization State Machine ......................................................... 106 </P>

<P>4.12.4.3 Lane Alignment State Machine .................................................................. 110 </P>

<P>4.12.4.4 1x/2x Mode Detect State Machine ............................................................. 112 </P>

<P>4.12.4.5 1x Mode Initialization State Machine......................................................... 113 </P>

<P>4.12.4.6 1x/Nx Mode Initialization State Machine for N = 4, 8, 16......................... 114 </P>

<P>4.12.4.7 1x/2x Mode Initialization State Machine ................................................... 120 </P>

<P>4.12.4.8 1x/Mx/Nx Mode Initialization State Machines .......................................... 123 </P>

<P>4.12.4.8.1 1x/2x/Nx Initialization State Machine.................................................... 123 </P>

<P>4.12.4.8.2 1x/Mx/Nx Initialization State Machine (N &gt; M &gt; 2) ............................. 127 </P>

<P> </P>

<P> </P>

<P>Chapter 5 LP-Serial Protocol </P>

<P> </P>

<P>5.1 Introduction......................................................................................................... 131 </P>

<P>5.2 Packet Exchange Protocol .................................................................................. 131 </P>

<P>5.3 Traffic types ........................................................................................................ 132 </P>

<P>5.4 Virtual Channels ................................................................................................. 133 </P>

<P>5.4.1 Virtual channel 0 (VC0) ................................................................................. 133 </P>

<P>5.4.2 Virtual Channels 1-8 (VC1-8) ........................................................................ 133 </P>

<P>5.4.3 Virtual Channel Utilization............................................................................. 134 </P>

<P>5.5 Control Symbols ................................................................................................. 134 </P>

<P>5.5.1 Control Symbol Selection ............................................................................... 134 </P>

<P>5.5.2 Control Symbol Delimiting ............................................................................ 135 </P>

<P>5.5.3 Control Symbol Use ....................................................................................... 135 </P>

<P>5.5.3.1 Link Initialization ....................................................................................... 135 </P>

<P>5.5.3.2 Buffer Status Maintenance ......................................................................... 137 </P>

<P>5.5.3.3 Embedded Control Symbols ....................................................................... 137 </P>

<P>5.5.3.4 Multicast-Event Control Symbols .............................................................. 138 </P>

<P>5.6 Packets ................................................................................................................ 139 </P>

<P>5.6.1 Packet Delimiting ........................................................................................... 139 </P>

<P>5.6.1.1 Packet Start ................................................................................................. 139 </P>

<P>5.6.1.2 Packet Termination ..................................................................................... 139 </P>

<P>5.6.2 Acknowledgment Identifier ............................................................................ 139 </P>

<P>5.6.3 Packet Priority and Transaction Request Flows ............................................. 140 </P>

<P>5.7 Link Maintenance Protocol................................................................................. 141 </P>

<P>5.8 Packet Transmission Protocol............................................................................. 142 </P>

<P> </P>

<P>RapidIO Trade Association 7 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>5.9 Flow Control ....................................................................................................... 145 </P>

<P>5.9.1 Receiver-Controlled Flow Control ................................................................. 145 </P>

<P>5.9.1.1 Reliable Traffic VC Receivers.................................................................... 145 </P>

<P>5.9.1.2 Continuous Traffic VC Receivers .............................................................. 146 </P>

<P>5.9.1.3 Single VC Retry Protocol ........................................................................... 146 </P>

<P>5.9.1.4 Input Retry-Stopped Recovery Process ...................................................... 147 </P>

<P>5.9.1.5 Output Retry-Stopped Recovery Process ................................................... 147 </P>

<P>5.9.2 Transmitter-Controlled Flow Control ............................................................. 148 </P>

<P>5.9.2.1 Receive Buffer Management ...................................................................... 150 </P>

<P>5.9.2.2 Effective Number of Free Receive Buffers ................................................ 151 </P>

<P>5.9.2.3 Speculative Packet Transmission ............................................................... 152 </P>

<P>5.9.3 Flow Control Mode Negotiation..................................................................... 153 </P>

<P>5.10 Canceling Packets ............................................................................................... 153 </P>

<P>5.11 Transaction and Packet Delivery Ordering Rules............................................... 154 </P>

<P>5.12 Deadlock Avoidance ........................................................................................... 156 </P>

<P>5.13 Error Detection and Recovery ............................................................................ 158 </P>

<P>5.13.1 Lost Packet Detection ..................................................................................... 159 </P>

<P>5.13.2 Link Behavior Under Error............................................................................. 160 </P>

<P>5.13.2.1 Recoverable Errors ..................................................................................... 160 </P>

<P>5.13.2.2 Idle Sequence Errors ................................................................................... 160 </P>

<P>5.13.2.2.1 IDLE1 Sequence Errors .......................................................................... 160 </P>

<P>5.13.2.2.2 IDLE2 Sequence Errors .......................................................................... 161 </P>

<P>5.13.2.3 Control Symbol Errors................................................................................ 161 </P>

<P>5.13.2.3.1 Link Protocol Violations ........................................................................ 161 </P>

<P>5.13.2.3.2 Corrupted Control symbols .................................................................... 162 </P>

<P>5.13.2.4 Packet Errors............................................................................................... 163 </P>

<P>5.13.2.5 Link Timeout .............................................................................................. 163 </P>

<P>5.13.2.6 Input Error-Stopped Recovery Process ...................................................... 163 </P>

<P>5.13.2.7 Output Error-Stopped Recovery Process .................................................... 165 </P>

<P>5.14 Power Management ............................................................................................ 165 </P>

<P> </P>

<P> </P>

<P>Chapter 6  LP-Serial Registers </P>

<P> </P>

<P>6.1 Introduction......................................................................................................... 167 </P>

<P>6.2 Register Map ....................................................................................................... 167 </P>

<P>6.3 Reserved Register, Bit and Bit Field Value Behavior ........................................ 168 </P>

<P>6.4 Capability Registers (CARs) .............................................................................. 170 </P>

<P>6.4.1 Processing Element Features CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x10) 170 </P>

<P>6.5 LP-Serial Extended Feature Blocks .................................................................... 171 </P>

<P>6.5.1 Generic End Point Devices ............................................................................. 171 </P>

<P>6.5.2 Generic End Point Devices, software assisted error recovery option ............. 173 </P>

<P>6.5.3 Generic End Point Free Devices ..................................................................... 175 </P>

<P>6.5.4 Generic End Point Free Devices, software assisted error recovery option..... 177 </P>

<P>6.6 LP-Serial Command and Status Registers (CSRs) ............................................. 179 </P>

<P>6.6.1 LP-Serial Register Block Header (Block Offset 0x0) ................................... 179 </P>

<P> </P>

<P>8 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.2 Port Link Timeout Control CSR (Block Offset 0x20).................................... 180 </P>

<P>6.6.3 Port Response Timeout Control CSR (Block Offset 0x24) ............................ 181 </P>

<P>6.6.4 Port General Control CSR (Block Offset 0x3C) ............................................ 182 </P>

<P>6.6.5 Port n Link Maintenance Request CSRs (Block Offsets 0x40, 60, ... , 220).. 183 </P>

<P>6.6.6 Port n Link Maintenance Response CSRs (Block Offsets 0x44, 64, ... , 224) 184 </P>

<P>6.6.7 Port n Local ackID CSRs (Block Offsets 0x48, 68, ... , 228) ......................... 185 </P>

<P>6.6.8 Port n Error and Status CSRs (Block Offset 0x58, 78, ... , 238) .................... 186 </P>

<P>6.6.9 Port n Control CSRs (Block Offsets 0x5C, 7C, ... , 23C)............................... 188 </P>

<P>6.6.10 Port n Control 2 CSRs (Block Offset 0x54, 74, ... , 234) ............................... 191 </P>

<P>6.7 LP-Serial Lane Extended Features Block ........................................................... 195 </P>

<P>6.7.1 Register Map................................................................................................... 195 </P>

<P>6.7.2 LP-Serial Lane Command and Status Registers (CSRs) ................................ 197 </P>

<P>6.7.2.1 LP-Serial Register Block Header (Block Offset 0x0) ................................ 197 </P>

<P>6.7.2.2 Lane n Status 0 CSRs (Block Offsets 0x10, 30, ... , 3F0) .......................... 198 </P>

<P>6.7.2.3 Lane n Status 1 CSRs (Block Offsets 0x14, 34, ... , 3F4) .......................... 200 </P>

<P>6.7.2.4 Implementation Specific CSRs................................................................... 202 </P>

<P>6.7.2.4.1 Lane n Status 2 CSR (Block Offsets 0x18, 38, ..., 3F8) ......................... 202 </P>

<P>6.7.2.4.2 Lane n Status 3 CSR (Block Offsets 0x1C, 3C, ..., 3FC) ....................... 202 </P>

<P>6.7.2.4.3 Lane n Status 4 CSR (Block Offsets 0x20, 40, ..., 400) ......................... 202 </P>

<P>6.7.2.4.4 Lane n Status 5 CSR (Block Offsets 0x24, 44, ..., 404) ......................... 202 </P>

<P>6.7.2.4.5 Lane n Status 6 CSR (Block Offsets 0x28, 48, ..., 408) ......................... 202 </P>

<P>6.7.2.4.6 Lane n Status 7 CSR (Block Offsets 0x2C, 4C, ..., 40C) ....................... 202 </P>

<P>6.8 Virtual Channel Extended Features Block.......................................................... 203 </P>

<P>6.8.1 Register Map................................................................................................... 203 </P>

<P>6.8.2 Virtual Channel Control Block Registers ....................................................... 205 </P>

<P>6.8.2.1 VC Register Block Header (Block Offset 0x0) .......................................... 205 </P>

<P>6.8.2.2 Port n VC Control and Status Registers&#61472;&#61472;</P>

<P>(Block Offset ((port number) + 1) * 0x20)) ............................................206 </P>

<P>6.8.2.3 Port n VC0 BW Allocation Registers&#61472;&#61472;</P>

<P>(Block Offset (((port number) + 1) * 0x20) + 0x04))..............................208 </P>

<P>6.8.2.4 Port n VCx BW Allocation Registers&#61472;&#61472;</P>

<P>(Block Offset ((((port number) + 1) * 0x20) + &#61472;&#61472;</P>

<P>(offset based on VC #, see Table 6-23))).................................................210 </P>

<P> </P>

<P> </P>

<P>Chapter 7 Signal Descriptions </P>

<P> </P>

<P>7.1 Introduction......................................................................................................... 211 </P>

<P>7.2 Signal Definitions ............................................................................................... 211 </P>

<P>7.3 Serial RapidIO Interface Diagrams..................................................................... 211 </P>

<P> </P>

<P> </P>

<P>Chapter 8 Common Electrical Specifications </P>

<P> </P>

<P>8.1 Introduction......................................................................................................... 213 </P>

<P>8.2 References........................................................................................................... 214 </P>

<P>8.3 Abbreviations ...................................................................................................... 215 </P>

<P>8.4 Definitions .......................................................................................................... 217 </P>

<P> </P>

<P>RapidIO Trade Association 9 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>8.4.1 Definition of Amplitude and Swing................................................................ 220 </P>

<P>8.4.2 Transmitter (Near-End) Template .................................................................. 221 </P>

<P>8.4.3 Receiver (Far-End) Template ......................................................................... 224 </P>

<P>8.4.3.1 Level I Receiver Template.......................................................................... 224 </P>

<P>8.4.3.2 Level II Receiver Template ........................................................................ 226 </P>

<P>8.4.4 Definition of Skew and Relative Wander ....................................................... 227 </P>

<P>8.4.5 Total Wander Mask ........................................................................................ 228 </P>

<P>8.4.6 Relative Wander Mask.................................................................................... 229 </P>

<P>8.4.7 Random Jitter Mask ........................................................................................ 229 </P>

<P>8.4.8 Defined Test Patterns...................................................................................... 229 </P>

<P>8.4.9 Reference Model............................................................................................. 230 </P>

<P>8.5 Common Electrical Specification ....................................................................... 230 </P>

<P>8.5.1 Introduction..................................................................................................... 230 </P>

<P>8.5.2 Data Patterns ................................................................................................... 231 </P>

<P>8.5.3 Signal Levels................................................................................................... 231 </P>

<P>8.5.4 Bit Error Ratio ................................................................................................ 232 </P>

<P>8.5.4.1 Level I Bit Error Ratio ................................................................................ 232 </P>

<P>8.5.4.2 Level II Bit Error Ratio............................................................................... 232 </P>

<P>8.5.5 Ground Differences......................................................................................... 232 </P>

<P>8.5.6 Cross Talk ....................................................................................................... 232 </P>

<P>8.5.7 Transmitter Test Load..................................................................................... 233 </P>

<P>8.5.8 Transmitter Lane-to-Lane Skew ..................................................................... 233 </P>

<P>8.5.9 Receiver Input Lane-to-Lane Skew ................................................................ 233 </P>

<P>8.5.10 Transmitter Short Circuit Current................................................................... 233 </P>

<P>8.5.11 Differential Resistance and Return Loss, Transmitter and Receiver.............. 234 </P>

<P>8.5.12 Baud Rate Tolerance....................................................................................... 234 </P>

<P>8.5.13 Termination and DC Blocking........................................................................ 235 </P>

<P>8.6 Pulse Response Channel Modelling ................................................................... 235 </P>

<P>8.6.1 Generating a Pulse Response .......................................................................... 235 </P>

<P>8.6.2 Basic Pulse Response Definitions................................................................... 236 </P>

<P>8.6.3 Transmitter Pulse Definition........................................................................... 237 </P>

<P>8.6.4 Receiver Pulse Response ................................................................................ 238 </P>

<P>8.6.5 Crosstalk Pulse Response ............................................................................... 239 </P>

<P>8.6.6 Decision Feedback Equalizer.......................................................................... 239 </P>

<P>8.6.7 Time Continuous Transverse Filter ................................................................ 240 </P>

<P>8.6.7.1 Time Continuous Zero-Pole Equalizer Adaption ....................................... 240 </P>

<P>8.6.8 Time Continuous Zero/Pole............................................................................ 241 </P>

<P>8.6.9 Degrees of Freedom........................................................................................ 241 </P>

<P>8.6.9.1 Receiver Sample Point................................................................................ 241 </P>

<P>8.6.9.2 Transmit Emphasis ..................................................................................... 241 </P>

<P>8.7 Jitter Modelling ................................................................................................... 241 </P>

<P>8.7.1 High Frequency Jitter vs. Wander .................................................................. 241 </P>

<P>8.7.2 Total Wander vs. Relative Wander................................................................. 242 </P>

<P>8.7.3 Correlated vs. Uncorrelated Jitter ................................................................... 242 </P>

<P>8.7.4 Jitter Distributions .......................................................................................... 243 </P>

<P>8.7.4.1 Unbounded and Bounded Gaussian Distribution ....................................... 243 </P>

<P> </P>

<P>10 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>8.7.4.2 Bounded Gaussian Distribution .................................................................. 243 </P>

<P>8.7.4.3 High Probability Jitter................................................................................. 244 </P>

<P>8.7.4.4 Total Jitter ................................................................................................... 244 </P>

<P>8.7.4.5 Probability Distribution Function vs. Cumulative Distribution Function .. 244 </P>

<P>8.7.4.6 BathTub Curves .......................................................................................... 245 </P>

<P>8.7.4.7 Specification of GJ and HPJ ....................................................................... 247 </P>

<P>8.7.4.8 Example of Bounded Gaussian................................................................... 248 </P>

<P>8.7.5 Statistical Eye Methodology ........................................................................... 248 </P>

<P>8.7.5.1 Derivation of Cursors and Calculation of PDF........................................... 248 </P>

<P>8.7.5.2 Inclusion of Sampling Jitter........................................................................ 251 </P>

<P>8.7.5.3 Generation of Statistical Eye ...................................................................... 252 </P>

<P> </P>

<P> </P>

<P>Chapter 9 1.25Gbaud, 2.5Gbaud, and 3.125Gbaud LP-Serial Links </P>

<P> </P>

<P>9.1 Level I Application Goals ................................................................................... 255 </P>

<P>9.2 Equalization ........................................................................................................ 256 </P>

<P>9.3 Explanatory Note on Level I Transmitter and Receiver Specifications ............. 256 </P>

<P>9.4 Level I Electrical Specification........................................................................... 257 </P>

<P>9.4.1 Level I Short Run Transmitter Characteristics ............................................... 257 </P>

<P>9.4.1.1 Level I SR Transmitter Test Load .............................................................. 258 </P>

<P>9.4.1.2 Level I SR Transmitter Baud Rate.............................................................. 258 </P>

<P>9.4.1.3 Level I SR Transmitter Amplitude and Swing ........................................... 258 </P>

<P>9.4.1.4 Level I SR Transmitter Rise and Fall Times .............................................. 258 </P>

<P>9.4.1.5 Level I SR Transmitter Differential Pair Skew .......................................... 258 </P>

<P>9.4.1.6 Level I SR Transmitter Output Resistance and Return Loss ...................... 259 </P>

<P>9.4.1.7 Level I SR Transmitter Lane-to-Lane Skew............................................... 259 </P>

<P>9.4.1.8 Level I SR Transmitter Short Circuit Current ............................................ 259 </P>

<P>9.4.1.9 Level I SR Transmitter Template and Jitter ............................................... 259 </P>

<P>9.4.2 Level I Long Run Transmitter Characteristics ............................................... 260 </P>

<P>9.4.2.1 Level I LR Transmitter Test Load .............................................................. 261 </P>

<P>9.4.2.2 Level I LR Transmitter Baud Rate ............................................................. 261 </P>

<P>9.4.2.3 Level I LR Transmitter Amplitude and Swing ........................................... 261 </P>

<P>9.4.2.4 Level I LR Transmitter Rise and Fall Times .............................................. 261 </P>

<P>9.4.2.5 Level I LR Transmitter Differential Pair Skew .......................................... 261 </P>

<P>9.4.2.6 Level I LR Transmitter Output Resistance and Return Loss...................... 262 </P>

<P>9.4.2.7 Level I LR Transmitter Lane-to-Lane Skew .............................................. 262 </P>

<P>9.4.2.8 Level I LR Transmitter Short Circuit Current ............................................ 262 </P>

<P>9.4.2.9 Level I LR Transmitter Template and Jitter ............................................... 262 </P>

<P>9.4.3 Level I Receiver Specifications ...................................................................... 263 </P>

<P>9.4.3.1 Level I Receiver Input Baud Rate .............................................................. 264 </P>

<P>9.4.3.2 Level I Receiver Reference Input Signals .................................................. 264 </P>

<P>9.4.3.3 Level I Receiver Input Signal Amplitude ................................................... 264 </P>

<P>9.4.3.4 Level I Receiver Absolute Input Voltage ................................................... 265 </P>

<P>9.4.3.5 Level I Receiver Input Common Mode Impedance ................................... 265 </P>

<P>9.4.3.6 Level I Receiver Input Lane-to-Lane Skew................................................ 265 </P>

<P>9.4.3.7 Level I Receiver Input Resistance and Return Loss ................................... 265 </P>

<P> </P>

<P>RapidIO Trade Association 11 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>9.4.3.8 Level I Receiver Input Jitter Tolerance ...................................................... 265 </P>

<P>9.5 Level I Measurement and Test Requirements .................................................... 267 </P>

<P>9.5.1 Level I Transmitter Measurements ................................................................. 267 </P>

<P>9.5.1.1 Level I Eye Template Measurements ......................................................... 267 </P>

<P>9.5.1.2 Level I Jitter Test Measurements................................................................ 267 </P>

<P>9.5.1.3 Level I Transmit Jitter Load ....................................................................... 268 </P>

<P>9.5.2 Level I Receiver Jitter Tolerance.................................................................... 268 </P>

<P> </P>

<P> </P>

<P>Chapter 10 5Gbaud and 6.25Gbaud LP-Serial Links </P>

<P> </P>

<P>10.1 Level II Application Goals ................................................................................. 269 </P>

<P>10.1.1 Common to Level II Short run, Medium run and Long run ........................... 269 </P>

<P>10.1.2 Application Goals for Level II Short Run ...................................................... 270 </P>

<P>10.1.3 Application Goals for Level II Medium Run.................................................. 270 </P>

<P>10.1.4 Application Goals for Long Run .................................................................... 270 </P>

<P>10.1.5 Explanatory Note on Transmitter and Receiver Specifications...................... 271 </P>

<P>10.2 Equalization ........................................................................................................ 271 </P>

<P>10.3 Link Compliance Methodology .......................................................................... 272 </P>

<P>10.3.1 Overview......................................................................................................... 272 </P>

<P>10.3.2 Reference Models ........................................................................................... 272 </P>

<P>10.3.3 Channel Compliance....................................................................................... 273 </P>

<P>10.3.4 Transmitter Compliance ................................................................................. 274 </P>

<P>10.3.5 Receiver Compliance ...................................................................................... 274 </P>

<P>10.4 Level II Short Run Interface - General Requirements ........................................ 275 </P>

<P>10.4.1 Jitter and Inter-operability Methodology ........................................................ 275 </P>

<P>10.4.1.1 Level II SR Defined Test Patterns .............................................................. 276 </P>

<P>10.4.1.2 Level II SR Channel Compliance ............................................................... 276 </P>

<P>10.4.1.3 Level II SR Transmitter Inter-operability ................................................... 277 </P>

<P>10.4.1.4 Level II SR Receiver Inter-operability ....................................................... 277 </P>

<P>10.4.2 Level II SR Electrical Characteristics............................................................. 278 </P>

<P>10.4.2.1 Level II SR Transmitter Characteristics ..................................................... 278 </P>

<P>10.4.2.1.1 Level II SR Transmitter Test Load ......................................................... 279 </P>

<P>10.4.2.1.2 Level II SR Transmitter Baud Rate ........................................................ 279 </P>

<P>10.4.2.1.3 Level II SR Transmitter Amplitude and Swing ...................................... 280 </P>

<P>10.4.2.1.4 Level II SR Transmitter Rise and Fall Times ......................................... 280 </P>

<P>10.4.2.1.5 Level II SR Transmitter Differential Pair Skew ..................................... 280 </P>

<P>10.4.2.1.6 Level II SR Transmitter Output Resistance and Return Loss ................ 280 </P>

<P>10.4.2.1.7 Level II SR Transmitter Lane-to-Lane Skew ......................................... 280 </P>

<P>10.4.2.1.8 Level II SR Transmitter Template and Jitter .......................................... 280 </P>

<P>10.4.2.2 Level II SR Receiver Characteristics.......................................................... 281 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.4.2.2.7 Level II SR Receiver Input Resistance and Return Loss........................ 284 </P>

<P>10.4.2.2.8 Level II SR Receiver Input Jitter Tolerance ........................................... 284 </P>

<P>10.4.2.3 Level II SR Link and Jitter Budgets ........................................................... 284 </P>

<P>10.4.3 Level II SR StatEye.org Template .................................................................. 286 </P>

<P>10.5 Level II Long Run Interface General Requirements .......................................... 288 </P>

<P>10.5.1 Long Run Jitter and Inter-operability Methodology....................................... 288 </P>

<P>10.5.1.1 Level II LR Channel Compliance ............................................................... 288 </P>

<P>10.5.1.2 Level II LR Transmitter Inter-operability................................................... 290 </P>

<P>10.5.1.3 Level II LR Receiver Inter-operability ....................................................... 290 </P>

<P>10.5.2 Level II LR Interface Electrical Characteristics ............................................. 291 </P>

<P>10.5.2.1 Level II LR Transmitter Characteristics ..................................................... 291 </P>

<P>10.5.2.1.1 Level II LR Transmitter Test Load......................................................... 293 </P>

<P>10.5.2.1.2 Level II LR Transmitter Baud Rate ........................................................ 293 </P>

<P>10.5.2.1.3 Level II LR Transmitter Amplitude and Swing...................................... 293 </P>

<P>10.5.2.1.4 Level II LR Transmitter Rise and Fall Times......................................... 293 </P>

<P>10.5.2.1.5 Level II LR Transmitter Differential Pair Skew..................................... 293 </P>

<P>10.5.2.1.6 Level II LR Transmitter Output Resistance and Return Loss ................ 293 </P>

<P>10.5.2.1.7 Level II LR Transmitter Lane-to-Lane Skew ......................................... 294 </P>

<P>10.5.2.1.8 Level II LR Transmitter Short Circuit Current....................................... 294 </P>

<P>10.5.2.1.9 Level II LR Transmitter Template and Jitter .......................................... 294 </P>

<P>10.5.2.2 Level II LR Receiver Characteristics ......................................................... 294 </P>

<P>10.5.2.2.1 Level II LR Receiver Input Baud Rate ................................................... 295 </P>

<P>10.5.2.2.2 Level II LR Receiver Reference Input Signals....................................... 295 </P>

<P>10.5.2.2.3 Level II LR Receiver Input Signal Amplitude ....................................... 295 </P>

<P>10.5.2.2.4 Level II LR Receiver Absolute Input Voltage........................................ 296 </P>

<P>10.5.2.2.5 Level II LR Receiver Input Common Mode Impedance ........................ 296 </P>

<P>10.5.2.2.6 Level II LR Receiver Input Lane-to-Lane Skew .................................... 296 </P>

<P>10.5.2.2.7 Level II LR Receiver Input Resistance and Return Loss ....................... 296 </P>

<P>10.5.2.2.8 Level II LR Receiver Jitter Tolerance .................................................... 297 </P>

<P>10.5.3 Level II LR Link and Jitter Budgets ............................................................... 297 </P>

<P>10.5.4 Level II LR StatEye.org Template.................................................................. 298 </P>

<P>10.6 Level II Medium Run Interface General Requirements ..................................... 300 </P>

<P>10.6.1 Medium Run Jitter and Inter-operability Methodology.................................. 300 </P>

<P>10.6.1.1 Level II Medium Run Channel Compliance............................................... 300 </P>

<P>10.6.1.2 Level II MR Transmitter Inter-operability ................................................. 301 </P>

<P>10.6.1.3 Medium Receiver Inter-operability ............................................................ 302 </P>

<P>10.6.2 Level II MR Interface Electrical Characteristics ............................................ 302 </P>

<P>10.6.2.1 Level II MR Transmitter Characteristics .................................................... 302 </P>

<P>10.6.2.1.1 Level II MR Transmitter Test Load ....................................................... 304 </P>

<P>10.6.2.1.2 Level II MR Transmitter Baud Rate ....................................................... 304 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>10.6.2.1.9 Level II MR Transmitter Template and Jitter......................................... 305 </P>

<P>10.6.2.2 Level II MR Receiver Characteristics ........................................................ 305 </P>

<P>10.6.2.2.1 Level II MR Receiver Input Baud Rate .................................................. 306 </P>

<P>10.6.2.2.2 Level II MR Receiver Reference Input Signals...................................... 306 </P>

<P>10.6.2.2.3 Level II MR Receiver Input Signal Amplitude ...................................... 306 </P>

<P>10.6.2.2.4 Level II MR Receiver Absolute Input Voltage ...................................... 307 </P>

<P>10.6.2.2.5 Level II MR Receiver Input Common Mode Impedance ....................... 307 </P>

<P>10.6.2.2.6 Level II MR Receiver Input Lane-to-Lane Skew ................................... 307 </P>

<P>10.6.2.2.7 Level II MR Receiver Input Resistance and Return Loss ...................... 307 </P>

<P>10.6.2.2.8 Level II MR Receiver Jitter Tolerance ................................................... 308 </P>

<P>10.6.3 Level II MR Link and Jitter Budgets .............................................................. 308 </P>

<P>10.6.4 Level II MR StatEye.org Template................................................................. 309 </P>

<P>10.7 Level II Measurement and Test Requirements ................................................... 311 </P>

<P>10.7.1 High Frequency Transmit Jitter Measurement ............................................... 311 </P>

<P>10.7.1.1 BERT Implementation................................................................................ 311 </P>

<P>10.7.1.2 Spectrum Analyzer and Oscilloscope Methodology .................................. 313 </P>

<P>10.7.1.2.1 Band Limited Unbounded Gaussian Noise ............................................ 313 </P>

<P>10.7.1.2.2 Band Limited 60 Second Total Jitter Measurements.............................. 313 </P>

<P>10.7.1.2.3 Uncorrelated High Probability Jitter....................................................... 315 </P>

<P>10.7.1.2.4 Total High Probability Jitter ................................................................... 315 </P>

<P>10.7.2 Total Transmit Wander Measurement ............................................................ 316 </P>

<P>10.7.3 Relative Transmit Wander Measurement ....................................................... 317 </P>

<P>10.7.4 Jitter Tolerance ............................................................................................... 318 </P>

<P>10.7.4.1 Jitter Tolerance with Relative Wander Lab Setup ...................................... 318 </P>

<P>10.7.4.1.1 General.................................................................................................... 318 </P>

<P>10.7.4.1.2 Synchronization ...................................................................................... 319 </P>

<P>10.7.4.1.3 Jitter ........................................................................................................ 319 </P>

<P>10.7.4.1.4 Amplitude ............................................................................................... 320 </P>

<P>10.7.4.2 Jitter Tolerance with no Relative Wander Lab Setup ................................. 320 </P>

<P>10.7.4.3 Jitter Tolerance with Defined ISI and no Relative Wander........................ 321 </P>

<P>10.7.4.4 Jitter Transfer .............................................................................................. 321 </P>

<P>10.7.4.5 Network Analysis Measurement................................................................. 322 </P>

<P>10.7.4.6 Eye Mask Measurement Setup ................................................................... 324 </P>

<P> </P>

<P> </P>

<P>Annex A Transmission Line Theory and Channel Information (Informative) </P>

<P> </P>

<P>A.1 Transmission Lines Theory ................................................................................ 327 </P>

<P>A.2 Impedance Matching........................................................................................... 327 </P>

<P>A.3 Impedance Definition Details ............................................................................. 328 </P>

<P>A.4 Density considerations ........................................................................................ 330 </P>

<P>A.5 Common-Mode Impedance and Return Loss ..................................................... 331 </P>

<P>A.6 Crosstalk Considerations .................................................................................... 332 </P>

<P>A.7 Equation Based Channel Loss by Curve Fit ....................................................... 333 </P>

<P> </P>

<P> </P>

<P>Annex B BER Adjustment Methodology (Informative) </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>B.1 Extrapolation of Correlated Bounded Gaussian Jitter to low BERs ................... 335 </P>

<P>B.1.1 Bathtub Measurements ................................................................................... 335 </P>

<P>B.2 Confidence Level of Errors Measurement .......................................................... 335 </P>

<P>B.3 Eye Mask Adjustment for Sampling Oscilloscopes ........................................... 336 </P>

<P>B.3.1 Theory ............................................................................................................. 337 </P>

<P>B.3.2 Usage .............................................................................................................. 339 </P>

<P> </P>

<P> </P>

<P>Annex C Interface Management (Informative) </P>

<P> </P>

<P>C.1 Introduction......................................................................................................... 341 </P>

<P>C.2 Packet Retry Mechanism .................................................................................... 341 </P>

<P>C.2.1 Input port retry recovery state machine .......................................................... 341 </P>

<P>C.2.2 Output port retry recovery state machine ....................................................... 343 </P>

<P>C.3 Error Recovery.................................................................................................... 345 </P>

<P>C.3.1 Input port error recovery state machine .......................................................... 345 </P>

<P>C.3.2 Output port error recovery state machine ....................................................... 346 </P>

<P>C.3.3 Changes in Error Recovery Behavior for CT ................................................. 349 </P>

<P>Annex D Critical Resource Performance Limits (Informative) Annex E Manufacturability and Testability (Informative) Annex F Multiple Port Configuration Example (Informative) </P>

<P> </P>

<P>F.1 Introduction......................................................................................................... 357 </P>

<P>F.2 System with Different Port Width Capabilities .................................................. 357 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>2-1 Packet Format .................................................................................................................31 </P>

<P>2-2 Packet Alignment............................................................................................................31 </P>

<P>2-3 Error Coverage of First 16 Bits of Packet Header ..........................................................32 </P>

<P>2-4 Unpadded Packet of Length 80 Bytes or Less ................................................................33 </P>

<P>2-5 Padded Packet of Length 80 Bytes or Less.....................................................................33 </P>

<P>2-6 Unpadded Packet of Length Greater than 80 Bytes........................................................33 </P>

<P>2-7 Padded Packet of Length Greater than 80 Bytes ............................................................34 </P>

<P>2-8 CRC Generation Pipeline................................................................................................35 </P>

<P>3-1 Short Control Symbol Format.........................................................................................39 </P>

<P>3-2 Long Control Symbol Format .........................................................................................39 </P>

<P>3-3 Packet-Accepted Control Symbol Formats.....................................................................42 </P>

<P>3-4 Packet-Retry Control Symbol Formats ...........................................................................42 </P>

<P>3-5 Packet-Not-Accepted Control Symbol Formats .............................................................43 </P>

<P>3-6 Status Control Symbol Formats ......................................................................................44 </P>

<P>3-7 VC_Status Control Symbol Formats ..............................................................................45 </P>

<P>3-8 Link-Response Control Symbol Formats .......................................................................45 </P>

<P>3-9 Start-of-Packet Control Symbol Formats .......................................................................48 </P>

<P>3-10 Stomp Control Symbol Formats .....................................................................................48 </P>

<P>3-11 End-of-Packet Control Symbol Formats.........................................................................49 </P>

<P>3-12 Restart-From-Retry Control Symbol Formats ................................................................49 </P>

<P>3-13 Link-Request Control Symbol Formats ..........................................................................49 </P>

<P>3-14 Multicast-Event Control Symbol Formats ......................................................................51 </P>

<P>3-15 CRC-5 Implementation ...................................................................................................53 </P>

<P>4-1 Character Notation Example (D25.3) .............................................................................58 </P>

<P>4-2 Code-Group Notation Example (/D25.3/) ......................................................................59 </P>

<P>4-3 Lane Encoding, Serialization, Deserialization, and Decoding Process ..........................61 </P>

<P>4-4 Example of a Pseudo-Random Idle Code-Group Generator ..........................................76 </P>

<P>4-5 Idle Sequence 2 Idle Frame ............................................................................................78 </P>

<P>4-6 5-tap Transversal Filter ...................................................................................................84 </P>

<P>4-7 Example of CS Field CMD, ACK, NACK Handshake ..................................................86 </P>

<P>4-8 Scrambling Sequence Generator.....................................................................................88 </P>

<P>4-9 1x Mode Short Control Symbol Encoding and Transmission Order ..............................92 </P>

<P>4-10 1x Mode Packet Encoding and Transmission Order ......................................................92 </P>

<P>4-11 1x Typical Data Flow with Short Control Symbol .........................................................93 </P>

<P>4-12 Typical 4x Data Flow with Short Control symbol..........................................................96 </P>

<P>4-13 Baudrate_Discovery state machine (Informational) .....................................................100 </P>

<P>4-14 Lane_Synchronization State Machine ..........................................................................109 </P>

<P>4-15 Lane_Alignment State Machine ...................................................................................111 </P>

<P>4-16 1x/2x_Mode_Detect State Machine..............................................................................113 </P>

<P>4-17 1x_Initialization State Machine ....................................................................................114 </P>

<P>4-18 1x/Nx_Initialization State Machine for N = 4, 8, 16 ....................................................118 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>4-19 Alternate 1x/4x_Initialization State Machine ...............................................................120 </P>

<P>4-20 1x/2x_Initialization State Machine ...............................................................................122 </P>

<P>4-21 1x/2x/Nx_Initialization State Machine .........................................................................125 </P>

<P>4-22 1x/Mx/Nx_Initialization State Machine for N &gt; M &gt; 2 ................................................128 </P>

<P>5-1 Example Transaction with Acknowledgment ...............................................................132 </P>

<P>5-2 Single VC Mode Receiver-Controlled Flow Control ...................................................147 </P>

<P>5-3 Single VC Mode Transmitter-Controlled Flow Control ...............................................149 </P>

<P>7-1 RapidIO 1x Device to 1x Device Interface Diagram....................................................212 </P>

<P>7-2 RapidIO Nx Device to Nx Device Interface Diagram ..................................................212 </P>

<P>7-3 RapidIO Nx Device to 1x Device Interface Diagram ...................................................212 </P>

<P>8-1 Definition of Transmitter Amplitude and Swing ..........................................................220 </P>

<P>8-2 Transition Symbol Transmit Eye Mask ........................................................................222 </P>

<P>8-3 Transition and Steady State Symbol Eye Mask ............................................................223 </P>

<P>8-4 Level I Receiver Input Mask ........................................................................................225 </P>

<P>8-5 Receiver Input Mask .....................................................................................................226 </P>

<P>8-6 Skew and Relative Wander Between in Band Signals .................................................227 </P>

<P>8-7 Total Wander of a Signal ..............................................................................................228 </P>

<P>8-8 Total Wander Mask ......................................................................................................228 </P>

<P>8-9 Relative Wander Mask..................................................................................................229 </P>

<P>8-10 Random Jitter Spectrum................................................................................................229 </P>

<P>8-11 Reference Model ...........................................................................................................230 </P>

<P>8-12 Transmitter and Input Differential Return Loss ...........................................................234 </P>

<P>8-13 Termination Example ...................................................................................................235 </P>

<P>8-14 Graphical Representation of Receiver Pulse ................................................................236 </P>

<P>8-15 Transmit Pulse ..............................................................................................................237 </P>

<P>8-16 Transmitter FIR Filter Function....................................................................................238 </P>

<P>8-17 Receiver Pulse Definition .............................................................................................239 </P>

<P>8-18 Crosstalk Pulse Definition ............................................................................................239 </P>

<P>8-19 Decision Feedback Equalizer........................................................................................240 </P>

<P>8-20 Feed Forward Filter ......................................................................................................240 </P>

<P>8-21 Generation of Total and Relative Wander ....................................................................242 </P>

<P>8-22 Jitter Probability Density Functions .............................................................................243 </P>

<P>8-23 Example of Total Jitter PDF .........................................................................................245 </P>

<P>8-24 Example of Total Jitter CDF.........................................................................................245 </P>

<P>8-25 Bathtub Definition ........................................................................................................247 </P>

<P>8-26 Example of Bounded Gaussian .....................................................................................248 </P>

<P>8-27 Statistics of Pulse Response Cursor ..............................................................................249 </P>

<P>8-28 Variation of the c0 Sampling Time...............................................................................250 </P>

<P>8-29 Varying the Receiver Sampling Point ..........................................................................251 </P>

<P>8-30 Generation of the Data Eye and Bathtub ......................................................................253 </P>

<P>8-31 Statistical Eye ...............................................................................................................254 </P>

<P>9-1 Single Frequency Sinusoidal Jitter Limits ....................................................................266 </P>

<P>10-1 OIF Reference Model ...................................................................................................273 </P>

<P>10-2 Transmitter Compliance Setup .....................................................................................274 </P>

<P>10-3 Receiver Compliance Setup ..........................................................................................275 </P>

<P>10-4 BERT with Golden PLL ...............................................................................................311 </P>

<P> </P>

<P>18 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10-5 Spectral Measurement Setup ........................................................................................313 </P>

<P>10-6 Single Side Band Relative Power Spectrum for Phase Modulated Signal ...................314 </P>

<P>10-7 Single Side Band Relative Power Spectrum for Phase Modulated Signal ...................315 </P>

<P>10-8 Transmit Wander Lab Setup .........................................................................................316 </P>

<P>10-9 Relative Wander Lab Setup ..........................................................................................317 </P>

<P>10-10 Jitter Tolerance with Relative Wander Lab Setup ........................................................318 </P>

<P>10-11 Jitter Tolerance with no Relative Wander ....................................................................320 </P>

<P>10-12 Jitter Tolerance with Defined ISI..................................................................................321 </P>

<P>10-13 Jitter Transfer Lab Setup...............................................................................................322 </P>

<P>10-14 S-parameter Port Definitions ........................................................................................323 </P>

<P>10-15 Mask Measurement with Golden PLL ..........................................................................325 </P>

<P>A-1 Transmission Line as 2-port .........................................................................................329 </P>

<P>A-2 Network Terminations ..................................................................................................329 </P>

<P>A-3 Measurement of Zodd, Zeven .......................................................................................330 </P>

<P>A-4 Minimization of Crosstalk at IC Pins ...........................................................................332 </P>

<P>A-5 Minimization of Crosstalk At Connector Pins..............................................................333 </P>

<P>A-6 Minimization of Crosstalk Over Backplane .................................................................333 </P>

<P>A-7 Equations Based Channel Loss Curves ........................................................................334 </P>

<P>B-1 Example Data Mask ......................................................................................................337 </P>

<P>B-2 Example Data Mask ......................................................................................................338 </P>

<P>B-3 Cumulative Distribution Function of Maximum Amplitude ........................................339 </P>

<P>C-1 Input Port Retry Recovery State Machine ....................................................................342 </P>

<P>C-2 Output Port Retry Recovery State Machine .................................................................343 </P>

<P>C-3 Input Port Error Recovery State Machine.....................................................................345 </P>

<P>C-4 Output Port Error Recovery State Machine ..................................................................347 </P>

<P>F-1 Example system with asymmetric port-width capabilities ...........................................358 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>2-1 Packet Field Definitions..................................................................................................29 </P>

<P>2-2 Use of VC, PRIO and CRF Fields ..................................................................................30 </P>

<P>2-3 Parallel CRC-16 Equations .............................................................................................34 </P>

<P>2-4 Maximum Packet Size ....................................................................................................36 </P>

<P>3-1 Control Symbol Field Definitions...................................................................................39 </P>

<P>3-2 Stype0 Control Symbol Encoding ..................................................................................40 </P>

<P>3-3 Stype0 Parameter Definitions .........................................................................................41 </P>

<P>3-4 Cause Field Definition ....................................................................................................43 </P>

<P>3-5 VCID Definition .............................................................................................................45 </P>

<P>3-6 Port_status Field Definitions ..........................................................................................46 </P>

<P>3-7 Stype1 Control Symbol Encoding ..................................................................................46 </P>

<P>3-8 Cmd Field Definitions ....................................................................................................49 </P>

<P>3-9 Parallel CRC-5 Equations ...............................................................................................52 </P>

<P>3-10 Parallel CRC-13 Equations .............................................................................................53 </P>

<P>4-1 Data Character Encodings ..............................................................................................62 </P>

<P>4-2 Special Character Encodings ..........................................................................................69 </P>

<P>4-3 Special Characters and Columns ....................................................................................70 </P>

<P>4-4 Code-Group Corruption Caused by Single Bit Errors ....................................................72 </P>

<P>4-5 Active Port Width Field Encodings ................................................................................80 </P>

<P>4-6 Lane Number Field Encodings .......................................................................................80 </P>

<P>4-7 Command and Status Field Encodings ...........................................................................81 </P>

<P>4-8 CS Field 8/10 Bit Encodings ..........................................................................................82 </P>

<P>4-9 Scrambler Initialization Values ......................................................................................89 </P>

<P>4-10 Dcounter Definition ......................................................................................................102 </P>

<P>4-11 lane_sync &#8220;Flicker&#8221; Probability ....................................................................................107 </P>

<P>5-1 Additional VC Combinations .......................................................................................134 </P>

<P>5-2 VC0 Transaction Request Flow to Priority Mapping ...................................................140 </P>

<P>5-3 VC0 Transaction Request Flow to Priority and Critical Request Flow Mapping ........140 </P>

<P>5-4 Flow IDs for VCs..........................................................................................................141 </P>

<P>6-1 LP-Serial Register Map ................................................................................................168 </P>

<P>6-2 Configuration Space Reserved Access Behavior..........................................................168 </P>

<P>6-3 Bit Settings for Processing Element Features CAR......................................................170 </P>

<P>6-4 LP-Serial Register Map  - Generic End Point Devices.................................................172 </P>

<P>6-5 LP-Serial Register Map - Generic End Point Devices (SW assisted)...........................173 </P>

<P>6-6 LP-Serial Register Map  - Generic End Point Free Devices.........................................175 </P>

<P>6-7 LP-Serial Register Map - Generic End Point-free Devices (SW assisted) ...................177 </P>

<P>6-8 Bit Settings for LP-Serial Register Block Header ........................................................179 </P>

<P>6-9 Bit Settings for Port Link Timeout Control CSR .........................................................180 </P>

<P>6-10 Bit Settings for Port Response Timeout Control CSR..................................................181 </P>

<P>6-11 Bit Settings for Port General Control CSR, Generic End Point Devices .....................182 </P>

<P>6-12 Bit Settings for General Port Control CSR, Generic End Point Free Device ...............182 </P>

<P>6-13 Bit Settings for Port n Link Maintenance Request CSRs .............................................183 </P>

<P> </P>

<P>RapidIO Trade Association 21 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>6-14 Bit Settings for Port n Link Maintenance Response CSRs...........................................184 </P>

<P>6-15 Bit Settings for Port n Local ackID Status CSRs..........................................................185 </P>

<P>6-16 Bit Settings for Port n Error and Status CSRs ..............................................................186 </P>

<P>6-17 Bit Settings for Port n Control CSRs ............................................................................188 </P>

<P>6-18 Bit Settings for Port n Control 2 CSRs .........................................................................191 </P>

<P>6-19 LP-Serial Lane Register Map .......................................................................................195 </P>

<P>6-20 Bit Settings for LP-Serial Register Block Header ........................................................197 </P>

<P>6-21 Bit Settings for Lane n Status 0 CSRs ..........................................................................198 </P>

<P>6-22 Bit Settings for Lane n Status 1 CSRs ..........................................................................200 </P>

<P>6-23 Virtual Channel Registers .............................................................................................203 </P>

<P>6-24 Bit Settings for VC Register Block Header ..................................................................205 </P>

<P>6-25 Port n VC Control and Status Registers........................................................................206 </P>

<P>6-26 Port n VC0 BW Allocation CSR ..................................................................................208 </P>

<P>6-27 BW Allocation Register Bit Values ..............................................................................209 </P>

<P>6-28 Port n VCx BW Allocation CSR ..................................................................................210 </P>

<P>7-1 LP-Serial Signal Description ........................................................................................211 </P>

<P>8-1 Abbreviations ................................................................................................................215 </P>

<P>8-2 General Definitions .......................................................................................................217 </P>

<P>8-3 Jitter and Wander Definitions .......................................................................................218 </P>

<P>8-4 Transmitter Output Jitter Specification.........................................................................223 </P>

<P>8-5 Transmitter Eye Mask Cross Reference .......................................................................224 </P>

<P>8-6 Level I Receiver Jitter Specification.............................................................................225 </P>

<P>8-7 Receiver Eye Mask Cross Reference ............................................................................226 </P>

<P>8-8 Level II Receiver Jitter Specification ...........................................................................227 </P>

<P>8-9 Definition of Load Types..............................................................................................232 </P>

<P>9-1 Level I SR Transmitter AC Timing Specifications ......................................................257 </P>

<P>9-2 Level I SR Transmitter Output Jitter Specifications.....................................................258 </P>

<P>9-3 Level I SR Transmitter Return Loss Parameters ..........................................................259 </P>

<P>9-4 Level I SR Near-End (Tx) Template Intervals .............................................................259 </P>

<P>9-5 Level I LR Transmitter AC Timing Specifications ......................................................260 </P>

<P>9-6 Level I LR Transmitter Output Jitter Specifications ....................................................261 </P>

<P>9-7 Level I LR Transmitter Return Loss Parameters ..........................................................262 </P>

<P>9-8 Level I LR Near-End (Tx) Template Intervals .............................................................262 </P>

<P>9-9 Level I Receiver Electrical Input Specifications ..........................................................263 </P>

<P>9-10 Level I Receiver Input Jitter Tolerance Specifications.................................................264 </P>

<P>9-11 Level I Input Return Loss Parameters ..........................................................................265 </P>

<P>9-12 Level I Single Frequency Sinusoidal Jitter Limits Knee Frequencies ..........................266 </P>

<P>9-13 Level I Far-End (Rx) Template Intervals .....................................................................267 </P>

<P>10-1 Reference Models .........................................................................................................273 </P>

<P>10-2 Level II SR Transmitter Output Electrical Specifications ............................................278 </P>

<P>10-3 Level II SR Transmitter Output Jitter Specifications ...................................................279 </P>

<P>10-4 Level II SR Transmitter Return Loss Parameters .........................................................280 </P>

<P>10-5 Level II SR Near-End (Tx) Template Intervals ............................................................281 </P>

<P>10-6 Level II SR Receiver Electrical Input Specifications ...................................................281 </P>

<P>10-7 Level II SR Receiver Input Jitter Tolerance Specifications .........................................282 </P>

<P>10-8 Level II SR Input Return Loss Parameters ...................................................................284 </P>

<P> </P>

<P>22 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10-9 Level II SR Far-End (Rx) Template Intervals ..............................................................284 </P>

<P>10-10 Level II SR Informative Loss, Skew and Jitter Budget ................................................285 </P>

<P>10-11 Level II SR High Frequency Jitter Budget ...................................................................285 </P>

<P>10-12 Level II LR Receiver Equalization Output Eye Mask ..................................................289 </P>

<P>10-13 Level II LR Transmitter Output Electrical Specifications ............................................292 </P>

<P>10-14 Level II LR Transmitter Output Jitter Specifications ...................................................292 </P>

<P>10-15 Level II LR Transmitter Return Loss Parameters.........................................................293 </P>

<P>10-16 Level II LR Near-End Template Intervals ....................................................................294 </P>

<P>10-17 Level II LR Receiver Electrical Input Specifications ...................................................295 </P>

<P>10-18 Level II LR Input Return Loss Parameters ...................................................................296 </P>

<P>10-19 Level II LR Informative Loss, Skew and Jitter Budget ................................................297 </P>

<P>10-20 Level II LR High Frequency Jitter Budget ...................................................................297 </P>

<P>10-21 Level II LR Receiver Equalization Output Eye Mask ..................................................301 </P>

<P>10-22 Level II MR Transmitter Output Electrical Specifications...........................................303 </P>

<P>10-23 Level II MR Transmitter Output Jitter Specifications ..................................................303 </P>

<P>10-24 Level II MR Transmitter Return Loss Parameters........................................................304 </P>

<P>10-25 Level II MR Near-End Template Intervals ...................................................................305 </P>

<P>10-26 Level II MR Receiver Electrical Input Specifications ..................................................306 </P>

<P>10-27 Level II MR Input Return Loss Parameters ..................................................................307 </P>

<P>10-28 Level II MR Informative Loss, Skew and Jitter Budget ...............................................308 </P>

<P>10-29 Level II MR High Frequency Jitter Budget ..................................................................308 </P>

<P>A-1 Curve fit Coefficients....................................................................................................334 </P>

<P>C-1 Input Port Retry Recovery State Machine Transition Table.........................................342 </P>

<P>C-2 Output Port Retry Recovery State Machine Transition Table ......................................344 </P>

<P>C-3 Input Port Error Recovery State Machine Transition Table .........................................346 </P>

<P>C-4 Output Port Error Recovery State Machine Transition Table ......................................347 </P>

<P>D-1 Packet Transmission Delay Components .....................................................................352 </P>

<P>D-2 Packet Acknowledgment Delay Components...............................................................353 </P>

<P>D-3 Packet Delays................................................................................................................353 </P>

<P>D-4 Maximum Transmission Distances...............................................................................354 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>The RapidIO Part 6: LP-Serial Physical Layer Specification addresses the physical layer requirements for devices utilizing an electrical serial connection medium. This specification defines a full duplex serial physical layer interface (link) between devices. The links are comprised of one or more lanes, each lane being a pair of unidirectional serial signaling paths with one path in each direction. Further, it allows ganging of up to sixteen serial lanes for applications requiring higher link performance. It also defines a protocol for link management and packet transport over a link. </P>

<P> </P>

<P>RapidIO systems are comprised of end point processing elements and switch processing elements. The RapidIO interconnect architecture is partitioned into a layered hierarchy of specifications which includes the Logical, Common Transport, and Physical layers. The Logical layer specifications define the operations and associated transactions by which end point processing elements communicate with each other. The Common Transport layer defines how transactions are routed from one end point processing element to another through switch processing elements. The Physical Layer defines how adjacent processing elements electrically connect to each other. RapidIO packets are formed through the combination of bit fields defined in the Logical, Common Transport, and Physical Layer specifications. </P>

<P> </P>

<P>The RapidIO LP-Serial specification defines a protocol for packet delivery between serial RapidIO devices including packet and control symbol transmission, flow control, error management, and other device to device functions. A particular device may not implement all of the mode selectable features found in this document. See the appropriate user&#8217;s manual or implementation specification for specific implementation details of a device. </P>

<P> </P>

<P>The LP-Serial physical layer specification has the following properties: </P>

<P> </P>

<P>&#8226; Embeds the transmission clock with data using an 8B/10B encoding scheme. </P>

<P>&#8226; Supports links with from one lane, up to sixteen ganged lanes where each lane is a pair of unidirectional serial paths with one path in each direction. </P>

<P>&#8226; Allows switching packets between RapidIO LP-Serial ports and RapidIO Part </P>

<P>4: 8/16 LP-LVDS Physical Layer Specification ports without requiring packet manipulation. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Employs similar retry and error recovery protocols as the RapidIO 8/16 </P>

<P>LP-LVDS physical layer specification. </P>

<P>&#8226; Supports transmission rates of 1.25, 2.5, 3.125, 5 and 6.25Gbaud (data rates of </P>

<P>1, 2, 2.5, 4 and 5 Gbps) per lane. </P>

<P>&#8226; Supports division of the physical layer bandwidth into up to 9 virtual channels with independent flow control. </P>

<P> </P>

<P>This specification first defines the individual elements that make up the link protocol such as packets, control symbols, and the serial bit encoding scheme. This is followed by a description of the link protocol. Finally, the control and status registers, signal descriptions, and electrical specifications are specified. </P>

<P> </P>

<P>The virtual channel features are optional. This specification defines a single virtual channel mode of operation that is fully compatible with previous RapidIO specifications. </P>

<P> </P>

<P> </P>

<P>1.2 Contents </P>

<P> </P>

<P>Following are the contents of  the RapidIO Part 6:  LP-Serial Physical Layer </P>

<P>Specification: </P>

<P> </P>

<P>&#8226; Chapter 1, &quot;Overview&quot;, (this chapter) provides an overview of the specification </P>

<P>&#8226; Chapter 2, &quot;Packets&quot;, defines how a RapidIO LP-Serial packet is formed by prefixing a 10-bit physical layer header to the combined RapidIO transport and logical layer bit fields followed by an appended 16-bit CRC field. </P>

<P>&#8226; Chapter 3, &quot;Control Symbols&quot;, defines the format of the two control symbols (short and long) used for packet acknowledgment, link utility functions, link maintenance, packet delineation, packet acknowledgement and to convey flow control information. They may be transmitted between packets and some may be embedded within a packet. </P>

<P>&#8226; Chapter 4, &quot;PCS and PMA Layers&quot;, describes the Physical Coding Sublayer (PCS) functionality as well as the Physical Media Attachment (PMA) functionality. The PCS layer functionality includes 8B/10B encoding scheme for embedding clock with data. It also gives transmission rules for the 1x-Nx interfaces and defines the link initialization sequence for clock synchronization. Among other things, the PMA (Physical Medium Attachment) function is responsible for serializing the 10-bit code-groups to and from the serial bitstream(s). </P>

<P>&#8226; Chapter 5, &quot;LP-Serial Protocol&quot;, describes in detail how packets, control symbols, and the PCS/PMA layers are used to implement the physical layer protocol. This includes topics such as link initialization, link maintenance, error detection and recovery, flow control, bandwidth division, and transaction delivery ordering. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; Chapter 6, &quot;LP-Serial Registers&quot;, describes the physical layer control and status register set. By accessing these registers a processing element may query the capabilities and status and configure another LP-Serial RapidIO processing element. </P>

<P>&#8226; Chapter 7, &quot;Signal Descriptions&quot;, contains the signal pin descriptions for a RapidIO LP-Serial port and shows connectivity between processing elements. </P>

<P>&#8226; Chapter 8, &quot;Common Electrical Specifications&quot;, Chapter 9, &quot;1.25Gbaud, </P>

<P>2.5Gbaud, and 3.125Gbaud LP-Serial Links&quot;, and Chapter 10, &quot;5Gbaud and </P>

<P>6.25Gbaud LP-Serial Links&quot;, describe the electrical specifications for a </P>

<P>RapidIO LP-Serial device. </P>

<P>&#8226; Annex A, &#8220;Transmission Line Theory and Channel Information (Informative)&quot;, contains a discussion to aid in applying the AC specifications to a system design. </P>

<P>&#8226; Annex B, &#8220;BER Adjustment Methodology (Informative)&quot;, provides recommendations for measuring link error rates. </P>

<P>&#8226; Annex C, &quot;Interface Management (Informative)&quot;, contains information pertinent to interface management in a RapidIO system, including error recovery, link initialization, and packet retry state machines. </P>

<P>&#8226; Annex D, &quot;Critical Resource Performance Limits (Informative)&quot;, contains a discussion on outstanding transactions and their relationship to transmission distance capability. </P>

<P>&#8226; Annex E, &#8220;Manufacturability and Testability (Informative)&quot;, recommends implementing to IEEE standard 1149.6 for improved manufacturing and manufacturing test. </P>

<P>&#8226; Annex F, &#8220;Multiple Port Configuration Example (Informative)&quot;, describes an example of a port configuration scenario. </P>

<P> </P>

<P> </P>

<P>1.3 Terminology </P>

<P> </P>

<P>Refer to the Glossary at the back of this document. </P>

<P> </P>

<P> </P>

<P>1.4 Conventions </P>

<P>|| Concatenation, used to indicate that two fields are physically associated as consecutive bits </P>

<P> </P>

<P>ACTIVE_HIGH Names of active high signals are shown in uppercase text with no overbar. Active-high signals are asserted when high and not asserted when low. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_835.jpg"/>
</Figure>

<P>ACTIVE_LOW Names of active low signals are shown in uppercase text with an overbar. Active low signals are asserted when low and not asserted when high. </P>

<P> </P>

<P>RapidIO Trade Association 27 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>italics Book titles in text are set in italics. </P>

<P> </P>

<P>REG[FIELD] Abbreviations or acronyms for registers are shown in uppercase text. Specific bits, fields, or ranges appear in brackets. </P>

<P>TRANSACTION Transaction types are expressed in all caps. operation Device operation types are expressed in plain text. n A decimal value. </P>

<P>[n-m] Used to express a numerical range from n to m. </P>

<P> </P>

<P>0bnn A binary value, the number of bits is determined by the number of digits. </P>

<P>0xnn A hexadecimal value, the number of bits is determined by the number of digits or from the surrounding context; for example, 0xnn may be a 5, 6, 7, or 8 bit value. </P>

<P>x This value is a don&#8217;t care </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Packets </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This chapter specifies the LP-Serial packet format and the fields that are added by LP-Serial physical layer. These packets are fed into the PCS function explained in Chapter 4, &quot;PCS and PMA Layers&quot;. </P>

<P> </P>

<P> </P>

<P>2.2 Packet Field Definitions </P>

<P> </P>

<P>This section specifies the bit fields added to a packet by the LP-Serial physical layer. These fields are required to implement the flow control, error management, and other specified system functions of the LP-Serial specification. The fields are specified in Table 2-1. </P>

<P> </P>

<P>Table 2-1. Packet Field Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>ackID </P>
</TD>

<TD>
<P>Acknowledge ID is the packet identifier for link level packet acknowledgment&#8212;see </P>

<P>Section 5.6.2, &quot;Acknowledgment Identifier&quot; for details concerning ackID functionality. </P>

<P>The length of the ackID value depends on the length of the control symbol being used on the link. When the short control symbol is being used, the ackID value shall be 5 bits long and shall be left justified in the ackID field (ackID[0-4]) with the right most bit of the field (ackID[5]) set to 0b0. When the long control symbol is being used, the ackID value shall be 6 bits long which fills the ackID field. </P>
</TD>
</TR>

<TR>
<TD>
<P>VC </P>
</TD>

<TD>
<P>The VC bit specifies the usage of the PRIO and CRF fields. When VC = 0, the PRIO and CRF fields contain the priority bits for a virtual channel 0 packet. When VC = 1 the PRIO and CRF fields contain the Virtual Channel ID for a VC 1-8 packet. See Table 2-2. </P>
</TD>
</TR>

<TR>
<TD>
<P>prio </P>
</TD>

<TD>
<P>Depending on the value of the VC field, PRIO specifies packet priority or contains the most significant bits of the Virtual Channel ID (VCID). See Table 2-2. See Section 5.6.3, &quot;Packet Priority and Transaction Request Flows&quot; for an explanation of prioritizing packets. See Section 5.4, &quot;Virtual Channels&quot; for an explanation of virtual channels. </P>
</TD>
</TR>

<TR>
<TD>
<P>CRF </P>
</TD>

<TD>
<P>Depending on the value of the VC field, CRF differentiates between virtual channel 0 flows of equal priority or contains the least significant bit of the Virtual Channel ID. If VC=0 and Critical Request Flow is not supported, this bit is reserved. See Table 2-2. See Section 5.6.3, &quot;Packet Priority and Transaction Request Flows&quot; for an explanation of prioritizing packets. See Section 5.4, &quot;Virtual Channels&quot; for an explanation of virtual channels. </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC </P>
</TD>

<TD>
<P>Cyclic Redundancy Code used to detect transmission errors in the packet. See Section 2.4.1 for details on the CRC error detection scheme. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 2-2 describes the use of the VC, prio, and CRF fields. </P>

<P> </P>

<P>Table 2-2.  Use of VC, PRIO and CRF Fields </P>

<P> </P>

<Table>
<TR>
<TD>
<P>VC </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>Single VC mode: </P>
</TD>
</TR>

<TR>
<TD>
<P>VC = 0 </P>
</TD>

<TD>
<P>when CRF is RSVD = 0, &#61472;&#61472;</P>

<P>PRIO sets packet priority as follows: </P>

<P>00 - lowest priority&#61472;&#61472;</P>

<P>01 - medium priority&#61472;&#61472;</P>

<P>10 - high priority&#61472;&#61472;</P>

<P>11 - highest priority </P>
</TD>
</TR>

<TR>
<TD>
<P>VC = 0 </P>
</TD>

<TD>
<P>when CRF is supported, &#61472;&#61472;</P>

<P>PRIO||CRF sets packet priority: </P>

<P>00 0 - lowest priority&#61472;&#61472;</P>

<P>00 1 - critical flow lowest priority&#61472;&#61472;</P>

<P>01 0 - medium priority&#61472;&#61472;</P>

<P>01 1 - critical flow medium priority&#61472;&#61472;</P>

<P>10 0 - high priority&#61472;&#61472;</P>

<P>10 1 - critical flow high priority&#61472;&#61472;</P>

<P>11 0 - highest priority&#61472;&#61472;</P>

<P>11 1 - critical flow high priority </P>
</TD>
</TR>

<TR>
<TD>
<P>Multiple VC Mode: </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>VC = 0 </P>

<P> </P>

<P>VC = 1 </P>
</TD>

<TD>
<P>VC||PRIO||CRF Channel </P>

<P>0 XX X - VC0 (PRIO, CRF = Priority, same as single VC mode) *&#61472;&#61472;</P>

<P>&#61472;&#61472;</P>

<P>1 00 0 - VC1 (PRIO, CRF = VCID)&#61472;&#61472;</P>

<P>1 00 1 - VC2&#61472;&#61472;</P>

<P>1 01 0 - VC3&#61472;&#61472;</P>

<P>1 01 1 - VC4&#61472;&#61472;</P>

<P>1 10 0 - VC5&#61472;&#61472;</P>

<P>1 10 1 - VC6&#61472;&#61472;</P>

<P>1 11 0 - VC7&#61472;&#61472;</P>

<P>1 11 1 - VC8 </P>

<P> </P>

<P>* Note: VC0 is the backwards-compatibility channel </P>
</TD>
</TR>

<TR>
<TD>
<P>When Fewer than 8 VCs are supported (in addition to VC0) </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>VC = 1 </P>
</TD>

<TD>
<P>VC||PRIO||CRF Channel </P>

<P>1 00 X - VC1 (VC0 + 4 VCs)&#61472;&#61472;</P>

<P>1 01 X - VC3&#61472;&#61472;</P>

<P>1 10 X - VC5&#61472;&#61472;</P>

<P>1 11 X - VC7&#61472;&#61472;</P>

<P> </P>

<P>1 0X X - VC1 (VC0 + 2VCs)&#61472;&#61472;</P>

<P>1 1X X - VC5&#61472;&#61472;</P>

<P> </P>

<P>1 XX X - VC1 (VC0 + 1VC) </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P>2.3 Packet Format </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>This section specifies the format of LP-Serial packets. Figure 2-1 shows the format of the LP-Serial packet and how the physical layer ackID, VC, CRF, and prio fields are prefixed at the beginning of the packet and a 16-bit CRC field is appended to the end of the packet. An additional CRC may be included within the packet (see Section 2.4.1, &quot;Packet CRC Operation&quot;, below). </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>ackID </P>
</TD>

<TD>
<P>VC </P>
</TD>

<TD>
<P>CRF </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>transport &amp; logical fields &amp; possible CRC </P>
</TD>

<TD>
<P>CRC </P>
</TD>
</TR>
</Table>

<P>6 1 1 2 n 16 </P>

<P> </P>

<P>Figure 2-1. Packet Format </P>

<P> </P>

<P>The unshaded fields are the fields added by the physical layer. The shaded field is the combined logical and transport layer bits and fields that are passed to the physical layer (also including the possible Section 2.4.1 additional CRC). </P>

<P> </P>

<P>LP-Serial packets shall have a length that is an integer multiple of 32 bits. This sizing simplifies the design of port logic whose internal data paths are an integer multiple of 32 bits in width. Packets, as defined in the appropriate logical and transport layer specifications, have a length that is an integer multiple of 16 bits. This is illustrated in Figure 2-2. If the length of a packet defined by the above combination of specifications is an odd multiple of 16 bits, a 16-bit pad whose value is 0 (0x0000) shall be appended at the end of the packet such that the resulting padded packet is an integer multiple of 32 bits in length. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>ackID </P>
</TD>

<TD>
<P>VC </P>
</TD>

<TD>
<P>CRF </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>ftype </P>
</TD>

<TD>
<P>remainder of packet fields </P>
</TD>

<TD>
<P>CRC </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_836.jpg"/>
</Figure>

<P>6 </P>

<P> </P>

<P> </P>

<P>start of packet </P>

<P>1 1 2 2 4 </P>

<P>16 bits </P>

<P>n*16 </P>

<P>16 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_837.jpg"/>
</Figure>

<P>16-bit boundary </P>

<P> </P>

<P>Figure 2-2. Packet Alignment </P>

<P> </P>

<P> </P>

<P>2.4 Packet Protection </P>

<P> </P>

<P>A 16-bit CRC code is added to each packet by the LP-Serial physical layer to provide error detection. The code covers the entire packet except for the ackID field, which is considered to be zero for the CRC calculations. Figure 2-3 shows the CRC coverage for the first 16 bits of the packet which contain the bits not covered by the code. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>This structure allows the ackID value to be changed on a link-by-link basis as the packet is transported across the fabric without requiring that the CRC be recomputed for each link. Since ackID values on each link are assigned sequentially for each subsequent transmitted packet, an error in the ackID field is easily detected. </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>ackID </P>
</TD>

<TD>
<P>VC </P>
</TD>

<TD>
<P>CRF </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P>ftype </P>
</TD>
</TR>
</Table>

<P>6 1 1 2 2 4 </P>

<P>Protected by protocol </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_838.jpg"/>
</Figure>

<P>Protected by CRC </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_839.jpg"/>
</Figure>

<P> </P>

<P>Figure 2-3. Error Coverage of First 16 Bits of Packet Header </P>

<P> </P>

<P>2.4.1  Packet CRC Operation </P>

<P> </P>

<P>The CRC is appended to a packet in one of two ways. For a packet whose length, exclusive of CRC, is 80 bytes or less, a single CRC is appended at the end of the logical fields. For packets whose length, exclusive of CRC, is greater than 80 bytes, a CRC is added after the first 80 bytes and a second CRC is appended at the end of the logical layer fields. </P>

<P> </P>

<P>The second CRC value is a continuation of the first. The first CRC is included in the running calculation, meaning that the running CRC value is not re-initialized after it is inserted after the first 80 bytes of the packet. This allows intervening devices to regard the embedded CRC value as two bytes of packet payload for CRC checking purposes. If the CRC appended to the end of the logical layer fields does not cause the end of the resulting packet to align to a 32-bit boundary, a two byte pad of all logic 0s is postpended to the packet. The pad of logic 0s allows the CRC check to always be done at the 32-bit boundary. A corrupt pad may or may not cause a CRC error to be detected, depending upon the implementation. </P>

<P> </P>

<P>The early CRC value can be used by the receiving processing element to validate the header of a large packet and start processing the data before the entire packet has been received, freeing up resources earlier and reducing transaction completion latency. </P>

<P> </P>

<P>NOTE: </P>

<P>While the embedded CRC value can be used by a processing element to start processing the data within a packet before receiving the entire packet, it is possible that upon reception of the end of the packet the final CRC value for the packet is incorrect. This would result in a processing element that has processed data that may have been corrupted. Outside of the error recovery mechanism described in Section 5.13.2,   &quot;Link   Behavior   Under   Error&quot;,   the   RapidIO Interconnect Specification does not address the occurrence of such situations nor does it suggest a means by which a processing element would handle such situations. Instead, the mechanism for handling this situation is left to be addressed by the device manufacturers for </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>devices that implement the functionality of early processing of packet data. </P>

<P> </P>

<P>Figure 2-4 is an example of an unpadded packet of length less than or equal to 80 bytes. </P>

<P> </P>

<P> </P>

<P>First half-word Remainder of packet </P>

<P>CRC </P>

<P>16 </P>

<P>start of packet </P>

<P>Even multiple of 16-bits 16 </P>

<P>32-bit boundary </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_840.jpg"/>
</Figure>

<P>Figure 2-4. Unpadded Packet of Length 80 Bytes or Less </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_841.jpg"/>
</Figure>

<P>Figure 2-5 is an example of a padded packet of length less than or equal to 80 bytes. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_842.jpg"/>
</Figure>

<P>First half-word Remainder of packet </P>

<P>16 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_843.jpg"/>
</Figure>

<P>start of packet </P>

<P> </P>

<P>Odd multiple of 16-bits </P>

<P> </P>

<P> </P>

<P>CRC Logic 0 pad </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_844.jpg"/>
</Figure>

<P>16 16 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_845.jpg"/>
</Figure>

<P>32-bit boundary </P>

<P> </P>

<P>Figure 2-5. Padded Packet of Length 80 Bytes or Less </P>

<P> </P>

<P>Figure 2-6 is an example of an unpadded packet of length greater than 80 bytes. </P>

<P> </P>

<P> </P>

<P>First half-word Remainder of packet header </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_846.jpg"/>
</Figure>

<P>16 (bytes 1 and 2) </P>

<P>start of packet </P>

<P> </P>

<P>Odd multiple of 16-bits </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_847.jpg"/>
</Figure>

<P>Logical data CRC </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_848.jpg"/>
</Figure>

<P>Even multiple of 16-bits </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_849.jpg"/>
</Figure>

<P> </P>

<P>16 (bytes 81 and 82) </P>

<P> </P>

<P> </P>

<P>Remainder of logical data CRC </P>

<P> </P>

<P>Even multiple of 16-bits </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_850.jpg"/>
</Figure>

<P>16 </P>

<P>32-bit boundary </P>

<P> </P>

<P>Figure 2-6. Unpadded Packet of Length Greater than 80 Bytes </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Figure 2-7 is an example of a padded packet of length greater than 80 bytes. </P>

<P> </P>

<P> </P>

<P>First half-word Remainder of packet header </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_851.jpg"/>
</Figure>

<P>16 (bytes 1 and 2) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_852.jpg"/>
</Figure>

<P>start of packet </P>

<P>Even multiple of 16-bits </P>

<P> </P>

<P>32-bit boundary </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_853.jpg"/>
</Figure>

<P>Logical data CRC </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_854.jpg"/>
</Figure>

<P>Odd multiple of 16-bits </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_855.jpg"/>
</Figure>

<P> </P>

<P>16 (bytes 81 and 82) </P>

<P> </P>

<P> </P>

<P>Remainder of logical data CRC </P>

<P> </P>

<P>Odd multiple of 16-bits 16 </P>

<P> </P>

<P> </P>

<P>Logic 0 pad </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_856.jpg"/>
</Figure>

<P>16 </P>

<P>32-bit boundary </P>

<P> </P>

<P>Figure 2-7. Padded Packet of Length Greater than 80 Bytes </P>

<P> </P>

<P>2.4.2  CRC-16 Code </P>

<P> </P>

<P>The ITU polynomial X16+X12+X5+1 shall be used to generate the 16-bit CRC for packets. The value of the CRC shall be initialized to 0xFFFF (all logic 1s) at the beginning of each packet. For the CRC calculation, the uncovered six bits are treated as logic 0s. As an example, a 16-bit wide parallel calculation is described in the equations  in  Table 2-3.  Equivalent  implementations  of  other  widths  can  be employed. </P>

<P> </P>

<P>Table 2-3. Parallel CRC-16 Equations </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Check Bit </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>0 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>1 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>2 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>3 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>4 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>5 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>6 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>7 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>8 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>9 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>0 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>1 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>2 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>3 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>4 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>5 </P>
</TD>
</TR>

<TR>
<TD>
<P>C00 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C01 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C02 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C03 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>C04 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C05 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C06 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C07 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C08 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C09 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C10 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>C11 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C12 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 2-3. Parallel CRC-16 Equations (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Check Bit </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>0 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>1 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>2 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>3 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>4 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>5 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>6 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>7 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>8 </P>
</TD>

<TD>
<P>e </P>

<P>0 </P>

<P>9 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>0 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>1 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>2 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>3 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>4 </P>
</TD>

<TD>
<P>e </P>

<P>1 </P>

<P>5 </P>
</TD>
</TR>

<TR>
<TD>
<P>C13 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C14 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>C15 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>
</Table>

<P> </P>

<P>where: </P>

<P> </P>

<P>C00&#8211;C15 contents of the new check symbol </P>

<P>e00&#8211;e15 contents of the intermediate value symbol&#61472;&#61472;</P>

<P>e00 = d00 XOR c00&#61472; e01 = d01 XOR c01&#61472; through&#61472;&#61472;</P>

<P>e15 = d15 XOR c15 </P>

<P> </P>

<P>d00&#8211;d15 contents of the next 16 bits of the packet c00&#8211;c15 contents of the previous check symbol </P>

<P>assuming the pipeline described in Figure 2-8 </P>

<P> </P>

<P> </P>

<P>d00&#8211;d15 </P>

<P> </P>

<P> </P>

<P>c XOR d </P>

<P> </P>

<P>e00&#8211;e15 </P>

<P> </P>

<P>XOR </P>

<P>equations network </P>

<P> </P>

<P>C00&#8211;C15 </P>

<P> </P>

<P> </P>

<P> </P>

<P>c00&#8211;c15 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_857.jpg"/>
</Figure>

<P>Figure 2-8. CRC Generation Pipeline </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.5 Maximum Packet Size </P>

<P> </P>

<P>The RapidIO Specification does not contain an overall specification for the maximum size of a packet that a logical layer may pass to the transport layer or the transport layer may pass to a physical layer. Maximum sizes can only be determined by examining the format of each packet type at the logical layer and the operation of the transport and physical layers. </P>

<P> </P>

<P>The longest packets are those containing an operand address within the destination device, an operand size and a maximum length payload (256 bytes). Currently the largest packet format is the type 5 (write class) format, defined in the I/O Logical specification. The sizes of the components of the maximum packet are shown in more detail in Table 2-4. </P>

<P> </P>

<P>Table 2-4. Maximum Packet Size </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Field </P>
</TD>

<TD>
<P>Size </P>

<P>(bytes) </P>
</TD>

<TD>
<P> </P>

<P>Layer </P>
</TD>

<TD>
<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD>
<P>Header </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>Logical, Transport, Physical </P>
</TD>

<TD>
<P>See Figure 2-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Source ID </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>Transport </P>
</TD>

<TD>
<P>Large transport </P>
</TD>
</TR>

<TR>
<TD>
<P>Destination ID </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>Transport </P>
</TD>

<TD>
<P>Large transport </P>
</TD>
</TR>

<TR>
<TD>
<P>Trans/wrsize </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Logical </P>
</TD>

<TD>
<P>Type 5 (write class) </P>
</TD>
</TR>

<TR>
<TD>
<P>srcTID </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Logical </P>
</TD>

<TD>
<P>Type 5 (write class) </P>
</TD>
</TR>

<TR>
<TD>
<P>Address </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>Logical </P>
</TD>

<TD>
<P>Type 5 (write class); includes Extended_address, Address, Wdptr, and Xambs </P>
</TD>
</TR>

<TR>
<TD>
<P>Payload </P>
</TD>

<TD>
<P>256 </P>
</TD>

<TD>
<P>Logical </P>
</TD>

<TD>
<P>Maximum data payload </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>Physical </P>
</TD>

<TD>
<P>Includes two CRC additional bytes for packets greater than </P>

<P>80 bytes </P>
</TD>
</TR>

<TR>
<TD>
<P>Total </P>
</TD>

<TD>
<P>276 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The maximum transmitted packet size permitted by the LP-Serial specification is </P>

<P>276 bytes. This includes all packet logical, transport, and physical layer header information, data payload, and required CRC bytes, but does not include any packet delimiting control symbols or other necessary physical layer control information. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Control Symbols </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This chapter specifies RapidIO physical layer control symbols. Control symbols are the message elements used by ports connected by a LP-Serial link to manage all aspects of LP-Serial link operation. They are used for link maintenance, packet delimiting, packet acknowledgment, error reporting, and error recovery. </P>

<P> </P>

<P>Two control symbols are defined. The first one is three (3) characters long and is referred to as the &#8220;short&#8221; control symbol. The second one is six (6) characters long and is referred to as the &#8220;long&#8221; control symbol. </P>

<P> </P>

<P>The short control symbol was the first control symbol defined for LP-Serial links. It was designed for links operating at less than 5.5 GBaud per lane and receivers that do not employ decision feedback equalization (DFE). It provides the functionality needed for the basic link protocol plus some extensions to the link protocol. </P>

<P> </P>

<P>The long control symbol is an extension of the short control symbol. It was designed for links operating at greater than 5.5 GBaud per lane and receivers employing DFE. The additional characters are required in part to provide stronger error detection for burst errors that are characteristic of receivers using DFE. The additional characters are also available to provide support for link protocol extensions beyond those supported by the short control symbol. </P>

<P> </P>

<P>When use of the long control symbol is supported by both ends of a LP-Serial link operating at less than 5.5 GBaud per lane, it may be used instead of the short control symbol to provide more control symbol functionality. </P>

<P> </P>

<P>LP-Serial control symbols carry at least two independent functions. Each function is assigned one or more control symbol fields for its use. One of the fields assigned to a function specifies the primary function type. The other fields assigned to the function may, depending on the primary function type, further specify the function type, contain information required for the execution of the function, contain &#8220;supplemental information&#8221; that is not required for the execution of the function and whose value does not affect the behavior of the receiving port, or be unused. Fields that specify the function type or contain data required for the execution of the function are called &#8220;functional&#8221; fields. Fields that contain &#8220;supplemental information&#8221; are called &#8220;informational&#8221; fields. All fields are functional unless specified otherwise. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>For forward compatibility, a control symbol function received by a port with an encoding in one or more of the fields assigned to the function that the port does not understand or support shall be handled as follows. If an encoding that the port does not understand or support occurs in a functional field, the control symbol function shall be ignored. If an encoding that the port does not understand or support occurs only in an informational field, the control symbol function shall be executed. In either case, no error shall be reported. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>3.2 Control Symbol Field Definitions </P>

<P> </P>

<P>This section describes the fields that make up the control symbols. </P>

<P> </P>

<P>Table 3-1. Control Symbol Field Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>Encoding for control symbols that make use of parameter0 and parameter1. Eight encodings are defined in </P>

<P>Table 3-2. </P>
</TD>
</TR>

<TR>
<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>Used in conjunction with stype0 encodings. Reference Table 3-2 for the description of parameter0 encodings. </P>
</TD>
</TR>

<TR>
<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>Used in conjunction with stype0 encodings. Reference Table 3-2 for the description of parameter1 encodings. </P>
</TD>
</TR>

<TR>
<TD>
<P>stype1 </P>
</TD>

<TD>
<P>Encoding for control symbols which make use of the cmd field. The eight encodings are defined in Table 3-7. </P>
</TD>
</TR>

<TR>
<TD>
<P>cmd </P>
</TD>

<TD>
<P>Used in conjunction with the stype1 field to define the link maintenance commands. Refer to Table 3-7 for the cmd field descriptions. </P>
</TD>
</TR>

<TR>
<TD>
<P>reserved </P>
</TD>

<TD>
<P>Set to logic 0s on transmission and ignored on reception </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC-5 </P>
</TD>

<TD>
<P>5-bit code used to detect transmission errors in short control symbols. See Section 3.6, &quot;Control Symbol </P>

<P>Protection&quot; for details on the CRC error detection scheme. </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC-13 </P>
</TD>

<TD>
<P>13-bit code used to detect transmission errors in long control symbols. See Section 3.6, &quot;Control Symbol </P>

<P>Protection&quot; for details on the CRC error detection scheme. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.3 Control Symbol Format </P>

<P> </P>

<P>This section describes the general formats of the LP-Serial control symbols. All short control symbols shall have the 24 data bit format shown in Figure 3-1. </P>

<P> </P>

<P> </P>

<P>bits </P>

<P>0 2  3 7  8 12 13 15 16 18 19 23 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<P>Figure 3-1. Short Control Symbol Format </P>

<P> </P>

<P>Short control symbols can carry two functions, one encoded in the stype0 field and one encoded in the stype1 field. The fields parameter0 and parameter1 are used by the functions encoded in the stype0 field. The cmd field is a modifier for the functions encoded in the stype1 field. </P>

<P> </P>

<P>The functions encoded in stype0 are &#8220;status&#8221; functions that convey some type of status about the port transmitting the control symbol. The functions encoded in stype1 are requests to the receiving port or transmission delimiters. </P>

<P> </P>

<P>All long control symbols shall have the 48 data bit format shown in Figure 3-2. </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>0 2 </P>
</TD>

<TD>
<P>3 8 </P>
</TD>

<TD>
<P>9 14   </P>
</TD>

<TD>
<P>15  17   </P>
</TD>

<TD>
<P>18  20 </P>
</TD>

<TD>
<P>21 34 </P>
</TD>

<TD>
<P>35 47 </P>
</TD>
</TR>

<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>bits </P>

<P> </P>

<P> </P>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-2. Long Control Symbol Format </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>With one exception, the stype0, parameter0, parameter1, stype1, and cmd fields in the long control symbol have exactly the same function, encoding, and size as the same named fields in the short control symbol. The exception is that parameter0 and parameter1 are 5-bit fields in the short control symbol and 6-bit fields in the long control symbol. </P>

<P> </P>

<P>Control symbols are defined with the ability to carry at least two functions so that a packet acknowledgment and a packet delimiter can be carried in the same control symbol. Packet acknowledgment and packet delimiter control symbols constitute the vast majority of control symbol traffic on a busy link. Carrying an acknowledgment (or status) and a packet delimiter whenever possible in a single control symbol allows a significant reduction in link overhead traffic and an increase in the link bandwidth available for packet transmission. </P>

<P> </P>

<P>A control symbol carrying one function is referred to using the name of the function it carries. A control symbol carrying more than one functions may be referred to using the name of any function that it carries. For example, a control symbol with stype0 set to packet-accepted and stype1 set to NOP is referred to a packet-accepted control symbol. A control symbol with stype0 set to packet-accepted and stype1 set to restart-from-retry is referred to as either a packet-accepted control symbol or a restart-from-retry control symbol depending on which name is appropriate for the context. </P>

<P> </P>

<P> </P>

<P>3.4 Stype0 Control Symbols </P>

<P> </P>

<P>The encoding and function of stype0 and the information carried in parameter0 and parameter1 for each stype0 encoding shall be as specified in Table 3-2. </P>

<P> </P>

<P>Table 3-2. Stype0 Control Symbol Encoding </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>stype0 </P>
</TD>

<TD>
<P> </P>

<P>Function </P>
</TD>

<TD>
<P>Contents of </P>
</TD>

<TD>
<P> </P>

<P>Reference </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Parameter0 </P>
</TD>

<TD>
<P>Parameter1 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>0b000 </P>
</TD>

<TD>
<P>packet-accepted </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>Section 3.4.1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b001 </P>
</TD>

<TD>
<P>packet-retry </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>Section 3.4.2 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b010 </P>
</TD>

<TD>
<P>packet-not-accepted </P>
</TD>

<TD>
<P>arbitrary </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>Section 3.4.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b011 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>
</TR>

<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>status </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>Section 3.4.4 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b101 </P>
</TD>

<TD>
<P>VC_status </P>
</TD>

<TD>
<P>VCID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>Section 3.4.5 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b110 </P>
</TD>

<TD>
<P>link-response </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>port_status </P>
</TD>

<TD>
<P>Section 3.4.6 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b111 </P>
</TD>

<TD>
<P>implementation-defined * </P>
</TD>

<TD>
<P>implementation-defined </P>
</TD>

<TD>
<P>implementation-defined </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>
</TR>
</Table>

<P> </P>

<P>* While implementation-defined control symbols are allowed, their use can result in inter-operability problems and is not recommended. There is no registration facility for implementation-defined control symbols. As  a  result,  two  implementations may  assign  different </P>

<P> </P>

<P> </P>

<P>40 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>meanings to the same encoding of the Parameter0 and/or Parameter1 fields which could result in undefined and/or inconsistent behavior, data corruption, or system failure. </P>

<P> </P>

<P>The packet-accepted, packet-retry and packet-not-accepted control symbols are collectively referred to as &#8220;packet acknowledgment&#8221; control symbols. </P>

<P> </P>

<P>&#8220;Status&#8221; (0b100) is the default stype0 encoding and is used when a control symbol does not convey another stype0 function. </P>

<P> </P>

<P>Table 3-3 defines the parameters valid for stype0 control symbols and that are used for more than one value of stype0. </P>

<P> </P>

<P>Table 3-3. Stype0 Parameter Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>The ackID of the packet being acknowledged. </P>
</TD>
</TR>

<TR>
<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>The value of the ackID field expected in the next packet the port receives. This value is 1 greater than the ackID of the last packet accepted by the port exclusive of CT mode packets accepted after the port entered an Input-stopped state. For example, a value of 0b00001 (short control symbol) or 0b000001 (long control symbol) indicates that the ackID of the last packet accepted by the port exclusive of CT mode packets accepted after the port entered an Input-stopped state was 0 and that the port is expecting to receive a packet with an ackID field value of 1. </P>
</TD>
</TR>

<TR>
<TD>
<P>buf_status </P>
</TD>

<TD>
<P>The number of maximum length packet buffers the port has available for packet reception on the specified virtual channel (VC) at the time the control symbol containing the field is generated. The value of the buf_status field in a packet-accepted control symbol is inclusive of the receive buffer consumption of the packet being accepted. The field is used in transmitter controlled flow control to control the rate at which packets are transmitted to prevent loss of packets at the receiver due to a lack of packet buffers. </P>

<P> </P>

<P>For short control symbols: </P>

<P>Value 0-29: The encoded value is the number of maximum sized packet buffers the port has available for reception on the specified VC. The value 0, for example, signifies that the port has no packet buffers available for the specified VC (thus is not able to accept any new packets for that VC). </P>

<P> </P>

<P>Value 30: The value 30 indicates that the port has at least 30 maximum length packet buffers available for reception on the specified VC. </P>

<P> </P>

<P>Value 31: The port has an undefined number of maximum sized packet buffers available for packet reception, and relies on retry for flow control. </P>

<P> </P>

<P>For long control symbols: </P>

<P>Value 0-61: The encoded value is the number of maximum sized packet buffers the port has available for reception on the specified VC. The value 0, for example, signifies that the port has no packet buffers available for the specified VC (thus is not able to accept any new packets for that VC). </P>

<P> </P>

<P>Value 62: The value 62 indicates that the port has at least 62 maximum length packet buffers available for reception on the specified VC. </P>

<P> </P>

<P>Value 63: The port has an undefined number of maximum sized packet buffers available for packet reception, and relies on retry for flow control </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>NOTE: </P>

<P>The following sections depict various control symbols. Since control symbols can contain one or more functions, shading in the figures is used to indicate which fields are applicable to that specific control symbol function. </P>

<P> </P>

<P> </P>

<P>3.4.1  Packet-Accepted Control Symbol </P>

<P> </P>

<P>The packet-accepted control symbol indicates that the port sending the control symbol has taken responsibility for sending the packet to its final destination and that resources allocated to the packet by the port receiving the control symbol can be released. This control symbol shall be generated only after the entire packet has been received and found to be free of detectable errors. The packet-accepted control symbol formats are displayed in Figure 3-3. </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b000 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b000 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P>Figure 3-3. Packet-Accepted Control Symbol Formats </P>

<P> </P>

<P>The buf_status value in the control symbol is for the VC of the packet being accepted. Since the VC of the packet is not carried in the control symbol, the port receiving the control symbol must reassociate the ackID in the packet_ackID field with the VC of the accepted packet to determine the VC to which the buf_status applies. </P>

<P> </P>

<P> </P>

<P>3.4.2  Packet-Retry Control Symbol </P>

<P> </P>

<P>A packet-retry control symbol indicates that the port sending the control symbol was not able to accept the packet due to some temporary resource conflict such as insufficient buffering and the packet must be retransmitted. The control symbol formats are displayed in Figure 3-4. </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b001 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 3 3 5 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b001 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-4. Packet-Retry Control Symbol Formats </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The packet-retry control symbol is only used in singleVC mode for compatibility with Rev. 1.x RapidIO devices. Packet retry is replaced with error recovery when multiple VCs are active. See Chapter 5, &quot;LP-Serial Protocol&quot;, for more information. </P>

<P> </P>

<P> </P>

<P>3.4.3  Packet-Not-Accepted Control Symbol </P>

<P> </P>

<P>The packet-not-accepted control symbol indicates that the port sending the control symbol has either detected an error in the received character stream or, when operating in multiple VC mode, has insufficient buffer resources and as a result may have rejected a packet or control symbol. The control symbol contains a &#8220;arbitrary&#8221; field and a &#8220;cause&#8221; field. The control symbol formats are shown in Figure 3-5. </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b010 </P>
</TD>

<TD>
<P>arbitrary </P>
</TD>

<TD>
<P>cause </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b010 </P>
</TD>

<TD>
<P>arbitrary </P>
</TD>

<TD>
<P>0b0,cause </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P> </P>

<P>Figure 3-5. Packet-Not-Accepted Control Symbol Formats </P>

<P> </P>

<P>The &#8220;arbitrary&#8221; field contains an arbitrary number and conveys no useful information. </P>

<P> </P>

<P>The &#8220;cause&#8221; field is used to provide information about the type of error that was detected for diagnostics and debug use. The content of the cause field is informational only. </P>

<P> </P>

<P>The cause field shall be encoded as specified in Table 3-4 which lists a number of common faults and their encodings. If the port issuing the control symbol is not able to specify the fault, or the fault is not one of those listed in the table, the general error encoding shall be used. </P>

<P> </P>

<P>Table 3-4. Cause Field Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Cause </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00000 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00001 </P>
</TD>

<TD>
<P>Received packet with an unexpected ackID </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00010 </P>
</TD>

<TD>
<P>Received a control symbol with bad CRC </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00011 </P>
</TD>

<TD>
<P>Non-maintenance packet reception is stopped </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00100 </P>
</TD>

<TD>
<P>Received packet with bad CRC </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00101 </P>
</TD>

<TD>
<P>Received invalid character, or valid but illegal character </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00110 </P>
</TD>

<TD>
<P>Packet not accepted due to lack of resources </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00111 </P>
</TD>

<TD>
<P>Loss of descrambler sync </P>
</TD>
</TR>

<TR>
<TD>
<P>0b01000 - 0b11110 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b11111 </P>
</TD>

<TD>
<P>General error </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.4.4  Status Control Symbol </P>

<P> </P>

<P>The status control symbol indicates receive status information about the port sending the control symbol. The control symbol contains the ackID_status and the buf_status fields. The ackID_status field allows the receiving port to determine if it and the sending port are in sync with respect to the next ackID value the sending port expects to receive. The buf_status field indicates to the receiving port the number of maximum length packet buffers the sending port has available for reception on VC0 as defined in Table 3-3. </P>

<P> </P>

<P>&#8220;Status&#8221; is the default stype0 encoding and is used when the control symbol does not convey another stype0 function. </P>

<P> </P>

<P>The status control symbol formats are shown in Figure 3-6. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>packet_ackID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-6. Status Control Symbol Formats </P>

<P> </P>

<P> </P>

<P>3.4.5  VC-Status Control Symbol </P>

<P> </P>

<P>The VC-status control symbol indicates to the receiving port the available buffer space that the sending port has available for packet reception on the virtual channel (VC) specified in the control symbol. The VC-status control symbol is used only for virtual channels 1 through 8 (VC1 through VC8) and may be transmitted only when the specified VC is implemented and enabled. (The status control symbol described in Section 3.4.4, &quot;Status Control Symbol&quot; provides this function for VC0.) </P>

<P> </P>

<P>The VCID field specifies the VC to which the control symbol applies. VCID is 3-bit field that is right justified in the Parameter0 field of the control symbol. The remaining bits of the parameter0 field are reserved, set to 0 on transmission and ignored on reception. The buf_status field indicates to the receiving port the number of maximum length packet buffers the sending port has available for reception on the specified VC as defined in Table 3-3. </P>

<P> </P>

<P>The VC-status control symbol may be transmitted at any time and should be transmitted whenever the number of maximum length packet buffers available for reception on a VC has changed and has not been otherwise communicated to the connected port. </P>

<P> </P>

<P>The VC-status control symbol formats are shown in Figure 3-7. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b101 </P>
</TD>

<TD>
<P>0b00,VCID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b101 </P>
</TD>

<TD>
<P>0b000,VCID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-7. VC_Status Control Symbol Formats </P>

<P> </P>

<P>The encoding of the VCID field is specified in Table 3-5. The VCID corresponds to the VCID in the physical layer format as described in Chapter 2, &quot;Packets&quot;. </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>2 Optional VCs Active </P>
</TD>
</TR>

<TR>
<TD>
<P>VCID </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0xx </P>
</TD>

<TD>
<P>VC1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1xx </P>
</TD>

<TD>
<P>VC5 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Table 3-5. VCID Definition </P>

<Textbox>
<Table>
<TR>
<TD>
<P>1 Optional VC Active </P>
</TD>
</TR>

<TR>
<TD>
<P>VCID </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0bxxx </P>
</TD>

<TD>
<P>VC1 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<Table>
<TR>
<TD>
<P>4 Optional VCs Active </P>
</TD>
</TR>

<TR>
<TD>
<P>VCID </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00x </P>
</TD>

<TD>
<P>VC1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b01x </P>
</TD>

<TD>
<P>VC3 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b10x </P>
</TD>

<TD>
<P>VC5 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b11x </P>
</TD>

<TD>
<P>VC7 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>8 Optional VCs Active </P>
</TD>
</TR>

<TR>
<TD>
<P>VCID </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b000 </P>
</TD>

<TD>
<P>VC1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b001 </P>
</TD>

<TD>
<P>VC2 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b010 </P>
</TD>

<TD>
<P>VC3 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b011 </P>
</TD>

<TD>
<P>VC4 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>VC5 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b101 </P>
</TD>

<TD>
<P>VC6 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b110 </P>
</TD>

<TD>
<P>VC7 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b111 </P>
</TD>

<TD>
<P>VC8 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Active VCs are in addition to VC0 </P>

<P> </P>

<P>Formats for 4, 2, and 1 active VCs are shown in the three right hand columns of the table. When using fewer than 8 VCs, bits in the VCID are ignored starting from the LSB, consistent with the bit usage in the packet format. For example, with one optional VC active, all bit patterns in the VCID are interpreted as pertaining to VC1. </P>

<P> </P>

<P> </P>

<P>3.4.6  Link-Response Control Symbol </P>

<P> </P>

<P>The link-response control symbol is used by a port to respond to a link-request control  symbol  as  described  in  the  link  maintenance  protocol  described  in Section 5.7, &quot;Link Maintenance Protocol&quot;. The status reported in the status field is the status of the port at the time the associated input-status link-request control symbol was received and is informational only. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b110 </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>port_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0b110 </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>0b0,port_status </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-8. Link-Response Control Symbol Formats </P>

<P> </P>

<P>RapidIO Trade Association 45 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The encoding of the link-response control symbol port_status field is defined in </P>

<P>Table 3-6. </P>

<P> </P>

<P>Table 3-6. Port_status Field Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Port_status </P>
</TD>

<TD>
<P>Status </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00000 - 0b00001 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00010 </P>
</TD>

<TD>
<P>Error </P>
</TD>

<TD>
<P>The port has encountered an unrecoverable error and is unable to accept packets. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00011 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00100 </P>
</TD>

<TD>
<P>Retry-stopped </P>
</TD>

<TD>
<P>The port has retried a packet and is waiting in the input retry-stopped state to be restarted. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00101 </P>
</TD>

<TD>
<P>Error-stopped </P>
</TD>

<TD>
<P>The port has encountered a transmission error and is waiting in the input error-stopped state to be restarted. </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00110 - 0b01111 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0b10000 </P>
</TD>

<TD>
<P>OK </P>
</TD>

<TD>
<P>The port is accepting packets </P>
</TD>
</TR>

<TR>
<TD>
<P>0b10001 - 0b11111 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.5 Stype1 Control Symbols </P>

<P> </P>

<P>The encoding of stype1 and the function of the cmd field are defined in Table 3-7. </P>

<P> </P>

<P>Table 3-7. Stype1 Control Symbol Encoding </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>stype1 </P>
</TD>

<TD>
<P>stype1 </P>

<P>Function </P>
</TD>

<TD>
<P> </P>

<P>cmd </P>
</TD>

<TD>
<P>cmd </P>

<P>Function </P>
</TD>

<TD>
<P>Packet </P>

<P>Delimiter </P>
</TD>

<TD>
<P> </P>

<P>Reference </P>
</TD>
</TR>

<TR>
<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Start-of-packet </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Start-of-packet </P>
</TD>

<TD>
<P>yes </P>
</TD>

<TD>
<P>Section 3.5.1 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b001 - 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b001 </P>
</TD>

<TD>
<P>Stomp </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Stomp </P>
</TD>

<TD>
<P>yes </P>
</TD>

<TD>
<P>Section 3.5.2 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b001 - 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b010 </P>
</TD>

<TD>
<P>End-of-packet </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>End-of-packet </P>
</TD>

<TD>
<P>yes </P>
</TD>

<TD>
<P>Section 3.5.3 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b001 - 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b011 </P>
</TD>

<TD>
<P>Restart-from-retry </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Restart-from-retry </P>
</TD>

<TD>
<P>* </P>
</TD>

<TD>
<P>Section 3.5.4 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b001 - 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>Link-request </P>
</TD>

<TD>
<P>0b000 - 0b010 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>* </P>
</TD>

<TD>
<P>- </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b011 </P>
</TD>

<TD>
<P>Reset-device </P>
</TD>

<TD/>

<TD>
<P>Section 3.5.5.1 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b100 </P>
</TD>

<TD>
<P>Input-status </P>
</TD>

<TD/>

<TD>
<P>Section 3.5.5.2 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b101- 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD/>

<TD>
<P>- </P>
</TD>
</TR>

<TR>
<TD>
<P>0b101 </P>
</TD>

<TD>
<P>Multicast-event </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Multicast-event </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P>Section 3.5.6 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b001 - 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b110 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>0b000 - 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P>- </P>
</TD>
</TR>

<TR>
<TD>
<P>0b111 </P>
</TD>

<TD>
<P>NOP (Ignore) ** </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>NOP (Ignore) ** </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P>- </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b001 - 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P>No </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Note: * denotes that restart-from-retry and link-request control symbols may only be packet delimiters if a packet is in progress. </P>

<P> </P>

<P>Note: ** NOP (Ignore) is not defined as a control symbol, but is the default value when the control symbol does not convey another stype1 function. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>NOTE: </P>

<P>The following sections depict various control symbols. Since control symbols can contain one or two functions, shading in the figures is used to indicate which fields are applicable to that specific control symbol function. </P>

<P> </P>

<P> </P>

<P>3.5.1  Start-of-Packet Control Symbol </P>

<P> </P>

<P>The start-of-packet control symbol is used to delimit the beginning of a packet. The control symbol formats are shown in Figure 3-9. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-9. Start-of-Packet Control Symbol Formats </P>

<P> </P>

<P> </P>

<P>3.5.2  Stomp Control Symbol </P>

<P> </P>

<P>The stomp control symbol is used to cancel a partially transmitted packet. The protocol for packet cancellation is specified in Section 5.10, &quot;Canceling Packets&quot;. The stomp control symbol formats are shown in Figure 3-10 below. </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b001 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b001 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-10. Stomp Control Symbol Formats </P>

<P> </P>

<P> </P>

<P>3.5.3  End-of-Packet Control Symbol </P>

<P> </P>

<P>The end-of-packet control symbol is used to delimit the end of a packet. The control symbol formats are shown in Figure 3-11. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b010 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b010 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-11. End-of-Packet Control Symbol Formats </P>

<P> </P>

<P> </P>

<P>3.5.4  Restart-From-Retry Control Symbol </P>

<P> </P>

<P>This control symbol is used to mark the beginning of packet retransmission, so that the receiver knows when to start accepting packets after the receiver has requested a packet to be retried. The restart-from-retry control symbol cancels a current packet and may also be transmitted on an idle link. The control symbol formats are shown in Figure 3-12 below. </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b011 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b011 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-12. Restart-From-Retry Control Symbol Formats </P>

<P> </P>

<P> </P>

<P>3.5.5  Link-Request Control Symbol </P>

<P> </P>

<P>A link-request control symbol is used by a port to either issue a command to the connected port or request its input port status. A link-request control symbol always cancels a packet whose transmission is in progress and can also be sent between packets. Under error conditions, a link-request/input-status control symbol acts as a link-request/restart-from-error control symbol as described in Section 5.7, &quot;Link Maintenance Protocol&quot;. The control symbol formats are displayed in Figure 3-13. </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b100 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b100 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-13. Link-Request Control Symbol Formats </P>

<P> </P>

<P>The use of the &#8220;cmd&#8221; field in the link-request control symbol format is defined in </P>

<P>Table . </P>

<P> </P>

<P>Table 3-8. Cmd Field Definitions </P>

<P> </P>

<P>RapidIO Trade Association 49 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>cmd Encoding </P>
</TD>

<TD>
<P>Command </P>

<P>Name </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>

<TD>
<P> </P>

<P>Reference </P>
</TD>
</TR>

<TR>
<TD>
<P>0b000-0b010 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b011 </P>
</TD>

<TD>
<P>Reset-device </P>
</TD>

<TD>
<P>Reset the receiving device </P>
</TD>

<TD>
<P>Section 3.5.5.1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>Input-status </P>
</TD>

<TD>
<P>Return input port status; functions as a link request </P>

<P>(restart-from-error) control symbol under error conditions </P>
</TD>

<TD>
<P>Section 3.5.5.2 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b101-0b111 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.5.5.1  Reset-Device Command </P>

<P> </P>

<P>The reset-device command causes the receiving device to go through its reset or power-up sequence. All state machines and the configuration registers reset to the original  power  on  states.  The  reset-device  command  does  not  generate  a link-response control symbol. </P>

<P> </P>

<P>Due to the undefined reliability of system designs it is necessary to put a safety lockout on the reset function of the link-request control symbol. A port receiving a reset-device command in a link-request control symbol shall not perform the reset function unless it has received four reset-device commands in a row without any other intervening packets or control symbols, except status control symbols. This will prevent spurious reset commands from inadvertently resetting a device. </P>

<P> </P>

<P>When issuing a reset with four consecutive reset commands, care must be taken to account for all effects associated with the reset event. Consult RapidIO Part 8: Error Management Extensions Specification for more information. </P>

<P> </P>

<P>3.5.5.2  Input-Status Command </P>

<P> </P>

<P>The input-status command requests the receiving port to return a link-response containing the ackID value it expects to next receive on its input port and the current input port operational status for informational purposes. This command causes the receiver to flush its output port of all control symbols generated by packets received before the input-status command. Flushing the output port is implementation dependent and may result in either discarding the contents of the receive buffers or sending  the  control  symbols  on  the  link. The  receiver  then  responds  with  a link-response control symbol. </P>

<P> </P>

<P> </P>

<P>3.5.6  Multicast-Event Control Symbol </P>

<P> </P>

<P>The multicast-event control symbol allows the occurrence of a user-defined system event to be multicast throughout a system. The multicast-event control symbol differs from other control symbols in that it carries information not related to the link carrying the control symbol. Refer to Section 5.5.3.4, &quot;Multicast-Event Control Symbols&quot; for more details on Multicast-Events. </P>

<P> </P>

<P>The multicast-event control symbol formats are shown in Figure 3-14 below. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b101 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>CRC-5 </P>
</TD>
</TR>
</Table>

<P>3 5 5 </P>

<P>3 3 5 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>0b101 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-14. Multicast-Event Control Symbol Formats </P>

<P> </P>

<P> </P>

<P>3.6 Control Symbol Protection </P>

<P> </P>

<P>Control symbol error detection is provided by a cyclic redundancy check (CRC) </P>

<P>code. </P>

<P> </P>

<P>A 5-bit CRC is used for the short control symbol. It provides detection of a single burst error of 5 bits or less in the 24 data bits of the 8B/10B decoded control symbol. A single 5 bit burst error is the longest burst error that can be caused by a single bit transmission error at the 8B/10B code-group level. </P>

<P> </P>

<P>A 13-bit CRC is used for the long control symbol. It provides detection of any set of errors in the 48 data bits of the 8B/10B decoded control symbol that can be caused by a burst error on one lane of 11 bits or less at the 8B/10B code-group level. An 11 bit error at the code-group level can corrupt at most two code-groups. </P>

<P> </P>

<P> </P>

<P>3.6.1  CRC-5 Code </P>

<P> </P>

<P>The ITU polynomial X5+X4+X2+1 shall be used to generate the 5-bit CRC for short control symbols. </P>

<P> </P>

<P>The 5-bit CRC shall be computed over 20 bits comprised of control symbol bits 0 through 18 plus a 20th bit that is appended after bit 18 of the control symbol. The added bit shall be set to logic 0 (0b0). The 20th bit is added in order to provide maximum implementation flexibility for all types of designs. The CRC shall be computed beginning with control symbol bit 0. Before the CRC is computed, the CRC shall be set to all 1&#8217;s (0b11111). </P>

<P>The CRC check bits c[0:4] occupy short control symbol bits [19:23] respectively. The 5-bit CRC shall be generated by each transmitter and verified by each receiver </P>

<P>using the short control symbol. </P>

<P> </P>

<P> </P>

<P>3.6.2  CRC-5 Parallel Code Generation </P>

<P> </P>

<P>Since it is often more efficient to implement a parallel CRC algorithm rather than a serial, examples of the equations for a complete, 19-bit single-stage parallel implementation is shown in shown in Table 3-9. Since only a single stage is used, </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>the effect of both setting the initial CRC to all 1&#8217;s (0b11111) and a 20th bit set to logic </P>

<P>0 (0b0) have been included in the equations. </P>

<P> </P>

<P>In  Table 3-9,  an  &#8220;x&#8221;  means  that  the  data  input  should  be  an  input  to  the Exclusive-OR necessary to compute that particular bit of the CRC. A &#8220;!x&#8221;, means that bit 18 being applied to the CRC circuit must be inverted. </P>

<P> </P>

<P>Table 3-9. Parallel CRC-5 Equations </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Control </P>

<P>Symbol </P>
</TD>

<TD>
<P> </P>

<P>CRC Checksum Bits </P>
</TD>
</TR>

<TR>
<TD>
<P>Data for </P>

<P>CRC </P>
</TD>

<TD>
<P> </P>

<P>C0 </P>
</TD>

<TD>
<P> </P>

<P>C1 </P>
</TD>

<TD>
<P> </P>

<P>C2 </P>
</TD>

<TD>
<P> </P>

<P>C3 </P>
</TD>

<TD>
<P> </P>

<P>C4 </P>
</TD>
</TR>

<TR>
<TD>
<P>D18 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>!x </P>
</TD>

<TD>
<P>!x </P>
</TD>

<TD>
<P>!x </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D17 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D16 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D15 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D14 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D13 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D12 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D11 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D10 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D5 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D4 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D3 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D2 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D1 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D0 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 3-15 shows the 19-bits that the CRC covers and how they should be applied to the circuit. As seen in Figure 3-15, bits are labeled with 0 on the left and 18 on the right. Bit 0, from the stype0 field, would apply to D0 in Table 3-9 and bit 18, from the cmd field, would apply to D18 in Table 3-9. Once completed, the 5-bit CRC is appended to the control symbol. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC </P>
</TD>
</TR>

<TR>
<TD>
<P>0 18 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_858.jpg"/>
</Figure>

<P>Function From Equations </P>

<P>In Table 3-8 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_859.jpg"/>
</Figure>

<P>5-bit CRC (C0:C4) </P>

<P> </P>

<P> </P>

<P>Figure 3-15. CRC-5 Implementation </P>

<P> </P>

<P> </P>

<P>3.6.3  CRC-13 Code </P>

<P> </P>

<P>The polynomial x13 + x10 + x8 + x5 + x2 + 1 shall be used to generate the 13-bit CRC </P>

<P>for long control symbols. </P>

<P> </P>

<P>The 13-bit CRC shall be computed over control symbol bits 0 through 34 beginning with control symbol bit 0. Before the 13-bit CRC is computed, the CRC shall be set to all 0&#8217;s (0b0_0000_0000_0000). </P>

<P> </P>

<P>The  CRC  check  bits  c[0:12]  shall  occupy  long  control  symbol  bits  [35:47] </P>

<P>respectively. </P>

<P> </P>

<P>The 13-bit CRC shall be generated by each transmitter and verified by each receiver using the long control symbol. </P>

<P> </P>

<P> </P>

<P>3.6.4  CRC-13 Parallel Code Generation </P>

<P> </P>

<P>For the CRC-13 parallel code generation, the equations are shown in Figure 3-10, using rules as for the CRC-5 parallel generation. </P>

<P> </P>

<P>Table 3-10. Parallel CRC-13 Equations </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Control </P>

<P>Symbol </P>
</TD>

<TD>
<P> </P>

<P>CRC Checksum Bits </P>
</TD>
</TR>

<TR>
<TD>
<P>Data For </P>

<P>CRC </P>
</TD>

<TD>
<P> </P>

<P>C0 </P>
</TD>

<TD>
<P> </P>

<P>C1 </P>
</TD>

<TD>
<P> </P>

<P>C2 </P>
</TD>

<TD>
<P> </P>

<P>C3 </P>
</TD>

<TD>
<P> </P>

<P>C4 </P>
</TD>

<TD>
<P> </P>

<P>C5 </P>
</TD>

<TD>
<P> </P>

<P>C6 </P>
</TD>

<TD>
<P> </P>

<P>C7 </P>
</TD>

<TD>
<P> </P>

<P>C8 </P>
</TD>

<TD>
<P> </P>

<P>C9 </P>
</TD>

<TD>
<P>C </P>

<P>10 </P>
</TD>

<TD>
<P>C </P>

<P>11 </P>
</TD>

<TD>
<P>C </P>

<P>12 </P>
</TD>
</TR>

<TR>
<TD>
<P>D34 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D33 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D32 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D31 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D30 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D29 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Control </P>

<P>Symbol </P>
</TD>

<TD>
<P> </P>

<P>CRC Checksum Bits </P>
</TD>
</TR>

<TR>
<TD>
<P>D28 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D27 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D26 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D25 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D24 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D23 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D22 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D21 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D20 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D19 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D18 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D17 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D16 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D15 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D14 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D13 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D12 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D11 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D10 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D9 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D6 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D5 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D4 </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D3 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>
</TR>

<TR>
<TD>
<P>D2 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>D0 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>x </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 PCS and PMA Layers </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>

<P>This chapter specifies the functions provided by the Physical Coding Sublayer (PCS) and Physical Media Attachment (PMA) sublayer. (The PCS and PMA terminology is adopted from IEEE 802.3). The topics include character representation, scrambling, lane striping, 8B/10B encoding, serialization of the data stream, code-groups, columns, link transmission rules, idle sequences, and link initialization. </P>

<P> </P>

<P>The concept of lanes is used to describe the width of a LP-Serial link. A lane is a single unidirectional signal path between two LP-Serial ports. Five widths are defined for LP-Serial links, 1, 2, 4, 8 and 16 lanes per direction. A link with N lanes in each direction is referred to as a Nx link, e.g. a link with 4 lanes in each direction is referred to as a 4x link. </P>

<P> </P>

<P> </P>

<P>4.2 PCS Layer Functions </P>

<P> </P>

<P>The Physical Coding Sublayer (PCS) function is responsible for idle sequence generation, lane striping, scrambling and encoding for transmission and decoding, lane alignment, descrambling and destriping on reception. The PCS uses an 8B/10B encoding for transmission over the link. </P>

<P> </P>

<P>The PCS layer also provides mechanisms for determining the operational mode of the port as Nx or 1x operation, and means to detect link states. It provides for clock difference tolerance between the sender and receiver without requiring flow control. </P>

<P> </P>

<P>The PCS layer performs the following transmit functions: </P>

<P> </P>

<P>&#8226; Dequeues packets and delimited control symbols awaiting transmission as a character stream. </P>

<P>&#8226; Scrambles packet and control symbol data if required. </P>

<P>&#8226; Stripes the transmit character stream across the available lanes. </P>

<P>&#8226; Generates the idle sequence and inserts it into the transmit character stream for each lane when no packets or delimited control symbols are available for transmission. </P>

<P>&#8226; Encodes the character stream of each lane independently into 10-bit parallel code-groups. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Passes the resulting 10-bit parallel code-groups to the PMA. The PCS layer performs the following receive functions: </P>

<P>&#8226; Decodes the received stream of 10-bit parallel code-groups for each lane </P>

<P>independently into characters. </P>

<P>&#8226; Marks characters decoded from invalid code-groups as invalid. </P>

<P>&#8226; If the link is using more than one lane, aligns the character streams to eliminate the skew between the lanes and reassembles (destripes) the character stream from each lane into a single character stream. </P>

<P>&#8226; Descrambles packet and control symbol data if required. </P>

<P>&#8226; Delivers the decoded character stream of packets and delimited control symbols to the higher layers. </P>

<P> </P>

<P> </P>

<P>4.3 PMA Layer Functions </P>

<P> </P>

<P>The PM (Physical Medium Attachment) layer is responsible for serializing 10-bit parallel code-groups to/from a serial bitstream on a lane-by-lane basis. Upon receiving data, the PMA function provides alignment of the received bitstream to </P>

<P>10-bit code-group boundaries, independently on a lane-by-lane basis. It then provides a continuous stream of 10-bit code-groups to the PCS, one stream for each lane. The 10-bit code-groups are not observable by layers higher than the PCS. </P>

<P> </P>

<P>If  a  LP-Serial  port  support  supports  either  baud  rate  discovery  or  adaptive equalization, these functions are also performed in the PMA layer. </P>

<P> </P>

<P> </P>

<P>4.4 Definitions </P>

<P> </P>

<P>Definitions of terms used in this specification are provided below. </P>

<P> </P>

<P>Byte: An 8-bit unit of information. Each bit of a byte has the value 0 or 1. </P>

<P>Character: A 9-bit entity comprised of an information byte and a control bit that indicates whether the information byte contains data or control information. The control bit has the value D or K indicating that the information byte contains respectively data or control information. </P>

<P>D-character: A character whose control bit has the value &#8220;D&#8221;. Also referred to as a data character. </P>

<P>K-character: A character whose control bit has the value &#8220;K&#8221;. Also referred to as a special character. </P>

<P>Code-group: A 10-bit entity that is the result of 8B/10B encoding a character. </P>

<P>Column: The group of N characters that are transmitted at nominally the same time by a </P>

<P>LP-Serial port operating in Nx mode. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Comma: A 7-bit pattern, unique to certain 8B/10B special code-groups, that is used by a receiver to determine code-group boundaries. See more in Section 4.5.7.4, &quot;Sync (/K/)&quot; and Table 4-2. </P>

<P>Idle sequence: The sequence of characters (code-groups after 8B/10B encoding) that is transmitted by a port on each of its active output lanes when the port is not transmitting a packet or control symbol. The idle sequence allows the receiver to maintain bit synchronization, code-group alignment and, if applicable, adaptive equalization settings in between packets and control symbols. </P>

<P>Lane: A single unidirectional signal path, typically a differential pair, between two </P>

<P>LP-Serial ports. </P>

<P>Nx port: A LP-Serial port that supports links with up to a maximum of N lanes in each direction. </P>

<P>Lane Alignment: The process of eliminating the skew between the lanes of a LP-Serial link operating in Nx mode such that the characters transmitted as a column by the sender are output by the alignment process of receiver as a column. Without lane alignment, the characters transmitted as a column might be scattered across several columns output by the receiver. The alignment process uses the columns of &#8220;A&#8221; special characters transmitted as part of the idle sequence. </P>

<P>1x mode: A LP-Serial port mode of operation in which the port transmits on a single lane and receives on a single lane. </P>

<P>Nx mode: A LP-Serial port mode of operation in which the port both transmits and receives on multiple lanes. A LP-Serial port operating in Nx mode transmits on N lanes and receives on N lanes where N has a value greater then 1. The transmit data stream is distributed across the N transmit lanes and the receive data stream is distributed across the N receive lanes. </P>

<P>Striping: The method used on a link operating in Nx mode to distribute data across the N lanes simultaneously. For each direction of the link, the character stream is striped across the lanes, on a character-by-character basis, beginning with lane 0, continuing in incrementing lane number order across the lanes, and wrapping back to lane 0 for character N+1. </P>

<P> </P>

<P> </P>

<P>4.5 8B/10B Transmission Code </P>

<P> </P>

<P>The 8B/10B transmission code used by the PCS encodes 9-bit characters (8 bits of information and a control bit) into 10-bit code-groups for transmission and reverses the process on reception. Encodings are defined for 256 data characters and 12 special characters. </P>

<P> </P>

<P>The code-groups comprising the 8B/10B code have either an equal number of ones and zeros (balanced) or the number of ones differs from the number of zeros by two (unbalanced). This eases the task of maintaining 0/1 balance. The selection of code-groups also guarantees a minimum of three transitions, 0 to 1 or 1 to 0, within each code-group. For encoding, unbalanced code-groups are grouped in pairs with one member of the pair having more ones than zeros and the other member of the </P>

<P> </P>

<P>RapidIO Trade Association 57 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>pair having more zeros than ones. This allows the encoder, when selecting an unbalanced code-group, to select a code-group unbalanced toward ones or unbalanced toward zeros, depending on which is required to maintain the 0/1 balance of the encoder output code-group stream. </P>

<P> </P>

<P>The 8B/10B code has the following properties. </P>

<P> </P>

<P>&#8226; Sufficient bit transition density (3 to 8 transitions per code-group) to allow clock recovery by the receiver. </P>

<P>&#8226; Special code-groups that are used for establishing the receiver synchronization to the 10-bit code-group boundaries, delimiting control symbols and maintaining receiver bit and code-group boundary synchronization. </P>

<P>&#8226; 0/1 balanced. (can be AC coupled) </P>

<P>&#8226; Detection of all single and some multiple-bit errors. </P>

<P> </P>

<P> </P>

<P>4.5.1  Character and Code-Group Notation </P>

<P> </P>

<P>The description of 8B/10B encoding and decoding uses the following notation for characters, code-group and their bits. </P>

<P> </P>

<P>The information bits ([0-7]) of an unencoded character are denoted with the letters &#8220;A&#8221; through &#8220;H&#8221; where the letter &#8220;H&#8221; denotes the most significant information bit (RapidIO bit 0) and the letter &#8220;A&#8221; denotes the least significant information bit (RapidIO bit 7). This is shown in Figure 4-1. </P>

<P> </P>

<P>Each data character has a representation of the form Dx.y where x is the decimal value of the least significant 5 information bits EDCBA, and y is the decimal value of the most significant 3 information bits HGF as shown in Figure 4-1. Each special character has a similar representation of the form Kx.y. </P>

<P> </P>

<P> </P>

<P> </P>

<P>D25.3 </P>

<P>HGF EDCBA </P>

<P>011 11001 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_860.jpg"/>
</Figure>

<P>Y=3 </P>

<P> </P>

<P>X=25 </P>

<P> </P>

<P>Figure 4-1. Character Notation Example (D25.3) </P>

<P> </P>

<P>The output of the 8B/10B encoding process is a 10-bit code-group. The bits of a code-group are denoted with the letters &#8220;a&#8221; through &#8220;j&#8221;. The bits of a code-group are all of equal significance, there is no most significant or least significant bit. The ordering of the code-group bits is shown in Figure 4-2. </P>

<P> </P>

<P>The code-groups corresponding to the data character Dx.y is denoted by /Dx.y/. The code-groups corresponding to the special character Kx.y is denoted by /Kx.y/. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>/D25.3/ </P>

<P>abcdei fghj </P>

<P>100110 1100 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_861.jpg"/>
</Figure>

<P>Figure 4-2. Code-Group Notation Example (/D25.3/) </P>

<P> </P>

<P> </P>

<P>4.5.2  Running Disparity </P>

<P> </P>

<P>The 8B/10B encoding and decoding functions use a binary variable called running disparity. The variable can have a value of either positive (RD+) or negative (RD-). The encoder and decoder each have a running disparity variable for each lane which are all independent of each other. </P>

<P> </P>

<P>The primary use of running disparity in the encoding process is to keep track of whether the decoder has output more ones or more zeros. The current value of encoder running disparity is used to select the which unbalanced code-group will be used when the encoding for a character requires a choice between two unbalanced code-groups. </P>

<P> </P>

<P>Another use of running disparity in the decoding process is to detect errors. Given a value of decoder running disparity, only (256 + 12) = 268 of the 1024 possible code-group values have defined decodings. The remaining 756 possible code-group values have no defined decoding and represent errors, either in that code-group or in an earlier code-group. </P>

<P> </P>

<P> </P>

<P>4.5.3  Running Disparity Rules </P>

<P> </P>

<P>After power-up and before the port is operational, both the transmitter (encoder) and receiver (decoder) must establish current values of running disparity. </P>

<P> </P>

<P>The transmitter shall use a negative value as the initial value for the running disparity for each lane. </P>

<P> </P>

<P>The receiver may use either a negative or positive initial value of running disparity for each lane. </P>

<P> </P>

<P>The following algorithm shall be used for calculating the running disparity for each lane. In the encoder, the algorithm operates on the code-group that has just been generated by the encoder. In the receiver, the algorithm operates on the received code-group that has just been decoded by the decoder. </P>

<P> </P>

<P>Each code-group is divided to two sub-blocks as shown in Figure 4-2, where the first six bits (abcdei) form one sub-block (6-bit sub-block) and the second four bits (fghj) form a second sub-block (4-bit sub-block). Running disparity at the beginning of the 6-bit sub-block is the running disparity at the end of the preceding code-group. Running disparity at the beginning of the 4-bit sub-block is the running disparity at </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>the end of the preceding 6-bit sub-block. Running disparity at the end of the code-group is the running disparity at the end of the 4-bit sub-block. </P>

<P> </P>

<P>The sub-block running disparity shall be calculated as follows: </P>

<P> </P>

<P>1.  The running disparity is positive at the end of any sub-block if the sub-block contains more 1s than 0s. It is also positive at the end of a 4-bit sub-block if the sub-block has the value 0b0011 and at the end of a 6-bit sub-block if the sub-block has the value 0b000111. </P>

<P>2.  The running disparity is negative at the end of any sub-block if the sub-block contains more 0s than 1s. It is also negative at the end of a 4-bit sub-block if the sub-block has the value 0b1100 and at the end of a 6-bit sub-block if the sub-block has the value 0b111000. </P>

<P>3.  In all other cases, the value of the running disparity at the end of the </P>

<P>sub-block is running disparity at the beginning of the sub-block (the running disparity is unchanged). </P>

<P> </P>

<P> </P>

<P>4.5.4  8B/10B Encoding </P>

<P>The 8B/10B encoding function encodes 9-bit characters into 10-bit code-groups. The encodings for the 256 data characters (Dx.y) are specified in Table 4-1. The </P>

<P>encodings for the 12 special characters (Kx.y) are specified in Table 4-2. Both tables have two columns of encodings, one marked RD- and one marked RD+. When encoding a character, the code-group in the RD- column is selected if the current value of encoder running disparity is negative and the code-group in the RD+ column is selected if the current value of encoder running disparity is positive. </P>

<P> </P>

<P>Data characters (Dx.y) shall be encoded according to Table 4-1 and the current value of encoder running disparity. Special characters (Kx.y) shall be encoded according to Table 4-2 and the current value of encoder running disparity. After each character is encoded, the resulting code-group shall be used by the encoder to update the running disparity according to the rules in Section 4.5.3, &quot;Running Disparity Rules&quot;. </P>

<P> </P>

<P> </P>

<P>4.5.5  Transmission Order </P>

<P> </P>

<P>The parallel 10-bit code-group output of the encoder shall be serialized and transmitted with bit &#8220;a&#8221; transmitted first and a bit ordering of &#8220;abcdeifghj&#8221;. This is shown in Figure 4-3. </P>

<P> </P>

<P>Figure 4-3  gives  an  overview  of  a  character  passing  through  the  encoding, serializing, transmission, deserializing, and decoding processes. The left side of the figure shows the transmit process of encoding a character stream using 8B/10B encoding and the 10-bit serialization. The right side shows the reverse process of the receiver deserializing and using 8B/10B decoding on the received code-groups. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The dotted line shows the functional separation between the PCS layer, that provides </P>

<P>10-bit code-groups, and the PMA layer that serializes the code-groups. </P>

<P> </P>

<P>The drawing also shows on the receive side the bits of a special character containing the comma pattern that is used by the receiver to establish 10-bit code-boundary synchronization. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_862.jpg"/>
</Figure>

<P>MSB LSB MSB LSB </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_863.jpg"/>
</Figure>

<P>0 1 2 3 4 5 6 7 </P>

<P>0 1 2 3 4 5 6 7 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Input to the </P>

<P>ENCODE function </P>

<P>8 + control </P>

<P> </P>

<P>H G F E D C B A </P>

<P> </P>

<P>8 + control </P>

<P> </P>

<P>H G F E D C B A </P>

<P> </P>

<P>Output of the </P>

<P>DECODE function </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Output of the </P>

<P>ENCODE function </P>

<P>8B/10B Encoder </P>

<P> </P>

<P>10 </P>

<P> </P>

<P>a b c d e i f g h j </P>

<P> </P>

<P>PCS Layer </P>

<P>8B/10B Decoder </P>

<P> </P>

<P>10 </P>

<P>a b c d e i f g h j </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Input to the </P>

<P>DECODE function </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_864.jpg"/>
</Figure>

<P>0 0 1 1 1 1 1 x x x Aligned comma code-group </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_865.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_866.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_867.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_868.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_869.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_870.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_871.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_872.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_873.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_874.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_875.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_876.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_877.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_878.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_879.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_880.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_881.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_882.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_883.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_884.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_885.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_886.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_887.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_888.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_889.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_890.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_891.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_892.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_893.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_894.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_895.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Lane bitstream </P>

<P>Bit 0 transmitted first </P>

<P>0 1 2 3 4 5 6 7 8 9 </P>

<P>0 1 2 3 4 5 6 7 8 9 </P>

<P>Lane bitstream </P>

<P>Bit 0 received first </P>

<P>PMA Layer </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_896.jpg"/>
</Figure>

<P>Figure 4-3. Lane Encoding, Serialization, Deserialization, and Decoding Process </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_897.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>4.5.6  8B/10B Decoding </P>

<P> </P>

<P>The 8B/10B decoding function decodes received 10-bit code-groups into 9-bit characters and detects and reports received code-groups that have no defined decoding due to one or more transmission errors. </P>

<P> </P>

<P>The decoding function uses Table 4-1, Table 4-2 and the current value of the decoder running disparity. To decode a received code-group, the decoder shall select the RD- column of Table 4-1 and Table 4-2 if the current value of the decoder running disparity is negative or shall select the RD+ column if the value is positive. The decoder shall then compare the received code-group with the code-groups in the selected column of both tables. If a match is found in one of the tables, the code-group is defined to be a &#8220;valid&#8221; code-group and is decoded to the associated character. If no match is found, the code-group is defined to be an &#8220;invalid&#8221; code-group and is decoded to a character that is flagged in some manner as INVALID. After each code-group is decoded, the decoded code-group shall be used by the decoder to update the decoder running disparity according to the rules in Section 4.5.3, &quot;Running Disparity Rules&quot;. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-1. Data Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>abcdei fghj </P>
</TD>

<TD>
<P>abcdei fghj </P>
</TD>
</TR>

<TR>
<TD>
<P>D0.0 </P>
</TD>

<TD>
<P>00 </P>
</TD>

<TD>
<P>000 00000 </P>
</TD>

<TD>
<P>100111 0100 </P>
</TD>

<TD>
<P>011000 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D1.0 </P>
</TD>

<TD>
<P>01 </P>
</TD>

<TD>
<P>000 00001 </P>
</TD>

<TD>
<P>011101 0100 </P>
</TD>

<TD>
<P>100010 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D2.0 </P>
</TD>

<TD>
<P>02 </P>
</TD>

<TD>
<P>000 00010 </P>
</TD>

<TD>
<P>101101 0100 </P>
</TD>

<TD>
<P>010010 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D3.0 </P>
</TD>

<TD>
<P>03 </P>
</TD>

<TD>
<P>000 00011 </P>
</TD>

<TD>
<P>110001 1011 </P>
</TD>

<TD>
<P>110001 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D4.0 </P>
</TD>

<TD>
<P>04 </P>
</TD>

<TD>
<P>000 00100 </P>
</TD>

<TD>
<P>110101 0100 </P>
</TD>

<TD>
<P>001010 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D5.0 </P>
</TD>

<TD>
<P>05 </P>
</TD>

<TD>
<P>000 00101 </P>
</TD>

<TD>
<P>101001 1011 </P>
</TD>

<TD>
<P>101001 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D6.0 </P>
</TD>

<TD>
<P>06 </P>
</TD>

<TD>
<P>000 00110 </P>
</TD>

<TD>
<P>011001 1011 </P>
</TD>

<TD>
<P>011001 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D7.0 </P>
</TD>

<TD>
<P>07 </P>
</TD>

<TD>
<P>000 00111 </P>
</TD>

<TD>
<P>111000 1011 </P>
</TD>

<TD>
<P>000111 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D8.0 </P>
</TD>

<TD>
<P>08 </P>
</TD>

<TD>
<P>000 01000 </P>
</TD>

<TD>
<P>111001 0100 </P>
</TD>

<TD>
<P>000110 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D9.0 </P>
</TD>

<TD>
<P>09 </P>
</TD>

<TD>
<P>000 01001 </P>
</TD>

<TD>
<P>100101 1011 </P>
</TD>

<TD>
<P>100101 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D10.0 </P>
</TD>

<TD>
<P>0A </P>
</TD>

<TD>
<P>000 01010 </P>
</TD>

<TD>
<P>010101 1011 </P>
</TD>

<TD>
<P>010101 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D11.0 </P>
</TD>

<TD>
<P>0B </P>
</TD>

<TD>
<P>000 01011 </P>
</TD>

<TD>
<P>110100 1011 </P>
</TD>

<TD>
<P>110100 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D12.0 </P>
</TD>

<TD>
<P>0C </P>
</TD>

<TD>
<P>000 01100 </P>
</TD>

<TD>
<P>001101 1011 </P>
</TD>

<TD>
<P>001101 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D13.0 </P>
</TD>

<TD>
<P>0D </P>
</TD>

<TD>
<P>000 01101 </P>
</TD>

<TD>
<P>101100 1011 </P>
</TD>

<TD>
<P>101100 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D14.0 </P>
</TD>

<TD>
<P>0E </P>
</TD>

<TD>
<P>000 01110 </P>
</TD>

<TD>
<P>011100 1011 </P>
</TD>

<TD>
<P>011100 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D15.0 </P>
</TD>

<TD>
<P>0F </P>
</TD>

<TD>
<P>000 01111 </P>
</TD>

<TD>
<P>010111 0100 </P>
</TD>

<TD>
<P>101000 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D16.0 </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P>000 10000 </P>
</TD>

<TD>
<P>011011 0100 </P>
</TD>

<TD>
<P>100100 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D17.0 </P>
</TD>

<TD>
<P>11 </P>
</TD>

<TD>
<P>000 10001 </P>
</TD>

<TD>
<P>100011 1011 </P>
</TD>

<TD>
<P>100011 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D18.0 </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>000 10010 </P>
</TD>

<TD>
<P>010011 1011 </P>
</TD>

<TD>
<P>010011 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D19.0 </P>
</TD>

<TD>
<P>13 </P>
</TD>

<TD>
<P>000 10011 </P>
</TD>

<TD>
<P>110010 1011 </P>
</TD>

<TD>
<P>110010 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D20.0 </P>
</TD>

<TD>
<P>14 </P>
</TD>

<TD>
<P>000 10100 </P>
</TD>

<TD>
<P>001011 1011 </P>
</TD>

<TD>
<P>001011 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D21.0 </P>
</TD>

<TD>
<P>15 </P>
</TD>

<TD>
<P>000 10101 </P>
</TD>

<TD>
<P>101010 1011 </P>
</TD>

<TD>
<P>101010 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D22.0 </P>
</TD>

<TD>
<P>16 </P>
</TD>

<TD>
<P>000 10110 </P>
</TD>

<TD>
<P>011010 1011 </P>
</TD>

<TD>
<P>011010 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D23.0 </P>
</TD>

<TD>
<P>17 </P>
</TD>

<TD>
<P>000 10111 </P>
</TD>

<TD>
<P>111010 0100 </P>
</TD>

<TD>
<P>000101 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D24.0 </P>
</TD>

<TD>
<P>18 </P>
</TD>

<TD>
<P>000 11000 </P>
</TD>

<TD>
<P>110011 0100 </P>
</TD>

<TD>
<P>001100 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D25.0 </P>
</TD>

<TD>
<P>19 </P>
</TD>

<TD>
<P>000 11001 </P>
</TD>

<TD>
<P>100110 1011 </P>
</TD>

<TD>
<P>100110 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D26.0 </P>
</TD>

<TD>
<P>1A </P>
</TD>

<TD>
<P>000 11010 </P>
</TD>

<TD>
<P>010110 1011 </P>
</TD>

<TD>
<P>010110 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D27.0 </P>
</TD>

<TD>
<P>1B </P>
</TD>

<TD>
<P>000 11011 </P>
</TD>

<TD>
<P>110110 0100 </P>
</TD>

<TD>
<P>001001 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D28.0 </P>
</TD>

<TD>
<P>1C </P>
</TD>

<TD>
<P>000 11100 </P>
</TD>

<TD>
<P>001110 1011 </P>
</TD>

<TD>
<P>001110 0100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D29.0 </P>
</TD>

<TD>
<P>1D </P>
</TD>

<TD>
<P>000 11101 </P>
</TD>

<TD>
<P>101110 0100 </P>
</TD>

<TD>
<P>010001 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D30.0 </P>
</TD>

<TD>
<P>1E </P>
</TD>

<TD>
<P>000 11110 </P>
</TD>

<TD>
<P>011110 0100 </P>
</TD>

<TD>
<P>100001 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D31.0 </P>
</TD>

<TD>
<P>1F </P>
</TD>

<TD>
<P>000 11111 </P>
</TD>

<TD>
<P>101011 0100 </P>
</TD>

<TD>
<P>010100 1011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D0.1 </P>
</TD>

<TD>
<P>20 </P>
</TD>

<TD>
<P>001 00000 </P>
</TD>

<TD>
<P>100111 1001 </P>
</TD>

<TD>
<P>011000 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D1.1 </P>
</TD>

<TD>
<P>21 </P>
</TD>

<TD>
<P>001 00001 </P>
</TD>

<TD>
<P>011101 1001 </P>
</TD>

<TD>
<P>100010 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D2.1 </P>
</TD>

<TD>
<P>22 </P>
</TD>

<TD>
<P>001 00010 </P>
</TD>

<TD>
<P>101101 1001 </P>
</TD>

<TD>
<P>010010 1001 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-1. Data Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>abcdei fghj </P>
</TD>

<TD>
<P>abcdei fghj </P>
</TD>
</TR>

<TR>
<TD>
<P>D3.1 </P>
</TD>

<TD>
<P>23 </P>
</TD>

<TD>
<P>001 00011 </P>
</TD>

<TD>
<P>110001 1001 </P>
</TD>

<TD>
<P>110001 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D4.1 </P>
</TD>

<TD>
<P>24 </P>
</TD>

<TD>
<P>001 00100 </P>
</TD>

<TD>
<P>110101 1001 </P>
</TD>

<TD>
<P>001010 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D5.1 </P>
</TD>

<TD>
<P>25 </P>
</TD>

<TD>
<P>001 00101 </P>
</TD>

<TD>
<P>101001 1001 </P>
</TD>

<TD>
<P>101001 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D6.1 </P>
</TD>

<TD>
<P>26 </P>
</TD>

<TD>
<P>001 00110 </P>
</TD>

<TD>
<P>011001 1001 </P>
</TD>

<TD>
<P>011001 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D7.1 </P>
</TD>

<TD>
<P>27 </P>
</TD>

<TD>
<P>001 00111 </P>
</TD>

<TD>
<P>111000 1001 </P>
</TD>

<TD>
<P>000111 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D8.1 </P>
</TD>

<TD>
<P>28 </P>
</TD>

<TD>
<P>001 01000 </P>
</TD>

<TD>
<P>111001 1001 </P>
</TD>

<TD>
<P>000110 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D9.1 </P>
</TD>

<TD>
<P>29 </P>
</TD>

<TD>
<P>001 01001 </P>
</TD>

<TD>
<P>100101 1001 </P>
</TD>

<TD>
<P>100101 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D10.1 </P>
</TD>

<TD>
<P>2A </P>
</TD>

<TD>
<P>001 01010 </P>
</TD>

<TD>
<P>010101 1001 </P>
</TD>

<TD>
<P>010101 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D11.1 </P>
</TD>

<TD>
<P>2B </P>
</TD>

<TD>
<P>001 01011 </P>
</TD>

<TD>
<P>110100 1001 </P>
</TD>

<TD>
<P>110100 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D12.1 </P>
</TD>

<TD>
<P>2C </P>
</TD>

<TD>
<P>001 01100 </P>
</TD>

<TD>
<P>001101 1001 </P>
</TD>

<TD>
<P>001101 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D13.1 </P>
</TD>

<TD>
<P>2D </P>
</TD>

<TD>
<P>001 01101 </P>
</TD>

<TD>
<P>101100 1001 </P>
</TD>

<TD>
<P>101100 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D14.1 </P>
</TD>

<TD>
<P>2E </P>
</TD>

<TD>
<P>001 01110 </P>
</TD>

<TD>
<P>011100 1001 </P>
</TD>

<TD>
<P>011100 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D15.1 </P>
</TD>

<TD>
<P>2F </P>
</TD>

<TD>
<P>001 01111 </P>
</TD>

<TD>
<P>010111 1001 </P>
</TD>

<TD>
<P>101000 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D16.1 </P>
</TD>

<TD>
<P>30 </P>
</TD>

<TD>
<P>001 10000 </P>
</TD>

<TD>
<P>011011 1001 </P>
</TD>

<TD>
<P>100100 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D17.1 </P>
</TD>

<TD>
<P>31 </P>
</TD>

<TD>
<P>001 10001 </P>
</TD>

<TD>
<P>100011 1001 </P>
</TD>

<TD>
<P>100011 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D18.1 </P>
</TD>

<TD>
<P>32 </P>
</TD>

<TD>
<P>001 10010 </P>
</TD>

<TD>
<P>010011 1001 </P>
</TD>

<TD>
<P>010011 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D19.1 </P>
</TD>

<TD>
<P>33 </P>
</TD>

<TD>
<P>001 10011 </P>
</TD>

<TD>
<P>110010 1001 </P>
</TD>

<TD>
<P>110010 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D20.1 </P>
</TD>

<TD>
<P>34 </P>
</TD>

<TD>
<P>001 10100 </P>
</TD>

<TD>
<P>001011 1001 </P>
</TD>

<TD>
<P>001011 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D21.1 </P>
</TD>

<TD>
<P>35 </P>
</TD>

<TD>
<P>001 10101 </P>
</TD>

<TD>
<P>101010 1001 </P>
</TD>

<TD>
<P>101010 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D22.1 </P>
</TD>

<TD>
<P>36 </P>
</TD>

<TD>
<P>001 10110 </P>
</TD>

<TD>
<P>011010 1001 </P>
</TD>

<TD>
<P>011010 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D23.1 </P>
</TD>

<TD>
<P>37 </P>
</TD>

<TD>
<P>001 10111 </P>
</TD>

<TD>
<P>111010 1001 </P>
</TD>

<TD>
<P>000101 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D24.1 </P>
</TD>

<TD>
<P>38 </P>
</TD>

<TD>
<P>001 11000 </P>
</TD>

<TD>
<P>110011 1001 </P>
</TD>

<TD>
<P>001100 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D25.1 </P>
</TD>

<TD>
<P>39 </P>
</TD>

<TD>
<P>001 11001 </P>
</TD>

<TD>
<P>100110 1001 </P>
</TD>

<TD>
<P>100110 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D26.1 </P>
</TD>

<TD>
<P>3A </P>
</TD>

<TD>
<P>001 11010 </P>
</TD>

<TD>
<P>010110 1001 </P>
</TD>

<TD>
<P>010110 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D27.1 </P>
</TD>

<TD>
<P>3B </P>
</TD>

<TD>
<P>001 11011 </P>
</TD>

<TD>
<P>110110 1001 </P>
</TD>

<TD>
<P>001001 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D28.1 </P>
</TD>

<TD>
<P>3C </P>
</TD>

<TD>
<P>001 11100 </P>
</TD>

<TD>
<P>001110 1001 </P>
</TD>

<TD>
<P>001110 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D29.1 </P>
</TD>

<TD>
<P>3D </P>
</TD>

<TD>
<P>001 11101 </P>
</TD>

<TD>
<P>101110 1001 </P>
</TD>

<TD>
<P>010001 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D30.1 </P>
</TD>

<TD>
<P>3E </P>
</TD>

<TD>
<P>001 11110 </P>
</TD>

<TD>
<P>011110 1001 </P>
</TD>

<TD>
<P>100001 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D31.1 </P>
</TD>

<TD>
<P>3F </P>
</TD>

<TD>
<P>001 11111 </P>
</TD>

<TD>
<P>101011 1001 </P>
</TD>

<TD>
<P>010100 1001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D0.2 </P>
</TD>

<TD>
<P>40 </P>
</TD>

<TD>
<P>010 00000 </P>
</TD>

<TD>
<P>100111 0101 </P>
</TD>

<TD>
<P>011000 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D1.2 </P>
</TD>

<TD>
<P>41 </P>
</TD>

<TD>
<P>010 00001 </P>
</TD>

<TD>
<P>011101 0101 </P>
</TD>

<TD>
<P>100010 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D2.2 </P>
</TD>

<TD>
<P>42 </P>
</TD>

<TD>
<P>010 00010 </P>
</TD>

<TD>
<P>101101 0101 </P>
</TD>

<TD>
<P>010010 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D3.2 </P>
</TD>

<TD>
<P>43 </P>
</TD>

<TD>
<P>010 00011 </P>
</TD>

<TD>
<P>110001 0101 </P>
</TD>

<TD>
<P>110001 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D4.2 </P>
</TD>

<TD>
<P>44 </P>
</TD>

<TD>
<P>010 00100 </P>
</TD>

<TD>
<P>110101 0101 </P>
</TD>

<TD>
<P>001010 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D5.2 </P>
</TD>

<TD>
<P>45 </P>
</TD>

<TD>
<P>010 00101 </P>
</TD>

<TD>
<P>101001 0101 </P>
</TD>

<TD>
<P>101001 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D6.2 </P>
</TD>

<TD>
<P>46 </P>
</TD>

<TD>
<P>010 00110 </P>
</TD>

<TD>
<P>011001 0101 </P>
</TD>

<TD>
<P>011001 0101 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-1. Data Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>abcdei fghj </P>
</TD>

<TD>
<P>abcdei fghj </P>
</TD>
</TR>

<TR>
<TD>
<P>D7.2 </P>
</TD>

<TD>
<P>47 </P>
</TD>

<TD>
<P>010 00111 </P>
</TD>

<TD>
<P>111000 0101 </P>
</TD>

<TD>
<P>000111 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D8.2 </P>
</TD>

<TD>
<P>48 </P>
</TD>

<TD>
<P>010 01000 </P>
</TD>

<TD>
<P>111001 0101 </P>
</TD>

<TD>
<P>000110 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D9.2 </P>
</TD>

<TD>
<P>49 </P>
</TD>

<TD>
<P>010 01001 </P>
</TD>

<TD>
<P>100101 0101 </P>
</TD>

<TD>
<P>100101 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D10.2 </P>
</TD>

<TD>
<P>4A </P>
</TD>

<TD>
<P>010 01010 </P>
</TD>

<TD>
<P>010101 0101 </P>
</TD>

<TD>
<P>010101 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D11.2 </P>
</TD>

<TD>
<P>4B </P>
</TD>

<TD>
<P>010 01011 </P>
</TD>

<TD>
<P>110100 0101 </P>
</TD>

<TD>
<P>110100 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D12.2 </P>
</TD>

<TD>
<P>4C </P>
</TD>

<TD>
<P>010 01100 </P>
</TD>

<TD>
<P>001101 0101 </P>
</TD>

<TD>
<P>001101 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D13.2 </P>
</TD>

<TD>
<P>4D </P>
</TD>

<TD>
<P>010 01101 </P>
</TD>

<TD>
<P>101100 0101 </P>
</TD>

<TD>
<P>101100 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D14.2 </P>
</TD>

<TD>
<P>4E </P>
</TD>

<TD>
<P>010 01110 </P>
</TD>

<TD>
<P>011100 0101 </P>
</TD>

<TD>
<P>011100 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D15.2 </P>
</TD>

<TD>
<P>4F </P>
</TD>

<TD>
<P>010 01111 </P>
</TD>

<TD>
<P>010111 0101 </P>
</TD>

<TD>
<P>101000 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D16.2 </P>
</TD>

<TD>
<P>50 </P>
</TD>

<TD>
<P>010 10000 </P>
</TD>

<TD>
<P>011011 0101 </P>
</TD>

<TD>
<P>100100 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D17.2 </P>
</TD>

<TD>
<P>51 </P>
</TD>

<TD>
<P>010 10001 </P>
</TD>

<TD>
<P>100011 0101 </P>
</TD>

<TD>
<P>100011 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D18.2 </P>
</TD>

<TD>
<P>52 </P>
</TD>

<TD>
<P>010 10010 </P>
</TD>

<TD>
<P>010011 0101 </P>
</TD>

<TD>
<P>010011 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D19.2 </P>
</TD>

<TD>
<P>53 </P>
</TD>

<TD>
<P>010 10011 </P>
</TD>

<TD>
<P>110010 0101 </P>
</TD>

<TD>
<P>110010 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D20.2 </P>
</TD>

<TD>
<P>54 </P>
</TD>

<TD>
<P>010 10100 </P>
</TD>

<TD>
<P>001011 0101 </P>
</TD>

<TD>
<P>001011 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D21.2 </P>
</TD>

<TD>
<P>55 </P>
</TD>

<TD>
<P>010 10101 </P>
</TD>

<TD>
<P>101010 0101 </P>
</TD>

<TD>
<P>101010 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D22.2 </P>
</TD>

<TD>
<P>56 </P>
</TD>

<TD>
<P>010 10110 </P>
</TD>

<TD>
<P>011010 0101 </P>
</TD>

<TD>
<P>011010 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D23.2 </P>
</TD>

<TD>
<P>57 </P>
</TD>

<TD>
<P>010 10111 </P>
</TD>

<TD>
<P>111010 0101 </P>
</TD>

<TD>
<P>000101 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D24.2 </P>
</TD>

<TD>
<P>58 </P>
</TD>

<TD>
<P>010 11000 </P>
</TD>

<TD>
<P>110011 0101 </P>
</TD>

<TD>
<P>001100 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D25.2 </P>
</TD>

<TD>
<P>59 </P>
</TD>

<TD>
<P>010 11001 </P>
</TD>

<TD>
<P>100110 0101 </P>
</TD>

<TD>
<P>100110 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D26.2 </P>
</TD>

<TD>
<P>5A </P>
</TD>

<TD>
<P>010 11010 </P>
</TD>

<TD>
<P>010110 0101 </P>
</TD>

<TD>
<P>010110 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D27.2 </P>
</TD>

<TD>
<P>5B </P>
</TD>

<TD>
<P>010 11011 </P>
</TD>

<TD>
<P>110110 0101 </P>
</TD>

<TD>
<P>001001 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D28.2 </P>
</TD>

<TD>
<P>5C </P>
</TD>

<TD>
<P>010 11100 </P>
</TD>

<TD>
<P>001110 0101 </P>
</TD>

<TD>
<P>001110 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D29.2 </P>
</TD>

<TD>
<P>5D </P>
</TD>

<TD>
<P>010 11101 </P>
</TD>

<TD>
<P>101110 0101 </P>
</TD>

<TD>
<P>010001 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D30.2 </P>
</TD>

<TD>
<P>5E </P>
</TD>

<TD>
<P>010 11110 </P>
</TD>

<TD>
<P>011110 0101 </P>
</TD>

<TD>
<P>100001 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D31.2 </P>
</TD>

<TD>
<P>5F </P>
</TD>

<TD>
<P>010 11111 </P>
</TD>

<TD>
<P>101011 0101 </P>
</TD>

<TD>
<P>010100 0101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D0.3 </P>
</TD>

<TD>
<P>60 </P>
</TD>

<TD>
<P>011 00000 </P>
</TD>

<TD>
<P>100111 0011 </P>
</TD>

<TD>
<P>011000 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D1.3 </P>
</TD>

<TD>
<P>61 </P>
</TD>

<TD>
<P>011 00001 </P>
</TD>

<TD>
<P>011101 0011 </P>
</TD>

<TD>
<P>100010 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D2.3 </P>
</TD>

<TD>
<P>62 </P>
</TD>

<TD>
<P>011 00010 </P>
</TD>

<TD>
<P>101101 0011 </P>
</TD>

<TD>
<P>010010 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D3.3 </P>
</TD>

<TD>
<P>63 </P>
</TD>

<TD>
<P>011 00011 </P>
</TD>

<TD>
<P>110001 1100 </P>
</TD>

<TD>
<P>110001 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D4.3 </P>
</TD>

<TD>
<P>64 </P>
</TD>

<TD>
<P>011 00100 </P>
</TD>

<TD>
<P>110101 0011 </P>
</TD>

<TD>
<P>001010 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D5.3 </P>
</TD>

<TD>
<P>65 </P>
</TD>

<TD>
<P>011 00101 </P>
</TD>

<TD>
<P>101001 1100 </P>
</TD>

<TD>
<P>101001 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D6.3 </P>
</TD>

<TD>
<P>66 </P>
</TD>

<TD>
<P>011 00110 </P>
</TD>

<TD>
<P>011001 1100 </P>
</TD>

<TD>
<P>011001 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D7.3 </P>
</TD>

<TD>
<P>67 </P>
</TD>

<TD>
<P>011 00111 </P>
</TD>

<TD>
<P>111000 1100 </P>
</TD>

<TD>
<P>000111 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D8.3 </P>
</TD>

<TD>
<P>68 </P>
</TD>

<TD>
<P>011 01000 </P>
</TD>

<TD>
<P>111001 0011 </P>
</TD>

<TD>
<P>000110 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D9.3 </P>
</TD>

<TD>
<P>69 </P>
</TD>

<TD>
<P>011 01001 </P>
</TD>

<TD>
<P>100101 1100 </P>
</TD>

<TD>
<P>100101 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D10.3 </P>
</TD>

<TD>
<P>6A </P>
</TD>

<TD>
<P>011 01010 </P>
</TD>

<TD>
<P>010101 1100 </P>
</TD>

<TD>
<P>010101 0011 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-1. Data Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>abcdei fghj </P>
</TD>

<TD>
<P>abcdei fghj </P>
</TD>
</TR>

<TR>
<TD>
<P>D11.3 </P>
</TD>

<TD>
<P>6B </P>
</TD>

<TD>
<P>011 01011 </P>
</TD>

<TD>
<P>110100 1100 </P>
</TD>

<TD>
<P>110100 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D12.3 </P>
</TD>

<TD>
<P>6C </P>
</TD>

<TD>
<P>011 01100 </P>
</TD>

<TD>
<P>001101 1100 </P>
</TD>

<TD>
<P>001101 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D13.3 </P>
</TD>

<TD>
<P>6D </P>
</TD>

<TD>
<P>011 01101 </P>
</TD>

<TD>
<P>101100 1100 </P>
</TD>

<TD>
<P>101100 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D14.3 </P>
</TD>

<TD>
<P>6E </P>
</TD>

<TD>
<P>011 01110 </P>
</TD>

<TD>
<P>011100 1100 </P>
</TD>

<TD>
<P>011100 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D15.3 </P>
</TD>

<TD>
<P>6F </P>
</TD>

<TD>
<P>011 01111 </P>
</TD>

<TD>
<P>010111 0011 </P>
</TD>

<TD>
<P>101000 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D16.3 </P>
</TD>

<TD>
<P>70 </P>
</TD>

<TD>
<P>011 10000 </P>
</TD>

<TD>
<P>011011 0011 </P>
</TD>

<TD>
<P>100100 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D17.3 </P>
</TD>

<TD>
<P>71 </P>
</TD>

<TD>
<P>011 10001 </P>
</TD>

<TD>
<P>100011 1100 </P>
</TD>

<TD>
<P>100011 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D18.3 </P>
</TD>

<TD>
<P>72 </P>
</TD>

<TD>
<P>011 10010 </P>
</TD>

<TD>
<P>010011 1100 </P>
</TD>

<TD>
<P>010011 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D19.3 </P>
</TD>

<TD>
<P>73 </P>
</TD>

<TD>
<P>011 10011 </P>
</TD>

<TD>
<P>110010 1100 </P>
</TD>

<TD>
<P>110010 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D20.3 </P>
</TD>

<TD>
<P>74 </P>
</TD>

<TD>
<P>011 10100 </P>
</TD>

<TD>
<P>001011 1100 </P>
</TD>

<TD>
<P>001011 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D21.3 </P>
</TD>

<TD>
<P>75 </P>
</TD>

<TD>
<P>011 10101 </P>
</TD>

<TD>
<P>101010 1100 </P>
</TD>

<TD>
<P>101010 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D22.3 </P>
</TD>

<TD>
<P>76 </P>
</TD>

<TD>
<P>011 10110 </P>
</TD>

<TD>
<P>011010 1100 </P>
</TD>

<TD>
<P>011010 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D23.3 </P>
</TD>

<TD>
<P>77 </P>
</TD>

<TD>
<P>011 10111 </P>
</TD>

<TD>
<P>111010 0011 </P>
</TD>

<TD>
<P>000101 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D24.3 </P>
</TD>

<TD>
<P>78 </P>
</TD>

<TD>
<P>011 11000 </P>
</TD>

<TD>
<P>110011 0011 </P>
</TD>

<TD>
<P>001100 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D25.3 </P>
</TD>

<TD>
<P>79 </P>
</TD>

<TD>
<P>011 11001 </P>
</TD>

<TD>
<P>100110 1100 </P>
</TD>

<TD>
<P>100110 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D26.3 </P>
</TD>

<TD>
<P>7A </P>
</TD>

<TD>
<P>011 11010 </P>
</TD>

<TD>
<P>010110 1100 </P>
</TD>

<TD>
<P>010110 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D27.3 </P>
</TD>

<TD>
<P>7B </P>
</TD>

<TD>
<P>011 11011 </P>
</TD>

<TD>
<P>110110 0011 </P>
</TD>

<TD>
<P>001001 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D28.3 </P>
</TD>

<TD>
<P>7C </P>
</TD>

<TD>
<P>011 11100 </P>
</TD>

<TD>
<P>001110 1100 </P>
</TD>

<TD>
<P>001110 0011 </P>
</TD>
</TR>

<TR>
<TD>
<P>D29.3 </P>
</TD>

<TD>
<P>7D </P>
</TD>

<TD>
<P>011 11101 </P>
</TD>

<TD>
<P>101110 0011 </P>
</TD>

<TD>
<P>010001 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D30.3 </P>
</TD>

<TD>
<P>7E </P>
</TD>

<TD>
<P>011 11110 </P>
</TD>

<TD>
<P>011110 0011 </P>
</TD>

<TD>
<P>100001 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D31.3 </P>
</TD>

<TD>
<P>7F </P>
</TD>

<TD>
<P>011 11111 </P>
</TD>

<TD>
<P>101011 0011 </P>
</TD>

<TD>
<P>010100 1100 </P>
</TD>
</TR>

<TR>
<TD>
<P>D0.4 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 00000 </P>
</TD>

<TD>
<P>100111 0010 </P>
</TD>

<TD>
<P>011000 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D1.4 </P>
</TD>

<TD>
<P>81 </P>
</TD>

<TD>
<P>100 00001 </P>
</TD>

<TD>
<P>011101 0010 </P>
</TD>

<TD>
<P>100010 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D2.4 </P>
</TD>

<TD>
<P>82 </P>
</TD>

<TD>
<P>100 00010 </P>
</TD>

<TD>
<P>101101 0010 </P>
</TD>

<TD>
<P>010010 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D3.4 </P>
</TD>

<TD>
<P>83 </P>
</TD>

<TD>
<P>100 00011 </P>
</TD>

<TD>
<P>110001 1101 </P>
</TD>

<TD>
<P>110001 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D4.4 </P>
</TD>

<TD>
<P>84 </P>
</TD>

<TD>
<P>100 00100 </P>
</TD>

<TD>
<P>110101 0010 </P>
</TD>

<TD>
<P>001010 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D5.4 </P>
</TD>

<TD>
<P>85 </P>
</TD>

<TD>
<P>100 00101 </P>
</TD>

<TD>
<P>101001 1101 </P>
</TD>

<TD>
<P>101001 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D6.4 </P>
</TD>

<TD>
<P>86 </P>
</TD>

<TD>
<P>100 00110 </P>
</TD>

<TD>
<P>011001 1101 </P>
</TD>

<TD>
<P>011001 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D7.4 </P>
</TD>

<TD>
<P>87 </P>
</TD>

<TD>
<P>100 00111 </P>
</TD>

<TD>
<P>111000 1101 </P>
</TD>

<TD>
<P>000111 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D8.4 </P>
</TD>

<TD>
<P>88 </P>
</TD>

<TD>
<P>100 01000 </P>
</TD>

<TD>
<P>111001 0010 </P>
</TD>

<TD>
<P>000110 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D9.4 </P>
</TD>

<TD>
<P>89 </P>
</TD>

<TD>
<P>100 01001 </P>
</TD>

<TD>
<P>100101 1101 </P>
</TD>

<TD>
<P>100101 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D10.4 </P>
</TD>

<TD>
<P>8A </P>
</TD>

<TD>
<P>100 01010 </P>
</TD>

<TD>
<P>010101 1101 </P>
</TD>

<TD>
<P>010101 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D11.4 </P>
</TD>

<TD>
<P>8B </P>
</TD>

<TD>
<P>100 01011 </P>
</TD>

<TD>
<P>110100 1101 </P>
</TD>

<TD>
<P>110100 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D12.4 </P>
</TD>

<TD>
<P>8C </P>
</TD>

<TD>
<P>100 01100 </P>
</TD>

<TD>
<P>001101 1101 </P>
</TD>

<TD>
<P>001101 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D13.4 </P>
</TD>

<TD>
<P>8D </P>
</TD>

<TD>
<P>100 01101 </P>
</TD>

<TD>
<P>101100 1101 </P>
</TD>

<TD>
<P>101100 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D14.4 </P>
</TD>

<TD>
<P>8E </P>
</TD>

<TD>
<P>100 01110 </P>
</TD>

<TD>
<P>011100 1101 </P>
</TD>

<TD>
<P>011100 0010 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-1. Data Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>abcdei fghj </P>
</TD>

<TD>
<P>abcdei fghj </P>
</TD>
</TR>

<TR>
<TD>
<P>D15.4 </P>
</TD>

<TD>
<P>8F </P>
</TD>

<TD>
<P>100 01111 </P>
</TD>

<TD>
<P>010111 0010 </P>
</TD>

<TD>
<P>101000 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D16.4 </P>
</TD>

<TD>
<P>90 </P>
</TD>

<TD>
<P>100 10000 </P>
</TD>

<TD>
<P>011011 0010 </P>
</TD>

<TD>
<P>100100 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D17.4 </P>
</TD>

<TD>
<P>91 </P>
</TD>

<TD>
<P>100 10001 </P>
</TD>

<TD>
<P>100011 1101 </P>
</TD>

<TD>
<P>100011 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D18.4 </P>
</TD>

<TD>
<P>92 </P>
</TD>

<TD>
<P>100 10010 </P>
</TD>

<TD>
<P>010011 1101 </P>
</TD>

<TD>
<P>010011 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D19.4 </P>
</TD>

<TD>
<P>93 </P>
</TD>

<TD>
<P>100 10011 </P>
</TD>

<TD>
<P>110010 1101 </P>
</TD>

<TD>
<P>110010 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D20.4 </P>
</TD>

<TD>
<P>94 </P>
</TD>

<TD>
<P>100 10100 </P>
</TD>

<TD>
<P>001011 1101 </P>
</TD>

<TD>
<P>001011 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D21.4 </P>
</TD>

<TD>
<P>95 </P>
</TD>

<TD>
<P>100 10101 </P>
</TD>

<TD>
<P>101010 1101 </P>
</TD>

<TD>
<P>101010 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D22.4 </P>
</TD>

<TD>
<P>96 </P>
</TD>

<TD>
<P>100 10110 </P>
</TD>

<TD>
<P>011010 1101 </P>
</TD>

<TD>
<P>011010 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D23.4 </P>
</TD>

<TD>
<P>97 </P>
</TD>

<TD>
<P>100 10111 </P>
</TD>

<TD>
<P>111010 0010 </P>
</TD>

<TD>
<P>000101 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D24.4 </P>
</TD>

<TD>
<P>98 </P>
</TD>

<TD>
<P>100 11000 </P>
</TD>

<TD>
<P>110011 0010 </P>
</TD>

<TD>
<P>001100 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D25.4 </P>
</TD>

<TD>
<P>99 </P>
</TD>

<TD>
<P>100 11001 </P>
</TD>

<TD>
<P>100110 1101 </P>
</TD>

<TD>
<P>100110 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D26.4 </P>
</TD>

<TD>
<P>9A </P>
</TD>

<TD>
<P>100 11010 </P>
</TD>

<TD>
<P>010110 1101 </P>
</TD>

<TD>
<P>010110 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D27.4 </P>
</TD>

<TD>
<P>9B </P>
</TD>

<TD>
<P>100 11011 </P>
</TD>

<TD>
<P>110110 0010 </P>
</TD>

<TD>
<P>001001 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D28.4 </P>
</TD>

<TD>
<P>9C </P>
</TD>

<TD>
<P>100 11100 </P>
</TD>

<TD>
<P>001110 1101 </P>
</TD>

<TD>
<P>001110 0010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D29.4 </P>
</TD>

<TD>
<P>9D </P>
</TD>

<TD>
<P>100 11101 </P>
</TD>

<TD>
<P>101110 0010 </P>
</TD>

<TD>
<P>010001 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D30.4 </P>
</TD>

<TD>
<P>9E </P>
</TD>

<TD>
<P>100 11110 </P>
</TD>

<TD>
<P>011110 0010 </P>
</TD>

<TD>
<P>100001 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D31.4 </P>
</TD>

<TD>
<P>9F </P>
</TD>

<TD>
<P>100 11111 </P>
</TD>

<TD>
<P>101011 0010 </P>
</TD>

<TD>
<P>010100 1101 </P>
</TD>
</TR>

<TR>
<TD>
<P>D0.5 </P>
</TD>

<TD>
<P>A0 </P>
</TD>

<TD>
<P>101 00000 </P>
</TD>

<TD>
<P>100111 1010 </P>
</TD>

<TD>
<P>011000 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D1.5 </P>
</TD>

<TD>
<P>A1 </P>
</TD>

<TD>
<P>101 00001 </P>
</TD>

<TD>
<P>011101 1010 </P>
</TD>

<TD>
<P>100010 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D2.5 </P>
</TD>

<TD>
<P>A2 </P>
</TD>

<TD>
<P>101 00010 </P>
</TD>

<TD>
<P>101101 1010 </P>
</TD>

<TD>
<P>010010 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D3.5 </P>
</TD>

<TD>
<P>A3 </P>
</TD>

<TD>
<P>101 00011 </P>
</TD>

<TD>
<P>110001 1010 </P>
</TD>

<TD>
<P>110001 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D4.5 </P>
</TD>

<TD>
<P>A4 </P>
</TD>

<TD>
<P>101 00100 </P>
</TD>

<TD>
<P>110101 1010 </P>
</TD>

<TD>
<P>001010 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D5.5 </P>
</TD>

<TD>
<P>A5 </P>
</TD>

<TD>
<P>101 00101 </P>
</TD>

<TD>
<P>101001 1010 </P>
</TD>

<TD>
<P>101001 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D6.5 </P>
</TD>

<TD>
<P>A6 </P>
</TD>

<TD>
<P>101 00110 </P>
</TD>

<TD>
<P>011001 1010 </P>
</TD>

<TD>
<P>011001 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D7.5 </P>
</TD>

<TD>
<P>A7 </P>
</TD>

<TD>
<P>101 00111 </P>
</TD>

<TD>
<P>111000 1010 </P>
</TD>

<TD>
<P>000111 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D8.5 </P>
</TD>

<TD>
<P>A8 </P>
</TD>

<TD>
<P>101 01000 </P>
</TD>

<TD>
<P>111001 1010 </P>
</TD>

<TD>
<P>000110 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D9.5 </P>
</TD>

<TD>
<P>A9 </P>
</TD>

<TD>
<P>101 01001 </P>
</TD>

<TD>
<P>100101 1010 </P>
</TD>

<TD>
<P>100101 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D10.5 </P>
</TD>

<TD>
<P>AA </P>
</TD>

<TD>
<P>101 01010 </P>
</TD>

<TD>
<P>010101 1010 </P>
</TD>

<TD>
<P>010101 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D11.5 </P>
</TD>

<TD>
<P>AB </P>
</TD>

<TD>
<P>101 01011 </P>
</TD>

<TD>
<P>110100 1010 </P>
</TD>

<TD>
<P>110100 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D12.5 </P>
</TD>

<TD>
<P>AC </P>
</TD>

<TD>
<P>101 01100 </P>
</TD>

<TD>
<P>001101 1010 </P>
</TD>

<TD>
<P>001101 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D13.5 </P>
</TD>

<TD>
<P>AD </P>
</TD>

<TD>
<P>101 01101 </P>
</TD>

<TD>
<P>101100 1010 </P>
</TD>

<TD>
<P>101100 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D14.5 </P>
</TD>

<TD>
<P>AE </P>
</TD>

<TD>
<P>101 01110 </P>
</TD>

<TD>
<P>011100 1010 </P>
</TD>

<TD>
<P>011100 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D15.5 </P>
</TD>

<TD>
<P>AF </P>
</TD>

<TD>
<P>101 01111 </P>
</TD>

<TD>
<P>010111 1010 </P>
</TD>

<TD>
<P>101000 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D16.5 </P>
</TD>

<TD>
<P>B0 </P>
</TD>

<TD>
<P>101 10000 </P>
</TD>

<TD>
<P>011011 1010 </P>
</TD>

<TD>
<P>100100 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D17.5 </P>
</TD>

<TD>
<P>B1 </P>
</TD>

<TD>
<P>101 10001 </P>
</TD>

<TD>
<P>100011 1010 </P>
</TD>

<TD>
<P>100011 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D18.5 </P>
</TD>

<TD>
<P>B2 </P>
</TD>

<TD>
<P>101 10010 </P>
</TD>

<TD>
<P>010011 1010 </P>
</TD>

<TD>
<P>010011 1010 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-1. Data Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>abcdei fghj </P>
</TD>

<TD>
<P>abcdei fghj </P>
</TD>
</TR>

<TR>
<TD>
<P>D19.5 </P>
</TD>

<TD>
<P>B3 </P>
</TD>

<TD>
<P>101 10011 </P>
</TD>

<TD>
<P>110010 1010 </P>
</TD>

<TD>
<P>110010 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D20.5 </P>
</TD>

<TD>
<P>B4 </P>
</TD>

<TD>
<P>101 10100 </P>
</TD>

<TD>
<P>001011 1010 </P>
</TD>

<TD>
<P>001011 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D21.5 </P>
</TD>

<TD>
<P>B5 </P>
</TD>

<TD>
<P>101 10101 </P>
</TD>

<TD>
<P>101010 1010 </P>
</TD>

<TD>
<P>101010 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D22.5 </P>
</TD>

<TD>
<P>B6 </P>
</TD>

<TD>
<P>101 10110 </P>
</TD>

<TD>
<P>011010 1010 </P>
</TD>

<TD>
<P>011010 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D23.5 </P>
</TD>

<TD>
<P>B7 </P>
</TD>

<TD>
<P>101 10111 </P>
</TD>

<TD>
<P>111010 1010 </P>
</TD>

<TD>
<P>000101 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D24.5 </P>
</TD>

<TD>
<P>B8 </P>
</TD>

<TD>
<P>101 11000 </P>
</TD>

<TD>
<P>110011 1010 </P>
</TD>

<TD>
<P>001100 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D25.5 </P>
</TD>

<TD>
<P>B9 </P>
</TD>

<TD>
<P>101 11001 </P>
</TD>

<TD>
<P>100110 1010 </P>
</TD>

<TD>
<P>100110 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D26.5 </P>
</TD>

<TD>
<P>BA </P>
</TD>

<TD>
<P>101 11010 </P>
</TD>

<TD>
<P>010110 1010 </P>
</TD>

<TD>
<P>010110 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D27.5 </P>
</TD>

<TD>
<P>BB </P>
</TD>

<TD>
<P>101 11011 </P>
</TD>

<TD>
<P>110110 1010 </P>
</TD>

<TD>
<P>001001 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D28.5 </P>
</TD>

<TD>
<P>BC </P>
</TD>

<TD>
<P>101 11100 </P>
</TD>

<TD>
<P>001110 1010 </P>
</TD>

<TD>
<P>001110 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D29.5 </P>
</TD>

<TD>
<P>BD </P>
</TD>

<TD>
<P>101 11101 </P>
</TD>

<TD>
<P>101110 1010 </P>
</TD>

<TD>
<P>010001 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D30.5 </P>
</TD>

<TD>
<P>BE </P>
</TD>

<TD>
<P>101 11110 </P>
</TD>

<TD>
<P>011110 1010 </P>
</TD>

<TD>
<P>100001 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D31.5 </P>
</TD>

<TD>
<P>BF </P>
</TD>

<TD>
<P>101 11111 </P>
</TD>

<TD>
<P>101011 1010 </P>
</TD>

<TD>
<P>010100 1010 </P>
</TD>
</TR>

<TR>
<TD>
<P>D0.6 </P>
</TD>

<TD>
<P>C0 </P>
</TD>

<TD>
<P>110 00000 </P>
</TD>

<TD>
<P>100111 0110 </P>
</TD>

<TD>
<P>011000 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D1.6 </P>
</TD>

<TD>
<P>C1 </P>
</TD>

<TD>
<P>110 00001 </P>
</TD>

<TD>
<P>011101 0110 </P>
</TD>

<TD>
<P>100010 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D2.6 </P>
</TD>

<TD>
<P>C2 </P>
</TD>

<TD>
<P>110 00010 </P>
</TD>

<TD>
<P>101101 0110 </P>
</TD>

<TD>
<P>010010 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D3.6 </P>
</TD>

<TD>
<P>C3 </P>
</TD>

<TD>
<P>110 00011 </P>
</TD>

<TD>
<P>110001 0110 </P>
</TD>

<TD>
<P>110001 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D4.6 </P>
</TD>

<TD>
<P>C4 </P>
</TD>

<TD>
<P>110 00100 </P>
</TD>

<TD>
<P>110101 0110 </P>
</TD>

<TD>
<P>001010 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D5.6 </P>
</TD>

<TD>
<P>C5 </P>
</TD>

<TD>
<P>110 00101 </P>
</TD>

<TD>
<P>101001 0110 </P>
</TD>

<TD>
<P>101001 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D6.6 </P>
</TD>

<TD>
<P>C6 </P>
</TD>

<TD>
<P>110 00110 </P>
</TD>

<TD>
<P>011001 0110 </P>
</TD>

<TD>
<P>011001 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D7.6 </P>
</TD>

<TD>
<P>C7 </P>
</TD>

<TD>
<P>110 00111 </P>
</TD>

<TD>
<P>111000 0110 </P>
</TD>

<TD>
<P>000111 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D8.6 </P>
</TD>

<TD>
<P>C8 </P>
</TD>

<TD>
<P>110 01000 </P>
</TD>

<TD>
<P>111001 0110 </P>
</TD>

<TD>
<P>000110 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D9.6 </P>
</TD>

<TD>
<P>C9 </P>
</TD>

<TD>
<P>110 01001 </P>
</TD>

<TD>
<P>100101 0110 </P>
</TD>

<TD>
<P>100101 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D10.6 </P>
</TD>

<TD>
<P>CA </P>
</TD>

<TD>
<P>110 01010 </P>
</TD>

<TD>
<P>010101 0110 </P>
</TD>

<TD>
<P>010101 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D11.6 </P>
</TD>

<TD>
<P>CB </P>
</TD>

<TD>
<P>110 01011 </P>
</TD>

<TD>
<P>110100 0110 </P>
</TD>

<TD>
<P>110100 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D12.6 </P>
</TD>

<TD>
<P>CC </P>
</TD>

<TD>
<P>110 01100 </P>
</TD>

<TD>
<P>001101 0110 </P>
</TD>

<TD>
<P>001101 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D13.6 </P>
</TD>

<TD>
<P>CD </P>
</TD>

<TD>
<P>110 01101 </P>
</TD>

<TD>
<P>101100 0110 </P>
</TD>

<TD>
<P>101100 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D14.6 </P>
</TD>

<TD>
<P>CE </P>
</TD>

<TD>
<P>110 01110 </P>
</TD>

<TD>
<P>011100 0110 </P>
</TD>

<TD>
<P>011100 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D15.6 </P>
</TD>

<TD>
<P>CF </P>
</TD>

<TD>
<P>110 01111 </P>
</TD>

<TD>
<P>010111 0110 </P>
</TD>

<TD>
<P>101000 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D16.6 </P>
</TD>

<TD>
<P>D0 </P>
</TD>

<TD>
<P>110 10000 </P>
</TD>

<TD>
<P>011011 0110 </P>
</TD>

<TD>
<P>100100 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D17.6 </P>

<P> </P>

<P>D18.6 </P>

<P> </P>

<P>D19.6 </P>
</TD>

<TD>
<P>D1 </P>

<P> </P>

<P>D2 </P>

<P> </P>

<P>D3 </P>
</TD>

<TD>
<P>110 10001 </P>

<P> </P>

<P>110 10010 </P>

<P> </P>

<P>110 10011 </P>
</TD>

<TD>
<P>100011 0110 </P>

<P> </P>

<P>010011 0110 </P>

<P> </P>

<P>110010 0110 </P>
</TD>

<TD>
<P>100011 0110 </P>

<P> </P>

<P>010011 0110 </P>

<P> </P>

<P>110010 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D20.6 </P>
</TD>

<TD>
<P>D4 </P>
</TD>

<TD>
<P>110 10100 </P>
</TD>

<TD>
<P>001011 0110 </P>
</TD>

<TD>
<P>001011 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D21.6 </P>
</TD>

<TD>
<P>D5 </P>
</TD>

<TD>
<P>110 10101 </P>
</TD>

<TD>
<P>101010 0110 </P>
</TD>

<TD>
<P>101010 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D22.6 </P>
</TD>

<TD>
<P>D6 </P>
</TD>

<TD>
<P>110 10110 </P>
</TD>

<TD>
<P>011010 0110 </P>
</TD>

<TD>
<P>011010 0110 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-1. Data Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>abcdei fghj </P>
</TD>

<TD>
<P>abcdei fghj </P>
</TD>
</TR>

<TR>
<TD>
<P>D23.6 </P>
</TD>

<TD>
<P>D7 </P>
</TD>

<TD>
<P>110 10111 </P>
</TD>

<TD>
<P>111010 0110 </P>
</TD>

<TD>
<P>000101 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D24.6 </P>
</TD>

<TD>
<P>D8 </P>
</TD>

<TD>
<P>110 11000 </P>
</TD>

<TD>
<P>110011 0110 </P>
</TD>

<TD>
<P>001100 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D25.6 </P>
</TD>

<TD>
<P>D9 </P>
</TD>

<TD>
<P>110 11001 </P>
</TD>

<TD>
<P>100110 0110 </P>
</TD>

<TD>
<P>100110 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D26.6 </P>
</TD>

<TD>
<P>DA </P>
</TD>

<TD>
<P>110 11010 </P>
</TD>

<TD>
<P>010110 0110 </P>
</TD>

<TD>
<P>010110 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D27.6 </P>
</TD>

<TD>
<P>DB </P>
</TD>

<TD>
<P>110 11011 </P>
</TD>

<TD>
<P>110110 0110 </P>
</TD>

<TD>
<P>001001 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D28.6 </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>110 11100 </P>
</TD>

<TD>
<P>001110 0110 </P>
</TD>

<TD>
<P>001110 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D29.6 </P>
</TD>

<TD>
<P>DD </P>
</TD>

<TD>
<P>110 11101 </P>
</TD>

<TD>
<P>101110 0110 </P>
</TD>

<TD>
<P>010001 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D30.6 </P>
</TD>

<TD>
<P>DE </P>
</TD>

<TD>
<P>110 11110 </P>
</TD>

<TD>
<P>011110 0110 </P>
</TD>

<TD>
<P>100001 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D31.6 </P>
</TD>

<TD>
<P>DF </P>
</TD>

<TD>
<P>110 11111 </P>
</TD>

<TD>
<P>101011 0110 </P>
</TD>

<TD>
<P>010100 0110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D0.7 </P>
</TD>

<TD>
<P>E0 </P>
</TD>

<TD>
<P>111 00000 </P>
</TD>

<TD>
<P>100111 0001 </P>
</TD>

<TD>
<P>011000 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D1.7 </P>
</TD>

<TD>
<P>E1 </P>
</TD>

<TD>
<P>111 00001 </P>
</TD>

<TD>
<P>011101 0001 </P>
</TD>

<TD>
<P>100010 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D2.7 </P>
</TD>

<TD>
<P>E2 </P>
</TD>

<TD>
<P>111 00010 </P>
</TD>

<TD>
<P>101101 0001 </P>
</TD>

<TD>
<P>010010 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D3.7 </P>
</TD>

<TD>
<P>E3 </P>
</TD>

<TD>
<P>111 00011 </P>
</TD>

<TD>
<P>110001 1110 </P>
</TD>

<TD>
<P>110001 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D4.7 </P>
</TD>

<TD>
<P>E4 </P>
</TD>

<TD>
<P>111 00100 </P>
</TD>

<TD>
<P>110101 0001 </P>
</TD>

<TD>
<P>001010 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D5.7 </P>
</TD>

<TD>
<P>E5 </P>
</TD>

<TD>
<P>111 00101 </P>
</TD>

<TD>
<P>101001 1110 </P>
</TD>

<TD>
<P>101001 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D6.7 </P>
</TD>

<TD>
<P>E6 </P>
</TD>

<TD>
<P>111 00110 </P>
</TD>

<TD>
<P>011001 1110 </P>
</TD>

<TD>
<P>011001 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D7.7 </P>
</TD>

<TD>
<P>E7 </P>
</TD>

<TD>
<P>111 00111 </P>
</TD>

<TD>
<P>111000 1110 </P>
</TD>

<TD>
<P>000111 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D8.7 </P>
</TD>

<TD>
<P>E8 </P>
</TD>

<TD>
<P>111 01000 </P>
</TD>

<TD>
<P>111001 0001 </P>
</TD>

<TD>
<P>000110 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D9.7 </P>
</TD>

<TD>
<P>E9 </P>
</TD>

<TD>
<P>111 01001 </P>
</TD>

<TD>
<P>100101 1110 </P>
</TD>

<TD>
<P>100101 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D10.7 </P>
</TD>

<TD>
<P>EA </P>
</TD>

<TD>
<P>111 01010 </P>
</TD>

<TD>
<P>010101 1110 </P>
</TD>

<TD>
<P>010101 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D11.7 </P>
</TD>

<TD>
<P>EB </P>
</TD>

<TD>
<P>111 01011 </P>
</TD>

<TD>
<P>110100 1110 </P>
</TD>

<TD>
<P>110100 1000 </P>
</TD>
</TR>

<TR>
<TD>
<P>D12.7 </P>
</TD>

<TD>
<P>EC </P>
</TD>

<TD>
<P>111 01100 </P>
</TD>

<TD>
<P>001101 1110 </P>
</TD>

<TD>
<P>001101 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D13.7 </P>
</TD>

<TD>
<P>ED </P>
</TD>

<TD>
<P>111 01101 </P>
</TD>

<TD>
<P>101100 1110 </P>
</TD>

<TD>
<P>101100 1000 </P>
</TD>
</TR>

<TR>
<TD>
<P>D14.7 </P>
</TD>

<TD>
<P>EE </P>
</TD>

<TD>
<P>111 01110 </P>
</TD>

<TD>
<P>011100 1110 </P>
</TD>

<TD>
<P>011100 1000 </P>
</TD>
</TR>

<TR>
<TD>
<P>D15.7 </P>
</TD>

<TD>
<P>EF </P>
</TD>

<TD>
<P>111 01111 </P>
</TD>

<TD>
<P>010111 0001 </P>
</TD>

<TD>
<P>101000 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D16.7 </P>
</TD>

<TD>
<P>F0 </P>
</TD>

<TD>
<P>111 10000 </P>
</TD>

<TD>
<P>011011 0001 </P>
</TD>

<TD>
<P>100100 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D17.7 </P>
</TD>

<TD>
<P>F1 </P>
</TD>

<TD>
<P>111 10001 </P>
</TD>

<TD>
<P>100011 0111 </P>
</TD>

<TD>
<P>100011 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D18.7 </P>
</TD>

<TD>
<P>F2 </P>
</TD>

<TD>
<P>111 10010 </P>
</TD>

<TD>
<P>010011 0111 </P>
</TD>

<TD>
<P>010011 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D19.7 </P>
</TD>

<TD>
<P>F3 </P>
</TD>

<TD>
<P>111 10011 </P>
</TD>

<TD>
<P>110010 1110 </P>
</TD>

<TD>
<P>110010 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D20.7 </P>
</TD>

<TD>
<P>F4 </P>
</TD>

<TD>
<P>111 10100 </P>
</TD>

<TD>
<P>001011 0111 </P>
</TD>

<TD>
<P>001011 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D21.7 </P>
</TD>

<TD>
<P>F5 </P>
</TD>

<TD>
<P>111 10101 </P>
</TD>

<TD>
<P>101010 1110 </P>
</TD>

<TD>
<P>101010 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D22.7 </P>
</TD>

<TD>
<P>F6 </P>
</TD>

<TD>
<P>111 10110 </P>
</TD>

<TD>
<P>011010 1110 </P>
</TD>

<TD>
<P>011010 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D23.7 </P>
</TD>

<TD>
<P>F7 </P>
</TD>

<TD>
<P>111 10111 </P>
</TD>

<TD>
<P>111010 0001 </P>
</TD>

<TD>
<P>000101 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D24.7 </P>
</TD>

<TD>
<P>F8 </P>
</TD>

<TD>
<P>111 11000 </P>
</TD>

<TD>
<P>110011 0001 </P>
</TD>

<TD>
<P>001100 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D25.7 </P>
</TD>

<TD>
<P>F9 </P>
</TD>

<TD>
<P>111 11001 </P>
</TD>

<TD>
<P>100110 1110 </P>
</TD>

<TD>
<P>100110 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D26.7 </P>
</TD>

<TD>
<P>FA </P>
</TD>

<TD>
<P>111 11010 </P>
</TD>

<TD>
<P>010110 1110 </P>
</TD>

<TD>
<P>010110 0001 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-1. Data Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>abcdei fghj </P>
</TD>

<TD>
<P>abcdei fghj </P>
</TD>
</TR>

<TR>
<TD>
<P>D27.7 </P>
</TD>

<TD>
<P>FB </P>
</TD>

<TD>
<P>111 11011 </P>
</TD>

<TD>
<P>110110 0001 </P>
</TD>

<TD>
<P>001001 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D28.7 </P>
</TD>

<TD>
<P>FC </P>
</TD>

<TD>
<P>111 11100 </P>
</TD>

<TD>
<P>001110 1110 </P>
</TD>

<TD>
<P>001110 0001 </P>
</TD>
</TR>

<TR>
<TD>
<P>D29.7 </P>
</TD>

<TD>
<P>FD </P>
</TD>

<TD>
<P>111 11101 </P>
</TD>

<TD>
<P>101110 0001 </P>
</TD>

<TD>
<P>010001 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D30.7 </P>
</TD>

<TD>
<P>FE </P>
</TD>

<TD>
<P>111 11110 </P>
</TD>

<TD>
<P>011110 0001 </P>
</TD>

<TD>
<P>100001 1110 </P>
</TD>
</TR>

<TR>
<TD>
<P>D31.7 </P>
</TD>

<TD>
<P>FF </P>
</TD>

<TD>
<P>111 11111 </P>
</TD>

<TD>
<P>101011 0001 </P>
</TD>

<TD>
<P>010100 1110 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>Table 4-2. Special Character Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Character </P>

<P>Name </P>
</TD>

<TD>
<P> </P>

<P>Character Value (hex) </P>
</TD>

<TD>
<P> </P>

<P>Character Bits </P>

<P>HGF EDCBA </P>
</TD>

<TD>
<P> </P>

<P>Current RD &#8211; </P>
</TD>

<TD>
<P>Current RD &#61483;&#61472;</P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Notes </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P> </P>

<P>abcdei fghj </P>
</TD>

<TD>
<P> </P>

<P>abcdei fghj </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>K28.0 </P>
</TD>

<TD>
<P>1C </P>
</TD>

<TD>
<P>000 11100 </P>
</TD>

<TD>
<P>001111 0100 </P>
</TD>

<TD>
<P>110000 1011 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>K28.1 </P>
</TD>

<TD>
<P>3C </P>
</TD>

<TD>
<P>001 11100 </P>
</TD>

<TD>
<P>001111 1001 </P>
</TD>

<TD>
<P>110000 0110 </P>
</TD>

<TD>
<P>2,3 </P>
</TD>
</TR>

<TR>
<TD>
<P>K28.2 </P>
</TD>

<TD>
<P>5C </P>
</TD>

<TD>
<P>010 11100 </P>
</TD>

<TD>
<P>001111 0101 </P>
</TD>

<TD>
<P>110000 1010 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>K28.3 </P>
</TD>

<TD>
<P>7C </P>
</TD>

<TD>
<P>011 11100 </P>
</TD>

<TD>
<P>001111 0011 </P>
</TD>

<TD>
<P>110000 1100 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>K28.4 </P>
</TD>

<TD>
<P>9C </P>
</TD>

<TD>
<P>100 11100 </P>
</TD>

<TD>
<P>001111 0010 </P>
</TD>

<TD>
<P>110000 1101 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>K28.5 </P>
</TD>

<TD>
<P>BC </P>
</TD>

<TD>
<P>101 11100 </P>
</TD>

<TD>
<P>001111 1010 </P>
</TD>

<TD>
<P>110000 0101 </P>
</TD>

<TD>
<P>2 </P>
</TD>
</TR>

<TR>
<TD>
<P>K28.6 </P>
</TD>

<TD>
<P>DC </P>
</TD>

<TD>
<P>110 11100 </P>
</TD>

<TD>
<P>001111 0110 </P>
</TD>

<TD>
<P>110000 1001 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>K28.7 </P>
</TD>

<TD>
<P>FC </P>
</TD>

<TD>
<P>111 11100 </P>
</TD>

<TD>
<P>001111 1000 </P>
</TD>

<TD>
<P>110000 0111 </P>
</TD>

<TD>
<P>1,2 </P>
</TD>
</TR>

<TR>
<TD>
<P>K23.7 </P>
</TD>

<TD>
<P>F7 </P>
</TD>

<TD>
<P>111 10111 </P>
</TD>

<TD>
<P>111010 1000 </P>
</TD>

<TD>
<P>000101 0111 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>K27.7 </P>
</TD>

<TD>
<P>FB </P>
</TD>

<TD>
<P>111 11011 </P>
</TD>

<TD>
<P>110110 1000 </P>
</TD>

<TD>
<P>001001 0111 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>K29.7 </P>
</TD>

<TD>
<P>FD </P>
</TD>

<TD>
<P>111 11101 </P>
</TD>

<TD>
<P>101110 1000 </P>
</TD>

<TD>
<P>010001 0111 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>K30.7 </P>
</TD>

<TD>
<P>FE </P>
</TD>

<TD>
<P>111 11110 </P>
</TD>

<TD>
<P>011110 1000 </P>
</TD>

<TD>
<P>100001 0111 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Notes </P>

<P>1. Reserved code-group. </P>

<P>2. The code-group contain a comma. </P>

<P>3. A Reserved code-group for Idle Sequence 1 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The &#8220;comma&#8221; is an important element of 8B/10B encoding. A comma is a pattern of </P>

<P>7 bits that is used by receivers to acquire code-group boundary alignment. Two commas patterns are defined, 0b0011111 (comma+) and 0b1100000 (comma-). The pattern occurs in bits abcdeif of the special characters K28.1, K28.5 and K28.7. Within the code-group set, it is a singular bit pattern, which, in the absence of transmission errors, cannot appear in any other location of a code-group and cannot be generated across the boundaries of any two adjacent code-groups with the following exception: </P>

<P>The /K28.7/ special code-group when followed by any of the data </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 69 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>code-groups /D3.y/, /D11.y/, /D12.y/, /D19.y/, /D20.y/, /D28.y/, or </P>

<P>/K28.y/, where y is an integer in the range 0 through 7, may (depending on the value of running disparity) cause a comma to be generated across the boundary of the two code-groups. A comma that is generated across the boundary between two adjacent code-groups may cause the receiver to change the 10-bit code-group alignment. As a result, the /K28.7/ special code-group may be used for test and diagnostic purposes only. </P>

<P> </P>

<P> </P>

<P>4.5.7  Special Characters and Columns </P>

<P> </P>

<P>Table 4-3 defines the special characters and columns of special characters used by </P>

<P>LP-Serial links. Special characters are used for the following functions: </P>

<P> </P>

<P>1.  Alignment to code-group (10-bit) boundaries on lane-by-lane basis. </P>

<P>2.  Alignment of the receive data stream across N lanes. </P>

<P>3.  Marking the start of the IDLE2 CS field </P>

<P>4.  Clock rate compensation between receiver and transmitter. </P>

<P>5.  Control symbol delimiting. </P>

<P> </P>

<P>Table 4-3. Special Characters and Columns </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Code-Group/Column </P>

<P>Designation </P>
</TD>

<TD>
<P>Code-Group/Column </P>

<P>Use </P>
</TD>

<TD>
<P>Number of </P>

<P>Code-groups </P>
</TD>

<TD>
<P> </P>

<P>Encoding </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>Packet_Delimiter Control </P>

<P>Symbol </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>/K28.3/ </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>Start_of_Control_Symbol </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>/K28.0/ </P>
</TD>
</TR>

<TR>
<TD>
<P>/K/ </P>
</TD>

<TD>
<P>Sync </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>/K28.5/ </P>
</TD>
</TR>

<TR>
<TD>
<P>/R/ </P>
</TD>

<TD>
<P>Skip </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>/K29.7/ </P>
</TD>
</TR>

<TR>
<TD>
<P>/A/ </P>
</TD>

<TD>
<P>Align </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>/K27.7/ </P>
</TD>
</TR>

<TR>
<TD>
<P>/M/ </P>
</TD>

<TD>
<P>Mark </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>/K28.1/ </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>Idle </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>||K|| </P>
</TD>

<TD>
<P>Sync column </P>
</TD>

<TD>
<P>N </P>
</TD>

<TD>
<P>a column of /K28.5/ </P>
</TD>
</TR>

<TR>
<TD>
<P>||R|| </P>
</TD>

<TD>
<P>Skip column </P>
</TD>

<TD>
<P>N </P>
</TD>

<TD>
<P>a coulmn of /K29.7/ </P>
</TD>
</TR>

<TR>
<TD>
<P>||A|| </P>
</TD>

<TD>
<P>Align column </P>
</TD>

<TD>
<P>N </P>
</TD>

<TD>
<P>a column of /K27.7/ </P>
</TD>
</TR>

<TR>
<TD>
<P>||M| </P>
</TD>

<TD>
<P>Mark column </P>
</TD>

<TD>
<P>N </P>
</TD>

<TD>
<P>a column of /K28.1/ </P>
</TD>
</TR>

<TR>
<TD>
<P>||I|| </P>
</TD>

<TD>
<P>Idle column </P>
</TD>

<TD>
<P>N </P>
</TD>

<TD>
<P>a column of Idle </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.5.7.1  Packet Delimiter Control Symbol (/PD/) </P>

<P> </P>

<P>PD and /PD/ are aliases for respectively the K28.3 character and the /K28.3/ code-group which are used to delimit a control symbol that contains a packet delimiter. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>70 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>4.5.7.2  Start of Control Symbol (/SC/) </P>

<P> </P>

<P>SC and /SC/ are aliases for respectively the K28.0 character and the /K28.0/ code-group which are used to delimit a control symbol that does not contain a packet delimiter. </P>

<P> </P>

<P>4.5.7.3  Idle (/I/) </P>

<P> </P>

<P>I and /I/ are aliases for respectively any of the idle sequence characters and idle sequence code-groups. </P>

<P> </P>

<P>4.5.7.4  Sync (/K/) </P>

<P> </P>

<P>K  and  /K/  are  aliases  for  respectively  the  K28.5  character  and  the  /K28.5/ code-group which are used in idle sequences to provide the receiver with the information it requires to achieve and maintain bit and 10-bit code-group boundary synchronization. /K28.5/ was selected as the Sync character as it contains the comma pattern in bits abcdeif which is required to locate the code-group boundaries and it provides the maximum number of transitions in bits ghj. </P>

<P> </P>

<P>4.5.7.5  Skip (/R/) </P>

<P> </P>

<P>R and /R/ are aliases for respectively the K29.7 character and the /K29.7/ code-group which are used in the idle sequences and in the clock compensation sequence. </P>

<P> </P>

<P>4.5.7.6  Align (/A/) </P>

<P> </P>

<P>A  and  /A/  are  aliases  for  respectively  the  K27.7  character  and  the  /K27.7/ code-group which are used in idle sequences and for lane alignment on links operating in Nx mode. </P>

<P> </P>

<P>4.5.7.7  Mark (/M/) </P>

<P> </P>

<P>M  and  /M/  are  aliases  for  respectively the  K28.1  character  and  the  /K28.1/ code-group which are used in Idle Sequence 2 to provide the receiver with the information it requires to achieve and maintain 10-bit code-group boundary synchronization and to mark the location of the Idle frame CS field. </P>

<P> </P>

<P>4.5.7.8  Illegal </P>

<P> </P>

<P>A special character and its associated code-group that is defined by the 8B/10B code, but not specified for use by the LP-Serial protocol are declared to be an &#8220;illegal&#8221; character and &#8220;illegal&#8221; code-group respectively. The special characters K23.7, K28.2, K28.4, K28.6, K28.7 and K30.7 are illegal characters, and if a link is operating with Idle Sequence 1, K28.1 is also an illegal character. </P>

<P> </P>

<P> </P>

<P>4.5.8  Effect of Single Bit Code-Group Errors </P>

<P> </P>

<P>Except  in  receivers  using  decision  feedback  equalization  (DFE),  single  bit code-group errors  will  be  the  dominant code-group error  by  many  orders  of </P>

<P> </P>

<P>RapidIO Trade Association 71 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>magnitude. It is therefore useful to know the variety of code-group corruptions that can be caused by a single bit error. </P>

<P> </P>

<P>Table 4-4 lists all possible code-group corruptions that can be caused by a single-bit error. The notation /X/ =&gt; /Y/ means that the code-group for the character X has been corrupted by a single-bit error into the code-group for the character Y. If the corruption results in a code-group that is invalid for the current receiver running disparity, the notation /X/ =&gt; /INVALID/ is used. The table provides the information required to deterministically detect all isolated single bit transmission errors on links operating with idle sequence 1 and short control symbols. </P>

<P> </P>

<P>Table 4-4. Code-Group Corruption Caused by Single Bit Errors </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Corruption </P>
</TD>

<TD>
<P>Detection on links using idle sequence 1 and short control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ =&gt; /INVALID/ </P>
</TD>

<TD>
<P>Detectable as an error when decoding the code-group. </P>

<P>When this error occurs within a packet, it is indistinguishable from a </P>

<P>/Dx.y/ =&gt; /INVALID/. </P>

<P>When this error occurs outside of a packet, the type of error can be inferred from whether the /INVALID/ is followed by the three /Dx.y/ that comprise the control symbol data. </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ =&gt; /INVALID/ </P>
</TD>

<TD>
<P>Detectable as an error when decoding the code-group. </P>

<P>When this error occurs within a packet, it is indistinguishable from a </P>

<P>/Dx.y/ =&gt; /INVALID/. </P>

<P>When this error occurs outside of a packet, the type of error can be inferred from whether the /INVALID/ is followed by the three /Dx.y/ that comprise the control symbol data. </P>
</TD>
</TR>

<TR>
<TD>
<P>/A/, /K/ or /R/ =&gt; /Dx.y/ </P>
</TD>

<TD>
<P>Detectable as an error as /Dx.y/ is illegal outside of a packet or control symbol and /A/, /K/ and /R/ are illegal within a packet or control symbol. </P>
</TD>
</TR>

<TR>
<TD>
<P>/A/, /K/ or /R/ =&gt; /INVALID/ </P>
</TD>

<TD>
<P>Detectable as an error when decoding the code-group. </P>
</TD>
</TR>

<TR>
<TD>
<P>/Dx.y/ =&gt; /A/, /K/ or /R/ </P>
</TD>

<TD>
<P>Detectable as an error as /A/, /K/ and /R/ are illegal within a packet or control symbol and /Dx.y/ is illegal outside of a packet or control symbol. </P>
</TD>
</TR>

<TR>
<TD>
<P>/Dx.y/ =&gt; /INVALID/ </P>
</TD>

<TD>
<P>Detectable as an error when decoding the code-group. </P>
</TD>
</TR>

<TR>
<TD>
<P>/Dx.y/ =&gt; /Du.v/ </P>
</TD>

<TD>
<P>Detectable as an error by the packet or control symbol CRC. The error will also result in a subsequent unerrored code-group being decoded as INVALID, but that resulting INVALID code-group may occur an arbitrary number of code-groups after the errored code-group. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.6 LP-Serial Link Widths </P>

<P> </P>

<P>LP-Serial links may have 1, 2, 4, 8, or 16 lanes per direction. All LP-Serial ports shall support operation on links with one lane per direction (1x mode) and may optionally support operation over links with 2, 4, 8 and/or 16 lanes per direction (respectively 2x mode, 4x mode, 8x mode and 16x mode). For example, a port that supports operation over 8 lanes per direction (8x mode) must also support operation over one lane per direction (1x mode) and may optionally also support operation over 2 and/or 4 lanes per direction (2x mode and/or 4x mode). The requirement that all LP-Serial ports support 1x mode is to ensure that any pair of LP-Serial ports that </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>are capable of operating at the same baud rate also support a common link width over which they can always communicate with each other. </P>

<P> </P>

<P>LP-Serial ports that support operation over two or more lanes per direction shall support 1x mode operation over two of those lanes, lane 0 and lane R (the redundancy lane). If the port supports operation over at most two lanes per direction (2x mode), lane R shall be lane 1. If the port supports operation over more than two lanes, lane R shall be lane 2. Requiring ports that support operation over links with two or more lanes per direction to also support 1x mode over two lanes per direction provides a redundant fallback capability that allows communication over the link at reduced bandwidth in the presence of lane failure, regardless of the lane that fails. </P>

<P> </P>

<P> </P>

<P>4.7 Idle Sequence </P>

<P> </P>

<P>An idle sequence is a sequence of characters, code-groups after 8B/10B encoding, that is transmitted by a LP-Serial port on each of its active output lanes when the port is not initialized and, when the port is initialized, there is nothing else to transmit. At a minimum, an idle sequence provides the information required by a LP-Serial receiver to acquire and retain bit, code-group and lane alignment and contains clock compensation sequences to support retimers. </P>

<P> </P>

<P>Two idles sequences are defined, Idle Sequence 1, which is referred to as IDLE1, and Idle sequence 2, which is referred to as IDLE2. Both sequences contain the /K/, </P>

<P>/A/ and /R/ special code-groups that are required respectively for establishing code-group and lane alignment in the LP-Serial receiver and providing clock compensation for retimers. </P>

<P> </P>

<P>IDLE1 was the first idle sequence defined for LP-Serial links and is unchanged from the IDLE specified in Rev. 1.3 of this specification. It is based on and is very similar to the idle sequence used by XAUI, an interconnect that is defined in Clause 47 of IEEE Standard 802.3. IDLE1 was designed for LP-Serial links operating at less than </P>

<P>5.5 GBaud per lane and transmitters and receivers that do not used adaptive equalization. IDLE1 provides only the minimum idle sequence functionality. </P>

<P> </P>

<P>IDLE2 was designed for LP-Serial links operating at greater than 5.5 GBaud and transmitters and receivers using adaptive equalization. In addition to the minimum idle sequence functionality, IDLE2 provides link width, lane identification and lane polarity information, randomized data for equalizer training and a command and status channel for receiver control of the transmit equalizer. </P>

<P> </P>

<P>When idle is transmitted by a LP-Serial port, an idle sequence shall be transmitted on each of the port&#8217;s active output lanes. Ports operating in Nx mode shall not stripe the idle sequence across the active lanes; there is an idle sequence for each of the N lanes. </P>

<P> </P>

<P>An uninitialized LP-Serial port (state variable port_initialized not asserted) shall continuously transmit an idle sequence on all active output lanes. An initialized </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>LP-Serial port (state variable port_initialized asserted) shall transmit an idle sequence on each of its active output lanes when there is nothing else to transmit. An idle sequence may not be inserted in a packet or control symbol. An initialized LP-Serial port that becomes uninitialized while transmitting a packet or control symbol may transmit several code-groups per lane of the packet and/or control symbol before beginning the transmission of an idle sequence. </P>

<P> </P>

<P>On links operating in 1x mode, the first code-group of the idle sequence shall immediately follow the last code-group of the preceding control symbol. When a link is operating in Nx mode, the first column of N idle code-groups shall immediately follow the column containing the last code-groups of the preceding control symbol. </P>

<P> </P>

<P> </P>

<P>4.7.1  Clock Compensation Sequence </P>

<P> </P>

<P>The &#8220;clock compensation sequence&#8221; is four character sequence comprised of a K special character immediately followed by three R special characters (K,R,R,R). Clock compensation sequences are transmitted as part of idle sequences. </P>

<P> </P>

<P>A port shall transmit a clock compensation sequence on each of its active output lanes at least once every 5000 characters transmitted per lane by the port. When a clock compensation sequence is transmitted, the entire 4 character sequence shall be transmitted. When transmitted by a port operating in Nx mode, the clock compensation sequence shall be transmitted in parallel on all N lanes resulting in the column sequence ||K||R||R||R||. </P>

<P> </P>

<P>Since a packet or delimited control symbol may not be interrupted by an idle sequence, it is recommended that a port transmit a clock compensation sequence on each of its active output lanes at least once every 4096 characters transmitted per lane by the port. This requirement implies that the flow of packets and delimited control symbols available from the upper layers can be interrupted long enough to transmit an idle sequence containing a clock compensation sequence. </P>

<P> </P>

<P>The compensation sequence allows retimers (discussed in Section 4.11) to compensate for up to a +/- 200 ppm difference between input bit rate and output bit rate. Both rates have a +/-100 ppm tolerance. It may also be used to allow the input side of an end point port to compensate for up to a +/-200 ppm difference between the input bit rate and the bit rate of the device core which may be running off a different clock. This is done by dropping or adding an /R/ immediately following a </P>

<P>/K/ in 1x mode or an ||R|| immediately following a ||K|| in Nx mode as needed to avoid overrun or underrun. </P>

<P> </P>

<P> </P>

<P>4.7.2  Idle Sequence 1 (IDLE1) </P>

<P> </P>

<P>Idle Sequence 1 is a sequence of the special characters A, K and R. The sequence is </P>

<P>8B/10B  encoded  before  transmission,  yielding  a  sequence  of  the  special code-groups /A/, /K/ and /R/ that is transmitted on the link. </P>

<P> </P>

<P>74 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The IDLE1 sequence shall comply with the following requirements: </P>

<P> </P>

<P>1.  Each instance of an IDLE1 sequence shall begin with the K special character. </P>

<P>2.  The second, third and fourth characters of each IDLE1 sequence may be the R special character. This allows the first four characters of an IDLE1 sequence to be K,R,R,R, the &#8220;clock compensation sequence&#8221;. </P>

<P>3.  Except when generating the clock compensation sequence, all characters following the first character of an IDLE1 shall be a randomly selected sequence of A, K and R special characters that is based on a pseudo-random sequence generator of 7th degree or greater and subject to minimum and maximum requirements on the spacing of the A special characters. The pseudo-random selection of characters in the idle sequence results in a sequence code-groups whose spectrum has no discrete lines which helps control the EMI of long idle sequences. </P>

<P>4.  The number of non-A special characters between A special characters within an IDLE1 sequence shall be no less than 16 and no more than 31. The number shall be pseudo-randomly selected based on a pseudo-random sequence generator of 7th degree of greater. Ideally, the number of non-A characters separating A characters should be uniformly distributed across the range of </P>

<P>16 through 31. However, the IDLE1 spectrum appears to be relatively insensitive to the actual distribution. </P>

<P>5.  The requirement on the number of characters between successive A special characters should be maintained between successive IDLE1 sequences to ensure that two successive A special characters are always separated by at least 16 non-A characters. </P>

<P>6.  Except when transmitting a clock compensation sequence, an IDLE1 sequence may be of any length and may be terminated after any code-group. </P>

<P>7.  Each instance of IDLE1 shall be a new IDLE1 sequence that is unrelated to any previous IDLE1 sequence. Once transmission of an IDLE1 sequence has begun, the sequence may only be terminated. It may not be interrupted or stalled and then continued later. </P>

<P>8.  When a port transmitting IDLE1 is operating in Nx mode, the port shall transmit the identical sequence of A, K and R special characters in parallel on each of the N lanes and the N idle sequences shall be aligned across the lanes such that the initial /K/ of the N sequences shall all occur in the same column and the last code-group of the N sequences shall all occur in the same column. As a result, the IDLE1 sequence will appear as a sequence of the columns </P>

<P>||K||, ||R|| and ||A|| at the transmitter output. </P>

<P> </P>

<P> </P>

<P>4.7.3  Idle Sequence 1 Generation </P>

<P> </P>

<P>A primitive polynomial of at least 7th degree is recommended as the generating polynomial for the pseudo-random sequence that is used in the generation of the idle sequence. The polynomials x7 + x6 + 1 and x7 + x3 + 1 are examples of primitive 7th </P>

<P> </P>

<P>RapidIO Trade Association 75 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>degree   polynomials   which   may   be   used   as   generator   polynomials.  The pseudo-random sequence generator is clocked (generates a new pseudo-random sequence  value)  once  per  idle  sequence  code-group  (column).  Four  of  the pseudo-random sequence generator state bits may be selected to generate the pseudo-random value for /A/ spacing. The selection of the state bits and their weighting has a significant effect of the distribution of values for /A/ spacing. Any other state bit or logical function of state bits may be selected as the /K/ vs. /R/ selector. </P>

<P> </P>

<P>Figure 4-4 shows an example circuit illustrating how this may be done. The clock ticks whenever a code-group or column is transmitted. Send_idle is asserted whenever an idle sequence begins. The equations indicate the states in which to transmit the indicated idle code-group, except when the compensation sequence is being transmitted. Any equivalent method is acceptable. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>clock </P>

<P>pseudo_random_integer_generator </P>

<P>pseudo_random_bit </P>

<P>Q  Q  Q </P>

<P>Q  Q  Q  Q </P>

<P> </P>

<P> </P>

<P> </P>

<P>1 </P>

<P>msb </P>

<P> </P>

<P>D   D </P>

<P> </P>

<P>lsb </P>

<P> </P>

<P>D  D  D </P>

<P> </P>

<P>LOAD </P>

<P>down_counter </P>

<P>Q  Q  Q  Q  Q </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Acntr_eq_zero </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>D  Q </P>

<P> </P>

<P>send_idle </P>

<P>send_idle_dlyd </P>

<P> </P>

<P> </P>

<P>send_idle </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_898.jpg"/>
</Figure>

<P>send_K = send_idle &amp; (!send_idle_dlyd | send_idle_dlyd &amp; !Acntr_eq_zero &amp; pseudo_random_bit) </P>

<P>send_A = send_idle &amp; send_idle_dlyd &amp; Acntr_eq_zero </P>

<P>send_R = send_idle &amp; send_idle_dlyd &amp; !Acntr_eq_zero &amp; !pseudo_random_bit </P>

<P> </P>

<P> </P>

<P>Figure 4-4. Example of a Pseudo-Random Idle Code-Group Generator </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>76 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>4.7.4  Idle Sequence 2 (IDLE2) </P>

<P> </P>

<P>IDLE 2 is a sequence of data characters and the special characters A, K, M and R. The character sequence is 8B/10B encoded before transmission, yielding a sequence of data code-groups and the special /A/, /K/, /M/ and /R/ code-groups that are transmitted on the link. </P>

<P> </P>

<P>The IDLE sequence 2 shall be comprised of a continuous sequence of idle frames and clock compensation sequences. Subject to the following requirements, the exact order of idle frames and clock compensation sequences in an IDLE 2 sequence is implementation dependent. </P>

<P>1.  The minimum clock compensation sequence density (clock compensation sequences per characters transmitted per lane) shall comply with the requirements specified in Section 4.7.1, &quot;Clock Compensation Sequence&quot;. </P>

<P>2.  Each clock compensation sequence shall be followed by an idle frame. </P>

<P> </P>

<P>3.  Each idle frame shall be followed by either a clock compensation sequence or another idle frame. </P>

<P>4.  When a port is operating in Nx mode, the sequence of clock compensation sequences and idle frames shall be the same for all N lanes. </P>

<P> </P>

<P>After a port using IDLE2 is initialized (the port initialization state variable port_initialized is asserted), the port may terminate an IDLE2 sequence after any character of an idle frame to transmit a control symbol or a SYNC sequence immediately followed by a link-request control symbol subject to the following requirements: </P>

<P> </P>

<P>1.  Each M special character transmitted that is part of the idle frame random data field shall be followed by a minimum of four (4) random data field random data characters. </P>

<P>2.  The sequence of four (4) M special characters at the beginning of a CS field marker shall not be truncated. </P>

<P>3.  A port operating in Nx mode shall terminate an IDLE2 sequence at exactly the same character position in the sequence for each of the N lanes. </P>

<P> </P>

<P>Each instance of IDLE2 shall be a new IDLE2 sequence that is unrelated to any previous IDLE2 sequence. Once transmission of an IDLE2 sequence has begun, the sequence may only be terminated. It may not be interrupted or stalled and then continued later. </P>

<P> </P>

<P>When a port transmitting IDLE2 is operating in Nx mode, the port shall transmit IDLE2 sequences in parallel on each of the N lanes. The sequences will be similar, but not identical because the information carried in the CS Field Marker will differ from lane to lane and the information carried in the CS Field may also differ from lane to lane. The IDLE2 sequences transmitted on each of the N lanes shall be aligned across the lanes such that the first character of the N idle sequences shall all occur in the same column and the last character of the N idle sequences shall all </P>

<P> </P>

<P>RapidIO Trade Association 77 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>occur in the same column. As a result, the IDLE2 sequence will appear at the transmitter output as a sequence of the columns ||K||, ||R||, ||M|| and ||A|| and columns containing only data code-groups. </P>

<P> </P>

<P>4.7.4.1  Idle Frame </P>

<P> </P>

<P>Each idle frame shall be composed of three parts, a random data field, a command and status (CS) field marker and an encoded CS field as shown in Figure 4-5. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>random data field </P>

<P>509-515 characters </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_899.jpg"/>
</Figure>

<P>CS field marker </P>

<P>8 characters </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_900.jpg"/>
</Figure>

<P>encoded CS field </P>

<P>32 characters </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_901.jpg"/>
</Figure>

<P> </P>

<P>Figure 4-5. Idle Sequence 2 Idle Frame </P>

<P> </P>

<P>4.7.4.1.1  IDLE Sequence 2 Random Data Field </P>

<P> </P>

<P>The IDLE2 random data field shall contain pseudo-random data characters and the A and M special characters. The total length of the random data field shall be no less than 509 and no more than 515 characters. The idle field shall comply with the following requirements. </P>

<P>1.  Unless otherwise specified, the characters comprising the random data field shall be pseudo-random data characters. </P>

<P>2.  The random data field of an idle frame that immediately follows a clock compensation sequence shall begin with a M special character. Otherwise, the random data field of an idle frame shall begin with a pseudo-random data character. </P>

<P>3.  Unless otherwise specified, the pseudo-random data characters in the random data field shall occur in contiguous sequences of not less than 16 and no more than 31 pseudo-random characters. The length of each contiguous sequence shall be pseudo-randomly selected. The lengths of the contiguous sequences should be uniformly distributed across the range of 16 to 31 characters. Adjacent contiguous sequences shall be separated by a single A or M special character. Each separator shall be pseudo-randomly selected. The probability of selecting the A or M special character for a given separator should be equal. The last four (4) characters of the random data field shall be </P>

<P>pseudo-random data characters. The length of the first contiguous sequence of pseudo-random characters in the random data field shall be no less than 16 and no more than 35 characters. The length of the last contiguous sequence of pseudo-random characters in the random data field shall be no less than 4 and no more than 35 characters. </P>

<P> </P>

<P>78 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>4.  Each random data field that is transmitted on a given lane of a link shall be generated by first generating a prototype random data field using the above rules, but with a D0.0 character in the place of each pseudo-random data character, and then scrambling the prototype random data field with the transmit scrambler for that lane. The scrambling shall be done in exactly the same manner as packet and control symbol data characters are scrambled. The scrambler, the scrambling method and the scrambling rules are specified in Section 4.8.1, &quot;Scrambling Rules&quot;. </P>

<P>5.  When a port is operating in Nx mode, the location A or M special characters in a random data field shall be identical for all N lanes. If the kth character of a random data field transmitted on lane 0 is an A (M) special character, the kth character of the random data fields transmitted on lanes 1 through N-1 is also an A (M) special character. </P>

<P> </P>

<P>Generating the random data field pseudo-random data characters by scrambling D0.0 characters results in the output serial random data bit stream being the scrambling sequence. This allows the receiver to recover the descrambler seed from the received idle frame random data field. It also allows the receiver to verify that the lane descramblers are synchronized to the incoming data stream. If a lane descrambler is correctly synchronized, the pseudo-random data characters in the idle frame random data field will all descramble to D0.0 characters. </P>

<P> </P>

<P>4.7.4.1.2  IDLE Sequence 2 CS Field Marker </P>

<P> </P>

<P>The CS field marker indicates the beginning of the command and status (CS) field and provides information about the link polarity, link width and lane numbering. </P>

<P> </P>

<P>The CS field marker shall be the 8 character sequence </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_902.jpg"/>
</Figure>

<P>M, M, M, M, D21.5, Dx.y, D21.5, Dx.y </P>

<P> </P>

<P>where </P>

<P> </P>

<P> </P>

<P>x, the least significant 5 bits of Dx.y, encodes lane_number[0-4], the number of the lane within the port, </P>

<P> </P>

<P>y, the most significant 3 bits of Dx.y, encodes active_link_width[0-2], the active width of the port and </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_903.jpg"/>
</Figure>

<P>Dx.y is the bit wise complement of Dx.y. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_904.jpg"/>
</Figure>

<P>As shown above, the CS frame marker characters shall be transmitted from left to right. The first character transmitted is M, the last character transmitted is Dx.y. </P>

<P> </P>

<P>The &#8220;M, M, M, M&#8221; sequence that begins the CS field marker is unique and is used to locate the start of the CS data field. The sequence occurs only between the Idle Sequence 2 idle frame random data and CS fields. It never occurs in control symbols or packet data and can not be created by an isolated burst error of 11 bits or less at the code-group level. </P>

<P> </P>

<P>RapidIO Trade Association 79 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The character D21.5 provides lane polarity indication. The 8B/10B encoding of D21.5 is independent of running disparity. If the lane polarity is inverted, the character will decode as D10.2. </P>

<P> </P>

<P>The active_port_width field shall be encoded as specified in Table 4-5. </P>

<P> </P>

<P>Table 4-5. Active Port Width Field Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P>y </P>
</TD>

<TD>
<P>active_link_width[0-2] </P>
</TD>

<TD>
<P>Link mode </P>
</TD>

<TD>
<P>Notes </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>1x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>0b001 </P>
</TD>

<TD>
<P>2x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>0b010 </P>
</TD>

<TD>
<P>4x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>0b011 </P>
</TD>

<TD>
<P>8x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>0b100 </P>
</TD>

<TD>
<P>16x </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>0b101 </P>
</TD>

<TD>
<P>1x on lanes 0, 1 and 2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>0b110 </P>
</TD>

<TD>
<P>1x on both lanes 0 and 1 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>0b111 </P>
</TD>

<TD>
<P>1x on both lanes 0 and 2 </P>
</TD>

<TD>
<P>2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Notes </P>

<P>1. Used when a 2x port is operating in 1x mode. </P>

<P>2. Used when a 4x, 8x, or 16x port is operating in 1x mode. </P>

<P>3. Used when a 1x/2x/Nx port is operating in 1x mode. Some early implementations may report this mode as an active_link_width of 0b110 or 0b111 instead of 0b101. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The lane_number field shall be encoded as specified in Table 4-6. </P>

<P> </P>

<P>Table 4-6. Lane Number Field Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P>x </P>
</TD>

<TD>
<P>lane_number[0-4] </P>
</TD>

<TD>
<P>lane number </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0b00000 </P>
</TD>

<TD>
<P>0 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>0b00001 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>0b00010 </P>
</TD>

<TD>
<P>2 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>0b00011 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>0b00100 </P>
</TD>

<TD>
<P>4 </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>0b00101 </P>
</TD>

<TD>
<P>5 </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>0b00110 </P>
</TD>

<TD>
<P>6 </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>0b00111 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>0b01000 </P>
</TD>

<TD>
<P>8 </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>0b01001 </P>
</TD>

<TD>
<P>9 </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>0b01010 </P>
</TD>

<TD>
<P>10 </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>0b01011 </P>
</TD>

<TD>
<P>11 </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>0b01100 </P>
</TD>

<TD>
<P>12 </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>0b01101 </P>
</TD>

<TD>
<P>13 </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>0b01110 </P>
</TD>

<TD>
<P>14 </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>0b01111 </P>
</TD>

<TD>
<P>15 </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>0b10000 - 0b11111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>A CS field marker whose first four characters are not all M special characters, fifth and seventh characters are not both D21.5 or D10.2 or sixth and eight character are not the bit wise complements of each other shall be determined to be corrupted. A received CS field marker that is determined to be truncated and/or corrupted shall be ignored and discarded. Any error detected in a truncated and/or corrupted CS field marker that is determined to be the result of a transmission error and not the result of truncation, such as an &#8220;invalid&#8221; or &#8220;illegal&#8221; character, shall be reported as an input error. </P>

<P> </P>

<P>4.7.4.1.3  IDLE2 Command and Status Field (CS field) </P>

<P> </P>

<P>The CS field allows a port to provide certain status information about itself to the connected port and to control the transmit emphasis settings of the connected port if the connected port supports adaptive transmit emphasis. </P>

<P> </P>

<P>The CS field shall have 32 information bits, cs_field[0-31], and 32 check bits, cs_field[32-63]. The check bits cs_field[32-63] shall be the bit wise complement of the information bits cs_field[0-31] respectively. </P>

<P> </P>

<P>The CS field bits are defined in Table 4-7. </P>

<P> </P>

<P>Table 4-7. Command and Status Field Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P>CS_field bit(s) </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>CMD - Command </P>

<P>This bit indicates to the connected port when an emphasis update command is present </P>

<P>0b0 - no request present&#61472;&#61472;</P>

<P>0b1 - request present </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Implementation defined </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Receiver trained </P>

<P>When the lane receiver controls any transmit or receive adaptive equalization, this bit indicates whether or not all adaptive equalizers controlled by the lane receiver are trained </P>

<P>0b0 - One or more adaptive equalizers are controlled by the lane receiver and at least one of those adaptive equalizers is not trained </P>

<P>0b1 - The lane receiver controls no adaptive equalizers or all of the </P>

<P>adaptive equalizers controlled by the receiver are trained </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Data scrambling/descrambling enabled </P>

<P>This bit indicates whether control symbol and packet data characters are being scrambled before transmission and descrambled upon reception </P>

<P>This bit indicates whether or not the transmitter is scrambling control symbol and packet data characters. </P>

<P>0b0: scrambling/descrambling disabled&#61472;&#61472;</P>

<P>0b1: scrambling/descrambling enabled </P>
</TD>
</TR>

<TR>
<TD>
<P>4-5 </P>
</TD>

<TD>
<P>Tap(-1) status - Transmit emphasis tap(-1) status </P>

<P>These bits indicate the status of transmit emphasis tap(-1). </P>

<P>0b00: not implemented &#61472;&#61472;</P>

<P>0b01: at minimum emphasis&#61472;&#61472;</P>

<P>0b10: at maximum emphasis&#61472;&#61472;</P>

<P>0b11: at intermediate emphasis setting </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-7. Command and Status Field Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P>CS_field bit(s) </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>6-7 </P>
</TD>

<TD>
<P>Tap(+1) status - Transmit emphasis tap(+1) status. </P>

<P>These bits indicate the status of transmit emphasis tap(+1). </P>

<P>0b00: not implemented&#61472;&#61472;</P>

<P>0b01: at minimum emphasis&#61472;&#61472;</P>

<P>0b10: at maximum emphasis&#61472;&#61472;</P>

<P>0b11: at intermediate emphasis setting </P>
</TD>
</TR>

<TR>
<TD>
<P>8-23 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>24-25 </P>
</TD>

<TD>
<P>Tap(-1) Command - Transmit emphasis tap(-1) update command </P>

<P>This bit is used in conjunction with the &#8220;CMD&#8221; bit to change or retain the emphasis setting of tap(-1). </P>

<P>0b00: hold&#61472;&#61472;</P>

<P>0b01: decrease emphasis by one step&#61472;&#61472;</P>

<P>0b10: increase emphasis by one step&#61472;&#61472;</P>

<P>0b11: reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>26-27 </P>
</TD>

<TD>
<P>Tap(+1) Command - Transmit emphasis tap(+1) update command This bit is used in conjunction with the &#8220;CMD&#8221; bit to change or retain the emphasis setting of tap(+1). </P>

<P>0b00: hold&#61472;&#61472;</P>

<P>0b01: decrease emphasis by one step&#61472;&#61472;</P>

<P>0b10: increase emphasis by one step&#61472;&#61472;</P>

<P>0b11: reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Reset emphasis </P>

<P>This bit is used in conjunction with the &#8220;CMD&#8221; bit to force the transmit emphasis settings in the connected transmitter to no emphasis </P>

<P>0b0: Ignore&#61472;&#61472;</P>

<P>0b1: Reset all transmit emphasis taps to no emphasis </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Preset emphasis </P>

<P>This bit is used in conjunction with the &#8220;CMD&#8221; bit to force the transmit emphasis settings in the connected transmitter to initial or preset values </P>

<P>0b0: Ignore&#61472;&#61472;</P>

<P>0b1: Set all transmit emphasis setting to their preset values. </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>ACK </P>

<P>This bit indicates when a transmit emphasis update command from the connected port has been accepted. </P>

<P>0b0: command not accepted&#61472;&#61472;</P>

<P>0b1: command accepted </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>NACK </P>

<P>This bit indicates when a transmit emphasis update command from the connected port has been refused. </P>

<P>0b0: command not refused&#61472;&#61472;</P>

<P>0b1: command refused </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The 64 cs_field bits shall be encoded in pairs as specified in Table 4-8. </P>

<P> </P>

<P>Table 4-8. CS Field 8/10 Bit Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P>CS_field[n,n+1] </P>

<P>n even </P>
</TD>

<TD>
<P> </P>

<P>Encoding </P>
</TD>
</TR>

<TR>
<TD>
<P>0,0 </P>
</TD>

<TD>
<P>D7.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>0,1 </P>
</TD>

<TD>
<P>D24.3 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-8. CS Field 8/10 Bit Encodings </P>

<P> </P>

<Table>
<TR>
<TD>
<P>CS_field[n,n+1] </P>

<P>n even </P>
</TD>

<TD>
<P> </P>

<P>Encoding </P>
</TD>
</TR>

<TR>
<TD>
<P>1,0 </P>
</TD>

<TD>
<P>D30.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>1,1 </P>
</TD>

<TD>
<P>D24.7 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>This encoding has the property that after 8B/10B encoding, the resulting transmit signal has a minimum run length of 2 except at the boundary between code-groups when a /D24.7/ is immediately followed by a /D30.3/. The minimum run length of </P>

<P>2 reduces the effective bandwidth of the transmitted signal which improves the reliability of transmission over an unequalized or partially equalized lane. </P>

<P> </P>

<P>The characters encoding the CS channel shall be transmitted in the order of the bits they encode beginning with the character encoding CS field bits [0,1] and ending with the character encoding bits [62-63]. </P>

<P> </P>

<P>A CS field whose bits [32-63] are not the bit wise complement of bits [0-31] respectively shall be  determined to be  corrupted. A received CS field that is determined to be truncated and/or corrupted shall be ignored and discarded. Any error detected in a truncated and/or corrupted CS field that is determined to be the result of a transmission error and not the result of truncation, such as an &#8220;invalid&#8221; or &#8220;illegal&#8221; character, shall be reported as an input error. </P>

<P> </P>

<P>4.7.4.1.4  IDLE2 CS Field Use </P>

<P> </P>

<P>The transmit emphasis status and update commands supported by the CS Field are based on a reference model for the transmitter emphasis network that is a transversal filter with K taps with baud period tap spacing. A 5-tap transversal filter is shown in Figure 4-6. The filter taps are named according to their position relative to the &#8220;main&#8221; tap which is designated tap(0). As the signal propagates through the filter, taps that are reached by the signal before it reaches the main tap are designated with negative integers. Taps that are reached by the signal after it has passed the main tap are designated with positive integers. For example, the tap immediately before the main tap is designated tap(-1), the tap immediately following the main tap is designated tap(+1) and the second tap after the main tap is designated tap(+2). The output signal of a transversal filter is formed by multiplying the voltage of each tap by a tap coefficient and summing the products together. The coefficient for tap(n) is designated kn. The main tap, tap(0), has the property that its coefficient (k0) is always positive. When all emphasis is disabled, the main tap coefficient is 1 and all of the other tap coefficients are 0. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_905.jpg"/>
</Figure>

<P>Input </P>

<P>1 baud delay </P>

<P>1 baud delay </P>

<P>1 baud delay </P>

<P>1 baud delay </P>

<P> </P>

<P> </P>

<P>k-2 </P>

<P>k-1  k0  k1  k2 </P>

<P> </P>

<P> </P>

<P>Output </P>

<P> </P>

<P> </P>

<P>Figure 4-6. 5-tap Transversal Filter </P>

<P> </P>

<P>The structure of the transmit emphasis transversal filter in a given port is conveyed to the connected port by the Tap(n) status fields in the CS fields transmitted by the port. </P>

<P> </P>

<P>The intended use for transmit emphasis is to allow at least partial compensation for the transmission losses of links implemented with differential printed circuit board (PCB) trace pairs which increase with increasing frequency. Compensation is achieved by emphasizing the higher frequency portion of the transmit spectrum before transmission. A transversal filter for this purpose typically has two or three taps. The two tap filter has a main tap, tap(0), and either a tap(-1) or a tap(+1). The three tap filter has a main tap and both a tap(-1) and a tap(+1). When adjusted for transmit emphasis, the coefficients of tap(-1) and tap(+1) will be negative with emphasis increasing as the coefficients become more negative. </P>

<P> </P>

<P>The CS fields exchanged between connected LP-Serial ports provides a command and acknowledgement path that allows a LP-Serial receiver to control the transmit emphasis of the connected transmitter. The issuing and acknowledgement of transmit emphasis commands is control by a handshake that uses the CS field signals CMD, ACK and NACK. </P>

<P> </P>

<P>A receiver may issue the following commands. Only one of these commands may be issued at a time. </P>

<P> </P>

<P>reset emphasis preset emphasis </P>

<P>modify the emphasis provided by tap(-1), if tap(-1) is implemented modify the emphasis of tap(+1), if tap(+1) is implemented </P>

<P>CS field commands shall be issued and acknowledged using the following rules. References to specific command bits and to the CMD bit refer to the specific command bits and the CMD bit in CS fields transmitted by the port issuing the command. References to the ACK and NACK bits refer to the ACK and NACK bits </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>in CS fields received from the connected port. An example of this handshake is shown in Figure 4-7. </P>

<P> </P>

<P>Specific command bits may be changed only when the ACK and NACK bits are both de-asserted and the CMD bit is either de-asserted or transitioning from de-asserted to asserted. </P>

<P> </P>

<P>Once the CMD bit is asserted, the connected port will either assert ACK after accepting and executing the command or assert NACK if the command cannot be executed. The assertion of ACK or NACK shall occur no more than 250usec after the assertion of CMD. ACK and NACK shall never be asserted at the same time. </P>

<P> </P>

<P>Once ACK or NACK is asserted in a CS field received by the port issuing the command, the CMD bit is de-asserted. </P>

<P> </P>

<P>ACK or NACK, whichever is asserted, shall be de-asserted within </P>

<P>250usec of receipt of a CS field with the CMD bit deasserted. </P>

<P> </P>

<P>If, for any reason, the connected port fails to assert ACK or NACK within 250usec of the assertion of CMD, CMD may be deasserted. Once deasserted, CMD shall remain deasserted for at least 250usec before being reasserted. </P>

<P> </P>

<P>A CS field command to increase the emphasis of tap(n) by one step shall cause the tap(n) coefficient to be made more negative by one step. A command to decrease the emphasis of tap(n) by one step shall cause the tap(n) coefficient to be made more positive by one step. The transmit emphasis step sizes are implementation dependant. The adjustment of the tap(n) coefficient value may result in the coefficient value of one or more of the other taps to be modified by the transmitter to maintain certain specifications such as the minimum or maximum transmit amplitude. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_906.jpg"/>
</Figure>

<P>CMD </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_907.jpg"/>
</Figure>

<P>preset_emphasis </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_908.jpg"/>
</Figure>

<P>tap(-1)_command(0-1) </P>

<P> </P>

<P> </P>

<P>tap(+1)_command(0-1) </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_909.jpg"/>
</Figure>

<P>ACK </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_910.jpg"/>
</Figure>

<P>NACK </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_911.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 4-7. Example of CS Field CMD, ACK, NACK Handshake </P>

<P> </P>

<P> </P>

<P>4.7.5  Idle Sequence Selection </P>

<P> </P>

<P>LP-Serial links operating at greater than 5.5 GBaud per lane shall always use the IDLE2 sequence. LP-Serial links operating a less than 5.5 GBaud per lane shall support use of the IDLE1 sequence and may support use of the IDLE2 sequence. </P>

<P> </P>

<P>If a LP-Serial port is operating at less than 5.5 GBaud per lane and both ports on the link support both IDLE1 and IDLE2, the port shall determine which idle sequence to use on the link by using the following algorithm during the port initialization process. </P>

<P> </P>

<P>If a LP-Serial port is operating at less than 5.5 GBaud per lane, supports the IDLE2 sequence and its configuration allows it to use the IDLE2 sequence, the port shall transmit the IDLE2 sequence when it enters the SEEK state of the port initialization process. (The port initialization  process  is  specified  in  Section  4.12.)  Otherwise,  a LP-Serial port operating at less than 5.5 GBaud per lane shall transmit the IDLE1 sequence when entering the SEEK state and shall use the IDLE1 on the link until the port reenters the SEEK state. </P>

<P> </P>

<P>A LP-Serial port transmitting the IDLE2 sequence shall monitor the idle sequence it is receiving from the connected port. The port shall determine the idle sequence being received from the connected port using a lane for which lane_sync is asserted. The techniques and algorithms used by a port supporting both IDLE1 and IDLE2 to determine which idle sequence it is receiving are implementation specific and outside the scope of this specification. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>If the LP-Serial port that is transmitting the IDLE2 sequence receives IDLE2 from the connected port, IDLE2 shall be the idle sequence used on the link until the port reenters the SEEK state. If the port receives IDLE1 from the connected port, the port shall switch to transmitting IDLE1 and IDLE1 shall be the idle sequence used on the link until the port reenters the SEEK state. </P>

<P> </P>

<P>There are restrictions on the type of equalizers and, if any of the equalization is adaptive, on the adaptive equalizer training algorithms that may be used by ports operating at less than 5.5 GBaud. These restrictions are specified in Section 9.2, &quot;Equalization&quot; and in Section 10.2, &quot;Equalization&quot;. </P>

<P> </P>

<P> </P>

<P>4.8 Scrambling </P>

<P> </P>

<P>Scrambling smooths the spectrum of a port&#8217;s transmit signal and reduces the spectrum&#8217;s peak values. This is most important when long strings of the same character or of a repeating character sequence are transmitted. The result is a reduction in the amount of electromagnetic interference (EMI) generated by the link and easier design of adaptive equalizer training algorithms. Scrambling of packet and control symbol data characters is used only on links operating with idle sequence 2 (IDLE2). It is not used on links operating with idle sequence 1 (IDLE1) for backwards compatibility with early revisions of this specification. </P>

<P> </P>

<P> </P>

<P>4.8.1  Scrambling Rules </P>

<P> </P>

<P>The use of control symbol and packet data character scrambling on a LP-Serial link is determined by the idle sequence being used on the link. </P>

<P> </P>

<P>If the idle sequence selection process specified in Section 4.7.5 has selected idle sequence 1 (IDLE1) for use on the link, no characters shall be scrambled before transmission on the link. </P>

<P> </P>

<P>If the idle sequence selection process has selected idle sequence 2 (IDLE2), control symbol and packet data characters shall be scrambled by the transmitter before transmission on the link and descrambled in the receiver upon reception. (The per lane scramblers are also used to generate the pseudo-random data characters in the IDLE2 random data field as specified in Section 4.7.4.1.1). Special characters, CS field marker data characters, and CS field data characters shall not be scrambled before transmission. </P>

<P> </P>

<P>Scrambling and descrambling of control symbol and packet data characters can be disabled for test purposes by setting the Data scrambling disable bit in the Port n Control 2 CSR. Scrambling and descrambling of control symbol and packet data characters shall not be disabled for normal link operation. Setting the Data scrambling disable bit does not disable the use of the lane scramblers for the </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>generation of pseudo-random data characters for the IDLE2 random data field. (See </P>

<P>Section 6.6.10, &quot;Port n Control 2 CSRs (Block Offset 0x54, 74, ... , 234)&quot;). </P>

<P> </P>

<P>Scrambling and descrambling shall be done at the lane level. Nx ports shall have a transmit scrambling and receive descrambling function for each of the N lanes. In the transmitter, scrambling shall occur before 8B/10B encoding, and if the port is operating in Nx mode, after lane striping. In the receiver, descrambling shall occur after 8B/10B decoding, and if the port is operating in Nx mode, before lane destriping. </P>

<P> </P>

<P>The polynomial x17+x8+1 shall be used to generate the pseudo-random sequences that are used for scrambling and descrambling. This polynomial is not primitive, but when the sequence generator is initialized to all 1s or other appropriate values, the polynomial produces a sequence with a repeat length of 35,805 bits. The bit serial output of the pseudo-random sequence generator shall be taken from the output of the register holding x17. The pseudo random sequence generator is shown in Figure 4-8. </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>1 </P>
</Textbox>

<P>D Q   x D Q   x </P>

<Textbox>
<P>2 </P>
</Textbox>

<P>D Q   x D Q   x D Q  x </P>

<P>x6 x7 x8 </P>

<P>D Q D Q D Q  </P>

<P> </P>

<Textbox>
<P>3 </P>
</Textbox>

<P>XOR </P>

<Textbox>
<P>4 </P>
</Textbox>

<Textbox>
<P>5 </P>
</Textbox>

<P> </P>

<P> </P>

<P>Clock </P>

<P> </P>

<P> </P>

<P>x9 x10 </P>

<P>x11 </P>

<P>x12 </P>

<P>x13 </P>

<P>x14 </P>

<P>x15 </P>

<P>x16 </P>

<P>x17 </P>

<P>D Q D Q D Q D Q D Q D Q D Q D Q D Q  </P>

<P>Output </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_912.jpg"/>
</Figure>

<P>Figure 4-8. Scrambling Sequence Generator </P>

<P> </P>

<P>Control symbol and packet data characters shall be scrambled and descrambled by XORing the bits of each character with the output of the pseudo-random sequence generator. The bits of each data character are scrambled/descrambled in order of decreasing significance. The most significant bit (bit 0) is scrambled/descrambled first, the least significant bit (bit 7) is scrambled/descrambled last. </P>

<P> </P>

<P>The transmitter and receiver scrambling sequence generators shall step during all characters except R special characters. This is to prevent loss of sync between transmit and receive scramblers when an /R/ or ||R|| is added or removed by a retimer. </P>

<P> </P>

<P>To minimize any correlation between lanes when a port is transmitting on multiple lanes, the scrambling sequence applied to a given output lane of the port shall be offset from the scrambling sequence applied to any other output lane of the port by at least 64 bits. If separate scrambling sequence generators are used for each lane, the offset requirement can be achieved by initializing the scramblers to the values specified in Table 4-9, which provide an offset of 64. </P>

<P> </P>

<P>88 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-9. Scrambler Initialization Values </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Lane </P>
</TD>

<TD>
<P>Initialization value </P>

<P>[x1-x17] </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0b1111 1111 1111 1111 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>0b1111 1111 0000 0110 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>0b0000 0000 1000 0110 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>0b0000 0110 0111 1010 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>0b1000 0000 1011 1001 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>0b1111 1010 1000 0111 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>0b0100 0011 1001 1011 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>0b1100 0100 1010 0101 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>0b0101 1111 0100 1001 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>0b1111 1010 0111 1001 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>0b1011 0011 0111 0010 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>0b1100 1010 1011 0011 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>0b1011 1000 0101 0011 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>0b0000 1011 0110 1111 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>0b0101 1000 1001 1010 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>0b0011 0111 1010 1000 1 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.8.2  Descrambler Synchronization </P>

<P> </P>

<P>Since the pseudo-random data characters of the random data field of the idle sequence  2  idle  frame  are  generated  by  scrambling  D0.0  characters,  the pseudo-random characters of the random data field contain the pseudo-random sequence used by the transmitter to scramble control symbol and packet data characters. A sequence of at least four (4) contiguous pseudo-random data characters immediately follow each M special character in the random data field. </P>

<P> </P>

<P>Each lane descrambler shall synchronize itself to the scrambled data stream it is receiving by using the scrambling sequence extracted from the pseudo-random data characters received by the lane to re-initialize the state of the descrambler. </P>

<P> </P>

<P>After a lane descrambler has been re-initialized, the next two descrambler sync tests, which are defined in Section 4.8.3, shall be used to verify descrambler synchronization. If the result of both lane descrambler sync tests is &#8220;pass&#8221;, the descrambler shall be determined to be &#8220;in sync&#8221;. Otherwise, the lane descrambler shall be determined to be &#8220;out of sync&#8221; and the resynchronization process shall be repeated. </P>

<P> </P>

<P>To ensure that a port that may have lost descrambler sync is able to recover descrambler sync before it is sent a link maintenance protocol link-request control symbol, a LP-Serial port that is operating with IDLE2 shall transmit a SYNC sequence (described below) before transmitting any link-request control symbol. </P>

<P> </P>

<P>RapidIO Trade Association 89 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The SYNC sequence shall be transmitted in parallel on each of the N active lanes of a link operating in Nx mode and shall immediately precede the link-request control symbol. If the link is operating in 1x mode, the last character of the SYNC sequence is immediately followed by the first character of the link-request. If the link is operating in Nx mode, the last column of the SYNC sequence is immediately followed by the column containing the first characters of the link-request. </P>

<P> </P>

<P>The SYNC sequence shall be comprised of four contiguous repetitions of a five character sequence that begins with a M special character immediately followed by </P>

<P>4 pseudo-random data characters, i.e. the SYNC sequence is MDDDD MDDDD MDDDD MDDDD. The pseudo-random data characters shall be generated in the same way as the pseudo-random data characters in the random data field of the IDLE2 idle frame are generated. The SYNC sequence will appear as four repetitions of ||M||D||D||D||D|| on a link operating in Nx mode. </P>

<P> </P>

<P> </P>

<P>4.8.3  Descrambler Synchronization Verification </P>

<P> </P>

<P>Each active lane of a LP-Serial port that is descrambling received control symbol and packet data characters shall, with the one exception stated below, perform a descrambler synchronization state check (descrambler sync check) whenever a descrambler sync check trigger event is detected in the received character stream of the lane. </P>

<P> </P>

<P>A descrambler sync check trigger event is defined as the occurrence of one of the following character sequences in the received character stream of an active lane. </P>

<P>1.  A single K, M or R special character that is not part of a contiguous sequence of K, M and/or R special characters. </P>

<P>2.  A contiguous sequence of K and/or R special characters possibly followed by a M special character. </P>

<P> </P>

<P>The descrambler sync check shall consist of inspecting the descrambled values of the four contiguous characters following the trigger sequence. These four characters are designated the descrambler sync &#8220;check field&#8221;. The characters comprising the check field shall be determined as follows. </P>

<P> </P>

<P>The check field for the first type of trigger event shall be the four characters immediately following the K, M or R special character. </P>

<P> </P>

<P>The check field for the second type of trigger event that does not end with a M special character shall be the four characters immediately following the contiguous sequence of K and/or R special characters. </P>

<P> </P>

<P>The check field for the second type of trigger event that ends with a M special character shall be the four characters immediately following the M special character. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>When the descrambler is in sync and in the absence of transmission errors, the </P>

<P>&#8220;check field&#8221; will contain four data characters that are all D0.0s after descrambling. </P>

<P> </P>

<P>The exception to the rule stated above that each descrambler sync check trigger sequence shall cause the receiving lane to execute a descrambler sync check is when the descrambler check trigger sequence begins in the four character check field of a previous trigger sequence. When this occurs, the trigger sequence shall not trigger a descrambler sync check. For example, the RM in the sequence KRXRMDDDD, where X is neither a K nor R, shall not trigger a descrambler sync check as it begins in the four character check field used by the descrambler sync check triggered by the KR sequence. </P>

<P> </P>

<P>If the descrambled value of each of the four characters in a check field is D0.0, the result of the descrambler sync test shall be &#8220;pass&#8221;. Otherwise, the result of the descrambler sync test shall be &#8220;fail&#8221; and the descrambler shall be determined to be &#8220;out of sync&#8221;. </P>

<P> </P>

<P>A sync test can fail because of either a loss of descrambler sync or a data transmission error(s) in either the sync trigger sequence or the check field. While this will result is some false sync test &#8220;failures&#8221;, it is preferable to allowing false sync test &#8220;passes&#8221; which can result in undetected control symbol or packet corruption. </P>

<P> </P>

<P>If  a  descrambler  sync  test  fails,  the  port  shall  immediately  enter  the  Input Error-stopped state if it is not already in that state and resynchronize the descrambler. All control symbols and packet received while a lane descrambler is out   of   sync   shall   be   ignored   and   discarded.   The   cause   field   in   the packet-not-accepted control  symbol  issued  by  the  port  on  entering  the  Input Error-stopped state due to a sync check failure shall indicate &#8220;loss of descrambler sync&#8221;. </P>

<P> </P>

<P> </P>

<P>4.9 1x Mode Transmission Rules </P>

<P> </P>

<P> </P>

<P>4.9.1  1x Ports </P>

<P> </P>

<P>A 1x LP-Serial port shall 8B/10B encode and transmit the character stream of delimited control symbols and packets received from the upper layers in the order the characters were received from the upper layers. When neither control symbols nor packets are available from the upper layers for transmission, an idle sequence shall be fed to the input of the 8B/10B encoder for encoding and transmission. </P>

<P> </P>

<P>On reception, the code-group stream is 8B/10B decoded and the resulting character stream of error free delimited control symbols and packets shall be passed to the upper layers in the order the characters were received from the link. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>If the link is operating with idle sequence 2, control symbol and packet data characters shall be scrambled before transmission and descrambled after reception as specified in Section 4.8. </P>

<P> </P>

<P>Figure 4-9 shows the encoding and transmission order for a short control symbol transmitted over a LP-Serial link operating in 1x mode. </P>

<P> </P>

<P>1st byte[0-7] </P>

<P>2nd byte[0-7] </P>

<P>3rd byte[0-7] </P>

<P> </P>

<Table>
<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>param 0 </P>
</TD>

<TD>
<P>param 1 </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>CRC </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_913.jpg"/>
</Figure>

<P>Delimiter </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_914.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_915.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_916.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_917.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_918.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_919.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_920.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_921.jpg"/>
</Figure>

<P>1st byte 2nd byte 3rd byte </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_922.jpg"/>
</Figure>

<P>Unencoded </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_923.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_924.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_925.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_926.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_927.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_928.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_929.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_930.jpg"/>
</Figure>

<P>8b/10b </P>

<P>8b/10b </P>

<P>8b/10b </P>

<P>8b/10b </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_931.jpg"/>
</Figure>

<P>/SC/ or /PD/ </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_932.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_933.jpg"/>
</Figure>

<P>1st /Dx.y/ 2nd /Dx.y/ 3rd /Dx.y/ </P>

<P> </P>

<P> </P>

<P>Encoded </P>

<P> </P>

<P>bit and code-group transmission order </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_934.jpg"/>
</Figure>

<P>Figure 4-9. 1x Mode Short Control Symbol Encoding and Transmission Order </P>

<P> </P>

<P>Figure 4-10 shows the encoding and transmission order for a packet transmitted over a 1x LP-Serial link. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_935.jpg"/>
</Figure>

<P>Unencoded </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_936.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_937.jpg"/>
</Figure>

<Textbox>
<Table>
<TR>
<TD>
<P>ackID </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>prio </P>
</TD>

<TD>
<P>tt </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>1st byte[0-7] </P>

<P>2nd byte[0-7] </P>

<P>3rd byte[0-7] </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_938.jpg"/>
</Figure>

<P>1st byte 2nd byte 3rd byte </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_939.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_940.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_941.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_942.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_943.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_944.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_945.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_946.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_947.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_948.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_949.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_950.jpg"/>
</Figure>

<P>8b/10b 8b/10b 8b/10b </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_951.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_952.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Encoded </P>

<P>1st /Dx.y/ 2nd /Dx.y/ 3rd /Dx.y/ </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_953.jpg"/>
</Figure>

<P>bit and code-group transmission order </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_954.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_955.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_956.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Figure 4-10. 1x Mode Packet Encoding and Transmission Order </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_957.jpg"/>
</Figure>

<P>Figure 4-11 shows an example of idle sequence 1, short control symbol and packet transmission on a 1x LP-Serial link. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_958.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_959.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_960.jpg"/>
</Figure>

<P>Time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_961.jpg"/>
</Figure>

<Textbox>
<Table>
<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-2 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Control </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Symbol </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>(start-pkt) </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-0 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-1 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-2 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-3 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-4 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-5 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-6 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-7 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<Textbox>
<Table>
<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Control </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Symbol </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>(start pkt) </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-0 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-1 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-2 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-3 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-4 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-5 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-6 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-7 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-8 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-9 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-10 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-11 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-2 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<Textbox>
<Table>
<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Control </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Symbol </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>(end pkt) </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Control </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Symbol </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>(start pkt) </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-0 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-1 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-2 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-3 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-4 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-5 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-6 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-7 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-2 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<Textbox>
<Table>
<TR>
<TD>
<P>Data-8 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-9 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-10 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-11 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-2 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-12 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-13 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-14 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-15 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Restart </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>from </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Retry </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Control </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Symbol </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>(start pkt) </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<Textbox>
<Table>
<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Cdata-2 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-0 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-1 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-2 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-3 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-4 </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-5 </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-6 </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-7 </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Control </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Symbol </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>(end pkt) </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>char-0 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>char-1 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>char-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>char-3 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 4-11. 1x Typical Data Flow with Short Control Symbol </P>

<P> </P>

<P> </P>

<P>4.9.2  Nx Ports Operating in 1x Mode </P>

<P> </P>

<P>When a Nx port is operating in 1x mode, the character stream of delimited control symbols and packets received from the upper layers shall be fed in parallel to both lanes 0 and R for encoding and transmission in the order the characters were received from the upper layers. (The character stream is not striped across the lanes before encoding as is done when operating in Nx mode.) When neither delimited control symbols nor packets are available from the upper layers for transmission, an idle sequence shall be fed in parallel to both lane 0 and lane R for 8B/10B encoding and transmission on lanes 0 and R. </P>

<P> </P>

<P>On reception, the code-group stream from either lane 0 or R shall be selected according to the state of the 1x/Nx_Initialization state machine (Section 4.12.4.5), decoded and the error free delimited control symbols and packets passed to the upper layers. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>When a port that optionally supports and is enabled for both 2x mode and a wider Nx mode is operating in 1x, the port shall support both lanes 1 and 2 as redundancy lanes. The port shall transmit the 1x mode data stream on lanes 0, 1 and 2 and attempt to receive 1x mode data stream on lanes 0, 1 and 2. The port shall select between using the data received on lane 0 or the data received on the redundancy lane which may be either lane 1 or lane 2 depending on the connected port. Unless forced to use the redundancy lane, the port shall use the data stream received on lane </P>

<P>0 if it is available. The 1x/Nx_Initialization state machine specified in Section </P>

<P>4.12.4.6 shall be modified for a port supporting both 2x and a wider Nx mode to </P>

<P>comply with the above requirements. </P>

<P> </P>

<P>If the link is operating with idle sequence 2, control symbol and packet data characters shall be scrambled before transmission and descrambled after reception as specified in Section 4.8. </P>

<P> </P>

<P>Once a Nx port is initialized to a 1x mode, the port may elect to disable the output driver of the lane which was not selected for reception by the initialization state machine of the connected port. Since the ports connected by the link may not be receiving on the same lane (one port could be receiving on lane 0 and the other port receiving on lane R), the connected port must be interrogated to determine which lane can be output disabled. It is recommended that the mechanism for disabling the output driver be under software control. </P>

<P> </P>

<P> </P>

<P>4.10 Nx Link Striping and Transmission Rules </P>

<P> </P>

<P>A LP-Serial port operating in Nx mode shall stripe the character stream of delimited control symbols and packets received from the upper layers across the N active output lanes in the order the characters were received from the upper layers. Each lane shall then 8B/10B encode and transmit the characters assigned to it. When neither control symbols nor packets are available from the upper layers for transmission, an idle sequence shall be fed to each of the N lanes for 8B/10B encoding and transmission. </P>

<P> </P>

<P>Packets and delimited control symbols shall be striped across the N active lanes beginning with lane 0. The first character of each packet, or delimited control symbol, shall be placed in lane K where K modulo 4 = 0. The second character shall be placed in lane (K + 1), and the nth character shall be placed in lane (K + (n - 1)) which wraps around to lane 0 when (K + (n - 1)) modulo N = 0. </P>

<P> </P>

<P>The lengths of control symbols and packets in the LP-Serial Physical Layer are positive integer multiples of 4 characters. As a result, when N, the width of the link, is greater than 4, occasions will occur when there are not enough packets and/or control symbols available for transmission to fill a column. For example, lanes 0-3 of a link operating in 8x mode contain a delimited short control symbol or the last 4 characters of a delimited long control symbol, but there is nothing available to put in lanes 4-7. When this occurs, all remaining characters in the column shall be filled (padded) with pseudo-random data characters. The first pseudo-random data pad </P>

<P> </P>

<P>94 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>character shall occur in a lane whose lane_number modulo 4 = 0. The number of pseudo-random data pad characters in a column shall be a positive integer multiple of 4. If the link is operating with idle sequence 2, the pseudo-random data characters may be generated by using the lane scramblers to scramble D0.0 characters. Padding characters shall not be inserted between packet delimiting control symbols and the packet(s) they delimit. </P>

<P> </P>

<P>After striping, each of the N streams of characters shall be independently 8B/10B </P>

<P>encoded and transmitted. </P>

<P> </P>

<P>On reception, each lane shall be 8B/10B decoded. </P>

<P> </P>

<P>If the link is operating with idle sequence 2, control symbol and packet data characters shall be scrambled before transmission and descrambled after reception as specified in Section 4.8. </P>

<P> </P>

<P>After decoding, the N lanes shall be aligned. The ||A|| columns transmitted as part of an idle sequence provide the information needed to perform alignment. After alignment, the columns are destriped into a single character stream and passed to the upper layers. </P>

<P> </P>

<P>The lane alignment process eliminates the skew between lanes so that after destriping, the ordering of characters in the received character stream is the same as the ordering of characters before striping and transmission. Since the minimum number of non ||A|| columns between ||A|| columns is 16, the maximum lane skew that can be unambiguously corrected is the time it takes to transmit 7 code-groups on a lane. </P>

<P> </P>

<P>Figure 4-12 shows an example of Idle Sequence 1, short control symbol and packet transmission on a 4x link. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_962.jpg"/>
</Figure>

<P>Time </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Lane-0 </P>
</TD>

<TD>
<P>Lane-1 </P>
</TD>

<TD>
<P>Lane-2 </P>
</TD>

<TD>
<P>Lane-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>Cdata-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>/I/ </P>
</TD>

<TD>
<P>/I/ </P>
</TD>

<TD>
<P>/I/ </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>Control Symbol (Start-of-packet) </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-0 </P>
</TD>

<TD>
<P>Data-1 </P>
</TD>

<TD>
<P>Data-2 </P>
</TD>

<TD>
<P>Data-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-4 </P>
</TD>

<TD>
<P>Data-5 </P>
</TD>

<TD>
<P>Data-6 </P>
</TD>

<TD>
<P>Data-7 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>Control Symbol (Start-of-packet) </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-0 </P>
</TD>

<TD>
<P>Data-1 </P>
</TD>

<TD>
<P>Data-2 </P>
</TD>

<TD>
<P>Data-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-4 </P>
</TD>

<TD>
<P>Data-5 </P>
</TD>

<TD>
<P>Data-6 </P>
</TD>

<TD>
<P>Data-7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-8 </P>
</TD>

<TD>
<P>Data-9 </P>
</TD>

<TD>
<P>Data-10 </P>
</TD>

<TD>
<P>Data-11 </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>Cdata-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>Control Symbol (End-of-packet) </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>Control Symbol (Start-of-packet) </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-0 </P>
</TD>

<TD>
<P>Data-1 </P>
</TD>

<TD>
<P>Data-2 </P>
</TD>

<TD>
<P>Data-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-4 </P>
</TD>

<TD>
<P>Data-5 </P>
</TD>

<TD>
<P>Data-6 </P>
</TD>

<TD>
<P>Data-7 </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>Cdata-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-8 </P>
</TD>

<TD>
<P>Data-9 </P>
</TD>

<TD>
<P>Data-10 </P>
</TD>

<TD>
<P>Data-11 </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>Cdata-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-12 </P>
</TD>

<TD>
<P>Data-13 </P>
</TD>

<TD>
<P>Data-14 </P>
</TD>

<TD>
<P>Data-15 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>Control Symbol (Restart-from-retry) </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>Control Symbol (Start-of-packet) </P>
</TD>
</TR>

<TR>
<TD>
<P>/SC/ </P>
</TD>

<TD>
<P>Cdata-0 </P>
</TD>

<TD>
<P>Cdata-1 </P>
</TD>

<TD>
<P>Cdata-2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-0 </P>
</TD>

<TD>
<P>Data-1 </P>
</TD>

<TD>
<P>Data-2 </P>
</TD>

<TD>
<P>Data-3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Data-4 </P>
</TD>

<TD>
<P>Data-5 </P>
</TD>

<TD>
<P>Data-6 </P>
</TD>

<TD>
<P>Data-7 </P>
</TD>
</TR>

<TR>
<TD>
<P>/PD/ </P>
</TD>

<TD>
<P>Control Symbol (End-of-packet) </P>
</TD>
</TR>

<TR>
<TD>
<P>/I/ </P>
</TD>

<TD>
<P>/I/ </P>
</TD>

<TD>
<P>/I/ </P>
</TD>

<TD>
<P>/I/ </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 4-12. Typical 4x Data Flow with Short Control symbol </P>

<P> </P>

<P> </P>

<P>4.11 Retimers and Repeaters </P>

<P> </P>

<P>The LP-Serial Specification allows &#8220;retimers&#8221; and &#8220;repeaters&#8221;. Retimers amplify a weakened signal, but do not transfer jitter to the next segment because they use a local transmit clock. Repeaters also amplify a weakened signal, but transfer jitter to the next segment because they use a transmit clock derived from the received data stream. Retimers allow greater distances between end points at the cost of additional latency. Repeaters support less distance between end points than retimers and only add a small amount of latency. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>4.11.1  Retimers </P>

<P> </P>

<P>A retimer shall comply with all applicable AC specifications found in Chapter 8, &quot;Common  Electrical  Specifications&quot;,  Chapter 9,  &quot;1.25Gbaud,  2.5Gbaud,  and </P>

<P>3.125Gbaud LP-Serial Links&quot;, and Chapter 10, &quot;5Gbaud and 6.25Gbaud LP-Serial Links&quot;. This includes resetting the jitter budget thus extending the transmission distance for the link. The retimer repeats the received code-groups after performing code-group synchronization and serializes the bitstream again on transmission, based on a local clock reference. Up to two retimers are allowed between two end nodes. </P>

<P> </P>

<P>A retimer is not RapidIO protocol-aware or addressable in any way. The only awareness a retimer has is to the synchronization on the /K/ code-group and the function of /R/ insertion and removal. A retimer may insert up to one /R/ code-group immediately following a /K/ code-group, or remove one /R/ code-group that immediately follows a /K/ code-group. Since the /R/ code-group is disparity neutral, its insertion or deletion does not affect the running disparity. </P>

<P> </P>

<P>A N-lane retimer must perform lane synchronization and deskew, in exactly the same way a RapidIO device implementing this physical layer does when synchronizing inputs during initialization and startup. A Nx mode retimer will synchronize and align all lanes that are driven to it. Therefore, such a retimer allows for the degradation of an input Nx link to a 1x link on either lane 0 or R. If any link drops out, the retimer must merely continue to pass the active links, monitoring for the compensation sequence and otherwise passing through whatever code-groups appear on its inputs. A retimer may optionally not drive any outputs whose corresponding inputs are not active. </P>

<P> </P>

<P>Any insertion or removal of a /R/ code-groups in a N-lane retimer must be done on a full column. A retimer may retime links operating at the same width only (i.e. cannot connect a link operating at 1x to a link operating at Nx). A retimer may connect a 1x link to a Nx link that is operating in 1x mode. Retimers perform clock tolerance compensation between the receive and transmit clock. The transmit clock is usually derived from a local reference. </P>

<P> </P>

<P>Retimers do not check for code violations. Code-groups received on one port are transmitted on the other regardless of code violations or running disparity errors. </P>

<P> </P>

<P> </P>

<P>4.11.2  Repeaters </P>

<P> </P>

<P>A repeater is used to amplify the signal, but does not retime the signal, and therefore can add additional jitter to the signal. It does not compensate for clock rate variation. The repeater repeats the received code-groups as the bits are received by sampling the incoming bits with a clock derived from the bit stream, and then retransmitting them based on that clock. Repeaters may be used with Nx links but lane-to-lane skew may be amplified. Repeaters do not interpret or alter the bit stream in any way. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.12 Port Initialization </P>

<P> </P>

<P>This section specifies the port initialization process. The process includes detecting the presence of a partner at the other end of the link (a link partner), establishing bit synchronization and code-group boundary alignment and if present, adjusting any adaptive equalizers. The process also includes determining if the connected port supports an Nx mode in addition to 1x mode and selecting 1x or Nx mode operation, then, if 1x mode is selected, selecting lane 0 or lane R (the redundancy lane, lane 1 for 2x ports and lane 2 for 4x, 8x or 16x ports) for link reception. </P>

<P> </P>

<P>Port initialization may optionally include baud rate discovery. </P>

<P> </P>

<P>The initialization process is controlled by several state machines. The number and type of state machines depends on whether the port supports only 1x mode (a 1x port) or supports both 1x and one or more Nx modes (a 1x/Nx port). In either case, there is a primary state machine and one or more secondary state machines. The use of multiple state machines results in a simpler overall design. As might be expected, the initialization process for a 1x port is simpler than and is a subset of the initialization process for a 1x/Nx port. </P>

<P> </P>

<P>The port initialization process supports an optional test mode that allows ports that support more than one multi-lane mode of operation to enable and monitor the operation of the inactive lanes when the port is operating at less than maximum width. The performance of inactive lanes can be monitored only if the inactive lanes are connected to and supported by the connected port and the test mode is implemented and enabled in both ports. The test mode is enabled with the &#8220;Enable inactive lanes&#8221; bit defined in Section 6.7.2.2. The initiation, implementation and interpretation of tests conducted using this test mode is outside of this specification. </P>

<P> </P>

<P>The initialization process for 1x, 1x/Nx ports, and ports supporting 1x mode and multiple Nx modes is both described in text and specified with state machine diagrams. In the case of conflict between the text and a state machine diagram, the state machine diagram takes precedence. </P>

<P> </P>

<P> </P>

<P>4.12.1  1x Mode Initialization </P>

<P> </P>

<P>The initialization process for ports that support only 1x mode shall be controlled by two state machines, 1x_Initialization and Lane_Synchronization. 1x_Initialization is the primary state machine and Lane_Synchronization is the secondary state machine. The operation of these state machines is described and specified in Section </P>

<P>4.12.4.4 and Section 4.12.4.2 respectively. </P>

<P> </P>

<P> </P>

<P>4.12.2  1x/Nx Mode Initialization </P>

<P> </P>

<P>The initialization process for ports that support both 1x and a Nx mode is controlled by a primary state machine and four or more secondary state machines. The primary state machine is the 1x/Nx_Initialization state machine. Lane_Synchronization[0] </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>through Lane_Synchronization[N-1] (one for each of the N lanes), Lane_Alignment </P>

<P>(one for each supported Nx mode) and 1x/2x_Mode_Detect (used only in the </P>

<P>1x/2x_Initialization state machine) are the secondary state machines. The operation of the secondary state machines is described and specified in Section 4.12.4.2 through Section 4.12.4.4 respectively. </P>

<P> </P>

<P>The 1x/Nx_Initialization state machine provides a degree of LP-Serial link width auto-negotiation. The goal of the auto-negotiation is to ensure that any connected combination of 1x, 1x/2x, 1x/4x, 1x/8x or 1x/16x LP-Serial ports that are configured in some manner to operate at the same baud rate will automatically find a link width over which they can communicate. For example if a 1x/4x port is connected to a </P>

<P>1x/8x port, they will auto-negotiate to operate in 1x mode. If however the 1x/8x port optionally   also   supports   4x   mode   (making   it   a   1x/4x/8x   port)   and   its </P>

<P>1x/Nx_Initialization state machine has been modified as shown in Figure 4-22 to be a 1x/4x/8x_Initialization state machine, then the ports will auto-negotiate to operate in 4x mode. </P>

<P> </P>

<P>In most configurations, the auto-negotiation also ensures that a pair of connected multi-lane LP-Serial ports configured in some manner to operate at the same baud rate will find a link width over which they can communicate in the presence of a lane failure. For example, if two 1x/4x ports are connected and lane 0 is broken in one direction, the ports will auto-negotiate to operate in 1x mode using lane 0 in the direction that lane 0 is operational and lane 2 in the direction that lane 0 is broken. This feature works only for pairs of ports that support the same redundancy lane. It does not work when a 1x/2x port is connected to a 1x/4x or wider port. </P>

<P> </P>

<P> </P>

<P>4.12.3  Baud Rate Discovery </P>

<P> </P>

<P>Baud rate discovery is optional. If implemented, baud rate discovery occurs during the SEEK state of the 1x_Initialization and 1x/Nx_Initialization state machines. Ports that implement baud rate discovery shall use the following algorithm. </P>

<P>1.  When the port enters the SEEK state, it begins transmitting an idle sequence on lane 0 and, if the port supports a Nx mode, on lane R, the 1x mode redundancy lane. The idle sequence shall be transmitted at the highest lane baud rate that is supported by the port and that is enabled for use. </P>

<P>2.  The port shall then look for an inbound signal on lane 0 or lane R of the link from a connected port. The method of detecting the presence of an inbound signal from a connected port is implementation specific and outside the scope of this specification. </P>

<P>3.  Once an inbound signal is detected, the port shall determine the baud rate of the signal. The method of detecting the baud rate of the signal is implementation specific and outside the scope of this specification. </P>

<P>4.  If the baud rate of the inbound signal is the same as the baud rate at which the port is transmitting, the link shall operate at that per lane baud rate until the port reenters the SEEK state and the baud rate discovery process is complete. </P>

<P> </P>

<P>RapidIO Trade Association 99 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.  If the baud rate on the inbound signal is less than the baud rate of the idle sequence being transmitted by the port, the port shall reduce the baud rate at which it is transmitting to the next lowest baud rate that it supports and that is enabled for use and go to step 2. </P>

<P>6.  If the baud rate on the inbound signal is greater than the baud rate of the idle sequence being transmitted by the port, the port shall continue transmitting at the current baud rate go to step 2. </P>

<P> </P>

<P>An informational state diagram for the Baudrate_Discovery state machine is shown in Figure 4-13. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_963.jpg"/>
</Figure>

<P>The techniques and algorithms used to compare the baud rates of the signals being transmitted and received are implementation specific and beyond the scope of this specification. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>WAIT </P>

<P>xmt_baudrate = max </P>

<P> </P>

<P> </P>

<P> </P>

<P>seek_lanes_drvr_oe </P>

<P> </P>

<P> </P>

<P> </P>

<P>COMPARE </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>seek_lanes_drvr_oe &amp; </P>

<P>rcv_baudrate &lt; xmt_baudrate </P>

<P>!seek_lanes_drvr_oe </P>

<P> </P>

<P>seek_lanes_drvr_oe &amp; (rcv_baudrate &gt;= xmt_baudrate) &amp; (lane_sync[0] | lane_sync[R] </P>

<P> </P>

<P> </P>

<P>DECREMENT </P>

<P>xmt_baudrate = </P>

<P>next_lowest_baudrate </P>

<P>DONE </P>

<P> </P>

<P> </P>

<P> </P>

<P>!seek_lanes_drvr_oe </P>

<P> </P>

<P> </P>

<P>Figure 4-13. Baudrate_Discovery state machine (Informational) </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>4.12.4  State Machines </P>

<P> </P>

<P>4.12.4.1  State Machine Conventions, Functions and Variables </P>

<P> </P>

<P>4.12.4.1.1  State Machine Conventions </P>

<P> </P>

<P>The conventions used in state machine specification are as follows. </P>

<P> </P>

<P>A state machine state is persistent until an exit condition occurs. </P>

<P> </P>

<P>A state machine variable that is listed in the body of a state but is not part of an assignment statement is asserted for the duration of that state only. </P>

<P> </P>

<P>A state machine variable that is assigned a value in the body of a state retains that value until assigned a new value in another state. </P>

<P> </P>

<P>A state machine function that is listed in the body of a state is executed once during the state. </P>

<P> </P>

<P>A state machine variable is asserted when its value is 1 and de-asserted when it value is 0. </P>

<P> </P>

<P>Except when otherwise directed by parentheses, the order of precedence of logic operations when evaluating a logic expression is, in order of decreasing precedence,  negation/compliment (!)  followed  by  intersection (&amp;)  and union (|). </P>

<P> </P>

<P>Logic expressions within paired parentheses are evaluated before the rest of a logic expression is evaluated with the operations within the innermost pair of parentheses evaluated first. </P>

<P> </P>

<P>4.12.4.1.2  State Machine Functions </P>

<P> </P>

<P>The functions used in the state machines are defined as follows. change( ) </P>

<P>Asserted when the variable on which it operates changes state. next_code_group( ) </P>

<P>Gets the next 10 bit code-group for the lane when it becomes available. next_Ncolumn( ) </P>

<P>Gets the next column of N code-groups or characters, as appropriate, from lanes 0 to N-1 when it becomes available. </P>

<P> </P>

<P>4.12.4.1.3  State Machine Variables </P>

<P> </P>

<P>The variables used in the state machines are defined as follows. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1x_mode_delimiter </P>

<P> </P>

<P>Asserted when a column of two characters from lanes 0 and 1 contains two SC or two PD special characters. Otherwise de-asserted. </P>

<P> </P>

<P>1x_mode_detected </P>

<P> </P>

<P>Asserted by the 1x/2x_Mode_Detect state machine when it determines that the link receiver input signals on lanes 0 and 1 are in 1x mode. Otherwise, de-asserted. </P>

<P> </P>

<P>2x_mode_delimiter </P>

<P> </P>

<P>Asserted when a column of two characters from lanes 0 and 1 contains one SC or </P>

<P>PD special character and one data character. Otherwise de-asserted. </P>

<P> </P>

<P>||A|| </P>

<P> </P>

<P>Asserted when the current column contains all /A/s. Otherwise de-asserted. Acounter </P>

<P>A counter used in the Lane Alignment state machine to count received alignment columns (||A||s). </P>

<P> </P>

<P>align_error </P>

<P> </P>

<P>Asserted when the current column contains at least one /A/, but not all /A/s. Otherwise, de-asserted. </P>

<P> </P>

<P>/COMMA/ </P>

<P> </P>

<P>If Idle Sequence 1 is being used on the link to which the port is connected, asserted when the current code-group is /K28.5/. Otherwise, de-asserted. </P>

<P> </P>

<P>If Idle Sequence 2 is being used on the link to which the port is connected, asserted when the current code-group is either /K28.1/ or /K28.5/. Otherwise, de-asserted. </P>

<P> </P>

<P>Dcounter </P>

<P> </P>

<P>A 2-bit synchronous saturating up/down counter with the behavior specified in </P>

<P>Table 4-10. The counter is used in the 1x/2x_Mode_Detect state machine. </P>

<P> </P>

<P> </P>

<P>Table 4-10. Dcounter Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Counter </P>

<P>Value </P>
</TD>

<TD>
<P>(count_up,count_down) </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0,0 </P>
</TD>

<TD>
<P>0,1 </P>
</TD>

<TD>
<P>1,0 </P>
</TD>

<TD>
<P>1,1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0 </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>0x1 </P>
</TD>

<TD>
<P>0x0 </P>
</TD>
</TR>

<TR>
<TD>
<P>0x1 </P>
</TD>

<TD>
<P>0x1 </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>0x2 </P>
</TD>

<TD>
<P>0x1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0x2 </P>
</TD>

<TD>
<P>0x2 </P>
</TD>

<TD>
<P>0x1 </P>
</TD>

<TD>
<P>0x3 </P>
</TD>

<TD>
<P>0x2 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-10. Dcounter Definition </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Counter </P>

<P>Value </P>
</TD>

<TD>
<P>(count_up,count_down) </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0,0 </P>
</TD>

<TD>
<P>0,1 </P>
</TD>

<TD>
<P>1,0 </P>
</TD>

<TD>
<P>1,1 </P>
</TD>
</TR>

<TR>
<TD>
<P>0x3 </P>
</TD>

<TD>
<P>0x3 </P>
</TD>

<TD>
<P>0x2 </P>
</TD>

<TD>
<P>0x3 </P>
</TD>

<TD>
<P>0x3 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>disc_tmr_done (discovery timer done) </P>

<P> </P>

<P>Asserted when disc_tmr_en has been continuously asserted for 28 +/- 4 msec and the state machine is in the DISCOVERY or a RECOVERY state. The assertion of disc_tmr_done causes disc_tmr_en to be de-asserted. When the state machine is in a state other than the DISCOVERY or a RECOVERY state, disc_tmr_done is de-asserted. </P>

<P> </P>

<P>disc_tmr_en (discovery timer enable) </P>

<P> </P>

<P>When asserted, the discovery timer (disc_tmr) runs. When de-asserted, the discovery timer is reset to and maintains its initial value. </P>

<P> </P>

<P>force_1x_mode </P>

<P> </P>

<P>Asserted when all Nx (multi-lane) modes are disabled. When asserted, forces the </P>

<P>1x/Nx Initialization state machine to use 1x mode. </P>

<P> </P>

<P>force_laneR </P>

<P> </P>

<P>When force_1x_mode is asserted, force_laneR controls whether lane 0 or lane R, the redundancy lane, is preferred for 1x mode reception. If force_laneR is asserted, lane R is the preferred lane. If force_laneR is deasserted, lane 0 is the preferred lane. If the preferred lane is functional, it is selected by the port initialization state machine for 1x mode reception. If the preferred lane is not functional, the non-preferred lane, if functional, is selected for 1x mode reception. </P>

<P> </P>

<P>If force_1x_mode is not asserted, the state of force_laneR has no effect on the initialization state machine. </P>

<P> </P>

<P>force_reinit </P>

<P> </P>

<P>When asserted, forces the port Initialization state machine to re-initialize. The signal is set under software control and is cleared by the Initialization state machine. </P>

<P> </P>

<P>Icounter </P>

<P> </P>

<P>Counter  used  in  the  Lane_Synchronization state  machine  to  count  INVALID </P>

<P>received code-groups. There is one Icounter for each lane in a Nx mode receiver. </P>

<P> </P>

<P>idle_selected </P>

<P> </P>

<P>When asserted, indicates that the IDLE sequence for use on the link has been selected by the Idle Sequence Selection process specified in Section 4.7.5. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>If the port supports only one IDLE sequence at the current baud rate, the bit is always asserted. </P>

<P> </P>

<P>If the port supports multiple IDLE sequences at the current baud rate, the bit is de-asserted when the Initialization state machine is in the SILENT state and is otherwise controlled by the Idle Sequence Selection process. The Idle Sequence Selection process runs when the Initialization state machine is in the SEEK state and lane_sync has been asserted for lane 0, 1 and/or 2. The bit is asserted when the Idle Sequence Selection process completes. </P>

<P> </P>

<P>/INVALID/ </P>

<P> </P>

<P>When asserted, /INVALID/ indicates that the current code-group is an invalid code-group. </P>

<P> </P>

<P>Kcounter </P>

<P> </P>

<P>Counter  used  in  the  Lane_Synchronization  state  machine  to  count  received code-groups that contain a comma pattern. There is one Kcounter for each lane in a Nx mode receiver. </P>

<P> </P>

<P>lane_ready[n] </P>

<P> </P>

<P>lane_ready[n] = lane_sync[n] &amp; rcvr_trained[n] </P>

<P> </P>

<P>lane_sync </P>

<P> </P>

<P>Asserted by the Lane_Synchronization state machine when it determines that the lane it is monitoring is in bit synchronization and code-group boundary alignment. Otherwise de-asserted. </P>

<P> </P>

<P>lane_sync[n] </P>

<P> </P>

<P>The lane_sync signal for lane n. lanes01_drvr_oe </P>

<P>When asserted, the output drivers for lanes 0 and 1 are enabled lanes02_drvr_oe </P>

<P>When asserted, the output drivers for lanes 0 and 2 are enabled lanes13_drvr_oe </P>

<P>When asserted, the output drivers for lanes 1 and 3 are enabled link_drvr_oe (link driver output enable) </P>

<P>When asserted, the output link driver of a 1x port is enabled. Mcounter </P>

<P>Mcounter is used in the Lane_Alignment state machine to count columns received that contain at least one /A/, but not all /A/s. </P>

<P> </P>

<P> </P>

<P>104 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>N_lanes_aligned </P>

<P> </P>

<P>Asserted by the Lane_Alignment state machine when it determines that lanes 0 through N-1 are in sync and aligned. </P>

<P> </P>

<P>N_lanes_drvr_oe </P>

<P> </P>

<P>The output enable for the lanes 0 through N - 1. N_lanes_ready </P>

<P>N_lanes_ready = N_lanes_aligned &amp; lane_ready[0] &amp; ... &amp; lane_ready[N-1] N_lane_sync </P>

<P>Indicates when lanes 0 through N-1 of a receiver operating in Nx mode are in bit synchronization and code-group boundary alignment. </P>

<P> </P>

<P>N_lane_sync = lane_sync[0] &amp; ... &amp; lane_sync[N-1] Nx_mode </P>

<P>Asserted when the port is initialized and operating in Nx mode port_initialized </P>

<P>When asserted, port_initialized indicates that the port is initialized. Otherwise the port is not initialized. The state of port_initialized affects what the port may transmit on and accept from the link. </P>

<P> </P>

<P>receive_lane1 </P>

<P> </P>

<P>In a 2x port that is initialized and is operating in 1x mode (2x_mode de-asserted), receive_lane1 indicates which lane the port has selected for input. When asserted, the port input is taken from lane 1. When de-asserted the port input is taken from lane 0. When the port is operating in 2x mode (2x_mode asserted), receive_lane1 is undefined and shall be ignored. </P>

<P> </P>

<P>receive_lane2 </P>

<P> </P>

<P>In a Nx port that is initialized and is operating in 1x mode (Nx_mode de-asserted for all N &gt; 2), receive_lane2 indicates which lane the port has selected for input. When asserted, the port input is taken from lane 2. When de-asserted the port input is taken from lane 0. When the port is operating in Nx mode (some Nx_mode asserted), receive_lane2 is undefined and shall be ignored. </P>

<P> </P>

<P>rcvr_trained[n] </P>

<P> </P>

<P>De-asserted when the local lane[n] receiver controls adaptive equalization in the receiver and/or the connected lane[n] transmitter and the training of the equalization in either the lane[n] receiver or the connected lane[n] transmitter has not been </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 105 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>completed. Otherwise, asserted. seek_lanes_drvr_oe </P>

<P>The output enable for the lane 0 and the lane R output drivers of a 1x/Nx port. signal_detect </P>

<P>Asserted when a lane receiver is enabled and a signal meeting an implementation defined criteria is present at the input of the receiver. The use of signal_detect is implementation dependent. It may be continuously asserted or it may be used to require that some implementation defined additional condition be met before the Lane_Synchronization state machine is allowed to exit the NO_SYNC state. Signal_detect might for example be used to ensure that the input signal to a lane receiver meet some minimum AC input power requirement to prevent the receiver from locking on to crosstalk. </P>

<P> </P>

<P>silence_timer_done </P>

<P> </P>

<P>Asserted when silence_timer_en has been continuously asserted for 120 +/- 40 </P>

<P>µs   and   the   state   machine   is   in   the   SILENT  state.  The   assertion   of </P>

<P>silence_timer_done causes silence_timer_en to be de-asserted. When the state </P>

<P>machine is not in the SILENT state, silence_timer_done is de-asserted. </P>

<P> </P>

<P>silence_timer_en </P>

<P> </P>

<P>When asserted, the silence_timer runs. When de-asserted, the silence_timer is reset to and maintains its initial value. </P>

<P> </P>

<P>/VALID/ </P>

<P> </P>

<P>When asserted, /VALID/ indicates that the current code-group is a valid code-group given the current running disparity. </P>

<P> </P>

<P>Vcounter </P>

<P> </P>

<P>Vcounter is used in the Lane_Synchronization state machine to count VALID </P>

<P>received code-groups. There is one Vcounter for each lane in a Nx mode receiver. </P>

<P> </P>

<P>4.12.4.2  Lane Synchronization State Machine </P>

<P> </P>

<P>The Lane_Synchronization state machine monitors the bit synchronization and code-group boundary alignment for a lane receiver. A port that supports only 1x mode (1x port) has one Lane_Synchronization state machine. A port that supports Nx mode has N Lane_Synchronization state machines, one for each lane (Lane_Synchronization[0] through Lane_Synchronization[N-1]). </P>

<P> </P>

<P>The Lane_Synchronization state machine is specified in Figure 4-14 </P>

<P> </P>

<P>The state machine determines the bit synchronization and code-group boundary alignment state of a lane receiver by monitoring the received code-groups and looking for code-groups containing the &#8220;comma&#8221; pattern, other valid code-groups and invalid code-groups. The &#8220;comma&#8221; pattern is the bit sequence that is used to </P>

<P> </P>

<P>106 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>establish code-group boundary alignment. When a lane is error free the &#8220;comma&#8221; pattern occurs only in the /K28.1/ and /K28.5/ code-groups. Several counters are used to provide hysteresis so that occasional bit errors do not cause spurious lane_sync state changes. </P>

<P> </P>

<P>The state machine does not specify how bit synchronization and code-group boundary alignment is to be achieved. The methods used by a lane receiver to achieve bit synchronization and code-group boundary alignment are implementation dependent. However, an isolated single bit or burst error shall not cause the code-group boundary alignment mechanism to change alignment. For example, a single bit or burst error that results in a &#8220;comma&#8221; pattern across a code-group boundary shall not cause the code-group boundary alignment mechanism to change alignment. </P>

<P> </P>

<P>The state machine starts in the NO_SYNC state and sets the variables Kcounter[n], Vcounter[n], and lane_sync[n] to 0 (lane n is out of code-group boundary sync). It then looks for a /COMMA/ code-group. When it finds one and the signal signal_detect[n] is asserted, the machine moves to the NO_SYNC_1 state. </P>

<P> </P>

<P>The NO_SYNC_1 state in combination with the NO_SYNC_2 and NO_SYNC_3 states looks for the reception of 127 /COMMA/ and Vmin /VALID/ code-groups without any intervening /INVALID/ code-groups. When this condition is achieved, state machine goes to state SYNC. If an intervening /INVALID/ code-group is detected, the machine goes back to the NO_SYNC state. </P>

<P> </P>

<P>The values of 127 and Vmin are selected such that it is highly unlikely that SYNC would be falsely reported and that the bit error rate (BER) is low enough that it is highly unlikely that once asserted, lane_sync will &#8220;flicker&#8221; ON and OFF while the training of the receiver timing recovery and any adaptive equalization is completed. Vmin shall have a minimum value of 0 and is implementation dependent. When Vmin = 0, the behavior of this Lane_Synchronization state machine is identical to that of the Lane_Synchronization state machine specified in Rev. 1.3 of this specification. </P>

<P> </P>

<P>Table 4-11 shows the approximate maximum probability of lane_sync &#8220;flicker&#8221; for some values of Vmin and over the BER range of 1*10-2 to 1*10-12. It is recommended that Vmin be at least 212 - 1. </P>

<P> </P>

<P> </P>

<P>Table 4-11. lane_sync &#8220;Flicker&#8221; Probability </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Vmin </P>
</TD>

<TD>
<P>Approximate maximum probability of lane_sync flicker </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0.24 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>212 - 1 </P>
</TD>

<TD>
<P>0.021 </P>
</TD>
</TR>

<TR>
<TD>
<P>213 - 1 </P>
</TD>

<TD>
<P>0.011 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-11. lane_sync &#8220;Flicker&#8221; Probability </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Vmin </P>
</TD>

<TD>
<P>Approximate maximum probability of lane_sync flicker </P>
</TD>
</TR>

<TR>
<TD>
<P>214 - 1 </P>
</TD>

<TD>
<P>0.0056 </P>
</TD>
</TR>

<TR>
<TD>
<P>215 - 1 </P>
</TD>

<TD>
<P>0.0028 </P>
</TD>
</TR>

<TR>
<TD>
<P>216 - 1 </P>
</TD>

<TD>
<P>0.0014 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>When  Vmin = 0  and  IDLE1  is  being  received,  something  more  than  256 code-groups  must  be  received  after  the  first  /COMMA/  to  achieve  the  128 </P>

<P>/COMMA/ code-groups without error criteria to transition to the SYNC state because  the  /COMMA/  code-group  comprises  slightly  less  than  half  of  the code-groups in the IDLE1 sequence. </P>

<P> </P>

<P>When Vmin = 0 and IDLE2 is being received, something more than 9 Idle Frames must  be  received  after  the  first  /COMMA/  to  achieve  the  127  /COMMA/ code-groups without error to transition to the SYNC state because there are on average about 14 /COMMA/ code-groups per Idle Frame. </P>

<P> </P>

<P>In the SYNC state, the machine sets the variable lane_sync[n] to 1 (lane n is in code-group boundary sync), sets the variable Icounter[n] to 0 and begins looking for </P>

<P>/INVALID/ code-groups. If an /INVALID/ code-group is detected, the machine goes to state SYNC_1. </P>

<P> </P>

<P>The SYNC_1 state in combination with the SYNC_2, SYNC_3, and SYNC_4 states looks  for   255   consecutive  /VALID/  code-groups  without  any   /INVALID/ code-groups. When 255 /VALID/ symbols are received, the Icounter[n] value is decremented in the transition through the SYNC_4 state. If it does not, it increments Icounter[n]. If Icounter[n] is decremented back to 0, the state machine returns to the SYNC state. If Icounter[n] is incremented to Imax, the state machine goes to the NO_SYNC state and starts over. Imax is an integer and shall have a value of 3 or greater for receivers not using DFE and a value of 4 or greater for receivers using DFE. This algorithm tolerates isolated single bit or burst errors in that an isolated single bit or burst error will not cause the machine to change the variable lane_sync[n] from 1 to 0 (in sync to out of sync). </P>

<P> </P>

<P>A single bit error at the code-group level can cause two INVALID characters to be reported, one due to a corrupted code-group and one due to corrupted running disparity with causes a subsequent code-group to be reported as INVALID. A burst error no longer than 11 bits in length can cause three INVALID characters to be reported, two due to two corrupted code-groups and one due to corrupted running disparity which causes a subsequent code-group to be reported as INVALID. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>reset | change(signal_detect) </P>

<P> </P>

<P> </P>

<P>NO_SYNC </P>

<P>lane_sync[n] = 0 </P>

<P>Kcounter[n] = 0 </P>

<P>Vcounter[n] = 0 next_code_group() </P>

<P>signal_detect[n] &amp; /COMMA/ !signal_detect[n] | !/COMMA/ </P>

<P> </P>

<P> </P>

<P>NO_SYNC_1 </P>

<P>Kcounter[n] = Kcounter[n] + 1 </P>

<P>Vcounter[n] = Vcounter[n] + 1 </P>

<P> </P>

<P>(Kcounter[n] &gt;126) &amp; (Vcounter[n] &gt; Vmin -1) </P>

<P>(Kcounter[n] &lt; 127) </P>

<P>| (Vcounter[n] &lt; Vmin) </P>

<P> </P>

<P>NO_SYNC_2 </P>

<P>next_code_group( ) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>!(/COMMA/ | /INVALID/) </P>

<P> </P>

<P>NO_SYNC_3 </P>

<P>Vcounter[n] = Vcounter[n] + 1 </P>

<P> </P>

<P>/COMMA/ </P>

<P>/INVALID/ </P>

<P> </P>

<P> </P>

<P>SYNC </P>

<P>lane_sync[n] = 1 </P>

<P>Icounter[n] = 0 next_code_group( ) </P>

<P> </P>

<P>/VALID/ </P>

<P>/INVALID/ </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Icounter[n] = Imax </P>

<P>SYNC_1 </P>

<P>Icounter[n] = Icounter[n] + 1 </P>

<P>Vcounter[n]  = 0 </P>

<P>Icounter[n] &lt; Imax </P>

<P> </P>

<P> </P>

<P> </P>

<P>SYNC_2 </P>

<P>next_code_group( ) </P>

<P>/VALID/ </P>

<P> </P>

<P> </P>

<P> </P>

<P>/INVALID/ </P>

<P> </P>

<P>SYNC_3 </P>

<P>Vcounter[n]  = Vcounter[n]  + 1 </P>

<P>Vcounter[n] &lt; 255 </P>

<P>Vcounter[n] = 255 </P>

<P> </P>

<P>SYNC_4 </P>

<P>Icounter[n] = Icounter[n] - 1 </P>

<P>Vcounter[n]  = 0 </P>

<P> </P>

<P>Icounter[n] &gt; 0 </P>

<P> </P>

<P>Icounter[n] = 0 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_964.jpg"/>
</Figure>

<P>Figure 4-14. Lane_Synchronization State Machine </P>

<P> </P>

<P>RapidIO Trade Association 109 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.12.4.3  Lane Alignment State Machine </P>

<P> </P>

<P>The Lane_Alignment state machine monitors the alignment of the output of the N lane receivers in a port operating in Nx mode. A port supporting one or more multi-lane modes has one Lane_Alignment state machine for each supported Nx mode. A port supporting only 1x mode does not have a Lane_Alignment state machine. Lane alignment is required in a Nx port receiver to compensate for unequal propagation delays through the N lanes. </P>

<P> </P>

<P>The Lane_Alignment state machine is specified in Figure 4-15. </P>

<P> </P>

<P>The state machine determines the alignment state by monitoring the N lanes for columns containing all /A/s (||A||), columns containing at least one but not all /A/s and columns containing no /A/s. Several counters are used to provide hysteresis so that isolated single bit or burst errors do not cause spurious lanes_aligned state changes. </P>

<P> </P>

<P>The state machine does not specify how lane alignment is to be achieved. The methods used by a port receiver to achieve lane alignment are implementation dependent. However, isolated single bit or burst errors shall not cause the lane alignment mechanism to change lane alignment. For example, an isolated single bit or burst error that results in a column that contains at least one /A/ but not all /A/s shall not cause the lane alignment mechanism to change the lane alignment. </P>

<P> </P>

<P>The state machine starts in the NOT_ALIGNED state where the variables Acounter and N_lanes_aligned are set to 0 (all N lanes are not aligned). The machine then waits for all N lanes to achieve code-group boundary alignment (N_lanes_sync asserted) and the reception of an ||A|| (a column of all /A/s). When this occurs, the machine goes to NOT_ALIGNED_1 state. </P>

<P> </P>

<P>The NOT_ALIGNED_1 state in combination with the NOT_ALIGNED_2 state looks for the reception of four ||A||s without the intervening reception of a misaligned column (a column with at least one /A/ but not all /A/s which causes the signal align_error to be asserted). When this occurs, the machine goes to the ALIGNED state. If an intervening misaligned column is received, the machine goes back to the NOT_ALIGNED state. </P>

<P> </P>

<P>In the ALIGNED state, the machine sets the variable N_lanes_aligned to 1 (all N lanes are aligned) and the variable Mcounter to 0 and looks for a misaligned column (align_error asserted). If a misaligned column is detected, the machine goes to the ALIGNED_1 state. </P>

<P> </P>

<P>The ALIGNED_1 state in combination with the ALIGNED_2 and ALIGNED_3 states look for the reception of four ||A||s without the intervening reception of more than Mmax - 1 additional misaligned columns. If this condition occurs, the state machine returns to the ALIGNED state. If Mmax - 1 additional intervening misaligned columns occurs, the machine goes to the NOT_ALIGNED state and </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>starts over. Mmax is an integer and shall have a value of 2 or greater for receivers not using DFE and a value of 3 or greater for receivers using DFE. </P>

<P> </P>

<P>This algorithm tolerates an isolated single bit or burst error in that such an error will not cause the machine to change the variable N_lanes_aligned from 1 to 0 (in lane alignment to out of lane alignment). </P>

<P> </P>

<P> </P>

<P>reset | change(N_lane_sync) </P>

<P> </P>

<P> </P>

<P>NOT_ALIGNED </P>

<P>N_lanes_aligned = 0 </P>

<P>Acounter = 0 next_colunm( ) </P>

<P> </P>

<P>!(N_lane_sync &amp; ||A||) </P>

<P>N_lane_sync &amp; ||A|| </P>

<P> </P>

<P> </P>

<P>NOT_ALIGNED_1 </P>

<P>Acounter = Acounter + 1 </P>

<P>Acounter = 4 Acounter &lt; 4 </P>

<P> </P>

<P> </P>

<P>NOT_ALIGNED_2 </P>

<P>next_column( ) </P>

<P>!align_error &amp; !||A|| </P>

<P>||A|| </P>

<P>align_error </P>

<P> </P>

<P> </P>

<P> </P>

<P>ALIGNED </P>

<P>N_lanes_aligned = 1 </P>

<P>Mcounter = 0 next_column() </P>

<P>align_error !align_error </P>

<P> </P>

<P> </P>

<P>ALIGNED_1 </P>

<P>Acounter = 0 </P>

<P>Mcounter = Mcounter + 1 </P>

<P> </P>

<P>Mcounter = Mmax Mcounter &lt; Mmax </P>

<P> </P>

<P> </P>

<P>ALIGNED_2 </P>

<P>next_column( ) </P>

<P>||A|| </P>

<P>!align_error &amp; !||A|| </P>

<P>align_error </P>

<P> </P>

<P>ALIGNED_3 </P>

<P>Acounter = Acounter + 1 </P>

<P>Acounter &lt; 4 </P>

<P>Acounter = 4 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_965.jpg"/>
</Figure>

<P>Figure 4-15. Lane_Alignment State Machine </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.12.4.4  1x/2x Mode Detect State Machine </P>

<P> </P>

<P>The 1x/2x_Mode_Detect state machine monitors the columns formed from aligned characters received on lanes 0 and 1 of a port that supports 2x mode. When such a port is receiving an input signal on only lanes 0 and 1, the state machine is used to determine whether the connected port is transmitting in 1x mode or in 2x mode. A port that supports 2x mode shall have one 1x/2x_Mode_Detect state machine. </P>

<P> </P>

<P>The 1x/2x_Mode_Detect state machine is specified in Figure 4-16. </P>

<P> </P>

<P>Except for the case of N = 2, a 1x/Nx receiver can tell whether the connected port is operating in 1x mode or Nx mode by observing the number of active lanes it is receiving (the number of lanes for which lane_sync[n] is asserted). This follows from the fact that a 1x/Nx port operating in 1x mode transmits only on lanes 0 and R. In the case of N = 2, the port transmits on both lanes regardless of whether it is operating in 1x or 2x mode making it impossible for a 1x/2x receiver to determine the mode of the connected port based on the number of active lanes it is receiving. The 1x/2x_Mode_Detect state machine provides mode detection for the 1x/2x receiver. </P>

<P> </P>

<P>The 1x/2x_Mode_Detect state machine enters the INITIALIZE state whenever the port is reset or the state of 2_lanes_aligned changes state. The machine initializes the </P>

<P>1x_mode_detected and Dcounter variables (the connected port is initially assumed to be operating in 2x mode) and waits for the lanes to become aligned. Once the two lanes are aligned, the machine goes to the GET_COLUMN state to get the next available column. </P>

<P> </P>

<P>In the GET_COLUMN state, each column is examined as it becomes available to determine whether it contains any control symbol delimiter special characters (SC or PD characters). If no SC or PD characters are found, no action is taken and the state machine remains in the GET_COLUMN state. If the column contains a single SC or PD special character, the column is determined to be a 2x mode delimiter and the state machine enters the 2x_DELIMITER state. If the column contains a two SC or two PD special characters, the column is determined to be a 1x mode delimiter and the state machine enters the 1x_DELIMITER state. </P>

<P> </P>

<P>In the 1x_DELIMITER state, the Dcounter is decremented by 1 and the value of the Dcounter  is  tested.  If  the  Dcounter  is  &gt; 0,  the  state  machine  goes  to  the GET_COLUMN state.  If  the  Dcounter is  = 0,  the  state  machine goes  to  the SET_1x_MODE state where 1x_mode_detected is set to 1. The state machine then goes to the GET_COLUMN state. </P>

<P> </P>

<P>In the 2x_DELIMITER state, the Dcounter is incremented by 1 and the value of the Dcounter  is  tested.  If  the  Dcounter  is  &lt; 3,  the  state  machine  goes  to  the GET_COLUMN state.  If  the  Dcounter is  = 3,  the  state  machine goes  to  the SET_2x_MODE state where 1x_mode_detected is set to 0. The state machine then goes to the GET_COLUMN state. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The Dcounter is used to prevent transmission errors from erroneously changing the state of 1x_mode_detected. </P>

<P> </P>

<P> </P>

<P> </P>

<P>reset | change(2_lanes_aligned) </P>

<P> </P>

<P>INITIALIZE </P>

<P> </P>

<P>1x_mode_detected = 0 </P>

<P>Dcounter = 3 </P>

<P> </P>

<P>2_lanes_aligned </P>

<P> </P>

<P> </P>

<P>GET_COLUMN </P>

<P> </P>

<P>next_2column( ) </P>

<P> </P>

<P>!1x_mode_delimiter &amp; </P>

<P>!2x_mode_delimiter </P>

<P> </P>

<P>1x_mode_delimiter 2x_mode_delimiter </P>

<P> </P>

<P> </P>

<P>1x_DELIMITER  2x_DELIMITER </P>

<P> </P>

<P>Dcounter = Dcounter - 1 Dcounter = Dcounter + 1 </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>SET_2x_MODE </P>
</TD>
</TR>

<TR>
<TD>
<P>1x_mode_detected = 0 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Dcounter = 0 Dcounter &gt; 0 </P>

<P>Dcounter &lt; 3 </P>

<P>Dcounter = 3 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>SET_1x_MODE </P>
</TD>
</TR>

<TR>
<TD>
<P>1x_mode_detected = 1 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_966.jpg"/>
</Figure>

<P>Figure 4-16. 1x/2x_Mode_Detect State Machine </P>

<P> </P>

<P>4.12.4.5  1x Mode Initialization State Machine </P>

<P> </P>

<P>The 1x_Initialization state machine specified in this section shall be used by ports that support only 1x mode (1x ports). The state machine is specified in Figure 4-17. </P>

<P> </P>

<P>The machine starts in the SILENT state. The link output driver is disabled to force the link partner to initialize regardless of its current state. The duration of the SILENT state is controlled by the silence_timer. The duration must be long enough to ensure that the link partner detects the silence (as a loss of lane_sync) and is forced to initialize but short enough that it is readily distinguished from a link break. When the silent interval is complete, the SEEK state is entered. </P>

<P> </P>

<P>In the SEEK state, the link output driver is enabled, an idle sequence is transmitted, and the port waits for lane_ready to be asserted indicating the presence of a link partner. While lane_ready as defined indicates the bit and code-group boundary </P>

<P> </P>

<P>RapidIO Trade Association 113 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>alignment state of the link receiver, it is used by the state machine to indicate the presence of a link partner. When lane_ready and idle_selected are both asserted, the </P>

<P>1X_MODE state is entered. </P>

<P>The input signal force_reinit allows the port to force link initialization at any time. The variable port_initialized is asserted only in the 1X_MODE state. </P>

<P> </P>

<P> </P>

<P>reset </P>

<P> </P>

<P> </P>

<P>SILENT </P>

<P> </P>

<P>link_drvr_oe = 0 port_initialized = 0 force_reinit = 0 silence_timer_en = 1 </P>

<P> </P>

<P>silence_timer_done </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>SEEK </P>
</TD>
</TR>

<TR>
<TD>
<P>port_initialized = 0 link_drvr_oe = 1 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>lane_ready </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>&amp; </P>

<P>idle_selected </P>

<P> </P>

<P>1X_MODE </P>

<P> </P>

<P>port_initialized = 1 </P>

<P> </P>

<P> </P>

<P>!lane_ready &amp; </P>

<P>lane_sync &amp; </P>

<P>!force_reinit </P>

<P>!lane_sync </P>

<P>| force_reinit </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_967.jpg"/>
</Figure>

<P>Figure 4-17. 1x_Initialization State Machine </P>

<P> </P>

<P>4.12.4.6  1x/Nx Mode Initialization State Machine for N = 4, 8, 16 </P>

<P> </P>

<P>The 1x/Nx_Initialization state machines specified in this section shall be used by ports that support both 1x mode and an Nx mode (1x/Nx ports) for N = 4, 8 or 16. The initialization state machine for 1x/2x ports is specified in Section 4.12.4.7. </P>

<P>1x/8x and 1x/16x ports shall use the 1x/Nx_Initialization state machine specified in Figure 4-18. 1x/4x ports should use the 1x/Nx_Initialization state machine specified in Figure 4-18, but may use the 1x/4x_Initialization state machine specified in Figure 4-19. The 1x/4x_Initialization state machine of Figure 4-19 shall not be used in new designs. </P>

<P> </P>

<P>The 1x/Nx_Initialization state machine controls port initialization and determines when the port is initialized. The state machine also controls whether the port receiver operates in 1x or Nx mode and in 1x mode whether lane 0 or lane 2, the 1x mode redundancy lane, is selected for control symbol and packet reception. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>114 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The 1x/Nx_Initialization state machine starts in SILENT state. All N lane output drivers are disabled to force the link partner to re-initialize regardless of its current state. The duration of the SILENT state is controlled by the silence_timer. The duration must be long enough to ensure that the link partner detects the silence (as a loss of lane_sync) and is forced to re-initialize. When the silent interval is complete, the state machine enters the SEEK state. </P>

<P> </P>

<P>In the SEEK state, a 1x/Nx port transmits an idle sequence on lanes 0 and 2 (the other output drivers remain disabled to save power) and waits for an indication that a link partner is present. While lane_sync as defined indicates the bit and code-group boundary alignment state of a lane receiver, it is used by the state machine to indicate the presence of a link partner. A link partner is declared to be present when either lane_sync[0] or lane_sync[2] is asserted. The assertion of idle_selected and either lane_sync[0] or lane_sync[2] causes the state machine to enter the DISCOVERY state. </P>

<P> </P>

<P>In the DISCOVERY state, the port enables the output drivers for all N lanes and transmits an idle sequence on all N lanes if Nx mode is enabled. The discovery timer (disc_tmr) is started. The discovery timer allows time for the link partner to enter its DISCOVERY state and if Nx mode is enabled in the link partner, for all N local lane receivers to acquire bit synchronization and code-group boundary alignment and to complete the training of any adaptive equalization that is present and for all N lanes to be aligned. </P>

<P> </P>

<P>While waiting for the end of the discovery period (disc_tmr_en asserted but disc_tmr_done de-asserted), if Nx_mode is enabled, all N lanes become ready and lane alignment is achieved (N_lanes_ready asserted), the machine enters the Nx_MODE state. If force_1x_mode is asserted (Nx_mode_enabled is deasserted), force_laneR is not asserted and lane 0 becomes ready (lane_ready[0] asserted), the machine enters the 1x_MODE_LANE0 state. If both force_1x_mode and force_laneR are asserted and lane 2 becomes ready (lane_ready[2] asserted), the machine enters the 1x_MODE_LANE2 state. </P>

<P> </P>

<P>At the end of the discovery period (disc_tmr_done asserted), if the state machine has not entered the Nx_mode or one of the 1x modes and at least one of lane 0 or lane 2 is ready, the machine will enter one of the 1x mode states. If lane 0 is ready and either force_1x_mode and force_laneR are asserted but lane 2 is not ready or Nx mode is enabled but    N_lanes_ready    is    deasserted,    the    machine    enters    the </P>

<P>1X_MODE_LANE0 state. If lane 2 is ready, lane 0 is not ready and either force_1x_mode is asserted and force_laneR is not asserted or neither force_1x_mode   nor   N_lanes_ready   are   asserted,   the   machine   enters   the </P>

<P>1X_MODE_LANE2 state. If neither lane_ready[0] nor lane_ready[2] is asserted, the machine enters the SILENT state and restarts the port initialization process. </P>

<P> </P>

<P>If lane synchronization for both lane 0 and lane R is lost (both lane_sync[0] and lane_sync[2] de-asserted) during the DISCOVERY state, the state machine enters the SILENT state and restarts the port initialization process. </P>

<P> </P>

<P>RapidIO Trade Association 115 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>When in the Nx_MODE state, port_initialized is asserted. If N_lanes_ready is lost (N_lanes_ready de-asserted), the state machine transitions to either the SILENT state if both lane_sync[0] and lane_sync[2] are de-asserted or the DISCOVERY state if either lane_sync[0] or lane_sync[2] is asserted. This allows a 1x/Nx port in the Nx_MODE state to recover to Nx_MODE if N_lanes_ready was de-asserted due to multi-bit reception error or the need to retrain some of the adaptive equalization, but also allows the port to switch to 1x mode if the port is no longer able to receive in Nx mode or if the connected 1x/Nx port is not able to receive in Nx mode and has switched to 1x mode. </P>

<P> </P>

<P>When in the 1x_MODE_LANE0 state, port_initialized is asserted. If lane_ready[0] </P>

<P>is de-asserted but lane_sync[0] is still asserted, the machine transitions to the </P>

<P>1x_RECOVERY state to attempt recovery to the 1x_MODE_LANE0 state. If lane_sync[0] is de-asserted the state machine enters the SILENT state. </P>

<P> </P>

<P>When in the 1x_MODE_LANE2 state, port_initialized is asserted. If lane_ready[2] </P>

<P>is de-asserted but lane_sync[2] is still asserted, the machine transitions to the </P>

<P>1x_RECOVERY state to attempt recovery to the 1x_MODE_LANER state. If lane_sync[2] is de-asserted, the state machine enters the SILENT state. </P>

<P> </P>

<P>When the 1x_RECOVERY state is entered, the discovery timer (disc_tmr_en asserted) is started. The port reenters the 1x_MODE_LANE0 state if lane_ready[0] is reasserted and the port was in the 1x_MODE_LANE0 state immediately before entering the 1x_RECOVERY state. The port reenters the 1x_MODE_LANE2 state if lane_ready[2] is reasserted and the port was in the 1x_MODE_LANE2 state immediately before entering the 1x_RECOVERY state. If both lane_sync[0] and lane_sync[2] are lost (both lane_sync[0] and lane_sync[R] de-asserted), the SILENT state in entered. To prevent that state machine from possibly being stuck in the 1x_RECOVERY state, if the appropriate lane_ready[ ] is not asserted before the discovery time is up (disc_tmr_done asserted), the SILENT state is entered. </P>

<P> </P>

<P>The state machine does not support recovery from a 1x mode state to Nx_MODE or the other 1x mode without going through the SILENT state. </P>

<P> </P>

<P>The input signals force_1x_mode and force_laneR allow the state of the machine to be forced during initialization into 1x mode, and in 1x mode to be forced to receive on lane 2. </P>

<P> </P>

<P>The input signal force_reinit allows the port to force port n link re-initialization at any time. </P>

<P> </P>

<P>The   variable   port_initialized  is   asserted   only   in   the   1x_MODE_LANE0, </P>

<P>1x_MODE_LANE2 and Nx_MODE states. </P>

<P> </P>

<P>NOTE: </P>

<P>The name and specified function of the state machine variable N_lanes_drvr_oe is potentially confusing. As specified, its assertion causes the drivers for all N lanes of an Nx link to be output enabled. </P>

<P> </P>

<P>116 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>However, N_lanes_drvr_oe is only asserted when the state machine variable lanes02_drvr_oe is also asserted. (The assertion of lanes02_drvr_oe causes the drivers for lane 0 and 2 to be output enabled). As  a  consequence,  the  net  effect  of  the  assertion  or de-assertion of N_lanes_drvr_oe is that the drivers of all of the N lanes except the lanes 0 and 2 are output enabled or disabled respectively. The operation of an implementation that uses lanes02_drvr_oe as the output enable for the seek lane drivers and N_lanes_drvr_oe as the output enable for the remaining N-2 lanes will be operationally indistinguishable from an implementation that uses (lanes02_drvr_oe OR N_lanes_drvr_oe) as the output enable for the seek lane drivers and N_lanes_drvr_oe as the output enable for the remaining N-2 lanes. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_968.jpg"/>
</Figure>

<P>reset | force_reinit </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>SILENT </P>
</TD>
</TR>

<TR>
<TD>
<P>disc_tmr_en = 0 lanes02_drvr_oe = 0 </P>

<P>N_lanes_drvr_oe = 0 </P>

<P>port_initialized = 0 </P>

<P>Nx_mode = 0 receive_lane2 = 0 </P>

<P>force_reinit = 0 silence_timer_en = 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>ce_timer_done </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>silen </P>

<P> </P>

<P>SEEK </P>

<P> </P>

<P>lanes02_drvr_oe = 1 </P>

<P> </P>

<P>(lane_sync[0] </P>

<P>| lane_sync[2]) &amp; </P>

<P>idle_selected </P>

<P> </P>

<P> </P>

<P>DISCOVERY </P>

<P> </P>

<P>port_initialized = 0 </P>

<P>Nx_mode = 0 </P>

<P>N_lanes_drvr_oe = Nx_mode_enabled </P>

<P>disc_tmr_en = 1 </P>

<P> </P>

<P>1x_RECOVERY </P>

<P> </P>

<P>port_initialized = 0 disc_tmr_en = 1 </P>

<P> </P>

<P>!lane_sync[0] &amp; </P>

<P>!lane_sync[2] | </P>

<P>disc_tmr_done &amp; </P>

<P>!lane_ready[0] &amp; </P>

<P>!lane_ready[2] </P>

<P> </P>

<P> </P>

<P> </P>

<P>Nx_mode_enabled </P>

<P>&amp; N_lanes_ready </P>

<P> </P>

<P> </P>

<P>lane_ready[2] &amp; (force_1x_mode &amp; force_laneR </P>

<P>| disc_tmr_done &amp; !lane_ready[0] &amp; (force_1x_mode &amp; !force_laneR </P>

<P>| !force_1x_mode &amp; !N_lanes_ready)) </P>

<P> </P>

<P> </P>

<P>lane_ready[0] &amp; (force_1x_mode &amp; (!force_laneR </P>

<P> </P>

<P>lane_ready[0] &amp; </P>

<P>!receive_lane2 &amp; </P>

<P>!disc_tmr_done </P>

<P> </P>

<P>!lane_sync[0] &amp; </P>

<P>!lane_sync[2] </P>

<P>| disc_tmr_done </P>

<P> </P>

<P> </P>

<P>lane_ready[2] &amp; </P>

<P>receive_lane2 &amp; </P>

<P>!disc_tmr_done </P>

<P>| force_laneR &amp; disc_tmr_done &amp; !lane_ready[2]) </P>

<P>| !force_1x_mode &amp; disc_tmr_done &amp; !N_lanes_ready) </P>

<P> </P>

<P> </P>

<P>Nx_MODE 1x_MODE_LANE0 </P>

<P>1x_MODE_LANE2 </P>

<P> </P>

<P>disc_tmr_en = 0 </P>

<P>Nx_mode = 1 port_initialized = 1 </P>

<P> </P>

<P>disc_tmr_en = 0 </P>

<P>N_lanes_drvr_oe = 0&#61472;&#61472;</P>

<P>port_initialized = 1 </P>

<P> </P>

<P>disc_tmr_en = 0 receive_lane2 = 1 </P>

<P>N_lanes_drvr_oe = 0&#61472;&#61472;</P>

<P>port_initialized = 1 </P>

<P> </P>

<P>!N_lanes_ready &amp; (lane_sync[0] </P>

<P>| lane_sync[2]) </P>

<P> </P>

<P>!N_lanes_ready &amp; </P>

<P>!lane_sync[0] &amp; </P>

<P>!lane_sync[2] </P>

<P> </P>

<P>!lane_ready[0] </P>

<P>&amp; lane_sync[0] </P>

<P> </P>

<P>!lane_ready[2] </P>

<P>&amp; lane_sync[2] </P>

<P> </P>

<P>!lane_sync[0] </P>

<P>!lane_sync[2] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_969.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 4-18. 1x/Nx_Initialization State Machine for N = 4, 8, 16 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The following Initialization state machine may be used for 1x/4x ports that support only the IDLE1 idle sequence. The only difference between the 1x/Nx Initialization state  machine  of  Figure 4-18  and  the  1x/4x_Initialization  state  machine  of Figure 4-19   is   that   the   1x/4x_Initialization   machine   does   not   have   the </P>

<P>1x_RECOVERY state. As a consequence, the machines have different behavior when force_1x_mode is asserted. Unlike the 1x/Nx machine, the 1x/4x machine does not have a bias for the 1x_MODE_LANE0 state when force_1x_mode is not asserted. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>reset </P>

<P> </P>

<P> </P>

<P>SILENT </P>

<P>disc_tmr_en = 0 lanes02_drvr_oe = 0 lanes13_drvr_oe = 0 port_initialized = 0 </P>

<P>4x_mode = 0 receive_laneR = 0 force_reinit = 0 silence_timer_en = 1 </P>

<P> </P>

<P>silence_timer_done </P>

<P> </P>

<P> </P>

<P>SEEK </P>

<P> </P>

<P>lanes02_drvr_oe = 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>DISCOVERY </P>

<P> </P>

<P>port_initialized = 0 </P>

<P>4x_mode = 0 lanes13_drvr_oe = 1 </P>

<P>disc_tmr_en = 1 </P>

<P>!force_1x_mode &amp; (lane_sync[0] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_970.jpg"/>
</Figure>

<P>| lane_sync[2]) </P>

<P>force_1x_mode &amp; (!lane_ready[0] | force_laneR) &amp; lane_ready[2]) </P>

<P> </P>

<P>force_1x_mode &amp; </P>

<P>!force_laneR &amp; </P>

<P>lane_ready[0] </P>

<P> </P>

<P>!lane_sync[0] &amp; </P>

<P>!lane_sync[2] </P>

<P> </P>

<P> </P>

<P>4_lanes_ready </P>

<P>disc_tmr_done &amp; </P>

<P>!4_lanes_ready &amp; </P>

<P>!lane_ready[0] &amp; </P>

<P>lane_ready[2] </P>

<P> </P>

<P>disc_tmr_done &amp; </P>

<P>!4_lanes_ready &amp; lane_ready[0] </P>

<P> </P>

<P> </P>

<P>4x_MODE 1x_MODE_LANE0 </P>

<P>1x_MODE_LANE2 </P>

<P> </P>

<P>disc_tmr_en = 0 </P>

<P>4x_mode = 1 port_initialized = 1 </P>

<P> </P>

<P>lanes13_drvr_oe = 0&#61472;&#61472;</P>

<P>port_initialized = 1 </P>

<P> </P>

<P>receive_laneR = 1 lanes13_drvr_oe = 0&#61472; port_initialized = 1 </P>

<P> </P>

<P>!4_lanes_ready &amp; (lane_sync[0] </P>

<P>| lane_sync[2]) </P>

<P> </P>

<P>(!4_lanes_ready &amp; </P>

<P>!lane_sync[0] &amp; </P>

<P>!lane_sync[2]) </P>

<P>| force_reinit </P>

<P>!lane_ready[0] </P>

<P>&amp; lane_sync[0] </P>

<P> </P>

<P> </P>

<P>!lane_sync[0] </P>

<P>| force_reinit </P>

<P>!lane_ready[2] </P>

<P>&amp; lane_sync[2] </P>

<P> </P>

<P> </P>

<P>!lane_sync[2] </P>

<P>| force_reinit </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_971.jpg"/>
</Figure>

<P>Figure 4-19. Alternate 1x/4x_Initialization State Machine </P>

<P> </P>

<P>4.12.4.7  1x/2x Mode Initialization State Machine </P>

<P> </P>

<P>The 1x/2x_Initialization state machine specified in this section shall be used by </P>

<P>1x/2x ports. Except for the method it uses to decide whether to operate in 1x or 2x </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>mode and the use of lane 1 as the redundancy lane, this state machine is identical to the 1x/Nx_Initialization state machine specified in Figure 4-18 with N = 2. </P>

<P> </P>

<P>Ports that support more than 2 lanes disable all lanes except lanes 0 and R when operating in 1x mode. This allows the Initialization state machine for a port supporting more than 2 lanes to use the number of active lanes the port is receiving to determine whether to operate in 1x or Nx mode. 1x/2x ports transmit on both lanes regardless of whether they are operating in 1x or 2x mode. As a result, 1x/2x ports need a mechanism other than the number of active lanes being received to determine whether to operate in 1x or 2x mode. The 1x/2x_Mode_Detect state machine specified in Section 4.12.4.4 provides this mechanism. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_972.jpg"/>
</Figure>

<P>reset | force_reinit </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>SILENT </P>
</TD>
</TR>

<TR>
<TD>
<P>disc_tmr_en = 0 lanes01_drvr_oe = 0 port_initialized = 0 </P>

<P>2x_mode = 0 receive_lane1 = 0 force_reinit = 0 silence_timer_en = 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>e_timer_done </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>silenc </P>

<P> </P>

<P>SEEK </P>

<P> </P>

<P>lanes01_drvr_oe = 1 </P>

<P> </P>

<P> </P>

<P>(lane_sync[0] </P>

<P>| lane_sync[1]) &amp; </P>

<P>idle_selected </P>

<P> </P>

<P> </P>

<P>DISCOVERY </P>

<P> </P>

<P>port_initialized = 0 </P>

<P>2x_mode = 0 disc_tmr_en = 1 </P>

<P>1x_RECOVERY </P>

<P> </P>

<P>port_initialized = 0 disc_tmr_en = 1 </P>

<P> </P>

<P> </P>

<P>!lane_sync[0] &amp; </P>

<P>!lane_sync[1] | </P>

<P>disc_tmr_done &amp; </P>

<P>!lane_ready[0] &amp; </P>

<P>!lane_ready[1] </P>

<P> </P>

<P> </P>

<P>2x_mode_enable &amp; </P>

<P>2_lanes_ready &amp; </P>

<P>!1x_mode_detected </P>

<P> </P>

<P>lane_ready[1] &amp; (force_1x_mode &amp; force_laneR </P>

<P>| disc_tmr_done &amp; !lane_ready[0] &amp; (force_1x_mode &amp; !force_laneR </P>

<P>| !force_1x_mode &amp; !2_lanes_ready)) </P>

<P> </P>

<P>lane_ready[0] &amp; (force_1x_mode &amp; (!force_laneR </P>

<P>lane_ready[0] &amp; </P>

<P>!receive_lane1&amp; </P>

<P>!disc_tmr_done </P>

<P>!lane_sync[0] &amp; </P>

<P>!lane_sync[1] </P>

<P>| disc_tmr_done </P>

<P> </P>

<P> </P>

<P>lane_ready[1] &amp; </P>

<P>receive_lane1 &amp; </P>

<P>!disc_tmr_done </P>

<P>| force_laneR &amp; disc_tmr_done &amp; !lane_ready[1]) </P>

<P>| !force_1x_mode &amp; disc_tmr_done &amp; !2_lanes_ready) </P>

<P>| !force_1x_mode &amp; 2_lanes_ready &amp; 1x_mode_detected </P>

<P> </P>

<P> </P>

<P>2x_MODE 1x_MODE_LANE0 </P>

<P>1x_MODE_LANE1 </P>

<P> </P>

<P>disc_tmr_en = 0 </P>

<P>2x_mode = 1 port_initialized = 1 </P>

<P> </P>

<P>disc_tmr_en = 0 port_initialized = 1 </P>

<P> </P>

<P>disc_tmr_en = 0 receive_lane1 = 1 port_initialized = 1 </P>

<P> </P>

<P>!2_lanes_ready &amp; (lane_sync[0] </P>

<P>| lane_sync[1]) </P>

<P>| 2_lanes_ready &amp; </P>

<P>1x_mode_detected </P>

<P>!2_lanes_ready &amp; </P>

<P>!lane_sync[0] &amp; </P>

<P>!lane_sync[1] </P>

<P>!lane_ready[0] </P>

<P>&amp; lane_sync[0] </P>

<P> </P>

<P> </P>

<P>!lane_sync[0] </P>

<P>!lane_ready[1] </P>

<P>&amp; lane_sync[1] </P>

<P> </P>

<P> </P>

<P>!lane_sync[1] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_973.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 4-20. 1x/2x_Initialization State Machine </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>4.12.4.8  1x/Mx/Nx Mode Initialization State Machines </P>

<P> </P>

<P>A Nx port may optionally support more than one multi-lane mode of operation. For example, an 8x port may support 4x mode in addition to the 8x mode and 1x modes. A port supporting more than one multi-lane mode is referred to as a 1x/Mx/ .... /Nx port where 1 &lt; M &lt; ... &lt; N. </P>

<P> </P>

<P>The initialization state machine for a port that supports multiple multi-lane modes of operation requires two or three additional states for each additional supported mode of multi-lane operation. </P>

<P> </P>

<P>Like the 1x/Nx_Initialization state machine, the 1x/Mx/Nx_Initialization state machines support link width negotiation. The negotiation algorithm implemented by the state machine attempts to select the greatest link width supported by both ports of a connected port pair. However, once a link width is selected, a wider link width can be selected only if the state machine enters the SILENT state which restarts the selection algorithm. </P>

<P> </P>

<P>4.12.4.8.1  1x/2x/Nx Initialization State Machine </P>

<P> </P>

<P>The 1x/2x/Nx_Initialization state machine is specified in Figure 4-21 and shall be used by 1x/2x/Nx ports. Because the redundancy lane, lane R, differs for a 1x/2x port and a 1x/Nx port (N = 4, 8 or 16), the Initialization state machine for a 1x/2x/Nx port is the most complicated of the possible 1x/Mx/Nx_Initialization state machines. </P>

<P> </P>

<P>The   1x/2x/Nx_Initialization  state   machine   has   three   more   states   than   a </P>

<P>1x/Nx_Initialization  state  machine,  the  2x_MODE,  2x_RECOVERY  and  the </P>

<P>1x_MODE_LANE1 states </P>

<P> </P>

<P>The operation of the 1x/2x/Nx_Initialization state machine is essentially the same as that of a 1x/2x_Initialization state machine for the 1x and 2x modes operation and that of a 1x/Nx_Initialization state machine for Nx mode operation. The differences between the 1x/2x/Nx_Initialization state machine and the 1x/2x_Initialization and </P>

<P>1x/Nx_Initialization state machines are as follows. </P>

<P> </P>

<P>In the SEEK state, the lanes whose drivers are output enabled depend on the modes that are enabled. Lanes 0 and 1 are output enabled if the 2x mode is enabled. Lanes </P>

<P>0 and 2 are output enabled if the Nx mode is enabled or the 2x mode is disabled. And if both modes are enabled, lanes 0, 1 and 2 are output enabled. The state machine enters the DISCOVERY state when lane_sync is asserted for lanes 0, 1 or 2. </P>

<P> </P>

<P>In the DISCOVERY state, the lane selection priority for 1x mode is lane 0 first, lane </P>

<P>2 second and lane 1 third. This priority is to bias the selection to lane 0 and to ensure that lane 2, not lane 1, is selected when 4x mode or wider is enabled in the connected port. </P>

<P> </P>

<P>In the 2x_MODE state, the state machine transitions to the 2x_RECOVERY state if </P>

<P>1x_mode_detected is asserted. The state machine goes to the 2x_RECOVERY state rather than directly to the 1x_MODE_LANE0 state so that the port_initialized bit is </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>de-asserted indicating that the port is no longer in the normal operational state and that the link must be re-initialized before packet transmission can be resumed. Once in   the   2x_RECOVERY  state,   the   state   machine   then   transitions   to   the </P>

<P>1x_MODE_LANE0 state if both 2_lanes_ready and 1x_mode_detected are still asserted. </P>

<P> </P>

<P>The 2x_RECOVERY state is used to prevent the port from recovering to Nx mode once 2x mode has been selected. </P>

<P> </P>

<P>In the 1x_MODE_LANE2 state, the state machine is allowed to transition to the </P>

<P>1x_MODE_LANE1 state via the 1x_RECOVERY state in the event that the connected port is a 1x/2x/Nx port and the connected port switches to 2x_MODE. </P>

<P> </P>

<P> </P>

<P>reset | force_reinit </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>SEEK </P>

<P>lanes01_drvr_oe = </P>

<P>2x_mode_enabled lanes02_drvr_oe = </P>

<P>Nx_mode_enabled </P>

<P>| !2x_mode_enabled </P>

<P> </P>

<P>SKtoD </P>

<P> </P>

<P> </P>

<P>DISCOVERY </P>

<P>port_initialized = 0 </P>

<P>Nx_mode = 0 </P>

<P>N_lanes_drvr_oe = Nx_mode_enabled </P>

<P>disc_tmr_en = 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>2x_RECOVERY </P>

<P>disc_tmr_en = 1 port_initialized = 0 </P>

<P>2x_mode = 0 </P>

<P>SILENT </P>

<P>disc_tmr_en = 0 lanes01_drvr_oe = 0 lanes02_drvr_oe = 0 </P>

<P>N_lanes_drvr_oe = 0 port_initialized = 0 </P>

<P>Nx_mode = 0 </P>

<P>2x_mode = 0 receive_lane1 = 0 </P>

<P>receive_lane2 = 0 </P>

<P>force_reinit = 0 silence_timer_en = 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P>silence_timer_done </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>1x_RECOVERY </P>

<P>disc_tmr_en = 1 port_initialized = 0 </P>

<P> </P>

<P>DtoSL </P>

<P> </P>

<P>2xRto2xM </P>

<P> </P>

<P> </P>

<P>Dto1xM2 </P>

<P> </P>

<P>2xRtoSL </P>

<P> </P>

<P>2xRto1xM1 </P>

<P> </P>

<P> </P>

<P> </P>

<P>1xRto1xM0 </P>

<P> </P>

<P>1xRtoSL </P>

<P> </P>

<P>1xRto1xM2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>DtoNxM </P>

<P>Dto1xM1 </P>

<P> </P>

<P> </P>

<P>Dto1xM0 </P>

<P> </P>

<P>Dto2xM </P>

<P> </P>

<P> </P>

<P>2xRto1xM0 </P>

<P> </P>

<P>1xRto1xM1 </P>

<P> </P>

<P> </P>

<P>Nx_MODE </P>

<P>disc_tmr_en = 0 </P>

<P>Nx_mode = 1 port_initialized = 1 </P>

<P>2x_MODE </P>

<P>lanes02_drvr_oe = 0 </P>

<P>N_lanes_drvr_oe = 0 disc_tmr_en = 0 </P>

<P>2x_mode = 1 port_initialized = 1 </P>

<P>1x_MODE_LANE0 </P>

<P>N_lanes_drvr_oe = 0 disc_tmr_en = 0 port_initialized = 1 </P>

<P>1x_MODE_LANE1 </P>

<P>N_lanes_drvr_oe = 0 disc_tmr_en = 0 receive_lane2 = 0 receive_lane1 = 1 port_initialized = 1 </P>

<P>1x_MODE_LANE2 </P>

<P>N_lanes_drvr_oe = 0 disc_tmr_en = 0 receive_lane2 = 1 port_initialized = 1 </P>

<P> </P>

<P>NxMtoD </P>

<P> </P>

<P>NxMtoSL </P>

<P> </P>

<P>2xMto2xR </P>

<P> </P>

<P>1xM0to1xR 1xM1to1xR 1xM2to1xR </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_974.jpg"/>
</Figure>

<P>2xMtoSL </P>

<Textbox>
<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>
</Textbox>

<Textbox>
<P>Figure 4-21. 1x/2x/Nx_Initialization State Machine </P>
</Textbox>

<Textbox>
<P>RapidIO Trade Association </P>
</Textbox>

<Textbox>
<P>125 </P>
</Textbox>

<P>1xM0toSL 1xM1toSL 1xM2toSL </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The variables that are local to the 1x/2x/Nx_Initialization state machine shown in </P>

<P>Figure 4-21 are defined as follows. </P>

<P> </P>

<P>1xM0to1xR = !lane_ready[0] &amp; lane_sync[0] </P>

<P> </P>

<P>1xM0toSL = !lane_sync[0] </P>

<P> </P>

<P>1xM1to1xR = !lane_ready[1] &amp; lane_sync[1] </P>

<P> </P>

<P>1xM1toSL = !lane_sync[1] </P>

<P> </P>

<P>1xM2to1xR = !lane_ready[2] &amp; (lane_sync[1] | lane_sync[2]) </P>

<P> </P>

<P>1xM2toSL = !lane_sync[2] &amp; !lane_sync[1] </P>

<P> </P>

<P>1xR to1xM0 = !disc_tmr_done &amp; !receive_lane1 &amp; !receive_lane2 &amp; lane_ready[0] </P>

<P> </P>

<P>1xR to1xM1 = !disc_tmr_done &amp; </P>

<P>(receive_lane1 | receive_lane2 &amp; !lane_ready[2]) &amp; lane_ready[1] </P>

<P> </P>

<P>1xR to1xM2 = !disc_tmr_done &amp; receive_lane2 &amp; lane_ready[2] </P>

<P> </P>

<P>1xRtoSL = !lane_sync[0] &amp; !lane_sync[1] &amp; !lane_sync[2] </P>

<P>| disc_tmr_done </P>

<P> </P>

<P>2xMto2xR = !2_lanes_ready &amp; (lane_sync[0] | lane_sync[1]) </P>

<P>| 2_lanes_ready &amp; 1x_mode_detected </P>

<P> </P>

<P>2xMtoSL = !lane_sync[0] &amp; !lane_sync[1] </P>

<P> </P>

<P>2xRto1xM0 = disc_tmr_done &amp; !2_lanes_ready &amp; lane_ready[0] </P>

<P>| 2_lanes_ready &amp; 1x_mode_detected </P>

<P> </P>

<P>2xRto1xM1 = disc_tmr_done &amp; !2_lanes_ready &amp; !lane_ready[0] &amp; lane_ready[1] </P>

<P> </P>

<P>2xRto2xM = 2_lanes_ready &amp; !1x_mode_detected </P>

<P> </P>

<P>2xRtoSL = !lane_sync[0] &amp; !lane_sync[1] </P>

<P>| disc_tmr_done &amp; !lane_ready[0] &amp; !lane_ready[1] </P>

<P> </P>

<P>Dto1xM0 = lane_ready[0] &amp; </P>

<P>(  force_1x_mode &amp; </P>

<P>(!force_laneR </P>

<P>| force_laneR &amp; disc_tmr_done &amp; !lane_ready[1] &amp; !lane_ready[2] </P>

<P>) </P>

<P>| !force_1x_mode &amp; disc_tmr_done &amp; </P>

<P>(!Nx_mode_enabled | !N_lanes_ready) &amp; </P>

<P>(!2x_mode_enabled | !2_lanes_ready) </P>

<P>) </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Dto1xM1 = disc_tmr_done &amp; lane_ready[1] &amp; !lane_ready[2] &amp; (  force_1x_mode &amp; </P>

<P>(force_laneR | !force_laneR &amp; disc_tmr_done &amp; !lane_ready[0]) </P>

<P>| !force_1x_mode &amp; !lane_ready[0] &amp; </P>

<P>(!Nx_mode_enabled | !N_lanes_ready) &amp; </P>

<P>(!2x_mode_enabled | !2_lanes_ready) </P>

<P>) </P>

<P> </P>

<P>Dto1xM2 = lane_ready[2] &amp; </P>

<P>(  force_1x_mode &amp; </P>

<P>(force_laneR | !force_laneR &amp; disc_tmr_done &amp; !lane_ready[0]) </P>

<P>| !force_1x_mode &amp; disc_tmr_done &amp; !lane_ready[0] &amp; </P>

<P>(!Nx_mode_enabled | !N_lanes_ready) &amp; </P>

<P>(!2x_mode_enabled | !2_lanes_ready) </P>

<P>) </P>

<P> </P>

<P>Dto2xM = 2x_mode_enabled &amp; 2_lanes_ready &amp; </P>

<P>(!Nx_mode_enabled | disc_tmr_done &amp; !N_lanes_ready) </P>

<P> </P>

<P>DtoNxM = Nx_mode_enabled &amp; N_lanes_ready </P>

<P> </P>

<P>DtoSL = !lane_sync[0] &amp; !lane_sync[1] &amp; !lane_sync[2] </P>

<P>| disc_tmr_done &amp; !lane_ready[0] &amp; !lane_ready[1] &amp; !lane_ready[2] </P>

<P> </P>

<P>NxMtoD = !N_lanes_ready &amp; (lane_sync[0] | lane_sync[2]) NxMtoSL = !lane_sync[0] &amp; !lane_sync[2] </P>

<P>SKtoD = (lane_sync[0] | lane_sync[1] | lane_sync[2]) &amp; idle_selected </P>

<P>4.12.4.8.2  1x/Mx/Nx Initialization State Machine (N &gt; M &gt; 2) </P>

<P> </P>

<P>The 1x/Mx/Nx_Initialization state machine for N &gt; M &gt; 2 is specified in Figure </P>

<P>4-22 and shall be used by 1x/Mx/Nx ports. </P>

<P> </P>

<P>The 1x/Nx/Nx_Initialization state machine has two more states than a </P>

<P>1x/Nx_Initialization state machine, the Mx_MODE and Mx_RECOVERY states, but one less state than the 1x/2x/Nx_Initialization state machine, the </P>

<P>1x_MODE_LANE1 state. Its operation is most similar to that of the </P>

<P>1x/2x/Nx_Initialization state machine, but is less complex as the redundancy lane R </P>

<P>is the same for all N and M &gt; 2. </P>

<P> </P>

<P> </P>

<P>reset | force_reinit </P>

<P> </P>

<P> </P>

<P> </P>

<P>SILENT </P>

<P>SEEK disc_tmr_en = 0 </P>

<P>lanes02_drvr_oe = 1 </P>

<P> </P>

<P>SKtoD </P>

<P> </P>

<P> </P>

<P> </P>

<P>DISCOVERY </P>

<P>port_initialized = 0 </P>

<P>Nx_mode = 0 </P>

<P>M_lanes_drvr_oe = Mx_mode_enabled </P>

<P>N_lanes_drvr_oe = Nx_mode_enabled </P>

<P>disc_tmr_en = 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Mx_RECOVERY </P>

<P>disc_tmr_en = 1 port_initialized = 0 </P>

<P>Mx_mode = 0 </P>

<P>lanes02_drvr_oe = 0 </P>

<P>N_lanes_drvr_oe = 0 </P>

<P>M_lanes_drvr_oe = 0 port_initialized = 0 </P>

<P>Nx_mode = 0 </P>

<P>Mx_mode = 0 receive_lane2 = 0 </P>

<P>force_reinit = 0 </P>

<P>silence_timer_en = 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P>silence_timer_done </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>1x_RECOVERY </P>

<P>disc_tmr_en = 1 port_initialized = 0 </P>

<P> </P>

<P>DtoSL </P>

<P>MxRtoMxM </P>

<P>MxRtoSL </P>

<P>1xRtoSL </P>

<P> </P>

<P> </P>

<P>Dto1xM2 </P>

<P>MxRto1xM0 </P>

<P>1xRto1xM0 </P>

<P>1xRto1xM2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>DtoNxM </P>

<P> </P>

<P>Dto1xM0 </P>

<P> </P>

<P>DtoMxM </P>

<P>MxRto1xM0 </P>

<P> </P>

<P> </P>

<P>Nx_MODE </P>

<P>disc_tmr_en = 0 </P>

<P>Nx_mode = 1 port_initialized = 1 </P>

<P>Mx_MODE </P>

<P>N_lanes_drvr_oe = 0 disc_tmr_en = 0 </P>

<P>Mx_mode = 1 </P>

<P>port_initialized = 1 </P>

<P>1x_MODE_LANE0 </P>

<P>N_lanes_drvr_oe = 0 </P>

<P>M_lanes_drvr_oe = 0 disc_tmr_en = 0 </P>

<P>port_initialized = 1 </P>

<P>1x_MODE_LANE2 </P>

<P>N_lanes_drvr_oe = 0 </P>

<P>M_lanes_drvr_oe = 0 disc_tmr_en = 0 </P>

<P>receive_lane2 = 1 port_initialized = 1 </P>

<P> </P>

<P>NxMtoD </P>

<P>NxMtoSL </P>

<P>MxMtoMxR </P>

<P>1xM0to SL </P>

<P>1xM0to1xR </P>

<P>1xM2toSL </P>

<P>1xM2to1xR </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_975.jpg"/>
</Figure>

<P> </P>

<Textbox>
<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>
</Textbox>

<Textbox>
<P>Figure 4-22. 1x/Mx/Nx_Initialization State Machine for N &gt; M &gt; 2 </P>
</Textbox>

<Textbox>
<P>The variables that are local to the 1x/Mx/Nx_Initialization state machine shown in </P>

<P>Figure 4-22 are defined as follows. </P>
</Textbox>

<Textbox>
<P>128 </P>
</Textbox>

<Textbox>
<P>RapidIO Trade Association </P>
</Textbox>

<P>MxMtoSL </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1xM0to1xR = !lane_ready[0] &amp; lane_sync[0] </P>

<P> </P>

<P>1xM0toSL = !lane_sync[0] </P>

<P> </P>

<P>1xM2to1xR = !lane_ready[2] &amp; lane_sync[2] </P>

<P> </P>

<P>1xM2toSL = !lane_sync[2] </P>

<P> </P>

<P>1xR to1xM0 = !disc_tmr_done &amp; !receive_lane2 &amp; lane_ready[0] </P>

<P> </P>

<P>1xR to1xM2 = !disc_tmr_done &amp; receive_lane2 &amp; lane_ready[2] </P>

<P> </P>

<P>1xRtoSL = !lane_sync[0] &amp; !lane_sync[2] </P>

<P>| disc_tmr_done </P>

<P> </P>

<P>Dto1xM0 = lane_ready[0] &amp; </P>

<P>(  force_1x_mode &amp; </P>

<P>(!force_laneR | force_laneR &amp; disc_tmr_done &amp; !lane_ready[2]) </P>

<P>| !force_1x_mode &amp; disc_tmr_done &amp; </P>

<P>(!Nx_mode_enabled | !N_lanes_ready) &amp; </P>

<P>(!Mx_mode_enabled | !M_lanes_ready) </P>

<P>) </P>

<P> </P>

<P>Dto1xM2 = lane_ready[2] &amp; </P>

<P>(  force_1x_mode &amp; </P>

<P>(force_laneR | !force_laneR &amp; disc_tmr_done &amp; !lane_ready[0]) </P>

<P>| !force_1x_mode &amp; disc_tmr_done &amp; !lane_ready[0] &amp; </P>

<P>(!Nx_mode_enabled | !N_lanes_ready) &amp; </P>

<P>(!Mx_mode_enabled | !M_lanes_ready) </P>

<P>) </P>

<P> </P>

<P>DtoMxM = Mx_mode_enabled &amp; M_lanes_ready &amp; (!Nx_mode_enabled | disc_tmr_done &amp; !N_lanes_ready) </P>

<P> </P>

<P>DtoNxM = Nx_mode_enabled &amp; N_lanes_ready </P>

<P> </P>

<P>DtoSL = !lane_sync[0] &amp; !lane_sync[2] </P>

<P>| disc_tmr_done &amp; !lane_ready[0] &amp; !lane_ready[2] </P>

<P> </P>

<P>MxMtoMxR = !M_lanes_ready &amp; (lane_sync[0] | lane_sync[2]) MxMtoSL = !lane_sync[0] &amp; !lane_sync[2] </P>

<P>MxRto1xM0 = disc_tmr_done &amp; !M_lanes_ready &amp; lane_ready[0] </P>

<P> </P>

<P>MxRto1xM2 = disc_tmr_done &amp; !M_lanes_ready &amp; !lane_ready[0] &amp; lane_ready[2] MxRtoMxM = !disc_tmr_done &amp; M_lanes_ready </P>

<P>MxRtoSL = !lane_sync[0] &amp; !lane_sync[2] </P>

<P>| disc_tmr_done &amp; !lane_ready[0] &amp; !lane_ready[2] </P>

<P> </P>

<P>NxMtoD = !N_lanes_ready &amp; (lane_sync[0] | lane_sync[2]) NxMtoSL = !lane_sync[0] &amp; !lane_sync[2] </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>SKtoD = (lane_sync[0] | lane_sync[2]) &amp; idle_selected </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 LP-Serial Protocol </P>

<P> </P>

<P> </P>

<P>5.1 Introduction </P>

<P> </P>

<P>This chapter specifies the LP-serial protocol which is the link level protocol for LP-serial links. The chapter covers traffic types, virtual channels (VCs), virtual channel queue management, packet priority, the mapping of transaction request flows onto packet priority, buffer management, and the use of control symbols in managing the delivery of packets between two devices connected by a LP-Serial link. </P>

<P> </P>

<P>The protocol defines two types of traffic and provides a method for exchanging packets of each traffic type. The first type of traffic, called &#8220;reliable traffic&#8221; (RT), is the type of traffic RapidIO was originally designed to support. RT mode provides reliable delivery of packets between two devices that are connected by a RapidIO LP-Serial link. The second type of traffic, called &#8220;continuous traffic&#8221; (CT), provides unreliable delivery of packets that are &#8220;time sensitive&#8221;. </P>

<P> </P>

<P>The protocol supports up to nine (9) virtual channels (VC0-VC8). Virtual Channel </P>

<P>0 (VC0) is always active and always operates in reliable traffic mode. It provides backward compatibility with Revision 1.3 RapidIO LP-Serial links. When only VC0 is active, a link is said to be operating in single VC mode. VCs 1-8 are optional, and if implemented, may be disabled for backward compatibility with Rev. 1.3 LP-Serial links. </P>

<P> </P>

<P> </P>

<P>5.2 Packet Exchange Protocol </P>

<P> </P>

<P>As originally designed, the LP-Serial specification defines a protocol for devices connected by a LP-Serial link in which each packet transmitted by one device is acknowledged by control symbols transmitted by the other device. If a packet cannot be accepted for any reason, an acknowledgment control symbol indicates the reason and that the original packet and any transmitted subsequent packets must be resent. This behavior provides a flow control and error control mechanism between connected processing elements. This is the protocol for reliable traffic (RT). </P>

<P> </P>

<P>Figure 5-1 shows an example of transporting a RT request and response packet pair across an   interconnect   fabric   with   acknowledgments   between   the   link transmitter/receiver pairs along the way. This allows flow control and error handling to be managed between each electrically connected device pair rather than between the original source and final target of the packet. An end point device shall transmit </P>

<P> </P>

<P>RapidIO Trade Association 131 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>an acknowledgment control symbol for a request packet before transmitting the response packet corresponding to that request. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Initiator (Source) </P>

<P> </P>

<P>Operation </P>

<P> </P>

<P> </P>

<P> </P>

<P>Request </P>

<P>Data </P>

<P>Returned </P>

<P> </P>

<P>Acknowledgment </P>

<P> </P>

<P> </P>

<P> </P>

<P>Operation </P>

<P>Issued By </P>

<P>Master </P>

<P>Packet Issued </P>

<P>Control Symbol </P>

<P>Completed for </P>

<P>Master </P>

<P> </P>

<P> </P>

<P> </P>

<P>Fabric </P>

<P> </P>

<P> </P>

<P>Acknowledgment </P>

<P>Control Symbol </P>

<P> </P>

<P>Response </P>

<P>Packet Forwarded </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Request </P>

<P>Packet Forwarded </P>

<P>Acknowledgment </P>

<P>Control Symbol </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Target (Destination) </P>

<P> </P>

<P> </P>

<P>Acknowledgment </P>

<P>Control Symbol </P>

<P> </P>

<P> </P>

<P>Response </P>

<P>Packet Issued </P>

<P> </P>

<P>Target Completes Operation </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_976.jpg"/>
</Figure>

<P>Figure 5-1. Example Transaction with Acknowledgment </P>

<P> </P>

<P>The protocol for continuous traffic (CT) is very similar to the protocol for reliable traffic (RT). The primary differences are that some CT packets are not acknowledged and CT packets are subject to loss due to errors or insufficient buffer resources at the receiver. </P>

<P> </P>

<P> </P>

<P>5.3 Traffic types </P>

<P> </P>

<P>The LP-Serial protocol provides support for transporting two types of traffic, &#8220;reliable traffic&#8221; (RT) and &#8220;continuous traffic&#8221; (CT). Reliable Traffic is guaranteed to be lossless by using packet retransmission whenever packet corruption is detected or receiver buffer resources are overrun. Continuous Traffic is subject to packet loss when packet corruption is detected or receiver buffer resources are overrun, but does not incur any additional latency, by continuing its packet flow without retransmission of unacknowledged packets. </P>

<P> </P>

<P> </P>

<P> </P>

<P>5.4 Virtual Channels </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Virtual channels provides a mechanism that allows the bandwidth of a link to be allocated amongst various unrelated &#8220;streams&#8221; and types of traffic in a manner that ensures that each stream, or group of streams, receives a guaranteed minimum fraction of the link bandwidth. This is done by allocating one or more streams of a given traffic type to each VC and then allocating each VC a specified fraction of the link bandwidth. </P>

<P> </P>

<P>The LP-Serial protocol supports up to nine (9) virtual channels (VC0-VC8). </P>

<P> </P>

<P> </P>

<P>5.4.1  Virtual channel 0 (VC0) </P>

<P> </P>

<P>VC0 shall be supported by all LP-Serial ports. VC0 shall always be active, operate in RT mode and support packet priority rules. VC0 provides the packet transport service specified in Rev. 1.3 of this specification and is backward compatible with Rev. 1.3. </P>

<P> </P>

<P> </P>

<P>5.4.2  Virtual Channels 1-8 (VC1-8) </P>

<P> </P>

<P>Support for VC1 through VC8 by LP-Serial ports is optional. Any of VC1 through VC8 that are implemented shall support operation in RT mode and may optionally support and be configured for operation in CT mode. CT VCs operate independent of each other. RT VCs operate as a &#8220;RT Group&#8221;. That is to say, when the error recovery protocol is used to recover a damaged packet, the unacknowledged packets for all VCs in RT mode are retransmitted. See Section 5.13, &quot;Error Detection and Recovery&quot; for more on the error recovery process of RT and CT VCs. </P>

<P> </P>

<P>The number of VCs implemented is up to the implementer. VC0 is always implemented. The number of channels for VCs 1-8 may be 0, 1, 2, 4, or 8. The binary configuration allows traffic to be combined (by ignoring bits in the VC field) in a predictable manner. Implementations with fewer than the full number of VCs should ignore, but must not modify, any ignored VC bits. That way traffic can fan back out into a larger set of VCs on subsequent links. The hierarchy for combining VCs is as follows: </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-1. Additional VC Combinations </P>

<P> </P>

<Table>
<TR>
<TD>
<P>8 VCs </P>
</TD>

<TD>
<P>4 VCs </P>
</TD>

<TD>
<P>2 VCs </P>
</TD>

<TD>
<P>1 VC </P>
</TD>
</TR>

<TR>
<TD>
<P>VC1 </P>
</TD>

<TD>
<P>VC1 </P>
</TD>

<TD>
<P>VC1 </P>
</TD>

<TD>
<P>VC1 </P>
</TD>
</TR>

<TR>
<TD>
<P>VC2 </P>
</TD>

<TD/>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>VC3 </P>
</TD>

<TD>
<P>VC3 </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>VC4 </P>
</TD>

<TD/>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>VC5 </P>
</TD>

<TD>
<P>VC5 </P>
</TD>

<TD>
<P>VC5 </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>VC6 </P>
</TD>

<TD/>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>VC7 </P>
</TD>

<TD>
<P>VC7 </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P>VC8 </P>
</TD>

<TD/>

<TD/>

<TD/>
</TR>
</Table>

<P> </P>

<P>In systems implementing one or more of VCs 1 through 8 and in which the number of VCs 1 through 8 that are implemented varies from one LP-Serial link to another, care needs to exercised in assignment of VC numbers so that the desired RT or CT characteristic of a virtual channel is maintained as the channel passes from one link to another link that implements fewer virtual channels. </P>

<P> </P>

<P> </P>

<P>5.4.3  Virtual Channel Utilization </P>

<P> </P>

<P>Packets are transmitted from one or more virtual channels according to the weighted distribution of bandwidth for each channel. The weighting is such that under demand for full utilization of the link&#8217;s bandwidth, each active VC is guaranteed a certain portion of that bandwidth. This is the minimum that each VC can achieve. When the demand for bandwidth is less than the allocation for any VC, the extra bandwidth may be distributed among the other VCs giving them more than their allotment. The algorithm for scheduling traffic is up to the implementer as long as the rules (see Section 5.11, &quot;Transaction and Packet Delivery Ordering Rules&quot;) are met. </P>

<P> </P>

<P>There are no packet ordering guarantees between VCs. Packets within a VC in VCs </P>

<P>1 - 8 are equally weighted and must be kept in order. Only packets within VC0 have additional ordering rules based on priority. </P>

<P> </P>

<P> </P>

<P>5.5 Control Symbols </P>

<P> </P>

<P>Control Symbols are the message elements used by ports connected by a LP-Serial link to manage all aspects of LP-Serial link operation. They are used for link maintenance, packet delimiting, packet acknowledgment, error reporting, and error recovery. </P>

<P> </P>

<P> </P>

<P>5.5.1  Control Symbol Selection </P>

<P> </P>

<P>The control symbol used on a LP-Serial link is determined by the idle sequence being used on the link. Idle sequence selection occurs during the port initialization </P>

<P> </P>

<P>134 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>process. If the link is operating with idle sequence 1 (IDLE1), the short control symbol shall be used. If the link is operating with idle sequence 2 (IDLE2), the long control symbol shall be used. </P>

<P> </P>

<P> </P>

<P>5.5.2  Control Symbol Delimiting </P>

<P> </P>

<P>LP-Serial control symbols are delimited for transmission by 8B/10B special characters. </P>

<P> </P>

<P>Short control symbols are delimited by a single 8B/10B special character that marks the beginning of the control symbol and immediately precedes the first character of the control symbol. Since control symbol length is constant and known, an end delimiters is neither needed nor provided. </P>

<P> </P>

<P>Long control symbols are delimited by two 8B/10B special characters. The first special character marks the beginning of the control symbol (the start delimiter) and immediately precedes the first character of the control symbol. The second special character marks the end of the control symbol (the end delimiter) and immediately follows the last character of the control symbol. The end delimiter special character replicates the value of the start delimiter special character. The end delimiter is provided for error detection in a burst error environment. </P>

<P> </P>

<P>One of two special characters is used to delimit a control symbol. If the control symbol contains a packet delimiter, the special character PD (K28.3) is used. If the control symbol does not contain a packet delimiter, the special character SC (K28.0) is used. This use of different special characters provides the receiver with an &quot;early warning&quot; of the content of the control symbol. </P>

<P> </P>

<P>The control symbol delimiting special character(s) shall be added to the control symbol before the control symbol is passed to the PCS sublayer for 8B/10B encoding and, if applicable, lane striping. </P>

<P> </P>

<P>The combination of a control symbol and its delimiting special character(s) is referred to as a &#8220;delimited control symbol&#8221;. </P>

<P> </P>

<P> </P>

<P>5.5.3  Control Symbol Use </P>

<P> </P>

<P>5.5.3.1  Link Initialization </P>

<P> </P>

<P>An LP-Serial port needs be initialized and the link to which it is connected also needs be initialized before the port may begin the normal transmission of packets and control symbols. The port is initialized when the port&#8217;s Initialization state machine variable port_initialized is asserted. The link is initialized after the port has successfully completed the following link initialization process and entered the link_initialized state (link_initialized variable asserted). </P>

<P> </P>

<P>When a port is in the port_initialized state, but not in the link_initialized state, the port  shall  transmit  only  a  idle  sequences,  status, VC-status,  link-request  and </P>

<P> </P>

<P>RapidIO Trade Association 135 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>link-response control symbols and, if IDLE2 is the idle sequence in use on the link, SYNC sequences. </P>

<P> </P>

<P>After a LP-Serial port is initialized, the port shall complete the following sequence of actions to enter the link_initialized state (normal operational state). </P>

<P> </P>

<P>1.  The initialized port shall transmit idle and at least one status control symbol per 1024 code-groups transmitted per lane until the port has received an error free status control symbol from the connected port. The transmission of status control symbols indicates to the connected port that the port has completed initialization. The transmission of an idle sequence is required for the connected port to complete initialization. </P>

<P>2.  After the initialized port has received an error free status control symbol from the connected port, the port shall transmit idle and at least 15 additional status control symbols. This group of control symbols may be sent more rapidly than the minimum rate of one status control symbol every 1024 code-groups transmitted per lane. </P>

<P>3.  After the initialized port has received an error free status control symbol, the port shall wait until it has received a total of seven error free status control symbols with no intervening errors. This requirement provides a degree of link verification before packets and other control symbols are transmitted. </P>

<Figure Alt=""/>

<P>4.  If any VC other than VC0 is implemented and enabled, the port shall transmit a single VC_Status control symbol for each such VC. This initializes the flow control status for each implemented and enabled VC other than VC0. </P>

<P>5.  The port enters the link_initialized state. </P>

<P> </P>

<P>Once a port is in the link_initialized state, loss of port initialization (port_initialized variable deasserted) shall cause the port to exit the link_initialized state (link_initialized variable deasserted). The link is then uninitialized from the point of view of that port. Once the port has exited the link_initialized state, the port shall not resume the normal transmission of packets and control symbols until the port has re-entered both the port_initialized and link_initialized states. </P>

<P> </P>

<P>A port that is not in the port_initialized state shall ignore and discard any packet or control symbol that it receives from the connected port. A port that is in the port_initialized state but not in the link_initialized state shall ignore and discard any packet  or  any  control  symbol,  other  than  status,  VC-status,  link-request  or link-response control symbols, that it receives from the connected port. </P>

<P> </P>

<P>A LP-Serial  port  shall  not  enter  the  Input  error-stopped state  or  the  Output error-stopped state unless the port is in the link_initialized state. The lost of link initialization (the state machine link_initialized variable is deasserted) shall not cause a port already in the Input error-stopped state or the Output error-stopped state to exit either of those states. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>136 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.3.2  Buffer Status Maintenance </P>

<P> </P>

<P>When a LP-Serial port is in the normal operational state, it shall transmit a control symbol containing the buf_status field for VC0 at least once every 1024 code-groups transmitted per lane. To comply with this requirement, the port shall transmit a status control symbol if no other control symbol containing the buf_status field for VC0 is available for transmission. </P>

<P> </P>

<P>When a LP-Serial port is in the normal operational state and any VC other than VC0 is active (VCs 1-8), the port shall transmit a control symbol containing the buf_status field for each active VC at least once every VC refresh period. To comply with this requirement, the port shall transmit a VC_status control symbol for each active VC, other than VC0, if no other control symbol containing the buf_status field for that VC is available for transmission during the VC refresh interval. VC_status may be transmitted at any time, triggered by changes in VC conditions according to implementation specific algorithms. </P>

<P> </P>

<P>The VC refresh period can be configured through the VC Refresh Interval register field defined in Chapter 6, &quot;LP-Serial Registers&quot;. The shortest VC refresh period is </P>

<P>1024 code-groups and the longest required VC refreshing period is 1024 x 16 = 16K code groups. The VC refresh period must be implemented supporting 16K code groups. </P>

<P> </P>

<P>NOTE:VC Refresh Period </P>

<P>The VC Refresh Interval register field contains space for up to 8 bits to be used, so based on implementation, the maximum refresh period may be 256K code groups. See section 6.4.2.1. </P>

<P> </P>

<P>5.5.3.3  Embedded Control Symbols </P>

<P> </P>

<P>Any control symbol that does not contain a packet delimiter may be embedded in a packet. An embedded control symbol may contain any defined encoding of stype0 and an stype1 encoding of &quot;multicast-event&quot; or &quot;NOP&quot;. Control symbols with stype1 encodings   of   start-of-packet,   end-of-packet,   stomp,   restart-from-retry,   or link-request cannot be embedded as they would terminate the packet. </P>

<P> </P>

<P>When a control symbol is embedded in a packet, the delimited control symbol shall begin on a 4-character boundary of the packet. That is, the number of packet characters between the end of the delimited start-of-packet control symbol and the start of the embedded delimited control symbol shall be a non-negative integer multiple of 4. </P>

<P> </P>

<P>The manner and degree to which control symbol embedding is used on a link impacts  both  link  and  system  performance.  For  example,  embedding multicast-event control symbols allows their propagation delay and delay variation through switch processing elements to be minimized and is highly desirable for some multicast-event applications. Embedding packet acknowledgment control symbols reduces the delay in freeing packet buffers in the transmitting port which </P>

<P> </P>

<P>RapidIO Trade Association 137 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>can increase packet throughput and reduce packet propagation delay in some situations, which can be desirable. On the other hand, embedding all packet acknowledgment control symbols rather than combining as many of them as possible with packet delimiter control symbols reduces the link bandwidth available for packet transmission and may be undesirable. </P>

<P> </P>

<P>5.5.3.4  Multicast-Event Control Symbols </P>

<P> </P>

<P>The Multicast-Event control symbol provides a mechanism through which end points are notified that some system defined event has occurred. This event can be selectively multicast through the system. Refer to Section 3.5.6 for the format of the multicast-event control symbol. </P>

<P> </P>

<P>When a switch processing element receives a Multicast-Event control symbol, the switch shall forward the Multicast-Event by issuing a Multicast-Event control symbol from each port that is designated in the port's CSR as a Multicast-Event output port. A switch port shall never forward a Multicast-Event control symbol back to the device from which it received a Multicast-Event control symbol regardless of whether the port is designated a Multicast-Event output or not. </P>

<P> </P>

<P>It is intended that at any given time, Multicast-Event control symbols will be sourced by a single device. However, the source device can change (in case of failover, for example). In the event that two or more Multicast-Event control symbols are received by a switch processing element close enough in time that more than one is present in the switch at the same time, at least one of the Multicast-Event control symbols shall be forwarded. The others may be forwarded or discarded (device dependent). </P>

<P> </P>

<P>The system defined event whose occurrence Multicast-Event gives notice of has no required temporal characteristics. It may occur randomly, periodically, or anything in between. For instance, Multicast-Event may be used for a heartbeat function or for a clock synchronization function in a multiprocessor system. </P>

<P> </P>

<P>In an application such as clock synchronization in a multiprocessor system, both the propagation time of the notification through the system and the variation in propagation time from Multicast-Event to Multicast-Event are of concern. For these reasons  and  the  need  to  multicast,  control  symbols  are  used  to  convey Multicast-Events as control symbols have the highest priority for transmission on a link and can be embedded in packets. </P>

<P> </P>

<P>While this specification places no limits on Multicast-Event forwarding delay or forwarding delay variation, switch functions should be designed to minimize these characteristics. In addition, switch functions shall include in their specifications the maximum value of Multicast-Event forwarding delay (the maximum value of Multicast-Event forwarding delay through the switch) and the maximum value of Multicast-Event forwarding delay variation (the maximum value of Multicast-Event forwarding delay through the switch minus the minimum value of Multicast-Event forwarding delay through the switch). </P>

<P> </P>

<P>138 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>5.6 Packets </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.6.1  Packet Delimiting </P>

<P> </P>

<P>LP-Serial packets are delimited for transmission by control symbols. Since packet length is variable, both start-of-packet and end-of-packet delimiters are required. The start-of-packet delimiter immediately precedes the first character of the packet or an embedded delimited control symbol. The control symbol marking the end of a packet (packet termination) immediately follows the last character of the packet or the end of an embedded delimited control symbol. </P>

<P> </P>

<P>The following control symbols are used to delimit packets. </P>

<P> </P>

<P>&#8226; Start-of-packet </P>

<P>&#8226; End-of-packet </P>

<P>&#8226; Stomp </P>

<P>&#8226; Restart-from-retry </P>

<P>&#8226; Any link-request </P>

<P> </P>

<P>5.6.1.1  Packet Start </P>

<P> </P>

<P>The beginning of a packet (packet start) shall be marked by a start-of-packet control symbol. </P>

<P> </P>

<P>5.6.1.2  Packet Termination </P>

<P> </P>

<P>A packet shall be terminated in one of the following three ways: </P>

<P> </P>

<P>&#8226; The end of a packet is marked with an end-of-packet control symbol. </P>

<P>&#8226; The end of a packet is marked with a start-of-packet control symbol that also marks the beginning of a new packet. </P>

<P>&#8226; The packet is canceled by a restart-from-retry, stomp, or any link-request control symbol </P>

<P> </P>

<P> </P>

<P>5.6.2  Acknowledgment Identifier </P>

<P> </P>

<P>Each packet requires an identifier to uniquely identify its acknowledgment control symbol. This identifier, the acknowledge ID (ackID) is 5 bits long when using short control symbols and 6 bits long when using long control symbols. This allows up to 2N outstanding unacknowledged request and/or response packets where </P>

<P>N is the number of bits in the ackID field. To eliminate the ambiguity between 0 and </P>

<P>2N outstanding packets, a maximum of 2N-1 outstanding unacknowledged packets shall be allowed at any one time. </P>

<P> </P>

<P>The value of ackID assigned to the first packet transmitted after a reset shall be 0. The values of ackID assigned to subsequent packets shall be in increasing numerical order, wrapping back to 0 on overflow. The ackID assigned to a </P>

<P> </P>

<P>RapidIO Trade Association 139 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>packet indicates the order of the packet transmission and is independent of the virtual channel assignment of the packet. </P>

<P> </P>

<P>The acknowledgment control symbols are defined in Chapter 3, &quot;Control Symbols&quot;. When acknowledgement control symbols are received containing VC specific information (e.g., buf_status), the transmitter side of the port must reassociate that information with the correct VC based on the returned ackID. </P>

<P> </P>

<P> </P>

<P>5.6.3  Packet Priority and Transaction Request Flows </P>

<P> </P>

<P>Within VC0 each packet has a priority, and optionally a critical request flow, that is assigned by the end point processing element that is the source of (initiates) the packet. The priority is carried in the prio field of the packet and has four possible values: 0, 1, 2, or 3. Packet priority increases with the priority value with 0 being the lowest priority and 3 being the highest. Packet priority is used in RapidIO for several purposes which include transaction ordering and deadlock prevention. The critical request flow is carried in the CRF bit. It allows a flow to be designated as a critical or preferred flow with respect to other flows of the same priority. Support for critical request flows is strongly encouraged. </P>

<P> </P>

<P>When a transaction is encapsulated in a packet for transmission, the transaction request flow indicator (flowID) of the transaction is mapped into the prio field (and optionally the CRF bit) of the packet. If the CRF bit is not supported, transaction request flows A and B are mapped to priorities 0 and 1 respectively and transaction request flows C and above are mapped to priority 2 as specified in Table below. </P>

<P> </P>

<P>Table 5-2. VC0 Transaction Request Flow to Priority Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Flow </P>
</TD>

<TD>
<P> </P>

<P>System Priority </P>
</TD>

<TD>
<P>Request </P>

<P>Packet Priority </P>
</TD>

<TD>
<P>Response </P>

<P>Packet Priority </P>
</TD>
</TR>

<TR>
<TD>
<P>C or higher </P>
</TD>

<TD>
<P>Highest </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>B </P>
</TD>

<TD>
<P>Next </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>A </P>
</TD>

<TD>
<P>Lowest </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1, 2, or 3 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>If the CRF bit is supported, the transaction request flows are mapped similarly as specified in Table 5-3 below. Devices that do not support the CRF bit treat it as reserved, setting it to logic 0 on transmit and ignoring it on receive. </P>

<P> </P>

<P>Table 5-3. VC0 Transaction Request Flow to Priority and Critical Request Flow Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Flow </P>
</TD>

<TD>
<P> </P>

<P>System Priority </P>
</TD>

<TD>
<P>Request CRF Bit </P>

<P>Setting </P>
</TD>

<TD>
<P>Request </P>

<P>Packet Priority </P>
</TD>

<TD>
<P>Response CRF Bit </P>

<P>Setting </P>
</TD>

<TD>
<P>Response </P>

<P>Packet Priority </P>
</TD>
</TR>

<TR>
<TD>
<P>F or higher </P>
</TD>

<TD>
<P>Highest </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>E </P>
</TD>

<TD>
<P>Higher than A, B, C, D </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>D </P>
</TD>

<TD>
<P>Higher than A, B, C </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>C </P>
</TD>

<TD>
<P>Higher than A, B </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>140 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Flow </P>
</TD>

<TD>
<P> </P>

<P>System Priority </P>
</TD>

<TD>
<P>Request CRF Bit </P>

<P>Setting </P>
</TD>

<TD>
<P>Request </P>

<P>Packet Priority </P>
</TD>

<TD>
<P>Response CRF Bit </P>

<P>Setting </P>
</TD>

<TD>
<P>Response </P>

<P>Packet Priority </P>
</TD>
</TR>

<TR>
<TD>
<P>B </P>
</TD>

<TD>
<P>Higher than A </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1, 2, or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>A </P>
</TD>

<TD>
<P>Lowest </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>1, 2, or 3 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The mapping of transaction request flows allows a RapidIO transport fabric to maintain transaction request flow ordering without the fabric having any knowledge of transaction types or their interdependencies. This allows a RapidIO fabric to be forward compatible as the types and functions of transactions evolve. A fabric can maintain transaction request flow ordering by simply maintaining the order of packets with the same priority and critical request flow for each path through the fabric and can maintain transaction request flow priority by never allowing a lower priority packet to pass a higher priority packet taking the same path through the fabric. In the case of congestion or some other restriction, a set CRF bit indicates that a flow of a priority can pass a flow of the same priority without the CRF bit set. </P>

<P> </P>

<P>For VC0, flows identified as A - F (or higher) are synonymous with 0A - 0F, etc. Flows for VCs 1-8 (A and higher) are identified as 1A, 2A,...8A. All traffic in flows </P>

<P>1A-8A are transaction requests which do not require a response. Transaction requests that require responses, and their corresponding responses, must use VC0 with the appropriate priority. </P>

<P> </P>

<P>Table 5-4. Flow IDs for VCs </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Transaction Request Flow </P>
</TD>

<TD>
<P>VC </P>
</TD>

<TD>
<P>Transaction Request Flow </P>
</TD>

<TD>
<P>VC </P>
</TD>
</TR>

<TR>
<TD>
<P>1A and higher </P>
</TD>

<TD>
<P>VC1 </P>
</TD>

<TD>
<P>5A and higher </P>
</TD>

<TD>
<P>VC5 </P>
</TD>
</TR>

<TR>
<TD>
<P>2A and higher </P>
</TD>

<TD>
<P>VC2 </P>
</TD>

<TD>
<P>6A and higher </P>
</TD>

<TD>
<P>VC6 </P>
</TD>
</TR>

<TR>
<TD>
<P>3A and higher </P>
</TD>

<TD>
<P>VC3 </P>
</TD>

<TD>
<P>7A and higher </P>
</TD>

<TD>
<P>VC7 </P>
</TD>
</TR>

<TR>
<TD>
<P>4A and higher </P>
</TD>

<TD>
<P>VC4 </P>
</TD>

<TD>
<P>8A and higher </P>
</TD>

<TD>
<P>VC8 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>5.7 Link Maintenance Protocol </P>

<P> </P>

<P>The link maintenance protocol involves a request and response pair between ports connected by a LP-Serial link. For software management, the request is generated through ports in the configuration space of the sending device. An external host write of a command to the link-request register with an I/O logical specification maintenance write transaction causes a link-request control symbol to be issued onto the output port of the device, but only one link-request can be outstanding on a link at a time. </P>

<P> </P>

<P>The device that is linked to the sending device shall respond with an link-response control symbol if the link-request command required it to do so. The external host retrieves the link-response by polling the link-response register with I/O logical maintenance read transactions. A device with multiple RapidIO interfaces has a link-request and a link-response register pair for each corresponding RapidIO interface. </P>

<P> </P>

<P>RapidIO Trade Association 141 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The  automatic  error  recovery  mechanism  relies  on  the  hardware  generating link-request/input-status control symbols under the transmission error conditions described in Section 5.13.2.1, &quot;Recoverable Errors&quot; and using the corresponding link-response information to attempt recovery. </P>

<P> </P>

<P>Due to the undefined reliability of system designs, it is necessary to put a safety lockout on the reset function of the link-request/reset-device control symbol. A device receiving a link-request/reset-device control symbol shall not perform the reset function unless it has received four link-request/reset-device control symbols in a row without any intervening packets or other control symbols, except status control symbols. This will prevent spurious reset-device commands inadvertently resetting a device. The link-request/reset-device control symbol does not require a response. </P>

<P> </P>

<P>The input-status command of the link-request/input-status control symbol is used by the hardware to recover from transmission errors. If the input port had stopped due to a transmission error that generated a packet-not-accepted control symbol back to the    sender,    the    link-request/input-status    control    symbol    acts    as    a link-request/restart-from-error control symbol, and the receiver is re-enabled to receive  new  packets  after  generating  the  link-response  control  symbol.  The link-request/input-status control symbol may also be used to restart the receiving device if it is waiting for a restart-from-retry control symbol after retrying a packet. This situation can occur if transmission errors are encountered while trying to resynchronize the sending and receiving devices after the retry. </P>

<P> </P>

<P>The link-request/input-status control symbol requires a response. A port receiving a link-request/input-status control symbol returns a link-response control symbol containing two pieces of information: </P>

<P> </P>

<P>&#8226; port_status </P>

<P>&#8226; ackID_status </P>

<P> </P>

<P>These status indicators are described in Table 3-6. </P>

<P> </P>

<P>The retry-stopped state indicates that the port has retried a packet and is waiting to be    restarted.   This    state    is    cleared    when    a    restart-from-retry   (or    a link-request/input-status) control symbol is received. The error-stopped state indicates that the port has encountered a transmission error and is waiting to be restarted. This state is cleared when a link-request/input-status control symbol is received. </P>

<P> </P>

<P> </P>

<P>5.8 Packet Transmission Protocol </P>

<P> </P>

<P>The LP-Serial protocol for packet transmission provides link level flow and error detection and recovery. </P>

<P> </P>

<P>The protocol uses control symbols to delimit packets when they are transmitted across a LP-Serial link as specified in Section 5.6.1, &quot;Packet Delimiting&quot;. </P>

<P> </P>

<P>142 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The link protocol uses acknowledgment to monitor packet transmission. With one exception, each packet transmitted across a LP-Serial link shall be acknowledged by the receiving port with a packet acknowledgment control symbol. Packets shall be acknowledged in the order in which they were transmitted (ackID order). The exception is when an event has occurred that caused a port to enter the Input Error-stopped state. CT mode packets accepted by a port after the port entered the Input Error-stopped state and before the port receives a link-request/input-status control symbol shall not be acknowledged. </P>

<P> </P>

<P>To associate packet acknowledgment control symbols with transmitted packets, each packet shall be assigned an ackID value according to the rules of Section 5.6.2, &quot;Acknowledgment Identifier&quot; that is carried in the ackID field of the packet and the packet_ackID field of the associated acknowledgment control symbol. The ackID value carried by a packet indicates its order of transmission and the order in which it is acknowledged. </P>

<P> </P>

<P>The LP-Serial link RT protocol uses retransmission to recover from packet transmission errors or a lack of receive buffer resources. To enable packet retransmission, a copy of each RT packet transmitted across a LP-Serial link shall be kept by the sending port until either a packet-accepted control symbol is received for the packet or the sending port determines that the packet has encountered an unrecoverable error condition. </P>

<P> </P>

<P>The LP-Serial link CT protocol does not use packet retransmission. CT mode packets that are corrupted by transmission errors or that are not accepted because of a lack of receive buffer resources are discarded and lost. Therefore, a port need not retain a copy of a CT mode packet whose transmission has been completed. </P>

<P> </P>

<P>The LP-Serial link protocol uses the ackID value carried in each packet to ensure that no RT mode packets are lost due to transmission errors. With one exception, a port shall accept packets from a LP-Serial link only in sequential ackID order, i.e. if the ackID value of the last packet accepted was N, the ackID value of the next packet that is accepted must be (N+1) modulo2n where n is the number of bits in the ackID field. The exception is when an event has occurred that caused a port to enter the Input Error-stopped state. A CT mode packet received by a port after the port entered the Input Error-stopped state and before the port receives a link-request/input-status control symbol shall be accepted by the port without regard to the value of the packet&#8217;s ackID field if the packet is otherwise error free and there are adequate receive buffer resources to accept the packet. The value that is maintained by the port of the ackID expected in the next packet shall not be changed by the acceptance of CT packets during this period. </P>

<P> </P>

<P>A LP-Serial port accepts or rejects each error free packet that it receives with the expected ackID depending on whether the port has input buffer space available for the  VC  and/or  priority  level  of  the  packet. The  use  of  the  packet-accepted, packet-retry, packet-not-accepted and restart-from-retry control symbols and the </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>buf_status field in packet acknowledgment control symbols to control the flow of packets across a LP-Serial link is covered in Section 5.9, &quot;Flow Control&quot;. </P>

<P> </P>

<P>The LP-Serial link protocol allows a packet that is being transmitted to be canceled at any point during its transmission. Packet cancellation is covered in Section 5.10, &quot;Canceling Packets&quot;. </P>

<P> </P>

<P>The LP-Serial link protocol provides detection and recovery processes for both transmission errors and protocol violations. The enumeration of detectable errors, the detection of errors and the associated error recovery processes are covered in Section 5.13, &quot;Error Detection and Recovery&quot;. </P>

<P> </P>

<P>In order to prevent switch processing element internal errors, such as SRAM soft bit errors, from silently corrupting a packet and the system, switch processing elements shall maintain packet error detection coverage while a packet is passing through the switch. The simplest method for maintaining packet error detection coverage is to pass the packet CRC through the switch as part of the packet. This works well for all non-maintenance packets whose CRC does not change as the packets are transported from source to destination through the fabric. Maintaining error detection coverage is more complicated for maintenance packets as their hop_count and CRC change every time they pass through a switch. However, passing the packet CRC through the switch as part of the packet does not prevent packet loss due to soft errors within the switch. Recovery from soft errors within a switch requires that each packet passing through the switch be covered by some type of error correction of adequate strength. </P>

<P> </P>

<P>In order to support transaction ordering requirements of the logical layer specifications,   the   LP-Serial   protocol   imposes   packet   delivery   ordering requirements within   the   physical   layer   and   transaction   delivery   ordering requirements between the physical layer and the transport layer in end point processing elements. These requirements are covered in Section 5.11, &quot;Transaction and Packet Delivery Ordering Rules&quot;. </P>

<P> </P>

<P>In order to prevent deadlock, the LP-Serial protocol imposes a set of deadlock prevention rules. These rules are covered in Section 5.12, &quot;Deadlock Avoidance&quot;. </P>

<P> </P>

<Figure Alt=""/>

<P>This specification provides both bandwidth reservation and priority based channels. Priority scheduling may or may not be included in the reservation of bandwidth. Whatever allocation of bandwidth is used for priority traffic, higher level flows will reduce the bandwidth available for lower level flows. It is possible that traffic associated with higher flow levels can starve traffic associated with lower flow levels. It is important to use the available flows properly for the transaction type, to insure the rules in Section 5.11, &quot;Transaction and Packet Delivery Ordering Rules&quot; and Section 5.12, &quot;Deadlock Avoidance&quot; are met. The actual mechanisms used to schedule traffic are beyond the scope of this specification. </P>

<P> </P>

<P> </P>

<P> </P>

<P>5.9 Flow Control </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>This section defines RapidIO LP-Serial link level flow control. The flow control operates between each pair of ports connected by a LP-Serial link. The purpose of link level flow control is to prevent the loss of packets due to a lack of buffer space in a link receiver. </P>

<P> </P>

<P>The LP-Serial protocol defines two methods or modes of flow control. These are named receiver-controlled flow control and transmitter-controlled flow control. Every  RapidIO  LP-Serial  port  shall  support  receiver-controlled flow  control. LP-Serial ports may optionally support transmitter-controlled flow control. </P>

<P> </P>

<P> </P>

<P>5.9.1  Receiver-Controlled Flow Control </P>

<P> </P>

<P>Receiver-controlled flow control is the simplest and basic method of flow control. In this method, the input side of a port controls the flow of packets from its link partner by accepting or rejecting packets on a packet by packet basis. The receiving port provides no information to its link partner about the amount of buffer space it has available for packet reception. </P>

<P> </P>

<P>As a result, its link partner transmits packets with no a priori expectation as to whether a given packet will be accepted or rejected. A port signals its link partner that it is operating in receiver-controlled flow control mode by setting the buf_status field to all 1&#8217;s in every control symbol containing the field that the port transmits. This method is named receiver-controlled flow control because the receiver makes all of the decisions about how buffers in the receiver are allocated for packet reception. </P>

<P> </P>

<P>A port operating in receiver-controlled flow control mode accepts or rejects each inbound error free packet based on whether the receiving port has enough buffer space available for the VC and the priority level of the packet. If there is enough buffer space available, the port accepts the packet and transmits a packet-accepted control symbol to its link partner that contains the ackID of the accepted packet in its packet_ackID field. This informs the port&#8217;s link partner that the packet has been received without detected errors and that it has been accepted by the port. On receiving the packet-accepted control symbol, the link partner discards its copy of the accepted packet freeing buffer space in the partner. </P>

<P> </P>

<P>The remaining behavior is a function of the mode of the VC. </P>

<P> </P>

<P>5.9.1.1  Reliable Traffic VC Receivers </P>

<P> </P>

<P>If buffer space is not available, the port rejects the packet. If multiple VCs are active, and the VC is in reliable traffic mode, the rejected packet shall be acknowledged with the packet-not-accepted control symbol. The cause field of the control symbol should be set to &#8220;packet not accepted due to lack of resources&#8221;. This causes the entire &#8220;RT Group&#8221; to go through the same process used in error recovery to resequence and </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>retransmit the RT packets. See Section 5.13, &quot;Error Detection and Recovery&quot; for details. </P>

<P> </P>

<P>If the port is operating in single VC mode, the port may use the Packet Retry protocol  described in  Section 5.9.1.3,  &quot;Single VC  Retry  Protocol&quot;,  or  it  may continue to use the packet-not-accepted protocol described above. </P>

<P> </P>

<P>5.9.1.2  Continuous Traffic VC Receivers </P>

<P> </P>

<P>If buffer space is not available, and the VC is in CT mode, the packet is acknowledged as accepted, and the packet is discarded. This preserves the order of the normal link response and does not impact performance. Receiver based flow control for CT channels will result in packet loss due to receiver overruns depending on bandwidth and buffering conditions. See Section 5.9.2, &quot;Transmitter-Controlled Flow Control&quot; for transmitter based flow control options. </P>

<P> </P>

<P>5.9.1.3  Single VC Retry Protocol </P>

<P> </P>

<P>When operating with a single VC (VC0), the receiver may use the retry protocol for handling receiver overruns. It is a requirement that implementers include this functionality in the channel design to be backward compatible with existing RapidIO interfaces. </P>

<P> </P>

<P>When a port rejects a packet, it immediately enters the Input Retry-stopped state and follows the  Input Retry-stopped recovery process specified in  Section 5.9.1.4, &quot;Input Retry-Stopped Recovery Process&quot;. As part of the Input Retry-stopped recovery process, the port sends a packet-retry control symbol to its link partner indicating that the packet whose ackID is in the packet_ackID field of the control symbol and all packets subsequently transmitted by the port have been discarded by the link partner and must all be retransmitted. The control symbol also indicates that the link partner is temporarily out of buffers for packets of priority less than or equal to the priority of the retried packet. </P>

<P> </P>

<P>A port that receives a packet-retry control symbol immediately enters the Output Retry-stopped state and follows the Output Retry-stopped recovery process specified in Section 5.9.1.5, &quot;Output Retry-Stopped Recovery Process&quot;. As part of the Output Retry-stopped recovery process, the port receiving the packet-retry control symbol sends a restart-from-retry control symbol which causes its link partner to exit the Input Retry-stopped state and resume packet reception. The ackID assigned to that first packet transmitted after the restart-from-retry control symbol is the ackID of the packet that was retried. </P>

<P> </P>

<P>Figure 5-2  shows  an  example  of  single  VC  receiver-controlled  flow  control operation. In this example the transmitter is capable of sending packets faster than the receiver is able to absorb them. Once the transmitter has received a retry for a packet, the transmitter may elect to cancel any packet that is presently being transmitted since it will be discarded anyway. This makes bandwidth available for any higher priority packets that may be pending transmission. </P>

<P> </P>

<P>146 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Transmitter Receiver </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_977.jpg"/>
</Figure>

<P>Time Write 0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_978.jpg"/>
</Figure>

<P>Write 1  Ack 0 </P>

<P>Write 2 </P>

<P> </P>

<P>Write 3 </P>

<P>Write 4 </P>

<P>Write 5 </P>

<P>Write 2 </P>

<P>Write 3 </P>

<P>Write 4 </P>

<P>Ack 1 </P>

<P> </P>

<P> </P>

<P>Rtry 2 </P>

<P> </P>

<P> </P>

<P>Ack 2 </P>

<P>Write 5  Ack 3 </P>

<P> </P>

<P>Ack 4 </P>

<P> </P>

<P> </P>

<P>Ack 5 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 5-2. Single VC Mode Receiver-Controlled Flow Control </P>

<P> </P>

<P>5.9.1.4  Input Retry-Stopped Recovery Process </P>

<P> </P>

<P>When the input side of a port operating with only VC0 active (single VC mode) retries a packet, it immediately enters the Input Retry-stopped state. To recover from this state, the input side of the port takes the following actions. </P>

<P> </P>

<P>&#8226; Discards the rejected or canceled packet without reporting a packet error and ignores all subsequently received packets while the port is in the Input Retry-stopped state. </P>

<P>&#8226; Causes the output side of the port to issue a packet-retry control symbol containing the ackID value of the retried packet in the packet_ackID field of the control symbol. (The packet-retry control symbol causes the output side of the link partner to enter the Output Retry-stopped state and send a </P>

<P>restart-from-retry control symbol.) </P>

<P>&#8226; When a restart-from-retry control symbol is received, exit the Input </P>

<P>Retry-stopped state and resume packet reception. </P>

<P> </P>

<P>An example state machine with the behavior described in this section is included in </P>

<P>Section C.2, &quot;Packet Retry Mechanism&quot;. </P>

<P> </P>

<P>5.9.1.5  Output Retry-Stopped Recovery Process </P>

<P> </P>

<P>To recover from the Output Retry-stopped state, the output side of a port takes the following actions. </P>

<P> </P>

<P>&#8226; Immediately stops transmitting new packets. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Resets the link packet acknowledgment timers for all transmitted but unacknowledged packets. (This prevents the generation of spurious timeout errors.) </P>

<P>&#8226; Transmits a restart-from-retry control symbol. </P>

<P>&#8226; Backs up to the first unaccepted packet (the retried packet) which is the packet whose ackID value is specified by the packet_ackID value contained in the packet-retry control symbol. (The packet_ackID value is also the value of ackID field the port retrying the packet expects in the first packet it receives after receiving the restart-from-retry control symbol.) </P>

<P>&#8226; Exits the Output Retry-stopped state and resumes transmission with either the retried packet or a higher priority packet which is assigned the ackID value contained in the packet_ackID field of the packet-retry control symbol. </P>

<P> </P>

<P>An example state machine with the behavior described in this section is included in </P>

<P>Section C.2, &quot;Packet Retry Mechanism&quot;. </P>

<P> </P>

<P> </P>

<P>5.9.2  Transmitter-Controlled Flow Control </P>

<P> </P>

<P>In transmitter-controlled flow control, the receiving port provides information to its link partner about the amount of buffer space it has available for packet reception. With this information, the sending port can allocate the use of the receiving port&#8217;s receive buffers according to the number and priority of packets that the sending port has waiting for transmission without concern that one or more of the packets shall be forced to retry. </P>

<P> </P>

<P>A port signals its link partner that it is operating in transmitter-controlled flow control mode by setting the buf_status field to a value different from all 1&#8217;s in every control symbol containing the field that the port transmits. This method is named transmitter-controlled flow control because the transmitter makes almost all of the decisions about how the buffers in the receiver are allocated for packet reception. </P>

<P> </P>

<P>The number of free buffers that a port has available for packet reception is conveyed to its link partner by the value of the buf_status field in the control symbols that the port transmits. The value conveyed by the buf_status field is the number of maximum length packet buffers currently available for packet reception up to the limit that can be reported in the field. If a port has more buffers available than the maximum value that can be reported in the buf_status field, the port sets the field to that maximum value. A port may report a smaller number of buffers than it actually has available, but it shall not report a greater number. </P>

<P> </P>

<P>A port informs its link partner when the number of free buffers available for packet reception changes. The new value of buf_status is conveyed in the buf_status field of a packet-accepted, packet-retry, status, or VC_status control symbol. Each change in the number of free buffers a port has available for packet reception need not be conveyed to the link partner. However, a port shall send a control symbol </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>containing the buf_status field to its link partner no less often than the minimum rate specified in Section 5.5.3.2, &quot;Buffer Status Maintenance&quot;. </P>

<P> </P>

<P>When a port implements more than VC0, the value of buf_status is kept on a per VC basis by the receiving port. When a packet-accepted symbol is returned, the buf_status field is filled with the status for the specific VC that the packet was sent to. When sending buf_status asynchronously (not in response to any specific packet), the status control symbol is used for VC0, and the VC_status control symbol is used for VC&#8217;s 1-8. </P>

<P> </P>

<P>A port whose link partner is operating in transmitter-control flow control mode should never receive a packet-not-accepted (or packet-retry control symbol if operating in single VC mode) from its link partner unless the port has transmitted more packets than its link partner has receive buffers, has violated the rules that all input buffers may not be filled with low priority packets or there is some fault condition.  A  receiver  overrun  is  handled  according  to  the  rules  in  5.9.1, &quot;Receiver-Controlled Flow Control&quot;. </P>

<P> </P>

<P>If a port, operating in single VC mode, for whose link partner is operating in transmitter-control flow control mode, receives a packet-retry control symbol, the output side of the port immediately enters the Output Retry-stopped state and follows the Output Retry-stopped recovery process specified in Section 5.9.1.5, &quot;Output Retry-Stopped Recovery Process&quot;. </P>

<P> </P>

<P>A simple example of single VC transmitter-controlled flow control is shown in </P>

<P>Figure 5-3. </P>

<P> </P>

<P> </P>

<P>Transmitter Receiver </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_979.jpg"/>
</Figure>

<P>Time Write 0 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_980.jpg"/>
</Figure>

<P>Write 1 </P>

<P> </P>

<P> </P>

<P>Write 2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Write 3 </P>

<P>Write 4 </P>

<P>Write 5 </P>

<P>Ack 0, 2 buffers avail </P>

<P> </P>

<P>Ack 1, 1 buffer avail </P>

<P> </P>

<P> </P>

<P>Ack 2, 0 buffers avail Idle, 0 buffers avail Idle, 0 buffers avail Idle, 2 buffers avail </P>

<P> </P>

<P>Ack 3, 3 buffers avail </P>

<P> </P>

<P>Ack 4, 2 buffers avail </P>

<P> </P>

<P>Ack 5, 1 buffers avail </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 5-3. Single VC Mode Transmitter-Controlled Flow Control </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.9.2.1  Receive Buffer Management </P>

<P> </P>

<P>In transmitter-controlled flow control, the transmitter manages the packet receive buffers in the receiver. This may be done in a number of ways, but the selected method  shall  not  violate  the  rules  in  Section 5.12,  &quot;Deadlock  Avoidance&quot; concerning the acceptance of packets by ports. </P>

<P> </P>

<P>For VC0, it is important to manage buffers in a way that reserves room for high priority packets. One possible implementation to organize the buffers is to establish watermarks and use them to progressively limit the packet priorities that can be transmitted as the effective number of free VC0 buffers in the receiver decreases. For example, VC0 has four priority levels. Three non-zero watermarks are needed to progressively limit the packet priorities that may be transmitted as the effective number of free VC0 buffers decreases. Designate the three watermarks as WM0, WM1, and WM2 where WM0 &gt; WM1 &gt; WM2 &gt; 0 and employ the following rules. </P>

<P> </P>

<P>If free_buffer_count0 &gt;= WM0, all priority packets may be transmitted. </P>

<P> </P>

<P>If WM0 &gt; free_buffer_count0 &gt;= WM1, only priority 1, 2, and 3 packets may be transmitted. </P>

<P> </P>

<P>If WM1 &gt; free_buffer_count0 &gt;= WM2, only priority 2 and 3 packets may be transmitted. </P>

<P> </P>

<P>If WM2 &gt; free_buffer_count0, only priority 3 packets may be transmitted. </P>

<P> </P>

<P>If this method is implemented, the initial values of the watermarks may be set by the hardware at reset as follows. </P>

<P> </P>

<P>WM0 = 4 </P>

<P> </P>

<P>WM1 = 3 </P>

<P> </P>

<P>WM2 = 2 </P>

<P> </P>

<P>These initial values may be modified by hardware or software. The modified watermark values shall be based on the number of free buffers reported in the buf_status field of status control symbols received by the port following link initialization and before the start of packet transmission. </P>

<P> </P>

<P>The three watermark values and the number of free buffers reported in the buf_status field of status control symbols received by the port following link initialization and before the start of packet transmission may be stored in a CSR. Since the maximum value of each of these four items is 62, each will fit in an 8-bit field and all four will fit in a single 32-bit CSR. If the watermarks are software setable, the three watermark fields in the CSR should be writable. For the greatest flexibility, a watermark register should be provided for each port on a device. </P>

<P> </P>

<P>For VCs 1-8, packets within the same VC are equal in priority and always kept in order. The free buffers in the receiver can be partitioned between VCs in any number </P>

<P> </P>

<P>150 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>of ways: they can be equally divided among the VCs, they can be statically partitioned based on the bandwidth allocation percentages, or they may be dynamically allocated from a larger pool. The only requirement is that once a given amount of buffers is reported by the receiver to the transmitter those buffers shall remain available for packets for that VC. Buffers may be deallocated once they are used, by removing the data, but not reporting the buffer available to that VC. At that time, the buffer may be reallocated to another VC. The specific method of buffer allocation is beyond the scope of this specification. </P>

<P> </P>

<P>5.9.2.2  Effective Number of Free Receive Buffers </P>

<P> </P>

<P>The number of buffers available in a link partner for packet reception on a given VC is typically less than the value of the buf_status field most recently received for that VC from the link partner. The value in the buf_status field does not account for packets that have been transmitted by the VC but not acknowledged by its link partner. The variable free_buffer_countN is defined to be the effective number of free buffers available in the link partner for packet reception on VC N. The recommended way for a port to compute and maintain these &#8220;free buffer counts&#8221; is to implement the following rules. </P>

<P>1.  Each active VC maintains a variable &#8220;free_buffer_countVC&#8221; whose value shall be the effective number of free buffers available to that VC in the link partner for packet reception. </P>

<P>2.  Each active VC maintains a variable &#8220;outstanding_packet_countVC&#8221; whose value is number of packets that have been transmitted on that VC, but that have not been acknowledged by its link partner. </P>

<P>3.  After link initialization and before the start of packet transmission, If {[(control_symbol = short) &amp; (received_buf_status &lt; 31)] | </P>

<P>[(control_symbol = long) &amp; (received_buf_status &lt; 63)]} { </P>

<P>flow_control_mode = transmitter; free_buffer_count0 = received_buf_status0; outstanding_packet_count0 = 0; </P>

<P>for VC 1 through 8 { </P>

<P>free_buffer_countVC = </P>

<P>received_VC_buffer_statusVC </P>

<P>outstanding_packet_countVC = 0 </P>

<P> </P>

<P>} </P>

<P>else </P>

<P>} </P>

<P> </P>

<P> </P>

<P> </P>

<P>flow_control_mode = receiver; </P>

<P> </P>

<P> </P>

<P>4.  When a status or VC_Status control symbol is received by the port, free_buffer_countVC =&#61472;&#61472;</P>

<P>received_buf_statusVC - outstanding_packet_countVC; </P>

<P> </P>

<P>RapidIO Trade Association 151 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>5.  When a packet is transmitted by the VC, outstanding_packet_count VC= </P>

<P>outstanding_packet_countVC + 1 </P>

<P>free_buffer_countVC = free_buffer_countVC - 1 </P>

<P> </P>

<P>6.  When a packet-accepted control symbol is received by the port indicating that a packet has been accepted by the link partner, the buf_status field of the control symbol is reassociated with the originating VC: </P>

<P>Outstanding_packet_countVC = </P>

<P> </P>

<P>free_buffer_countVC =&#61472;&#61472;</P>

<P>Outstanding_packet_countVC - 1; </P>

<P>received_buf_statusVC - outstanding_packet_countVC; </P>

<P> </P>

<P>7.  When a packet-retry control symbol is received by the port indicating that a packet has been forced by the link partner to retry, </P>

<P>Outstanding_packet_count0 = 0; </P>

<P>free_buffer_count0 = received_buf_status0; </P>

<P>8.  When a packet-not-accepted control symbol is received by the port indicating </P>

<P>that a packet has been rejected by the link partner because of one or more detected errors or a lack of buffer resources, </P>

<P>Outstanding_packet_countVC = 0; </P>

<P>free_buffer_countVC = free_buffer_count VC (remains unchanged); </P>

<P>9.  When a link-response control symbol is received, </P>

<P>free_buffer_count0 = received_buf_status; </P>

<P> </P>

<P>5.9.2.3  Speculative Packet Transmission </P>

<P> </P>

<P>A port whose link partner is operating in transmitter-controlled flow control mode may send more packets on a given VC than the number of free buffers indicated by the link partner as being available for that VC. Packets transmitted in excess of the free_buffer_count are transmitted on a speculative basis and are subject to retry by the link partner. The link partner accepts or rejects these packets on a packet by packet basis in exactly the same way it would if operating in receiver-controlled flow control mode. A port may use such speculative transmission in an attempt to maximize the utilization of the link. However, speculative transmission that results in a significant number of retries and discarded packets can reduce the effective bandwidth of the link. </P>

<P> </P>

<P>When the link has multiple operating VCs, speculative packet transmission may increase the CT packet loss rate and how frequently the link runs the error-recovery process. </P>

<P> </P>

<P> </P>

<P> </P>

<P>152 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.9.3  Flow Control Mode Negotiation </P>

<P> </P>

<P>Immediately following the initialization of a link, each port begins sending status control symbols to its link partner. The value of the buf_status field in these control symbols indicates to the link partner the flow control mode supported by the sending port. </P>

<P> </P>

<P>The flow control mode negotiation rule is as follows: </P>

<P> </P>

<P>If the port and its link partner both support transmitter-controlled flow control, then both ports shall use transmitter-controlled flow control. Otherwise, both ports shall use receiver-controlled flow control. </P>

<P> </P>

<P>If multiple VCs are used, then a port shall have either all channels in receiver based flow control or all channels in transmitter based flow control. All status and VC_status control symbols shall be consistent in their buf_status reporting in this regard. </P>

<P> </P>

<P> </P>

<P>5.10 Canceling Packets </P>

<P> </P>

<P>When a port becomes aware of some condition that will require the packet it is currently transmitting to be retransmitted, the port may cancel the packet. This allows the port to avoid wasting bandwidth by not completing the transmission of a packet that the port knows must be retransmitted. Alternatively, the sending port may choose to complete transmission of the packet normally. </P>

<P> </P>

<P>A port may cancel a packet if the port detects a problem with the packet as it is being transmitted or if the port receives a packet-retry or packet-not-accepted control symbol for a packet that is still being transmitted or that was previously transmitted. A packet-retry or packet-not-accepted control symbol can be transmitted by a port for a packet at any time after the port begins receiving the packet. </P>

<P> </P>

<P>The sending device shall use the stomp control symbol, the restart-from-retry control symbol (in response to a packet-retry control symbol), or any link request control symbol to cancel a packet. </P>

<P> </P>

<P>A port receiving a canceled packet shall drop the packet. The cancellation of a packet shall not result in the generation or report of any errors. If the packet was canceled because the sender received a packet-not-accepted control symbol, the error that caused the packet-not-accepted to be sent shall be reported in the normal manner. </P>

<P> </P>

<P>The behavior of a port that receives a canceled packet depends on the control symbol that canceled the packet. A port that is not in an input stopped state (Retry-stopped or Error-stopped) while receiving the canceled packet and has not previously acknowledged the packet shall have the following behavior. </P>

<P> </P>

<P>If the packet is canceled by a link-request/input-status control symbol, the port shall drop the packet without reporting a packet error. </P>

<P> </P>

<P>RapidIO Trade Association 153 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>If the packet is canceled by a restart-from-retry control symbol a protocol error has occurred and the port shall immediately enter the Input Error-stopped state and follows the Input Error-stopped recovery process specified in Section 5.13.2.6, &quot;Input Error-Stopped Recovery Process&quot;. </P>

<P> </P>

<P>If  the packet was canceled by other than a  restart-from-retry or link-request/input-status control symbol and the port is operating in single VC mode (only VC0 is active), the port shall immediately enter the Input Retry-Stopped state and follow the Input Retry-Stopped recovery process specified in Section 5.9.1.4, &quot;Input Retry-Stopped Recovery Process&quot;. If the packet was canceled before the packet ackID field was received by the port, the packet_ackID field of the associated packet-retry control symbol acknowledging the packet shall be set to the ackID the port expected in the canceled packet </P>

<P> </P>

<P>If  the packet was canceled by other than a  restart-from-retry or link-request/input-status control symbol and the port is operating in multiple VC mode (at least one of VC1-8 is active), the port shall immediately enter the Input Error-Stopped state and follow the Input Error-Stopped recovery process specified in Section 5.13.2.6, &quot;Input Error-Stopped Recovery Process&quot;. </P>

<P> </P>

<P>A packet whose transmission is canceled shall be considered to be an untransmitted packet. </P>

<P> </P>

<P> </P>

<P>5.11 Transaction and Packet Delivery Ordering Rules </P>

<P> </P>

<P>The rules specified in this section are required for the physical layer to support the transaction ordering rules specified in the logical layer specifications. </P>

<P> </P>

<P>Transaction Delivery Ordering Rules: </P>

<P> </P>

<P>1. The physical layer of an end point processing element port shall encapsulate in packets and forward to the RapidIO fabric transactions comprising a given transaction request flow in the same order that the transactions were received from the transport layer of the processing element. </P>

<P> </P>

<P>2.The physical layer of an end point processing element port shall ensure that a higher priority request transaction that it receives from the transport layer of the processing element before a lower priority request transaction with the same sourceID and the same destinationID is forwarded to the fabric before the lower priority transaction. </P>

<P> </P>

<P>3. The physical layer of an end point processing element port shall deliver transactions to the transport layer of the processing element in the same order that the packetized transactions were received by the port. </P>

<P> </P>

<P>154 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Packet Delivery Ordering Rules: </P>

<P> </P>

<P>1. A packet initiated by a processing element shall not be considered committed to the RapidIO fabric and does not participate in the packet delivery ordering rules until the packet has been accepted by the device at the other end of the link. (RapidIO does not have the concept of delayed or deferred transactions. Once a packet is accepted into the fabric, it is committed.) </P>

<P> </P>

<P>2. A switch shall not alter the priority, critical request flow or VC of a packet. </P>

<P> </P>

<P>3. Packet forwarding decisions made by a switch processing element shall provide a consistent output port selection which is based solely on the value of the destinationID field carried in the packet. </P>

<P> </P>

<P>4. A switch processing element shall not change the order of packets comprising a transaction request flow (packets with the same sourceID, the same destinationID, the same priority, same critical request flow, same VC bit, and ftype != 8) as the packets pass through the switch. </P>

<P> </P>

<P>5. A  switch  processing  element  shall  not  allow  lower  priority non-maintenance  packets  (ftype != 8)  to  pass  higher  priority non-maintenance packets    with    the    same    sourceID   and destinationID as the packets pass through the switch. </P>

<P> </P>

<P>6. A  switch  processing  element  shall  not  allow  a  priority  N maintenance  packet  (ftype = 8)  to  pass  another  maintenance packet of priority N or greater that takes the same path through the switch (same switch input port and same switch output port). </P>

<P> </P>

<P>Rules for Scheduling Among VCs: </P>

<P> </P>

<P>The whole link bandwidth is evenly divided into &#8216;N&#8217; portions and each portion is 1/N of the whole link bandwidth. Each VC is configured to have guaranteed bandwidth. The method among VCs is also vendor dependent, as long as it satisfies the following three rules: </P>

<P> </P>

<P>1. If the total guaranteed bandwidth for all the supported VCs is more than </P>

<P>100%,  then  the  received  bandwidth  for  each  supported VC  cannot  be guaranteed. </P>

<P> </P>

<P>2.  If the total guaranteed bandwidth for all the supported VCs is less than or equal to 100%, demand for more than its guaranteed bandwidth shall not cause any other VCs to receive less than their guaranteed bandwidth. </P>

<P> </P>

<P>3.  If one VC demands less bandwidth than its guaranteed bandwidth, the extra bandwidth may be distributed among other VCs. </P>

<P> </P>

<P>If VC0 participates in the bandwidth reservation process, then all VCs will receive their expected minimum bandwidth. However, VC0 may be treated as a special case. VC0 may be treated with strict priority, getting whatever bandwidth is required when it has traffic to transport. In this condition, the remaining VCs will divide up </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 155 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>whatever portion of bandwidth remains. If VC0&#8217;s utilization is significant, compared with the traffic on the other VCs, then the other VCs bandwidth will still be proportional to each other, but will vary as the available bandwidth is modified by VC0. </P>

<P> </P>

<P>The implementer may also choose to implement some priorities within VC0 with strict priority, and schedule the rest with reserved bandwidth. This specification does not require any particular treatment as there are application cases for any of the above. Chapter 6, &quot;LP-Serial Registers&quot; defines a standard control register should the implementer decide to make this a programmable feature. </P>

<P> </P>

<P> </P>

<P>5.12 Deadlock Avoidance </P>

<P> </P>

<P>Request transactions requiring responses shall only use VC0. The response packet shall only use VC0. The following requirements apply to prioritized traffic within VC0. </P>

<P> </P>

<P>To allow a RapidIO protocol to evolve without changing the switching fabric, switch processing elements are not required, with the sole exception of ftype 8 maintenance transactions, to discern between packet types, their functions or their interdependencies. Switches, for instance, are not required to discern between packets carrying request transactions and packets carrying response transactions. As a result, it is possible for two end points, A and B to each fill all of their output buffers, the fabric connecting them and the other end point&#8217;s input buffers with read requests. This would result in an input to output dependency loop in each end point in which there would be no buffer space to hold the responses necessary to complete any of the outstanding read requests. </P>

<P> </P>

<P>To break input to output dependencies, end point processing elements must have the ability to issue outbound response packets even if outbound request packets awaiting transmission are congestion blocked by the connected device. Two techniques are provided to break input to output dependencies. First, a response packet (a packet carrying a response transaction) is always assigned an initial priority one priority level greater than the priority of the associated request packet (the packet carrying the associated request transaction). </P>

<P> </P>

<P>This requirement is specified in Table 5-2 and Table 5-3. It breaks the dependency cycle at the request flow level. Second, the end point processing element that is the source of the response packet may additionally raise the priority of the response packet to a priority higher than the minimum required by Table 5-2 and Table 5-3 if necessary for the packet to be accepted by the connected device. This additional increase in response packet priority above the minimum required by Table 5-2 and Table 5-3 is called promotion. An end point processing element may promote a response packet only to the degree necessary for the packet to be accepted by the connected device. </P>

<P> </P>

<P>The following rules define the deadlock prevention mechanism: </P>

<P> </P>

<P>156 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Deadlock Prevention Rules: </P>

<P> </P>

<P>1. A RapidIO fabric shall be dependency cycle free for all operations that do not require a response. (This rule is necessary as there are no mechanisms provided in the fabric to break dependency cycles for operations not requiring responses.) </P>

<P> </P>

<P>2. A packet carrying a request transaction that requires a response shall not be issued at the highest priority. (This rule ensures that an end point processing element can issue a response packet at a priority higher than the priority of the associated request. This rule in combination with rule 3 are basis for the priority assignments in Table 5-2 and Table 5-3) </P>

<P> </P>

<P>3. A packet carrying a response shall have a priority at least one priority level higher than the priority of the associated request. (This rule in combination with rule 2 are basis for the priority assignments in Table 5-2 and Table 5-3) </P>

<P> </P>

<P>4. A switch processing element port shall accept an error-free packet of priority N if there is no packet of priority greater than or equal to N that was previously received by the port and is still waiting in the switch to be forwarded. (This rule has multiple implications which include but are not limited to the following. First, a switch processing element port must have at least as many maximum length packet input buffers as there are priority levels. Second, a minimum of one maximum length packet input buffer must be reserved for each priority level. A input buffer reserved for priority N might be restricted to only priority N packets or might be allowed to hold packets of priority greater than or equal to N, either approach complies with the rule.) </P>

<P> </P>

<P>5. A switch processing element port  that  transmits a  priority N packet that is forced to retry by the connected device shall select a packet of priority greater than N, if one is available, for transmission. (This guarantees that packets of a given priority will not block higher priority packets.) </P>

<P> </P>

<P>6. An end point processing element port shall accept an error-free packet of priority N if the port has enough space for the packet in the input buffer space of the port allocated for packets of priority N. (Lack of input buffer space is the only reason an end point may retry a packet.) </P>

<P> </P>

<P>7. The decision of an end point processing element to accept or retry an error-free packet of priority N shall not depend on the ability of the end point to issue request packets of priority less than or equal to N from any of its ports. (This rule works in conjunction with rule 6. It prohibits a device&#8217;s inability to issue packets of priority less than or equal to N, due to congestion in the connected device, from resulting in a lack of buffers to receive inbound packets of priority greater than or equal to N which in turn would result in packets of priority greater than or equal to N being forced to retry. The implications and some ways of complying with this rule are presented in the following paragraphs.) </P>

<P> </P>

<P>RapidIO Trade Association 157 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>One implication of Rule 7 is that a port may not fill all of its buffers that can be used to hold packets awaiting transmission with packets carrying request transactions. If this situation was allowed to occur and the output was blocked due to congestion in the connected device, read transactions could not be processed (no place to put the response packet), input buffer space would become filled and all subsequent inbound request packets would be forced to retry violating Rule 7. </P>

<P> </P>

<P>Another implication is that a port must have a way of preventing output blockage at priority less than or equal to N, due to congestion in the connected device, from resulting in a lack of input buffer space for inbound packets of priority greater than or equal to N. There are multiple ways of doing this. </P>

<P> </P>

<P>One way is to provide a port with input buffer space for at least four maximum length packets and reserve input buffer space for higher priority packets in a manner similar to that required by Rule 4 for switches. In this case, output port blockage at priority less than or equal to N will not result is blocking inbound packets of priority greater than or equal to N as any responses packets they generate will be of priority greater than N which is not congestion blocked. The port must however have the ability to select packets of priority greater than N for transmission from the packets awaiting transmission. This approach does not require the use of response packet priority promotion. </P>

<P> </P>

<P>A port can use the promotion mechanism to increase the priority of response packets until they are accepted by the connected device. This allows output buffer space containing response packets to be freed even though all request packets awaiting transmission are congestion blocked. </P>

<P> </P>

<P>As an example, suppose an end point processing element has a blocked input port because all available resources are being used for a response packet that the processing element is trying to send. If the response packet is retried by the downstream processing element, raising the priority of the response packet until it is accepted allows the processing element&#8217;s input port to unblock so the system can make forward progress. </P>

<P> </P>

<P>It should be noted that implementing response priority promotion in a device may help with its link partner&#8217;s input buffer congestion, not its own input buffer congestion. It should also be noted that response priority promotion may not be able to guarantee forward progress in the system unless the link partner has implemented priority based input buffer reservation. </P>

<P> </P>

<P> </P>

<P>5.13 Error Detection and Recovery </P>

<P> </P>

<P>Error detection and recovery is becoming a more important issue for many systems. The LP-Serial specification provides extensive error detection and recovery by combining retry protocols with cyclic redundancy codes, the selection of delimiter special characters and response timers. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>One feature of the error protection strategy is that with the sole exception of maintenance packets, the CRC value carried in a packet remains unchanged as the packet moves through the fabric. The CRC carried in a maintenance packet must be regenerated at each switch as the hop count changes. </P>

<P> </P>

<P> </P>

<P>5.13.1  Lost Packet Detection </P>

<P> </P>

<P>Some types of errors, such as a lost request or response packet or a lost acknowledgment, result in a system with hung resources. To detect this type of error there shall be timeout counters that expire when sufficient time has elapsed without receiving the expected response from the system. Because the expiration of one of these timers should indicate to the system that there is a problem, this time interval should be set long enough so that a false timeout is not signaled. The response to this error condition is implementation dependent. </P>

<P> </P>

<P>The RapidIO specifications require timeout counters for the physical layer, the port link timeout counters, and counters for the logical layer, the port response timeout counters. The interpretation of the counter values is implementation dependent, based on a number of factors including link clock rate, the internal clock rate of the device, and the desired system behavior. </P>

<P> </P>

<P>The physical layer timeout occurs between the transmission of a packet and the receipt of an acknowledgment control symbol. This timeout interval is likely to be comparatively short because the packet and acknowledgment pair must only traverse a single link. </P>

<P> </P>

<P>The logical layer timeout occurs between the issuance of a request packet that requires a response packet and the receipt of that response packet. This timeout is counted from the time that the logical layer issues the packet to the physical layer to the time that the associated response packet is delivered from the physical layer to the logical layer. Should the physical layer fail to complete the delivery of the packet, the logical layer timeout will occur. This timeout interval is likely to be comparatively long because the packet and response pair have to traverse the fabric at least twice and be processed by the target. Error handling for a response timeout is implementation dependent. </P>

<P> </P>

<P>Certain GSM operations may require two response transactions, and both must be received for the operation to be considered complete. In the case of a device implementation with multiple links, one response packet may be returned on the same link where the operation was initiated and the other response packet may be returned on a different link. If this behavior is supported by the issuing processing element, the port response timeout implementation must look for both responses, regardless on which links they are returned. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.13.2  Link Behavior Under Error </P>

<P> </P>

<P>The LP-Serial link uses error detection and retransmission to protect RT packets against loss or corruption due to transmission errors. Transmission error detection is done at the input port, and all transmission error recovery is also initiated at the input port. </P>

<P> </P>

<P>The packet transmission protocol requires that each RT packet transmitted by a port be acknowledged by the receiving port and that a port retain a copy of each RT packet that it transmits until the port receives a packet-accepted control symbol acknowledgment for the packet or the sending port determines that the packet has encountered an unrecoverable error. If the receiving port detects a transmission error in a packet, the port sends a packet-not-accepted control symbol acknowledgment back to the sender indicating that the packet was corrupted as received. After a link-request/input-status and link-response control symbol exchange, the sender begins retransmission with the next packet according to the priority/bandwidth scheduling rules. The RT VCs retransmit all packets that were unacknowledged at the time of the error. CT VCs continue with the next untransmitted packet. </P>

<P> </P>

<P>All RT packets corrupted in transmission are retransmitted. The number of times a packet may be retransmitted before the sending port determines that the packet has encountered an unrecoverable condition is implementation dependent. </P>

<P> </P>

<P>5.13.2.1  Recoverable Errors </P>

<P> </P>

<P>The following five basic types of errors are detected by a LP-Serial port: </P>

<P> </P>

<P>&#8226; An idle sequence error </P>

<P>&#8226; A control symbol error </P>

<P>&#8226; A packet error </P>

<P>&#8226; A column padding error </P>

<P>&#8226; A timeout waiting for an acknowledgment or link-response control symbol </P>

<P> </P>

<P>5.13.2.2  Idle Sequence Errors </P>

<P> </P>

<P>The detectable idle sequence errors depend on the idle sequence being used on the link. Links operating with short control symbols use the IDLE1 sequence. Links operating with long control symbols use the IDLE2 sequence. </P>

<P> </P>

<P>To limit input port complexity, the port is not required to determine the specific error that resulted in an idle sequence error. </P>

<P> </P>

<P>5.13.2.2.1  IDLE1 Sequence Errors </P>

<P> </P>

<P>The IDLE1 sequence is comprised of A, K, and R (8B/10B special) characters. If an input port detects an invalid character or any valid character other then A, K, or R in an IDLE1 sequence and the port is not in the Input Error-stopped state, the port shall immediately enter the Input Error-stopped state and follow the Input Error-stopped </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>recovery process specified in  Section 5.13.2.6, &quot;Input Error-Stopped Recovery </P>

<P>Process&quot;. </P>

<P> </P>

<P>Following are several examples of idle sequence errors. </P>

<P> </P>

<P>&#8226; A single bit transmission error can change an /A/, /K/, or /R/ code-group into a </P>

<P>/Dx.y/ (data) code-group which is illegal in an idle sequence. </P>

<P>&#8226; A single bit transmission error can change an /A/, /K/, or /R/ code-group into an invalid code-group. </P>

<P>&#8226; A single bit transmission error can change an /SP/ or /PD/ (control symbol delimiters) into an invalid code-group. </P>

<P> </P>

<P>5.13.2.2.2  IDLE2 Sequence Errors </P>

<P> </P>

<P>The IDLE2 sequence is comprised of A, K, M and R special characters and data characters. If an input port detects any of the following errors in an IDLE2 sequence and the port is not in the Input Error-stopped state, the port shall immediately enter the Input Error-stopped state and follow the Input Error-stopped recovery process specified in Section 5.13.2.6, &quot;Input Error-Stopped Recovery Process&quot;. </P>

<P>&#8226; An invalid character or any special character other than A, K, M or R </P>

<P>&#8226; After lane alignment is achieved, </P>

<P>a column that contains an A, but is not all As, a column that contains a K, but is not all Ks, </P>

<P>a column that contains a M, but is not all Ms, </P>

<P>a column that contains a R, but is not all Rs or </P>

<P>a column that contains a data character, but is not all data characters. </P>

<P> </P>

<P>5.13.2.3  Control Symbol Errors </P>

<P> </P>

<P>There are two types of detectable control symbol errors </P>

<P> </P>

<P>&#8226; An uncorrupted control symbol that violates the link protocol </P>

<P>&#8226; A corrupted control symbol </P>

<P> </P>

<P>5.13.2.3.1  Link Protocol Violations </P>

<P> </P>

<P>The reception of a control symbol with no detected corruption that violates the link protocol  shall  cause  the  receiving  port  to  immediately  enter  the  appropriate Error-stopped state. Stype1 control symbol protocol errors shall cause the receiving port to immediately enter the Input Error-stopped state if not already in the Input Error-stopped state and follow the Input Error-stopped recovery process specified in Section 5.13.2.6, &quot;Input Error-Stopped Recovery Process&quot;. Stype0 control symbol protocol errors shall cause the receiving port to immediately enter the Output Error-stopped state if not already in the Output Error-stopped state and follow the Output  Error-stopped  recovery  process  specified  in  Section 5.13.2.7,  &quot;Output Error-Stopped Recovery Process&quot;. If  both  stype0  and  stype1  control  symbols </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>contain protocol errors, then the receiving port shall enter both Error-stopped states and follow both error recovery processes. </P>

<P> </P>

<P>Link protocol violations include the following: </P>

<P> </P>

<P>&#8226; Unexpected packet-accepted, packet-retry, or packet-not-accepted control symbol </P>

<P>&#8226; Packet acknowledgment control symbol with an unexpected packet_ackID value </P>

<P>&#8226; Link timeout while waiting for an acknowledgment or link-response control symbol </P>

<P>&#8226; Receipt of a packet-retry symbol when operating in multi-VC mode </P>

<P> </P>

<P>The following does not constitute a protocol violation: </P>

<P> </P>

<P>&#8226; Receipt of a VC_status symbol when operating in single VC mode. Unexpected </P>

<P>VC_status symbols are discarded. </P>

<P> </P>

<P>The following is an example of a link protocol violation and recovery. A sender transmits RT mode packets labeled ackID 2, 3, 4, and 5. It receives acknowledgments for packets 2, 4, and 5, indicating a probable error associated with ackID   3.  The   sender   then   stops   transmitting  new   packets   and   sends   a link-request/input-status (restart-from-error) control symbol to the receiver. The receiver then returns a link- response control symbol indicating which packets it has received properly. These are the possible responses and the sender&#8217;s resulting behavior: </P>

<P>&#8226; expecting ackID = 3 - sender must retransmit packets 3, 4, and 5 </P>

<P>&#8226; expecting ackID = 4 - sender must retransmit packets 4 and 5 </P>

<P>&#8226; expecting ackID = 5 - sender must retransmit packet 5 </P>

<P>&#8226; expecting ackID = 6 - receiver got all packets, resume operation </P>

<P>&#8226; expecting ackID = anything else - fatal (non-recoverable) error </P>

<P> </P>

<P>5.13.2.3.2  Corrupted Control symbols </P>

<P> </P>

<P>The reception of a control symbol with detected corruption shall cause the receiving port to immediately enter the Input Error-stopped state if not already in the Input Error-stopped state and follow the Input Error-stopped recovery process specified in Section 5.13.2.6, &quot;Input Error-Stopped Recovery Process&quot;. </P>

<P> </P>

<P>Input ports detect the following types of control symbol corruption. </P>

<P> </P>

<P>&#8226; A control symbol containing invalid characters or valid but non-data characters </P>

<P>&#8226; A control symbol with an incorrect CRC value </P>

<P>&#8226; A control symbol whose start delimiter (SC or PD) occurs in a lane whose lane_number mod4 != 0 </P>

<P>&#8226; A long control symbol that does not have a end delimiter in the seventh character position after its start delimiter and with the same value as the start delimiter </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>5.13.2.4  Packet Errors </P>

<P> </P>

<P>Each packet received by a port shall be checked for the following types of errors: </P>

<P> </P>

<P>&#8226; Packet with an unexpected ackID value </P>

<P>&#8226; Packet with an incorrect CRC value </P>

<P>&#8226; Packet containing invalid characters or valid non-data characters </P>

<P>&#8226; Packet that exceeds the maximum packet size. </P>

<P> </P>

<P>With one exception, the reception of a packet with any of the above errors shall cause the receiving port to immediately enter the Input Error-stopped state if not already in the Input Error-stopped state and follow the Input Error-stopped recovery process specified in Section 5.13.2.6, &quot;Input Error-Stopped Recovery Process&quot;. The exception occurs when the link to which the port is connected is operating with the IDLE2 idle sequence, the packet in which one or more errors were detected was canceled by a link-request control symbol, and the only errors detected in the packet were the presence of one or more M special characters and may cause excessive packet length. In this case, the errors detected in the packet shall be ignored and the packet handled as  a  canceled packet as  specified in  Section 5.10, &quot;Canceling Packets&quot;. </P>

<P> </P>

<P>5.13.2.5  Link Timeout </P>

<P> </P>

<P>A link timeout while waiting for an acknowledgment or link-response control symbol is handled as a link protocol violation as described in Section 5.13.2.3.1, &quot;Link Protocol Violations&quot;. </P>

<P> </P>

<P>5.13.2.6  Input Error-Stopped Recovery Process </P>

<P> </P>

<P>When the input side of a port detects a transmission error, it immediately enters the Input Error-stopped state. To recover from this state, the input side of the port takes the following actions. </P>

<P>&#8226; Record the condition(s) that caused the port to enter the Input Error-stopped state. </P>

<P>&#8226; If an error(s) was detected in a control symbol or packet, ignore and discard the corrupted control symbol or packet. </P>

<P>&#8226; Cause the output side of the port to issue a packet-not-accepted control symbol. (The packet-not-accepted control symbol causes the output side of the receiving port to enter the Output Error-stopped state and send a </P>

<P>link-request/input-status control symbol.) </P>

<P>&#8226; Subsequent to the event that caused the port to enter the Input Error-stopped state and prior to the reception of a link-request/input-status control symbol, </P>

<P> </P>

<P>discard without acknowledgement or error report all packets that are received for VCs operating in RT mode, </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>accept without acknowledgement (accept silently) all error free packets that are received for VCs operating in CT mode for which the VC specified in the packet has buffer space available and </P>

<P> </P>

<P>discard without acknowledgement all packets that are received for VCs operating in CT mode which are not error free or for which the VC specified in the packet does not have buffer space available. </P>

<P>&#8226; When a link-request/input-status control symbol is received from the connected port, cause the output side of the port to transmit a link-response control symbol and if the transmitter-controlled flow control is in use on the link, to also transmit a VC_Status control symbol for each of VC1-8 that is active. The transmission of a VC_Status control symbol for each of VC1-8 that is active is optional if receiver-controlled flow control in use on the link. The input side of the port should also cause the output side of the port to transmit a status control symbol (for VC0). The input side of the port then exits the Input Error-stopped state and resumes normal packet reception. The actual transmission of the link-response, VC-status, and status control symbols may occur after the input side of the port exits the Input </P>

<P>Error-stopped state and resumes normal packet reception. </P>

<P>&#8226; The transmission of the link-response, status and VC-status control symbols is subject to the following requirements. </P>

<P> </P>

<P>The link-response control symbol shall be transmitted either before any of the status and VC-status control symbols are transmitted or after all of the status and VC-status control symbols are transmitted. </P>

<P> </P>

<P>The status and VC-status control symbols that are transmitted shall be transmitted in the following order. If a status control symbol is transmitted it shall be transmitted first before any of the VC-status control symbols. Any VC-status control symbols that are transmitted shall be transmitted after the status control symbol and in order of increasing VCID. </P>

<P> </P>

<P>The link-response control symbol shall not be transmitted until the input side of the port is ready to resume packet reception and either the buffer consumption of all packets received by the port before the link-request/input-status control symbol has been determined or the port is able to maintain the distinction after packet reception resumes between packets received before the reception of the link-request/input-status control symbol and     packets     received     after     the     reception    of     the link-request/input-status control symbol (as the processing of packets received before the link-request/input-status control symbol differs from the processing of packets received after the link-request/input-status control symbol). </P>

<P>The status or VC-status control symbol for a VC operating in </P>

<P>RT mode shall indicate the number of receive buffers available </P>

<P> </P>

<P> </P>

<P>164 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>for that VC inclusive of the buffer consumption of all packets received and accepted by the port for that VC before the event that caused the port entered the Input Error-stopped state. </P>

<P> </P>

<P>The VC-status control symbol for a VC operating in CT mode shall indicate the number of receive buffers available for that VC inclusive of the buffer consumption of all packets received and    accepted   by    the    port    for    that   VC    before    the link-request/input-status control symbol was received. </P>

<P> </P>

<P>The status and VC-status control symbols shall be transmitted before any packet acknowledgment control symbols are transmitted        for        packets        received        after        the link-request/input-status control symbol was received. </P>

<P> </P>

<P>An example state machine with the behavior described in this section is included in </P>

<P>Section C.3, &quot;Error Recovery&quot;. </P>

<P> </P>

<P>5.13.2.7  Output Error-Stopped Recovery Process </P>

<P> </P>

<P>To recover from the Output Error-stopped state, the output side of a port takes the following actions. </P>

<P> </P>

<P>&#8226; Immediately stops transmitting new packets. </P>

<P>&#8226; Resets the link packet acknowledgment timers for all transmitted but unacknowledged packets. (This prevents the generation of spurious timeout errors.) </P>

<P>&#8226; Transmits an input-status link-request/input-status (restart-from-error) control symbol. (The input status link-request/input-status control symbol causes the connected port to transmit a link-response control symbol that contains the input_status and ackID_status of the input side of the port. The ackID_status field contains the ackID value that is expected in the next packet that the connected port receives.) </P>

<P>&#8226; When the link-response is received, VCs operating in RT mode back up to the first unaccepted packet in each VC. VCs operating in CT mode silently assume the unacknowledged packets were accepted and adjust their state accordingly. </P>

<P>&#8226; The port exits the Output Error-stopped state and resumes transmission with the next RT or CT packet according to the bandwidth allocation algorithm using the ackID value contained in the link-response control symbol. </P>

<P> </P>

<P>An example state machine with the behavior described in this section is included in </P>

<P>Section C.3, &quot;Error Recovery&quot;. </P>

<P> </P>

<P> </P>

<P>5.14 Power Management </P>

<P> </P>

<P>Power management is currently beyond the scope of this specification and is implementation dependent. A device that supports power management features can </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>make these features accessible to the rest of the system using the device&#8217;s local configuration registers. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 6 LP-Serial Registers </P>

<P> </P>

<P> </P>

<P>6.1 Introduction </P>

<P> </P>

<P>This chapter describes the visible register set that allows an external processing element to determine the capabilities, configuration, and status of a processing element using this physical layer specification. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and bit definitions. </P>

<P> </P>

<P>There are four types of LP-Serial devices, an end point device, an end point device with additional software recovery registers, an end point free (or switch) device, and an end point free device with additional software recovery registers. Each has a different set of CSRs, specified in Section 6.5.1, Section 6.5.2, Section 6.5.3, and Section 6.5.4, respectively. All four device types have the same CARs, specified in Section 6.4. </P>

<P> </P>

<P>Devices supporting Virtual Channels contain an additional register block for configuring VC support for each port. That block is added on after the above register block using a separate EF_PTR, as described in Section 6.8. </P>

<P> </P>

<P> </P>

<P>6.2 Register Map </P>

<P> </P>

<P>These registers utilize the Extended Features blocks and can be accessed using RapidIO Part 1: Input/Output Logical Specification maintenance operations. Any register offsets not defined are considered reserved for this specification unless otherwise stated. Other registers required for a processing element are defined in other applicable RapidIO specifications and by the requirements of the specific device and are beyond the scope of this specification. Read and write accesses to reserved register offsets shall terminate normally and not cause an error condition in the target device. </P>

<P> </P>

<P>The Extended Features pointer (EF_PTR) defined in the RapidIO logical specifications contains the offset of the first Extended Features block in the Extended Features data structure for a device. The LP-Serial physical features block may exist in any position in the Extended Features data structure and may exist in any portion of the Extended Features Space in the register address map for the device. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Register bits defined as reserved are considered reserved for this specification only. Bits that are reserved in this specification may be defined in another RapidIO specification. </P>

<P> </P>

<P>Table 6-1. LP-Serial Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0-F </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10-13 </P>
</TD>

<TD>
<P>Processing Element Features CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x14-0xFF </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFF </P>
</TD>

<TD>
<P> </P>

<P>Extended Features Space </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFF </P>
</TD>

<TD>
<P> </P>

<P>Implementation-defined Space </P>
</TD>
</TR>
</Table>

<P> </P>

<P>6.3 Reserved Register, Bit and Bit Field Value Behavior </P>

<P> </P>

<P>Table 6-2 describes the required behavior for accesses to reserved register bits and reserved registers for the RapidIO register space, </P>

<P> </P>

<P>Table 6-2. Configuration Space Reserved Access Behavior </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0&#8211;3F </P>
</TD>

<TD>
<P>Capability Register Space (CAR Space - this space is read-only) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value1 </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined </P>

<P>function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x40&#8211;FF </P>
</TD>

<TD>
<P>Command and Status Register Space (CSR Space) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value2 </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined </P>

<P>function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 6-2. Configuration Space Reserved Access Behavior (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFF </P>
</TD>

<TD>
<P>Extended Features Space </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFF </P>
</TD>

<TD>
<P>Implementation-defined </P>

<P>Space </P>
</TD>

<TD>
<P>Reserved bit and register </P>
</TD>

<TD>
<P>All behavior implementation-defined </P>
</TD>
</TR>
</Table>

<P>1Do not depend on reserved bits being a particular value; use appropriate masks to extract defined bits from the read value. </P>

<P>2All register writes shall be in the form: read the register to obtain the values of all reserved bits, merge in the desired values for defined bits to be modified, and write the register, thus preserving the value of all reserved bits. </P>

<P> </P>

<P>When  a  writable  bit  field  is  set  to  a  reserved  value,  device  behavior  is implementation specific. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.4 Capability Registers (CARs) </P>

<P> </P>

<P>Every processing element shall contain a set of registers that allows an external processing element to determine its capabilities using the I/O logical maintenance read operation. All registers are 32 bits wide and are organized and accessed in </P>

<P>32-bit (4 byte) quantities, although some processing elements may optionally allow larger accesses. CARs are read-only. Refer to Table 6-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>CARs are big-endian with bit 0 the most significant bit. </P>

<P> </P>

<P> </P>

<P>6.4.1  Processing Element Features CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x10) </P>

<P> </P>

<P>The processing element features CAR identifies the major functionality provided by the processing element. The bit settings are shown in Table 6-3. </P>

<P> </P>

<P>Table 6-3. Bit Settings for Processing Element Features CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bits </P>
</TD>

<TD>
<P>Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;3 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Multiport </P>
</TD>

<TD>
<P>The bit shall be implemented by devices that support the LP-Serial IDLE2 sequence, but is optional for devices that do not support the LP-Serial IDLE2 sequence. If this bit is not implemented it is Reserved. </P>

<P> </P>

<P>If this bit is implemented, the Switch Port Information CAR at Configuration Space Offset 0x14 (see RapidIO Part 1: I/O Logical Specification) shall be implemented regardless of the state of bit 3 of the Processing Element Features CAR. </P>

<P> </P>

<P>Indicates whether the PE implements multiple external RapidIO ports </P>

<P>0b0 - PE does not implement multiple external RapidIO ports&#61472;&#61472;</P>

<P>0b1 - PE implements multiple external RapidIO ports </P>
</TD>
</TR>

<TR>
<TD>
<P>5&#8211;24 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>25 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>
</TR>

<TR>
<TD>
<P>26 </P>
</TD>

<TD>
<P>CRF Support </P>
</TD>

<TD>
<P>PE supports the Critical Request Flow (CRF) indicator </P>

<P>0b0 - Critical Request Flow is not supported&#61472;&#61472;</P>

<P>0b1 - Critical Request Flow is supported </P>
</TD>
</TR>

<TR>
<TD>
<P>27&#8211;31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.5 LP-Serial Extended Feature Blocks </P>

<P> </P>

<P>This section describes the LP-Serial Extended Features Blocks. There is a separate </P>

<P>Extended Features block for each of the following types of processing elements. </P>

<P> </P>

<P>Generic end point devices </P>

<P> </P>

<P>Generic end point devices, software assisted error recovery option </P>

<P> </P>

<P>Generic end point free devices </P>

<P> </P>

<P>Generic end point free devices, software assisted error recovery option </P>

<P> </P>

<P>All registers in the LP-Serial Extended Feature Blocks are 32 bits in length and aligned to 32 bit boundaries. The details of the registers used are specified in Section </P>

<P>6.6. </P>

<P> </P>

<P> </P>

<P>6.5.1  Generic End Point Devices </P>

<P> </P>

<P>This section specifies the LP-Serial registers comprising the LP-Serial Extended Features Block for a generic end point device. This Extended Features register block is assigned Extended Features block ID=0x0001. </P>

<P> </P>

<P>Table 6-4 shows the register map of the RapidIO LP-Serial Extended Features Block for generic end point devices. The register map specifies the registers that comprise this Extended Features Block. </P>

<P> </P>

<P>The Block Offset is the offset relative to the 16-bit Extended Features Pointer (EF_PTR) that points to the beginning of the block. The address of a byte in the block is calculated by adding the block byte offset to EF_PTR that points to the beginning of the block. This is denoted as [EF_PTR+xx] where xx is the block byte offset in hexadecimal. </P>

<P> </P>

<P>This register map is currently only defined for devices with up to 16 RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + </P>

<P>0xBC]. Register map offset [EF_PTR + 0xC0] can be used for another Extended </P>

<P>Features block. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 6-4. LP-Serial Register Map  - Generic End Point Devices </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>LP-Serial Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port Link Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24 </P>
</TD>

<TD>
<P>Port Response Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x28-38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Port General Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40-50 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x54 </P>
</TD>

<TD>
<P>Port 0 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Port 0 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x60-70 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x74 </P>
</TD>

<TD>
<P>Port 1 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Port 1 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x7C </P>
</TD>

<TD>
<P>Port 1 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x80&#8211;218 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x220-230 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x234 </P>
</TD>

<TD>
<P>Port 15 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x238 </P>
</TD>

<TD>
<P>Port 15 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x23C </P>
</TD>

<TD>
<P>Port 15 Control CSR </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The structure and use of the registers comprising the LP-Serial Generic End Point </P>

<P>Extended Features Block is specified in Section 6.6. </P>

<P> </P>

<P>The required behavior for accesses to reserved registers and register bits is specified in Table 6-2. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.5.2  Generic End Point Devices, software assisted error recovery option </P>

<P> </P>

<P>This section specifies the LP-Serial registers comprising the LP-Serial Extended Features Block for a generic end point device that supports software assisted error recovery. This is most useful for devices that for whatever reason do not want to implement error recovery in hardware and to allow software to generate link-request control symbols and see the results of the responses and for device debug. This Extended Features register block is assigned Extended Features block ID=0x0002. </P>

<P> </P>

<P>Table 6-5 shows the register map for generic RapidIO LP-Serial end point devices with software assisted error recovery. The register map specifies the registers that comprise this Extended Features Block. </P>

<P> </P>

<P>The Block Offset is the offset relative to the 16-bit Extended Features Pointer (EF_PTR) that points to the beginning of the block. The address of a byte in the block is calculated by adding the block byte offset to EF_PTR that points to the beginning of the block. This is denoted as [EF_PTR+xx] where xx is the block byte offset in hexadecimal. </P>

<P> </P>

<P>This register map is currently only defined for devices with up to 16 RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + </P>

<P>0xBC]. Register map offset [EF_PTR + 0xC0] can be used for another Extended </P>

<P>Features block. </P>

<P> </P>

<P>Table 6-5. LP-Serial Register Map - Generic End Point Devices (SW assisted) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>LP-Serial Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port Link Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24 </P>
</TD>

<TD>
<P>Port Response Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x28-38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Port General Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40 </P>
</TD>

<TD>
<P>Port 0 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x44 </P>
</TD>

<TD>
<P>Port 0 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x48 </P>
</TD>

<TD>
<P>Port 0 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4C-50 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x54 </P>
</TD>

<TD>
<P>Port 0 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Port 0 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 6-5. LP-Serial Register Map (Continued)- Generic End Point Devices (SW assisted) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x60 </P>
</TD>

<TD>
<P>Port 1 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x64 </P>
</TD>

<TD>
<P>Port 1 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x68 </P>
</TD>

<TD>
<P>Port 1 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x6C-70 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x74 </P>
</TD>

<TD>
<P>Port 1 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Port 1 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x7C </P>
</TD>

<TD>
<P>Port 1 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x80&#8211;218 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x220 </P>
</TD>

<TD>
<P>Port 15 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x224 </P>
</TD>

<TD>
<P>Port 15 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x228 </P>
</TD>

<TD>
<P>Port 15 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x22C-230 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x234 </P>
</TD>

<TD>
<P>Port 15 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x238 </P>
</TD>

<TD>
<P>Port 15 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x23C </P>
</TD>

<TD>
<P>Port 15 Control CSR </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The structure and use of the registers comprising the LP-Serial Generic End Point, software assisted error recovery option Extended Features Block is specified in Section 6.6. </P>

<P> </P>

<P>The required behavior for accesses to reserved registers and register bits is specified in Table 6-2. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.5.3  Generic End Point Free Devices </P>

<P> </P>

<P>This section specifies the LP-Serial registers comprising the LP-Serial Extended Features Block for a generic device that does not contain end point functionality (i.e. switches). This Extended Features register block uses extended features block ID=0x0003. </P>

<P> </P>

<P>Table 6-6 shows the register map for generic RapidIO LP-Serial end point-free devices. The register map specifies the registers that comprise this Extended Features Block. </P>

<P> </P>

<P>The Block Offset is the offset relative to the 16-bit Extended Features Pointer (EF_PTR) that points to the beginning of the block. The address of a byte in the block is calculated by adding the block byte offset to EF_PTR that points to the beginning of the block. This is denoted as [EF_PTR+xx] where xx is the block byte offset in hexadecimal. </P>

<P> </P>

<P>This register map is currently only defined for devices with up to 16 RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + </P>

<P>0xBC]. Register map offset [EF_PTR + 0xC0] can be used for another Extended </P>

<P>Features block. </P>

<P> </P>

<P>Table 6-6. LP-Serial Register Map - Generic End Point Free Devices </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>LP-Serial Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port Link Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24-38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Port General Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40-50 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x54 </P>
</TD>

<TD>
<P>Port 0 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Port 0 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x60-70 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x74 </P>
</TD>

<TD>
<P>Port 1 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Port 1 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x7C </P>
</TD>

<TD>
<P>Port 1 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 6-6. LP-Serial Register Map (Continued) - Generic End Point Free Devices </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x80&#8211;218 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x220-230 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x234 </P>
</TD>

<TD>
<P>Port 15 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x238 </P>
</TD>

<TD>
<P>Port 15 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x23C </P>
</TD>

<TD>
<P>Port 15 Control CSR </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The structure and use of the registers comprising the LP-Serial Generic End Point </P>

<P>Free Extended Features Block is specified in Section 6.6. </P>

<P> </P>

<P>The required behavior for accesses to reserved registers and register bits is specified in Table 6-2. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.5.4  Generic End Point Free Devices, software assisted error recovery option </P>

<P> </P>

<P>This section specifies the LP-Serial registers comprising the LP-Serial Extended Features Block for a generic device that does not contain end point functionality but that does support software assisted error recovery. Typically these devices are switches. This is most useful for devices that for whatever reason do not want to implement error recovery in hardware and to allow software to generate link-request control symbols and see the results of the responses and for device debug. This Extended Features register block is assigned Extended Features block ID=0x0009. </P>

<P> </P>

<P>Table 6-7 shows the register map for generic RapidIO LP-Serial end point-free devices with software assisted error recovery. The register map specifies the registers that comprise this Extended Features Block. </P>

<P> </P>

<P>The Block Offset is the offset relative to the 16-bit Extended Features Pointer (EF_PTR) that points to the beginning of the block. The address of a byte in the block is calculated by adding the block byte offset to EF_PTR that points to the beginning of the block. This is denoted as [EF_PTR+xx] where xx is the block byte offset in hexadecimal. </P>

<P> </P>

<P>This register map is currently only defined for devices with up to 16 RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + </P>

<P>0xBC]. Register map offset [EF_PTR + 0xC0] can be used for another Extended </P>

<P>Features block. </P>

<P> </P>

<P>Table 6-7. LP-Serial Register Map - Generic End Point-free Devices (SW assisted) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>LP-Serial Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port Link Timeout Control CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24-38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Port General Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40 </P>
</TD>

<TD>
<P>Port 0 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x44 </P>
</TD>

<TD>
<P>Port 0 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x48 </P>
</TD>

<TD>
<P>Port 0 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4C-50 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x54 </P>
</TD>

<TD>
<P>Port 0 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C </P>
</TD>

<TD>
<P>Port 0 Control CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 6-7. LP-Serial Register Map (Continued)- Generic End Point-free Devices (SW assisted) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x60 </P>
</TD>

<TD>
<P>Port 1 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x64 </P>
</TD>

<TD>
<P>Port 1 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x68 </P>
</TD>

<TD>
<P>Port 1 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x6C-70 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x74 </P>
</TD>

<TD>
<P>Port 1 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x78 </P>
</TD>

<TD>
<P>Port 1 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x7C </P>
</TD>

<TD>
<P>Port 1 Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x80&#8211;218 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x220 </P>
</TD>

<TD>
<P>Port 15 Link Maintenance Request CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x224 </P>
</TD>

<TD>
<P>Port 15 Link Maintenance Response CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x228 </P>
</TD>

<TD>
<P>Port 15 Local ackID Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x22C-230 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x234 </P>
</TD>

<TD>
<P>Port 15 Control 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x238 </P>
</TD>

<TD>
<P>Port 15 Error and Status CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x23C </P>
</TD>

<TD>
<P>Port 15 Control CSR </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The structure and use of the registers comprising the LP-Serial Generic End Point Free, software assisted error recovery option Extended Features Block is specified in Section 6.6. </P>

<P> </P>

<P>The required behavior for accesses to reserved registers and register bits is specified in Table 6-2. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6 LP-Serial Command and Status Registers (CSRs) </P>

<P> </P>

<P>All Command and Status registers are 32 bits in length and are aligned to 32 bit boundaries. All CSRs are accessed as 4 byte entities. CSRs are big endian with bit 0 the most significant bit. </P>

<P> </P>

<P>Refer to Table 6-2 for the required behavior for accesses to reserved register bits. </P>

<P> </P>

<P> </P>

<P>6.6.1 LP-Serial Register Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The LP-Serial register block header register contains the EF_PTR to the next extended features block and the EF_ID that identifies LP-Serial Extended Feature Block for which this is the register block header. </P>

<P> </P>

<P>Table 6-8. Bit Settings for LP-Serial Register Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired Extended Features Block ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.2  Port Link Timeout Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x20) </P>

<P> </P>

<P>The port link timeout control register contains the timeout timer value for all ports on a device. This timeout is for link events such as sending a packet to receiving the corresponding acknowledge and sending a link-request to receiving the corresponding link-response. The reset value is the maximum timeout interval, and represents between 3 and 6 seconds. </P>

<P> </P>

<P>Table 6-9. Bit Settings for Port Link Timeout Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;23 </P>
</TD>

<TD>
<P>timeout value </P>
</TD>

<TD>
<P>All 1s </P>
</TD>

<TD>
<P>timeout interval value </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.3  Port Response Timeout Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x24) </P>

<P> </P>

<P>The port response timeout control register contains the timeout timer count for all ports on a device. This timeout is for sending a request packet to receiving the corresponding response packet. The reset value is the maximum timeout interval, and represents between 3 and 6 seconds. </P>

<P> </P>

<P>Table 6-10. Bit Settings for Port Response Timeout Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;23 </P>
</TD>

<TD>
<P>timeout value </P>
</TD>

<TD>
<P>All 1s </P>
</TD>

<TD>
<P>timeout interval value </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.4  Port General Control CSR&#61472;&#61472;</P>

<P>(Block Offset 0x3C) </P>

<P> </P>

<P>The bits accessible through the Port General Control CSR are bits that apply to all ports in a device. There is a single copy of each such bit per device. These bits are also accessible through the Port General Control CSR of any other physical layers implemented on a device. </P>

<P> </P>

<P>The structure and bit definitions of the Port General Control CSR depend on whether or not the device contains an end point. The register bit definitions for a generic end point device with or without the software assisted error recovery option are specified in Table 6-11. </P>

<P> </P>

<P>Table 6-11. Bit Settings for Port General Control CSR, Generic End Point Devices </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Host </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>A Host device is a device that is responsible for system exploration, initialization, and maintenance. Agent or slave devices are initialized by Host devices. </P>

<P>0b0 - agent or slave device&#61472;&#61472;</P>

<P>0b1 - host device </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Master Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>The Master Enable bit controls whether or not a device is allowed to issue requests into the system. If the Master Enable is not set, the device may only respond to requests. </P>

<P>0b0 - processing element cannot issue requests&#61472;&#61472;</P>

<P>0b1 - processing element can issue requests </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Discovered </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>This device has been located by the processing element responsible for system configuration&#61472;&#61472;</P>

<P>0b0 - The device has not been previously discovered&#61472;&#61472;</P>

<P>0b1 - The device has been discovered by another processing element </P>
</TD>
</TR>

<TR>
<TD>
<P>3-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>1The Host reset value is implementation dependent </P>

<P>2The Master Enable reset value is implementation dependent </P>

<P>3The Discovered reset value is implementation dependent </P>

<P> </P>

<P>The register bit definitions for a generic end point free device with or without the software assisted error recovery option are specified in Table 6-12. </P>

<P> </P>

<P>Table 6-12. Bit Settings for General Port Control CSR, Generic End Point Free Device </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-1 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Discovered </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>This device has been located by the processing element responsible for system configuration&#61472;&#61472;</P>

<P>0b0 - The device has not been previously discovered&#61472;&#61472;</P>

<P>0b1 - The device has been discovered by another processing element </P>
</TD>
</TR>

<TR>
<TD>
<P>3-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>1The Discovered reset value is implementation dependent </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.5  Port n Link Maintenance Request CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x40, 60, ... , 220) </P>

<P> </P>

<P>The port link maintenance request registers are accessible both by a local processor and an external device. A write to one of these registers generates a link-request control symbol on the corresponding RapidIO port interface. </P>

<P> </P>

<P>Table 6-13. Bit Settings for Port n Link Maintenance Request CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;28 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>29-31 </P>
</TD>

<TD>
<P>Command </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Command to be sent in the link-request control symbol. If read, this field returns the last written value. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.6  Port n Link Maintenance Response CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x44, 64, ... , 224) </P>

<P> </P>

<P>The port link maintenance response registers are accessible both by a local processor and an external device. A read to this register returns the status received in a link-response control symbol. The ackID_status and port_status fields are defined in Table 3-3 and Table 3-6. This register is read-only. </P>

<P> </P>

<P>Table 6-14. Bit Settings for Port n Link Maintenance Response CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Name </P>
</TD>

<TD>
<P>Reset Value </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>response_valid </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>If the link-request causes a link-response, this bit indicates that the link-response has been received and the status fields are valid. </P>

<P>If the link-request does not cause a link-response, this bit indicates that the </P>

<P>link-request has been transmitted. This bit automatically clears on read. </P>
</TD>
</TR>

<TR>
<TD>
<P>1-20 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>21-26 </P>
</TD>

<TD>
<P>ackID_status </P>
</TD>

<TD>
<P>0b000000 </P>
</TD>

<TD>
<P>ackID status field from the link-response control symbol. Bit 21 is only valid for long control symbols. </P>
</TD>
</TR>

<TR>
<TD>
<P>27-31 </P>
</TD>

<TD>
<P>port_status </P>
</TD>

<TD>
<P>0b00000 </P>
</TD>

<TD>
<P>port status field from the link-response control symbol </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.7  Port n Local ackID CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x48, 68, ... , 228) </P>

<P> </P>

<P>The port link local ackID status registers are accessible both by a local processor and an external device. A read to this register returns the local ackID status for both the output and input sides of the ports. </P>

<P> </P>

<P>Table 6-15. Bit Settings for Port n Local ackID Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Clr_outstanding_ackIDs </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Writing 0b1 to this bit causes all outstanding unacknowledged packets to be discarded. This bit should only be written when trying to recover a failed link. This bit is always logic 0 when read. </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>2-7 </P>
</TD>

<TD>
<P>Inbound_ackID </P>
</TD>

<TD>
<P>0b000000 </P>
</TD>

<TD>
<P>Input port next expected ackID value. Bit 2 is only valid for long control symbols. </P>
</TD>
</TR>

<TR>
<TD>
<P>8-17 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>18-23 </P>
</TD>

<TD>
<P>Outstanding_ackID </P>
</TD>

<TD>
<P>0b000000 </P>
</TD>

<TD>
<P>Output port unacknowledged ackID status. Next expected acknowledge control symbol ackID field that indicates the ackID value expected in the next received acknowledge control symbol. Bit 18 is only valid for long control symbols. </P>
</TD>
</TR>

<TR>
<TD>
<P>24-25 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>26-31 </P>
</TD>

<TD>
<P>Outbound_ackID </P>
</TD>

<TD>
<P>0b000000 </P>
</TD>

<TD>
<P>Output port next transmitted ackID value. Software writing this value can force retransmission of outstanding unacknowledged packets in order to manually implement error recovery. Bit 26 is only valid for long control symbols. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.8  Port n Error and Status CSRs&#61472;&#61472;</P>

<P>(Block Offset 0x58, 78, ... , 238) </P>

<P> </P>

<P>These registers are accessed when a local processor or an external device wishes to examine the port error and status information. </P>

<P> </P>

<P>Table 6-16. Bit Settings for Port n Error and Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Idle Sequence 2 Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates whether the port supports idle sequence 2 for baudrates of less than 5.5 GBaud. </P>

<P>0b0 - idle sequence 2 not supported for baudrates &lt; 5.5 GBaud. </P>

<P>0b1 - idle sequence 2 supported for baudrates &lt; 5.5 GBaud. </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Idle Sequence 2 Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Controls whether idle sequence 2 is enabled for baudrates of less than 5.5 </P>

<P>GBaud. </P>

<P>0b0 - idle sequence 2 disabled for baudrates &lt; 5.5 GBaud. </P>

<P>0b1 - idle sequence 2 enabled for baudrates &lt; 5.5 GBaud. </P>

<P>The port shall not allow this bit to be set unless idle sequence 2 is supported and shall not allow this bit to be cleared if only idle sequence 2 is supported. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Idle Sequence </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates which idle is active. </P>

<P>0b0 - idle sequence 1 is active. </P>

<P>0b1 - idle sequence 2 is active. </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Flow Control Mode </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Indicates which flow control mode is active (read only). </P>

<P>0b0 - receiver-controlled flow control is active. </P>

<P>0b1 - transmitter-controlled flow control is active. </P>
</TD>
</TR>

<TR>
<TD>
<P>5-10 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Output </P>

<P>Retry-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered a retry condition.This bit is set when bit 13 is set. Once set, remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Output Retried </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and can not make forward progress. This bit is set when bit 13 is set and is cleared when a packet-accepted or a packet-not-accepted control symbol is received (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Output Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has received a packet-retry control symbol and is in the </P>

<P>&#8220;output retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Output </P>

<P>Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 15 is set. Once set, remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Output Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output is in the &#8220;output error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>16-20 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>21 </P>
</TD>

<TD>
<P>Input Retry-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input retry-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>22 </P>
</TD>

<TD>
<P>Input Error-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port has encountered (and possibly recovered from) a transmission error. This bit is set when bit 23 is set. Once set, remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>23 </P>
</TD>

<TD>
<P>Input Error-stopped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input port is in the &#8220;input error-stopped&#8221; state (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>24-26 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 6-16. Bit Settings for Port n Error and Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Port-write Pending </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Port has encountered a condition which required it to initiate a Maintenance Port-write operation This bit is only valid if the device is capable of issuing a maintenance port-write transaction. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Port Unavailable </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>Indicates  whether  or  not  the  port  is  available  (read  only). The  port&#8217;s resources may have been merged with another port to support wider links. </P>

<P>0b0 - The port is available for use. </P>

<P>0b1 - The port is not available for use. </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Port Error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Input or output port has encountered an error from which hardware was unable to recover. Once set, remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Port OK </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>The input and output ports are initialized and the port is exchanging error-free control symbols with the attached device (read-only). </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Uninitialized </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Input and output ports are not initialized. This bit and bit 30 are mutually exclusive (read-only). </P>
</TD>
</TR>
</Table>

<P>1The reset value is implementation dependent </P>

<P>2The reset value is 0b1 if feature is supported, otherwise 0b0 </P>

<P>3The Port Unavailable reset value is implementation dependent </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.9  Port n Control CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x5C, 7C, ... , 23C) </P>

<P> </P>

<P>The port n control registers contain control register bits for individual ports on a processing element. </P>

<P> </P>

<P>Table 6-17. Bit Settings for Port n Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-1 </P>
</TD>

<TD>
<P>Port Width Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates port width modes supported by the port (read-only). This field is used in conjunction with the Extended Port Width Support field of this register. The bits of these two fields collectively indicate the port width modes supported by the port in addition to 1x mode which is supported by all ports </P>

<P> </P>

<P>Bit 0: </P>

<P>0b0 - 2x mode not supported </P>

<P>0b1 - 2x mode supported </P>

<P> </P>

<P>Bit 1: </P>

<P>0b0 - 4x mode not supported </P>

<P>0b1 - 4x mode supported </P>
</TD>
</TR>

<TR>
<TD>
<P>2-4 </P>
</TD>

<TD>
<P>Initialized Port Width </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Width of the ports after initialized (read only): </P>

<P> </P>

<P>0b000 - Single-lane port </P>

<P>0b001 - Single-lane port, lane R </P>

<P>0b010 - Four-lane port </P>

<P>0b011 - Two-lane port </P>

<P>0b100 - Eight-lane port </P>

<P>0b101 - Sixteen-lane port </P>

<P>0b110 - 0b111 - Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>5 - 7 </P>
</TD>

<TD>
<P>Port Width Override </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Soft port configuration to control the width modes available for port initialization. The bits in this field are used and defined in conjunction with the bits of the Extended Port Width Override field (bits 16-17). </P>

<P> </P>

<P>When bit [5] = 0b0, bits 16-17 are Reserved </P>

<P> </P>

<P>When bit [5] = 0b1, </P>

<P>bit 6 controls the enabling of 4x mode, bit 7 controls the enabling of 2x mode, </P>

<P>bit 16 controls the enabling of 8x mode and bit 17 controls the enabling of 16x mode. </P>

<P> </P>

<P>Port n Control CSR bits [5-7,16-17] </P>

<P> </P>

<P>0b000xx - All lanes widths supported by the port are enabled </P>

<P>0b001xx - Reserved </P>

<P>0b010xx - Force 1x mode, lane R not forced </P>

<P>0b011xx - Force 1x mode, force lane R </P>

<P> </P>

<P>0b10000 - Implementation specific behavior </P>

<P>0b10001 - 16x mode enabled; 2x, 4x and 8x modes disabled </P>

<P>0b10010 - 8x mode enabled; 2x, 4x and 16x modes disabled </P>

<P>0b10011 - 8x and 16x modes enabled; 2x and 4x modes disabled </P>

<P> </P>

<P>0b10100 - 2x mode enabled; 4x, 8x and 16x modes disabled </P>

<P>0b10101 - 2x and 16x modes enabled; 4x and 8x modes disabled </P>

<P>0b10110 - 2x and 8x modes enabled; 4x and 16x modes disabled </P>

<P>0b10111 - 2x, 8x and 16x modes enabled; 4x mode disabled </P>

<P> </P>

<P>0b11000 - 4x mode enabled; 2x, 8x and 16x modes disabled </P>

<P>0b11001 - 4x and 16x modes enabled; 2x and 8x modes disabled </P>

<P>0b11010 - 4x and 8x modes enabled; 2x and 16x modes disabled </P>

<P>0b11011 - 4x, 8x and 16x modes enabled; 2x mode disabled </P>

<P> </P>

<P>0b11100 - 2x and 4x modes enabled; 8x and 16x modes disabled </P>

<P>0b11101- 2x, 4x and 16x modes enabled; 8x mode disabled </P>

<P>0b11110 - 2x, 4x and 8x modes enabled; 16x mode disabled </P>

<P>0b11111- 2x, 4x, 8x and 16 x modes enabled </P>

<P> </P>

<P>The port shall not allow the enabling of a link width mode that is not supported by the port. </P>

<P> </P>

<P>A change in the value of the Port Width Override or Extended Port Width Override field shall cause the port to re-initialize using the new field value(s). </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Port Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Port disable: </P>

<P>0b0 - port receivers/drivers are enabled&#61472;&#61472;</P>

<P>0b1 - port receivers/drivers are disabled and are unable to receive/transmit any packets or control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Output Port Enable </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>Output port transmit enable: </P>

<P>0b0 - port is stopped and not enabled to issue any packets except to route or respond to I/O logical MAINTENANCE packets. Control symbols are not affected and are sent normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to issue any packets </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>Input Port Enable </P>
</TD>

<TD>
<P>see footnote4 </P>
</TD>

<TD>
<P>Input port receive enable: </P>

<P>0b0 - port is stopped and only enabled to route or respond I/O logical MAINTENANCE packets. Other packets generate packet-not-accepted control symbols to force an error condition to be signaled by the sending device. Control symbols are not affected and are received and handled normally. This is the recommended state after device reset.&#61472;&#61472;</P>

<P>0b1 - port is enabled to respond to any packet </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Error Checking Disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit disables all RapidIO transmission error checking </P>

<P>0b0 - Error checking and recovery is enabled&#61472;&#61472;</P>

<P>0b1 - Error checking and recovery is disabled </P>

<P>Device behavior when error checking and recovery is disabled and an error condition occurs is undefined </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Multicast-event </P>

<P>Participant </P>
</TD>

<TD>
<P>see footnote5 </P>
</TD>

<TD>
<P>Send incoming Multicast-event control symbols to this port (multiple port devices only) </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Enumeration Boundary </P>
</TD>

<TD>
<P>see footnote6 </P>
</TD>

<TD>
<P>An enumeration boundary aware system enumeration algorithm shall honor this flag. The algorithm, on either the ingress or the egress port, shall not enumerate past a port with this bit set. This provides for software enforced enumeration domains within the RapidIO fabric. </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>16-17 </P>
</TD>

<TD>
<P>Extended Port Width </P>

<P>Override </P>
</TD>

<TD>
<P>0b00 </P>
</TD>

<TD>
<P>Extended soft port configuration to control the width modes available for port initialization. The bits in this field are used and defined in conjunction with the bits in the Port Width Override field. See the Description of the Port Width Override field for the specification of these bits. </P>
</TD>
</TR>

<TR>
<TD>
<P>18-19 </P>
</TD>

<TD>
<P>Extended Port Width </P>

<P>Support </P>
</TD>

<TD>
<P>see footnote7 </P>
</TD>

<TD>
<P>Indicates additional port width modes supported by the port (read-only). This field is used in conjunction with the Port Width Support field of this register. The bits of these two fields collectively indicate the port width modes supported by the port in addition to 1x mode which is supported by all ports </P>

<P> </P>

<P>Bit 18: </P>

<P>0b0 - 8x mode not supported </P>

<P>0b1 - 8x mode supported </P>

<P> </P>

<P>Bit 19: </P>

<P>0b0 - 16x mode not supported </P>

<P>0b1 - 16x mode supported </P>
</TD>
</TR>

<TR>
<TD>
<P>20-27 </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Implementation-defined </P>
</TD>
</TR>

<TR>
<TD>
<P>28-30 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port Type </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This indicates the port type (read only) </P>

<P>0b0 - Reserved&#61472;&#61472;</P>

<P>0b1 - Serial port </P>
</TD>
</TR>
</Table>

<P>1The Port Width reset value is implementation dependent </P>

<P>2The Initialized Port Width reset value is implementation dependent </P>

<P>3The Output Port Enable reset value is implementation dependent </P>

<P>4The Input Port Enable reset value is implementation dependent </P>

<P>5The Multicast-event Participant reset value is implementation dependent </P>

<P>6The Enumeration Boundary reset value is implementation dependent; provision shall be made to allow the reset value to be configurable if this feature is supported </P>

<P>7The Extended Port Width Support reset value is implementation dependent </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.6.10  Port n Control 2 CSRs&#61472;&#61472;</P>

<P>(Block Offset 0x54, 74, ... , 234) </P>

<P> </P>

<P>These registers are accessed when a local processor or an external device wishes to examine the port baudrate information. </P>

<P> </P>

<P>Table 6-18. Bit Settings for Port n Control 2 CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-3 </P>
</TD>

<TD>
<P>Selected Baudrate </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>Indicates the initialized baudrate of the port </P>

<P>0b0000 - no rate selected </P>

<P>0b0001 - 1.25 GBaud </P>

<P>0b0010 - 2.5 GBaud </P>

<P>0b0011 - 3.125 GBaud </P>

<P>0b0100 - 5.0 GBaud </P>

<P>0b0101 - 6.25 GBaud </P>

<P>0b0110 - 0b1111 - Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Baudrate Discovery </P>

<P>Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates whether automatic baudrate discovery is supported (read-only) </P>

<P>0b0 - Automatic baudrate discovery not supported </P>

<P>0b1 - Automatic baudrate discovery supported </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Baudrate Discovery </P>

<P>Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Controls whether automatic baudrate discovery is enabled </P>

<P>0b0 - Automatic baudrate discovery disabled </P>

<P>0b1 - Automatic baudrate discovery enable </P>

<P>The port shall not allow this bit to be set unless it supports baudrate discovery. </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>1.25 GBaud Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates whether port operation at 1.25 GBaud is supported (read only) </P>

<P>0b0 - 1.25 GBaud operation not supported </P>

<P>0b1 - 1.25 GBaud operation supported </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>1.25 GBaud Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Controls whether port operation at 1.25 GBaud is enabled </P>

<P>0b0 - 1.25 GBaud operation disabled </P>

<P>0b1 - 1.25 GBaud operation enabled </P>

<P>The port shall not allow this bit to be set unless it supports 1.25 GBaud. </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>2.5 GBaud Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates whether port operation at 2.5 GBaud is supported (read only) </P>

<P>0b0 - 2.5 GBaud operation not supported </P>

<P>0b1 - 2.5 GBaud operation supported </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>2.5 GBaud Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Controls whether port operation at 2.5 GBaud is enabled </P>

<P>0b0 - 2.5 GBaud operation disabled </P>

<P>0b1 - 2.5 GBaud operation enabled </P>

<P>The port shall not allow this bit to be set unless it supports 2.5 GBaud. </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>3.125 GBaud Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates whether port operation at 3.125 GBaud is supported (read only) </P>

<P>0b0 - 3.125 GBaud operation not supported </P>

<P>0b1 - 3.125 GBaud operation supported </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>3.125 GBaud Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Controls whether port operation at 3.125 GBaud is enabled </P>

<P>0b0 - 3.125 GBaud operation disabled </P>

<P>0b1 - 3.125 GBaud operation enabled </P>

<P>The port shall not allow this bit to be set unless it supports 3.125 GBaud. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>5.0 GBaud Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates whether port operation at 5.0 GBaud is supported (read only) </P>

<P>0b0 - 5.0 GBaud operation not supported </P>

<P>0b1 - 5.0 GBaud operation supported </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 6-18. Bit Settings for Port n Control 2 CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>5.0 GBaud Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Controls whether port operation at 5.0 GBaud is enabled </P>

<P>0b0 - 5.0 GBaud operation disabled </P>

<P>0b1 - 5.0 GBaud operation enabled </P>

<P>The port shall not allow this bit to be set unless it supports 5.0 GBaud. </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>6.25 GBaud Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Indicates whether port operation at 6.25 GBaud is supported (read only) </P>

<P>0b0 - 6.25 GBaud operation not supported </P>

<P>0b1 - 6.25 GBaud operation supported </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>6.25 GBaud Enable </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Controls whether port operation at 6.25 GBaud is enabled </P>

<P>0b0 - 6.25 GBaud operation disabled </P>

<P>0b1 - 6.25 GBaud operation enabled </P>

<P>The port shall not allow this bit to be set unless it supports 6.25 GBaud </P>
</TD>
</TR>

<TR>
<TD>
<P>16-27 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 6-18. Bit Settings for Port n Control 2 CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Enable Inactive Lanes </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>The implementation of this bit is optional. When implemented, this bit allows software to force the lanes of the port that are not currently being used to carry traffic, the &#8220;inactive lanes&#8221;, to be enabled for testing while the &#8220;active lanes&#8221; continue to carry traffic. If this bit is not implemented it is reserved. </P>

<P> </P>

<P>When a 1x/Nx or 1x/Mx/Nx port is operating in 1x mode where 1&lt;M&lt;N and N = 4, 8 or 16, lanes 0 and 2 are the active lanes and lane 1 and lanes 3 through N-1 are the inactive lanes. </P>

<P> </P>

<P>When a 1x/Mx/Nx port is operating in Mx mode where 1&lt;M&lt;N and N = 4, </P>

<P>8 or 16, lanes 0 through M-1 are the active lanes and lanes M through N-1 are the inactive lanes. </P>

<P> </P>

<P>The test mode enabled by the implementation of this bit only allows the testing of the inactive lanes that are supported by both of the connected ports. For example, if a 1x/4x/8x port is connected to a 1x/4x/16x port and the link is operating in 4x mode, only lanes 4 though 7 can be monitored using this test mode. </P>

<P> </P>

<P>Use of the test mode enabled by the implementation of this bit to monitor the behavior of the inactive lanes requires that this bit must be set in both ports and that all link width modes wider than the desired Mx mode must be disabled in the Port n Control CSR of both ports. Failure to meet these requirements will result in unspecified link behavior. (Modes wider than the desired Mx mode must be disabled so that the Initialization state machine ignores the asserted lane_sync signals from the lanes with forced output enables and does not attempt to enter a mode wider than Mx). </P>

<P> </P>

<P>If implemented, this bit shall not be asserted when the port is connected to a link that includes retimers as defined in Section 4.11.1, &quot;Retimers&quot;. </P>

<P> </P>

<P>0b0: The output enables of all of the lanes controlled by the port are controlled solely by the port&#8217;s Initialization state machine&#61472;&#61472;</P>

<P>0b1: The port&#8217;s receivers for the inactive lanes are enabled. The port&#8217;s drivers for the inactive lanes are output enabled if and only if the port&#8217;s Initialization state machine is not in the SILENT or SEEK state. A continuous IDLE sequence of the same type as is in use on the active lanes shall be transmitted on the inactive lanes when their transmitters are output enabled. The IDLE sequences transmitted on the inactive lanes shall comply with all rules for that type of IDLE sequence including alignment across the inactive lanes, but they are not required to use the same bit sequences or be aligned in any way relative to the IDLE sequences transmitted on the active lanes. If IDLE2 is being used on the active lanes of the port, the inactive lanes of the port shall report their lane number and port width in the CS Field Marker and handle commands carried in the CS Field as if they were active lanes. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 6-18. Bit Settings for Port n Control 2 CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Data scrambling disable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Read-write </P>

<P>0b0: transmit scrambler and receive descrambler are enabled. </P>

<P>0b1: The transmit scrambler and receive descrambler are disabled for control symbol and packet data characters. Control symbol and packet data characters are neither scrambled in the transmitter before transmission nor descrambled in the receiver upon reception. The transmit scrambler remains enabled for the generation of pseudo-random data characters for the IDLE2 random data field. </P>

<P>This bit is for test use only and shall not be asserted during normal operation. </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Remote Transmit Emphasis Control Support </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>Indicates whether the port is able to transmit commands to control the transmit emphasis in the connected port </P>

<P>0b0 - The port does not support transmit emphasis adjustment in the connected port </P>

<P>0b - The port supports transmit emphasis adjustment in the connected port </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Remote Transmit </P>

<P>Emphasis Control Enable </P>
</TD>

<TD>
<P>see footnote4 </P>
</TD>

<TD>
<P>Controls whether the port may adjust the transmit emphasis in the connected port </P>

<P>0b0 - Remote transmit emphasis control is disabled </P>

<P>0b1 - Remote transmit emphasis control is enabled </P>

<P>The port shall not let this bit be set unless remote transmit emphasis control is supported and the link to which the port is connect is using idle sequence 2 (IDLE2). </P>
</TD>
</TR>
</Table>

<P>1The reset value is implementation dependent </P>

<P>2The reset value is 0b1 if feature is supported, otherwise 0b0 </P>

<P>3The Remote Transmit Emphasis Control Support reset value is implementation dependent </P>

<P>4The Remote Transmit Emphasis Control Enable reset value is implementation dependent </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.7 LP-Serial Lane Extended Features Block </P>

<P> </P>

<P>This section specifies the LP-Serial Lane Extended Features Block. All registers in this block are 32 bits in length, aligned to a 32-bit (4-byte) boundary and accessed as 4 byte entities, although some processing elements may optionally allow larger accesses. This Extended Features register block is assigned Extended Features block ID=0x000D. </P>

<P> </P>

<P> </P>

<P>6.7.1  Register Map </P>

<P> </P>

<P>Table 6-19  shows  the  register  map  of  the  RapidIO  LP-Serial  Lane  Extended Features Block. The register map specifies the registers that comprise this Extended Features Block. </P>

<P> </P>

<P>The Block Offset is the offset relative to the 16-bit Extended Features Pointer (EF_PTR) that points to the beginning of the block. The address of a byte in the block is calculated by adding the block byte offset to EF_PTR that points to the beginning of the block. This is denoted as [EF_PTR+xx] where xx is the block byte offset in hexadecimal. </P>

<P> </P>

<P>This register map is currently only defined for devices with up to 32 LP-Serial lanes, but can be extended or shortened if more or less lane definitions are required for a device. For example, a device with four LP-Serial lanes is only required to use register map space corresponding to offsets [EF_PTR + 0x00] through [EF_PTR + </P>

<P>0x8C]. Register map offset [EF_PTR + 0x90] can be used for another Extended </P>

<P>Features block. </P>

<P> </P>

<P>Table 6-19. LP-Serial Lane Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>LP-Serial Lane Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4&#8211;C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>Lane 0 </P>
</TD>

<TD>
<P>0x10 </P>
</TD>

<TD>
<P>Lane 0 Status 0 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x14 </P>
</TD>

<TD>
<P>Lane 0 Status 1 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x18 </P>
</TD>

<TD>
<P>Lane 0 Status 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x1C </P>
</TD>

<TD>
<P>Lane 0 Status 3 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Lane 0 Status 4 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24 </P>
</TD>

<TD>
<P>Lane 0 Status 5 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x28 </P>
</TD>

<TD>
<P>Lane 0 Status 6 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x2C </P>
</TD>

<TD>
<P>Lane 0 Status 7 CSR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 6-19. LP-Serial Lane Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>Lane 1 </P>
</TD>

<TD>
<P>0x30 </P>
</TD>

<TD>
<P>Lane 1 Status 0 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x34 </P>
</TD>

<TD>
<P>Lane 1 Status 1 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x38 </P>
</TD>

<TD>
<P>Lane 1 Status 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Lane 1 Status 3 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x40 </P>
</TD>

<TD>
<P>Lane 1 Status 4 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x44 </P>
</TD>

<TD>
<P>Lane 1 Status 5 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x48 </P>
</TD>

<TD>
<P>Lane 1 Status 6 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4C </P>
</TD>

<TD>
<P>Lane 1 Status 7 CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-30 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0x50&#8211;3EC </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Registers for lanes 2-30 </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 31 </P>
</TD>

<TD>
<P>0x3F0 </P>
</TD>

<TD>
<P>Lane 31 Status 0 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3F4 </P>
</TD>

<TD>
<P>Lane 31 Status 1 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3F8 </P>
</TD>

<TD>
<P>Lane 31 Status 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x3FC </P>
</TD>

<TD>
<P>Lane 31 Status 3 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x400 </P>
</TD>

<TD>
<P>Lane 31 Status 4 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x404 </P>
</TD>

<TD>
<P>Lane 31 Status 5 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x408 </P>
</TD>

<TD>
<P>Lane 31 Status 6 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x40C </P>
</TD>

<TD>
<P>Lane 31 Status 7 CSR </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The structure and use of the registers comprising the LP-Serial Lane Extended </P>

<P>Features Block is specified in Section 6.7.2. </P>

<P> </P>

<P>The required behavior for accesses to reserved registers and register bits is specified in Table 6-2. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.7.2  LP-Serial Lane Command and Status Registers (CSRs) </P>

<P> </P>

<P>6.7.2.1  LP-Serial Register Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The LP-Serial register block header register contains the EF_PTR to the next extended features block and the EF_ID that identifies LP-Serial Lane Extended Feature Block for which this is the register block header. </P>

<P> </P>

<Textbox>
<P>L </P>
</Textbox>

<P>Table 6-20. Bit Settings for LP-Serial Register Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P>0x000D </P>
</TD>

<TD>
<P>Hard wired Extended Features Block ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.7.2.2  Lane n Status 0 CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x10, 30, ... , 3F0) </P>

<P> </P>

<P>This register shall always be implemented. It contains status information about the local lane transceiver, i.e. the lane n transceiver in the device implementing this register. Unless otherwise specified, all bits in this register are read-only (RO). </P>

<P> </P>

<P>Table 6-21. Bit Settings for Lane n Status 0 CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-7 </P>
</TD>

<TD>
<P>Port Number </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>The number of the port within the device to which the lane is assigned </P>
</TD>
</TR>

<TR>
<TD>
<P>8-11 </P>
</TD>

<TD>
<P>Lane Number </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>The number of the lane within the port to which the lane is assigned </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Transmitter type </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Transmitter type </P>

<P>0b0 - short run&#61472;&#61472;</P>

<P>0b1 - long run </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Transmitter mode </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Transmitter operating mode </P>

<P>0b0 - short run&#61472;&#61472;</P>

<P>0b1 - long run </P>
</TD>
</TR>

<TR>
<TD>
<P>14-15 </P>
</TD>

<TD>
<P>Receiver type </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Receiver type </P>

<P>0b00 - short run&#61472;&#61472;</P>

<P>0b01 - medium run&#61472;&#61472;</P>

<P>0b10 - long run&#61472;&#61472;</P>

<P>0b11 - Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>Receiver input inverted </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This bit indicates whether the lane receiver has detected that the polarity of its input signal is inverted and has inverted its receiver input to correct the polarity. </P>

<P>0b0 - receiver input not inverted&#61472;&#61472;</P>

<P>0b1 - receiver input inverted </P>
</TD>
</TR>

<TR>
<TD>
<P>17 </P>
</TD>

<TD>
<P>Receiver trained </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>When the lane receiver controls any transmit or receive adaptive equalization, this bit indicates whether or not all adaptive equalizers controlled by the lane receiver are trained. If the lane supports the IDLE2 sequence, the value of this bit shall be the same as the value in the &#8220;Receiver trained&#8221; bit in the CS Field transmitted by the lane. </P>

<P>0b0 - One or more adaptive equalizers are controlled by the lane receiver and at least one of those adaptive equalizers is not trained&#61472;&#61472;</P>

<P>0b1 - The lane receiver controls no adaptive equalizers or all of the adaptive equalizers controlled by the lane receiver are trained </P>
</TD>
</TR>

<TR>
<TD>
<P>18 </P>
</TD>

<TD>
<P>Receiver lane sync </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This bit indicates the state of the lane&#8217;s lane_sync signal. </P>

<P>0b0: lane_sync FALSE </P>

<P>0b1: lane_sync TRUE </P>
</TD>
</TR>

<TR>
<TD>
<P>19 </P>
</TD>

<TD>
<P>Receiver lane ready </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This bit indicates the state of the lane&#8217;s lane_ready signal </P>

<P>0b0 - lane_ready FALSE&#61472;&#61472;</P>

<P>0b1 - lane_ready TRUE </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>20-23 </P>
</TD>

<TD>
<P>8B/10B decoding errors </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>This field indicates the number of 8B/10B decoding errors that have been detected for this lane since this register was last read. The field is reset to </P>

<P>0x0 when the register is read. </P>

<P>0x0: No 8B/10B decoding errors have been detected since this register was last read.&#61472;&#61472;</P>

<P>0x1: One 8B/10B decoding error has been detected since this register was last read.&#61472;&#61472;</P>

<P>0x2: Two 8B/10B decoding errors have been detected since this register was last read.&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xD: Thirteen 8B/10B decoding errors have been detected since this register was last read.&#61472;&#61472;</P>

<P>0xE: Fourteen 8B/10B decoding errors have been detected since this register was last read.&#61472;&#61472;</P>

<P>0xF: At least fifteen 8B/10B decoding errors have been detected since this register was last read. </P>
</TD>
</TR>

<TR>
<TD>
<P>24 </P>
</TD>

<TD>
<P>Lane_sync state change </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Indicates whether the lane_sync signal for this lane has changed state since the bit was last read. This bit is reset to 0b0 when the register is read. This bit provides an indication of the burstiness of the transmission errors detected by the lane receiver. </P>

<P>0b0 - The state of lane_sync has not changed since this register was last read&#61472;&#61472;</P>

<P>0b1 - The state of lane_sync has changed since this register was last read </P>
</TD>
</TR>

<TR>
<TD>
<P>25 </P>
</TD>

<TD>
<P>Rcvr_trained state change </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Indicates whether the rcvr_trained signal for this lane has changed state since the bit was last read. This bit is reset to 0b0 when the register is read. A change in state of rcvr_trained indicates that the training state of the adaptive equalization under the control of this receiver has changed. Frequent changes of the training state suggest a problem with the lane. </P>

<P>0b0 - The state of rcvr_trained has not changed since this register was last read&#61472;&#61472;</P>

<P>0b1 - The state of rcvr_trained has changed since this register was last read </P>
</TD>
</TR>

<TR>
<TD>
<P>26-27 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Status 1 CSR </P>

<P>implemented </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This bit indicates whether or not the Status 1 CSR is implemented for this lane </P>

<P>0b0 - The Status 1 CSR is not implemented for this lane&#61472;&#61472;</P>

<P>0b1 - The Status 1 CSR is implemented for this lane </P>
</TD>
</TR>

<TR>
<TD>
<P>29-31 </P>
</TD>

<TD>
<P>Status 2-7 CSRs implemented </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>This field indicates the number of implementation specific Status 2-7 </P>

<P>CSRs that are implemented for this lane </P>

<P>0b000 - None of the Status 2-7 CSRs are implemented for this lane&#61472;&#61472;</P>

<P>0b001 - The Status 2 CSR is implemented for this lane&#61472;&#61472;</P>

<P>0b010 - The Status 2 and 3 CSRs are implemented for this lane&#61472;&#61472;</P>

<P>0b011 - The Status 2 through 4 CSRs are implemented for this lane&#61472;&#61472;</P>

<P>0b100 - The Status 2 through 5 CSRs are implemented for this lane&#61472;&#61472;</P>

<P>0b101 - The Status 2 through 6 CSRs are implemented for this lane&#61472;&#61472;</P>

<P>0b110 - The Status 2 through 7 CSRs are implemented for this lane&#61472;&#61472;</P>

<P>0b111 - Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.7.2.3  Lane n Status 1 CSRs&#61472;&#61472;</P>

<P>(Block Offsets 0x14, 34, ... , 3F4) </P>

<P> </P>

<P>This register shall be implemented if and only if the lane supports the IDLE2 sequence. The register contains information about the connected port that is collected from the CS markers and CS fields of the IDLE2 sequence received by the local lane n receiver. Only information from error free CS markers and CS fields shall be reported in this register. Unless otherwise specified, all bits in this register are read-only (RO). </P>

<P> </P>

<P>Table 6-22. Bit Settings for Lane n Status 1 CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>IDLE2 received </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit indicates whether an IDLE2 has been received by the lane since the bit was last reset. The bit is R/W. This bit can be reset by writing the bit with the value 0b1. Writing the bit with the value 0b0 does not change the value of the bit. </P>

<P>0b0 - No IDLE2 sequence has been received since the bit was last reset&#61472;&#61472;</P>

<P>0b1 - An IDLE2 sequence has been received at some time since the bit was last reset </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>IDLE2 information current </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit indicates whether the information in this register that is collected from the received IDLE2 sequence is current. When asserted, this bit indicates that the information is from the last IDLE2 CS Marker and CS Field that were received by the lane without detected errors, and that the lane&#8217;s lane_sync signal has remained asserted since the last CS Marker and CS Field were received. </P>

<P>0b0 - The IDLE2 information is not current&#61472;&#61472;</P>

<P>0b1 - The IDLE2 information is current </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Values changed </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>This bit indicates whether the values of any of the other 31 bits in this register have changed since the register was last read. This bit is reset when the register is read. </P>

<P>0b0 - The values have not changed&#61472;&#61472;</P>

<P>0b1 - One or more values have changed </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Implementation defined </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Implementation defined </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Connected port lane receiver trained </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Connected port lane receiver trained </P>

<P>0b0 - Receiver not trained&#61472;&#61472;</P>

<P>0b1 - Receiver trained </P>
</TD>
</TR>

<TR>
<TD>
<P>5-7 </P>
</TD>

<TD>
<P>Received port width </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Received port width </P>

<P>0b000 - 1 lane&#61472;&#61472;</P>

<P>0b001 - 2 lanes&#61472;&#61472;</P>

<P>0b010 - 4 lanes&#61472;&#61472;</P>

<P>0b011 - 8 lanes&#61472;&#61472;</P>

<P>0b100 - 16 lanes&#61472;&#61472;</P>

<P>0b101-0b111 - Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8-11 </P>
</TD>

<TD>
<P>Lane number in connected port </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>The number of the lane (0-15) within the connected port </P>

<P>0b0000 - Lane 0&#61472;&#61472;</P>

<P>0b0001 - Lane 1&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0b1111 - Lane 15 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>12-13 </P>
</TD>

<TD>
<P>Connected port transmit emphasis Tap(-1) status </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Tap(-1) status </P>

<P>0b00 - Tap(-1) not implemented&#61472;&#61472;</P>

<P>0b01 - Tap(-1) at minimum emphasis&#61472;&#61472;</P>

<P>0b10 - Tap(-1) at maximum emphasis&#61472;&#61472;</P>

<P>0b11 - Tap(-1) at intermediate emphasis setting </P>
</TD>
</TR>

<TR>
<TD>
<P>14-15 </P>
</TD>

<TD>
<P>Connected port transmit emphasis Tap(+1) status </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Tap(+1) status </P>

<P>0b00 - Tap(+1) not implemented&#61472;&#61472;</P>

<P>0b01 - Tap(+1) at minimum emphasis&#61472;&#61472;</P>

<P>0b10 - Tap(+1) at maximum emphasis&#61472;&#61472;</P>

<P>0b11 - Tap(+1) at intermediate emphasis setting </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>Connected port scrambling/descrambling enabled </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Connected port scrambling/descrambling </P>

<P>0b0 - Scrambling/descrambling not enabled&#61472;&#61472;</P>

<P>0b1 - Scrambling/descrambling enabled </P>
</TD>
</TR>

<TR>
<TD>
<P>17-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.7.2.4  Implementation Specific CSRs </P>

<P> </P>

<P>6.7.2.4.1  Lane n Status 2 CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x18, 38, ..., 3F8) </P>

<P> </P>

<P>6.7.2.4.2  Lane n Status 3 CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x1C, 3C, ..., 3FC) </P>

<P> </P>

<P>6.7.2.4.3  Lane n Status 4 CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x20, 40, ..., 400) </P>

<P> </P>

<P>6.7.2.4.4  Lane n Status 5 CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x24, 44, ..., 404) </P>

<P> </P>

<P>6.7.2.4.5  Lane n Status 6 CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x28, 48, ..., 408) </P>

<P> </P>

<P>6.7.2.4.6  Lane n Status 7 CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x2C, 4C, ..., 40C) </P>

<P> </P>

<P>The implementation of these registers is optional and when implemented their contents and format are implementation specific. The registers shall be implemented in increasing numerical order beginning with the Lane n Status 2 CSR. For example, if only one of the registers is implemented it shall be the Status 2 CSR. If three registers are implemented they shall be the Status 2 through 4 CSRs, and if five of the registers are implemented, they shall be the Status 2 through 6 CSRs. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.8 Virtual Channel Extended Features Block </P>

<P> </P>

<P>This section describes the registers for RapidIO LP-Serial devices supporting virtual channels. This Extended Features register block is assigned Extended Features block EF_ID=0x000A. </P>

<P> </P>

<P> </P>

<P>6.8.1  Register Map </P>

<P> </P>

<P>Table 6-23 shows the virtual channel register map for RapidIO LP-Serial devices. The Block Offset is the offset relative to the 16-bit Extended Features Pointer (EF_PTR) that points to the beginning of the block. </P>

<P> </P>

<P>The address of a byte in the block is calculated by adding the block byte offset to EF_PTR that points to the beginning of the block. This is denoted as [EF_PTR+xx] where xx is the block byte offset in hexadecimal. </P>

<P> </P>

<P>Table 6-23. Virtual Channel Registers </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>VC Register Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4-1C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x20 </P>
</TD>

<TD>
<P>Port 0 VC Control and Status Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x24 </P>
</TD>

<TD>
<P>Port 0 VC0 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x28 </P>
</TD>

<TD>
<P>Port 0 VC 5, VC 1 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x2C </P>
</TD>

<TD>
<P>Port 0 VC 7, VC 3 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x30 </P>
</TD>

<TD>
<P>Port 0 VC 6, VC 2 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x34 </P>
</TD>

<TD>
<P>Port 0 VC 8, VC 4 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x38-3C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x40 </P>
</TD>

<TD>
<P>Port 1 VC Control and Status Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x44 </P>
</TD>

<TD>
<P>Port 1 VC0 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x48 </P>
</TD>

<TD>
<P>Port 1 VC 5, VC 1 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4C </P>
</TD>

<TD>
<P>Port 1 VC 7, VC 3 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x50 </P>
</TD>

<TD>
<P>Port 1 VC 6, VC 2 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x54 </P>
</TD>

<TD>
<P>Port 1 VC 8, VC 4 BW Allocation Register </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58-5C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>Port n </P>
</TD>

<TD>
<P>[(0x20 * (n + 1)]&#61472;&#61472;</P>

<P>to&#61472;&#61472;</P>

<P>[0x20 * (n + 1) + </P>

<P>0x1C] </P>
</TD>

<TD>
<P>Additional Port Registers </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The registers are paired according to the VCs as they are implemented. In the second example, with VCs Supported 0x01, the upper portion (VC5 portion) of the register would be non-functioning. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>NOTE: </P>

<P>There are no provisions in this specification to provide for dynamic reconfiguration of the VCs. A vendor is not prohibited from implementing dynamic reconfiguration, it is just beyond the scope of this specification. Both ends of the channel need to be configured alike, or unexpected behavior may result, also beyond the scope of this specification. The default method is to configure VC operation when the channel is quiescent either by protocol, or by holding the master enable in the disabled state. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>6.8.2  Virtual Channel Control Block Registers </P>

<P> </P>

<P>This section contains register descriptions that define the bandwidth allocation configuration for the virtual channels. </P>

<P> </P>

<P>6.8.2.1  VC Register Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The LP-Serial VC register block header register contains the EF_PTR to the next extended features block and the EF_ID that identifies this as the Virtual Channel Extended Features Block. </P>

<P> </P>

<P>Table 6-24. Bit Settings for VC Register Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P>0x000A </P>
</TD>

<TD>
<P>Hard wired Extended Features Block ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.8.2.2  Port n VC Control and Status Registers&#61472;&#61472;</P>

<P>(Block Offset ((port number) + 1) * 0x20)) </P>

<P> </P>

<P>This register is used by each port to set up VC operation. </P>

<P> </P>

<P>Table 6-25. Port n VC Control and Status Registers </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 - 7 </P>
</TD>

<TD>
<P>VC Refresh Interval </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>The number of 1024 code group intervals over which the VC status must be refreshed. </P>

<P>Refresh Interval:&#61472;&#61472;</P>

<P>0x0 - 1K code groups, 0xF - 16K code groups, 0xFF - 256K code groups </P>

<P> </P>

<P>Implementers are required to support a maximum VC refreshing period of at least 1024 x 16 = 16K code groups in size. The maximum possible VC refreshing period that can be supported is 1024 x 256 = 256K code groups. Writing to this field with a value greater than the maximum supported value by the port will set the field to the maximum value supported by the port </P>
</TD>
</TR>

<TR>
<TD>
<P>8 - 15 </P>
</TD>

<TD>
<P>CT Mode </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Enables VCs to operate in CT mode beginning with VC8:&#61472;&#61472;</P>

<P>0x00 - all VCs in RT mode </P>

<P> </P>

<P>For 8 VCs: </P>

<P>0x01 - VC8 in CT mode&#61472;&#61472;</P>

<P>0x03 - VC8, VC7 in CT mode&#61472;&#61472;</P>

<P>0x07 - VC8, VC7, VC6, VC 5 in CT mode&#61472;&#61472;</P>

<P>0x0F - VC8 - VC1 in CT mode </P>

<P> </P>

<P>For 4 VCs: </P>

<P>0x01 - VC7 in CT mode&#61472;&#61472;</P>

<P>0x03 - VC7, VC5 in CT mode </P>

<P>0x07 - VC7, VC5, VC3, VC1 in CT mode </P>

<P> </P>

<P>For 2 VCs: </P>

<P>0x01 - VC5 in CT mode&#61472;&#61472;</P>

<P>0x03 - VC5, VC1 in CT mode </P>

<P> </P>

<P>For 1 VC: </P>

<P>0x01 - VC1 in CT mode </P>

<P> </P>

<P>Implementers may support CT mode on a portion of the available VCs. CT mode must be implemented in the highest VCs first to allow this simplified programming model. </P>

<P> </P>

<P>VCs not supporting CT operation are indicated by not allowing the programmed bits to set. Example: 8VCs enabled, VC8 and VC7 only support CT mode. Writing a 0x07 would result in a register value of 0x03 when read back. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 6-25. Port n VC Control and Status Registers </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>16 - 23 </P>
</TD>

<TD>
<P>VCs Support </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>Number of Virtual Channels Supported (Read Only) </P>

<P>0x00 - Only VC0 is supported&#61472;&#61472;</P>

<P>0x01 - VC0, VC1 Supported&#61472;&#61472;</P>

<P>0x02 - VC0, VC1, VC5 supported&#61472;&#61472;</P>

<P>0x04 - VC0, VC1, VC3, VC5, VC7 supported&#61472;&#61472;</P>

<P>0x08 - VC0, VC1-VC8 </P>
</TD>
</TR>

<TR>
<TD>
<P>24 - 31 </P>
</TD>

<TD>
<P>VCs Enable </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>0x00 - Enable Only VC0&#61472;&#61472;</P>

<P>0x01 - Enable VC0, VC1&#61472;&#61472;</P>

<P>0x02 - Enable VC0, VC1, VC5&#61472;&#61472;</P>

<P>0x04 - Enable VC0, VC1, VC3, VC5, VC7&#61472;&#61472;</P>

<P>0x08 - Enable VC0, VC1-VC8 </P>

<P>Note: Bits 24-27, and any bits associated with unimplemented VCs need not be writable, but must return 0 when read. Setting this field to a value larger than the number of VCs supported as indicated in bits 16-23. will result in only VC0 being enabled. </P>
</TD>
</TR>
</Table>

<P>1The VCs Supported reset value is implementation dependent </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.8.2.3  Port n VC0 BW Allocation Registers&#61472;&#61472;</P>

<P>(Block Offset (((port number) + 1) * 0x20) + 0x04)) </P>

<P> </P>

<P>This register is used to enable and configure VC0&#8217;s participation in the bandwidth reservation scheduling. </P>

<P> </P>

<P>Table 6-26. Port n VC0 BW Allocation CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>VC0 Bandwidth </P>

<P>Reservation Capable </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>0b0 - VC0 is strict priority, and has priority over the other VCs. It will utilize bandwidth without regard to bandwidth reservation. The bandwidth reservation algorithm will divide up what bandwidth is remaining after VC0 has no outstanding requests. </P>

<P>0b1 - VC0 is capable of being allocated bandwidth </P>

<P>This bit is read only </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>VC0 BW Res Enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0 - VC0 is strict priority, does not participate in bandwidth reservation&#61472;&#61472;</P>

<P>0b1 - VC0 will be allocated bandwidth according to BW Allocation </P>

<P>Registers </P>
</TD>
</TR>

<TR>
<TD>
<P>2 - 7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8 - 15 </P>
</TD>

<TD>
<P>Bandwidth Reservation </P>

<P>Precision </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>Indicates the number of bits used in the bandwidth reservation precision for all VCs in this port. (read only)&#61472;&#61472;</P>

<P>0x00 - 8 bits&#61472;&#61472;</P>

<P>0x01 - 9 bits&#61472;&#61472;</P>

<P>0x02 - 10 bits&#61472;&#61472;</P>

<P>0x04 - 11 bits&#61472;&#61472;</P>

<P>0x08 - 12 bits&#61472;&#61472;</P>

<P>0x10 - 13 bits&#61472;&#61472;</P>

<P>0x20 - 14 bits&#61472;&#61472;</P>

<P>0x40 - 15 bits&#61472;&#61472;</P>

<P>0x80 - 16 bits </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>Bandwidth Allocation </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>The contents of this register determines the minimum bandwidth reserved for this VC (see below) </P>

<P> </P>

<P>The bandwidth allocation value is left justified based on precision. Bits, are ignored based on the precision value: </P>

<P>0bnnnn_nnnn_xxxx_xxxx (8 bit precision) where &#8216;x&#8217; represents ignored bits </P>

<P>0bnnnn_nnnn_nxxx_xxxx (9 bit precision) </P>

<P>0bnnnn_nnnn_nnnn_xxxx (12 bit precision), etc. </P>
</TD>
</TR>
</Table>

<P>1  The VC0 Bandwidth Reservation Capable reset value is implementation dependent </P>

<P>2  The Bandwidth Reservation Precision reset value is implementation dependent </P>

<P> </P>

<P>VC0 may or may not participate in the bandwidth reservation scheduling for the link. The required implementation is for VC0 to be strict priority. Traffic on VC0 is serviced before any of the other VCs in this mode. The remaining bandwidth is then divided according to the percentages in the bandwidth allocations. This will result in the bandwidth allocations being variable if VC0&#8217;s utilization is significant when compared with the activity on the other VCs. </P>

<P> </P>

<P>Optionally, VC0 may be included in the bandwidth reservation scheduling. In this case, the priorities within VC0 are serviced when VC0 is allocated bandwidth on the </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>link. VC0 activity cannot cause the other VCs to receive less than their allocation of bandwidth. </P>

<P> </P>

<P>The Bandwidth Reservation Precision field is used to indicate the granularity of bandwidth scheduling for the port. The value in this register applies to the subsequent BW Allocation Registers as well. </P>

<P> </P>

<P>The value programmed in the BW Allocation Registers is a binary fraction based on the percentage of the overall total bandwidth. 100% bandwidth is represented by a value of 1.000: </P>

<P> </P>

<P>Table 6-27. BW Allocation Register Bit Values </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit / Value </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 -1 </P>
</TD>

<TD>
<P>2 -2 </P>
</TD>

<TD>
<P>2 -3 </P>
</TD>

<TD>
<P>2 -4 </P>
</TD>

<TD>
<P>2 -5 </P>
</TD>

<TD>
<P>2 -6 </P>
</TD>

<TD>
<P>2 -7 </P>
</TD>

<TD>
<P>2 -8 </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit / Value </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>9 </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P>11 </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>13 </P>
</TD>

<TD>
<P>14 </P>
</TD>

<TD>
<P>15 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 -9 </P>
</TD>

<TD>
<P>2 -10 </P>
</TD>

<TD>
<P>2 -11 </P>
</TD>

<TD>
<P>2 -12 </P>
</TD>

<TD>
<P>2 -13 </P>
</TD>

<TD>
<P>2 -14 </P>
</TD>

<TD>
<P>2 -15 </P>
</TD>

<TD>
<P>2 -16 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Example: 33% bandwidth is allocated as: </P>

<P> </P>

<P>33/100 = 0.0101010101010101b, so the BW allocation register value is:&#61472;&#61472;</P>

<P>0101010101010101b, and would be rounded down to:&#61472;&#61472;</P>

<P>01010101xxxxxxxxb if 8 bit precision is being used. </P>

<P> </P>

<P>The value may be programmed as is into the left justified register, with the unused bits being ignored, but that might cause some precision errors. Also, if the percentage results in a value smaller than the precision, a value of 0 could result in a VC getting no service. The precision value allows the bandwidth allocation algorithm to round up or down based on the dividing point, and to detect and round up a zero value to allocate at least a minimal increment of bandwidth. </P>

<P> </P>

<P>The total of all the allocations should not exceed 100%. The result, by definition, will not be as programmed. The actual behavior will depend on the method used to schedule the activity. The implementation of the scheduler, and thus its behavior when not programmed correctly is outside the scope of this specification. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.8.2.4  Port n VCx BW Allocation Registers&#61472;&#61472;</P>

<P>(Block Offset ((((port number) + 1) * 0x20) + &#61472;&#61472;</P>

<P>(offset based on VC #, see Table 6-23))) </P>

<P> </P>

<P>This register is used to enable and program VCs 1-8 participation in the bandwidth reservation scheduling. Each register supports 2 VCs, ordered as described in Section 6.8.1, &quot;Register Map&quot;. </P>

<P> </P>

<P>Table 6-28. Port n VCx BW Allocation CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 - 15 </P>
</TD>

<TD>
<P>Bandwidth Allocation </P>
</TD>

<TD>
<P>0x0000 </P>
</TD>

<TD>
<P>The contents of this register determines the minimum bandwidth reserved for this VC (see below) </P>

<P> </P>

<P>The bandwidth allocation value is left justified based on precision. Bits, are ignored based on the precision value: </P>

<P>0bnnnn_nnnn_xxxx_xxxx (8 bit precision) where &#8216;x&#8217; represents ignored bits </P>

<P>0bnnnn_nnnn_nxxx_xxxx (9 bit precision) </P>

<P>0bnnnn_nnnn_nnnn_xxxx (12 bit precision), etc. </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>Bandwidth Allocation </P>
</TD>

<TD>
<P>0x0000 </P>
</TD>

<TD>
<P>The contents of this register determines the minimum bandwidth reserved for this VC (see below) </P>

<P> </P>

<P>The bandwidth allocation value is left justified based on precision. Bits, are ignored based on the precision value: </P>

<P>0bnnnn_nnnn_xxxx_xxxx (8 bit precision) where &#8216;x&#8217; represents ignored bits </P>

<P>0bnnnn_nnnn_nxxx_xxxx (9 bit precision) </P>

<P>0bnnnn_nnnn_nnnn_xxxx (12 bit precision), etc. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>In the instance where VC1 is supported, but VC5 is not, bits 0 - 15 are reserved. The Bandwidth Allocation is as described previously for VC0. </P>

<P>A value of &#8216;0&#8217; for bandwidth allocation results in no service being given to that VC. VCs initialize with a value of zero and remain inactive until allocated bandwidth. It is recommended that the bandwidth allocations be made before enabling the VCs, but the actual implementation is beyond the scope of this specification. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 7 Signal Descriptions </P>

<P> </P>

<P> </P>

<P>7.1 Introduction </P>

<P> </P>

<P>This chapter contains the signal pin descriptions for a RapidIO LP-Serial port. The interface is defined either as a 1x, 2x, 4x, 8x, or 16x lane, full duplex, point-to-point interface using differential signaling. A lane implementation consists of Nx4 wires with two for the egress and two for the ingress direction. The electrical details are described in Chapter 8, &quot;Common Electrical Specifications&quot;. </P>

<P> </P>

<P> </P>

<P>7.2 Signal Definitions </P>

<P> </P>

<P>Table 7-1 provides a summary of the RapidIO LP-Serial signal pins as well as a short description of their functionality. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_981.jpg"/>
</Figure>

<P>Table 7-1. LP-Serial Signal Description </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_982.jpg"/>
</Figure>

<P> </P>

<Table>
<TR>
<TD>
<P>Signal Name </P>
</TD>

<TD>
<P>I/O </P>
</TD>

<TD>
<P>Signal Meaning </P>
</TD>

<TD>
<P>Timing Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>TD[0-(N-1)]1 </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Data - The transmit data is a unidirectional point to point bus designed to transmit the packet information. The TD bus of one device is connected to the RD bus of the receiving device. TD[0] is used in 1x mode. </P>
</TD>

<TD>
<P>Clocking is embedded in data using </P>

<P>8B/10B encoding. </P>
</TD>
</TR>

<TR>
<TD>
<P>TD[0-(N-1)]1 </P>
</TD>

<TD>
<P>O </P>
</TD>

<TD>
<P>Transmit Data complement&#8212;These signals are the differential pairs of the TD signals. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RD[0-(N-1)]1 </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Data - The receive data is a unidirectional point to point bus designed to receive the packet information. The RD bus of one device is connected to the TD bus of the receiving device. RD[0] is used in 1x mode. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RD[0-(N-1)]1 </P>
</TD>

<TD>
<P>I </P>
</TD>

<TD>
<P>Receive Data complement&#8212;These signals are the differential pairs of the RD signals. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. N has legal values of 1, 2, 4, 8, and 16 </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_983.jpg"/>
</Figure>

<P>7.3 Serial RapidIO Interface Diagrams </P>

<P> </P>

<P>Figure 7-1 shows the signal interface diagram connecting two 1x devices together with the RapidIO LP-Serial interconnect. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>1x DEVICE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_984.jpg"/>
</Figure>

<P>TD[0] TD[0] </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_985.jpg"/>
</Figure>

<P>RD[0] RD[0] </P>

<P>1x DEVICE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_986.jpg"/>
</Figure>

<P>RD[0] RD[0] </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_987.jpg"/>
</Figure>

<P>TD[0] TD[0] </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_988.jpg"/>
</Figure>

<P>Figure 7-1. RapidIO 1x Device to 1x Device Interface Diagram </P>

<P> </P>

<P>Figure 7-2 shows the signal interface diagram connecting two Nx devices together with the RapidIO LP-Serial interconnect. </P>

<P> </P>

<P> </P>

<P>Nx DEVICE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_989.jpg"/>
</Figure>

<P>TD[0-(N-1)] TD[0-(N-1)] </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_990.jpg"/>
</Figure>

<P>RD[0&#8211;(N-1)] RD[0&#8211;(N-1)] </P>

<P>Nx DEVICE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_991.jpg"/>
</Figure>

<P>RD[0-(N-1)] RD[0-(N-1)] </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_992.jpg"/>
</Figure>

<P>TD[0&#8211;(N-1)] TD[0&#8211;(N-1)] </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_993.jpg"/>
</Figure>

<P>Figure 7-2. RapidIO Nx Device to Nx Device Interface Diagram </P>

<P> </P>

<P>Figure 7-3 shows the connections between a Nx LP-Serial device and a 1x LP-Serial device. </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P>Nx DEVICE </P>

<P> </P>

<P>TD[0] TD[0] </P>

<P>TD[1-(N-1)] </P>

<P>TD[1-(N-1)] </P>

<P> </P>

<P>RD[0] RD[0] </P>

<P>RD[1-(N-1)] </P>

<P>RD[1-(N-1)] </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>
</Table>

<P> </P>
</Textbox>

<P>1x DEVICE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_994.jpg"/>
</Figure>

<P>RD[0] RD[0] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_995.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_996.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_997.jpg"/>
</Figure>

<P>TD[0] TD[0] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_998.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_999.jpg"/>
</Figure>

<P>Figure 7-3. RapidIO Nx Device to 1x Device Interface Diagram </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 8 Common Electrical Specifications </P>

<P> </P>

<P> </P>

<P>8.1 Introduction </P>

<P> </P>

<P>The chapter defines the common electrical specifications for the LP-Serial physical layer. Chapter 9, &quot;1.25Gbaud, 2.5Gbaud, and 3.125Gbaud LP-Serial Links&quot; defines Level I links compatible with the 1.3 version of the Physical Layer Specification, that supports baud rates of 1.25, 2.5, and 3.125Gbaud. Chapter 10, &quot;5Gbaud and </P>

<P>6.25Gbaud LP-Serial Links&quot; defines Level II links that support baud rates of </P>

<P>5Gbaud and 6.25Gbaud. A Level I link shall: </P>

<P>&#8226; allow 1.25Gbaud, 2.5Gbaud, or 3.125Gbaud baud rates </P>

<P>&#8226; supports AC coupling </P>

<P>&#8226; supports hot plug </P>

<P>&#8226; supports short run (SR) and long run (LR) links achieved with two transmitters </P>

<P>&#8226; support single receiver specification that will accept signals from both the short run and long run transmitter specifications </P>

<P> </P>

<P>&#8226; achieve Bit Error Ratio of lower than 10-12 per lane </P>

<P> </P>

<P>A Level II link shall: </P>

<P> </P>

<P>&#8226; allow 5 or 6.25 Gbaud baud rates </P>

<P>&#8226; supports AC coupling and optional DC coupling </P>

<P>&#8226; supports hot plug </P>

<P>&#8226; supports short run (SR), medium run (MR), and long run (LR) links achieved with two transmitters and two receivers </P>

<P> </P>

<P>&#8226; achieves Bit Error Ratio of lower than 10-15 per lane but test requirements will be verified to 10-12 per lane. </P>

<P> </P>

<P>Together, these specifications allow for solutions ranging from simple chip-to-chip interconnect to board-to-board interconnect driving two connectors across a backplane. The faster and wider electrical interfaces specified here are required to provide higher density and/or lower cost interfaces. </P>

<P> </P>

<P>The short run defines a transmitter and a receiver that should be used mainly for chip-to-chip connections on either the same printed circuit board or across a single connector. This  covers the  case  where connections are  made  to  a  mezzanine </P>

<P> </P>

<P>RapidIO Trade Association 213 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>(daughter) card. The smaller swings of the short run specification reduces the overall power used by the transceivers. </P>

<P> </P>

<P>The long run defines a transmitter and receiver that use larger voltage swings and channel equalization that allows a user to drive signals across two connectors and backplanes. </P>

<P> </P>

<P>The two transmitter specifications allows for a medium run specification that also uses larger voltage swings that are capable of driving signals across a backplane but simplifies the receiver requirements to minimize power and complexity. This option has been included to allow the system integrator to deploy links that take advantage of either channel materials and/or construction techniques that reduce channel loss to achieve lower power systems. </P>

<P> </P>

<P>It is also a goal of this specification to enable the inter-operability of Level I and </P>

<P>Level II links to allow newer devices to be used with existing legacy devices. </P>

<P> </P>

<P>All unit intervals are specified with a tolerance of ±100ppm. The worst case frequency difference between any transmit and receive clock is 200ppm. </P>

<P> </P>

<P>The electrical specifications are based on loss, jitter, and channel cross-talk budgets and defines the characteristics required to communicate between a transmitter and a receiver using nominally 100&#61527; differential copper signal traces on a printed circuit board. Rather than specifying materials, channel components, or configurations, this specification focuses on effective channel characteristics. Hence a short length of poorer material should be equivalent to a longer length of premium material. A </P>

<P>'length' is effectively defined in terms of its attenuation rather than physical distance. </P>

<P> </P>

<P>The RapidIO specification defines applicable data characteristics (e.g. DC balance, transition density, maximum run length), channel models and compliance points/parameters supporting the physical run and conditions. </P>

<P> </P>

<P>Finally it is assumed that the link designer has taken care to minimize reflections and crosstalk so that the link can be sufficiently equalized with the transmitter and receiver chosen. </P>

<P> </P>

<P> </P>

<P>8.2 References </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>1. </P>
</TD>

<TD>
<P>IEEE Standard 802.3ae-2002. &#8220;Standard for Information </P>

<P>technology-Telecommunications and information exchange between </P>

<P>systems-Local and metropolitan area networks-Special Requirements. Part 3: </P>

<P>Carrier Sense Multiple Access with Collision Detection (CSMA/CD) Access </P>

<P>Method and Physical Layer Specification. Amendment: Media Access Control </P>

<P>(MAC) Parameters, Physical Layers, and Management Parameters for 10 Gb/s </P>

<P>Operation&#8221;, IEEE Std. 802.3ae-2002, August 30, 2002. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>2. </P>
</TD>

<TD>
<P>Optical Internetworking Forum &#8220;Common Electrical I/O (CEI) - Electrical and Jitter Interoperability Agreements for 6G+ bps and 11G+ bps I/O&#8221;, IA # OIF-CEI-02.0, January 28, 2005. </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>214 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P>RapidIO Trade Association </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3. ITU-T Recommendation O.150 May 1996 and corrigendum May 2002. General requirements for instrumentation for performance measurements on digital transmission equipment. </P>

<P> </P>

<P>4. Low Voltage Differential Swing (LVDS), ANSI/TIA/EIA-644-A-2001 </P>

<P> </P>

<P>5. Optical Internetworking Forum, OIF 2002.507.01 - High Speed Backplane (HSB) Interface Electrical Specification for 5-6.375Gbps Baud Rates over Currently Existing Communications Backplanes. </P>

<P> </P>

<P> </P>

<P>8.3 Abbreviations </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table 8-1. Abbreviations </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Abbreviation </P>
</TD>

<TD>
<P>Meaning </P>
</TD>
</TR>

<TR>
<TD>
<P>BER </P>
</TD>

<TD>
<P>Bit Error Ratio </P>
</TD>
</TR>

<TR>
<TD>
<P>BERT </P>
</TD>

<TD>
<P>Bit Error Ratio Test or Tester </P>
</TD>
</TR>

<TR>
<TD>
<P>BUJ </P>
</TD>

<TD>
<P>Bounded Uncorrelated Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>CBGJ </P>
</TD>

<TD>
<P>Correlated Bounded Gaussian Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>CBHPJ </P>
</TD>

<TD>
<P>Correlated Bounded High Probability Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>CEI </P>
</TD>

<TD>
<P>Common Electrical I/O </P>
</TD>
</TR>

<TR>
<TD>
<P>CDF </P>
</TD>

<TD>
<P>Cumulative Distribution Function </P>
</TD>
</TR>

<TR>
<TD>
<P>CDR </P>
</TD>

<TD>
<P>Clock Data Recovery </P>
</TD>
</TR>

<TR>
<TD>
<P>CID </P>
</TD>

<TD>
<P>Consecutive Identical Digits </P>
</TD>
</TR>

<TR>
<TD>
<P>CML </P>
</TD>

<TD>
<P>Current Mode Logic </P>
</TD>
</TR>

<TR>
<TD>
<P>Cn </P>
</TD>

<TD>
<P>Cursor number </P>
</TD>
</TR>

<TR>
<TD>
<P>DCD </P>
</TD>

<TD>
<P>Duty Cycle Distortion </P>
</TD>
</TR>

<TR>
<TD>
<P>dB </P>
</TD>

<TD>
<P>Decibel </P>
</TD>
</TR>

<TR>
<TD>
<P>DDJ </P>
</TD>

<TD>
<P>Data Dependent Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>DFE </P>
</TD>

<TD>
<P>Decision Feedback Equalizer </P>
</TD>
</TR>

<TR>
<TD>
<P>DJ </P>
</TD>

<TD>
<P>Deterministic Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>DUT </P>
</TD>

<TD>
<P>Device Under Test </P>
</TD>
</TR>

<TR>
<TD>
<P>EMI </P>
</TD>

<TD>
<P>Electro-Magnetic Interference </P>
</TD>
</TR>

<TR>
<TD>
<P>erf </P>
</TD>

<TD>
<P>error function </P>
</TD>
</TR>

<TR>
<TD>
<P>erfinv </P>
</TD>

<TD>
<P>inverse error function </P>
</TD>
</TR>

<TR>
<TD>
<P>ESD </P>
</TD>

<TD>
<P>Electro-Static Discharge </P>
</TD>
</TR>

<TR>
<TD>
<P>FEXT </P>
</TD>

<TD>
<P>Far End Cross Talk </P>
</TD>
</TR>

<TR>
<TD>
<P>FFT </P>
</TD>

<TD>
<P>Fast Fourier Transform </P>
</TD>
</TR>

<TR>
<TD>
<P>FIR </P>
</TD>

<TD>
<P>Finite Impulse Response </P>
</TD>
</TR>

<TR>
<TD>
<P>FR-4 </P>
</TD>

<TD>
<P>Fire Retardant 4 Glass Reinforce Epoxy Laminate PCB material </P>
</TD>
</TR>

<TR>
<TD>
<P>Gbps </P>
</TD>

<TD>
<P>Giga bits per second </P>
</TD>
</TR>

<TR>
<TD>
<P>GJ </P>
</TD>

<TD>
<P>Gaussian Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>Gbaud </P>
</TD>

<TD>
<P>Giga symbols per second </P>
</TD>
</TR>
</Table>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1000.jpg"/>
</Figure>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 8-1. Abbreviations </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Abbreviation </P>
</TD>

<TD>
<P>Meaning </P>
</TD>
</TR>

<TR>
<TD>
<P>HF </P>
</TD>

<TD>
<P>High Frequency </P>
</TD>
</TR>

<TR>
<TD>
<P>HPF </P>
</TD>

<TD>
<P>High Pass Filter </P>
</TD>
</TR>

<TR>
<TD>
<P>HPJ </P>
</TD>

<TD>
<P>High Probability Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>IA </P>
</TD>

<TD>
<P>Implementation Agreement </P>
</TD>
</TR>

<TR>
<TD>
<P>ISI </P>
</TD>

<TD>
<P>Inter-Symbol Interference </P>
</TD>
</TR>

<TR>
<TD>
<P>LMS </P>
</TD>

<TD>
<P>Least Mean Square </P>
</TD>
</TR>

<TR>
<TD>
<P>LPF </P>
</TD>

<TD>
<P>Low Pass Filter </P>
</TD>
</TR>

<TR>
<TD>
<P>LVDS [4] </P>
</TD>

<TD>
<P>Low Voltage Differential Signal </P>
</TD>
</TR>

<TR>
<TD>
<P>LR </P>
</TD>

<TD>
<P>Long Run </P>
</TD>
</TR>

<TR>
<TD>
<P>mA </P>
</TD>

<TD>
<P>milli-Amp </P>
</TD>
</TR>

<TR>
<TD>
<P>MR </P>
</TD>

<TD>
<P>Medium Run </P>
</TD>
</TR>

<TR>
<TD>
<P>mV </P>
</TD>

<TD>
<P>milli-Volt </P>
</TD>
</TR>

<TR>
<TD>
<P>NEXT </P>
</TD>

<TD>
<P>Near End Cross Talk </P>
</TD>
</TR>

<TR>
<TD>
<P>NRZ </P>
</TD>

<TD>
<P>Non Return to Zero </P>
</TD>
</TR>

<TR>
<TD>
<P>PCB </P>
</TD>

<TD>
<P>Printed Circuit Board </P>
</TD>
</TR>

<TR>
<TD>
<P>PDF </P>
</TD>

<TD>
<P>Probability Distribution Function </P>
</TD>
</TR>

<TR>
<TD>
<P>PECL </P>
</TD>

<TD>
<P>Positive Emitter Coupled Logic </P>
</TD>
</TR>

<TR>
<TD>
<P>PJ </P>
</TD>

<TD>
<P>Periodic Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>pp </P>
</TD>

<TD>
<P>Peak to Peak </P>
</TD>
</TR>

<TR>
<TD>
<P>ppd </P>
</TD>

<TD>
<P>Peak to Peak Differential (as in 300mVppd) </P>
</TD>
</TR>

<TR>
<TD>
<P>PLL </P>
</TD>

<TD>
<P>Phase Locked Loop </P>
</TD>
</TR>

<TR>
<TD>
<P>ps </P>
</TD>

<TD>
<P>pico second </P>
</TD>
</TR>

<TR>
<TD>
<P>PRBS </P>
</TD>

<TD>
<P>Pseudo Random Bit Stream </P>
</TD>
</TR>

<TR>
<TD>
<P>Q </P>
</TD>

<TD>
<P>Inverse error function </P>
</TD>
</TR>

<TR>
<TD>
<P>RJ </P>
</TD>

<TD>
<P>Random Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>RV </P>
</TD>

<TD>
<P>Random Variable </P>
</TD>
</TR>

<TR>
<TD>
<P>RX </P>
</TD>

<TD>
<P>Receiver </P>
</TD>
</TR>

<TR>
<TD>
<P>R_Zvtt </P>
</TD>

<TD>
<P>Resistance of termination to Vtt </P>
</TD>
</TR>

<TR>
<TD>
<P>S11 and S22 </P>
</TD>

<TD>
<P>reflection coefficient </P>
</TD>
</TR>

<TR>
<TD>
<P>S21 </P>
</TD>

<TD>
<P>transmission coefficient </P>
</TD>
</TR>

<TR>
<TD>
<P>SCC11 and SCC22 </P>
</TD>

<TD>
<P>Common mode reflection coefficients </P>
</TD>
</TR>

<TR>
<TD>
<P>SCD11 and SCD22 </P>
</TD>

<TD>
<P>Differential to common mode conversion coefficient </P>
</TD>
</TR>

<TR>
<TD>
<P>SDD11 and SDD22 </P>
</TD>

<TD>
<P>Differential reflection coefficients </P>
</TD>
</TR>

<TR>
<TD>
<P>SDC11 and SDC22 </P>
</TD>

<TD>
<P>Common mode to differential conversion coefficient </P>
</TD>
</TR>

<TR>
<TD>
<P>SJ </P>
</TD>

<TD>
<P>Sinusoidal Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>SR </P>
</TD>

<TD>
<P>Short Run </P>
</TD>
</TR>

<TR>
<TD>
<P>sym/s </P>
</TD>

<TD>
<P>symbols/second </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 8-1. Abbreviations </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Abbreviation </P>
</TD>

<TD>
<P>Meaning </P>
</TD>
</TR>

<TR>
<TD>
<P>TJ </P>
</TD>

<TD>
<P>Total Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>TDM </P>
</TD>

<TD>
<P>Time Division Multiplexed data </P>
</TD>
</TR>

<TR>
<TD>
<P>TFI </P>
</TD>

<TD>
<P>TDM Fabric to Framer Interface </P>
</TD>
</TR>

<TR>
<TD>
<P>TX </P>
</TD>

<TD>
<P>Transmitter </P>
</TD>
</TR>

<TR>
<TD>
<P>UBHPJ </P>
</TD>

<TD>
<P>Uncorrelated Bounded High Probability Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>UI </P>
</TD>

<TD>
<P>Unit Interval = 1/(baud rate) </P>
</TD>
</TR>

<TR>
<TD>
<P>UUGJ </P>
</TD>

<TD>
<P>Uncorrelated Unbounded Gaussian Jitter </P>
</TD>
</TR>

<TR>
<TD>
<P>Vtt </P>
</TD>

<TD>
<P>Termination Voltage </P>
</TD>
</TR>

<TR>
<TD>
<P>XAUI </P>
</TD>

<TD>
<P>10 Gigabit Attachment Unit Interface </P>
</TD>
</TR>
</Table>

<P> </P>

<P>8.4 Definitions </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table 8-2. General Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit Error Ratio </P>
</TD>

<TD>
<P>A parameter that reflects the quality of the serial transmission and detection scheme. The Bit Error Ratio is calculated by counting the number of erroneous bits output by a receiver and dividing by the total number of transmitted bits over a specified transmission period. </P>
</TD>
</TR>

<TR>
<TD>
<P>Baud rate </P>
</TD>

<TD>
<P>Is a measure of the number of times per second a signal in a communications channel changes state. The state is usually voltage level, frequency, or phase angle. It is named after Émile Baudot, the inventor of the Baudot code for telegraphy. </P>
</TD>
</TR>

<TR>
<TD>
<P>Channel </P>
</TD>

<TD>
<P>In this specification Channel shall mean electrical differential channel. The channel is combination of electrical interconnects that together form the signal path from reference points T to R - see Figure 8-11. The channel will typically consist of PCB traces, via holes, component attachment pads and connectors. A characteristic of a signal channel is the complex characteristic impedance Z. </P>
</TD>
</TR>

<TR>
<TD>
<P>Common Mode Voltage </P>
</TD>

<TD>
<P>Average of the Vhigh and Vlow voltage levels - see Figure 8-1. </P>
</TD>
</TR>

<TR>
<TD>
<P>Confidence level </P>
</TD>

<TD>
<P>The use of this definition shall be understood as being with reference to a Gaussian distribution </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Termination </P>

<P>Resistance mismatch </P>
</TD>

<TD>
<P>The difference in the DC termination resistance with respect to ground of any two signals forming a differential pair. Usually due to large process spread the absolute termination resistance is specified relatively loose, e.g. 20% where the relative difference of resistors of the same device will be much less, e.g 5%. This parameter is used to specify the relative difference tighter than the overall resistance for the purpose of minimizing differential signal mode conversion </P>
</TD>
</TR>

<TR>
<TD>
<P>Gaussian </P>
</TD>

<TD>
<P>A statistical distribution (also termed &#8220;normal&#8221;) characterized by populations that are not bound in value and have well defined &#8220;tails&#8221;. The term &#8220;random&#8221; in this document always refers to a Gaussian distribution. </P>
</TD>
</TR>

<TR>
<TD>
<P>Golden PLL </P>
</TD>

<TD>
<P>Refers to a defined clock extraction unit which phase tracks the inherent clock present in a data signal. The phase tracking bandwidth is usually defined in terms of a corner frequency and if not defined with a corner frequency of baud/1667, a roll off of 20 dB/dec and &lt;0.1 dB peaking </P>
</TD>
</TR>

<TR>
<TD>
<P>Golden Channel </P>
</TD>

<TD>
<P>Refers to an electrical channel which is usually identified using a channel compliancy methodology and is used in the testing of transmitters and receivers </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 8-2. General Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>Intersymbol Interference </P>
</TD>

<TD>
<P>Data dependent deterministic jitter caused by the time differences required for the signal to arrive at the receiver threshold when starting from different places in bit sequences (symbols). For example when using media that attenuates the peak amplitude of the bit sequence consisting of alternating 0, 1, 0, 1... more than peak amplitude of the bit sequence consisting of 0, 0, 0, 0, 1, 1, 1, </P>

<P>1... the time required to reach the receiver threshold with the 0, 1, 0, 1... is less than required from the 0, 0, 0, 0, 1, 1, 1, 1... The run length of 4 produces a higher amplitude which takes more time to overcome when changing bit values and therefore produces a time difference compared to the run length of 1 bit sequence. When different run lengths are mixed in the same transmission the different bit sequences (symbols) therefore interfere with each other. Intersymbol Interference is expected whenever any bit sequence has frequency components that are propagated at different rates by the transmission media. </P>
</TD>
</TR>

<TR>
<TD>
<P>Lane </P>
</TD>

<TD>
<P>A single RapidIO Channel </P>
</TD>
</TR>

<TR>
<TD>
<P>Link </P>
</TD>

<TD>
<P>A functional connection between the Tx and Rx ports of 2 components, that can be multiple or parallel RapidIO Lanes defined as 1:N. The definition a Link does not imply duplex operation. </P>
</TD>
</TR>

<TR>
<TD>
<P>Non-transparent applications </P>
</TD>

<TD>
<P>Defines an application where the high frequency transmit jitter of a device is defined independently to the high frequency jitter present at any data input of the same device </P>
</TD>
</TR>

<TR>
<TD>
<P>Skew </P>
</TD>

<TD>
<P>The constant portion of the difference in the arrival time between the data of any two in-band signals. </P>
</TD>
</TR>

<TR>
<TD>
<P>Stressed Signal (or) Stressed </P>

<P>Eye </P>
</TD>

<TD>
<P>In order to test the tolerance of a receiver a stressed signal or eye is defined which when applied to the receiver must be received with the defined Bit Error Rate. The stressed signal or eye is defined in terms of its horizontal closure or jitter and amplitude normally in conjunction with an </P>

<P>eye-mask. </P>
</TD>
</TR>

<TR>
<TD>
<P>Transparent applications </P>
</TD>

<TD>
<P>Defines an application where the high frequency transmit jitter of a device is dependent on the high frequency jitter present at one or more of the data inputs of the same device </P>
</TD>
</TR>

<TR>
<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Unit of information conveyed by a single state transition in the medium </P>
</TD>
</TR>

<TR>
<TD>
<P>Symbol spaced </P>
</TD>

<TD>
<P>Describes a time difference equal to the nominal period of the data signal </P>
</TD>
</TR>

<TR>
<TD>
<P>Unit Interval </P>
</TD>

<TD>
<P>One nominal bit period for a given signaling speed. It is equivalent to the shortest nominal time between signal transitions. UI is the reciprocal of Symbol. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 8-3. Jitter and Wander Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>Correlated Bounded </P>

<P>Gaussian Jitter </P>
</TD>

<TD>
<P>Jitter distribution where the value of the jitter shows a correlation to the signal level being transmitted. The distribution is quantified, using a Gaussian approximation, as the gradient of the bathtub linearization at the Bit Error Rate of interest. R_RJ = R_GJ </P>
</TD>
</TR>

<TR>
<TD>
<P>Correlated Bounded High </P>

<P>Probability Jitter </P>
</TD>

<TD>
<P>Jitter distribution where the value of the jitter shows a strong correlation to the signal level being transmitted. This jitter may considered as being equalizable due to its correlation to the signal level. Was called Data Dependent Jitter in earlier specification revisions. </P>
</TD>
</TR>

<TR>
<TD>
<P>Correlated Wander </P>
</TD>

<TD>
<P>Components of wander that are common across all applicable in band signals. </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>The absolute value of the difference in the average width of a&#8217;1&#8217; symbol or a &#8217;0&#8217; symbol and the ideal periodic time in a clock-like repeating 0,1,0,1 sequence. Duty Cycle Distortion is part of the CBHPJ distribution and is measured at the time-averaged signal level. </P>
</TD>
</TR>

<TR>
<TD>
<P>Gaussian Jitter </P>
</TD>

<TD>
<P>An overall term that defines a jitter distribution that at the BER of interest e.g. 1e-15 still shows a Gaussian distribution. Unless otherwise specified Gaussian Jitter is the RMS sum of CBGJ and UUGJ. Was called Random Jitter in earlier specification revisions. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 8-3. Jitter and Wander Definitions </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>High Probability Jitter </P>
</TD>

<TD>
<P>Jitter distribution that at the BER of interest is approximated by a dual dirac. Unless otherwise specified High Probability Jitter is the sum of UBHPJ, CBHPJ, PJ, SJ, DCD. The distribution is quantified, using a dual dirac approximation, as the offset of the bathtub linearization at the Bit Error Rate of interest. Was called Deterministic Jitter in earlier specification revisions. </P>
</TD>
</TR>

<TR>
<TD>
<P>Jitter </P>
</TD>

<TD>
<P>Jitter is deviation from the ideal timing of an event at the mean amplitude of the signal population. Low frequency deviations are tracked by the clock recovery circuit, and do not directly affect the timing allocations within a bit interval. Jitter that is not tracked by the clock recovery circuit directly affects the timing allocations in a bit interval. Jitter is phase variations in a signal (clock or data) after filtering the phase with a single pole high pass filter with the -3 dB point at the jitter corner frequency. </P>
</TD>
</TR>

<TR>
<TD>
<P>Jitter Generation </P>
</TD>

<TD>
<P>Jitter generation is the process whereby jitter appears at the output port in the absence of applied input jitter at the input port. </P>
</TD>
</TR>

<TR>
<TD>
<P>Jitter RMS </P>
</TD>

<TD>
<P>The root mean square value or standard deviation of jitter. See clause 2 for more information. </P>
</TD>
</TR>

<TR>
<TD>
<P>Jitter Transfer </P>
</TD>

<TD>
<P>The ratio of the jitter output and jitter input for a component, device, or system often expressed in dB. A negative dB jitter transfer indicates the element removed jitter. A positive dB jitter transfer indicates the element added jitter. A zero dB jitter transfer indicates the element had no effect on jitter. The ratio should be applied separately to deterministic components and Gaussian (random) jitter components. </P>
</TD>
</TR>

<TR>
<TD>
<P>Peak-to-Peak Jitter </P>
</TD>

<TD>
<P>For any type of jitter, Peak to Peak Jitter is the full range of the jitter distribution that contributes within the specified BER. </P>
</TD>
</TR>

<TR>
<TD>
<P>Periodic Jitter </P>
</TD>

<TD>
<P>A sub form of HPJ that defines a jitter which has a single fundamental harmonic plus possible multiple even and odd harmonics. </P>
</TD>
</TR>

<TR>
<TD>
<P>Relative Wander </P>
</TD>

<TD>
<P>Components of wander that are uncorrelated between any two in band signals (See Figure 8-6) </P>
</TD>
</TR>

<TR>
<TD>
<P>Sigma </P>
</TD>

<TD>
<P>Refers to the standard deviation of a random variable modelled as a Gaussian Distribution. When used in reference to jitter, it refers to the standard deviation of the Gaussian Jitter component(s). When used in reference to confidence levels of a result refers to the probability that the result is correct given a Gaussian Mode, e.g. a measured result with 3 sigma confidence level would imply that 99.9% of the measurements are correct. </P>
</TD>
</TR>

<TR>
<TD>
<P>Sinusoidal Jitter </P>
</TD>

<TD>
<P>A sub form of HPJ that defines a jitter which has a single frequency harmonic. </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>Sum of all jitter components. </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Wander </P>
</TD>

<TD>
<P>The sum of the correlated and uncorrelated wander. (See Figure 8-7) </P>
</TD>
</TR>

<TR>
<TD>
<P>Unbounded Gaussian Jitter </P>
</TD>

<TD>
<P>Jitter distribution that shows a true Gaussian distribution where the observed peak to peak value has an expected value that grows as a function of the measurement time. This form of jitter is assumed to arise from phase noise random processes typically found in VCO structures or clock sources. It is usually quantified as either the Root Mean Square (RMS) or Sigma of the Gaussian distribution, or as the expected peak value for a given measurement population. (Formally defined as T_RJ) </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated Bounded High </P>

<P>Probability Jitter. </P>
</TD>

<TD>
<P>Jitter distribution where the value of the jitter show no correlation to any signal level being transmitted. Formally defined as T_DJ. </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated Wander </P>
</TD>

<TD>
<P>Components of wander that are not correlated across all applicable in band signals. </P>
</TD>
</TR>

<TR>
<TD>
<P>Wander </P>
</TD>

<TD>
<P>The peak to peak variation in the phase of a signal (clock or data) after filtering the phase with a single pole low pass filter with the -3db point at the wander corner frequency. Wander does not include skew. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>8.4.1  Definition of Amplitude and Swing </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1001.jpg"/>
</Figure>

<P>LP-Serial links use differential signaling. This section defines the terms used in the description and specification of these differential signals. Figure 8-1 shows how these signals are defined and sets out the relationship between absolute and differential voltage amplitude. The figure shows waveforms for either the transmitter output (TD and TD) or a receiver input (RD and RD). </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1002.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1003.jpg"/>
</Figure>

<P>VD+ </P>

<P>VHIGH </P>

<P>Max abs output </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>VCM </P>

<P>VDIFF(n)  VDIFF(n+1)  VDIFF(n+2)  VO </P>

<P> </P>

<P> </P>

<P> </P>

<P>GND VD- </P>

<P> </P>

<P> </P>

<P>VLOW </P>

<P>1 1 0 </P>

<P>UI  UI </P>

<P> </P>

<P> </P>

<P>Min abs output </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>VDIFF -PP(n)  VDIFF- PP(n+1)  VDIFF -PP(n+2) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1004.jpg"/>
</Figure>

<P>Figure 8-1. Definition of Transmitter Amplitude and Swing </P>

<P> </P>

<P>Each signal swings between the voltages VHIGH and VLOW where </P>

<P> </P>

<P>VHIGH &gt; VLOW </P>

<P> </P>

<P>The differential voltage, VDIFF , is defined as </P>

<P> </P>

<P>VDIFF = VD+ - VD- </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>where VD+ is the voltage on the positive conductor and VD- is the voltage on the negative conductor of a differential transmission line. VDIFF  represents either the differential output signal of the transmitter, VOD, or the differential input signal of the receiver, VID where </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1005.jpg"/>
</Figure>

<P>VOD = VTD - VTD </P>

<P> </P>

<P>and </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1006.jpg"/>
</Figure>

<P>VID = VRD - VRD </P>

<P> </P>

<P>The common mode voltage, VCM, is defined as the average or mean voltage present on the same differential pair. Therefore </P>

<P> </P>

<P>VCM = |VD+ + VD-|/2 </P>

<P> </P>

<P>The maximum value, or the peak-to-peak differential voltage, is calculated on a per unit interval and is defined as </P>

<P> </P>

<P>VDIFFp-p = 2 x max|VD+ - VD-| </P>

<P> </P>

<P>because the differential signal ranges from VD+ - VD- to -(VD+ - VD-) </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1007.jpg"/>
</Figure>

<P>To illustrate these definitions using real values, consider the case of a CML (Current Mode Logic) transmitter and each of its outputs, TD and TD, has a swing that goes between VHIGH = 2.5V and VLOW = 2.0V, inclusive. Using these values the common mode voltage is calculated to be 2.25 V and the single-ended peak voltage swing of the signals TD and TD is 500mVpp. The differential output signal ranges between </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1008.jpg"/>
</Figure>

<P>500mV and -500mV, inclusive. therefore the peak-to-peak differential voltage is </P>

<P>1000mVppd. </P>

<P> </P>

<P> </P>

<P>8.4.2  Transmitter (Near-End) Template </P>

<P> </P>

<P>For each baud rate at which the LP-Serial transmitter is specified to operate, the output eye pattern for transition symbols shall fall entirely within the unshaded portion  of  the  Transmitter  (near-end)  Output  Compliance  Mask  defined  in Figure 8-2. Specific parameter values are called out in the sections that follow. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1009.jpg"/>
</Figure>

<P>T _Y2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>T _Y1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Amplitude (mV) </P>
</Textbox>

<P>0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>-T _Y1 </P>

<P> </P>

<P> </P>

<P> </P>

<P>-T _Y2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>0.0 </P>

<P>T_X1  T _X2  1-T_X2  1-T _X1  1.0 </P>

<P> </P>

<P>Time (UI) </P>

<P> </P>

<P>Figure 8-2. Transition Symbol Transmit Eye Mask </P>

<P> </P>

<P>The output eye pattern of a LP-Serial transmitter that implements de-emphasis (to equalize the link and reduce intersymbol interference) need only comply with the Transition Transmitter Output Compliance Mask when there is a symbol transition from 1 to 0 or 1 to 0 or when pre-emphasis is disabled or minimized </P>

<P> </P>

<P>For 5Gbaud and 6.25Gbaud links the Transmitters eye mask will also be evaluated during the steady-state where there are no symbol transitions, e.g a 1 followed by a </P>

<P>1 or a 0 followed by a 0, and the signal has been de-emphasized. This additional transmitter eye mask constraint is shown in Figure 8-3. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1010.jpg"/>
</Figure>

<P>T _Y2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>T _Y1 </P>

<P> </P>

<Textbox>
<P>Amplitude (mV) </P>
</Textbox>

<P>T _Y3 </P>

<P> </P>

<P> </P>

<P>0  Keep Out </P>

<P>For De-emphasis </P>

<P> </P>

<P> </P>

<P>-T _Y3 </P>

<P> </P>

<P>-T _Y1 </P>

<P> </P>

<P> </P>

<P> </P>

<P>-T _Y2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>0.0 </P>

<P>T_X1  T _X2 </P>

<P>0.5 </P>

<P>1-T_X2  1-T _X1  1.0 </P>

<P> </P>

<P>Time (UI) </P>

<P> </P>

<P>Figure 8-3. Transition and Steady State Symbol Eye Mask </P>

<P> </P>

<P>During the steady-state the eye mask prevents the transmitter from de-emphasizing the  low  frequency  content  of  the  data  too  much  and  limiting  the  available signal-to-noise at the receiver. </P>

<P> </P>

<P>The de-emphasis introduces a jitter artifact that is not accounted for in this eye mask. This additional jitter is the result of the finite rise/fall time of the transmitter and the non-uniform voltage swing between the transitions. This additional deterministic jitter must be accounted for as part of the high probability jitter. </P>

<P> </P>

<P>Table 8-4 defines the standard parameters that will be specified for every transmitter. </P>

<P> </P>

<P>Table 8-4. Transmitter Output Jitter Specification </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>Uncorrelated Unbounded Gaussian Jitter must be defined with respect to specified BER of 10-12, Q=7.03 for 1.25Gbaud, </P>

<P>2.5Gbaud, and 3.125Gbaud links </P>

<P>Uncorrelated Unbounded Gaussian Jitter must be defined with respect to specified BER of 10-15, Q=7.94 for 5GBaud and </P>

<P>6.25Gbaud links </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 8-4. Transmitter Output Jitter Specification </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask (5Gbaud and 6.25Gbaud only) </P>
</TD>

<TD>
<P>T_Y3 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>Uncorrelated Unbounded Gaussian Jitter must be defined with respect to specified BER of 10-12, Q=7.03 for 1.25Gbaud, </P>

<P>2.5Gbaud, and 3.125Gbaud links </P>

<P>Uncorrelated Unbounded Gaussian Jitter must be defined with respect to specified BER of 10-15, Q=7.94 for 5GBaud and </P>

<P>6.25Gbaud links </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Note: In previous versions of the RapidIO LP-Serial specification different symbols names were used to define the time and voltage points on eye masks. Table 8-5 can be used as a cross reference for the transmitter eye mask symbol names. </P>

<P> </P>

<P>Table 8-5. Transmitter Eye Mask Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Current Version </P>
</TD>

<TD>
<P>1.3 Version </P>
</TD>
</TR>

<TR>
<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>VDIFF min </P>
</TD>
</TR>

<TR>
<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>VDIFF max </P>
</TD>
</TR>

<TR>
<TD>
<P>T_Y3 </P>
</TD>

<TD>
<P>N/A </P>
</TD>
</TR>

<TR>
<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>A </P>
</TD>
</TR>

<TR>
<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>B </P>
</TD>
</TR>
</Table>

<P> </P>

<P>8.4.3  Receiver (Far-End) Template </P>

<P> </P>

<P>The receiver (far-end) template has two definitions based on Level I and Level II </P>

<P>links. </P>

<P> </P>

<P>8.4.3.1  Level I Receiver Template </P>

<P> </P>

<P>Figure 8-4 illustrates the definition in a Level I receiver eye template. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1011.jpg"/>
</Figure>

<P>R_Y2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Amplitude (mV) </P>
</Textbox>

<P>R_Y1 </P>

<P> </P>

<P> </P>

<P>0 </P>

<P> </P>

<P> </P>

<P>-R_Y1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>-R_Y2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>0.0 </P>

<P>R_X1 </P>

<P>0.5 </P>

<P>1-R_X1  1.0 </P>

<P> </P>

<P>Time (UI) </P>

<P> </P>

<P> </P>

<P>Figure 8-4. Level I Receiver Input Mask </P>

<P> </P>

<P>Table 8-8 defines the standard parameters that will be specified for Level I receivers which have an open eye at the far-end. The termination conditions used to measure the received eye are defined Section 8.5.13. </P>

<P> </P>

<P>Table 8-6. Level I Receiver Jitter Specification </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>R_TJ </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_X1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_X2 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>Uncorrelated Unbounded Gaussian Jitter must be defined with respect to specified BER of 10-12, Q=7.03 for 1.25Gbaud, </P>

<P>2.5Gbaud, and 3.125Gbaud links </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Also in the previous versions of the RapidIO LP-Serial specification different symbols names were used to define the time and voltage points on eye masks. Table </P>

<P>8-8 can be used as a cross reference for the receiver eye mask. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 8-7. Receiver Eye Mask Cross Reference </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Current Version </P>
</TD>

<TD>
<P>1.3 Version </P>
</TD>
</TR>

<TR>
<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P>VDIFF min </P>
</TD>
</TR>

<TR>
<TD>
<P>R_Y2 </P>
</TD>

<TD>
<P>VDIFF max </P>
</TD>
</TR>

<TR>
<TD>
<P>R_X1 </P>
</TD>

<TD>
<P>A </P>
</TD>
</TR>

<TR>
<TD>
<P>R_X2 </P>
</TD>

<TD>
<P>B </P>
</TD>
</TR>
</Table>

<P> </P>

<P>8.4.3.2  Level II Receiver Template </P>

<P> </P>

<P>For a Level II link the receiver mask it is defined as is defined in Figure 8-5. Specific parameter values for both masks are called out in the sections that follow. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1012.jpg"/>
</Figure>

<P>R_Y2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Amplitude (mV) </P>
</Textbox>

<P>R_Y1 </P>

<P> </P>

<P> </P>

<P>0 </P>

<P> </P>

<P> </P>

<P>-R_Y1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>-R_Y2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>0.0 </P>

<P>R_X1 </P>

<P>0.5 </P>

<P>1-R_X1  1.0 </P>

<P> </P>

<P>Time (UI) </P>

<P> </P>

<P>Figure 8-5. Receiver Input Mask </P>

<P> </P>

<P>Table 8-8 defines the standard parameters that will be specified for receivers that have an open eye at the far-end. The termination conditions used to measure the received eye are defined Section 8.5.13. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 8-8. Level II Receiver Jitter Specification </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>R_TJ </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_X1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>Uncorrelated Unbounded Gaussian Jitter must be defined with respect to specified BER of 10-15, Q=7.94 for 5Gbaud and </P>

<P>6.25Gbaud links </P>
</TD>
</TR>
</Table>

<P> </P>

<P>8.4.4  Definition of Skew and Relative Wander </P>

<P> </P>

<P>See Figure 8-6 for an illustration of skew and relative wander. The definitions appear in Table 8-3. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1013.jpg"/>
</Figure>

<P>Relative Wander between lanes </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1014.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1015.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1016.jpg"/>
</Figure>

<P>X and Y </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1017.jpg"/>
</Figure>

<P>Peak to peak </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1018.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1019.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1020.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1021.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1022.jpg"/>
</Figure>

<P>Lane Y </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1023.jpg"/>
</Figure>

<P>The rising edges shown are logical coincident data with the transmitter </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1024.jpg"/>
</Figure>

<P>Skew and Relative Wander </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1025.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1026.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1027.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1028.jpg"/>
</Figure>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P>Lane X </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Skew between </P>

<P>Lanes X and Y </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P> </P>

<P>Figure 8-6. Skew and Relative Wander Between in Band Signals </P>

<P> </P>

<P> </P>

<P>See Figure 8-7 for an illustration of total wander in a signal. The definition appears in Table 8-3. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1029.jpg"/>
</Figure>

<P>Total Wander of a Data or clock signal Peak to peak </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1030.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1031.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1032.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1033.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1034.jpg"/>
</Figure>

<P>Lane Y </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1035.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1036.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1037.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1038.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1039.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1040.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1041.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1042.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1043.jpg"/>
</Figure>

<P>Edge of clean clock that is frequency locked to lane Y </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1044.jpg"/>
</Figure>

<P> </P>

<P>Total Wander </P>

<P> </P>

<P>Figure 8-7. Total Wander of a Signal </P>

<P> </P>

<P>8.4.5  Total Wander Mask </P>

<P> </P>

<P>Total wander specifications should be considered as accumulated low frequency jitter. As modern CDRs are digitally based they show a corner tracking frequency plus slew limitation which has been guaranteed, therefore for jitter tolerance testing the total wander needs to be spectrally defined to ensure correct operation. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1045.jpg"/>
</Figure>

<P>To this end, for jitter tolerance testing, the wander is considered a sinusoidal jitter source as shown in Figure 8-8 below. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1046.jpg"/>
</Figure>

<P>Total W ander Amplitude </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1047.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>SJ </P>
</Textbox>

<P>20dB/dec </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1048.jpg"/>
</Figure>

<P>High Frequency Amplitude </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1049.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1050.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1051.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1052.jpg"/>
</Figure>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1053.jpg"/>
</Figure>

<P>baud/1 667 </P>

<P>20MHz </P>

<P> </P>

<P> </P>

<P>Figure 8-8. Total Wander Mask </P>

<P> </P>

<P>At higher frequency this jitter source is used to ensure margin in the high frequency jitter tolerance of the receiver. At lower frequencies the higher SJ should then be tracked by the CDR. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>8.4.6  Relative Wander Mask </P>

<P> </P>

<P>Specifically for interfaces defining relative wander, Figure 8-9 is also defined in terms of a sinusoidal jitter sources as shown below. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1054.jpg"/>
</Figure>

<P>Relative W ander </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1055.jpg"/>
</Figure>

<P>Amplitude </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1056.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>SJ </P>
</Textbox>

<P>20dB/dec </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1057.jpg"/>
</Figure>

<P>High Frequency Amplitude </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1058.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1059.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1060.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1061.jpg"/>
</Figure>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1062.jpg"/>
</Figure>

<P>baud/1 667 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1063.jpg"/>
</Figure>

<P>20MHz </P>

<P> </P>

<P>Figure 8-9. Relative Wander Mask </P>

<P> </P>

<P>8.4.7  Random Jitter Mask </P>

<P> </P>

<P>To ensure that the random jitter modulation of stressed signals is above the CDR bandwidth and therefore untracked, the filter mask shown in Figure 8-10 shall be applied where necessary. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1064.jpg"/>
</Figure>

<P>0dB </P>

<P> </P>

<P> </P>

<Textbox>
<P>Power(dB) </P>
</Textbox>

<P>20dB/dec </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1065.jpg"/>
</Figure>

<P>10MHz </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1066.jpg"/>
</Figure>

<P>f baud /2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1067.jpg"/>
</Figure>

<P>Figure 8-10. Random Jitter Spectrum </P>

<P> </P>

<P>8.4.8  Defined Test Patterns </P>

<P> </P>

<P>The data test patterns are unique to the two levels of link and will be defined in the sections specific to these. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>8.4.9  Reference Model </P>

<P> </P>

<P>The LP-Serial electrical reference model is defined in Figure 8-11. Note that the RX and TX blocks include all off-chip components associated with the respective function. Thus the reference points T and R are defined to be the component edge of the transmitter and receiver respectively. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Component </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1068.jpg"/>
</Figure>

<P>Edge </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1069.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>TX TE </P>

<P> </P>

<P> </P>

<P> </P>

<P>Egress </P>

<P> </P>

<P> </P>

<P>Channel </P>

<P>Component </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1070.jpg"/>
</Figure>

<P>Edge </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RE RX </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RX  RI </P>

<P>Ingress </P>

<P> </P>

<P> </P>

<P>Channel </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>TI TX </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1071.jpg"/>
</Figure>

<P>Figure 8-11. Reference Model </P>

<P> </P>

<P>Note: Through out this specification the terms &#8216;near&#8217; and &#8216;far&#8217; are used to describe aspects of the channel. Near-end will always be used to refer to the end of the channel attached to the transmitter, e.g. TE or TI, independent of if it is the egress or ingress channel. Far-end will be used to refer to the end of the channel attached to the receiver, e.g. RI or RE. </P>

<P> </P>

<P> </P>

<P>8.5 Common Electrical Specification </P>

<P> </P>

<P> </P>

<P>8.5.1  Introduction </P>

<P> </P>

<P>This section specifies electrical parameters and attributes common to all links. In the event of a difference between an individual link and these general requirements, the respective individual link shall prevail. </P>

<P> </P>

<P>The LP-Serial 1.25Gbaud, 2.5Gbaud, and 3.125Gbaud Electrical specifications are guided  by  the  XAUI  electrical  interface  specified  in  Clause  47  of  IEEE </P>

<P>802.3ae-2002.[1] </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The LP-Serial 5Gbaud and 6.25Gbaud Electrical specifications are based upon the Optical Internetworking Forum's Common Electrical Interface [2], referred to henceforth as CEI. </P>

<P> </P>

<P>CEI includes the following sections that are the basis for the LP-Serial RapidIO </P>

<P>5Gbaud and 6.25Gbaud interfaces: </P>

<P> </P>

<P>&#8226; CEI-6G-SR clause 6 specification for data lane(s) that support bit rates from </P>

<P>4.976 to 6.375Gbaud over Printed Circuit Boards with physical runs from 0 to 20cm and up to 1 connector. CEI-6G-SR forms the basis for the LP-Serial </P>

<P>5Gbaud and 6.25Gbaud Short Run Interface electrical specifications. RapidIO has enhanced this electrical specification to include a continuous-time equalizer with one zero and one pole. </P>

<P>&#8226; CEI-6G-LR Clause 7 specification for data lane(s) that support bit rates from </P>

<P>4.976 to 6.375Gbaud over Printed Circuit Boards with physical runs from 0 to 100cm and up to 2 connectors. CEI-6G-LR forms the basis for the </P>

<P>LP-Serial 5Gbaud and 6.25Gbaud Long Run Interface electrical specifications. </P>

<P>&#8226; RapidIO has added a specification for data lane(s) that supports bit rates from </P>

<P>5 to 6.25Gbaud over Printed Circuit Boards and physical runs from 0 to 60cm and up 2 connectors. The CEI-6G-LR transmitter and a continuous-time receiver with one zero and one pole form the basis for the LP-Serial 5Gbaud and 6.25Gbaud Medium Run Interface electrical specifications. </P>

<P>Note: The OIF CEI documentation uses the term &#8220;reach&#8221; to describe the length of the channel. Here &#8220;run&#8221; is used to maintain consistency with the RapidIO 1.3 interconnect specification. </P>

<P> </P>

<P>While  the  OIF  CEI  documentation defines  support  for  4.976  to </P>

<P>6.375Gbaud RapidIO only supports 5.0 and 6.25 Gbaud data rates </P>

<P> </P>

<P> </P>

<P>8.5.2  Data Patterns </P>

<P> </P>

<P>There is a requirement that the link data follow 8B/10B encoding rules and when specified raw data scrambling requirements as defined in Chapter 4, &quot;PCS and PMA Layers&quot;, to ensure proper operation. The predicted BER performance and jitter requirements are only valid when this assumption is satisfied. If all of these conditions are not met, then the link may not work to the full distance, or meet the BER, or in fact work at all. </P>

<P> </P>

<P> </P>

<P>8.5.3  Signal Levels </P>

<P> </P>

<P>The signal is a low swing differential interface. This implies that the receiver has a wide common mode range (within the maximum absolute input voltages). All devices must support load type 0 defined in Table 8-9. Level II SR devices can optionally support any or all of the other 3 load types while Level II MR and LR devices can optionally support load type 1. </P>

<P> </P>

<P>RapidIO Trade Association 231 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<Textbox>
<P>. </P>
</Textbox>

<P>Table 8-9. Definition of Load Types </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Load Type 0 </P>
</TD>

<TD>
<P>Load Type 1 </P>
</TD>

<TD>
<P>Load Type 2 </P>
</TD>

<TD>
<P>Load Type 3 </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>R_Zvtt </P>
</TD>

<TD>
<P>&gt;1k </P>
</TD>

<TD>
<P>&lt;30 </P>
</TD>

<TD>
<P>&lt;30 </P>
</TD>

<TD>
<P>&lt;30 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>Nominal Vtt </P>
</TD>

<TD>
<P>undefined </P>
</TD>

<TD>
<P>1.2 </P>
</TD>

<TD>
<P>1.0 </P>
</TD>

<TD>
<P>0.8 </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>
</Table>

<P> </P>

<P>This type of differential interface allows for inter-operability between components operating from different supply voltages and different I/O types (CML, LVDS-like, PECL, etc.). Low swing differential signaling provides noise immunity and improved electromagnetic interference (EMI). Differential signal swings are defined in following sections and depend on several factors such as transmitter pre-equalization, receiver equalization, and transmission line losses. </P>

<P> </P>

<P> </P>

<P>8.5.4  Bit Error Ratio </P>

<P> </P>

<P>8.5.4.1  Level I Bit Error Ratio </P>

<P> </P>

<P>The LP-Serial 1.25Gbaud, 2.5Gbaud, and 3.125Gbaud interface lanes will operate with a Bit Error Ratio (BER) of 10-12. </P>

<P> </P>

<P>It should be noted that most modern system are capable of achieving the improved </P>

<P>BER required in Level II links. </P>

<P> </P>

<P>8.5.4.2  Level II Bit Error Ratio </P>

<P> </P>

<P>The LP-Serial 5Gbaud and 6.25Gbaud interface lanes will operate with a Bit Error Ratio (BER) of 10-15 (with a test requirement to verify 10-12). See Clause 2 of CEI for more information on the jitter model and how to measure BER. </P>

<P> </P>

<P> </P>

<P>8.5.5  Ground Differences </P>

<P> </P>

<P>The maximum ground difference between the transmitter and the receiver shall be </P>

<P>&#61617;50mV for SR links and &#61617;100mV for MR and LR links. This will affect the absolute maximum voltages at compliance point 'R'. If transmitter and receiver are on the same PCB with no intervening connectors, then the ground difference is approximately 0mV. </P>

<P> </P>

<P> </P>

<P>8.5.6  Cross Talk </P>

<P> </P>

<P>Cross talk arises from coupling within the connectors, on the PCB, the package and the die. Cross talk can be categorized as either Near-End or Far-End cross talk (NEXT and FEXT). In either of these categories, the amount of cross talk is dependent upon signal amplitudes, signal spectrum, and trace/cable length. There can be many aggressor channels onto one victim channel, however typically only a few are dominant. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Further consideration of cross talk can be found in Annex A, &#8220;Transmission Line </P>

<P>Theory and Channel Information (Informative)&quot;. </P>

<P> </P>

<P> </P>

<P>8.5.7  Transmitter Test Load </P>

<P> </P>

<P>All transmitter characteristics should be implemented and measured to a differential impedance of 100&#61527;&#61472;&#61617;1% at DC with a return loss of better than 20dB from baud rate divided by 1667 to 1.5 times the baud rate, unless otherwise noted. </P>

<P> </P>

<P> </P>

<P>8.5.8  Transmitter Lane-to-Lane Skew </P>

<P> </P>

<P>While the protocol layer will control some of the lane to lane skew, the electrical level for the lane-to-lane skew caused by the transmitter circuitry and associated routing is allowed up to be: </P>

<P>&#8226; less than 1000 ps for port widths less than or equal to 4 lanes </P>

<P>&#8226; less than 2UI + 1000 ps for port width with greater than 4 lanes </P>

<P> </P>

<P>Hence, the total output (i.e. measured) lane-to-lane skew is to be specified in the protocol  standards  with  the  above  skew  taken  into  account.  The  transmitter lane-to-lane skew is only for the SerDes TX and does not include any effects of the channel. </P>

<P> </P>

<P> </P>

<P>8.5.9  Receiver Input Lane-to-Lane Skew </P>

<P> </P>

<P>The maximum amount of lane-to-lane skew at the input pins of the receiver is determined by the ability of the receiver to resolve the difference between two successive ||A|| columns. Since the minimum number of non-||A|| columns between </P>

<P>||A|| columns is 16, the maximum lane skew that can be unambiguously corrected is the time it takes to transmit 7 code groups per lane. Therefore, the maximum lane-to-lane skew at the input pins of a receiver is calculated as: </P>

<P> </P>

<P>(7 code groups) x (10 bits/code-group) x (1 UI/bit) x (ns/UI) </P>

<P> </P>

<P>It is important to note that the total lane-to-lane skew specification includes the skew caused by the transmitter&#8217;s PCS and PMA (SerDes), the channel, the receivers&#8217; PMA (SerDes) and PCS and any logic that is needed to create the aligned column of </P>

<P>||A|| at the receiving device. </P>

<P> </P>

<P> </P>

<P>8.5.10  Transmitter Short Circuit Current </P>

<P> </P>

<P>The max DC current into or out of the transmitter pins when either shorted to each other or to ground shall be ±100mA when the device is fully powered up. From a hot swap point of view, the ±100mA limit is only valid after 10&#61549;s. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>8.5.11 Differential Resistance and Return Loss, Transmitter and </P>

<P>Receiver </P>

<P> </P>

<P>The DC differential resistance shall be between 80 and &#61489;&#61490;&#61488;&#61527;, inclusive. </P>

<P> </P>

<P>The differential return loss shall be better than A0 from f0 to f1 and better than </P>

<P> </P>

<P>A0 + Slope*log10(f/f1) </P>

<P> </P>

<P>where f is the frequency from f1 to f2 (see Figure 8-12). Differential return loss is measured at compliance points T and R. If AC coupling is used, then all components (internal or external) are to be included in this requirement. The reference impedance for the differential return loss measurements is 100&#61527;. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1072.jpg"/>
</Figure>

<P>Common mode return loss measurement shall be better than -6dB between a minimum frequency of 100MHz and a maximum frequency of 0.75 times the baud rate. The reference impedance for the common mode return loss is &#61490;&#61493;&#61527;. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Slope </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Loss (dB) </P>
</Textbox>

<P>A0 </P>

<P> </P>

<P> </P>

<P>Acceptable </P>

<P>Region </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>f0 f1 f2 </P>

<P> </P>

<P>Frequency (Hz) </P>

<P> </P>

<P>Figure 8-12. Transmitter and Input Differential Return Loss </P>

<P> </P>

<P>8.5.12  Baud Rate Tolerance </P>

<P> </P>

<P>The baud rates are defined to be 1.25Gbaud, 2.5Gbaud, 3.125Gbaud, 5Gbaud and </P>

<P>6.25Gbaud. Each interface is required to operate asynchronously with a tolerance of </P>

<P>±100ppm from the nominal baud rate. </P>

<P> </P>

<P>Note: The minimum and maximum baud rates can be calculated as: </P>

<P> </P>

<P>Baudrate&#61482;(1 ± 100E-6) </P>

<P> </P>

<P> </P>

<P>234 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>8.5.13  Termination and DC Blocking </P>

<P> </P>

<P>Each link requires a nominal 100&#61527;&#61472;differential source termination at the transmitter and a nominal 100&#61527;&#61472;differential load termination at the receiver. The terminations shall provide both differential and common mode termination to effectively absorb differential or common mode noise and reflections. Receivers and transmitters shall support AC coupling and may also optionally support DC coupling. AC Coupled receivers require a differential termination &gt;1k&#61527;&#61472;at DC (by blocking capacitors in or near receivers as shown in Figure 8-13 or by circuit means within the receiver). DC Coupled devices shall meet additional electrical parameters T_Vcm, R_Vrcm, R_Vtt, R_Zvtt. All termination components are included within the RX and TX blocks as shown in the reference model as defined in Section 8.4.9. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1073.jpg"/>
</Figure>

<P>50 ohm </P>

<P>0, 1, 2 </P>

<P>Connectors </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1074.jpg"/>
</Figure>

<P>50 ohm </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1075.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>AC Gnd </P>

<P>Capacitors </P>

<P>(Optional) </P>

<P>AC Gnd </P>

<P> </P>

<P>Driver Receiver </P>

<P> </P>

<P> </P>

<P>Figure 8-13. Termination Example </P>

<P> </P>

<P>8.6 Pulse Response Channel Modelling </P>

<P> </P>

<P>This section shall describe the theoretical background for channel modelling. </P>

<P> </P>

<P> </P>

<P>8.6.1  Generating a Pulse Response </P>

<P> </P>

<P>Knowing the spectral transfer function for a channel allows the pulse response of the channel can be calculated using tools such as MATLAB® </P>

<P> </P>

<P>The Pulse Response of the channel is the received pulse for an ideal square wave and is calculated by either </P>

<P>&#8226; convolving the pulse with the impulse response of the channel or </P>

<P>&#8226; multiplying the Fourier spectrum of the ideal transmitted square wave with the channel response and taking the inverse Fourier transform, where </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>fmax </P>

<P>is  difference  between  the  maximum  positive  and  minimum  negative </P>

<P>frequency </P>

<P> </P>

<P>P is the number of equally space points in the frequency array </P>

<P> </P>

<P>tx&#61480; t &#61481;&#61472;</P>

<P> </P>

<P>is the transmit signal pulse </P>

<P> </P>

<P>tx&#61480; &#61559; &#61481; is the transmit signal pulse in the frequency domain </P>

<P> </P>

<P>Tr(&#61559;) </P>

<P> </P>

<P>is the transfer function of the channel </P>

<P> </P>

<P>rx(t)  is the resulting pulse response of the channel </P>

<P> </P>

<P> </P>

<P>tstep  = </P>

<P>-----1----- </P>

<P>f </P>

<P>max </P>

<P>t = tstep &#61655; n n = [1,P] </P>

<P> </P>

<P>tx&#61480; t &#61481; = H(0) &#61655; H(tperiod &#8211; t) </P>

<P> </P>

<P>rx(&#61559;) = tx(&#61559;) &#61655; Tr(&#61559;) </P>

<P> </P>

<P> </P>

<P>rx(t) = ifft(rx(&#61559;)) </P>

<P> </P>

<P> </P>

<P>8.6.2  Basic Pulse Response Definitions </P>

<P> </P>

<P>A receive pulse response as calculated is graphically represented in Figure 8-14. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1076.jpg"/>
</Figure>

<P>c0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Amplitude </P>
</Textbox>

<P>c-1 </P>

<P>c1  c4 </P>

<P>c2 </P>

<P> </P>

<Textbox>
<P>3 </P>
</Textbox>

<P>c </P>

<P>Time </P>

<P>(Baud spaced intervals) </P>

<P> </P>

<P>Figure 8-14. Graphical Representation of Receiver Pulse </P>

<P> </P>

<P>Cursors are defined as being the amplitude of the received pulse at symbol spaces from the maximum signal energy at c0, and extend to infinity in both negative and </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>positive time. The exact position of c0 is arbitrary and is defined specifically by the various methodologies. </P>

<P> </P>

<P>A precursor is defined as a cursor that occurs before the occurrence of the main signal c0, i.e. cn where n&lt;0, usually convergences to zero within a small number of bits </P>

<P> </P>

<P>A post cursor is defined as a cursor that occurs after the occurrence of the main signal c0, i.e. cn  where n&gt;0, and usually convergences to zero within twice the propagation time of the channel. </P>

<P> </P>

<P>Given a deterministic data stream travelling across the channel, the superposition of the channel pulses give rise to Inter-Symbol Interference (ISI). This ISI has a maximum occurring for a worst case pattern, which for a channel response where all cursors are positive would be a single 1 or 0 in the middle of a long run of 0s or 1s respectively. This maximum is referred to Total Distortion. </P>

<P>n = &#61605;&#61472;</P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1077.jpg"/>
</Figure>

<P>&#61521; = &#61669; cn </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1078.jpg"/>
</Figure>

<P>&#61480; n = &#8211;&#61605; &#61481;&#61484; &#61480; n &#61625; 0 &#61481;&#61472;</P>

<P> </P>

<P>Due to ISI an enclosure in the time domain also occurs which can be determined by either running exhaustive simulations or simulations with determined worst case patterns. For the case where the ISI is so large that the eye is closed, Inherent Channel Jitter has no meaning. </P>

<P> </P>

<P> </P>

<P>8.6.3  Transmitter Pulse Definition </P>

<P> </P>

<P>A transmitter is defined by its ability to generate a transmit pulse. A single 1 transmit symbol has different amplitudes at symbol space intervals, tn, where post taps have n&gt;0, and pre-taps have n&lt;0. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1079.jpg"/>
</Figure>

<P>t(0) </P>

<Textbox>
<P>Amplitude </P>
</Textbox>

<P> </P>

<P> </P>

<P>Time (Unit Intervals) </P>

<P>t(-1) </P>

<P>t(1) </P>

<P> </P>

<P> </P>

<P>-1UI </P>

<P>0UI 1UI 2UI </P>

<P> </P>

<P>Figure 8-15. Transmit Pulse </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>When a pulse train is transmitted the exact transmitted amplitude is therefore the superposition of the pulses from the previous and to be transmitted pulses, such as in a FIR filter. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1080.jpg"/>
</Figure>

<P>a  z-1  z-1 </P>

<Textbox>
<P>n </P>
</Textbox>

<P> </P>

<P> </P>

<P>tn-1 tn  tn+1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+ </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>transmit signal </P>

<P>+tn-1+tn+tn+1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1081.jpg"/>
</Figure>

<P>+tn-1+tn-tn+1 </P>

<P>-tn-1+tn+tn+1 </P>

<P>-tn-1+tn-tn+1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+tn-1-tn+tn+1 </P>

<P>+tn-1-tn-tn+1 </P>

<P>-tn-1-tn+tn+1 </P>

<P>-tn-1-tn-tn+1 </P>

<P> </P>

<P>Figure 8-16. Transmitter FIR Filter Function </P>

<P> </P>

<P>This superposition can be understood by referring to the amplitudes depicted for various bit sequences in Figure 8-16. </P>

<P> </P>

<P>The transmit emphasis can be defined to have certain limits of maximum transmit amplitude or ratios of emphasis as defined below. </P>

<P> </P>

<P>t1 </P>

<P>Ppost  = </P>

<P>---- </P>

<P>t </P>

<P> </P>

<P> </P>

<P>E = 20 </P>

<P>0 </P>

<P>1 + Ppost </P>

<P>log ----------------------- </P>

<P>1 &#8211; P </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1082.jpg"/>
</Figure>

<P>&#61669; tn </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1083.jpg"/>
</Figure>

<P>post </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1084.jpg"/>
</Figure>

<P>&#61500; Vtx </P>

<P>min </P>

<P> </P>

<P>where </P>

<P> </P>

<P>Ppost is the first coefficient of the transmit FIR </P>

<P>E is the emphasis of the transmit emphasis </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1085.jpg"/>
</Figure>

<P>Vtx </P>

<P> </P>

<P> </P>

<P>min </P>

<P> </P>

<P>is the maximum transmit amplitude </P>

<P>8.6.4  Receiver Pulse Response </P>

<P> </P>

<P>Given an emphasized transmitter the pulse response of the receiver should be recalculated using the emphasized transmit pulse as opposed to a simple NRZ pulse. </P>

<P> </P>

<P>The receiver pulse cursors are defined in Figure 8-17. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1086.jpg"/>
</Figure>

<P>r0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Amplitude </P>
</Textbox>

<P>r-1 </P>

<P>r 4 </P>

<P>r2 </P>

<P>r1 </P>

<Textbox>
<P>3 </P>
</Textbox>

<P>r </P>

<P>Time </P>

<P>(Baud spaced intervals) </P>

<P> </P>

<P>Figure 8-17. Receiver Pulse Definition </P>

<P> </P>

<P>8.6.5  Crosstalk Pulse Response </P>

<P> </P>

<P>The crosstalk pulse response is analogous to the receiver pulse response as defined in Section 8.6.4 but using the crosstalk channel, i.e. NEXT or FEXT network analysis measurement. The transmit signal as seen in the system should be used for the calculation of the resulting crosstalk pulse response, e.g. an emphasized transmitter from above, or XAUI transmit NRZ pulse. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1087.jpg"/>
</Figure>

<P>x0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Amplitude </P>
</Textbox>

<P>x -2  x4 </P>

<P>x2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>x -1 </P>

<P>x 1  x3 </P>

<P>Time </P>

<P>(Baud spaced intervals) </P>

<P> </P>

<P>Figure 8-18. Crosstalk Pulse Definition </P>

<P> </P>

<P>The Crosstalk pulse response is then defined as above in Figure 8-18 as being a set of cursors xn usually oscillatory in form. The position of x0 is defined as being at the maximum amplitude of the pulse response. </P>

<P> </P>

<P> </P>

<P>8.6.6  Decision Feedback Equalizer </P>

<P> </P>

<P>The following filter function can be used to verify the capability of the channel to be used in such an application. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1088.jpg"/>
</Figure>

<P>- z-1 z-1 z-1 z-1          </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1089.jpg"/>
</Figure>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1090.jpg"/>
</Figure>

<P>kn  kn- 1  kn- 2  kn- 3 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1091.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+ </P>

<P> </P>

<P> </P>

<P>Figure 8-19. Decision Feedback Equalizer </P>

<P> </P>

<P>The value of the coefficients are calculated directly from the channel pulse response or the receiver pulse using an emphasized transmitter. </P>

<P> </P>

<P>kn  = </P>

<P>kn  = </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1092.jpg"/>
</Figure>

<P>cn </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1093.jpg"/>
</Figure>

<P>n = [1,m] </P>

<P>rn </P>

<P>n = [1,m] </P>

<P> </P>

<P>for unemphasized transmitters, or for emphasized transmitters </P>

<P>This equalizer is capable of equalizing a finite number of post cursors, whose </P>

<P>individual values may be limited. </P>

<P> </P>

<P> </P>

<P>8.6.7  Time Continuous Transverse Filter </P>

<P> </P>

<P>A.k.a. Feed forward Filter, Finite Input Response or Comb Structure, the Transverse Filter, Figure 8-20 consists of a finite number of coefficients, k. The sum of the continuous value of symbol spaced delayed samples multiplied by these coefficients then gives the resulting signal. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1094.jpg"/>
</Figure>

<P>rn  z-1  z-1  z-1 </P>

<P>z-1  z-1  z-1 </P>

<P> </P>

<P> </P>

<P>kn- 1 kn kn+1 </P>

<P>kn+2  kn+3  kn+4 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+ y n </P>

<P> </P>

<P> </P>

<P>Figure 8-20. Feed Forward Filter </P>

<P> </P>

<P>8.6.7.1  Time Continuous Zero-Pole Equalizer Adaption </P>

<P> </P>

<P>The pole-zero algorithm takes the SDD21 magnitude response for the through channel and inverts it to produce a desired CTE filter response curve. From a set of initial conditions for pn poles and zn zeros, the squared differences are minimized between the CTE response and the inverse channel response curve. The minimization  is  done  using  a  simplex  method,  specifically  the  Nelder-Mead </P>

<P> </P>

<P>240 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Multidimensional  Unconstrained  Non-Linear  Minimization  Method.  The Nelder-Mead method provides a local minimization of the square of the difference between the two curves by descending along the gradient of the difference function. Once the optimization result is obtained, it is compared to a specified threshold. If the threshold exceeds the target tolerance, an incrementally offset seed point is generated from a 6-dimensional grid of seed points, and the process is iterated until the correct curve is obtained within the target tolerance. </P>

<P> </P>

<P> </P>

<P>8.6.8  Time Continuous Zero/Pole </P>

<P> </P>

<P>The Zero/Pole Filter is defined, in the frequency domain by </P>

<P> </P>

<P> </P>

<P>H&#61480; f &#61481; =  p-- z </P>

<P>&#61480;  &#61481;&#61472;</P>

<Textbox>
<P>&#61655;  z + j2&#61552;f </P>
</Textbox>

<P>------------------------- </P>

<P>&#61480; p + j2&#61552;f &#61481;&#61472;</P>

<P> </P>

<P>and consists of a single zero, z , and single pole, p . </P>

<P> </P>

<P> </P>

<P>8.6.9  Degrees of Freedom </P>

<P> </P>

<P>8.6.9.1  Receiver Sample Point </P>

<P> </P>

<P>A receiver shall be allowed to either position the centre sampling point fully independently to the signal transitions or exactly in between the mean crossover of the receiver signal. </P>

<P> </P>

<P>8.6.9.2  Transmit Emphasis </P>

<P> </P>

<P>Transmit emphasis and receiver filter coefficients must be optimized with the defined resolution to give the best achievable results. Unless otherwise stated it shall be assumed that the coefficients are defined using floating point variables. </P>

<P> </P>

<P> </P>

<P>8.7 Jitter Modelling </P>

<P> </P>

<P>This section describes the theoretical background of the methodology used for jitter budgeting and jitter measurement. To avoid fundamental issues with the additional of jitter using the dual dirac model through a band limited channel, a fundamental methodology call &#8220;stateye&#8221; is defined in Section 8.7.5, which uses only convolution of the jitter distribution for the calculation of the jitter at the receiver. </P>

<P> </P>

<P> </P>

<P>8.7.1  High Frequency Jitter vs. Wander </P>

<P> </P>

<P>Jitter is defined as the deviation of the signal transition from an origin, usually its mean. This deviation has an amplitude and an associated spectrum. High frequency jitter is defined by a 1st order high pass phase filter with a corner frequency equal to the ideal CDR bandwidth. The low frequency Jitter or Wander is defined by a 1st order low pass phase filter with a corner frequency equal to the bandwidth. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>8.7.2  Total Wander vs. Relative Wander </P>

<P> </P>

<P>Generation of Total and Relative Wander can be achieved using a &#8220;Common&#8221; and &#8220;AntiPhase&#8221; Sinusoidal Source, where the total and relative wander are then related as defined below. </P>

<P> </P>

<P>Atotal  = </P>

<P>Acommon + Aantiphase </P>

<P>Arelative = 2Aantiphase </P>

<P> </P>

<P>By adding sinusoidal frequencies of slightly differing frequencies the maximum total and relative wander is achieved at various phase relationship like shown in Figure 8-21. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1095.jpg"/>
</Figure>

<P>1 </P>

<P> </P>

<P>0.5 </P>

<P>Generated Jitter </P>

<P> </P>

<P> </P>

<P>Relative </P>

<P>Total </P>

<P> </P>

<P>0 </P>

<P> </P>

<P>-0.5 </P>

<P> </P>

<P>-1 </P>

<P>0 2 4 6 8 10 12 14 16 18 </P>

<P>x 104 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1096.jpg"/>
</Figure>

<P>0.5 </P>

<P>Jitter Sources </P>

<P> </P>

<P> </P>

<P>Common </P>

<P>Antiphase </P>

<P> </P>

<P>0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>-0.5 </P>

<P>0 2 4 6 8 10 12 14 16  18 x 104 </P>

<P> </P>

<P>Figure 8-21. Generation of Total and Relative Wander </P>

<P> </P>

<P>8.7.3  Correlated vs. Uncorrelated Jitter </P>

<P> </P>

<P>If a correlation exists between the amplitude of the jitter and the current, past, and future signal level of a data channel, this type of jitter is deemed correlated. Typically this is encountered when band limitation and inter-symbol interference occurs. Due to amplitude to phase conversion of the ISI, a jitter is observed which has a direct correlation to the data pattern being transmitter. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>8.7.4  Jitter Distributions </P>

<P> </P>

<P>High frequency jitter is traditionally measured and described using probability density functions which describe the probability of the data signal crossing a decision threshold, as shown in Figure 8-22. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1097.jpg"/>
</Figure>

<P>Decision Level </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Sample Error : </P>

<P>Error probability is equal to </P>

<P>1-area under distribution </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Sample Time </P>

<P> </P>

<P>Figure 8-22. Jitter Probability Density Functions </P>

<P> </P>

<P>The  low  probability  part  of  the  jitter  distribution  can  be  described  by  two components, mathematically described in the following sections. </P>

<P> </P>

<P>8.7.4.1  Unbounded and Bounded Gaussian Distribution </P>

<P> </P>

<P>We define a Unbounded Gaussian distribution function in terms of sigma as below. </P>

<P> </P>

<P>&#61556;2 </P>

<P>&#8211;-------- </P>

<P>2 </P>

<P>GJ(&#61556;&#61484; &#61555;) = </P>

<P>----1------ &#61655; -1-- &#61655; e  2&#61555;&#61472;</P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1098.jpg"/>
</Figure>

<P>2&#61552;  &#61555;&#61472;</P>

<P> </P>

<P>For every offset &#61556; , there exists a finite and non-zero probability. </P>

<P> </P>

<P>8.7.4.2  Bounded Gaussian Distribution </P>

<P> </P>

<P>We define a Bounded Gaussian Distribution function1  in terms of sigma and a maximum value as below. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>&#61556;&#61472;</P>
</Textbox>

<P>2 </P>

<P>-------- </P>

<P>1 1 2&#61555;2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1099.jpg"/>
</Figure>

<P>&#61556; &#61603; &#61556;max </P>

<P>GJ(&#61556;&#61484; &#61555;) = </P>

<P>---------- &#61655; --- &#61655; e if </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1100.jpg"/>
</Figure>

<P>2&#61552; &#61555;&#61472;</P>

<P>0 </P>

<P>&#61556; &#61502; &#61556;max </P>

<P> </P>

<P>For random processes consisting of a finite number of random variables there exists a finite non-zero probability only if &#61556; &#61603; &#61556;max . For example, a band limited channel is bounded   but   shows   a   Gaussian   Distribution   below   its   maximum.   See Section 8.7.4.8, &quot;Example of Bounded Gaussian&quot; for an explanation concerning extrapolation. </P>

<P> </P>

<P>8.7.4.3  High Probability Jitter </P>

<P> </P>

<P>We define a dual dirac distribution function for a High Probability jitter (W) as below. </P>

<P> </P>

<P>&#61540;(&#61556; &#8211; W----) </P>

<P>&#61540;(&#61556; + W----) </P>

<P>HPJ(&#61556;&#61484; W) = </P>

<P>---------------2----- + ----------------2----- </P>

<P>2 2 </P>

<P> </P>

<P>8.7.4.4  Total Jitter </P>

<P> </P>

<P>We define the convolution of the High Probability and Gaussian jitter as being the total jitter and define it as below. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>TJ(&#61556;&#61484; W&#61484; &#61555;) = </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1101.jpg"/>
</Figure>

<P>------1------- &#61655; -1-- &#61655;&#61472;</P>

<P>&#61540;&#61670; &#61556; &#8211; W----&#61686; 2 </P>

<P>&#61672; 2 &#61688;&#61472;</P>

<P>&#8211;------------------------ </P>

<P>2&#61555;2 </P>

<P>e </P>

<P>&#61540;&#61670; &#61556; + W----&#61686; 2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1102.jpg"/>
</Figure>

<P>&#61672; 2 &#61688;&#61472;</P>

<P>&#8211;------------------------- </P>

<P>2&#61555;2 </P>

<P>+ e </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1103.jpg"/>
</Figure>

<P>2 2&#61552;  &#61555;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>8.7.4.5  Probability Distribution Function vs. Cumulative Distribution </P>

<P>Function </P>

<P> </P>

<P>An example of the convolution of GJ (magenta), HPJ (green) to give TJ (red) can be seen Figure 8-23. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1104.jpg"/>
</Figure>

<P>1Due to the bounded function the function does not comply to the requirements that the integral of the pdf from minus infinity to infinity is one. This small inaccuracy is recognized and acceptance in this context. </P>

<P> </P>

<P>244 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>0.18 </P>

<P>Probability Distribution Function of Convolution of Basic Elements </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1105.jpg"/>
</Figure>

<P>0.16 </P>

<P> </P>

<P>0.14 </P>

<P> </P>

<P>0.12 </P>

<P> </P>

<Textbox>
<P>Probabiliy </P>
</Textbox>

<P>0.1 </P>

<P> </P>

<P>0.08 </P>

<P> </P>

<P>0.06 </P>

<P> </P>

<P>0.04 </P>

<P> </P>

<P>0.02 </P>

<P> </P>

<P>0 </P>

<P> </P>

<P>-0.1 -0.05 0 0.05 0.1 0.15 </P>

<P>Time (UI) </P>

<P> </P>

<P>Figure 8-23. Example of Total Jitter PDF </P>

<P> </P>

<P>When integrating the probability distribution functions, same colors, we obtain the cumulative distribution function or half the bathtub, shown in Figure 8-24. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>100 </P>

<P>Cumulative Distribution Function of Convolution of Basic Elements </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1106.jpg"/>
</Figure>

<P>10-1 </P>

<P> </P>

<P> </P>

<P>10-2 </P>

<P> </P>

<P> </P>

<Textbox>
<P>Probabiliy </P>
</Textbox>

<P>10-3 </P>

<P> </P>

<P> </P>

<P>10-4 </P>

<P> </P>

<P> </P>

<P> </P>

<P>-0.1 -0.05 0 0.05 0.1 0.15 </P>

<P>Time (UI) </P>

<P> </P>

<P>Figure 8-24. Example of Total Jitter CDF </P>

<P> </P>

<P>8.7.4.6  BathTub Curves </P>

<P> </P>

<P>Given a measured bathtub curve consisting of measured BER for various sampling offsets, the defined Gaussian and High Probability Distributions can be used to describe the important features of the distribution. </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 245 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Initially the BER axis should be converted to Q as defined below, e.g. a BER of 10-12 </P>

<P>is a Q=7.04, and a BER of 10-15 a Q=7.941. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1107.jpg"/>
</Figure>

<P>Q = 2 &#61655; erf&#8211;1 &#61480; 2 &#61655; &#61480; 1 &#8211; BE R &#61481; &#8211; 1 &#61481;&#61472;</P>

<P> </P>

<P>&#8211; </P>

<P>where erf 1 &#61480; x &#61481;&#61472;</P>

<P> </P>

<P>is the inverse function of the error function </P>

<P> </P>

<P>z </P>

<P>erf&#61480; x &#61481;  . </P>

<P> </P>

<P>erf(z) = </P>

<P>---2---- &#61655;  e&#8211;t dt </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1108.jpg"/>
</Figure>

<P>&#61552;&#61472;</P>

<Textbox>
<P>&#61682;&#61472;</P>
</Textbox>

<Textbox>
<P>2 </P>
</Textbox>

<P>0 </P>

<P>Note: this conversion from BER to Q is only valid given a large time </P>

<P>offset from the optimal sampling point. The use of the nomenclature BER in this reference should therefore be carefully used. Any accurate prediction of the BER towards the center of the eye should be done using Marcum&#8217;s Q function, and is outside the scope of this document. </P>

<P> </P>

<P>By linearizing the bathtub, as shown in Figure 8-25, we can describe the function of the left and right hand linear parts of the bathtub in terms of an offset (HPJ) and gradient (1/GJ). </P>

<P> </P>

<P> </P>

<P>Qleft(&#61556;offset) = </P>

<P> </P>

<P>&#61480; &#61556;offset &#8211; HPJleft &#61481;&#61472;</P>

<P> </P>

<P>&#61655; -------1------- GJleft </P>

<P>Qright(&#61556;offset) </P>

<P>= &#61480; HPJleft &#8211; &#61556;offset &#61481;&#61472;</P>

<P>&#61655; --------1---------- GJright </P>

<P> </P>

<P>The conversion to a linearized bathtub from a measurement should be calculated using a polynomial fit algorithm for parts of the measurement made at low BERs or high Q. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1109.jpg"/>
</Figure>

<P>1It is assumed that when measuring the jitter bathtub that the left and right parts of the bathtub are independent to each other, e.g. the tail of the right hand part of the bathtub and negligible effect on the left hand side of the bathtub. </P>

<P> </P>

<P>246 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1110.jpg"/>
</Figure>

<P>Q=0 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1111.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1112.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1113.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1114.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1115.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1116.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1117.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1118.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1119.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1120.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1121.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1122.jpg"/>
</Figure>

<P>arbitrary origin </P>

<P> </P>

<P> </P>

<P>HPJleft </P>

<P> </P>

<P>tauoffset </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1123.jpg"/>
</Figure>

<P>HPJright </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1124.jpg"/>
</Figure>

<P>arbitrary origin plus 1UI </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Qleft  &#61501; &#61480;&#61556; offset &#61485; HPJleft &#61481;&#61655;&#61472;</P>

<P> </P>

<P>1 </P>

<P>GJleft </P>

<P> </P>

<P>Qright </P>

<P>&#61501; &#61480;HPJ right &#61485; &#61556; offset &#61481;&#61655;&#61472;</P>

<P> </P>

<P>1 </P>

<P>GJ right </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1125.jpg"/>
</Figure>

<P>Q=6 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1126.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1127.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1128.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1129.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1130.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1131.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1132.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1133.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1134.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1135.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1136.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1137.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1138.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1139.jpg"/>
</Figure>

<P>Q=7 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1140.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1141.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1142.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1143.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1144.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1145.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1146.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1147.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1148.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1149.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1150.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1151.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1152.jpg"/>
</Figure>

<P> </P>

<P>HPJleft </P>

<P>GJ right  &#61655; QBER </P>

<P> </P>

<P>GJ     &#61655; Q </P>

<P>left </P>

<P>BER </P>

<P>HPJright </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 8-25. Bathtub Definition </P>

<P> </P>

<P>8.7.4.7  Specification of GJ and HPJ </P>

<P> </P>

<P>In this specification the left and right hand terms are combined to give a single </P>

<P>definition as below where QBER is the Q for the BER of interest, e.g Q=7.49 for a </P>

<P>BER = </P>

<P>10&#8211;15 . </P>

<P> </P>

<P>HPJtotal  = </P>

<P>1 &#8211; &#61480; H PJright &#8211; HPJleft &#61481;&#61472;</P>

<P> </P>

<P>GJtotal = GJleft &#61655; QBER + GJright &#61655; QBER  = GJleft + GJright </P>

<P>= ---------------------------------------- </P>

<P>2QBER &#61655; GJrms </P>

<P>GJrms 2 </P>

<P> </P>

<P>Jtotal = GJtotal + HPJtotal </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>8.7.4.8  Example of Bounded Gaussian </P>

<P> </P>

<P>Assuming that the Cumulative Distribution Function of the jitter could be measured to the probabilities shown, Figure 8-26 shows an example of when a jitter should be classified as Correlated High Probability or Correlated Bounded Gaussian. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1153.jpg"/>
</Figure>

<P>0 </P>

<P> </P>

<P>-1 </P>

<P> </P>

<P>-2 </P>

<P> </P>

<P>-3 </P>

<P> </P>

<Textbox>
<P>Q </P>
</Textbox>

<P>-4 </P>

<P> </P>

<P>-5 </P>

<P> </P>

<P>-6 </P>

<P> </P>

<P>-7 </P>

<P> </P>

<P>-8 </P>

<P>0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 0.1 </P>

<P>Time Offset (arbituary) </P>

<P> </P>

<P>Figure 8-26. Example of Bounded Gaussian </P>

<P> </P>

<P>The convolution of a true Unbounded Gaussian Jitter (green) with a Bounded Gaussian Jitter (Red) can be seen (Magenta). It can be clearly seen and measured that at a Q of -3 the Bounded Jitter is still Gaussian and the resulting convolution can be calculated using RMS addition. Below a Q of -5 the Bounding effect can be seen, and if we linearize the Bathtub we measure a non-zero High Probability Jitter and Gaussian component. </P>

<P> </P>

<P> </P>

<P>8.7.5  Statistical Eye Methodology </P>

<P> </P>

<P>The following section describes the fundamental underlying the StatEye methodology. For a golden implementation please refer to the scripts on the OIF website, which are published separately. </P>

<P> </P>

<P>8.7.5.1  Derivation of Cursors and Calculation of PDF </P>

<P> </P>

<P>The Statistical Eye Methodology uses a channel pulse response and crosstalk pulse response in conjunction with a defined sampling jitter to generate an equivalent eye which represents the eye opening as seen by the receiver for a given probability of occurrence. This is shown in Figure 8-27. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Each possible amplitude is the convolution of </P>

<P>the data stream ndwith </P>

<P>A &#61501; &#61669; dn rn n </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1154.jpg"/>
</Figure>

<P>the cursors rn </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1155.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1156.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1157.jpg"/>
</Figure>

<P>d &#61501; {&#61485;1,1} </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1158.jpg"/>
</Figure>

<P>Probabili ty </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1159.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1160.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1161.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1162.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1163.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1164.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1165.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1166.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1167.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1168.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1169.jpg"/>
</Figure>

<Textbox>
<P>Amplitude </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1170.jpg"/>
</Figure>

<P>All equal probable combi nati on of cursors </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1171.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1172.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1173.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Figure 8-27. Statistics of Pulse Response Cursor </P>

<P> </P>

<P>Given a pulse response (black left) we locate c0 at an arbitrary point (red arrow) and measure the symbol space cursors (blue arrows), </P>

<P> </P>

<P>Given a DFE the post cursors should be adjusted by negating the measured post cursors by the appropriate static coefficient of the DFE, up to the maximum number of cursors specified. </P>

<P> </P>

<P>According to the exact data pattern these cursors superimpose to Inter-symbol Interference. Each possible combination of these cursors is calculated and from these combinations a histogram is generated to form the probability density function (PDF) (green). </P>

<P> </P>

<P>By varying the reference sampling point for c0 as shown in Figure 8-28, the previous function is repeated and family of conditional PDFs build up. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1174.jpg"/>
</Figure>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Pulse Response </P>

<P>Addi ti onal blue cursors for each sampli ng poi nt are removed to avoi d confusi on </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Si gnal Ampli tude </P>

<P>pdf(Ampli tude) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1175.jpg"/>
</Figure>

<P>Figure 8-28. Variation of the c0 Sampling Time </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1176.jpg"/>
</Figure>

<P>This can be represented mathematically below. Given, </P>

<P> </P>

<P>rn &#61480; &#61556; &#61481;&#61472;</P>

<P> </P>

<P>are the cursors of the pulse response at sampling &#61556;&#61472;</P>

<P>eb is the ideal static equalization coefficients of the b tap DFE </P>

<P>c&#61480; &#61556; &#61481;&#61472;</P>

<P>is the set of equalization cursors at sampling &#61556;&#61472;</P>

<P> </P>

<P>&#61540;&#61480; &#61556; &#61481; = </P>

<P> </P>

<P>lim </P>

<P>&#61541; &#61614; 0 </P>

<P>&#61541; x &#61541; &#8211; 1 </P>

<P> </P>

<P>is the dirac or delta function </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1177.jpg"/>
</Figure>

<P>dn&#61484; b </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1178.jpg"/>
</Figure>

<P>are all the possible combinations of the data stream and is either 1 or 0 </P>

<P>p(ISI&#61484; &#61556;) </P>

<P>is the probability density function of the ISI for a given sample time </P>

<P> </P>

<P>A similar family of PDFs are generated for the crosstalk pulse response and any other aggressors in the system using the cursor set below, noting that the entire pulse response is used. </P>

<P> </P>

<P> </P>

<P> </P>

<P>c &#61480; &#61556; &#61481; = </P>

<P>r (&#61556;) ... r (&#61556;) r (&#61556;) r (&#61556;) ... r  (&#61556;) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1179.jpg"/>
</Figure>

<P>&#8211;--- --- </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1180.jpg"/>
</Figure>

<Textbox>
<P>m &#8211;1 0 1 m </P>
</Textbox>

<P>2 2 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>8.7.5.2  Inclusion of Sampling Jitter </P>

<P> </P>

<P>In a real system the sampling point c0 is defined by the CDR and is jittered, for the sake of standardization, by the transmitter. This jitter has a probability density function which is centred at the receiver CDR sampling point and defined the probability of each of the previous conditional PDFs occurring1, as shown in </P>

<P>Figure 8-29. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Pulse Response </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1181.jpg"/>
</Figure>

<P>Si gnal </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1182.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1183.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1184.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1185.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1186.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1187.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1188.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1189.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1190.jpg"/>
</Figure>

<P>Ampli tude </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1191.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1192.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1193.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1194.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1195.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1196.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1197.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1198.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1199.jpg"/>
</Figure>

<P>pdf(Ampli tude) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1200.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1201.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1202.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1203.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1204.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1205.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1206.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1207.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1208.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1209.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1210.jpg"/>
</Figure>

<P>Joi nt </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1211.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1212.jpg"/>
</Figure>

<P>Di stri buti on pdfs </P>

<P> </P>

<P> </P>

<P> </P>

<P>Zero li ne </P>

<P>Si gnal </P>

<P>Ampli tude </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1213.jpg"/>
</Figure>

<P>pdf(Transmi t Ji tter) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1214.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1215.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>pdf(Ampli tude) </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1216.jpg"/>
</Figure>

<P>Figure 8-29. Varying the Receiver Sampling Point </P>

<P> </P>

<P>By multiplying each the conditional PDFs by its associated sampling jitter probability and summing their results together, the joint probability density function at the given receiver CDR sample point can be calculated. </P>

<P> </P>

<P>Given, </P>

<P> </P>

<P>pjitter(&#61556;&#61484; w&#61484; &#61555;) </P>

<P> </P>

<P>is the dual dirac probability density function of the sampling jitter </P>

<P>in the system, as defined in Section 8.7.4.4, &quot;Total Jitter&quot; </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1217.jpg"/>
</Figure>

<P>1Currently DCD effects are not taken into account </P>

<P> </P>

<P>RapidIO Trade Association 251 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>pcrosstalk(ISI&#61484; &#61556;) </P>

<P>pforward(ISI&#61484; &#61556;) </P>

<P>channel </P>

<P>is the probability density function of the crosstalk </P>

<P> </P>

<P>is the probability density function of the ISI of the forward </P>

<P> </P>

<P>a &#61636; b </P>

<P> </P>

<P>is the convolution operative </P>

<P> </P>

<P> </P>

<P>paverage(ISI&#61484; &#61556;) = </P>

<P> </P>

<P>&#61605;&#61472;</P>

<P>&#61682; &#61563; &#61531; pcrosstalk(ISI&#61484; &#61556; + &#61557; + w) &#61636; pforw ard(ISI&#61484; &#61556; + &#61557;) &#61533; &#61655; pjitter(&#61557;&#61484; w&#61484; &#61555;) &#61565;d&#61557;&#61472;</P>

<P>&#8211;&#61605;&#61472;</P>

<P>8.7.5.3  Generation of Statistical Eye </P>

<P> </P>

<P>By varying the receiver CDR sampling point a  new joint probability density function, Figure 8-29 can be generated. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>252 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Si gnal </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1218.jpg"/>
</Figure>

<P>Ampli tude </P>

<P> </P>

<P> </P>

<P>pdf(Ampli tude) </P>

<P> </P>

<P> </P>

<P>Joi nt </P>

<P>Di stri buti on </P>

<P>pdfs </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1219.jpg"/>
</Figure>

<P>Zero li ne </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1220.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1221.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1222.jpg"/>
</Figure>

<P>Si gnal </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1223.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1224.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1225.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1226.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1227.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1228.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1229.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1230.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1231.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1232.jpg"/>
</Figure>

<P>Ampli tude </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1233.jpg"/>
</Figure>

<P>Zero li ne </P>

<P>Zero li ne </P>

<P> </P>

<P> </P>

<P> </P>

<P>cdf(Ji tter) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 8-30. Generation of the Data Eye and Bathtub </P>

<P> </P>

<P>By integrating the Joint Probability Density Function to give the Cumulative Distribution function, and creating a contour plot an equivalent of the receiver eye can be generated which shows the exact probability of obtaining a given amplitude, shown in Figure 8-30, this equivalent eye is termed the statistical eye, shown in Figure 8-31. </P>

<P> </P>

<P>RapidIO Trade Association 253 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>By only plotting the probability against time by cutting the statistical eye along the decision threshold axis can a bathtub of the jitter can be generated. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Arx(tsample, Q) </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1234.jpg"/>
</Figure>

<P>Q=5 </P>

<P>Q=6 </P>

<P>Q=7 </P>

<P>Q=8 </P>

<P> </P>

<P>teye </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 8-31. Statistical Eye </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 9 1.25Gbaud, 2.5Gbaud, and </P>

<P>3.125Gbaud LP-Serial Links </P>

<P> </P>

<P>This chapter details the requirements for Level I RapidIO LP-Serial short and long run  electrical interfaces of  nominal baud  rates  of  1.25Gbaud, 2.5Gbaud, and </P>

<P>3.125Gbaud using NRZ coding (hence 1 bit per symbol at the electrical level). A compliant device must meet all of the requirements listed below. The electrical interface is based on a high speed, low voltage logic with a nominal differential impedance of 100&#61527;&#61486;&#61472; Connections are point-to-point balanced differential pair and signalling is unidirectional. </P>

<P> </P>

<P>The level of links defined in this section are identical to those defined in revision 1.3 of the 1x/4x LP-Serial electrical specification. The terminology has been updated to be consistent with the new level links defined in Section 8.1, &quot;Introduction&quot;. </P>

<P> </P>

<P> </P>

<P>9.1 Level I Application Goals </P>

<P> </P>

<P>The following are application requirements common to short run and long run at </P>

<P>1.25Gbaud, 2.5Gbaud, and 3.125Gbaud: </P>

<P> </P>

<P>&#8226; The electrical specifications shall support lane widths options of 1x to Nx where N=2, 4, 8, and 16. </P>

<P>&#8226; AC coupling at the receiver shall be specified to ensure inter-operability between transmitters and receivers of different vendors and technologies. </P>

<P>&#8226; A compliant device may implement any subset of baud rates contained in this section. </P>

<P>&#8226; A compliant device may implement either a short run transmitter, a long run transmitter, or both, at each of the baud rates that it supports. </P>

<P>&#8226; The clock frequency tolerance requirement for transmit and receive are </P>

<P>&#61617;100ppm. The worst case frequency differences between any transmit and receive clock is 200ppm. </P>

<P> </P>

<P>&#8226; The Bit Error Ratio (BER) shall be better than 10-12 per lane. </P>

<P>&#8226; The transmitter pins shall be capable of surviving short circuit either to each other, to supply voltages, and to ground. </P>

<P>&#8226; The short run interface shall be capable of spanning at least 20cm of PCB </P>

<P>material with up to a single connector. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; The long run interface shall be capable of spanning at least 50cm of PCB </P>

<P>material with up to two connectors. </P>

<P> </P>

<P> </P>

<P>9.2 Equalization </P>

<P> </P>

<P>At the high baud rates used by Level I LP-Serial links, the signals transmitted over a link are degraded by losses and characteristic impedance discontinuities in the interconnect media. The losses increase with increasing baud rate and interconnect media length and cause signal attenuation and inter-symbol interference that degrade the opening of the eye pattern at both the receiver input and the data decoder decision point. Depending on the baud rate and interconnect length, the degradation can be greater than that allowed by the specification. </P>

<P> </P>

<P>The signal degradation can be partially negated by the use of equalization in the transmitter and/or receiver. Equalization in the transmitter can improve the eye pattern at both the receiver input and the data decoder decision point. Equalization in the receiver can only improve the eye pattern at the data decoder decision point. Equalization is likely to be required only for longer Level I interconnects and higher Level I baud rates. </P>

<P> </P>

<P>The types of equalizers and, if the equalizers are adaptive, the adaptive equalizer training algorithms that may be used in Level I transmitter or receiver are subject to the following restrictions. </P>

<P>Equalizers that can convert a single bit error into a multiple bit burst error, such as decision feedback equalizers (DFEs), shall not be used when IDLE1 has been selected for use on the link. </P>

<P>The training algorithm for any adaptive equalization used by a Level I transmitter and/or receiver shall consistently train the equalizer and retain the equalizer&#8217;s training when IDLE1 is the training signal and shall consistently retain the equalizer&#8217;s training when IDLE1 has been selected for use on the link and the signal on the link is a continuous sequence of maximum length packets whose payload is either all ONES or all ZEROS. </P>

<P> </P>

<P> </P>

<P>9.3 Explanatory Note on Level I Transmitter and </P>

<P>Receiver Specifications </P>

<P> </P>

<P>AC electrical specifications are given for the transmitter and receiver. Long run and short run interfaces at three baud rates are described. </P>

<P> </P>

<P>The  parameters for  the AC  electrical specifications are  guided by  the  XAUI </P>

<P>electrical interface specified in Clause 47 of IEEE 802.3ae-2002.[1] </P>

<P> </P>

<P>XAUI has similar application goals as serial RapidIO Level I devices as described in Section 8.5, &quot;Common Electrical Specification&quot;. The goal of this standard is that </P>

<Figure Alt=""/>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<Figure Alt=""/>

<Figure Alt=""/>

<Figure Alt=""/>

<P> </P>

<P>electrical designs for Level I electrical designs can reuse XAUI, suitably modified for applications at the baud intervals and runs described herein. </P>

<P> </P>

<P> </P>

<P>9.4 Level I Electrical Specification </P>

<P> </P>

<P> </P>

<P>9.4.1  Level I Short Run Transmitter Characteristics </P>

<P> </P>

<P>The key transmitter electrical specifications at compliance point T are summarized in Table 9-1 and Table 9-2 while the following sections fully detail all of the requirements. </P>

<P> </P>

<P>Table 9-1. Level I SR Transmitter AC Timing Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Baud Rate </P>
</TD>

<TD>
<P>T_Baud </P>
</TD>

<TD>
<P>Section 9.4.1.2 </P>
</TD>

<TD>
<P>1.25 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>3.125 </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Output Voltage </P>
</TD>

<TD>
<P>VO </P>
</TD>

<TD>
<P>Section 9.4.1.3 </P>
</TD>

<TD>
<P>-0.40 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2.30 </P>
</TD>

<TD>
<P>Volts </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Differential Voltage&#61472;&#61472;</P>

<P>(into floating load Rload = 100&#61527;&#61472;</P>
</TD>

<TD>
<P>T_Vdiff </P>
</TD>

<TD>
<P>Section 9.4.1.3 </P>
</TD>

<TD>
<P>500 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1000 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>T_Rd </P>
</TD>

<TD>
<P>Section 9.4.1.5 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>W </P>
</TD>
</TR>

<TR>
<TD>
<P>Recommended output rise and fall times&#61472;&#61472;</P>

<P>(20% to 80%) </P>
</TD>

<TD>
<P>T_tr, T_tf </P>
</TD>

<TD>
<P>Section 9.4.1.4 </P>
</TD>

<TD>
<P>60 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(T_baud/10 &#61603; f &lt; T_Baud/2) </P>
</TD>

<TD>
<P>T_SDD22 </P>
</TD>

<TD>
<P>Section 9.4.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(T_baud/2 &#61603; f &#61603; T_baud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Common Mode Return Loss&#61472;&#61472;</P>

<P>(625 MHz &#61603; f &#61603; T_baud) </P>
</TD>

<TD>
<P>T_SCC22 </P>
</TD>

<TD>
<P>Section 9.4.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Note 3 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter Common Mode Noise1 </P>
</TD>

<TD>
<P>T_Ncm </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Note 4 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Common Mode Voltage </P>
</TD>

<TD>
<P>T_Vcm </P>
</TD>

<TD>
<P>Load Type 02 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2.1 </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>

<TR>
<TD>
<P>Multiple output skew, N&lt;=4 </P>
</TD>

<TD>
<P>SMO </P>
</TD>

<TD>
<P>Section 9.4.1.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1000 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Multiple output skew, N&gt;4 </P>
</TD>

<TD>
<P>SMO </P>
</TD>

<TD>
<P>Section 9.4.1.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2UI </P>

<P>+1000 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Unit Interval </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>320 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. For all Load Types: R_Rdin = 100&#61527;&#61472;&#61617; 20&#61527;. For Vcm definition, see Figure 8-1 </P>

<P>2. Load Type 0 with min. T_Vdiff, AC-Coupling or floating load. </P>

<P>3. It is suggested that T_SCCC22 be -6 dB to be compatible with Level II transmitter requirements </P>

<P>4. It is suggested that T_Ncm be limited to 5% of T_Vdiff to be compatible with Level II transmitter requirements </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 9-2. Level I SR Transmitter Output Jitter Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Condition </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated High Probability Jitter </P>
</TD>

<TD>
<P>T_UHPJ </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.17 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.35 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.17 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.39 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P>250 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>500 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>
</Table>

<P> </P>

<P>9.4.1.1  Level I SR Transmitter Test Load </P>

<P> </P>

<P>All transmitter characteristics should be implemented and measured to a differential impedance of 100&#61527;&#61472;± 5% at DC with a return loss of better than 20dB from the baud rate divided by 1667 to 1.5 times the baud rate, unless otherwise noted. </P>

<P> </P>

<P>9.4.1.2  Level I SR Transmitter Baud Rate </P>

<P> </P>

<P>The baud rates are 1.25Gbaud, 2.5Gbaud, and 3.125Gbaud with a tolerance of </P>

<P>±100ppm. </P>

<P> </P>

<P>9.4.1.3  Level I SR Transmitter Amplitude and Swing </P>

<P> </P>

<P>Transmitter differential amplitude shall be between 500 to 1000mVppd, inclusive, either with or without transmit emphasis. Absolute driver output voltage shall be between -0.4V and 2.4V, inclusive, with respect to the local ground. See Figure 8-1 for an illustration of absolute driver output voltage and definition of differential peak-to-peak amplitude. </P>

<P> </P>

<P>9.4.1.4  Level I SR Transmitter Rise and Fall Times </P>

<P> </P>

<P>The recommended minimum differential rise and fall time is 60ps as measured between the 20% and 80% of the maximum measured levels; the maximum differential rise and fall times are defined by the Tx eye diagram (Figure 8-2 and Table 9-4). Shorter rise and falls may result in excessive high frequency components and increase EMI and cross talk. </P>

<P> </P>

<P>9.4.1.5  Level I SR Transmitter Differential Pair Skew </P>

<P> </P>

<P>It is recommended that the timing skew at the output of a LP-Serial transmitter between the two  signals that comprise a  differential pair not exceed 25ps  at </P>

<P>1.25Gbaud, 20ps at 2.5Gbaud, and 15ps at 3.125Gbaud. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>9.4.1.6  Level I SR Transmitter Output Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11, &quot;Differential Resistance and Return Loss, Transmitter and Receiver&quot; for the reference model for return loss. See Table 9-3 for Level I short and long run transmitter parameters. Definitions for these parameters are in Figure 8-12. </P>

<P> </P>

<P>Table 9-3. Level I SR Transmitter Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-10 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>T_Baud/10 </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>f1 </P>
</TD>

<TD>
<P>625 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>T_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>10.0 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P> </P>

<P>9.4.1.7  Level I SR Transmitter Lane-to-Lane Skew </P>

<P> </P>

<P>The electrical level of lane-to-lane skew caused by the transmitter circuitry and associated routing must be less than 1000 ps for links of 4 lanes or less. Links with greater than 4 lanes must have lane-to-lane skew of less than 2UI + 1000 ps. The transmitter lane-to-lane skew is only for the serdes Tx and does not include any effects of the channel. </P>

<P> </P>

<P>9.4.1.8  Level I SR Transmitter Short Circuit Current </P>

<P> </P>

<P>It is recommended that the max DC current into or out of the transmitter pins when either shorted to each other or to ground be ±100mA when the device is fully powered up. From a hot swap point of view, the ±100mA limit is only valid after </P>

<P>10 &#61549;s. </P>

<P> </P>

<P>9.4.1.9  Level I SR Transmitter Template and Jitter </P>

<P> </P>

<P>For each baud rate at which a transmitter is specified to operate, the output eye pattern of the transmitter shall fall entirely within the unshaded portion of the Transmitter Output Compliance Mask shown in Figure 8-2 with the parameters specified in  Table 9-4. The  output eye pattern of  a  LP-Serial transmitter that implements pre-emphasis (to equalize the link and reduce inter-symbol interference) need   only   comply   with   the  Transmitter  Output   Compliance  Mask   when pre-emphasis is disabled or minimized. </P>

<P> </P>

<P> </P>

<P>Table 9-4. Level I SR Near-End (Tx) Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristics </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Near-End </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>0.17 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>0.39 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>250 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>500 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>
</Table>

<Figure Alt=""/>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<Figure Alt=""/>

<Figure Alt=""/>

<Figure Alt=""/>

<Figure Alt=""/>

<P> </P>

<P> </P>

<P>Table 9-4. Level I SR Near-End (Tx) Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristics </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Near-End </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y3 </P>
</TD>

<TD>
<P>N/A </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated Bounded High Probability Jitter </P>
</TD>

<TD>
<P>T_UBHPJ </P>
</TD>

<TD>
<P>0.17 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>0.35 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>
</Table>

<P> </P>

<P>9.4.2  Level I Long Run Transmitter Characteristics </P>

<P> </P>

<P>The key transmitter electrical specifications at compliance point T are summarized in Table 9-5 and Table 9-6 while the following sub-clauses fully detail all of the requirements. </P>

<P> </P>

<P>Table 9-5. Level I LR Transmitter AC Timing Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Baud Rate </P>
</TD>

<TD>
<P>T_Baud </P>
</TD>

<TD>
<P>Section 9.4.2.2 </P>
</TD>

<TD>
<P>1.25 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>3.125 </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Output Voltage </P>
</TD>

<TD>
<P>VO </P>
</TD>

<TD>
<P>Section 9.4.2.3 </P>
</TD>

<TD>
<P>-0.40 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2.30 </P>
</TD>

<TD>
<P>Volts </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Differential Voltage&#61472;&#61472;</P>

<P>(into floating load Rload=100&#61527;&#61481;&#61472;</P>
</TD>

<TD>
<P>T_Vdiff </P>
</TD>

<TD>
<P>Section 9.4.2.3 </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1600 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>T_Rd </P>
</TD>

<TD>
<P>Section 9.4.1.5 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>W </P>
</TD>
</TR>

<TR>
<TD>
<P>Recommended output rise and fall times&#61472;&#61472;</P>

<P>(20% to 80%) </P>
</TD>

<TD>
<P>T_tr, T_tf </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>60 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(T_baud/10 £ f &lt; T_Baud/2) </P>
</TD>

<TD>
<P>T_SDD22 </P>
</TD>

<TD>
<P>Section 9.4.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(T_baud/2 &#61603; f &#61603; T_baud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Common Mode Return Loss&#61472;&#61472;</P>

<P>(625 MHz &#61603; f &#61603; T_baud) </P>
</TD>

<TD>
<P>T_SCC22 </P>
</TD>

<TD>
<P>Section 9.4.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Note 3 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter Common Mode Noise1 </P>
</TD>

<TD>
<P>T_Ncm </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Note 4 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Common Mode Voltage </P>
</TD>

<TD>
<P>T_Vcm </P>
</TD>

<TD>
<P>Load Type 02 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2.1 </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>

<TR>
<TD>
<P>Multiple output skew, N&lt;=4 </P>
</TD>

<TD>
<P>SMO </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1000 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Multiple output skew, N&gt;4 </P>
</TD>

<TD>
<P>SMO </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2UI+ </P>

<P>1000 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Unit Interval </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>320 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. For all Load Types: R_Rdin = 100&#61527;&#61472;&#61617; 20&#61527;. For Vcm definition, see Figure 8-1. </P>

<P>2. Load Type 0 with min. T_Vdiff, AC-Coupling or floating load. </P>

<P>3. It is suggested that T_SCCC22 be -6 dB to be compatible with Level II transmitter requirements </P>

<P>4. It is suggested that T_Ncm be limited to 5% of T_Vdiff to be compatible with Level II transmitter requirements </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 9-6. Level I LR Transmitter Output Jitter Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Condition </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated High Probability Jitter </P>
</TD>

<TD>
<P>T_UHPJ </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.17 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.35 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.17 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.39 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P>400 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>Section 9.4.1.9 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>
</Table>

<P> </P>

<P>9.4.2.1  Level I LR Transmitter Test Load </P>

<P> </P>

<P>All transmitter characteristics should be implemented and measured to a differential impedance of 100&#61527; ± 5% at DC with a return loss of better than 20 dB from the baud rate divided by 1667 to 1.5 times the baud rate, unless otherwise noted. </P>

<P> </P>

<P>9.4.2.2  Level I LR Transmitter Baud Rate </P>

<P> </P>

<P>The baud rates are 1.25Gbaud, 2.5Gbaud, and 3.125Gbaud with a tolerance of </P>

<P>±100ppm. </P>

<P> </P>

<P>9.4.2.3  Level I LR Transmitter Amplitude and Swing </P>

<P> </P>

<P>Transmitter differential amplitude shall be between 400 to 1600mVppd, inclusive, either with or without transmit emphasis. Absolute driver output voltage shall be between -0.4V and 2.4V, inclusive, with respect to the local ground. See Figure 8-1 for an illustration of absolute driver output voltage and definition of differential peak-to-peak amplitude. </P>

<P> </P>

<P>9.4.2.4  Level I LR Transmitter Rise and Fall Times </P>

<P> </P>

<P>The recommended minimum differential rise and fall time is 60ps as measured between the 20% and 80% of the maximum measured levels; the maximum differential rise and fall times are defined by the Tx eye diagram (Figure 8-2 and Table 9-8). Shorter rise and falls may result in excessive high frequency components and increase EMI and cross talk. </P>

<P> </P>

<P>9.4.2.5  Level I LR Transmitter Differential Pair Skew </P>

<P> </P>

<P>It is recommended that the timing skew at the output of a LP-Serial transmitter between the two  signals that comprise a  differential pair not exceed 25ps  at </P>

<P>1.25Gbaud, 20ps at 2.5Gbaud and 15ps at 3.125 Gbaud. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>9.4.2.6  Level I LR Transmitter Output Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11 for the reference model for return loss. See Table 9-3 for Level I short and long run transmitter parameters. Definitions for these parameters are in Figure 8-12. </P>

<P> </P>

<P>Table 9-7. Level I LR Transmitter Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>T_Baud/10 </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>f1 </P>
</TD>

<TD>
<P>T_Baud/2 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>T_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>16.6 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P> </P>

<P>9.4.2.7  Level I LR Transmitter Lane-to-Lane Skew </P>

<P> </P>

<P>The electrical level of lane-to-lane skew caused by the transmitter circuitry and associated routing must be less than 1000 ps for links of 4 lanes or less. Links with greater than 4 lanes must have lane-to-lane skew of less than 2UI + 1000 ps. The transmitter lane-to-lane skew is only for the serdes Tx and does not include any effects of the channel. </P>

<P> </P>

<P>9.4.2.8  Level I LR Transmitter Short Circuit Current </P>

<P> </P>

<P>It is recommended that the max DC current into or out of the transmitter pins when either shorted to each other or to ground be ±100mA when the device is fully powered up. From a hot swap point of view, the ±100mA limit is only valid after </P>

<P>10&#61549;s. </P>

<P> </P>

<P>9.4.2.9  Level I LR Transmitter Template and Jitter </P>

<P> </P>

<P>For each baud rate at which a LP-Serial transmitter is specified to operate, the output eye pattern of the transmitter shall fall entirely within the unshaded portion of the Transmitter Output Compliance Mask shown in Figure 8-2 with the parameters specified in  Table 9-4. The  output eye pattern of  a  LP-Serial transmitter that implements pre-emphasis (to equalize the link and reduce inter-symbol interference) need   only   comply   with   the  Transmitter  Output   Compliance  Mask   when pre-emphasis is disabled or minimized. </P>

<P> </P>

<P> </P>

<P>Table 9-8. Level I LR Near-End (Tx) Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristics </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Near-End </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>0.17 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>0.39 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>400 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>
</Table>

<Figure Alt=""/>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 9-8. Level I LR Near-End (Tx) Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristics </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Near-End </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y3 </P>
</TD>

<TD>
<P>N/A </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated Bounded High Probability Jitter </P>
</TD>

<TD>
<P>T_UBHPJ </P>
</TD>

<TD>
<P>0.17 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>0.35 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>
</Table>

<P> </P>

<P>9.4.3  Level I Receiver Specifications </P>

<P> </P>

<P>Level I LP-Serial receiver electrical and timing specifications are stated in the text and tables of this section. </P>

<P> </P>

<P>Table 9-9. Level I Receiver Electrical Input Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (1.25 Gbaud) </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1.250 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (2.5 Gbaud) </P>
</TD>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2.500 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (3.125 Gbaud) </P>
</TD>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>3.125 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Input Voltage </P>
</TD>

<TD>
<P>R_Vin </P>
</TD>

<TD>
<P>Section 9.4.3.4 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Input Differential voltage </P>
</TD>

<TD>
<P>R_Vdiff </P>
</TD>

<TD>
<P>Section 9.4.3.3 </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1600 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>R_Rdin </P>
</TD>

<TD>
<P>Section 9.4.3.7 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>W </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Input Return Loss&#61472;&#61472;</P>

<P>(100 MHz &#61603; f &#61603; R_Baud/2) </P>
</TD>

<TD>
<P>R_SDD11 </P>
</TD>

<TD>
<P>Section 9.4.3.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Input Return Loss&#61472;&#61472;</P>

<P>(R_Baud/2 &#61603; f &#61603; R_Baud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Common mode Input Return Loss&#61472;&#61472;</P>

<P>(100 MHz to 0.8 *R_Baud) </P>
</TD>

<TD>
<P>R_SCC11 </P>
</TD>

<TD>
<P>Section 9.4.3.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Termination Voltage1,2 </P>
</TD>

<TD>
<P>R_Vtt </P>
</TD>

<TD>
<P>R_Vtt floating4 </P>
</TD>

<TD>
<P>Not Specified </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>

<TR>
<TD>
<P>Input Common Mode Voltage1,2 </P>
</TD>

<TD>
<P>R_Vrcm </P>
</TD>

<TD>
<P>R_Vtt floating3,4, </P>
</TD>

<TD>
<P>-0.05 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1.85 </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>

<TR>
<TD>
<P>Wander divider (in Figure 8-8 &amp; Figure 8-8) </P>
</TD>

<TD>
<P>n </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. Input common mode voltage for AC-coupled or floating load input with min. T_Vdiff, </P>

<P>2. Receiver is required to implement at least one of specified nominal R_Vtt values, and typically implements only one of these values. Receiver is only required to meet R_Vrcm parameter values that correspond to R_Vtt values supported. </P>

<P>3. Input common mode voltage for AC-coupled or floating load input with min. T_Vdiff. </P>

<P>4. For floating load, input resistance must be &#61619;&#61472;1k&#61527;. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 9-10. Level I Receiver Input Jitter Tolerance Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit Error Ratio </P>
</TD>

<TD>
<P>BER </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>10-12 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Bounded High Probability Jitter </P>
</TD>

<TD>
<P>R_BHPJ </P>
</TD>

<TD>
<P>Section 9.4.3.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.37 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Sinusoidal Jitter, maximum </P>
</TD>

<TD>
<P>R_SJ-max </P>
</TD>

<TD>
<P>Section 9.4.3.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>8.5 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Sinusoidal Jitter, High Frequency </P>
</TD>

<TD>
<P>R_SJ-hf </P>
</TD>

<TD>
<P>Section 9.4.3.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.1 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter (Does not include Sinusoidal Jitter) </P>
</TD>

<TD>
<P>R_TJ </P>
</TD>

<TD>
<P>Section 9.4.3.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.55 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter Tolerance1 </P>
</TD>

<TD>
<P>R_JT </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.65 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_X1 </P>
</TD>

<TD>
<P>Section 9.4.3.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.275 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P>Section 9.4.3.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y2 </P>
</TD>

<TD>
<P>Section 9.4.3.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. Total jitter is composed of three components, deterministic jitter, random jitter and single frequency sinusoidal jitter. The sinusoidal jitter may have any amplitude and frequency in the unshaded region of Figure 9-1. The sinusoidal jitter component is included to ensure margin for low frequency jitter, wander, noise, crosstalk and other variable system effects. </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>9.4.3.1  Level I Receiver Input Baud Rate </P>

<P> </P>

<P>All devices shall work at either 1.25Gbaud, 2.5Gbaud, or 3.125Gbaud or any combination of these baud rates with the baud rate tolerance as per Section 9.4.1.2. </P>

<P> </P>

<P>9.4.3.2  Level I Receiver Reference Input Signals </P>

<P> </P>

<P>Reference input signals to the receiver have the characteristics determined by compliant  transmitter. The  reference  input  signal  must  satisfy  the  transmitter near-end template and jitter given in Figure 8-2 and Table 9-1 (Table 9-5), Table 9-2 (Table 9-6), and Table 9-3 (Table 9-7) for short run (long run) as well as the far-end eye template and jitter given in Figure 8-5 and Table 9-13, with the differential load impedance of 100&#61527;&#61472;&#61617;&#61472;1% at DC with a return loss of better than 20 dB from baud rate divided by 1667 to 1.5 times the baud rate. Note that the input signal might not meet either of these templates when the actual receiver replaces this load. </P>

<P> </P>

<P>9.4.3.3  Level I Receiver Input Signal Amplitude </P>

<P> </P>

<P>The receiver shall accept differential input signal amplitudes produced by compliant transmitters connected without attenuation to the receiver. This may be larger than the 1600mVppd maximum of the transmitter due to output/input impedances and reflections. </P>

<P> </P>

<P>The minimum input amplitude is defined by the far-end transmitter template, the actual receiver input impedance and the loss of the actual PCB. Note that the far-end transmitter template is defined using a well controlled load impedance, however the real receiver is not, which can leave the receiver input signal smaller than the minimum 200mVppd. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>9.4.3.4  Level I Receiver Absolute Input Voltage </P>

<P> </P>

<P>The voltage levels at the input of an AC coupled receiver (if AC coupling is done within the receiver) or at the Tx side of the external AC coupling cap (if AC coupling is done externally) shall be between -0.40 to 2.30V, inclusive, with respect to local ground. </P>

<P> </P>

<P>9.4.3.5  Level I Receiver Input Common Mode Impedance </P>

<P> </P>

<P>AC coupling is to be considered part of the receiver for the purposes of this specification unless explicitly stated otherwise. It should be noted that various methods for AC coupling are allowed (for example, internal to the chip or done externally). See Section 8.5.13 for more information. </P>

<P> </P>

<P>9.4.3.6  Level I Receiver Input Lane-to-Lane Skew </P>

<P> </P>

<P>Refer to Section 8.5.9. </P>

<P> </P>

<P>9.4.3.7  Level I Receiver Input Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11 for the reference model for return loss. See Table 9-11 for </P>

<P>Level I receiver parameters. Definitions for these parameters are in Figure 8-12. </P>

<P> </P>

<P>Table 9-11. Level I Input Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P>f1 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>RBaud &#61620; 1 </P>

<P>2 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>16.6 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Receiver input impedance shall result in a differential return loss better that -8dB and a common mode return loss better than -6dB from 100MHz to (0.5)*(R_Baud Frequency). This includes contributions from on-chip circuitry, the chip package and any off-chip components related to the receiver. AC coupling components are included in this requirement. The reference impedance for return loss measurements is 100&#61527; resistive for differential return loss and 25&#61527; resistive for common mode. </P>

<P> </P>

<P>9.4.3.8  Level I Receiver Input Jitter Tolerance </P>

<P> </P>

<P>The DUT shall be measured to have a BER better than specified for stressed signal with a confidence level of three sigma. Therefore the receiver shall tolerate at least the  far-end  eye  template  and  jitter  requirements  as  given  in  Figure 8-5  and Table 9-10 with an additional SJ with any frequency and amplitude defined by the mask of Figure 9-1 where the minimum and maximum total wander amplitude are </P>

<P>0.1UIpp and 8.5UIpp respectively. This additional SJ component is intended to </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>ensure margin for wander, hence is over and above any high frequency jitter from </P>

<P>Table 9-13. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1235.jpg"/>
</Figure>

<P>8.5 UI p-p </P>

<P> </P>

<P> </P>

<P>PASS </P>

<P> </P>

<P> </P>

<P>Sinusoidal Jitter Amplitude </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>FAIL </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>0.10 UI p-p </P>

<P> </P>

<P> </P>

<P> </P>

<P>f1  Frequency </P>

<P>f2  20 MHz </P>

<P> </P>

<P>Figure 9-1. Single Frequency Sinusoidal Jitter Limits </P>

<P> </P>

<P>Table 9-12 defines the low and high knee frequency for Level I links where the baud rates are defined as in Section 9.4.3.1. </P>

<P> </P>

<P>Table 9-12. Level I Single Frequency Sinusoidal Jitter Limits Knee Frequencies </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Receiver Data Baud Rate </P>

<P>(Gbaud) </P>
</TD>

<TD>
<P> </P>

<P>f1 (kHz) </P>
</TD>

<TD>
<P> </P>

<P>f2 (kHz) </P>
</TD>
</TR>

<TR>
<TD>
<P>1.25 </P>
</TD>

<TD>
<P>8.82 </P>
</TD>

<TD>
<P>750 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.5 </P>
</TD>

<TD>
<P>17.6 </P>
</TD>

<TD>
<P>1500 </P>
</TD>
</TR>

<TR>
<TD>
<P>3.125 </P>
</TD>

<TD>
<P>22.1 </P>
</TD>

<TD>
<P>1875 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>For each baud rate at which a LP-Serial receiver is specified to operate, the receiver shall meet the corresponding Bit Error Ratio specification in Table 9-10 when the eye pattern of the receiver test signal (exclusive of sinusoidal jitter) falls entirely within the unshaded portion of the Receiver Input Compliance Mask shown in Figure 8-5 with the parameters specified in Table 9-13. The eye pattern of the receiver test signal is measured at the input pins of the receiving device with the device replaced with a 100&#61527; ± 5% differential resistive load. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 9-13. Level I Far-End (Rx) Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristics </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Far-End </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_X1 </P>
</TD>

<TD>
<P>0.275 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y2 </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>High Probability Jitter </P>
</TD>

<TD>
<P>R_HPJ </P>
</TD>

<TD>
<P>0.37 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter (Does not include Sinusoidal Jitter) </P>
</TD>

<TD>
<P>R_TJ </P>
</TD>

<TD>
<P>0.55 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>
</Table>

<P> </P>

<P>9.5 Level I Measurement and Test Requirements </P>

<P> </P>

<P>Since the LP-Serial electrical specification is guided by the XAUI electrical interface specified in Clause 47 of IEEE 802.3ae-2002, the measurement and test requirements defined here are similarly guided by Clause 47. In addition, the CJPAT test pattern defined in Annex 48A of IEEE802.3ae-2002 is specified as the test pattern for use in transmitter eye pattern and jitter measurements. Annex 48B of IEEE802.3ae-2002 is recommended as a reference for additional information on jitter test methods. </P>

<P> </P>

<P> </P>

<P>9.5.1  Level I Transmitter Measurements </P>

<P> </P>

<P>9.5.1.1  Level I Eye Template Measurements </P>

<P> </P>

<P>For  the  purpose  of  transmitter  eye  template  measurements,  the  effects  of  a single-pole high pass filter with a 3dB point at (Baud Frequency)/1667 is applied to the jitter. The data pattern for template measurements is the Continuous Jitter Test Pattern (CJPAT) defined in Annex 48A of IEEE802.3ae. All lanes of the LP-Serial link shall be active in both the transmit and receive directions, and opposite ends of the links shall use asynchronous clocks. N lane implementations shall use CJPAT as defined in Annex 48A. Single lane implementations shall use the CJPAT sequence specified in Annex 48A for transmission on lane 0. The amount of data represented in the eye shall be adequate to ensure that the bit error ratio is less than 10-12. The eye pattern shall be measured with AC coupling and the compliance template centered at 0 Volts differential. The left and right edges of the template shall be aligned with the mean zero crossing points of the measured data eye. The load for this test shall be 100&#61527; resistive ± 5% differential to 2.5GHz. </P>

<P> </P>

<P>9.5.1.2  Level I Jitter Test Measurements </P>

<P> </P>

<P>For the purpose of transmitter jitter measurement, the effects of a single-pole high pass filter with a 3dB point at (Baud Frequency)/1667 is applied to the jitter. The data pattern for jitter measurements is the Continuous Jitter Test Pattern (CJPAT) pattern defined in Annex 48A of IEEE802.3ae. All lanes of the LP-Serial link shall be active in both the transmit and receive directions, and opposite ends of the links shall use asynchronous clocks. N lane implementations shall use CJPAT as defined </P>

<P> </P>

<P>RapidIO Trade Association 267 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>in Annex 48A. Single lane implementations shall use the CJPAT sequence specified in Annex 48A for transmission on lane 0. Jitter shall be measured with AC coupling and at 0 Volts differential. Jitter measurement for the transmitter (or for calibration of a jitter tolerance setup) shall be performed with a test procedure resulting in a BER curve such as that described in Annex 48B of IEEE802.3ae. </P>

<P> </P>

<P>9.5.1.3  Level I Transmit Jitter Load </P>

<P> </P>

<P>Transmit jitter is measured at the driver output when terminated into a load of 100&#61527;&#61472;</P>

<P>resistive ± 5% differential to 2.5GHz. </P>

<P> </P>

<P> </P>

<P>9.5.2  Level I Receiver Jitter Tolerance </P>

<P> </P>

<P>Jitter tolerance is measured at the receiver using a jitter tolerance test signal. This signal is obtained by first producing the sum of deterministic and random jitter defined in Section 9.4.3 and then adjusting the signal amplitude until the data eye contacts the 4 points of the minimum eye opening of the receive template shown in Table 8-4 and Table 9-13. Note that for this to occur, the test signal must have vertical waveform symmetry about the average value and have horizontal symmetry (including jitter) about the mean zero crossing. Eye template measurement requirements are as defined above. Random jitter is calibrated using a high pass filter with a low frequency corner at 20MHz and a 20dB/decade rolloff below this. The required sinusoidal jitter specified in Section 9.4.3 is then added to the signal and the test load is replaced by the receiver being tested. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 10 5Gbaud and 6.25Gbaud LP-Serial </P>

<P>Links </P>

<P> </P>

<P>This chapter details the requirements for Level II RapidIO LP-Serial short, medium, and long run electrical interfaces of nominal baud rates of 5Gbaud and 6.25Gbaud using NRZ coding (hence 1 bit per symbol at the electrical level). A compliant device must meet all of the requirements listed below. The electrical interface is based on a high speed low voltage logic with a nominal differential impedance of </P>

<P>100&#61527;. Connections are point-to-point balanced differential pair and signaling is unidirectional. </P>

<P> </P>

<P> </P>

<P>10.1 Level II Application Goals </P>

<P> </P>

<P> </P>

<P>10.1.1  Common to Level II Short run, Medium run and Long run </P>

<P> </P>

<P>The following are application requirements common to short run, medium run and long run Level II links at 5Gbaud and 6.25Gbaud: </P>

<P>&#8226; The electrical specifications shall support lane widths options of 1x, 2x, 4x, 8x and 16x. </P>

<P>&#8226; Both AC coupled and DC coupled links options shall be specified. A compliant device must implement AC coupling and may implement DC coupling as an option. </P>

<P>&#8226; A compliant device may implement any subset of baud rates contained in this chapter. </P>

<P>&#8226; A compliant device may implement either a short run transmitter, a long run transmitter, or both, at each of the baud rates that it supports. </P>

<P>&#8226; A compliant device may implement either a short run receiver or a long run receiver at each of the baud rates that it supports. </P>

<P>&#8226; The clock frequency tolerance requirement for transmit and receive are </P>

<P>&#61617;100ppm. The worst case frequency differences between any transmit and receive clock is 200ppm. </P>

<P> </P>

<P>&#8226; The Bit Error Ratio (BER) shall be better than 10-15 per lane but the test requirements will be to verify 10-12 per lane. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Transmitters and receivers used on short, medium and long run links shall inter-operate for path lengths up to 20cm. </P>

<P>&#8226; Transmitters and receivers used on medium and long run links shall inter-operate for path lengths up to 60cm. </P>

<P>&#8226; The transmitter pins shall be capable of surviving short circuit either to each other, to supply voltages, and to ground. </P>

<P> </P>

<P> </P>

<P>10.1.2  Application Goals for Level II Short Run </P>

<P>&#8226; The short run interface shall be capable of spanning at least 20cm of PCB </P>

<P>material with up to a single connector. </P>

<P> </P>

<P> </P>

<P>10.1.3  Application Goals for Level II Medium Run </P>

<P>&#8226; The medium run interface shall be capable of spanning at least 60cm of PCB </P>

<P>material with up to two connectors. </P>

<P>&#8226; An AC coupled receiver used for a medium run shall be inter-operable with an </P>

<P>AC coupled short run transmitter </P>

<P>&#8226; An AC coupled transmitter used for a medium run shall be inter-operable with an AC coupled short run receiver, provided that the signal swing values are lowered. This implies that the signal swing is configurable. </P>

<P>&#8226; The medium run PHY may use techniques such as increased signal swing and linear equalization to accommodate medium run backplane applications, where the receiver eye may be closed. </P>

<P> </P>

<P> </P>

<P>10.1.4  Application Goals for Long Run </P>

<P>&#8226; The long run interface shall be capable of spanning at least 100cm of PCB </P>

<P>material with up to two connectors. </P>

<P>&#8226; An AC coupled long run receiver shall be inter-operable with an AC coupled short or medium run transmitter </P>

<P>&#8226; An AC coupled long run transmitter shall be inter-operable with an AC coupled short run receiver provided that the signal swing values are lowered. This implies that the signal swing is configurable. </P>

<P>&#8226; The long run PHY may use techniques such as increased signal swing, linear equalization, and Decision Feedback Equalizer, designed to accommodate longer run backplane applications, where the receiver eye may be closed. </P>

<P>&#8226; A long run transmitter and receiver is intended to accommodate &#8216;legacy&#8217; long run RapidIO 1.3 backplanes of at least 60cm with up to two connectors that can operate at data rates up to 6.25Gbaud. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.1.5  Explanatory Note on Transmitter and Receiver </P>

<P>Specifications </P>

<P> </P>

<P>AC electrical specifications are given for transmitters and receivers. Long run, medium run and short run interfaces at two baud rates are described. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1236.jpg"/>
</Figure>

<P>The parameters for the AC electrical specifications are guided by the OIF CEI Electrical    and    Jitter    Inter-operability    agreement    for    CEI-6G-SR    and CEI-6G-LR[Reference 2]. </P>

<P> </P>

<P>OIF CEI-6G-SR and CEI-6G-LR have similar application goals to serial RapidIO, as described in Section 10.1, &quot;Level II Application Goals&quot;. The goal of this standard is that electrical designs for serial RapidIO can reuse electrical designs for OIF CEI-6G, suitably modified for applications at the baud intervals and runs described herein. </P>

<P> </P>

<P> </P>

<P>10.2 Equalization </P>

<P> </P>

<P>At the high baud rates used by Level II LP-Serial links, the signals transmitted over a link are degraded by losses and characteristic impedance discontinuities in the interconnect media. The losses increase with increasing baud rate and interconnect media length and cause signal attenuation and inter-symbol interference that degrade the opening of the eye pattern at both the receiver input and the data decoder decision point. Depending on the baud rate and interconnect length, the degradation can be greater than that allowed by the specification. </P>

<P> </P>

<P>The signal degradation can be partially negated by the use of equalization in the transmitter and/or receiver. Equalization in the transmitter can improve the eye pattern at both the receiver input and the data decoder decision point. Equalization in the receiver can only improve the eye pattern at the data decoder decision point. Some degree of equalization is required by most Level II interconnects. </P>

<P> </P>

<P>The types of equalizers and, if the equalizers are adaptive, the adaptive equalizer training algorithms that may be used in a Level II 5.0 GBaud transmitter or receiver are subject to the following restrictions. </P>

<P>Equalizers that can convert a single bit error into a multiple bit burst error, such as decision feedback equalizers (DFEs), shall not be used when IDLE1 has been selected for use on the link. </P>

<P>The training algorithm for any adaptive equalization used by a Level II transmitter and/or receiver shall consistently train the equalizer and retain the equalizer&#8217;s training when IDLE1 is the training signal and shall consistently retain the equalizer&#8217;s training when IDLE1 has been selected for use on the link and the signal on the link is a continuous sequence of maximum length packets whose payload is either all ONES or all ZEROS. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The above restrictions on the types of equalizers and adaptive equalizer training algorithms do not apply to Level II transmitters and receivers operating at greater than 5.5 GBaud. </P>

<P> </P>

<P> </P>

<P>10.3 Link Compliance Methodology </P>

<P> </P>

<P> </P>

<P>10.3.1  Overview </P>

<P> </P>

<P>A serial link is comprised of a transmitter, a receiver, and a channel which connects them. Typically, two of these are normatively specified, and the third is informatively specified. In this specification, the transmitter and channel are normatively specified, while the receiver is informatively specified. </P>

<P> </P>

<P>This specification follows the OIF inter-operability or compliance methodology and is based on using transmitter and receiver reference models, measured channel S-parameters, eye masks, and calculated &#8220;statistical eyes&#8221;. These &#8220;statistical eyes&#8221; are determined by the reference models and measured channel S-parameters using publicly available StatEye MATLAB® scripts and form the basis for identifying compliant transmitters and channels. Compliant receivers are identified through a BER test. </P>

<P> </P>

<P>Reference models are used extensively because at 5 and 6.25Gbaud data rates the incoming eye at the receiver may be closed. This prevents specifying receiver compliance through receiver eye masks as is typically done at lower data rates. </P>

<P> </P>

<P> </P>

<P>10.3.2  Reference Models </P>

<P> </P>

<P>The OIF serial link reference model is shown in Figure 10-1. The reference models are simple models of the transmitter and receiver equalization with the effects of amplitude, return loss, and bandwidth included. These models do not include any other aspects of transmitter or receiver performance. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+  + </P>

<P> </P>

<P>Transmitter </P>

<P>Near-End Far-End </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Channel </P>

<P>Receiver Equalizer </P>

<P>Output </P>

<P>+  + </P>

<P> </P>

<P>Receiver </P>

<P> </P>

<P>-  -  -  - </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1237.jpg"/>
</Figure>

<P>Transmitter Reference Model Includes effects of transmitter equalization, return loss, amplitude, and bandwidth </P>

<P>Receiver Reference Model Includes effects of receiver equalization, return loss, amplitude, and bandwidth </P>

<P>Figure 10-1. OIF Reference Model </P>

<P> </P>

<P>There are three target channel run goals in this specification which require various amounts of equalization. These different goals can be met using two transmitter and two receiver reference models. The run goals are short (20cm), medium (60cm), and long (100cm). The reference models for each of the run goals are based on combining short and long run transmitter and receiver models as shown in Table </P>

<P>10-1. </P>

<P> </P>

<P>Table 10-1. Reference Models </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Run </P>
</TD>

<TD>
<P>Tx Reference Model </P>
</TD>

<TD>
<P>Rx Reference Model </P>
</TD>
</TR>

<TR>
<TD>
<P>Short </P>
</TD>

<TD>
<P>Short </P>
</TD>

<TD>
<P>Short </P>
</TD>
</TR>

<TR>
<TD>
<P>Medium </P>
</TD>

<TD>
<P>Long </P>
</TD>

<TD>
<P>Short </P>
</TD>
</TR>

<TR>
<TD>
<P>Long </P>
</TD>

<TD>
<P>Long </P>
</TD>

<TD>
<P>Long </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>Transmitter Reference Models&#61472;&#61472;</P>

<P>Short: 1 tap with &#61603; 3 dB post cursor emphasis&#61472;&#61472;</P>

<P>Long: 1 tap with &#61603; 6 dB of either pre or post cursor emphasis </P>

<P>Receiver Reference Model&#61472;&#61472;</P>

<P>Short: Single pole, Single zero with &#61603; 4 dB max gain&#61472;&#61472;</P>

<P>Long: 5 tap DFE </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.3.3  Channel Compliance </P>

<P> </P>

<P>A compliant channel is determined using the appropriate transmitter and receiver reference model, measured S-parameters for the channel under consideration, and the StatEye script. A compliant channel is one that produces a receiver equalizer output &#8220;statistical eye&#8221; which meets a BER &#61603; 10-15 using StatEye. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>10.3.4  Transmitter Compliance </P>

<P> </P>

<P>The experimental setup for transmitter compliance is shown in Figure 10-2. The shown setup consists of the transmitter under test connected to a compliant channel terminated with a 100&#61527; differential load. OIF requires the compliant channel used in verifying transmitter compliance use at least half of the available transmitter emphasis to produce an open eye at the far-end of the channel. </P>

<P> </P>

<P>Using the shown setup, the following three conditions shall be met for compliant transmitters: </P>

<P>1. After optimally adjusting the transmitter amplitude and emphasis to produce the most open far-end eye (given the transmitter emphasis constraint), the measured far-end eye must be equal or better than the calculated far-end eye as produced by StatEye. </P>

<P>2. The high frequency transmit jitter measured at the near-end must meet specification. </P>

<P>3. The measured near-end transmit eye mask must meet the specified near-end eye mask. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+  + </P>

<P> </P>

<P> </P>

<P>Transmitter </P>

<P>Channel must require </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1238.jpg"/>
</Figure>

<P>at least half of transmitter equalization to obtain an open far-end eye opening </P>

<P> </P>

<P> </P>

<P> </P>

<P>Near-End Far-End </P>

<P> </P>

<P>Channel </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>50 &#61527;&#61472;</P>

<P> </P>

<P>Vterm </P>

<P>50 &#61527;&#61472;</P>

<P>-  - </P>

<P> </P>

<P> </P>

<P>Transmitter Under Test </P>

<P>Adjust transmitter amplitude and equalization to obtain </P>

<P>best far-end eye opening </P>

<P> </P>

<P>Figure 10-2. Transmitter Compliance Setup </P>

<P> </P>

<P>10.3.5  Receiver Compliance </P>

<P> </P>

<P>The experimental setup for receiver compliance is shown in Figure 10-3. The shown setup consists of a compliant channel connected to the receiver under test. To verify the receiver under test, the receiver must meet a BER &lt; 10-12 with a stressed input eye mask. OIF does not place any requirements on the channel used in this measurement other than it must be compliant. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The input stressed eye used in this measurement includes sinusoidal, high probability, and Gaussian jitter as defined in the appropriate sections of this specification, along with any necessary additive crosstalk. Additive crosstalk is used to insure that the receiver under test is adequately stressed if a low loss channel is used in the measurement. </P>

<P> </P>

<P>The additive input crosstalk signal is determined using the channel S-parameters, receiver reference model, and the StatEye script. It must be of amplitude such that the resulting receiver equalizer output eye, given the channel, jitter, and crosstalk, is as close as feasible in amplitude when compared to the defined minimum amplitude used for channel compliance. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Additive Crosstalk </P>

<P> </P>

<P> </P>

<P>Data </P>

<P> </P>

<P> </P>

<P>Channel must be a compliant one </P>

<P>Receiver Under Test Measured BER must be better than 10-12 </P>

<P>Out </P>

<P>+ </P>

<P> </P>

<P>Cross </P>

<P>Talk </P>

<P>+  + </P>

<P> </P>

<P>Receiver </P>

<P> </P>

<P>- </P>

<P>BERT </P>

<P>-  - </P>

<P> </P>

<P>Channel </P>

<P> </P>

<P> </P>

<P>Data + </P>

<P>In </P>

<P>- </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1239.jpg"/>
</Figure>

<P>Crosstalk is added if the compliant channel used does not close the reference model receiver equalizer output eye to the specified minimum amplitude. The crosstalk amplitude is determined using the receiver reference model. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 10-3. Receiver Compliance Setup </P>

<P> </P>

<P>10.4 Level II Short Run Interface - General Requirements </P>

<P> </P>

<P> </P>

<P>10.4.1  Jitter and Inter-operability Methodology </P>

<P> </P>

<P>This section describes the requirements for inter-operability testing of the electrical interfaces  used  to  implement  a  Short  Run  link.  The  LP-Serial  5Gbaud  and </P>

<P>6.25Gbaud short run interfaces use Method C, described in CEI sub-clause 2.2. This sub-clause defines the inter-operability methodology specifically for interfaces where transmit emphasis may be used and the receiver eye requires Linear Continuous Time equalization (from channel inter-operability point of view) to be open to within the BER of interest. </P>

<P> </P>

<P>RapidIO Trade Association 275 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.4.1.1  Level II SR Defined Test Patterns1 </P>

<P> </P>

<P>A free running PRBS31 polynomial [ITU-T 0.150] shall be used for the testing of jitter tolerance and output jitter compliance. </P>

<P> </P>

<P>10.4.1.2  Level II SR Channel Compliance </P>

<P> </P>

<P>The following steps shall be made to identify which channels are to be considered compliant: </P>

<P> </P>

<P>1. The forward channel and significant crosstalk channels shall be measured using a network analyzer for the specified baud rate (see Section 10.7.4.5, &quot;Network Analysis Measurement&quot; for a suggested method). Differential </P>

<P>S-parameters will be used to represent the characteristics of this channel. </P>

<P>2. The reference transmitter shall be a single post tap transmitter, with &#61603; 3dB of emphasis and infinite precision accuracy. </P>

<P>3. A Tx edge rate filter: a single pole 20dB/dec low pass at 75% of baud rate, this is to emulate a Tx -3dB bandwidth at 3/4 baud rate. </P>

<P>4. A transmit amplitude of 400mVppd shall be used. </P>

<P>5. Additional Uncorrelated Bounded High Probability Jitter of 0.15UIpp </P>

<P>(emulating part of the Tx jitter). </P>

<P>6. Additional Uncorrelated Unbounded Gaussian Jitter of 0.15UIpp (emulating part of the Tx jitter) </P>

<P>7. The baud rate shall be 5Gbaud or 6.25Gbaud. </P>

<P>8. The reference transmitter shall use the worst case transmitter return loss at the baud frequency. In order to construct the worse case transmitter return loss, the reference transmitter should be considered to be a parallel R and C, where R is the defined maximum allowed DC resistance of the interface and C is increased until the defined maximum Return Loss at the baud frequency is reached. The transmitter return loss is specified in Section 10.4.2.1.6, &quot;Level II SR Transmitter Output Resistance and Return Loss&quot;. </P>

<P>9. An ideal receiver filter of the form in CEI Section 8.6.7, &quot;Time Continuous Transverse Filter&quot;. The reference receiver uses a continuous-time equalizer with 1 zero and 1 pole in the region of baudrate/100 to baudrate. Additional parasitic zeros and poles must be considered part of the receiver vendor&#8217;s device and be dealt with as they are for the reference receiver. Pole and Zero values have infinite precision accuracy. Maximum required gain/attenuation shall be less than or equal to 4dB. </P>

<P>10. The reference receiver shall use a sampling point defined at the midpoint between the average zero crossings of the differential signal. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1240.jpg"/>
</Figure>

<P>1All descriptions of PRBS31 imply the standard polynomial as described in [Reference 3] </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1241.jpg"/>
</Figure>

<P> </P>

<P>276 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>11. The reference receiver shall use the worst case receiver return loss at the baud frequency. In order to construct the worse case receiver return loss, the reference receiver should be considered to be a parallel R and C, where R is the defined maximum allowed DC resistance of the interface and C is increased until the defined maximum Return Loss at the baud frequency is reached. The receiver return loss is specified in Section 10.4.2.2.7, &quot;Level II SR Receiver Input Resistance and Return Loss&quot;. </P>

<P>12. The opening of the eye shall be calculated using Statistical Eye Analysis methods, as per Section 8.7.5, &quot;Statistical Eye Methodology&quot;, and confirmed to be within the requirements as specified in Table 10-9 at the required BER, </P>

<P>10-15. </P>

<P> </P>

<P>10.4.1.3  Level II SR Transmitter Inter-operability </P>

<P> </P>

<P>The following step shall be made to identify which transmitters are to be considered compliant: </P>

<P> </P>

<P>1. It shall be verified that the measured eye is equal or better than the calculated eye for the given measurement probability Q (see Annex B.3, &#8220;Eye Mask Adjustment for Sampling Oscilloscopes&quot;) for a suggested method of calculating Q given a measurement population), given: </P>

<P>&#8211; A &#8220;compliance&#8221; channel as per Section 10.4.1.2, &quot;Level II SR Channel </P>

<P>Compliance&quot; that required at least half the maximum transmit emphasis. </P>

<P>&#8211; Using this channel the transmitter shall be then be optimally adjusted and the resulting eye measured (see Section 10.7.4.6, &quot;Eye Mask Measurement Setup&quot; for a suggested method). </P>

<P>&#8211; Using this channel the statistical eye shall then be calculated, as per CEI Section 8.7.5, &quot;Statistical Eye Methodology&quot;, using the maximum defined transmit jitter and the actual transmitter's amplitude and emphasis. </P>

<P>2. The high frequency transmit jitter shall be within that specified (see </P>

<P>Section 10.7.1, &quot;High Frequency Transmit Jitter Measurement&quot;for suggested methods) </P>

<P>3. The specified transmit eye mask shall not be not violated (see </P>

<P>Section 10.7.4.6, &quot;Eye Mask Measurement Setup&quot; for a suggested method) after adjusting the horizontal time positions for the measured time with a confidence level of 3 sigma (see Annex B.3, &#8220;Eye Mask Adjustment for Sampling Oscilloscopes&quot; for a suggested method). </P>

<P> </P>

<P>10.4.1.4  Level II SR Receiver Inter-operability </P>

<P> </P>

<P>The following step shall be made to identify which receivers are to be considered compliant: </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 277 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1. The DUT shall be measured to have a BER1 better than 10-12 for a stressed signal (see Section 10.7.4.2, &quot;Jitter Tolerance with no Relative Wander Lab Setup&quot; for a suggested method) with a confidence level of three sigma (see Annex B.2, &#8220;Confidence Level of Errors Measurement&quot; for a suggested method), given: </P>

<P>&#8211; The defined sinusoidal jitter mask for total and relative wander as per Section 10.4.2.2.8, &quot;Level II SR Receiver Input Jitter Tolerance&quot; with a high frequency total/relative wander and a maximum total/relative wander as defined in the CEI IA. </P>

<P>&#8211; The specified amount of High Probability Jitter and Gaussian jitter per </P>

<P>Section 10.4.2.2.8, &quot;Level II SR Receiver Input Jitter Tolerance&quot;. </P>

<P>&#8211; An additive crosstalk signal of amplitude such that the resulting statistical eye, given the channel, jitter and crosstalk, is as close as feasible in amplitude when compared to the defined minimum amplitude for channel compliance. </P>

<P> </P>

<P> </P>

<P>10.4.2  Level II SR Electrical Characteristics </P>

<P> </P>

<P>The electrical interface is based on high speed, low voltage logic with nominal differential impedance of 100&#61527;. Connections are point-to-point balanced differential pair and signalling is unidirectional. </P>

<P> </P>

<P>10.4.2.1  Level II SR Transmitter Characteristics </P>

<P> </P>

<P>The key transmitter characteristics are summarized in Table 10-2 and Table 10-3 while the following sections fully detail all the requirements. </P>

<P> </P>

<P>Table 10-2. Level II SR Transmitter Output Electrical Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Condition </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Baud Rate (5Gbaud) </P>
</TD>

<TD>
<P>T_Baud </P>
</TD>

<TD>
<P>Section 10.4.2.1.2 </P>
</TD>

<TD>
<P>5.00 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>5.00 </P>
</TD>

<TD>
<P>5.00 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Baud Rate (6.25Gbaud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P>6.25 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>6.25 </P>
</TD>

<TD>
<P>6.25 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Output Voltage </P>
</TD>

<TD>
<P>VO </P>
</TD>

<TD>
<P>Section 10.4.2.1.3 </P>
</TD>

<TD>
<P>-0.40 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2.30 </P>
</TD>

<TD>
<P>Volts </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Differential voltage &#61472;&#61472;</P>

<P>(into floating load Rload=&#61489;&#61488;&#61488;&#61527;) </P>
</TD>

<TD>
<P>T_Vdiff </P>
</TD>

<TD>
<P>Section 10.4.2.1.3 </P>
</TD>

<TD>
<P>400 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>750 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>T_Rd </P>
</TD>

<TD>
<P>Section 10.4.2.1.6 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>W </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. Load Type 0 with min T_Vdiff, AC-Coupling or floating load </P>

<P>2. For Load Types 1 through 3: R_Zvtt &#61603; 30&#61527;&#61499;&#61472;Vtt is defined for each load type as follows: Load Type 1 R_Vtt = 1.2V +5%/-8%; Load Type 2 R_Vtt = 1.0V +5%/-8%; Load Type 3 R_Vtt = 0.8V +5%/-8%. </P>

<P>3. DC Coupling compliance is optional (Type 1 through 3). Only Transmitters that support DC coupling are required to meet this parameter. It is acceptable for a transmitter to restrict the range of T_Vdiff in order to comply with the specified T_Vcm range. </P>

<P>For a transmitter which supports multiple T_Vdiff levels, it is acceptable for a transmitter to claim DC Coupling Compliance if </P>

<P>it meets the T_Vcm ranges for at least one of its T_Vdiff setting as long as those setting(s) that are compliant are indicated. </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1242.jpg"/>
</Figure>

<P>1if the defined measurement BER is different to system required BER, adjustments to applied stressed eye TJ are necessary </P>

<P> </P>

<P>278 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table 10-2. Level II SR Transmitter Output Electrical Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Condition </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Recommended output rise and fall times&#61472;&#61472;</P>

<P>(20% to 80%) </P>
</TD>

<TD>
<P>T_tr, T_tf </P>
</TD>

<TD>
<P>Section 10.4.2.1.4 </P>
</TD>

<TD>
<P>30 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Skew between signals comprising a differential pair </P>
</TD>

<TD>
<P>T_SKEWdiff </P>
</TD>

<TD>
<P>Section 10.4.2.1.5 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>15 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(100 MHz to 0.5*T_Baud) </P>
</TD>

<TD>
<P>T_SDD22 </P>
</TD>

<TD>
<P>Section 10.4.2.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(0.5*T_Baud to T_Baud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Common Mode Return Loss&#61472;&#61472;</P>

<P>(100 MHz to 0.75 *T_Baud) </P>
</TD>

<TD>
<P>T_SCC22 </P>
</TD>

<TD>
<P>Section 10.4.2.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-6 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter Common Mode Noise </P>
</TD>

<TD>
<P>T_Ncm </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>5% of </P>

<P>T_Vdiff </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Common Mode Voltage </P>
</TD>

<TD>
<P>T_Vcm </P>
</TD>

<TD>
<P>Load Type 01 </P>

<P>Section 8.5.3 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1700 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Load Type 12,3 </P>

<P>Section 8.5.3 </P>
</TD>

<TD>
<P>630 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1100 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. Load Type 0 with min T_Vdiff, AC-Coupling or floating load </P>

<P>2. For Load Types 1 through 3: R_Zvtt &#61603; 30&#61527;&#61499;&#61472;Vtt is defined for each load type as follows: Load Type 1 R_Vtt = 1.2V +5%/-8%; Load Type 2 R_Vtt = 1.0V +5%/-8%; Load Type 3 R_Vtt = 0.8V +5%/-8%. </P>

<P>3. DC Coupling compliance is optional (Type 1 through 3). Only Transmitters that support DC coupling are required to meet this parameter. It is acceptable for a transmitter to restrict the range of T_Vdiff in order to comply with the specified T_Vcm range. </P>

<P>For a transmitter which supports multiple T_Vdiff levels, it is acceptable for a transmitter to claim DC Coupling Compliance if it meets the T_Vcm ranges for at least one of its T_Vdiff setting as long as those setting(s) that are compliant are indicated. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 10-3. Level II SR Transmitter Output Jitter Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated High Probability Jitter </P>
</TD>

<TD>
<P>T_UHPJ </P>
</TD>

<TD>
<P>Section 10.4.2.1.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>Section 10.4.2.1.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>Section 10.4.2.1.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>Section 10.4.2.1.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>Section 10.4.2.1.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.40 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>Section 10.4.2.1.8 </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>Section 10.4.2.1.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>375 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.4.2.1.1  Level II SR Transmitter Test Load </P>

<P> </P>

<P>All transmitter characteristics should be implemented and measured to a differential impedance of 100W ± 1% at DC with a return loss of better than 20dB from baud rate divided by 1667 to 1.5 times the baud rate, unless otherwise noted. </P>

<P> </P>

<P>10.4.2.1.2  Level II SR Transmitter Baud Rate </P>

<P> </P>

<P>The baud rates are 5Gbaud and 6.25Gbaud with a tolerance of ±100ppm. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>10.4.2.1.3  Level II SR Transmitter Amplitude and Swing </P>

<P> </P>

<P>Transmitter differential output amplitude shall be between 400 and 750mVppd, inclusive, either with or without any transmit emphasis. Absolute transmitter output voltage shall be between -0.1V and 1.9V, inclusive, with respect to local ground. See Figure 8-1 for an illustration of absolute transmitter output voltage limits and definition of differential peak-to-peak amplitude. </P>

<P> </P>

<P>10.4.2.1.4  Level II SR Transmitter Rise and Fall Times </P>

<P> </P>

<P>The recommended minimum differential rise and fall times are 30ps as measured between the 20% and 80% of the maximum measured levels; the maximum differential rise and fall times are defined by the Tx eye diagram Figure 8-2 and Table 10-5. Shorter rise and fall times may result in excessive high frequency components and increase EMI and cross talk. </P>

<P> </P>

<P>10.4.2.1.5  Level II SR Transmitter Differential Pair Skew </P>

<P> </P>

<P>The timing skew at the output of a Level II SR transmitter between the two signals that comprise a differential pair shall not exceed 15 ps at 5.0 Gbaud and 6.25 Gbaud. </P>

<P> </P>

<P>10.4.2.1.6  Level II SR Transmitter Output Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11, &quot;Differential Resistance and Return Loss, Transmitter and </P>

<P>Receiver&quot; for the reference model for return loss. See Table 10-4 for 5Gbaud and </P>

<P>6.25Gbaud short run transmitter parameters. Definitions for these parameters are in </P>

<P>Figure 8-12. </P>

<P> </P>

<P>Table 10-4. Level II SR Transmitter Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>f1 </P>
</TD>

<TD>
<P>T_Baud/2 </P>
</TD>

<TD>
<P> </P>

<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>T_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>16.6 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.4.2.1.7  Level II SR Transmitter Lane-to-Lane Skew </P>

<P> </P>

<P>The electrical level of lane-to-lane skew caused by the transmitter circuitry and associated routing must be less than 1000 ps for links of 4 lanes or less. Links with greater than 4 lanes must have lane-to-lane skew of less than 2UI + 1000 ps. The transmitter lane-to-lane skew is only for the serdes Tx and does not include any effects of the channel. </P>

<P> </P>

<P>10.4.2.1.8  Level II SR Transmitter Template and Jitter </P>

<P> </P>

<P>As per Section 10.4.1.3, &quot;Level II SR Transmitter Inter-operability&quot; the transmitter shall satisfy both the near-end and far-end eye template and jitter requirements as </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>given in Figure 8-2, Table 10-5, Figure 8-5, and Table 10-9 either with or without any transmit emphasis. </P>

<P>The maximum near-end duty cycle distortion (T_DCD) shall be less than 0.05UIpp. It should be noted that it is assumed the Uncorrelated High Probability Jitter </P>

<P>component of the transmitter jitter is not Inter-symbol Interference (ISI). This is only </P>

<P>assumed from a receiver point of view and does not in any way put any restrictions on the real transmitter HPJ. </P>

<P> </P>

<P> </P>

<P>Table 10-5. Level II SR Near-End (Tx) Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristics </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Near-End </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>0.40 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>375 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y3 </P>
</TD>

<TD>
<P>125 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated Bounded High Probability Jitter </P>
</TD>

<TD>
<P>T_UBHPJ </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.4.2.2  Level II SR Receiver Characteristics </P>

<P> </P>

<P>The key receiver characteristics are summarized in Table 10-6 and Table 10-7 while the following sections fully detail all the requirements. </P>

<P> </P>

<P>Table 10-6. Level II SR Receiver Electrical Input Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (5Gbaud) </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Section 10.4.2.2.1 </P>
</TD>

<TD>
<P>5.00 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>5.00 </P>
</TD>

<TD>
<P>5.00 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (6.25Gbaud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P>6.25 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>6.25 </P>
</TD>

<TD>
<P>6.25 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Input Voltage </P>
</TD>

<TD>
<P>R_Vin </P>
</TD>

<TD>
<P>Section 10.4.2.2.4 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Input Differential voltage </P>
</TD>

<TD>
<P>R_Vdiff </P>
</TD>

<TD>
<P>Section 10.4.2.2.3 </P>
</TD>

<TD>
<P>125 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1200 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>R_Rdin </P>
</TD>

<TD>
<P>Section 10.4.2.2.7 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>Bias Voltage Source Impedance &#61472;&#61472;</P>

<P>(load types 1 to 3)1 </P>
</TD>

<TD>
<P>R_Zvtt </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>30 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. DC Coupling compliance is optional. For Vcm definition, see Figure 8-1. </P>

<P>2. Receiver is required to implement at least one of specified nominal R_Vtt values, and typically implements only one of these values. Receiver is only required to meet R_Vrcm parameter values that correspond to R_Vtt values supported. </P>

<P>3. Input common mode voltage for AC-coupled or floating load input with min. T_Vdiff. </P>

<P>4. For floating load, input resistance must be &#61619;&#61472;1k&#61527;. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 10-6. Level II SR Receiver Electrical Input Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Input Return Loss&#61472;&#61472;</P>

<P>(100MHz to 0.5*R_Baud) </P>
</TD>

<TD>
<P>R_SDD11 </P>
</TD>

<TD>
<P>Section 10.4.2.2.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Input Return Loss&#61472;&#61472;</P>

<P>(0.5*R_Baud to R_Baud)) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Common mode Input Return Loss&#61472;&#61472;</P>

<P>(100MHz to 0.5*R_Baud) </P>
</TD>

<TD>
<P>R_SCC11 </P>
</TD>

<TD>
<P>Section 10.4.2.2.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-6 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Termination Voltage1,2 </P>
</TD>

<TD>
<P>R_Vtt </P>
</TD>

<TD>
<P>R_Vtt floating4 </P>
</TD>

<TD>
<P>Not Specified </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>R_Vtt = 1.2V Nominal </P>
</TD>

<TD>
<P>1.2 - 8% </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1.2 + </P>

<P>5% </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>R_Vtt = 1.0V Nominal </P>
</TD>

<TD>
<P>1.0 - 8% </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1.0 + </P>

<P>5% </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>R_Vtt = 0.8V Nominal </P>
</TD>

<TD>
<P>0.8 - 8% </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.8 + </P>

<P>5% </P>
</TD>

<TD>
<P>V </P>
</TD>
</TR>

<TR>
<TD>
<P>Input Common Mode Voltage </P>
</TD>

<TD>
<P>R_Vfcm </P>
</TD>

<TD>
<P>Load Type 02 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1800 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Load Type 11,3 </P>
</TD>

<TD>
<P>595 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>R_Vtt - </P>

<P>60 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Wander divider (in Figure 8-8 &amp; Figure 8-9) </P>
</TD>

<TD>
<P>n </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. DC Coupling compliance is optional. For Vcm definition, see Figure 8-1. </P>

<P>2. Receiver is required to implement at least one of specified nominal R_Vtt values, and typically implements only one of these values. Receiver is only required to meet R_Vrcm parameter values that correspond to R_Vtt values supported. </P>

<P>3. Input common mode voltage for AC-coupled or floating load input with min. T_Vdiff. </P>

<P>4. For floating load, input resistance must be &#61619;&#61472;1k&#61527;. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 10-7. Level II SR Receiver Input Jitter Tolerance Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Bounded High Probability Jitter </P>
</TD>

<TD>
<P>R_BHPJ </P>
</TD>

<TD>
<P>Section 10.4.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.45 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Sinusoidal Jitter, maximum </P>
</TD>

<TD>
<P>R_SJ-max </P>
</TD>

<TD>
<P>Section 10.4.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Sinusoidal Jitter, High Frequency </P>
</TD>

<TD>
<P>R_SJ-hf </P>
</TD>

<TD>
<P>Section 10.4.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter (Does not include Sinusoidal Jitter) </P>
</TD>

<TD>
<P>R_TJ </P>
</TD>

<TD>
<P>Section 10.4.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.60 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_X1 </P>
</TD>

<TD>
<P>Section 10.4.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P>Section 10.4.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>62.5 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y2 </P>
</TD>

<TD>
<P>Section 10.4.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>375 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.4.2.2.1  Level II SR Receiver Input Baud Rate </P>

<P> </P>

<P>All devices shall work at 5Gbaud, 6.25Gbaud or both baud rates with the baud rate tolerance as per Section 8.5.12, &quot;Baud Rate Tolerance&quot;. </P>

<P> </P>

<P>10.4.2.2.2  Level II SR Receiver Reference Input Signals </P>

<P> </P>

<P>Reference input signals to the receiver have the characteristics determined by compliant  transmitter. The  reference  input  signal  must  satisfy  the  transmitter near-end template and jitter given in Figure 8-2 and Table 10-5, as well as the </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>far-end  eye  template  and  jitter  given  in  Figure 8-5  and  Table 10-9,  with  the differential load impedance of 100&#61527;&#61472; &#61617;&#61472;1% at DC with a return loss of better than </P>

<P>20 dB from baud rate divided by 1667 to 1.5 times the baud rate. Note that the input signal might not meet either of these templates when the actual receiver replaces this load. </P>

<P> </P>

<P>10.4.2.2.3  Level II SR Receiver Input Signal Amplitude </P>

<P> </P>

<P>The receiver shall accept differential input signal amplitudes produced by compliant transmitters connected without attenuation to the receiver. This may be larger than the 1200mVppd maximum of the transmitter due to output/input impedances and reflections. </P>

<P> </P>

<P>The minimum input amplitude is defined by the far-end transmitter template, the actual receiver input impedance, and the loss of the actual PCB. Note that the far-end transmitter template is defined using a well controlled load impedance, however, the real receiver is not, which can leave the receiver input signal smaller than the minimum 125mVppd. </P>

<P> </P>

<P>10.4.2.2.4  Level II SR Receiver Absolute Input Voltage </P>

<P> </P>

<P>The absolute voltage levels with respect to the receiver ground at the input of the receiver are dependent on the transmitter implementation, the inter-ground difference, whether the receiver is AC or DC coupled, and (in the case of DC coupling load types 1 to 3) the nominal R_Vtt supported by the receiver. The voltage levels at the input of a DC coupled receiver shall be consistent with the R_Vrcm and R_Vdiff values defined in Table 10-6. </P>

<P> </P>

<P>The voltage levels at the input of an AC coupled receiver (if AC coupling is done within the receiver) or at the Tx side of the external AC coupling cap (if AC coupling is done externally) shall be between -0.15 and 1.95V, inclusive, with respect to local ground. </P>

<P> </P>

<P>10.4.2.2.5  Level II SR Receiver Input Common Mode Impedance </P>

<P> </P>

<P>The input common mode impedance (R_Zvtt) at the input of the receiver is dependent on whether the receiver is AC or DC coupled. The value of R_Zvtt as measured at the input of an AC coupled receiver is undefined. The value of R_Zvtt as measured at the input of a DC coupled receiver is defined as per Table 10-6. </P>

<P> </P>

<P>If AC coupling is used it is to be considered part of the receiver for the purposes of this specification unless explicitly stated otherwise. It should be noted that various methods for AC coupling are allowed (for example, internal to the chip or done externally).  See  Section 8.5.13,  &quot;Termination  and  DC  Blocking&quot;  for  more information. </P>

<P> </P>

<P>10.4.2.2.6  Level II SR Receiver Input Lane-to-Lane Skew </P>

<P> </P>

<P>Lane-to-lane skew at the input to the receiver shall not exceed 70UI peak. See </P>

<P>Section 8.5.9, &quot;Receiver Input Lane-to-Lane Skew&quot;. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>10.4.2.2.7  Level II SR Receiver Input Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11, &quot;Differential Resistance and Return Loss, Transmitter and </P>

<P>Receiver&quot; for the reference model for return loss. See Table 10-8 for 5Gbaud and </P>

<P>6.25Gbaud short run receiver parameters. Definitions for these parameters are in </P>

<P>Figure 8-12. </P>

<P> </P>

<P>Table 10-8. Level II SR Input Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P>f1 </P>
</TD>

<TD>
<P>R_Baud/2 </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>16.6 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.4.2.2.8  Level II SR Receiver Input Jitter Tolerance </P>

<P> </P>

<P>As per Section 10.4.1.4, &quot;Level II SR Receiver Inter-operability&quot;, the receiver shall tolerate  at  least  the  far-end  eye  template and  jitter  requirements as  given  in Figure 8-5 and Table 10-9 with an additional SJ with any frequency and amplitude defined by the mask of Figure 8-9 where the minimum and maximum total wander amplitude are 0.05UIpp and 5UIpp respectively. This additional SJ component is intended to ensure margin for wander, hence is over and above any high frequency jitter from Table 10-9. </P>

<P> </P>

<P>Table 10-9. Level II SR Far-End (Rx) Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Characteristics </P>
</TD>

<TD>
<P> </P>

<P>Symbol </P>
</TD>

<TD>
<P>Far-End </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_X1 </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P>62.5 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>R_Y2 </P>
</TD>

<TD>
<P>375 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated Bounded High Probability Jitter </P>
</TD>

<TD>
<P>R_UBHPJ </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Correlated Bounded High Probability Jitter </P>
</TD>

<TD>
<P>R_CBHPJ </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter (Does not include Sinusoidal Jitter) </P>
</TD>

<TD>
<P>R_TJ </P>
</TD>

<TD>
<P>0.60 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.4.2.3  Level II SR Link and Jitter Budgets </P>

<P> </P>

<P>The primary intended application is as a point-to-point interface of up to approximately 20cm and up to one connector between integrated circuits using controlled impedance traces on low-cost printed circuit boards (PCBs). Informative loss and jitter budgets are presented in Table 10-10 to demonstrate the feasibility of legacy  FR4  epoxy  PCB&#8217;s.  The  jitter  budget  is  given  in  Table 10-11.  The performance of an actual transceiver interconnect is highly dependent on the implementation. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 10-10. Level II SR Informative Loss, Skew and Jitter Budget </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Description </P>
</TD>

<TD>
<P> </P>

<P>Loss (dB) </P>
</TD>

<TD>
<P> </P>

<P>Differential </P>

<P>Skew (ps) </P>
</TD>

<TD>
<P>Bounded High Probability (UIpp) </P>
</TD>

<TD>
<P> </P>

<P>TJ (UIpp) </P>
</TD>
</TR>

<TR>
<TD>
<P>Driver </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>15 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>0.30 </P>
</TD>
</TR>

<TR>
<TD>
<P>Interconnect (with Connector) </P>
</TD>

<TD>
<P>6.6 </P>
</TD>

<TD>
<P>25 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>
</TR>

<TR>
<TD>
<P>Other </P>
</TD>

<TD>
<P>3.5 </P>
</TD>

<TD/>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>
</TR>

<TR>
<TD>
<P>Total </P>
</TD>

<TD>
<P>10.1 </P>
</TD>

<TD>
<P>40 </P>
</TD>

<TD>
<P>0.45 </P>
</TD>

<TD>
<P>0.60 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 10-11. Level II SR High Frequency Jitter Budget </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P>CEI-6G-SR </P>
</TD>

<TD>
<P>Uncorrelated Jitter </P>
</TD>

<TD>
<P>Correlated Jitter </P>
</TD>

<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Amplitude </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>

<P>Unbounded </P>

<P>Gaussian </P>
</TD>

<TD>
<P> </P>

<P>High </P>

<P>Probability </P>
</TD>

<TD>
<P> </P>

<P>Bounded </P>

<P>Gaussian </P>
</TD>

<TD>
<P>Bounded High Probability </P>
</TD>

<TD>
<P> </P>

<P>Gaussian </P>
</TD>

<TD>
<P> </P>

<P>Sinusoidal </P>
</TD>

<TD>
<P>Bounded High Probability </P>
</TD>

<TD>
<P> </P>

<P>Total </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>Abbreviation </P>
</TD>

<TD>
<P>UUGJ </P>
</TD>

<TD>
<P>UHPJ </P>
</TD>

<TD>
<P>CBGJ </P>
</TD>

<TD>
<P>CBHPJ </P>
</TD>

<TD>
<P>GJ </P>
</TD>

<TD>
<P>SJ </P>
</TD>

<TD>
<P>HPJ </P>
</TD>

<TD>
<P>TJ </P>
</TD>

<TD>
<P>k </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Units </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-0.2001 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-0.050 </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>400.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Channel </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.500 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Receiver Input </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.000 </P>
</TD>

<TD>
<P>0.300 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.450 </P>
</TD>

<TD>
<P>0.600 </P>
</TD>

<TD>
<P>0.25 </P>
</TD>

<TD>
<P>125 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock + Sampler </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-50.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Budget </P>
</TD>

<TD>
<P>0.212 </P>
</TD>

<TD>
<P>0.250 </P>
</TD>

<TD>
<P>0.000 </P>
</TD>

<TD>
<P>0.400 </P>
</TD>

<TD>
<P>0.212 </P>
</TD>

<TD>
<P>0.050 </P>
</TD>

<TD>
<P>0.650 </P>
</TD>

<TD>
<P>0.912 </P>
</TD>

<TD>
<P>0.13 </P>
</TD>

<TD>
<P>75.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. Due to transmitter emphasis, it reduces the ISI as seen at the receiver. Thus this number is negative. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>10.4.3  Level II SR StatEye.org Template </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% example template for setting up a standard, i.e. equalizer </P>

<P>% jitter and return loss </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>param.version = [param.version &#8217;_v1.0&#8217;]; </P>

<P>% these are internal variables and should not be changed param.scanResolution = 0.01; </P>

<P>param.binsize = 0.0005; </P>

<P>param.points = 2^13; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the transmitter and baud rate. The tx filter has two </P>

<P>% parameters defined for the corner frequency of the poles </P>

<P> </P>

<P>param.bps = 6.25e9; param.bitResolution = 1/(4*param.bps); param.txFilter = &#8217;singlepole&#8217;; param.txFilterParam = [0.75]; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the return loss up. The return loss can be turned off </P>

<P>% using the appropriate option </P>

<P> </P>

<P>param.returnLoss = &#8217;on&#8217;; </P>

<P>param.cpad = 1.0; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the transmitter emphasis up. Some example setting are </P>

<P>% included which can be uncommented </P>

<P> </P>

<P>% single tap emphasis </P>

<P>param.txpre = []; param.signal = 1.0; param.txpost = [-0.1]; param.vstart = [-0.3 -0.3]; param.vend = [+0.0 +0.0]; </P>

<P>param.vstep = [0.1 0.05 0.025]; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the de-emphasis of 4-point transmit pulse </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>% the de-emphasis run if param.txpre = [] and param.txpost = [] </P>

<P> </P>

<P>param.txdeemphasis = [1 1 1 1]; % de-emphasis is off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the data coding changing the transmit pulse spectrum </P>

<P>% the coding run if param.txpre = [] and param.txpost = [] </P>

<P> </P>

<P>param.datacoding = 1; % the coding is off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set PAM amplitude and rate </P>

<P> </P>

<P>param.PAM = 2; % PAM is switched off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% the rxsample point does not need to be changed as it is </P>

<P>% automatically adjusted by the optimization scripts. </P>

<P>% The number of DFE taps should be set, however, the initial </P>

<P>% conditions are irrelevant. </P>

<P> </P>

<P>param.rxsample = -0.1; </P>

<P> </P>

<P>% no DFE </P>

<P>param.dfe = []; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P>% sampling jitter in HPJpp and GJrms is defined here param.txdj = 0.15; </P>

<P>param.txrj = 0.15/(2*7.94); </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% the following options are not yet implemented and should </P>

<P>% not be changed </P>

<P> </P>

<P>param.user = [0.0]; param.useuser = &#8217;no&#8217;; param.usesymbol = &#8217;&#8217;; param.xtAmp = 1.0; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>param.TransmitAmplitude = 0.400; % mVppdif param.MinEye = 0.125; % mVppdif </P>

<P> </P>

<P>param.Q = 2*7.94; </P>

<P> </P>

<P>RapidIO Trade Association 287 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>param.maxDJ            = 0.30; </P>

<P>param.maxTJ            = 0.60; </P>

<P> </P>

<P> </P>

<P>10.5 Level II Long Run Interface General Requirements </P>

<P> </P>

<P> </P>

<P>10.5.1  Long Run Jitter and Inter-operability Methodology </P>

<P> </P>

<P>The LP-Serial 5Gbaud and 6.25Gbaud short run interfaces use Method D, described in CEI clause 2.4. This section defines the inter-operability methodology specifically for interfaces where transmit emphasis may be used and the receiver eye requires DFE equalization (from channel inter-operability point of view) to be open to within the BER of interest. </P>

<P> </P>

<P>10.5.1.1  Level II LR Channel Compliance </P>

<P> </P>

<P>The following steps shall be made to identify which channels are to be considered compliant: </P>

<P> </P>

<P>1. The forward channel and significant crosstalk channels shall be measured using a network analyzer for the specified baud rate (see Section 10.7.4.5, &quot;Network Analysis Measurement&quot; for a suggested method). </P>

<P>2. A single pre or post tap transmitter with &#61603; 6dB of emphasis, with infinite precision accuracy. </P>

<P>3. A Tx edge rate filter: a two-pole 40dB/dec low pass at 75% of baud rate, this is to emulate both Rx and Tx -3dB bandwidths at 3/4 baud rate. </P>

<P>4. A transmit amplitude of 800mVppd. </P>

<P>5. Additional Uncorrelated Bounded High Probability Jitter of 0.15UIpp </P>

<P>(emulating part of the Tx jitter). </P>

<P>6. Additional Uncorrelated Unbounded Gaussian Jitter of 0.15UIpp (emulating part of the Tx jitter). </P>

<P>7. The reference transmitter shall use the worst case transmitter return loss at the baud frequency. In order to construct the worse case transmitter return loss, the reference transmitter should be considered to be a parallel R and C, where R is the defined maximum allowed DC resistance of the interface and C is increased until the defined maximum Return Loss at the baud frequency is reached. The transmitter return loss is specified in Section 10.5.2.1.6, &quot;Level II LR Transmitter Output Resistance and Return Loss&quot;. </P>

<P>8. An ideal receiver filter of the form in Section 8.6.6, &quot;Decision Feedback Equalizer&quot;. The reference receiver uses a 5 tap DFE, with infinite precision accuracy and having the following restriction on the coefficient values: &#61472;&#61472;</P>

<P>&#61472;&#61472;</P>

<P>Let W[N] be sum of DFE tap coefficient weights from taps N through M </P>

<P>where&#61472;&#61472;</P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>&#61472;&#61472;</P>

<P>N = 1 is previous decision (i.e. first tap)&#61472;&#61472;</P>

<P>M = oldest decision (i.e. last tap)&#61472;&#61472;</P>

<P>R_Y2 = T_Y2 = 400mV&#61472;&#61472;</P>

<P>Y = min(R_X1, (R_Y2 - R_Y1) / R_Y2) = 0.30&#61472;&#61472;</P>

<P>Z = 2/3 = 0.66667&#61472;&#61472;</P>

<P>&#61472;&#61472;</P>

<P>Then W[N] &#61603; Y * Z(N - 1)&#61472;&#61472;</P>

<P>&#61472;&#61472;</P>

<P>For the channel compliance model the number of DFE taps (M) = 5. This gives the following maximum coefficient weights for the taps:&#61472;&#61472;</P>

<P>&#61472;&#61472;</P>

<P>W[1] &#61603; 0.2625 (sum of taps 1 to 5)&#61472; W[2] &#61603; 0.1750 (sum of taps 2 to 5)&#61472; W[3] &#61603; 0.1167 (sum of taps 3 to 5)&#61472; W[4] &#61603; 0.0778 (sum of taps 4 and 5) &#61472; W[5] &#61603;&#61472;0.0519 (tap 5)&#61472;&#61472;</P>

<P>&#61472;&#61472;</P>

<P>Notes:&#61472;&#61472;</P>

<P>- These coefficient weights are absolute assuming a T_Vdiff of 1 Vppd&#61472;&#61472;</P>

<P>- For a real receiver the restrictions on tap coefficients would apply for the actual number of DFE taps implemented (M) </P>

<P>9. The reference receiver shall use the worst case receiver return loss at the baud frequency. In order to construct the worse case receiver return loss, the reference receiver should be considered to be a parallel R and C, where R is the defined maximum allowed DC resistance of the interface and C is increased until the defined maximum Return Loss at the baud frequency is reached. The receiver return loss is specified in Section 10.5.2.2.7, &quot;Level II LR Receiver Input Resistance and Return Loss&quot;. </P>

<P> </P>

<P>Table 10-12. Level II LR Receiver Equalization Output Eye Mask </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye mask </P>
</TD>

<TD>
<P>R_X1 </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye mask </P>
</TD>

<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P>50 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Bounded High Probability Jitter </P>
</TD>

<TD>
<P>R_BHPJ </P>
</TD>

<TD>
<P>0.325 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10. Any parameters that have degrees of freedom (e.g. filter coefficients or sampling point) shall be optimized against the amplitude, at the zero phase offset, as generated by the Statistical Eye Output, e.g. by sweeping all degrees of freedom and selecting the parameters giving the maximum amplitude. A receiver return loss, as defined by the reference receiver, shall be used. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>11. The opening of the eye shall be calculated using Statistical Eye Analysis methods, as per Section 8.7.5, &quot;Statistical Eye Methodology&quot;, and confirmed to be within the requirements of the equalized eye mask as specified in Table 10-12 at the required BER, 10-15. </P>

<P> </P>

<P>10.5.1.2  Level II LR Transmitter Inter-operability </P>

<P> </P>

<P>The following step shall be made to identify which transmitters are to be considered compliant: </P>

<P>1. It shall be verified that the measured eye is equal or better than the calculated eye for the given measurement probability Q (see Annex B.3, &#8220;Eye Mask Adjustment for Sampling Oscilloscopes&quot; for a suggested method of calculating Q given a measurement population), given: </P>

<P>&#8211; A &#8220;compliance&#8221; channel as per Section 10.5.1.1, &quot;Level II LR Channel Compliance&quot; that required at least half the maximum transmit emphasis with no receiver filtering to give an open eye. </P>

<P>&#8211; Using this channel the transmitter shall be then optimally adjusted and the resulting near-end eye measured (see Section 10.7.4.6, &quot;Eye Mask Measurement Setup&quot; for a suggested method). </P>

<P>&#8211; Using this channel the statistical eye shall then be calculated, as per Section 8.7.5, &quot;Statistical Eye Methodology&quot;, using the maximum defined transmit jitter and the actual transmitter's amplitude and emphasis. </P>

<P> </P>

<P>If the transmit jitter or transmit eye mask is additionally defined then the following steps shall also be made to identify which transmitters are to be considered compliant: </P>

<P> </P>

<P>1. The high frequency transmit jitter shall be within that specified (see </P>

<P>Section 10.7.1, &quot;High Frequency Transmit Jitter Measurement&quot; for suggested methods). </P>

<P> </P>

<P>The specified transmit eye mask shall not be violated (see Section 10.7.4.6, &quot;Eye Mask Measurement Setup&quot; for a suggested method) after adjusting the horizontal time positions for the measured time with a confidence level of 3 sigma (see Annex B.3, &#8220;Eye Mask Adjustment for Sampling Oscilloscopes&quot; for a suggested method). </P>

<P> </P>

<P>10.5.1.3  Level II LR Receiver Inter-operability </P>

<P> </P>

<P>The following step shall be made to identify which receivers are to be considered compliant: </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1. The DUT shall be measured to have a BER1 better than specified for a stressed signal (see Section 10.7.4.3, &quot;Jitter Tolerance with Defined ISI and no Relative Wander&quot; for a suggested method) with a confidence level of three sigma (see Annex B.2, &#8220;Confidence Level of Errors Measurement&quot; for a suggested method), given: </P>

<P>&#8211; The defined sinusoidal jitter mask for relative wander as per Section 8.4.6, &quot;Relative Wander Mask&quot; with a high frequency relative wander and a maximum relative wander as defined in Section 10.5.2.2.8, &quot;Level II LR Receiver Jitter Tolerance&quot;. </P>

<P>&#8211; The specified amount of High Probability Jitter and Gaussian jitter as defined in </P>

<P>Section 10.5.2.2.8, &quot;Level II LR Receiver Jitter Tolerance&quot;. </P>

<P>&#8211; A compliance channel or filter as identified by Section 10.5.1.1, &quot;Level II LR Channel Compliance&quot;. </P>

<P>&#8211; An additive crosstalk signal of amplitude such that the resulting statistical eye, given the channel, jitter, and crosstalk, is as close as feasible in amplitude when compared to the defined minimum amplitude for channel compliance. </P>

<P> </P>

<P> </P>

<P>10.5.2  Level II LR Interface Electrical Characteristics </P>

<P> </P>

<P>The electrical interface is based on high speed, low voltage logic with nominal differential impedance of 100&#61527;. Connections are point-to-point balanced differential pair and signalling is unidirectional. </P>

<P> </P>

<P>10.5.2.1  Level II LR Transmitter Characteristics </P>

<P> </P>

<P>The key transmitter characteristics are summarized in Table 10-13 and Table 10-14 while the following sections fully detail all the requirements. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1243.jpg"/>
</Figure>

<P>1if the defined measurement BER is different to system required BER, adjustments to applied stressed eye TJ are necessary </P>

<P> </P>

<P>RapidIO Trade Association 291 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 10-13. Level II LR Transmitter Output Electrical Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbols </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Tx Baud Rate (5Gbaud) </P>
</TD>

<TD>
<P>T_Baud </P>
</TD>

<TD>
<P>Section 10.5.2.1.2 </P>
</TD>

<TD>
<P>5.00 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>5.00 </P>
</TD>

<TD>
<P>5.00 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Tx Baud Rate (6.25Gbaud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P>6.25 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>6.25 </P>
</TD>

<TD>
<P>6.25 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Output Voltage </P>
</TD>

<TD>
<P>VO </P>
</TD>

<TD>
<P>Section 10.5.2.1.3 </P>
</TD>

<TD>
<P>-0.40 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2.30 </P>
</TD>

<TD>
<P>Volts </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Differential voltage &#61472;&#61472;</P>

<P>(into floating load Rload=100&#61527;) </P>
</TD>

<TD>
<P>T_Vdiff </P>
</TD>

<TD>
<P>Section 10.5.2.1.31 </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1200 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>T_Rd </P>
</TD>

<TD>
<P>Section 10.5.2.1.6 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>Recommended output rise and fall times&#61472;&#61472;</P>

<P>(20% to 80%) </P>
</TD>

<TD>
<P>T_tr, T_tf </P>
</TD>

<TD>
<P>Section 10.5.2.1.4 </P>
</TD>

<TD>
<P>30 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Skew between signals comprising a differential pair </P>
</TD>

<TD>
<P>T_SKEWdiff </P>
</TD>

<TD>
<P>Section 10.5.2.1.5 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>15 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(100 MHz to 0.5*T_Baud) </P>
</TD>

<TD>
<P>T_SDD22 </P>
</TD>

<TD>
<P>Section 10.5.2.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(0.5*T_Baud to T_Baud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Common Mode Return Loss&#61472;&#61472;</P>

<P>(100 MHz to 0.75 *T_Baud) </P>
</TD>

<TD>
<P>T_S11 </P>
</TD>

<TD>
<P>Section 10.5.2.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-6 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter Common Mode Noise </P>
</TD>

<TD>
<P>T_Ncm </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>5% of </P>

<P>T_Vdiff </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Common Mode Voltage </P>
</TD>

<TD>
<P>T_Vcm </P>
</TD>

<TD>
<P>Load Type 02 </P>

<P>Section 8.5.3 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1700 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Load Type 13,4 </P>

<P>Section 8.5.3 </P>
</TD>

<TD>
<P>630 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1100 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. The Transmitter must be capable of producing a minimum T_Vdiff greater than or equal to 800mVppd. In applications where the channel is better than the worst case allowed, a Transmitter device may be provisioned to produce T_Vdiff less than this </P>

<P>minimum value, but greater than or equal to 400mVppd, and is still compliant with this specification. </P>

<P>2. Load Type 0 with min T_Vdiff, AC-Coupling or floating load. </P>

<P>3. For Load Type 1: R_Zvtt &#61603; 30 &#61527;&#61499;&#61472;T_Vtt &amp; R_Vtt = 1.2V +5%/-8%. </P>

<P>4. DC Coupling compliance is optional (Load Type 1). Only Transmitters that support DC coupling are required to meet this parameter. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 10-14. Level II LR Transmitter Output Jitter Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated High Probability Jitter </P>
</TD>

<TD>
<P>T_UHPJ </P>
</TD>

<TD>
<P>Section 10.5.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>Section 10.5.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>Section 10.5.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>Section 10.5.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>Section 10.5.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.40 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>Section 10.5.2.2.8 </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>Section 10.5.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>600 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.5.2.1.1  Level II LR Transmitter Test Load </P>

<P> </P>

<P>All transmitter characteristics should be implemented and measured to a differential impedance of &#61489;&#61488;&#61488;&#61527;&#61472;&#61617;&#61472;1% at DC with a return loss of better than 20dB from baud rate divided by 1667 to 1.5 times the baud rate, unless otherwise noted. </P>

<P> </P>

<P>10.5.2.1.2  Level II LR Transmitter Baud Rate </P>

<P> </P>

<P>The baud rates are 5Gbaud and 6.25Gbaud with a tolerance of ±100ppm. </P>

<P> </P>

<P>10.5.2.1.3  Level II LR Transmitter Amplitude and Swing </P>

<P> </P>

<P>Transmitter differential output amplitude shall be able to drive between 800 and </P>

<P>1200mVppd, inclusive, either with or without any transmit emphasis. DC referenced logic levels are not defined since the receiver must have high common mode impedance at DC. However, absolute transmitter output voltage shall be between </P>

<P>-0.1V and 1.9V, inclusive, with respect to local ground. See Figure 8-1 for an illustration of absolute transmitter output voltage limits and definition of differential peak-to-peak amplitude. </P>

<P> </P>

<P>10.5.2.1.4  Level II LR Transmitter Rise and Fall Times </P>

<P> </P>

<P>The recommended minimum differential rise and fall time is 30ps as measured between the 20% and 80% of the maximum measured levels; the maximum differential rise and fall times are defined by the Tx eye diagram (Figure 8-2 and Table 10-16).  Shorter  rise  and  falls  may  result  in  excessive  high  frequency components and increase EMI and cross talk. </P>

<P> </P>

<P>10.5.2.1.5  Level II LR Transmitter Differential Pair Skew </P>

<P> </P>

<P>The timing skew at the output of a Level II LR transmitter between the two signals that comprise a differential pair shall not exceed 15 ps at 5.0 Gbaud and 6.25 Gbaud. </P>

<P> </P>

<P>10.5.2.1.6  Level II LR Transmitter Output Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11, &quot;Differential Resistance and Return Loss, Transmitter and </P>

<P>Receiver&quot; for the reference model for return loss. See Table 10-15 for 5Gbaud and </P>

<P>6.25Gbaud long run transmitter parameters. Definitions for these parameters are in </P>

<P>Figure 8-12. </P>

<P> </P>

<P>Table 10-15. Level II LR Transmitter Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P>f1 </P>
</TD>

<TD>
<P>T_Baud/2 </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>16.6 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>10.5.2.1.7  Level II LR Transmitter Lane-to-Lane Skew </P>

<P> </P>

<P>The electrical level of lane-to-lane skew caused by the transmitter circuitry and associated routing must be less than 1000 ps for links of 4 lanes or less. Links with greater than 4 lanes must have lane-to-lane skew of less than 2UI + 1000 ps. The transmitter lane-to-lane skew is only for the serdes Tx and does not include any effects of the channel. </P>

<P> </P>

<P>10.5.2.1.8  Level II LR Transmitter Short Circuit Current </P>

<P> </P>

<P>The max DC current into or out of the transmitter pins when either shorted to each other or to ground shall be ±100mA when the device is fully powered up. From a hot swap point of view, the ±100mA limit is only valid after 10&#61549;s. </P>

<P> </P>

<P>10.5.2.1.9  Level II LR Transmitter Template and Jitter </P>

<P> </P>

<P>The transmitter shall satisfy both the near-end eye template and jitter requirements as given in Figure 8-2 and Table 10-16 either with or without any transmit emphasis. </P>

<P>The maximum near-end duty cycle distortion (T_DCD) shall be less than 0.05UIpp. It should be noted that it is assumed the Uncorrelated High Probability Jitter </P>

<P>component of the transmitter jitter is not Inter-symbol Interference (ISI). This is only </P>

<P>assumed from a receiver point of view so that a receiver can&#8217;t equalize it and does not in any way put any restrictions on the real transmitter HPJ. </P>

<P> </P>

<P>Table 10-16. Level II LR Near-End Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Near-End Value </P>
</TD>

<TD>
<P>Units </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>0.40 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>For connection &#61472;&#61472;</P>

<P>to short run Rx </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>400 </P>
</TD>

<TD/>

<TD>
<P>For connection &#61472;&#61472;</P>

<P>to long run Rx </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>375 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>For connection &#61472;&#61472;</P>

<P>to short run Rx </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>600 </P>
</TD>

<TD/>

<TD>
<P>For connection &#61472;&#61472;</P>

<P>to long run Rx </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated Bounded High Probability </P>

<P>Jitter </P>
</TD>

<TD>
<P>T_UBHPJ </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.5.2.2  Level II LR Receiver Characteristics </P>

<P> </P>

<P>The key receiver characteristics are summarized in Table 10-17 while the following sections fully detail all the requirements. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 10-17. Level II LR Receiver Electrical Input Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Condition </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (5Gbaud) </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Section 10.5.2.1.2 </P>
</TD>

<TD>
<P>5.00 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>5.00 </P>
</TD>

<TD>
<P>5.00 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (6.25Gbaud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P>6.25 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>6.25 </P>
</TD>

<TD>
<P>6.25 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Input Voltage </P>
</TD>

<TD>
<P>R_Vin </P>
</TD>

<TD>
<P>Section 10.5.2.2.4 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Input Differential voltage </P>
</TD>

<TD>
<P>R_Vdiff </P>
</TD>

<TD>
<P>Section 10.5.2.2.3 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1200 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>R_Rdin </P>
</TD>

<TD>
<P>Section 10.5.2.2.7 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>Bias Voltage Source Impedance &#61472;&#61472;</P>

<P>(load type 1)1 </P>
</TD>

<TD>
<P>R_Zvtt </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>30 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Input Return Loss&#61472;&#61472;</P>

<P>(100MHz to 0.5*R_Baud) </P>
</TD>

<TD>
<P>R_SDD11 </P>
</TD>

<TD>
<P>Section 10.5.2.2.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Input Return Loss&#61472;&#61472;</P>

<P>(0.5*R_Baud to R_Baud)) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Common mode Input Return Loss&#61472;&#61472;</P>

<P>(100MHz to 0.5*R_Baud) </P>
</TD>

<TD>
<P>R_SCC11 </P>
</TD>

<TD>
<P>Section 10.5.2.2.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-6 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Input Common Mode Voltage </P>
</TD>

<TD>
<P>R_Vfcm </P>
</TD>

<TD>
<P>Load Type 02 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1800 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Load Type 11,3 </P>
</TD>

<TD>
<P>595 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>R_Vtt - </P>

<P>60 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Wander divider (in Figure 8-8 &amp; Figure 8-9) </P>
</TD>

<TD>
<P>n </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. DC Coupling compliance is optional (Load Type 1). Only receivers that support DC coupling are required to meet this parameter. </P>

<P>2. Load Type 0 with min T_Vdiff, AC-Coupling or floating load. For floating load, input resistance must be &#61619;&#61472;1k&#61527;&#61472;</P>

<P>3. For Load Type 1: T_Vtt &amp; R_Vtt = 1.2V +5%/-8%. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.5.2.2.1  Level II LR Receiver Input Baud Rate </P>

<P> </P>

<P>All devices shall work at 5Gbaud, 6.25Gbaud or both baud rates with the baud rate tolerance as per Section 8.5.12. </P>

<P> </P>

<P>10.5.2.2.2  Level II LR Receiver Reference Input Signals </P>

<P> </P>

<P>Reference input signals to the receiver have the characteristics determined by the compliant  transmitter. The  reference  input  signal  must  satisfy  the  transmitter near-end template and jitter given in Figure 8-2 and Table 10-16, as well as the far-end eye jitter given in Table 10-20, with the differential load impedance of &#61489;&#61488;&#61488;&#61527;&#61472;&#61472;</P>

<P>&#61617;&#61472;1% at DC with a return loss of better than 20dB from baud rate divided by 1667 to 1.5 times the baud rate. Note that the input signal might not meet either of these requirements when the actual receiver replaces this load. </P>

<P> </P>

<P>10.5.2.2.3  Level II LR Receiver Input Signal Amplitude </P>

<P> </P>

<P>The receiver shall accept differential input signal amplitudes produced by compliant transmitters connected without attenuation to the receiver. This may be larger than the 1200mVppd maximum of the transmitter due to output/input impedances and reflections. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The minimum input amplitude is defined by the far-end transmitter template, the actual receiver input impedance, and the loss of the actual PCB. Note that the far-end transmitter template is defined using a well controlled load impedance, however the real receiver is not, which can leave the receiver input signal smaller than expected. </P>

<P> </P>

<P>10.5.2.2.4  Level II LR Receiver Absolute Input Voltage </P>

<P> </P>

<P>The absolute voltage levels with respect to the receiver ground at the input of the receiver are dependent on the transmitter implementation and the inter-ground difference. </P>

<P> </P>

<P>The voltage levels at the input of an AC coupled receiver (if the effective AC coupling is done within the receiver) or at the Tx side of the external AC coupling cap (if AC coupling is done externally) shall be between -0.15 and 1.95V, inclusive, with respect to local ground. </P>

<P> </P>

<P>10.5.2.2.5  Level II LR Receiver Input Common Mode Impedance </P>

<P> </P>

<P>The input common mode impedance (R_Zvtt) at the input of the receiver is dependent on whether the receiver is AC or DC coupled. The value of R_Zvtt as measured at the input of an AC coupled receiver is undefined. The value of R_Zvtt as measured at the input of a DC coupled receiver is defined as per Table 10-17. </P>

<P> </P>

<P>If AC coupling is used it is to be considered part of the receiver for the purposes of this specification unless explicitly stated otherwise. It should be noted that various methods for AC coupling are allowed (for example, internal to the chip or done externally).  See  Section 8.5.13,  &quot;Termination  and  DC  Blocking&quot;  for  more information. </P>

<P> </P>

<P>10.5.2.2.6  Level II LR Receiver Input Lane-to-Lane Skew </P>

<P> </P>

<P>Lane-to-lane skew at the input to the receiver shall not exceed 70UI peak. See </P>

<P>Section 8.5.9, &quot;Receiver Input Lane-to-Lane Skew&quot;. </P>

<P> </P>

<P>10.5.2.2.7  Level II LR Receiver Input Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11, &quot;Differential Resistance and Return Loss, Transmitter and </P>

<P>Receiver&quot; for the reference model for return loss. See Table 10-18 for 5Gbaud and </P>

<P>6.25Gbaud short run receiver parameters. Definitions for these parameters are in </P>

<P>Figure 8-12. </P>

<P> </P>

<P>Table 10-18. Level II LR Input Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P>f1 </P>
</TD>

<TD>
<P>R_Baud/2 </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>16.6 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.5.2.2.8  Level II LR Receiver Jitter Tolerance </P>

<P> </P>

<P>As per Section 10.5.1.3, &quot;Level II LR Receiver Inter-operability&quot;, the receiver shall tolerate  at  least  the  far-end  jitter  requirements  as  given  in  Table 10-12  in combination with any compliant channel, as per Section 10.5.1.1, &quot;Level II LR Channel Compliance&quot;, with an additional SJ with any frequency and amplitude defined by the mask of Figure 8-9 where the minimum and maximum total wander amplitude are 0.05UIpp and 5UIpp respectively. This additional SJ component is intended to ensure margin for wander, hence is over and above any high frequency jitter from Table 10-12. </P>

<P> </P>

<P> </P>

<P>10.5.3  Level II LR Link and Jitter Budgets </P>

<P> </P>

<P>The primarily intended application is as a point-to-point interface of up to approximately 100cm and up to two connector between integrated circuits using controlled impedance traces on low-cost printed circuit boards (PCBs). Informative loss and jitter budgets are presented in Table 10-19 to demonstrate the feasibility of legacy  FR4  epoxy  PCB&#8217;s.  The  jitter  budget  is  given  in  Table 10-20.  The performance of an actual transceiver interconnect is highly dependent on the implementation. </P>

<P> </P>

<P>Table 10-19. Level II LR Informative Loss, Skew and Jitter Budget </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Description </P>
</TD>

<TD>
<P> </P>

<P>Loss (dB) </P>
</TD>

<TD>
<P> </P>

<P>Differential </P>

<P>Skew (ps) </P>
</TD>

<TD>
<P>Bounded High Probability (UIpp) </P>
</TD>

<TD>
<P> </P>

<P>TJ (UIpp) </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>15 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>0.30 </P>
</TD>
</TR>

<TR>
<TD>
<P>Interconnect (with Connector) </P>
</TD>

<TD>
<P>15.9 </P>
</TD>

<TD>
<P>25 </P>
</TD>

<TD>
<P>0.35 </P>
</TD>

<TD>
<P>0.513 </P>
</TD>
</TR>

<TR>
<TD>
<P>Other </P>
</TD>

<TD>
<P>4.5 </P>
</TD>

<TD/>

<TD>
<P>0.10 </P>
</TD>

<TD>
<P>0.262 </P>
</TD>
</TR>

<TR>
<TD>
<P>Total </P>
</TD>

<TD>
<P>20.4 </P>
</TD>

<TD>
<P>40 </P>
</TD>

<TD>
<P>0.60 </P>
</TD>

<TD>
<P>0.875 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 10-20. Level II LR High Frequency Jitter Budget </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P>CEI-6G-LR </P>
</TD>

<TD>
<P>Uncorrelated Jitter </P>
</TD>

<TD>
<P>Correlated Jitter </P>
</TD>

<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Amplitude </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>

<P>Unbounded </P>

<P>Gaussian </P>
</TD>

<TD>
<P> </P>

<P>High </P>

<P>Probability </P>
</TD>

<TD>
<P> </P>

<P>Bounded </P>

<P>Gaussian </P>
</TD>

<TD>
<P>Bounded High Probability </P>
</TD>

<TD>
<P> </P>

<P>Gaussian </P>
</TD>

<TD>
<P> </P>

<P>Sinusoidal </P>
</TD>

<TD>
<P>Bounded High Probability </P>
</TD>

<TD>
<P> </P>

<P>Total </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>Abbreviation </P>
</TD>

<TD>
<P>UUGJ </P>
</TD>

<TD>
<P>UHPJ </P>
</TD>

<TD>
<P>CBGJ </P>
</TD>

<TD>
<P>CBHPJ </P>
</TD>

<TD>
<P>GJ </P>
</TD>

<TD>
<P>SJ </P>
</TD>

<TD>
<P>HPJ </P>
</TD>

<TD>
<P>TJ </P>
</TD>

<TD>
<P>k </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Units </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.300 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>800.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Channel </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.230 </P>
</TD>

<TD>
<P>0.525 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Receiver Input </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.230 </P>
</TD>

<TD>
<P>0.525 </P>
</TD>

<TD>
<P>0.275 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.675 </P>
</TD>

<TD>
<P>0.950 </P>
</TD>

<TD>
<P>0.00 </P>
</TD>

<TD>
<P>0.02 </P>
</TD>
</TR>

<TR>
<TD>
<P>Equalizer </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-0.3501 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Post Equalization </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.230 </P>
</TD>

<TD>
<P>0.175 </P>
</TD>

<TD>
<P>0.275 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.325 </P>
</TD>

<TD>
<P>0.60 </P>
</TD>

<TD>
<P>0.20 </P>
</TD>

<TD>
<P>100.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>DFE Penalties </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-0.08 </P>
</TD>

<TD>
<P>-45.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock + Sampler </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-45.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Budget </P>
</TD>

<TD>
<P>0.212 </P>
</TD>

<TD>
<P>0.250 </P>
</TD>

<TD>
<P>0.230 </P>
</TD>

<TD>
<P>0.375 </P>
</TD>

<TD>
<P>0.313 </P>
</TD>

<TD>
<P>0.050 </P>
</TD>

<TD>
<P>0.625 </P>
</TD>

<TD>
<P>0.988 </P>
</TD>

<TD>
<P>0.06 </P>
</TD>

<TD>
<P>10.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. Due to receiver equalization, it reduces the ISI as seen inside the receiver. Thus this number is negative. </P>

<P>2. It is assumed that the eye is closed at the receiver, hence receiver equalization is required as indicated below. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>10.5.4  Level II LR StatEye.org Template </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% example template for setting up a standard, i.e. equalizer </P>

<P>% jitter and return loss </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>param.version = [param.version &#8217;_v1.0&#8217;]; </P>

<P>% these are internal variables and should not be changed param.scanResolution = 0.01; </P>

<P>param.binsize = 0.0005; </P>

<P>param.points = 2^13; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the transmitter and baud rate. The tx filter has two </P>

<P>% parameters defined for the corner frequency of the poles </P>

<P> </P>

<P>param.bps = 6.25e9; param.bitResolution = 1/(4*param.bps); param.txFilter = &#8217;twopole&#8217;; param.txFilterParam = [0.75 0.75]; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the return loss up. The return loss can be turned off </P>

<P>% using the appropriate option </P>

<P> </P>

<P>param.returnLoss = &#8217;on&#8217;; </P>

<P>param.cpad = 1.00; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the transmitter emphasis up. Some example setting are </P>

<P>% included which can be uncommented </P>

<P> </P>

<P>% single tap emphasis </P>

<P>param.txpre = [-0.1]; param.signal = 1.0; param.txpost = []; param.vstart = [-0.3 -0.3]; param.vend = [+0.0 +0.0]; </P>

<P>param.vstep = [0.1 0.05 0.025]; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the de-emphasis of 4-point transmit pulse </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>% the de-emphasis run if param.txpre = [] and param.txpost = [] </P>

<P> </P>

<P>param.txdeemphasis = [1 1 1 1]; % de-emphasis is off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the data coding changing the transmit pulse spectrum </P>

<P>% the coding run if param.txpre = [] and param.txpost = [] </P>

<P> </P>

<P>param.datacoding = 1; % the coding is off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set PAM amplitude and rate </P>

<P> </P>

<P>param.PAM = 2; % PAM is switched off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% the rxsample point does not need to be changed as it is </P>

<P>% automatically adjusted by the optimization scripts. </P>

<P>% The number of DFE taps should be set, however, the initial </P>

<P>% conditions are irrelevant. </P>

<P> </P>

<P>param.rxsample = -0.1; </P>

<P> </P>

<P>param.dfe = [0.3 0.1 0.1 0.1 0.1]; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P>% sampling jitter in HPJpp and GJrms is defined here param.txdj = 0.15; </P>

<P>param.txrj = 0.15/(2*7.94); </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% the following options are not yet implemented and should </P>

<P>% not be changed </P>

<P> </P>

<P>param.user = [0.0]; param.useuser = &#8217;no&#8217;; param.usesymbol = &#8217;&#8217;; param.xtAmp = 1.0; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>param.TransmitAmplitude = 0.800; % mVppdif param.MinEye = 0.100; % mVppdif </P>

<P> </P>

<P>param.Q = 2*7.94; </P>

<P>param.maxDJ = 0.325; </P>

<P> </P>

<P>RapidIO Trade Association 299 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>param.maxTJ            = 0.60; </P>

<P> </P>

<P> </P>

<P>10.6 Level II Medium Run Interface General </P>

<P>Requirements </P>

<P> </P>

<P> </P>

<P>10.6.1  Medium Run Jitter and Inter-operability Methodology </P>

<P> </P>

<P>The LP-Serial 5Gbaud and 6.25Gbaud short run interfaces use Method C, described in CEI clause 2.4. This section defines the inter-operability methodology specifically for interfaces where transmit emphasis may be used and the receiver eye requires linear equalization (from channel inter-operability point of view) to be open to within the BER of interest. </P>

<P> </P>

<P>10.6.1.1  Level II Medium Run Channel Compliance </P>

<P> </P>

<P>The following steps shall be made to identify which channels are to be considered compliant: </P>

<P>1. The forward channel and significant crosstalk channels shall be measured using a network analyzer for the specified baud rate (see CEI </P>

<P>Section 10.7.4.5, &quot;Network Analysis Measurement&quot; for a suggested method). </P>

<P>2. A single pre or post tap transmitter with &lt;= 6dB of emphasis, with infinite precision accuracy. </P>

<P>3. A Tx edge rate filter: simple 40dB/dec low pass at 75% of baud rate, this is to emulate both Rx and Tx -3dB bandwidths at 3/4 baud rate. </P>

<P>4. A transmit amplitude of 800mVppd. </P>

<P>5. Additional Uncorrelated Bounded High Probability Jitter of 0.15UIpp </P>

<P>(emulating part of the Tx jitter). </P>

<P>6. Additional Uncorrelated Unbounded Gaussian Jitter of 0.15UIpp (emulating part of the Tx jitter). </P>

<P>7. The reference transmitter shall use the worst case transmitter return loss at the baud frequency. In order to construct the worse case transmitter return loss, the reference transmitter should be considered to be a parallel R and C, where R is the defined maximum allowed DC resistance of the interface and C is increased until the defined maximum Return Loss at the baud frequency is reached. The transmitter return loss is specified in Section 10.6.2.1.6, &quot;Level II MR Transmitter Output Resistance and Return Loss&quot;. </P>

<P>8. An ideal receiver filter of the form in Section 8.6.8, &quot;Time Continuous Zero/Pole&quot;. The reference receiver uses a continuous-time equalizer with 1 zero and 1 pole in the region of baudrate/100 to baudrate. Additional parasitic zeros and poles must be considered part of the receiver vendor&#8217;s device and </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>300 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>be dealt with as they are for the reference receiver. Pole and Zero values have infinite precision accuracy. Maximum required gain/attenuation shall be less than or equal to 4dB. </P>

<P>9. The reference receiver shall use the worst case receiver return loss at the baud frequency. In order to construct the worse case receiver return loss, the reference receiver should be considered to be a parallel R and C, where R is the defined maximum allowed DC resistance of the interface and C is increased until the defined maximum Return Loss at the baud frequency is reached. The receiver return loss is specified in Section 10.6.2.2.7, &quot;Level II MR Receiver Input Resistance and Return Loss&quot;. </P>

<P> </P>

<P>Table 10-21. Level II LR Receiver Equalization Output Eye Mask </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye mask </P>
</TD>

<TD>
<P>R_X1 </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye mask </P>
</TD>

<TD>
<P>R_Y1 </P>
</TD>

<TD>
<P>50 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Bounded High Probability Jitter </P>
</TD>

<TD>
<P>R_BHPJ </P>
</TD>

<TD>
<P>0.325 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10. Any parameters that have degrees of freedom (e.g. filter coefficients or sampling point) shall be optimized against the amplitude, at the zero phase offset, as generated by the Statistical Eye Output, e.g. by sweeping all degrees of freedom and selecting the parameters giving the maximum amplitude. A receiver return loss, as defined by the reference receiver, shall be used. </P>

<P>11. The opening of the eye shall be calculated using Statistical Eye Analysis methods, as per Section 8.7.5, &quot;Statistical Eye Methodology&quot;, and confirmed to be within the requirements of the equalized eye mask as specified in Table 10-12 at the required BER, 10-12. </P>

<P> </P>

<P>10.6.1.2  Level II MR Transmitter Inter-operability </P>

<P> </P>

<P>The following step shall be made to identify which transmitters are to be considered compliant: </P>

<P>1. It shall be verified that the measured eye is equal or better than the calculated eye for the given measurement probability Q (see Annex B.3, &#8220;Eye Mask Adjustment for Sampling Oscilloscopes&quot; for a suggested method of calculating Q given a measurement population), given: </P>

<P>&#8211; A &#8220;compliance&#8221; channel as per Section 10.6.1.1, &quot;Level II Medium Run Channel Compliance&quot; that required at least half the maximum transmit emphasis with no receiver filtering to give an open eye. </P>

<P>&#8211; Using this channel the transmitter shall be then optimally adjusted and the resulting near-end eye measured (see Section 10.7.4.6, &quot;Eye Mask Measurement Setup&quot; for a suggested method). </P>

<P>&#8211; Using this channel the statistical eye shall then be calculated, as per Section 8.7.5, &quot;Statistical Eye Methodology&quot;, using the maximum defined transmit jitter and the actual transmitter's amplitude and emphasis. </P>

<P> </P>

<P>RapidIO Trade Association 301 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>If the transmit jitter or transmit eye mask is additionally defined then the following steps shall also be made to identify which transmitters are to be considered compliant: </P>

<P>1. The high frequency transmit jitter shall be within that specified (see </P>

<P>Section 10.7.1, &quot;High Frequency Transmit Jitter Measurement&quot; for suggested methods). </P>

<P> </P>

<P>The specified transmit eye mask shall not be violated (see Section 10.7.4.6, &quot;Eye Mask Measurement Setup&quot; for a suggested method) after adjusting the horizontal time positions for the measured time with a confidence level of 3 sigma (see Annex B.3, &#8220;Eye Mask Adjustment for Sampling Oscilloscopes&quot; for a suggested method). </P>

<P> </P>

<P>10.6.1.3  Medium Receiver Inter-operability </P>

<P> </P>

<P>The following step shall be made to identify which receivers are to be considered compliant: </P>

<P> </P>

<P>1. The DUT shall be measured to have a BER1 better than specified for a stressed signal (see Section 10.7.4.3, &quot;Jitter Tolerance with Defined ISI and no Relative Wander&quot; for a suggested method) with a confidence level of three sigma (see Annex B.2, &#8220;Confidence Level of Errors Measurement&quot; for a suggested method), given: </P>

<P>&#8211; The defined sinusoidal jitter mask for relative wander as per Section 8.4.5, &quot;Total Wander Mask&quot; with a high frequency relative wander and a maximum relative wander as defined in Section 10.5.2.2.8, &quot;Level II LR Receiver Jitter Tolerance&quot;. </P>

<P>&#8211; The specified amount of High Probability Jitter and Gaussian jitter as defined in </P>

<P>Section 10.5.2.2.8, &quot;Level II LR Receiver Jitter Tolerance&quot;. </P>

<P>&#8211; A compliance channel or filter as identified by Section 10.5.1.1, &quot;Level II LR Channel Compliance&quot;. </P>

<P>&#8211; An additive crosstalk signal of amplitude such that the resulting statistical eye, given the channel, jitter, and crosstalk, is as close as feasible in amplitude when compared to the defined minimum amplitude for channel compliance. </P>

<P> </P>

<P> </P>

<P>10.6.2  Level II MR Interface Electrical Characteristics </P>

<P> </P>

<P>The electrical interface is based on high speed low voltage logic with nominal differential impedance of &#61489;&#61488;&#61488;&#61527;&#61486; Connections are point-to-point balanced differential pair and signalling is unidirectional. </P>

<P> </P>

<P>10.6.2.1  Level II MR Transmitter Characteristics </P>

<P> </P>

<P>The key transmitter characteristics are summarized in Table 10-22 and Table 10-23 while the following sections fully detail all the requirements. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1244.jpg"/>
</Figure>

<P>1if the defined measurement BER is different to system required BER, adjustments to applied stressed eye TJ are necessary </P>

<P> </P>

<P>302 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 10-22. Level II MR Transmitter Output Electrical Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbols </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Tx Baud Rate (5Gbaud) </P>
</TD>

<TD>
<P>T_Baud </P>
</TD>

<TD>
<P>Section 10.6.2.1.2 </P>
</TD>

<TD>
<P>5.00 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>5.00 </P>
</TD>

<TD>
<P>5.00 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Tx Baud Rate (6.25Gbaud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P>6.25 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>6.25 </P>
</TD>

<TD>
<P>6.25 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Output Voltage </P>
</TD>

<TD>
<P>VO </P>
</TD>

<TD>
<P>Section 10.6.2.1.3 </P>
</TD>

<TD>
<P>-0.40 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>2.30 </P>
</TD>

<TD>
<P>Volts </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Differential voltage &#61472;&#61472;</P>

<P>(into floating load Rload=100&#61527;) </P>
</TD>

<TD>
<P>T_Vdiff </P>
</TD>

<TD>
<P>Section 10.6.2.1.31 </P>
</TD>

<TD>
<P>800 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1200 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>T_Rd </P>
</TD>

<TD>
<P>Section 10.6.2.1.6 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>Recommended output rise and fall times&#61472;&#61472;</P>

<P>(20% to 80%) </P>
</TD>

<TD>
<P>T_tr, T_tf </P>
</TD>

<TD>
<P>Section 10.6.2.1.4 </P>
</TD>

<TD>
<P>30 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Skew between signals comprising a differential pair </P>
</TD>

<TD>
<P>T_SKEWdiff </P>
</TD>

<TD>
<P>Section 10.6.2.1.5 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>15 </P>
</TD>

<TD>
<P>ps </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(100 MHz to 0.5*T_Baud) </P>
</TD>

<TD>
<P>T_SDD22 </P>
</TD>

<TD>
<P>Section 10.6.2.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Output Return Loss&#61472;&#61472;</P>

<P>(0.5*T_Baud to T_Baud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Common Mode Return Loss&#61472;&#61472;</P>

<P>(100MHz to 0.75 *T_Baud) </P>
</TD>

<TD>
<P>T_S11 </P>
</TD>

<TD>
<P>Section 10.6.2.1.6 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-6 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter Common Mode Noise </P>
</TD>

<TD>
<P>T_Ncm </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>5% of </P>

<P>T_Vdiff </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Output Common Mode Voltage </P>
</TD>

<TD>
<P>T_Vcm </P>
</TD>

<TD>
<P>Load Type 02 </P>

<P>Section 8.5.3 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1700 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Load Type 13,4 </P>

<P>Section 8.5.3 </P>
</TD>

<TD>
<P>630 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1100 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. The Transmitter must be capable of producing a minimum T_Vdiff greater than or equal to 800mVppd. In applications where the channel is better than the worst case allowed, a Transmitter device may be provisioned to produce T_Vdiff less than this </P>

<P>minimum value, but greater than or equal to 400mVppd, and is still compliant with this specification. </P>

<P>2. Load Type 0 with min T_Vdiff, AC-Coupling or floating load. </P>

<P>3. For Load Type 1: R_Zvtt &#61603; 30 &#61527;&#61499;&#61472;T_Vtt &amp; R_Vtt = 1.2V +5%/-8% </P>

<P>4. DC Coupling compliance is optional (Load Type 1). Only Transmitters that support DC coupling are required to meet this parameter. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 10-23. Level II MR Transmitter Output Jitter Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Conditions </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated High Probability Jitter </P>
</TD>

<TD>
<P>T_UHPJ </P>
</TD>

<TD>
<P>Section 10.6.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>Section 10.6.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>Section 10.6.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>Section 10.6.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>Section 10.6.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.40 </P>
</TD>

<TD>
<P>UI </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>Section 10.6.2.2.8 </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>Section 10.6.2.2.8 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>600 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>10.6.2.1.1  Level II MR Transmitter Test Load </P>

<P> </P>

<P>All transmitter characteristics should be implemented and measured to a differential impedance of &#61489;&#61488;&#61488;&#61527;&#61472;&#61617;1% at DC with a return loss of better than 20dB from baud rate divided by 1667 to 1.5 times the baud rate, unless otherwise noted. </P>

<P> </P>

<P>10.6.2.1.2  Level II MR Transmitter Baud Rate </P>

<P> </P>

<P>The baud rates are 5Gbaud and 6.25Gbaud with a tolerance of &#61617;100ppm. </P>

<P> </P>

<P>10.6.2.1.3  Level II MR Transmitter Amplitude and Swing </P>

<P> </P>

<P>Transmitter differential output amplitude shall be able to drive between 800 and </P>

<P>1200mVppd, inclusive, either with or without any transmit emphasis. DC referenced logic levels are not defined since the receiver must have high common mode impedance at DC. However, absolute transmitter output voltage shall be between </P>

<P>-0.1V and 1.9V, inclusive, with respect to local ground. See Figure 8-1 for an illustration of absolute transmitter output voltage limits and definition of differential peak-to-peak amplitude. </P>

<P> </P>

<P>10.6.2.1.4  Level II MR Transmitter Rise and Fall Times </P>

<P> </P>

<P>The recommended minimum differential rise and fall time is 30ps as measured between the 20% and 80% of the maximum measured levels; the maximum differential rise and fall times are defined by the Tx eye diagram (Figure 8-2 and Table 10-16).  Shorter  rise  and  falls  may  result  in  excessive  high  frequency components and increase EMI and cross talk. </P>

<P> </P>

<P>10.6.2.1.5  Level II MR Transmitter Differential Pair Skew </P>

<P> </P>

<P>The timing skew at the output of a Level II MR transmitter between the two signals that comprise a differential pair shall not exceed 15 ps at 5.0 Gbaud and 6.25 Gbaud. </P>

<P> </P>

<P>10.6.2.1.6  Level II MR Transmitter Output Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11, &quot;Differential Resistance and Return Loss, Transmitter and </P>

<P>Receiver&quot; for the reference model for return loss. See Table 10-15 for 5Gbaud and </P>

<P>6.25Gbaud long run transmitter parameters. Definitions for these parameters are in </P>

<P>Figure 8-12. </P>

<P> </P>

<P>Table 10-24. Level II MR Transmitter Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P>f1 </P>
</TD>

<TD>
<P>T_Baud/2 </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>16.6 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.6.2.1.7  Level II MR Transmitter Lane-to-Lane Skew </P>

<P> </P>

<P>The electrical level of lane-to-lane skew caused by the transmitter circuitry and associated routing must be less than 1000 ps for links of 4 lanes or less. Links with greater than 4 lanes must have lane-to-lane skew of less than 2UI + 1000 ps. The transmitter lane-to-lane skew is only for the serdes Tx and does not include any effects of the channel. </P>

<P> </P>

<P>10.6.2.1.8  Level II MR Transmitter Short Circuit Current </P>

<P> </P>

<P>The max DC current into or out of the transmitter pins when either shorted to each other or to ground shall be ±100mA when the device is fully powered up. From a hot swap point of view, the ±100mA limit is only valid after 10 &#61549;s. </P>

<P> </P>

<P>10.6.2.1.9  Level II MR Transmitter Template and Jitter </P>

<P> </P>

<P>The transmitter shall satisfy both the near-end eye template and jitter requirements as given in Figure 8-2, Figure 8-3, and Table 10-16 either with or without any transmit emphasis. </P>

<P>The maximum near-end duty cycle distortion (T_DCD) shall be less than 0.05UIpp. It should be noted that it is assumed the Uncorrelated High Probability Jitter </P>

<P>component of the transmitter jitter is not Inter-symbol Interference (ISI). This is only </P>

<P>assumed from a receiver point of view so that a receiver can&#8217;t equalize it and does not in any way put any restrictions on the real transmitter HPJ. </P>

<P> </P>

<P>Table 10-25. Level II MR Near-End Template Intervals </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristics </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Near-End Value </P>
</TD>

<TD>
<P>Units </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X1 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_X2 </P>
</TD>

<TD>
<P>0.40 </P>
</TD>

<TD>
<P>UI </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y1 </P>
</TD>

<TD>
<P>200 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>For connection &#61472;&#61472;</P>

<P>to short run Rx </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>400 </P>
</TD>

<TD/>

<TD>
<P>For connection &#61472;&#61472;</P>

<P>to long run Rx </P>
</TD>
</TR>

<TR>
<TD>
<P>Eye Mask </P>
</TD>

<TD>
<P>T_Y2 </P>
</TD>

<TD>
<P>375 </P>
</TD>

<TD>
<P>mV </P>
</TD>

<TD>
<P>For connection &#61472;&#61472;</P>

<P>to short run Rx </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>600 </P>
</TD>

<TD/>

<TD>
<P>For connection &#61472;&#61472;</P>

<P>to long run Rx </P>
</TD>
</TR>

<TR>
<TD>
<P>Uncorrelated Bounded High Probability </P>

<P>Jitter </P>
</TD>

<TD>
<P>T_UBHPJ </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Duty Cycle Distortion </P>
</TD>

<TD>
<P>T_DCD </P>
</TD>

<TD>
<P>0.05 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P>T_TJ </P>
</TD>

<TD>
<P>0.30 </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.6.2.2  Level II MR Receiver Characteristics </P>

<P> </P>

<P>The key receiver characteristics are summarized in Table 10-26 while the following sections fully detail all the requirements. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 10-26. Level II MR Receiver Electrical Input Specifications </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Characteristic </P>
</TD>

<TD>
<P>Symbol </P>
</TD>

<TD>
<P>Condition </P>
</TD>

<TD>
<P>Min </P>
</TD>

<TD>
<P>Typ </P>
</TD>

<TD>
<P>Max </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (5Gbaud) </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Section 10.6.2.2.1 </P>
</TD>

<TD>
<P>5.00 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>5.00 </P>
</TD>

<TD>
<P>5.00 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Rx Baud Rate (6.25Gbaud) </P>
</TD>

<TD/>

<TD/>

<TD>
<P>6.25 </P>

<P>-0.01% </P>
</TD>

<TD>
<P>6.25 </P>
</TD>

<TD>
<P>6.25 </P>

<P>+0.01% </P>
</TD>

<TD>
<P>Gbaud </P>
</TD>
</TR>

<TR>
<TD>
<P>Absolute Input Voltage </P>
</TD>

<TD>
<P>R_Vin </P>
</TD>

<TD>
<P>Section 10.6.2.2.4 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Input Differential voltage </P>
</TD>

<TD>
<P>R_Vdiff </P>
</TD>

<TD>
<P>Section 10.6.2.2.3 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1200 </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Resistance </P>
</TD>

<TD>
<P>R_Rdin </P>
</TD>

<TD>
<P>Section 10.5.2.2.7 </P>
</TD>

<TD>
<P>80 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>120 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>Bias Voltage Source Impedance &#61472;&#61472;</P>

<P>(load type 1)1 </P>
</TD>

<TD>
<P>R_Zvtt </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>30 </P>
</TD>

<TD>
<P>&#61527;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Input Return Loss&#61472;&#61472;</P>

<P>(100MHz to 0.5*R_Baud) </P>
</TD>

<TD>
<P>R_SDD11 </P>
</TD>

<TD>
<P>Section 10.6.2.2.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Differential Input Return Loss&#61472;&#61472;</P>

<P>(0.5*R_Baud to R_Baud)) </P>
</TD>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Common mode Input Return Loss&#61472;&#61472;</P>

<P>(100MHz to 0.5*R_Baud) </P>
</TD>

<TD>
<P>R_SCC11 </P>
</TD>

<TD>
<P>Section 10.6.2.2.7 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-6 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>Input Common Mode Voltage </P>
</TD>

<TD>
<P>R_Vfcm </P>
</TD>

<TD>
<P>Load Type 02 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>1800 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Load Type 11,3 </P>
</TD>

<TD>
<P>595 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>R_Vtt - </P>

<P>60 </P>
</TD>

<TD>
<P>mV </P>
</TD>
</TR>

<TR>
<TD>
<P>Wander divider (in Figure 8-8 &amp; Figure 8-9) </P>
</TD>

<TD>
<P>n </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>10 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. DC Coupling compliance is optional (Load Type 1). Only receivers that support DC coupling are required to meet this parameter. </P>

<P>2. Load Type 0 with min T_Vdiff, AC-Coupling or floating load. For floating load, input resistance must be &#61619;&#61472;1k&#61527;&#61472;</P>

<P>3. For Load Type 1: T_Vtt &amp; R_Vtt = 1.2V +5%/-8%. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>10.6.2.2.1  Level II MR Receiver Input Baud Rate </P>

<P> </P>

<P>All devices shall work at 5Gbaud, 6.25Gbaud or both baud rates with the baud rate tolerance as per Section 8.5.12, &quot;Baud Rate Tolerance&quot;. </P>

<P> </P>

<P>10.6.2.2.2  Level II MR Receiver Reference Input Signals </P>

<P> </P>

<P>Reference input signals to the receiver have the characteristics determined by the compliant  transmitter. The  reference  input  signal  must  satisfy  the  transmitter near-end template and jitter given in Figure 8-2, Figure 8-3, and Table 10-16, as well as the far-end eye jitter given in Table 10-20, with the differential load impedance of </P>

<P>&#61489;&#61488;&#61488;&#61527;&#61472;&#61617;&#61472;1% at DC with a return loss of better than 20dB from baud rate divided by </P>

<P>1667 to 1.5 times the baud rate. Note that the input signal might not meet either of these requirements when the actual receiver replaces this load. </P>

<P> </P>

<P>10.6.2.2.3  Level II MR Receiver Input Signal Amplitude </P>

<P> </P>

<P>The receiver shall accept differential input signal amplitudes produced by compliant transmitters connected without attenuation to the receiver. This may be larger than the 1200mVppd maximum of the transmitter due to output/input impedances and reflections. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>The minimum input amplitude is defined by the far-end transmitter template, the actual receiver input impedance, and the loss of the actual PCB. Note that the far-end transmitter template is defined using a well controlled load impedance, however the real receiver is not, which can leave the receiver input signal smaller than expected. </P>

<P> </P>

<P>10.6.2.2.4  Level II MR Receiver Absolute Input Voltage </P>

<P> </P>

<P>The absolute voltage levels with respect to the receiver ground at the input of the receiver are dependent on the transmitter implementation and the inter-ground difference. </P>

<P> </P>

<P>The voltage levels at the input of an AC coupled receiver (if the effective AC coupling is done within the receiver) or at the Tx side of the external AC coupling cap (if AC coupling is done externally) shall be between -0.15 and 1.95V, inclusive, with respect to local ground. </P>

<P> </P>

<P>10.6.2.2.5  Level II MR Receiver Input Common Mode Impedance </P>

<P> </P>

<P>The input common mode impedance (R_Zvtt) at the input of the receiver is dependent on whether the receiver is AC or DC coupled. The value of R_Zvtt as measured at the input of an AC coupled receiver is undefined. The value of R_Zvtt as measured at the input of a DC coupled receiver is defined as per Table 10-17. </P>

<P> </P>

<P>If AC coupling is used it is to be considered part of the receiver for the purposes of this specification unless explicitly stated otherwise. It should be noted that various methods for AC coupling are allowed (for example, internal to the chip or done externally).  See  Section 8.5.13,  &quot;Termination  and  DC  Blocking&quot;  for  more information. </P>

<P> </P>

<P>10.6.2.2.6  Level II MR Receiver Input Lane-to-Lane Skew </P>

<P> </P>

<P>Lane-to-lane skew at the input to the receiver shall not exceed 70UI peak. See </P>

<P>Section 8.5.9, &quot;Receiver Input Lane-to-Lane Skew&quot;. </P>

<P> </P>

<P>10.6.2.2.7  Level II MR Receiver Input Resistance and Return Loss </P>

<P> </P>

<P>Refer to Section 8.5.11, &quot;Differential Resistance and Return Loss, Transmitter and </P>

<P>Receiver&quot; for the reference model for return loss. See Table 10-27 for 5Gbaud and </P>

<P>6.25Gbaud short run receiver parameters. Definitions for these parameters are in </P>

<P>Figure 8-12. </P>

<P> </P>

<P>Table 10-27. Level II MR Input Return Loss Parameters </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Parameter </P>
</TD>

<TD>
<P>Value </P>
</TD>

<TD>
<P>Units </P>
</TD>
</TR>

<TR>
<TD>
<P>A0 </P>
</TD>

<TD>
<P>-8 </P>
</TD>

<TD>
<P>dB </P>
</TD>
</TR>

<TR>
<TD>
<P>f0 </P>
</TD>

<TD>
<P>100 </P>
</TD>

<TD>
<P>MHz </P>
</TD>
</TR>

<TR>
<TD>
<P>f1 </P>
</TD>

<TD>
<P>R_Baud/2 </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>f2 </P>
</TD>

<TD>
<P>R_Baud </P>
</TD>

<TD>
<P>Hz </P>
</TD>
</TR>

<TR>
<TD>
<P>Slope </P>
</TD>

<TD>
<P>16.6 </P>
</TD>

<TD>
<P>dB/dec </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>10.6.2.2.8  Level II MR Receiver Jitter Tolerance </P>

<P> </P>

<P>As per Section 10.5.1.3, &quot;Level II LR Receiver Inter-operability&quot;, the receiver shall tolerate  at  least  the  far-end  jitter  requirements  as  given  in  Table 10-12  in combination with any compliant channel, as per Section 10.5.1.1, &quot;Level II LR Channel Compliance&quot;, with an additional SJ with any frequency and amplitude defined by the mask of Figure 8-8 where the minimum and maximum total wander amplitude are 0.05UIpp and 5UIpp respectively. This additional SJ component is intended to ensure margin for wander, hence is over and above any high frequency jitter from Table 10-12. </P>

<P> </P>

<P> </P>

<P>10.6.3  Level II MR Link and Jitter Budgets </P>

<P> </P>

<P>The primarily intended application is as a point-to-point interface of up to approximately 60cm and up to two connector between integrated circuits using controlled impedance traces on low-cost printed circuit boards (PCBs). Informative loss and jitter budgets are presented in Table 10-19 to demonstrate the feasibility of legacy  FR-4  epoxy  PCB&#8217;s.  The  jitter  budget  is  given  in  Table 10-20.  The performance of an actual transceiver interconnect is highly dependent on the implementation. </P>

<P> </P>

<P>Table 10-28. Level II MR Informative Loss, Skew and Jitter Budget </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Description </P>
</TD>

<TD>
<P> </P>

<P>Loss (dB) </P>
</TD>

<TD>
<P> </P>

<P>Differential </P>

<P>Skew (ps) </P>
</TD>

<TD>
<P>Bounded High Probability (UIpp) </P>
</TD>

<TD>
<P> </P>

<P>TJ (UIpp) </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>15 </P>
</TD>

<TD>
<P>0.15 </P>
</TD>

<TD>
<P>0.30 </P>
</TD>
</TR>

<TR>
<TD>
<P>Interconnect (with Connector) </P>
</TD>

<TD>
<P>15.9 </P>
</TD>

<TD>
<P>25 </P>
</TD>

<TD>
<P>0.35 </P>
</TD>

<TD>
<P>0.513 </P>
</TD>
</TR>

<TR>
<TD>
<P>Other </P>
</TD>

<TD>
<P>4.5 </P>
</TD>

<TD/>

<TD>
<P>0.10 </P>
</TD>

<TD>
<P>0.262 </P>
</TD>
</TR>

<TR>
<TD>
<P>Total </P>
</TD>

<TD>
<P>20.4 </P>
</TD>

<TD>
<P>40 </P>
</TD>

<TD>
<P>0.60 </P>
</TD>

<TD>
<P>0.875 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 10-29. Level II MR High Frequency Jitter Budget </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P>CEI-6G-LR </P>
</TD>

<TD>
<P>Uncorrelated Jitter </P>
</TD>

<TD>
<P>Correlated Jitter </P>
</TD>

<TD>
<P>Total Jitter </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Amplitude </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>

<P>Unbounded </P>

<P>Gaussian </P>
</TD>

<TD>
<P> </P>

<P>High </P>

<P>Probability </P>
</TD>

<TD>
<P> </P>

<P>Bounded </P>

<P>Gaussian </P>
</TD>

<TD>
<P>Bounded High Probability </P>
</TD>

<TD>
<P> </P>

<P>Gaussian </P>
</TD>

<TD>
<P> </P>

<P>Sinusoidal </P>
</TD>

<TD>
<P>Bounded High Probability </P>
</TD>

<TD>
<P> </P>

<P>Total </P>
</TD>

<TD/>
</TR>

<TR>
<TD>
<P>Abbreviation </P>
</TD>

<TD>
<P>UUGJ </P>
</TD>

<TD>
<P>UHPJ </P>
</TD>

<TD>
<P>CBGJ </P>
</TD>

<TD>
<P>CBHPJ </P>
</TD>

<TD>
<P>GJ </P>
</TD>

<TD>
<P>SJ </P>
</TD>

<TD>
<P>HPJ </P>
</TD>

<TD>
<P>TJ </P>
</TD>

<TD>
<P>k </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Units </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P>UIpp </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>mVppd </P>
</TD>
</TR>

<TR>
<TD>
<P>Transmitter </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.300 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>800.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Channel </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.230 </P>
</TD>

<TD>
<P>0.525 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Receiver Input </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.230 </P>
</TD>

<TD>
<P>0.525 </P>
</TD>

<TD>
<P>0.275 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.675 </P>
</TD>

<TD>
<P>0.950 </P>
</TD>

<TD>
<P>0.00 </P>
</TD>

<TD>
<P>0.02 </P>
</TD>
</TR>

<TR>
<TD>
<P>Equalizer </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-0.3501 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Post Equalization </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.230 </P>
</TD>

<TD>
<P>0.175 </P>
</TD>

<TD>
<P>0.275 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.325 </P>
</TD>

<TD>
<P>0.60 </P>
</TD>

<TD>
<P>0.20 </P>
</TD>

<TD>
<P>100.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>DFE Penalties </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-0.08 </P>
</TD>

<TD>
<P>-45.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Clock + Sampler </P>
</TD>

<TD>
<P>0.150 </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>0.100 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>-45.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Budget </P>
</TD>

<TD>
<P>0.212 </P>
</TD>

<TD>
<P>0.250 </P>
</TD>

<TD>
<P>0.230 </P>
</TD>

<TD>
<P>0.375 </P>
</TD>

<TD>
<P>0.313 </P>
</TD>

<TD>
<P>0.050 </P>
</TD>

<TD>
<P>0.625 </P>
</TD>

<TD>
<P>0.988 </P>
</TD>

<TD>
<P>0.06 </P>
</TD>

<TD>
<P>10.0 </P>
</TD>
</TR>

<TR>
<TD>
<P>NOTES: </P>

<P>1. Due to receiver equalization, it reduces the ISI as seen inside the receiver. Thus this number is negative. </P>

<P>2. It is assumed that the eye is closed at the receiver, hence receiver equalization is required as indicated below. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.6.4  Level II MR StatEye.org Template </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% example template for setting up a standard, i.e. equalizer </P>

<P>% jitter and return loss </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>param.version = [param.version &#8217;_v1.0&#8217;]; </P>

<P>% these are internal variables and should not be changed param.scanResolution = 0.01; </P>

<P>param.binsize = 0.0005; </P>

<P>param.points = 2^13; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the transmitter and baud rate. The tx filter has two </P>

<P>% parameters defined for the corner frequency of the poles </P>

<P> </P>

<P>param.bps = 6.25e9; param.bitResolution = 1/(4*param.bps); param.txFilter = &#8217;twopole&#8217;; param.txFilterParam = [0.75 0.75]; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the return loss up. The return loss can be turned off </P>

<P>% using the appropriate option </P>

<P> </P>

<P>param.returnLoss = &#8217;on&#8217;; </P>

<P>param.cpad = 1.0; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the transmitter emphasis up. Some example setting are </P>

<P>% included which can be uncommented </P>

<P> </P>

<P>% single tap emphasis </P>

<P>param.txpre = []; param.signal = 1.0; param.txpost = [-0.1]; param.vstart = [-0.3 -0.3]; param.vend = [+0.0 +0.0]; </P>

<P>param.vstep = [0.1 0.05 0.025]; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the de-emphasis of 4-point transmit pulse </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>% the de-emphasis run if param.txpre = [] and param.txpost = [] </P>

<P> </P>

<P>param.txdeemphasis = [1 1 1 1]; % de-emphasis is off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set the data coding changing the transmit pulse spectrum </P>

<P>% the coding run if param.txpre = [] and param.txpost = [] </P>

<P> </P>

<P>param.datacoding = 1; % the coding is off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% set PAM amplitude and rate </P>

<P> </P>

<P>param.PAM = 2; % PAM is switched off </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% the rxsample point does not need to be changed as it is </P>

<P>% automatically adjusted by the optimization scripts. </P>

<P>% The number of DFE taps should be set, however, the initial </P>

<P>% conditions are irrelevant. </P>

<P> </P>

<P>param.rxsample = -0.1; </P>

<P> </P>

<P>% no DFE </P>

<P>param.dfe = []; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% The CTE shall be controlled. </P>

<P> </P>

<P>param.cte = 1; % CTE setting &#8220;0&#8221; = off; &#8220;1&#8221; = on; </P>

<P>param.ctethresh = 3; % max gain; </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P>% sampling jitter in HPJpp and GJrms is defined here param.txdj = 0.15; </P>

<P>param.txrj = 0.15/(2*7.94); </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>% the following options are not yet implemented and should </P>

<P>% not be changed </P>

<P> </P>

<P>param.user = [0.0]; param.useuser = &#8217;no&#8217;; param.usesymbol = &#8217;&#8217;; param.xtAmp = 1.0; </P>

<P> </P>

<P>310 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </P>

<P> </P>

<P>param.TransmitAmplitude = 0.800; % mVppdif param.MinEye = 0.100; % mVppdif </P>

<P> </P>

<P>param.Q = 2*7.94; param.maxDJ = 0.325; param.maxTJ = 0.60; </P>

<P> </P>

<P> </P>

<P>10.7 Level II Measurement and Test Requirements </P>

<P> </P>

<P>All methodology described in this section is only relevant for verification of low level CDR functionality, and does not cover any required tests for protocol compliance, e.g. deskew. The methodology is based on the assumption that either an integrated BERT is present in the DUT or a loop or functionality for the attachment of external equipment. </P>

<P> </P>

<P> </P>

<P>10.7.1  High Frequency Transmit Jitter Measurement </P>

<P> </P>

<P>The following section describes various methods for measuring high frequency jitter, which depending upon the baud rate can be applied for various levels of accuracy. </P>

<P> </P>

<P>10.7.1.1  BERT Implementation </P>

<P> </P>

<P>Referring to Figure 10-4, this section describes test methodology based on bathtub extraction, which relies on equipment being available for the given baud rate. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>DUT </P>

<P>Differential to single </P>

<P>ended amp  + </P>

<P> </P>

<P> </P>

<P> </P>

<P>Golden PLL </P>

<P> </P>

<P> </P>

<P>Trigger </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Clock </P>

<P>Ref </P>

<P>Signal </P>

<P> </P>

<P>BERT </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1245.jpg"/>
</Figure>

<P>Figure 10-4. BERT with Golden PLL </P>

<P> </P>

<P>&#8226; This same methodology can be used by equalized transmitters by initially turning the equalization off, or by performing the measurement at the end of a golden channel. </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 311 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; The transmitter under test shall transmit the specified data pattern, while all other signals are active. </P>

<P>&#8211; The other channels can transmit the same pattern if they have at least a 16 bit offset with the channel under test. </P>

<P>&#8211; All links within a device under test to be active in both transmit and receive directions, and receive links are to use asynchronous clocks with respect to transmit links to maximum allowed ppm offset as specified in the protocol specifications. </P>

<P>&#8226; The data should be differentially analyzed using an external differential amp or differential input BERT and golden PLL. </P>

<P>&#8211; Use of single ended signals will give an inaccurate measurement and should not be used. </P>

<P>&#8211; The use of a balun will most likely degrade the signal integrity and is only recommended for 3Gbaud signalling when the balun is linear with a return loss of better than -15dB until three times the baud rate. </P>

<P>&#8226; Inherent bandwidth of clock reference inputs of the BERT should be verified, e.g. in the case of parBERTs. Additional bandwidth limitation of the BERT will lead to inaccurate results. </P>

<P>&#8226; The use of a golden PLL is required to eliminate inherent clock content </P>

<P>(Wander) in transmitted data signals for long measurement periods. </P>

<P>&#8211; The golden PLL should have at maximum a bandwidth of baud rate over 1667, with a maximum of 20dB/dec rolloff, until at least baud rate over 16.67, with no peaking around the corner frequency. </P>

<P>&#8226; The output jitter for the DUT is not defined as the contributed jitter from the DUT but as the total output jitter including the contributions from the reference clock. To this end, the reference clock of the DUT should be verified to have a performance similar to the real application. </P>

<P>&#8226; A confidence level of three sigma should be guaranteed in the measurement of BER for the Bathtub as per Annex B.2, &#8220;Confidence Level of Errors Measurement&quot;.1 </P>

<P>&#8226; The High Probability and Gaussian Jitter components should be extracted from the bathtub measurement using the methodology defined in Section 8.7.4.6, &quot;BathTub Curves&quot;. </P>

<P>&#8226; If not defined the maximum Gaussian jitter is equal to the maximum total jitter minus the actual High Probability jitter. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1246.jpg"/>
</Figure>

<P>1It is assumed due to the magnitude of jitter present at the transmitter that the left and right hand parts of the bathtub are independent to each other </P>

<P> </P>

<P>312 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.7.1.2  Spectrum Analyzer and Oscilloscope Methodology </P>

<P>10.7.1.2.1  Band Limited1 Unbounded Gaussian Noise </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1247.jpg"/>
</Figure>

<P>Referring to Figure 10-5, blandishment or high frequency Gaussian noise can be measured at the transmitter of the DUT accurately using a high frequency 101010 pattern and measuring the spectral power2. In Figure 10-5 the clock reference is such that its power noise represents the typical power noise of the reference in the system. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P>DUT </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>Clock </P>

<P>Reference (a) </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Spectrum </P>

<P>Analysi ser </P>

<P> </P>

<P>Di fferenti al to si ngle ended amplifier </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 10-5. Spectral Measurement Setup </P>

<P> </P>

<P>The spectral power is calculating by integrating over the frequency band of interest and converting into time jitter. </P>

<P> </P>

<P> </P>

<P>100f2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1248.jpg"/>
</Figure>

<P>------ 2 1 &#61604; f1 &#61655; j &#61655; f </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1249.jpg"/>
</Figure>

<Textbox>
<P>1 </P>
</Textbox>

<Textbox>
<P>&#61682;&#61472;</P>
</Textbox>

<P>P----(--f--)  </P>

<P>10 </P>

<P>&#61556;rms  =  2&#61552;&#61472;</P>

<P>&#61655;&#61472;</P>

<P>&#61480; 1 + j &#61655; f &#61604; f </P>

<P> </P>

<P>&#61481;&#61480; 1 + j &#61655; f &#61604; f </P>

<P>&#61655; 10 </P>

<P>&#61481;&#61472;</P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1250.jpg"/>
</Figure>

<P>-------------------------------------------------------------- </P>

<P> </P>

<P> </P>

<P>where </P>

<P> </P>

<P>&#61556;rms is the time jitter </P>

<P>1 2 </P>

<P>f1 &#61604; 100 </P>

<P>P(f)  is the measured spectral power for 1Hz Bandwidth </P>

<P> </P>

<P>It should be noted that the measured Gaussian noise for a driver can usually be considered equivalent to that derived from a full bathtub jitter distribution. </P>

<P> </P>

<P>10.7.1.2.2  Band Limited 60 Second Total Jitter Measurements </P>

<P> </P>

<P>In certain CEI-11G-SR applications total jitter measurements of 60 seconds are required. The Gaussian Jitter, as measured above, should be multiplied by a Q of </P>

<P>6.963. If spurs are present in the spectrum then these must be converted to time jitter </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1251.jpg"/>
</Figure>

<P>1Normal CEI application will integrate from the defined ideal CDR bandwidth to infinity, while some CEI-11G-SR application will integrate over a specific band </P>

<P>2The spectral power should be measured using averaging </P>

<P>3Traditional measurements are performed for 60 seconds using a demodulator and performing a real time peak to peak measurement of the jitter. Given this, the number of bits transmitter across the link in 60 seconds is calculated and the associated three sigma confidence level, peak to peak multiplication </P>

<P>factor, Q, for the random jitter. </P>

<P> </P>

<P>RapidIO Trade Association 313 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>separately using an  inverse of  the  Bessel function as  per  Figure 10-6, which describes the power spectrum for a given phase modulated signal </P>

<P> </P>

<P>where </P>

<P> </P>

<P>F(Pn) </P>

<P> </P>

<P>is the inverse spectral SSB power to time modulation (below) </P>

<P> </P>

<P>&#61556;pkpk  = </P>

<P>2Q&#61556;rms + &#61669;F(Pn) </P>

<P>n </P>

<P>Pn is the relative SSB power of a spur. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Phase Modulation Power Spectrum </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1252.jpg"/>
</Figure>

<P>50 </P>

<P> </P>

<P> </P>

<P>45 </P>

<P> </P>

<P> </P>

<P>40 </P>

<P> </P>

<P> </P>

<Textbox>
<P>dBc </P>
</Textbox>

<P>35 </P>

<P> </P>

<P> </P>

<P>30 </P>

<P> </P>

<P> </P>

<P>25 </P>

<P> </P>

<P> </P>

<P>20 </P>

<P> </P>

<P> </P>

<P>15 </P>

<P>0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 </P>

<P>Modulation Index (UI) </P>

<P> </P>

<P> </P>

<P>Figure 10-6. Single Side Band Relative Power Spectrum for Phase Modulated Signal </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>314 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Phase Modulation Power Spectrum </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1253.jpg"/>
</Figure>

<P>50 </P>

<P> </P>

<P> </P>

<P>45 </P>

<P> </P>

<P> </P>

<P>40 </P>

<P> </P>

<P> </P>

<Textbox>
<P>dBc </P>
</Textbox>

<P>35 </P>

<P> </P>

<P> </P>

<P>30 </P>

<P> </P>

<P> </P>

<P>25 </P>

<P> </P>

<P> </P>

<P>20 </P>

<P> </P>

<P> </P>

<P>15 </P>

<P>0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 </P>

<P>Modulation Index (UI) </P>

<P> </P>

<P> </P>

<P>Figure 10-7. Single Side Band Relative Power Spectrum for Phase Modulated Signal </P>

<P> </P>

<P>10.7.1.2.3  Uncorrelated High Probability Jitter </P>

<P> </P>

<P>After measuring the Gaussian Jitter, as above, an oscilloscope measurement, as per Section 10.7.4.6, &quot;Eye Mask Measurement Setup&quot;, of the peak to peak jitter should be performed using a 101010 pattern. </P>

<P> </P>

<P>The Uncorrelated High Probability Jitter is then calculated by removing the accumulated Unbounded Gaussian jitter </P>

<P> </P>

<P>&#61556;UBHJ  = </P>

<P>&#61556;pkpk &#8211; 2Q&#61556;rms </P>

<P> </P>

<P>using a Q calculated for a 3 sigma confidence level1 as per Annex B.3, &#8220;Eye Mask </P>

<P>Adjustment for Sampling Oscilloscopes&quot;. </P>

<P> </P>

<P>10.7.1.2.4  Total High Probability Jitter </P>

<P> </P>

<P>After measuring the Unbounded Gaussian Jitter, as above, an oscilloscope measurement, as per Section 10.7.4.6, &quot;Eye Mask Measurement Setup&quot;, of the peak to peak jitter should be performed using the standard pattern e.g. PRBS31. </P>

<P> </P>

<P>The Total High Probability Jitter is then calculated by removing the accumulated </P>

<P>Gaussian jitter. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#61556;HPJ  = </P>

<P>&#61556;pkpk &#8211; 2Q&#61556;rms </P>

<P> </P>

<P>using a Q calculated for a 3 sigma confidence level1 as per Annex B.3, &#8220;Eye Mask </P>

<P>Adjustment for Sampling Oscilloscopes&quot;. </P>

<P> </P>

<P> </P>

<P>10.7.2  Total Transmit Wander Measurement </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1254.jpg"/>
</Figure>

<P>This  section  describes  the  total  transmit  wander  of  a  simple  non-equalized transmitter as depicted in Figure 10-8 below. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>DUT </P>

<P>Differential to single ended Amp </P>

<P> </P>

<P>Golden PLL </P>

<P> </P>

<P>1/n Scope </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P> </P>

<P>Clock Reference </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 10-8. Transmit Wander Lab Setup </P>

<P> </P>

<P>&#8226; The transmitter under test shall transmit the specified data pattern while all other signals are active. </P>

<P>&#8211; The other channels can transmit the same pattern if they have at least a 16 bit offset with the channel under test. </P>

<P>&#8211; All lanes to be active in both transmit and receive directions, and opposite ends of the link, i.e. transmit to receiver, are to use asynchronous clocks to maximum allowed ppm offset as specified in the protocol specifications. </P>

<P>&#8226; The transmitter can be tested single ended as high frequency jitter components are filtered by the golden PLL. </P>

<P>&#8226; Temperature and supply voltage should be cycled with a rate slower than baud rate over 166700Hz during test to exercise any delay components in the DUT. </P>

<P>&#8226; The inherent clock wander in signal shall be extracted using golden PLL and divided by the 1/n block, such as to limit the measured wander to 1UI at the divided frequency, and thus allowing it to be measured on an oscilloscope. </P>

<P>&#8211; The golden PLL should have at a minimum bandwidth of baud rate over 1667, with a maximum of 20dB/dec rolloff, until at least baud rate over 16.67, and is </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>suggested to have no peaking around the corner frequency. </P>

<P>&#8226; The peak to peak total wander of the extracted clock should be measured using a scope triggered by the reference clock. The measured peak to peak wander should be verified to be bounded by repeating the measurement for ever increasing periods of time until the measurement is constant. </P>

<P> </P>

<P> </P>

<P>10.7.3  Relative Transmit Wander Measurement </P>

<P> </P>

<P>This section describes specifically for SxI-5 interfaces, where limitations are defined in terms of relative wander between data lanes and clocks, whose relative wander can be measured as depicted below. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Golden PLL </P>

<P>1/n  Scope </P>

<P> </P>

<P> </P>

<P>DUT </P>

<P> </P>

<P>Tri gger </P>

<P> </P>

<P> </P>

<P> </P>

<P>Golden PLL </P>

<P>1/n </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Clock Reference </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1255.jpg"/>
</Figure>

<P>Figure 10-9. Relative Wander Lab Setup </P>

<P> </P>

<P>&#8226; The transmitter under test shall transmit the specified data pattern while all other signals are active. </P>

<P>&#8211; The other channels can transmit the same pattern if they have at least a 16 bit offset with the channel under test. </P>

<P>&#8211; All lanes to be active in both transmit and receive directions, and opposite ends of the link, i.e. transmit to receiver, are to use asynchronous clocks to maximum allowed ppm. offset as specified in the protocol specifications. </P>

<P>&#8211; The transmitters can be tested single ended as high frequency jitter components are filtered by the golden PLL. </P>

<P>&#8211; Temperature and supply voltage should be cycled with a rate slower than baud rate over 166700Hz during test to exercise any delay components in the DUT. </P>

<P>&#8211; The inherent clock wander in each signal shall be extracted using golden PLL and divided by the 1/n block, such as to limit the measured wander to 1UI at the divided frequency, and thus allowing it to be measured on an oscilloscope. </P>

<P>&#8211; The golden PLL should have at a minimum bandwidth of baud rate over 1667, with a maximum of 20dB/dec rolloff, until at least baud rate over 16.67, and is </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>suggested to have no peaking around the corner frequency. </P>

<P>&#8226; The peak to peak relative wander between the extracted clocks should be measured using a scope triggered by one of the extracted clocks. The measured peak to peak wander should be verified to be bounded by repeating the measurement for ever increasing periods of time until the measurement is constant. </P>

<P> </P>

<P> </P>

<P>10.7.4  Jitter Tolerance </P>

<P> </P>

<P>10.7.4.1  Jitter Tolerance with Relative Wander Lab Setup </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1256.jpg"/>
</Figure>

<P>The following section describes the required jitter tolerance methodology for devices where Relative Wander is applicable, e.g. SxI.5, and where no receive equalization is implemented. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>BERT transmitting defined test pattern </P>

<P>Data Output </P>

<P> </P>

<P>Voltage Controlled Delay Line </P>

<P> </P>

<P>Signal Filter for defining edge rate </P>

<P> </P>

<P>Clock Reference Input </P>

<P>Control Voltage </P>

<P>Inverted Input </P>

<P>DUT </P>

<P> </P>

<P>Voltage Controlle d De lay Line </P>

<P>Signal Filter for defining edge rate </P>

<P> </P>

<P>Control Voltage Input </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1257.jpg"/>
</Figure>

<P>Calibrated </P>

<P>Test Data </P>

<P> </P>

<P>DUT Clock </P>

<P>Reference </P>

<P>(100ppm offset to BERT) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+ </P>

<P>Jitter Control </P>

<P>Signal Filter </P>

<P>White Noise Source for generating Gaussian Jitter </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Clock </P>

<P>Reference </P>

<P>modulated by Common SJ Wander Source </P>

<P> </P>

<P>Jitter Control </P>

<P>Signal Filter </P>

<P>PRBS Generator for generating Uncorrelated High Probability Jitter </P>

<P> </P>

<P>Common SJ Wander Source, which together with Antiphase </P>

<P>generates Total Wander </P>

<P> </P>

<P>Antiphase SJ Wander Source for generating Relative Wander </P>

<P> </P>

<P> </P>

<P>Figure 10-10. Jitter Tolerance with Relative Wander Lab Setup </P>

<P> </P>

<P>10.7.4.1.1  General </P>

<P> </P>

<P>The transmitter under test shall transmit the specified data pattern while all other signals are active. </P>

<P> </P>

<P>&#8211; The other channels can transmit the same pattern if they have at least a 16 bit offset with the channel under test. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8211; All lanes to be active in both transmit and receive directions, and opposite ends of the link, i.e. transmit to receiver, are to use asynchronous clocks to maximum allowed ppm offset as specified in the protocol specifications. </P>

<P>&#8226; The DUT shall be tested using an internal BERT or loop to have the defined </P>

<P>BER performance. </P>

<P>&#8226; The confidence level of the BER measurement should be at least three sigma as per Annex B.2, &#8220;Confidence Level of Errors Measurement&quot;. </P>

<P> </P>

<P>10.7.4.1.2  Synchronization </P>

<P>&#8226; All lanes are to be active in both transmit and receive directions. </P>

<P>&#8226; All reference clocks should have the maximum offset frequency, with respect to each other, as defined in the CEI IA. </P>

<P> </P>

<P>10.7.4.1.3  Jitter </P>

<P>&#8226; The applied calibrated test signal shall have applied a calibrated amount of HF, GJ, and HPJ. </P>

<P>&#8226; The jitter control signal for generating High Probability Jitter should be filtered using at least a first order low pass filter with a corner frequency between </P>

<P>1/20 - 1/10 of the baud rate of the PRBS generator to ensure that high frequency components are removed. The distribution of the jitter after the filter must be reasonably even, symmetrical, and large spikes should be avoided. The order of the PRBS polynomial may be between 7 and 11, inclusive, to allow flexibility in meeting this objective. The rate of the PRBS generator should be between 1/10 - 1/3 of the data rate of the DUT, and their rates must be not harmonically related. The upper -3 dB frequency of the filtered HPJ should be at least 1/100 of the data rate of the DUT to represent transmitter jitter that is above the tracking frequencies of the DUT's CDR. Calibration of HPJ must be done with a golden PLL in place. Once these objectives are achieved, there is no need to vary these settings; any combination of settings that meets all the objectives is satisfactory. </P>

<P>&#8226; The jitter control signal for generating Unbounded Gaussian Jitter shall be filtered as per Figure 8-10 using the &#8220;Jitter Control Signal Filter&#8221;. However, the upper frequency of the Gaussian Jitter spectrum will be, acceptably, limited by the bandwidth of the voltage controlled delay line. The crest factor of the white noise generator should be better than 18dB. </P>

<P>&#8226; The calibrated test signal shall have a calibrated amount of Total Wander and Relative Wander as compared to the used clock by using the Common SJ Wander and Antiphase SJ Sources with 1% frequency offsets (note the use of the inverted input to the uppermost delay line) as per Section 8.7.2, &quot;Total Wander vs. Relative Wander&quot;. </P>

<P>&#8226; The amplitude of the Total Wander and Relative Wander is defined by the sinusoidal masks defined in Section 8.4.5, &quot;Total Wander Mask&quot; and Section 8.4.6, &quot;Relative Wander Mask&quot; with the specified amplitudes from the CEI IA. </P>

<P> </P>

<P>RapidIO Trade Association 319 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Wander should be applied </P>

<P>&#8211; from a frequency equivalent to 1UI of Total Jitter up to 20MHz modulation frequency. </P>

<P>&#8211; at a maximum of 2MHz frequency steps above the corner frequency. </P>

<P>&#8211; at a maximum of 200kHz frequency steps below the corner frequency. </P>

<P> </P>

<P>10.7.4.1.4  Amplitude </P>

<P>&#8226; The calibrated data signals should be filtered using single pole low pass filter with a corner frequency of 0.7 times the baud rate to define the edge rate. </P>

<P>&#8226; The amplitude of the signal should be adjusted such that it just passes the defined receiver data eye sensitivity. </P>

<P>&#8226; For testing of DC coupled receivers either a pattern generator capable of generating differential signals and setting the common mode should be used, or a combined AC coupled signal together with a biased-T. Using this setup the common mode should be varied between the defined maximum and minimum. </P>

<P> </P>

<P>10.7.4.2  Jitter Tolerance with no Relative Wander Lab Setup </P>

<P> </P>

<P>The following section describes the required jitter tolerance methodology for devices where Relative Wander is not applicable and no receive equalization is implemented. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>BERT </P>

<P>Data Output </P>

<P> </P>

<P>Voltage Controlled Delay Line </P>

<P>Signal Filter for defining edge rate </P>

<P> </P>

<P>DUT </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Clock </P>

<P>Reference </P>

<P>Clock Reference Input </P>

<P> </P>

<P> </P>

<P> </P>

<P>Wander can be optionally applied directly to FM input </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>+ </P>

<P>Jitter Control </P>

<P>Signal Filter </P>

<P> </P>

<P>Calibrated </P>

<P>Test Data </P>

<P> </P>

<P> </P>

<P>White Noise Source for generating Unbounded Gaussian Jitter </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Total </P>

<P>SJ Wander </P>

<P>Source </P>

<P> </P>

<P>Jitter Control </P>

<P>Signal Filter </P>

<P>PRBS Generator for generating uncorrelated High Probability Jitter </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1258.jpg"/>
</Figure>

<P>Figure 10-11. Jitter Tolerance with no Relative Wander </P>

<P> </P>

<P>Referring to  Figure 10-11, the  DUT shall  be  tested as  per  the  description in Section 10.7.4.1, &quot;Jitter Tolerance with Relative Wander Lab Setup&quot;, omitting any requirements relating to relative wander and where only Total Wander is applied via the SJ Source shown. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>10.7.4.3  Jitter Tolerance with Defined ISI and no Relative Wander </P>

<P> </P>

<P>The following section describes the required jitter tolerance methodology for devices where Relative Wander is not applicable, e.g. SxI.5, and where receive equalization is implemented and the performance of the equalization must be verified. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>BERT </P>

<P>Data Output </P>

<P>Voltage Controlled Delay Line </P>

<P>Signal Filter </P>

<P>for defining  + </P>

<P>edge rate </P>

<P> </P>

<P> </P>

<P>Compliant Channel or Filter </P>

<P> </P>

<P>DUT </P>

<P> </P>

<P>Clock Reference Input </P>

<P> </P>

<P> </P>

<P>Calibrated </P>

<P>Test Data </P>

<P> </P>

<P> </P>

<P> </P>

<P>Sinusoidal Noise Source for generating crosstalk </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Clock </P>

<P>Reference </P>

<P>Wander can be optionally applied directly to FM input </P>

<P>+ </P>

<P> </P>

<P> </P>

<P>Jitter Control </P>

<P>Signal Filter </P>

<P> </P>

<P>White Noise Source for generating Unbounded Gaussian Jitter </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Total </P>

<P>SJ Wander </P>

<P>Source </P>

<P> </P>

<P>Jitter Control </P>

<P>Signal Filter </P>

<P>PRBS Generator for generating Uncorrelated High Probability Jitter </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1259.jpg"/>
</Figure>

<P>Figure 10-12. Jitter Tolerance with Defined ISI </P>

<P> </P>

<P>Referring to  Figure 10-12, the  DUT shall  be  tested as  per  the  description in Section 10.7.4.1, &quot;Jitter Tolerance with Relative Wander Lab Setup&quot;, omitting any requirements relating to relative wander, and additionally: </P>

<P>&#8226; The transmit jitter and amplitude shall be initially calibrated as per </P>

<P>Section 10.7.1, &quot;High Frequency Transmit Jitter Measurement&quot; at the output of the delay line. </P>

<P>&#8226; A compliance channel shall be added. </P>

<P>&#8226; The defined amount of uncorrelated additive noise shall be applied via a sinusoidal source differentially to the signal. The frequency used shall be between 100MHz and the lesser of 1/4 the data rate and 2GHz. There is no need to sweep the frequency. </P>

<P> </P>

<P>10.7.4.4  Jitter Transfer </P>

<P> </P>

<P>This section describes how jitter transfer relevant interfaces can be tested for compliance: </P>

<P>&#8226; The BERT shall generate a data pattern as defined by the CEI IA. </P>

<P>&#8226; The jitter present before the delay line should be minimized so as to maximize any transfer bandwidth function of the DUT. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; A sinusoidal jitter should be applied following the same defined SJ mask as used for jitter tolerance and with the same resolution as described in Section 10.7.4, &quot;Jitter Tolerance&quot;. </P>

<P> </P>

<P>The peak to peak jitter for a 60 second period measured on the scope should be compared before and after the application of the sinusoidal jitter. The ratio of the difference to the jitter applied is then defined as the jitter transfer function. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P>BERT </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Wander can be </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P> </P>

<P>Clock </P>

<P>Reference </P>
</TD>

<TD>
<P>optionally applied directly to FM input </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Delay Line </P>

<P>DUT </P>

<P>Scope </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Total </P>

<P>SJ Wander </P>

<P>Source </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1260.jpg"/>
</Figure>

<P>Figure 10-13. Jitter Transfer Lab Setup </P>

<P> </P>

<P>10.7.4.5  Network Analysis Measurement </P>

<P> </P>

<P>To enable accurate analysis of a channel the following methodology should be followed for the measurement and calculation of the effective channel transfer function. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Term. </P>

<P>Forward </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1261.jpg"/>
</Figure>

<P>Channel </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1262.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1263.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Term. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1264.jpg"/>
</Figure>

<P>TxP,N RxP,N </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1265.jpg"/>
</Figure>

<P>Term. </P>

<P>Term. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1266.jpg"/>
</Figure>

<P>NEXT </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1267.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1268.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1269.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1270.jpg"/>
</Figure>

<P> </P>

<P>Term. </P>

<P>Term. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1271.jpg"/>
</Figure>

<P>Term. </P>

<P>RxP,N </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1272.jpg"/>
</Figure>

<P>Term. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1273.jpg"/>
</Figure>

<P>TxP,N </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1274.jpg"/>
</Figure>

<P>FEXT </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1275.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1276.jpg"/>
</Figure>

<P> </P>

<P>TxP,N </P>

<P>Term. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1277.jpg"/>
</Figure>

<P>Term. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1278.jpg"/>
</Figure>

<P>RxP,N </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1279.jpg"/>
</Figure>

<P>Term. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1280.jpg"/>
</Figure>

<P>Term. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1281.jpg"/>
</Figure>

<P>Figure 10-14. S-parameter Port Definitions </P>

<P> </P>

<P>&#8226; Figure 10-14 shows an overview of the termination and port definitions typically used when measuring the forward channel and NEXT/FEXT crosstalk aggressors. </P>

<P>&#8226; The intermediate frequency (IF) bandwidth should be set to a maximum of </P>

<P>300Hz with 100Hz preferred. The launch power shall be specified to the highest available leveled output power not to exceed 0dBm. </P>

<P>&#8226; Either direct differential measurements of the channel S21 and S11 should be performed or multiple single ended measurements from which the differential modes can be calculated.1 </P>

<P>&#8226; Linear frequency steps of the measurements shall be no larger than 12.5MHz. </P>

<P>&#8226; A frequency range from no higher than 100MHz to no lower than three times the fundamental frequency should be measured. </P>

<P>&#8226; Extrapolation towards DC should be performed linearly on magnitude part with the phase being extrapolated to zero at DC, i.e. only a real part is present at DC. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1282.jpg"/>
</Figure>

<P>1Special care must be taken when performing multiple single ended measurements if the system is tightly coupled </P>

<P> </P>

<P>RapidIO Trade Association 323 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; The channel response of the channel should be calculated by cascading the complete 4 port S-parameter matrix with a worst case transmitter and receiver. The transmitter/receiver should be described as a parallel R and C, where R is the defined maximum allowed DC resistance of the interface and C is increased until the defined maximum Return Loss at the defined frequency is reached. </P>

<P>&#8226; Any defined effective transmit or receiver filters should also be cascaded with the channel response. </P>

<P>&#8226; The time resolution should be increased by resampling the impulse response in the time domain. </P>

<P>&#8226; If required, interpolation of the frequency domain should be performed on the magnitude and unwrapped phase components of the channel response </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>where </P>

<P> </P>

<P>Tr(&#61559;) = </P>

<P>1 1 &#61636;&#61472;</P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1283.jpg"/>
</Figure>

<P>1 Tx22(&#61559;) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1284.jpg"/>
</Figure>

<P>S11(&#61559;) S21(&#61559;)  &#61636;&#61472;</P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1285.jpg"/>
</Figure>

<P>S12(&#61559;) S22(&#61559;) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1286.jpg"/>
</Figure>

<P>Rx11(&#61559;) 1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1287.jpg"/>
</Figure>

<P>1 1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1288.jpg"/>
</Figure>

<P> </P>

<P>Sm&#61484; n </P>

<P>Tx22 </P>

<P>Rx11 </P>

<P>Tr(&#61559;) </P>

<P> </P>

<P>is the measured 4 port differential data of the channel is the transmitter return loss </P>

<P>is the receiver return loss </P>

<P> </P>

<P>is the receiver return loss. </P>

<P> </P>

<P>Converting the original frequency range to time domain, we obtain </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>where </P>

<P>i(tm) = </P>

<P>ifft(Tr(&#61559;)) </P>

<P>&#61559; = [&#8211;3-- f </P>

<P>4 </P>

<P>,3-- f </P>

<P>baud 4 </P>

<P> </P>

<P>] </P>

<P>baud </P>

<P> </P>

<P> </P>

<P>10.7.4.6  Eye Mask Measurement Setup </P>

<P> </P>

<P>The measurement of an eye mask is defined by the various CEI IAs in terms of a polygon for the probability of the required Bit Error Rate. This polygon may have to be altered given that the sample population of the scope is limited and must be adjusted as per Annex B.3, &#8220;Eye Mask Adjustment for Sampling Oscilloscopes&quot;. For the measurement of the signal the laboratory setup shown in Figure 10-15 should  be  used,  including  the  recommendations list  in  Section 10.7.1,  &quot;High Frequency Transmit Jitter Measurement&quot;. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>DUT </P>

<P>Differential to single </P>

<P>ended amp  + </P>

<P> </P>

<P> </P>

<P> </P>

<P>Golden PLL </P>

<P> </P>

<P> </P>

<P>Trigger </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Clock </P>

<P>Ref </P>

<P>Signal </P>

<P> </P>

<P>Oscilloscope </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1289.jpg"/>
</Figure>

<P>Figure 10-15. Mask Measurement with Golden PLL </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex A Transmission Line Theory and </P>

<P>Channel Information (Informative) </P>

<P> </P>

<P> </P>

<P>A.1 Transmission Lines Theory </P>

<P> </P>

<P>The performance of a high frequency transmission line is strongly affected by impedance matching, high frequency attenuation and noise immunity. </P>

<P> </P>

<P>It is possible to design a high frequency transmission line using only a single conductor. Nevertheless, most high frequency signals use differential transmission lines (i.e. a pair of coupled conductors carrying signals of opposite polarity). Although differential signaling appears wasteful of both pins and signal traces it results in much better noise immunity. Differential signals produce less conducted noise because the opposite power and ground current flows cancel each other both in the line driver and in the transmission line. Differential signals produce less radiated noise because over a modest distance the opposite fields induced by the opposite currents cancel each other. Differential signals are less susceptible to noise because most sources of noise (common mode noise) tend to affect both signal lines identically, producing a variation in common mode voltage but not in differential voltage. </P>

<P> </P>

<P> </P>

<P>A.2 Impedance Matching </P>

<P> </P>

<P>The AC impedance of a single conductor is determined by the trace geometry, distance to the nearest AC ground plane(s) and the dielectric constant of the material between the trace and the ground plane(s). If the distance between the signal trace and the nearest ground plane is significantly less than the distance to other signal traces the signal trace will behave as a single-ended transmission line. Its AC impedance does not vary with signal polarity although it may vary with frequency due to the properties of the dielectric material. This impedance is often called single ended impedance, Zse. </P>

<P> </P>

<P>The AC impedance, Z of a differential transmission line is affected by the configuration of the pair of conductors and the relationship between their signal polarities, in addition to the trace geometry, distance to the nearest AC ground plane(s) and the dielectric constant of the material between the trace and the ground plane(s). If the paired conductors are close enough to interact (coupled), then the impedance for signals of opposite polarity (odd mode impedance, Zodd) will be lower than the impedance for signals of the same polarity (even mode impedance, </P>

<P> </P>

<P>RapidIO Trade Association 327 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Zeven). </P>

<P> </P>

<P>If there is minimal coupling between the paired conductors then Zodd = Zeven = Zse. Coupled transmission lines always produce Zodd &lt; Zse &lt; Zeven. The following equations relate effective differential impedance, Zdiff, to common mode impedance, Zcm, and single ended impedance, Zse, to even and odd mode impedances: </P>

<P> </P>

<P>Zdiff = </P>

<P> </P>

<P>2Zodd </P>

<P> </P>

<P>Zcm = </P>

<P> </P>

<P>Z----e---v---e---n-- </P>

<P>2 </P>

<P> </P>

<P>Zse= </P>

<P> </P>

<P>Z----e---v---e---n-----+-----Z----o---d----d- </P>

<P>2 </P>

<P> </P>

<P>Most differential data signals are designed with zdiff = 100&#61527; and 25&#61527;&#61472;&lt; Zcm &lt; 50&#61527;. </P>

<P> </P>

<P>There is a trade-off in the choice of Zcm. Zcm = 25&#61527; (no coupling) may reduce conducted noise for transmission lines with inadequate AC or DC grounding. Zcm </P>

<P>= 50&#61527; (close coupling) may reduce radiated noise (crosstalk) which is more critical in backplanes. However close coupling requires careful ground construction to control common mode noise. </P>

<P> </P>

<P>The reader may wonder why common mode impedance is meaningful in a differential transmission system. In a perfectly constructed system only odd mode (opposite polarity) signals propagate. However imperfections in the transmission system cause differential to common mode conversion. Once converted into common mode the energy may convert back to differential mode by the same imperfections. Thus, these imperfections convert some of the signal energy from opposite polarities to the same polarity and back. </P>

<P> </P>

<P>The two main sources of mode conversion are impedance mismatches which cause part of the energy to be reflected, and differential skew which causes variations in forward signal propagation delay between the individual paths of the differential pair. Impedance mismatches typically occur at boundaries between transmission line segments, including wire bonds, solder joints, connectors, vias, and trace-to-via transitions. Often ignored sources of impedance mismatches at these boundaries are discontinuities within the AC ground itself as well as asymmetric coupling between the individual traces and the AC ground. Differential skew can occur at these same boundaries and also due to mismatched trace lengths in device packages and in PCBs. </P>

<P> </P>

<P> </P>

<P>A.3 Impedance Definition Details </P>

<P> </P>

<P>Differential transmission lines consist of two conductors and a ground plane. The voltage-current relationships at one end of this line can be formulated in terms of a two-port as in Figure A-1. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>328 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1290.jpg"/>
</Figure>

<P>I1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1291.jpg"/>
</Figure>

<P>Conductor 1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1292.jpg"/>
</Figure>

<P>I2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1293.jpg"/>
</Figure>

<P>Conductor 2 </P>

<Textbox>
<P>V </P>
</Textbox>

<P>1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1294.jpg"/>
</Figure>

<P>V2 </P>

<P>Ground Plane </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1295.jpg"/>
</Figure>

<P>Transmission Line </P>

<P> </P>

<P>Figure A-1. Transmission Line as 2-port </P>

<P> </P>

<P> </P>

<P>The voltage current relationships are: </P>

<P> </P>

<P>V1  = </P>

<P>Z11 I1 + Z12 I2 </P>

<P>V2  = </P>

<P>Z21 I1 + Z22 I2 </P>

<P> </P>

<P>If the line is infinitely long or perfectly terminated, then these four impedance values are the characteristic impedance of the line. The characteristic impedance is a 2 x 2 matrix: </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1296.jpg"/>
</Figure>

<P>&#710; Z11  Z12 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1297.jpg"/>
</Figure>

<P>Zc  = </P>

<P> </P>

<P>Z21  Z22 </P>

<P> </P>

<P> </P>

<P>Generally, all four of the matrix entries are complex. But, at frequencies of interest, the inductance and capacitance per unit length dominate so that all four quantities are approximately real positive numbers. For engineering purposes it is common to speak of the impedances as though they are resistances with no imaginary part, keeping in mind that the imaginary part exists. Since the line is passive and symmetric, we have Z11 = Z22 and Z12 = Z21 so that the line is described by just two impedance values. If the line is to be perfectly terminated, then we must create a </P>

<Textbox>
<P>c </P>
</Textbox>

<P>network that is equivalent to Z&#710; . That is, we need a 3-terminal (2 nodes + ground) </P>

<P>network that presents the same values of Z11 and Z12 as the line. A T or pi network could be used. The pi network is shown in Figure A-2, along with the impedance values in terms of Z11 and Z12. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Za  =  Z + Z </P>

<P> </P>

<P>Z11 </P>

<P>&#61472;&#61472;</P>

<Textbox>
<P>&#8211; Z </P>
</Textbox>

<P>2 2 </P>

<P>12 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1298.jpg"/>
</Figure>

<P>I1  Za </P>

<P>11 12 </P>

<P>Zb  = </P>

<P>-------------------------- </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1299.jpg"/>
</Figure>

<P>Z </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Zodd = </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>------Z---a---Z---b------- = </P>

<P>2Za + Zb </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Z11 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>&#8211; Z12 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Zeven = </P>

<P>12 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Za= </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Z11 </P>

<P>I2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1300.jpg"/>
</Figure>

<P>V1 </P>

<P>V2 </P>

<P> </P>

<P>+ Z12 </P>

<P>Zb   Za </P>

<P> </P>

<P> </P>

<P>Figure A-2. Network Terminations </P>

<P> </P>

<P>The  odd  and  even  mode  impedances, Zodd  and  Zeven,  are  other  impedance </P>

<P> </P>

<P>RapidIO Trade Association 329 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>definitions that are more descriptive, referring to the polarity of the signal propagating the differential pair. In the case of opposite signal polarity in the two lines of the signal pair the odd mode impedance is used. In the case of same signal polarity the  even  mode  is  used.  Zodd  and  Zeven  are  measured as  shown  in Figure A-3. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1301.jpg"/>
</Figure>

<P>I </P>

<P>+ 1 </P>

<P> </P>

<P>I </P>

<P>- - 2 </P>

<P>V </P>

<P>+ gnd </P>

<P>+ 1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1302.jpg"/>
</Figure>

<P>V I </P>

<P>- + 2 </P>

<P>V </P>

<P>- gnd </P>

<P> </P>

<P>Figure A-3. Measurement of Zodd, Zeven </P>

<P> </P>

<P>Zodd Zeven &#61472;&#61472;</P>

<P>&#61472;&#61472;</P>

<P>V =  V1  = </P>

<P>&#61472;&#61472;</P>

<P>&#8211;V2 </P>

<P>V =  V1 </P>

<P>= V2 &#61472;&#61472;</P>

<P>I =  I1  = </P>

<P>&#61472;&#61472;</P>

<P>&#8211;I2 </P>

<P>I  = I1 </P>

<P>= I2 &#61472;&#61472;</P>

<P>Zodd  = </P>

<P>V--- I </P>

<P>Zeven = </P>

<P>V--- &#61472;&#61472;</P>

<P>I </P>

<P> </P>

<P>Odd mode impedance is the impedance measured when the two halves of the line are driven by equal voltage or current sources of opposite polarity. Even mode impedance is the impedance measured when the two halves of the line are driven by equal voltage or current sources of the same polarity. </P>

<P> </P>

<P>From the above equations we see that Zeven is always greater than Zodd by 2Z12, where Z12 is a measure of the amount of coupling between the lines. This means that Zeven is larger than Zodd for coupled transmission lines. </P>

<P> </P>

<P> </P>

<P>A.4 Density considerations </P>

<P> </P>

<P>The preceding section showed that, for two idealized forms of termination, Zodd is correctly terminated but Zeven is not. The first illustrated case, using a 50&#61527; resistor (or its equivalent) from either terminal to ground (or to AC ground), has become relatively standard. Because it has ZoddT = ZevenT = 50&#61527;, it provides correct differential termination and is often close to providing correct common-mode termination. </P>

<P> </P>

<P>By increasing the conductor spacing in the transmission line we can decrease Zeven (decrease Z12) and bring it closer to 50&#61527;. But dense backplanes require a large number of transmission lines per unit cross-sectional area of the printed circuit board. This means that the two printed circuit traces comprising the differential transmission line are forced close together, which increases Z12. The backplane design  is  therefore,  a  compromise  between  the  desire  for  high  density  of </P>

<P> </P>

<P>330 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>transmission lines and a desire for correct common-mode termination. </P>

<P> </P>

<P>Transmission lines act as low-pass filters due to skin effect and dielectric absorption. As the density of transmission lines increases, both the series resistance per unit length and the parallel conductance per unit length increase. This, in turn, results in greater attenuation at a given frequency. Thus, high speed backplane design is not just a compromise between density and common-mode matching. There is also a compromise between density and attenuation. </P>

<P> </P>

<P> </P>

<P>A.5 Common-Mode Impedance and Return Loss </P>

<P> </P>

<P>It is demonstrated above that increasing the density of transmission lines in a backplane results in higher common-mode impedance, which is known as interference, and for high amplitudes the receiver is likely to be disrupted. </P>

<P> </P>

<P>Common-mode interference arises from several sources. Among them are: </P>

<P> </P>

<P>1. Imperfections in driver circuits </P>

<P>2. A difference in length between the two conductors of the transmission line </P>

<P>3. Imperfections in impedance matching across board boundaries, connectors, and vias causing mode conversion, from differential to common mode </P>

<P>4. EMI </P>

<P> </P>

<P>The interference resulting from the driver probably has a spectrum that is the same as or similar to that of the signal. EMI arising from coupling into the printed circuit traces should be small, assuming that coupled stripline is used. However, connector pins may be exposed. EMI may have frequency components that are well below signal frequencies, which means that it won&#8217;t necessarily be attenuated to the extent that signals are. But, at the same time, the lower frequencies are probably poorly coupled into the backplane circuit. </P>

<P> </P>

<P>Earlier, two ideal forms of termination were presented based on either one or two resistors. These ideal terminating devices are helpful in examining the relationship between the parameters of the transmission line versus those of the device. Real devices, however, are not simple resistances. They contain parasitic components and a non-ideal path from package pins to die. There may also be a need to AC-couple the terminations. </P>

<P> </P>

<P>The most that can be done in this situation is to make the package and the die appear as close to ideal as possible over as much of the signal spectrum as possible. The extent of the deviation from ideal is specified and measured as a function of frequency. The preferred measures are S11 (single-ended return loss) or SDD11 (differential return loss) as functions of frequency. (Sometimes S22  or SDD22  are used to indicate an output.) Ideally these return losses are 0 (no reflection) over the frequency range of interest. In dB this is -&#61605;. </P>

<P> </P>

<P>Note: Sometimes a return loss is specified as a positive number, it being understood </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 331 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>that this still refers to the log of a reflection coefficient in the range of 0 to 1. </P>

<P> </P>

<P> </P>

<P>A.6 Crosstalk Considerations </P>

<P> </P>

<P>This implementation assumes that the dominant cross talk can come from aggressors other than the transmitter associated with the receiver. Hence NEXT cancellation is not useful. </P>

<P> </P>

<P>Crosstalk between channels should be minimized by good design practices. This includes the pin-out arrangement to the driving/receiving ICs, connectors and backplane tracking. </P>

<P> </P>

<P>Optimum arrangement for minimizing crosstalk between channels at IC pins is illustrated in Figure A-4 below. Crosstalk between channels can be reduced by grouping TX and RX pins and avoiding close proximity between individual TX and Rx pins. This practice will minimize coupling of noise from TX drivers into RX inputs. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1303.jpg"/>
</Figure>

<P>Diff pair </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chip </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Rx </P>

<P>Tx </P>

<P>Rx         Can increase cross talk </P>

<Textbox>
<P>Rx </P>
</Textbox>

<P>Tx        due to Tx beside an Rx, </P>

<P>Tx          yet is good to allow for </P>

<Textbox>
<P>Tx </P>
</Textbox>

<P>Rx         loopback debug testing </P>

<P>Rx </P>

<P>Tx </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chip </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Rx </P>

<P>Rx </P>

<P>Rx        Best for cross talk prevention </P>

<Textbox>
<P>Rx </P>
</Textbox>

<P>Rx due to separating Rx and Tx, but harder to design in </P>

<Textbox>
<P>Tx </P>
</Textbox>

<P>Tx        loopback debug testing </P>

<P>Tx Tx Tx </P>

<P> </P>

<P>Figure A-4. Minimization of Crosstalk at IC Pins </P>

<P> </P>

<P>Crosstalk at connector pins can be minimized by careful optimization of connections as shown in Figure A-5 below. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1304.jpg"/>
</Figure>

<P>Diff pair </P>

<P>single trace </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1305.jpg"/>
</Figure>

<P>Rx </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1306.jpg"/>
</Figure>

<P>Rx </P>

<Textbox>
<P>Rx </P>
</Textbox>

<P>Rx    Best for crosstalk prevention Tx    due to separating Rx and Tx, Tx    but might be harder to route </P>

<Textbox>
<P>Tx </P>
</Textbox>

<P>Tx </P>

<P> </P>

<P>Poor design for crosstalk prevention </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1307.jpg"/>
</Figure>

<P>Rx </P>

<Textbox>
<P>Rx </P>
</Textbox>

<P>Tx    due to Tx beside an Rx, </P>

<P>Tx    Might be easier to route. </P>

<P>Rx    Note quite a lot of the crosstalk is in </P>

<Textbox>
<P>Rx </P>
</Textbox>

<P>Tx    the via&#8217;s, while routing and internal </P>

<P>Tx    parts of the connector cause the rest </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure A-5. Minimization of Crosstalk At Connector Pins </P>

<P> </P>

<P>Crosstalk between channels over a backplane can be minimized by careful arrangement of tracking, avoiding coupling of noise into RX inputs and increasing spacing &#8220;d&#8221; between channels as far as possible as shown in Figure A-6 below. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1308.jpg"/>
</Figure>

<P>Making &quot;d&quot; larger reduces d  cross talk, but eats up </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1309.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1310.jpg"/>
</Figure>

<Textbox>
<P>Cross Talk </P>
</Textbox>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1311.jpg"/>
</Figure>

<P>PCB area </P>

<P> </P>

<P>d </P>

<P> </P>

<P>Figure A-6. Minimization of Crosstalk Over Backplane </P>

<P> </P>

<P>A.7 Equation Based Channel Loss by Curve Fit </P>

<P> </P>

<P>This section describes a technique with specific limitations. It does not include any phase data for the SDD21, and includes no return loss information about SDD11 or SDD22, information that is critical for the evaluation of a specific topology's performance. The preceding proposed statistical-eye characterization includes these effects by including the full 4-port s-parameter measurements. The following method is included for information only and is believed to be of relevance to the overall understanding of the channel transfer loss. </P>

<P> </P>

<P>One way to specify the channel loss is to have an average or worst case &#8220;curve&#8221; fit to several real channels. This method includes effects of real vias and connectors. This method typically uses the equation below: </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Att </P>

<P>&#61501; &#61485;20 * log(e) * &#61480;a  * </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1312.jpg"/>
</Figure>

<P>f  &#61483; a2 * f </P>

<P> </P>

<P>&#61483; a3 * </P>

<P>f 2 &#61481;&#61472;</P>

<P> </P>

<Textbox>
<P>1 </P>
</Textbox>

<P>Where f is frequency in Hz, a1, a2, and a3 are the curve fit coefficients and Att is in dB. </P>

<P> </P>

<P>Table A-1 gives some examples of these coefficients and Figure A-7 plots them along with the PCB model and a real 75cm backplane with 5cm paddle cards on both ends. These examples are representative of Level II LR applications but do not represent specifications that a RapidIO link is to comply with. </P>

<P> </P>

<P>Table A-1. Curve fit Coefficients </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Channel </P>
</TD>

<TD>
<P>a1 </P>
</TD>

<TD>
<P>a2 </P>
</TD>

<TD>
<P>a3 </P>
</TD>
</TR>

<TR>
<TD>
<P>sRIO1 (50cm) </P>
</TD>

<TD>
<P>6.5e-6 </P>
</TD>

<TD>
<P>2.0e-10 </P>
</TD>

<TD>
<P>3.3e-20 </P>
</TD>
</TR>

<TR>
<TD>
<P>75cm2 &#8220;Worse&#8221; </P>
</TD>

<TD>
<P>6.5e-6 </P>
</TD>

<TD>
<P>3.9e-10 </P>
</TD>

<TD>
<P>6.5e-20 </P>
</TD>
</TR>

<TR>
<TD>
<P>75cm3 &#8220;Typical&#8221; </P>
</TD>

<TD>
<P>6.0e-6 </P>
</TD>

<TD>
<P>3.9e-10 </P>
</TD>

<TD>
<P>3.5e-20 </P>
</TD>
</TR>
</Table>

<P>1Chapter 8 reference 1 </P>

<P>2Chapter 8 reference 5 </P>

<P>3Chapter 8 reference 5 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1313.jpg"/>
</Figure>

<P>0.00 </P>

<P> </P>

<P>-5.00 </P>

<P> </P>

<P>-10.00 </P>

<P> </P>

<P>-15.00 </P>

<P> </P>

<P>-20.00 </P>

<P> </P>

<Textbox>
<P>Loss (dB) </P>
</Textbox>

<P>-25.00 </P>

<P> </P>

<P>-30.00 </P>

<P> </P>

<P>-35.00 </P>

<P> </P>

<P>-40.00 </P>

<P> </P>

<P>-45.00 </P>

<P> </P>

<Textbox>
<P>1.00E+10 </P>
</Textbox>

<P>-50.00 </P>

<Textbox>
<P>1.00E+09 </P>
</Textbox>

<Textbox>
<P>1.00E+08 </P>
</Textbox>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1314.jpg"/>
</Figure>

<P>Frequency (Hz) </P>

<P>XAUI Model (50cm) 75cm Typical Case 75cm Worst Case Real 75cm Channel </P>

<P> </P>

<P>Figure A-7. Equations Based Channel Loss Curves </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex B BER Adjustment Methodology </P>

<P>(Informative) </P>

<P> </P>

<P> </P>

<P>B.1 Extrapolation of Correlated Bounded Gaussian Jitter to low BERs </P>

<P> </P>

<P>For  this  specification,  which  has  a  BER  requirement  of </P>

<P> </P>

<P>1&#61620;10&#8211;15 </P>

<P> </P>

<P>or  lower, </P>

<P>measurements  to  that  level  are  very  time  consuming  (or  rely  on  averaging multi-links), hence it is more practical to only take measurements to Qs around 7 </P>

<P>(BER around </P>

<P>1&#61620;10&#8211;12  ). </P>

<P> </P>

<P> </P>

<P>B.1.1  Bathtub Measurements </P>

<P> </P>

<P>CBGJ can appear as either GJ or CBHPJ depending upon the Q at which it is linearized. </P>

<P> </P>

<P>If HPJ and GJ are measured using a bathtub there is no knowledge as to if the GJ is UUGJ or CBGJ. For system budgeting it is recommended that the bathtub GJ should be assumed to be all UUGJ. </P>

<P> </P>

<P>If combined spectral oscilloscope methods are used then UUGJ, UBHPJ, and CBHPJ can be estimated. It is not possible to estimate the CBGJ as it has already become bounded and appears as CBHPJ. For system budgeting it is recommended that this peak value is valid for the extrapolated Q of interest. </P>

<P> </P>

<P> </P>

<P>B.2 Confidence Level of Errors Measurement </P>

<P> </P>

<P>Assuming that a link with a given BER can be modelled as a Bernoulli random process, the following statistics can be assumed. </P>

<P> </P>

<P>Given, </P>

<P> </P>

<P>p is the probability of error </P>

<P> </P>

<P>q = &#61480; 1 &#8211; p &#61481;&#61472;</P>

<P> </P>

<P>is the probability of not having an error </P>

<P> </P>

<P>n is the number of bits received and measured </P>

<P> </P>

<P>then </P>

<P> </P>

<P>m = np </P>

<P> </P>

<P>is the expected number of errors received </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 335 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1315.jpg"/>
</Figure>

<P>&#61555; = npq is the sigma of the variation of the number of errors received </P>

<P> </P>

<P>As an example process, for a 3 sigma confidential level </P>

<P> </P>

<P> </P>

<P>p = 10&#8211;12 </P>

<P> </P>

<P>n = 100 &#61655; 1012 </P>

<P> </P>

<P> </P>

<P>m = 100 </P>

<P> </P>

<P> </P>

<P>&#61555; = 10 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1316.jpg"/>
</Figure>

<P>m min  = </P>

<P>max </P>

<P>&#61531; m + Q&#61555; &#61533; Q = 3 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1317.jpg"/>
</Figure>

<P>Q = &#8211;3 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1318.jpg"/>
</Figure>

<P>m min  =  70 </P>

<P>max 130 </P>

<P> </P>

<P>To assess the accuracy of such a measurement an equivalent process with a higher BER can be calculated that would show the same limit of error for the same confidence level and measured number of bits. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1319.jpg"/>
</Figure>

<P>m max m max m max </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1320.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1321.jpg"/>
</Figure>

<P>= E&#61531; m &#61533; &#8211; Q&#61555;&#61472;</P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1322.jpg"/>
</Figure>

<P>= np &#8211; Q npq </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1323.jpg"/>
</Figure>

<P>= np &#8211; Q np&#61480; 1 &#8211; p &#61481;&#61472;</P>

<P> </P>

<P>Solving the quadratic equation for p </P>

<P> </P>

<P> </P>

<P>p = 1.69&#61620;&#61472;</P>

<P>&#8211;12 </P>

<P>10 </P>

<P> </P>

<P> </P>

<P>B.3 Eye Mask Adjustment for Sampling Oscilloscopes </P>

<P> </P>

<P>The data mask is defined for the bit error rate of the link. Given that this bit error rate is very small, typical oscilloscope measurement will not sample enough points to be able to verify compliance to these mask. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>B.3.1  Theory </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1324.jpg"/>
</Figure>

<P>0UI X1 </P>

<P>0.5UI </P>

<P>1-X1 </P>

<P>1UI </P>

<P> </P>

<P> </P>

<P>Figure B-1. Example Data Mask </P>

<P> </P>

<P>Given an example eye mask, Figure B-1, the extremes of the mask, X1, are defined as a linear addition of a Gaussian and high probability jitter component. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>2 </P>
</Textbox>

<P>where </P>

<P> </P>

<P>X1 = </P>

<P>H-----P----J- + Q &#61655; GJrms </P>

<P> </P>

<P>HPJ is the high probability jitter </P>

<P> </P>

<P>GJrms is the Gaussian distributed jitter </P>

<P>Q  is the GJ multiplication factor </P>

<P> </P>

<P>Given a low sample population and the requirements for mask verification to achieve a hit or no-hit result, X1 must be adjusted according to the sample population and the confidence level that a particular peak to peak is achieved. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1325.jpg"/>
</Figure>

<P>Sample </P>

<P>Populati on of n </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Maxi mum of </P>

<P>Populati on </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Ampli tude </P>

<P> </P>

<P> </P>

<P>Figure B-2. Example Data Mask </P>

<P> </P>

<P>Given a random process the probability of measuring a particular maximum amplitude on an oscilloscope requires one sample to lie on the maximum and all other samples to lie below this value. Referring this all to a half Gaussian distribution and a population of n, there are n different ways this can occur, </P>

<P> </P>

<Textbox>
<P>&#61671; &#61682; &#61687;&#61472;</P>
</Textbox>

<P>&#61670; xm </P>

<P>&#61686; n &#8211; 1 </P>

<P>P&#61480; xm &#61481;&#61472;</P>

<P>= nQ&#61480; xm &#61481;&#61671;  Q&#61480; x &#61481;dx&#61687;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>where </P>

<P>&#61672; 0 &#61688;&#61472;</P>

<P> </P>

<P>xm is the random variable of the maximum amplitude measured </P>

<P>x is the random variable of the underlying random jitter process </P>

<P> </P>

<P>Q&#61480; x &#61481;&#61472;</P>

<P> </P>

<P>is the Q function of the Normal probability density function </P>

<P> </P>

<P>n is the sample population </P>

<P> </P>

<P>P&#61480; xm &#61481;&#61472;</P>

<P> </P>

<P>is a probability density function </P>

<P>The equation above is solved and the probability of attaining a given maximum </P>

<P>(normalized to the sigma) for various populations plotted, Figure B-3. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1326.jpg"/>
</Figure>

<P>100 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>10-1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Confidence Level </P>
</Textbox>

<P>10-2 </P>

<P>n=1 n=10 n=100 n=1k n=10k n=100k n=1M </P>

<P> </P>

<P>10-3 </P>

<P>3 sigma confidence level </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>10-4 </P>

<P> </P>

<P>0  1  2  3  4  5  6  7 </P>

<P>Q </P>

<P> </P>

<P> </P>

<P>Figure B-3. Cumulative Distribution Function of Maximum Amplitude </P>

<P> </P>

<P>B.3.2  Usage </P>

<P> </P>

<P>Given a known sampling population, n, calculated from the measurement time, average transition density and sampling/collection frequency of the oscilloscope the </P>

<P>three sigma confidence level (i.e. </P>

<P>1.3&#61620;10&#8211;3 ) of the measured Gaussian jitter peak </P>

<P>value can be read from Figure B-3. This value should be multiplied by 2 to give the full peak to peak value of the random jitter. </P>

<P> </P>

<P>The three sigma confidence level should be understood as ensuring that 99.96% of all good devices do not violate the eye mask. To limit the number of bad devices that also pass the eye mask it is strongly recommended that the sample population be chosen as to give a Q larger than 5. </P>

<P> </P>

<P>For example, referring to the red circled intersections Figure B-3, if we calculate that the sample population for an oscilloscope was 100 i.e. n=100, then for a 3 sigma confidence this equals a Q of 4.2. As the recommended Q value is 5 we should increase the sample population to 10k to give a Q of 5.2. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex C Interface Management (Informative) </P>

<P> </P>

<P> </P>

<P>C.1 Introduction </P>

<P> </P>

<P>This appendix contains state machine descriptions that illustrate a number of behaviors that are described in the RapidIO Part 6: LP-Serial Physical Layer Specification. They are included as examples and are believed to be correct, however, actual implementations should not use the examples directly. </P>

<P> </P>

<P> </P>

<P>C.2 Packet Retry Mechanism </P>

<P> </P>

<P>This section contains the example packet retry mechanism state machine referred to in Section 5.8, &#8220;Packet Transmission Protocol&quot;. </P>

<P> </P>

<P>Packet retry recovery actually requires two inter-dependent state machines in order to operate, one associated with the input port and the other with the output port on the two connected devices. The two state machines work together to attempt recovery from a retry condition. </P>

<P> </P>

<P> </P>

<P>C.2.1  Input port retry recovery state machine </P>

<P> </P>

<P>If a packet cannot be accepted by a receiver for reasons other than error conditions, such as a full input buffer, the receiver follows the state sequence shown in Figure C-1. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1327.jpg"/>
</Figure>

<P>reset </P>

<P>1 </P>

<P> </P>

<P>recovery_disabled </P>

<P> </P>

<P>2 5 </P>

<P>3 </P>

<P> </P>

<P>wait_for_retry </P>

<P> </P>

<P> </P>

<P>4 </P>

<P>6 </P>

<P> </P>

<P>stop_input </P>

<P>9 </P>

<P> </P>

<P>7 8 </P>

<P> </P>

<P>retry_stopped </P>

<P> </P>

<P> </P>

<P>Figure C-1. Input Port Retry Recovery State Machine </P>

<P> </P>

<P>Table C-1 describes the state transition arcs for Figure C-1. The states referenced in the comments in quotes are the RapidIO LP-Serial defined status states, not states in this state machine. </P>

<P> </P>

<P>Table C-1. Input Port Retry Recovery State Machine Transition Table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>Cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Remain in this state until the input port is enabled to receive packets. </P>
</TD>

<TD>
<P>This is the initial state after reset. The input port can&#8217;t be enabled before the initialization sequence has been completed, and may be controlled through other mechanisms as well, such as a software enable bit. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Input port is enabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Remain in this state until a packet retry situation has been detected. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>A packet retry situation has been detected. </P>
</TD>

<TD>
<P>Usually this is due to an internal resource problem such as not having packet buffers available for low priority packets. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Input port is disabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>Remain in this state until described input port stop activity is completed. </P>
</TD>

<TD>
<P>Send a packet-retry control symbol with the expected ackID, discard the packet, and don&#8217;t change the expected ackID. This will force the attached device to initiate recovery starting at the expected ackID. Clear the &quot;Port Normal&quot; state and set the &quot;Input Retry-stopped&quot; state. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>retry_stopped </P>
</TD>

<TD>
<P>Input port stop activity is complete. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table C-1. Input Port Retry Recovery State Machine Transition Table (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>Cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>retry_stopped </P>
</TD>

<TD>
<P>retry_stopped </P>
</TD>

<TD>
<P>Remain in this state until a restart-from-retry or link request (restart-from-error) control symbol is received or an input port error is encountered. </P>
</TD>

<TD>
<P>The &quot;Input Retry-stopped&quot; state causes the input port to silently discard all incoming packets and not change the expected ackID value. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>retry_stopped </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Received a restart-from-retry or a link request (restart-from-error) control symbol or an input port error is encountered. </P>
</TD>

<TD>
<P>Clear the &quot;Input Retry-stopped&quot; state and set the &quot;Port Normal&quot; state. An input port error shall cause a clean transition between the retry recovery state machine and the error recovery state machine. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>C.2.2  Output port retry recovery state machine </P>

<P> </P>

<P>On receipt of an error-free packet-retry control symbol, the attached output port follows the behavior shown in Figure C-2. The states referenced in the comments in quotes are the RapidIO 8/16 LP-LVDS defined status states, not states in this state machine. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>reset </P>

<P>1 </P>

<P> </P>

<P>recovery_disabled </P>

<P> </P>

<P>2 5 </P>

<P>3 </P>

<P> </P>

<P>wait_for_retry </P>

<P> </P>

<P> </P>

<P>4 </P>

<P>6 </P>

<P> </P>

<P>stop_output </P>

<P> </P>

<P>9 </P>

<P>8 7 </P>

<P> </P>

<P>recover </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1328.jpg"/>
</Figure>

<P>Figure C-2. Output Port Retry Recovery State Machine </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table C-2 describes the state transition arcs for Figure C-2. </P>

<P> </P>

<P>Table C-2. Output Port Retry Recovery State Machine Transition Table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>Cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Remain in this state until the output port is enabled to receive packets. </P>
</TD>

<TD>
<P>This is the initial state after reset. The output port can&#8217;t be enabled before the initialization sequence has been completed, and may be controlled through other mechanisms as well, such as a software enable bit. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Output port is enabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Remain in this state until a packet-retry control symbol is received. </P>
</TD>

<TD>
<P>The packet-retry control symbol shall be error free. </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>A packet-retry control symbol has been received. </P>
</TD>

<TD>
<P>Start the output port stop procedure. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Output port is disabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>Remain in this state until the output port stop procedure is completed. </P>
</TD>

<TD>
<P>Clear the &quot;Port Normal&quot; state, set the &quot;Output   Retry-stopped&quot;   state,   and stop transmitting new packets. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>Output port stop procedure is complete. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>Remain in this state until the internal recovery procedure is completed. </P>
</TD>

<TD>
<P>The packet sent with the ackID value returned in the packet-retry control symbol and all subsequent packets shall be retransmitted. Output port state machines and the outstanding ackID scoreboard shall be updated with this information, then clear the &quot;Output Retry-stopped&quot; state and set the &quot;Port Normal&quot; state to restart the output port. </P>

<P>Receipt of a packet-not-accepted control symbol or other output port error   during   this   procedure   shall cause a clean transition between the retry recovery state machine and the error recovery state machine. </P>

<P>Send restart-from-retry control symbol. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>wait_for_retry </P>
</TD>

<TD>
<P>Internal recovery procedure is complete. </P>
</TD>

<TD>
<P>Retransmission has started, so return to the wait_for_retry state to wait for the next packet-retry control symbol. </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P>C.3 Error Recovery </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>This section contains the error recovery state machine referred to in Section 5.13.2, &#8220;Link Behavior Under Error.&quot; </P>

<P> </P>

<P>Error recovery actually requires two inter-dependent state machines in order to operate, one associated with the input port and the other with the output port on the two connected devices. The two state machines work together to attempt recovery. </P>

<P> </P>

<P> </P>

<P>C.3.1  Input port error recovery state machine </P>

<P> </P>

<P>There are a variety of recoverable error types described in detail in Section 5.13.2, &#8220;Link Behavior Under Error&quot;. The first group of errors are associated with the input port, and consists mostly of corrupt packet and control symbols. An example of a corrupt packet is a packet with an incorrect CRC. An example of a corrupt control symbol is a control symbol with error on the 5-bit CRC control symbol. The recovery state machine for the input port of a RapidIO link is shown in Figure C-3. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1329.jpg"/>
</Figure>

<P>reset </P>

<P>1 </P>

<P> </P>

<P>recovery_disabled </P>

<P> </P>

<P>2 5 </P>

<P>3 </P>

<P> </P>

<P>wait_for_error </P>

<P> </P>

<P> </P>

<P>4 </P>

<P>6 </P>

<P> </P>

<P>stop_input </P>

<P>9 </P>

<P> </P>

<P>7 8 </P>

<P> </P>

<P>error_stopped </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure C-3. Input Port Error Recovery State Machine </P>

<P> </P>

<P>Table C-3 describes the state transition arcs for Figure C-3. The states referenced in the comments in quotes are the RapidIO LP-Serial defined status states, not states in this state machine. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table C-3. Input Port Error Recovery State Machine Transition Table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>Cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Remain in this state until error recovery is enabled. </P>
</TD>

<TD>
<P>This is the initial state after reset. Error   recovery   can&#8217;t   be   enabled before the initialization sequence has been completed, and may be controlled through other mechanisms as well, such as a software enable bit. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Error recovery is enabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Remain in this state until a recoverable error is detected. </P>
</TD>

<TD>
<P>Detected errors and the level of coverage is implementation dependent. </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>A recoverable error has been detected. </P>
</TD>

<TD>
<P>An output port associated error will not cause this transition, only an input port associated error. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Error recovery is disabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>Remain in this state until described input port stop activity is completed. </P>
</TD>

<TD>
<P>Send a packet-not-accepted control symbol and, if the error was on a packet, discard the packet and don&#8217;t change  the  expected  ackID  value. This will force the attached device to initiate recovery. Clear the &quot;Port Normal&quot;  state  and  set  the  &quot;Input Error-stopped&quot; state. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>stop_input </P>
</TD>

<TD>
<P>error_stopped </P>
</TD>

<TD>
<P>Input port stop activity is complete. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>error_stopped </P>
</TD>

<TD>
<P>error_stopped </P>
</TD>

<TD>
<P>Remain in this state until a link request (restart-from-error) control symbol is received. </P>
</TD>

<TD>
<P>The  &quot;Input  Error-stopped&quot;  state causes the input port to silently discard all subsequent incoming packets and ignore all subsequent input port errors. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>error_stopped </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Received a link request </P>

<P>(restart-from-error) control symbol. </P>
</TD>

<TD>
<P>Clear the &quot;Input Error-stopped&quot; state and  set  the  &quot;Port   Normal&quot;  state, which will put the input port back in normal operation. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>C.3.2  Output port error recovery state machine </P>

<P> </P>

<P>The second recoverable group of errors described in Section 5.13.2, &#8220;Link Behavior Under Error&quot; is associated with the output port, and is comprised of control symbols that are error-free and indicate that the attached input port has detected a transmission error or some other unusual situation has occurred. An example of this situation is indicated by the receipt of a packet-not-accepted control symbol. The state machine for the output port is shown in Figure C-4. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>reset </P>

<P>1 </P>

<P> </P>

<P>recovery_disabled </P>

<P> </P>

<P>2 5 </P>

<P>3 </P>

<P> </P>

<P>wait_for_error </P>

<P> </P>

<P> </P>

<P>4 </P>

<P>6 </P>

<P> </P>

<P>stop_output </P>

<P> </P>

<P>10 </P>

<P>9 7 </P>

<P> </P>

<P>recover </P>

<P>12 </P>

<P>8 11 </P>

<P> </P>

<P>fatal_error </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1330.jpg"/>
</Figure>

<P>Figure C-4. Output Port Error Recovery State Machine </P>

<P> </P>

<P>Table C-4 describes the state transition arcs for Figure C-4. The states referenced in the comments in quotes are the RapidIO 8/16 LP-LVDS defined status states, not states in this state machine. </P>

<P> </P>

<P>Table C-4. Output Port Error Recovery State Machine Transition Table </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>Cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Remain in this state until error recovery is enabled. </P>
</TD>

<TD>
<P>This is the initial state after reset. Error   recovery   can&#8217;t   be   enabled before the initialization sequence has been completed, and may be controlled through other mechanisms as well, such as a software enable bit. </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Error recovery is enabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Remain in this state until a recoverable error is detected. </P>
</TD>

<TD>
<P>Detected errors and the level of coverage is implementation dependent. </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>A recoverable error has been detected. </P>
</TD>

<TD>
<P>An input port associated error will not cause this transition, only an output port associated error. </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>recovery_disabled </P>
</TD>

<TD>
<P>Error recovery is disabled. </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table C-4. Output Port Error Recovery State Machine Transition Table (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>Cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>Remain in this state until an exit condition occurs. </P>
</TD>

<TD>
<P>Clear the &quot;Port Normal&quot; state, set the &quot;Output Error-stopped&quot; state, stop transmitting new packets, and send a link-request/input-status control symbol. Ignore all subsequent output port errors. </P>

<P>The input on the attached device is in the &quot;Input Error-stopped&quot; state and is waiting for a link-request/input-status in order to be re-enabled to receive packets. </P>

<P>An implementation may wish to timeout  several  times  before regarding a timeout as fatal using a threshold counter or some other mechanism. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>The link-response is received and returned an outstanding ackID value </P>
</TD>

<TD>
<P>An outstanding ackID is a value sent out on a packet that has not been acknowledged yet. In the case where no ackID is outstanding the returned ackID value shall match the next expected/next assigned ackID value, indicating that the devices are synchronized. </P>

<P>Recovery is possible, so follow recovery procedure. </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>stop_output </P>
</TD>

<TD>
<P>fatal_error </P>
</TD>

<TD>
<P>The link-response is received and returned an ackID value that is not outstanding, or timed out waiting for the link-response. </P>
</TD>

<TD>
<P>Recovery  is  not  possible,  so  start error shutdown procedure. </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>Remain in this state until the internal recovery procedure is completed. </P>
</TD>

<TD>
<P>The packet sent with the ackID value returned in the link-response and all subsequent packets shall be retransmitted. All packets transmitted with ackID values preceding the returned value were received by the attached device, so they are treated as if packet-accepted control symbols have been received for them. Output port state machines and the outstanding  ackID  scoreboard  shall be  updated  with  this  information, then clear the &quot;Output Error-stopped&quot; state and set the &#8216;Port Normal&quot; state to restart the output port. </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>recover </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>The internal recovery procedure is complete. </P>
</TD>

<TD>
<P>retransmission (if any was necessary) has started, so return to the wait_for_error state to wait for the next error. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Table C-4. Output Port Error Recovery State Machine Transition Table (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Arc </P>
</TD>

<TD>
<P>Current State </P>
</TD>

<TD>
<P>Next state </P>
</TD>

<TD>
<P>Cause </P>
</TD>

<TD>
<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>fatal_error </P>
</TD>

<TD>
<P>fatal_error </P>
</TD>

<TD>
<P>Remain in this state until error shutdown procedure is completed. </P>
</TD>

<TD>
<P>Clear the &quot;Output Error-stopped&quot; state, set the &quot;Port Error&quot; state, and signal a system error. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>fatal_error </P>
</TD>

<TD>
<P>wait_for_error </P>
</TD>

<TD>
<P>Error shutdown procedure is complete. </P>
</TD>

<TD>
<P>Return to the wait_for_error state. </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P>C.3.3  Changes in Error Recovery Behavior for CT </P>

<P> </P>

<P>The basic states, as previously described, apply to the overall port. Each VC must carry some independent state: </P>

<P> </P>

<P>Packets in a transmitter&#8217;s VC queue are: pending transmission, sent-pending acknowledgement, or acknowledged (and subsequently removed from the queue). RT and CT VCs keep this same information, but behave slightly differently on error recovery. In RT queues, packets sent-pending acknowledgment, are returned to the pending transmission state. Packets pending acknowledgment in CT queues are moved to the acknowledged state. In this way, the sent packets in the CT queue are not resent. </P>

<P> </P>

<P>(Note that it may not be necessary to keep the actual packet in a CT VC, only track the needed acknowledges to keep the credit balance for transmitter flow control accurate.) </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex D Critical Resource Performance Limits </P>

<P>(Informative) </P>

<P> </P>

<P>The RapidIO LP-Serial layer is intended for use over links whose length ranges from centimeters to tens of meters. The shortest length links will almost certainly use copper printed circuit board traces. The longer lengths will require the use of fiber optics (optical fiber and electro-optical converters) to overcome the high frequency losses of long copper printed circuit board traces or cable. The longer lengths will also have significant propagation delay which can degrade the usable bandwidth of a link. </P>

<P> </P>

<P>The serial protocol is a handshake protocol. Each packet transmitted by a port is assigned an ID (the ackID) and a copy of the packet is retained by the port in a holding buffer until the packet is accepted by the port&#8217;s link partner. The number of packets that a port can transmit without acknowledgment is limited to the lesser of the number of distinct ackIDs and the number of buffers available to hold unacknowledged packets. Which ever is the limiting resource, ackIDs or holding buffers, will be called the &#8220;critical resource&#8221;. </P>

<P> </P>

<P>The concern is the time between the assignment of a critical resource to a packet and the release of that resource as a consequence of the packet being accepted by the link partner. Call this time the resource_release_delay. When the resource_release_delay is less than the time it takes to transmit a number of packets equal to the number of distinct critical resource elements, there is no degradation of link performance. When the resource_release_delay is greater than the time it takes to transmit a number of packets equal to the number of distinct critical resource elements, the transmitter may have to stall from time to time waiting for a free critical resource. This will degraded the usable link bandwidth. The onset of degradation will depend on the average length of transmitted packets and the physical length of the link as reflected in the resource_release_delay. </P>

<P> </P>

<P>The following example provides some idea of the impact on link performance of the interaction between link length and a critical resource. For purposes of this example, the following assumptions are made. </P>

<P> </P>

<P>1. The link is a 4 lane (4x) link. </P>

<P>2. The link uses optical fiber and electro-optical transceivers to allow link lengths of tens of meters. The propagation delay of the optical fiber is 0.45c. </P>

<P>3. The width of the data path within the port is 4 bytes. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4. The data path and logic within the port run at a clock rate equal to the aggregate unidirectional data rate of the link divided by 32. This is referred to as the logic clock. One cycle of this clock is referred to a one logic clock cycle. (If the aggregate unidirectional baud rate of the link was used to compute the logic clock, the baud rate would be divided by 40. With 8B/10B encoding, the baud rate is 1.25 times the data rate.) </P>

<P>5. The minimum length packet header is used. Write request packets have a length of 12 bytes plus a payload containing an integer multiple of 8 bytes. Read request packets have a length of 12 bytes. Read response packets have a length of 8 bytes plus a payload containing an integer multiple of 8 bytes. </P>

<P>6. The beginning and end of each packet is delimited by a control symbol. A single control symbol may delimit both the end of one packet and the beginning of the next packet. </P>

<P>7. Packet acknowledgments are carried in packet delimiter control symbols when ever possible to achieve the efficiency provided by the dual stype control symbol. This implies that a packet acknowledgment must wait for an end-of-packet control symbol if packet transmission is in progress when the packet acknowledgment becomes available. </P>

<P>8. The logic and propagation delay in the packet transmission direction is comprised of the following components. </P>

<P> </P>

<P>Table D-1. Packet Transmission Delay Components </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Item </P>
</TD>

<TD>
<P>Time required </P>
</TD>
</TR>

<TR>
<TD>
<P>Generate start-of-packet control symbol </P>

<P>(critical resource is available) </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>Generate start-of-packet control symbol CRC </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>8B/10B encode delimiter and start-of-packet control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>Serialize and transmit delimiter and start-of-packet control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>PCB copper and electro-optical transmitter delay </P>
</TD>

<TD>
<P>2 ns </P>
</TD>
</TR>

<TR>
<TD>
<P>Optical fiber delay </P>
</TD>

<TD>
<P>fiber_length/0.45c </P>
</TD>
</TR>

<TR>
<TD>
<P>Electro-optical receiver and pcb copper delay </P>
</TD>

<TD>
<P>2 ns </P>
</TD>
</TR>

<TR>
<TD>
<P>Receive and deserialize delimiter and start-of-packet control symbol </P>
</TD>

<TD>
<P>0.5 logic clock cycles </P>
</TD>
</TR>

<TR>
<TD>
<P>Receive and deserialize packet </P>
</TD>

<TD>
<P>depends on packet </P>
</TD>
</TR>

<TR>
<TD>
<P>Receive and deserialize delimiter and end-of-packet control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>8B/10B decode delimiter and end-of-packet control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>Check CRC of end-of-packet control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>Make packet acceptance decision </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>9. The logic and propagation delay in the packet acknowledgment direction is comprised of the following. </P>

<P> </P>

<P>Table D-2. Packet Acknowledgment Delay Components </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Item </P>
</TD>

<TD>
<P>Time required </P>
</TD>
</TR>

<TR>
<TD>
<P>Wait for end-of-packet if packet transmission is in progress, generate packet-acknowledgment control symbol and control symbol CRC </P>
</TD>

<TD>
<P>depends on packet </P>

<P>&gt;= 2 logic clock cycles </P>
</TD>
</TR>

<TR>
<TD>
<P>8B/10B encode delimiter and packet-acknowledgment control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>Serialize and transmit delimiter and packet-acknowledgment control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>PCB copper and electro-optical transmitter delay </P>
</TD>

<TD>
<P>2 ns </P>
</TD>
</TR>

<TR>
<TD>
<P>Optical fiber delay </P>
</TD>

<TD>
<P>fiber_length/0.45c </P>
</TD>
</TR>

<TR>
<TD>
<P>Electro-optical receiver and pcb copper delay </P>
</TD>

<TD>
<P>2 ns </P>
</TD>
</TR>

<TR>
<TD>
<P>Receive and deserialize delimiter and packet-acknowledgment control symbol </P>
</TD>

<TD>
<P>0.5 logic clock cycles </P>
</TD>
</TR>

<TR>
<TD>
<P>8B/10B decode delimiter and packet-acknowledgment control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>Check CRC of packet-acknowledgment control symbol </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>

<TR>
<TD>
<P>Make decision to free critical resource </P>
</TD>

<TD>
<P>1 logic clock cycle </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The packet times in the above tables depend on packet length which in turn depends on packet type and payload size. Since packet traffic will typically involve a mixture of packet types and payload sizes, the traffic in each direction will be assumed to contain an equal number of read, write and response packets and average payloads of 8, 32, and 64 bytes. </P>

<P> </P>

<P>The number of logic clock cycles required to transmit or receive a packet is given in the following table as a function of packet type and payload size. </P>

<P> </P>

<P>Table D-3. Packet Delays </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Packet Type </P>
</TD>

<TD>
<P>Packet Header bytes </P>
</TD>

<TD>
<P>Data Payload bytes </P>
</TD>

<TD>
<P>Transmit/Receive Time logic clock cycles </P>
</TD>
</TR>

<TR>
<TD>
<P>Read </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Response </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>4 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>32 </P>
</TD>

<TD>
<P>10 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>64 </P>
</TD>

<TD>
<P>18 </P>
</TD>
</TR>

<TR>
<TD>
<P>Write </P>
</TD>

<TD>
<P>12 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>5 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>32 </P>
</TD>

<TD>
<P>11 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>64 </P>
</TD>

<TD>
<P>19 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Using the above table and the assumed equal number of read, write and response packets, the average number of logic clock cycles to transmit or received a packet is </P>

<P>4, 8, and 13.3 respectively for packet payloads of 8, 32, and 64 bytes. The average wait for the completion of a packet being transmitted is assumed to be 1/2 the transmit time. </P>

<P> </P>

<P>The following table gives the maximum length of the optical fiber before the packet </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>transmission rate becomes limited by the critical resource for a 4x link operating at unidirectional data rates of 4.0, 8.0 and 10.0 Gb/s. </P>

<P> </P>

<P>Table D-4. Maximum Transmission Distances </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Number of Critical Resources Available </P>
</TD>

<TD>
<P> </P>

<P>Data Payload </P>

<P>(Bytes) </P>
</TD>

<TD>
<P>Maximum Fiber Length Before </P>

<P>Critical Resource Limited (Meters) </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>4.0 Gb/s link </P>
</TD>

<TD>
<P>8.0 Gb/s link </P>
</TD>

<TD>
<P>10.0 Gb/s link </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>- </P>
</TD>

<TD>
<P>- </P>
</TD>

<TD>
<P>- </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>32 </P>
</TD>

<TD>
<P>4.3 </P>
</TD>

<TD>
<P>1.9 </P>
</TD>

<TD>
<P>1.4 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>64 </P>
</TD>

<TD>
<P>11.4 </P>
</TD>

<TD>
<P>5.5 </P>
</TD>

<TD>
<P>4.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>9.7 </P>
</TD>

<TD>
<P>4.6 </P>
</TD>

<TD>
<P>3.5 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>32 </P>
</TD>

<TD>
<P>23.6 </P>
</TD>

<TD>
<P>11.5 </P>
</TD>

<TD>
<P>9.1 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>64 </P>
</TD>

<TD>
<P>42.2 </P>
</TD>

<TD>
<P>20.8 </P>
</TD>

<TD>
<P>16.6 </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>31.1 </P>
</TD>

<TD>
<P>15.3 </P>
</TD>

<TD>
<P>12.1 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>32 </P>
</TD>

<TD>
<P>62.2 </P>
</TD>

<TD>
<P>30.8 </P>
</TD>

<TD>
<P>24.6 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>64 </P>
</TD>

<TD>
<P>103.7 </P>
</TD>

<TD>
<P>51.6 </P>
</TD>

<TD>
<P>41.1 </P>
</TD>
</TR>

<TR>
<TD>
<P>24 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>52.5 </P>
</TD>

<TD>
<P>26.0 </P>
</TD>

<TD>
<P>20.7 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>32 </P>
</TD>

<TD>
<P>100.8 </P>
</TD>

<TD>
<P>50.2 </P>
</TD>

<TD>
<P>40.0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>64 </P>
</TD>

<TD>
<P>165.2 </P>
</TD>

<TD>
<P>82.3 </P>
</TD>

<TD>
<P>65.7 </P>
</TD>
</TR>

<TR>
<TD>
<P>32 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>74.0 </P>
</TD>

<TD>
<P>36.7 </P>
</TD>

<TD>
<P>29.3 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>32 </P>
</TD>

<TD>
<P>139.5 </P>
</TD>

<TD>
<P>69.5 </P>
</TD>

<TD>
<P>55.5 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>64 </P>
</TD>

<TD>
<P>226.7 </P>
</TD>

<TD>
<P>113.1 </P>
</TD>

<TD>
<P>90.3 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex E Manufacturability and Testability </P>

<P>(Informative) </P>

<P> </P>

<P>It is not possible in many cases for assembly vendors to verify the integrity of soldered connections between components and the printed circuit boards to which they are attached. Alternative methods to direct probing are needed to insure high yields for printed circuit assemblies which include LP-Serial RapidIO devices. </P>

<P> </P>

<P>It is recommended that component vendors support IEEE Std. 1149.6 (commonly known as &quot;AC-JTAG&quot;) on all connections to LP-Serial RapidIO links. (Note: IEEE Std. 1149.6 is needed, in addition to IEEE Std. 1149.1, due the fact that RapidIO LP-Serial lanes are AC-coupled.) This provides boundary scan capability on all TD, TDN, RD, and RDN pins on a component which supports one or more LP-Serial RapidIO ports. </P>

<P> </P>

<P>The IEEE Std. 1149.6 is available from the IEEE. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex F Multiple Port Configuration Example </P>

<P>(Informative) </P>

<P> </P>

<P> </P>

<P>F.1 Introduction </P>

<P> </P>

<P>This appendix contains flow-chart descriptions that illustrates the Port-Width negotiation process described in Chapter 4, &#8220;PCS and PMA Layers. They are included as examples and are believed to be correct, however, actual implementations and system design should not use the examples directly. </P>

<P> </P>

<P> </P>

<P>F.2 System with Different Port Width Capabilities </P>

<P> </P>

<P>In a high-performance system, a high-bandwidth switch processing element is often used to aggregate traffic; while the connecting agents can be ones of lower bandwidth. Under this circumstance, the switch processing element has to identify the discrepancy of port-widths between link partners and set up accordingly. Figure shows a typical system with a switch processing element connected between the System Host and two connecting Agents. The system is set up as follows: </P>

<P>&#8226; System Host is connected to Switch A </P>

<P>&#8226; Switch A has a 8x port which is capable of multiple port configuration. </P>

<P>&#8226; Agent B has a 4x port connected to Switch A lanes 4-7 </P>

<P>&#8226; Agent C has a 2x port connected to Switch A lanes 0-3. </P>

<P> </P>

<P>The following example is used to illustrate the negotiation that will take place between Switch A and Agents B and C. It is assumed that the System Host and the Switch A have already established error-free communication. </P>

<P>1. By default, the 8x-port of Switch A looks for an 8x connection but fails to come up with its link partner; thus, falling to 1x mode on lane 0 or 2. </P>

<P>2. Agent B fails to establish 4x link with Switch A. It tries to fall back to 1x mode on its lane 0 or 2 but still fails. Its 4x port has failed. </P>

<P>3. Agent C fails to establish a 2x link with Switch A. When it tries to fall back to </P>

<P>1x mode, it succeeds in lane 0 and re-establish communication with Switch </P>

<P>A on its lane 0. </P>

<P>4. System Host reads through the established 1x link between Switch A and Agent C. From the Vendor Port-Width CAR of Agent C, System Host discovers that Agent C can support 2x mode. </P>

<P> </P>

<P>RapidIO Trade Association 357 </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5. System Host checks Switch A for its support of 2x mode on its lower quad-link. </P>

<P>6. System Host writes to the Port Width Override CSR to force both Switch A </P>

<P>lower quad-link. </P>

<P>7. System Host puts Agent C back to 2x mode. </P>

<P>8. A 2x-link is established between Switch A and Agent C. </P>

<P>9. System Host discovers from Vendor Port-Width CAR in Agent B (not through Switch A because the link was not established yet) that Agent B supports 4x mode. It also discovers that Switch A supports multiple port configuration (from its Vendor Specific registers) and its extra port is available (Vendor Port-Width CAR).1 </P>

<P>10. System Host configures the new port on the upper-quad link of Switch A. </P>

<P>11. Agent B now recognizes a 4x link partner. </P>

<P>12. A 4x link is now established between Switch A and Agent B. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Switch A </P>

<P> </P>

<P> </P>

<P>System Host </P>

<P> </P>

<P> </P>

<P> </P>

<P>5  6 </P>

<P>8x </P>

<Textbox>
<P>0 </P>
</Textbox>

<P>0 1 2 3  4 5 6 7 </P>

<Textbox>
<P>1 </P>
</Textbox>

<Textbox>
<P>2 </P>
</Textbox>

<Textbox>
<P>3 </P>
</Textbox>

<Textbox>
<P>4 </P>
</Textbox>

<Textbox>
<P>5 </P>
</Textbox>

<Textbox>
<P>6 </P>
</Textbox>

<Textbox>
<P>7 </P>
</Textbox>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1331.jpg"/>
</Figure>

<P>sRIO links 1 </P>

<P>10 </P>

<P> </P>

<P>sRIO links </P>

<P> </P>

<P> </P>

<P>4  8 </P>

<P> </P>

<P>12 </P>

<P> </P>

<P> </P>

<P> </P>

<P>3 </P>

<Textbox>
<P>0 </P>
</Textbox>

<P>0 1 </P>

<Textbox>
<P>1 </P>
</Textbox>

<P>2x 7 </P>

<P>2  11 </P>

<Textbox>
<P>0 </P>
</Textbox>

<P>0 1 2 3 </P>

<Textbox>
<P>1 </P>
</Textbox>

<Textbox>
<P>2 </P>
</Textbox>

<Textbox>
<P>3 </P>
</Textbox>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1332.jpg"/>
</Figure>

<P>4x  9 </P>

<P> </P>

<P> </P>

<P>Agent C  Agent B </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1333.jpg"/>
</Figure>

<P>Figure F-1. Example system with asymmetric port-width capabilities </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1334.jpg"/>
</Figure>

<P>1Steps 9 to 12 are optional. Switch A is not required to support multiple-port configuration to be compliant. </P>

<P> </P>

<P>358 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1335.jpg"/>
</Figure>

<P>A AC Coupling. A method of connecting two devices together that does not pass DC. </P>

<P> </P>

<P>Agent. A processing element that provides services to a processor. </P>

<P> </P>

<P>ANSI. American National Standards Institute. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1336.jpg"/>
</Figure>

<P>B Big-endian. A byte-ordering method in memory where the address n of a word corresponds to the most significant byte. In an addressed memory word, the bytes are ordered (left to right) 0, 1, 2, 3, with 0 </P>

<P>being the most significant byte. </P>

<P> </P>

<P>Bridge. A processing element that connects one computer bus to another, allowing a processing element on one bus to access an processing element on the other. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1337.jpg"/>
</Figure>

<P>C Capability registers (CARs). A set of read-only registers that allow a processing  element  to  determine  another  processing  element&#8217;s </P>

<P>capabilities. </P>

<P> </P>

<P>Code-group. A 10-bit entity produced by the 8B/10B encoding process and the input to the 8B/10B decoding process. </P>

<P> </P>

<P>Command and status registers (CSRs). A set of registers that allow a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P>Continuous Transmission (CT). A mode of packet transmission that allows some packet loss to minimize latency by not retransmitting packets. </P>

<P> </P>

<P>Control symbol. A quantum of information transmitted between two linked devices to manage packet flow between the devices. </P>

<P> </P>

<P>CRC. Cyclic redundancy code </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1338.jpg"/>
</Figure>

<P>D Deadlock. A situation in which two processing elements that are sharing resources prevent each other from accessing the resources, resulting in a halt of system operation. </P>

<P> </P>

<P>Deferred or delayed transaction. The process of the target of a transaction capturing the transaction and completing it after responding to the the source with a retry. </P>

<P> </P>

<P>Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Device ID. The identifier of a processing element connected to the RapidIO </P>

<P>interconnect. </P>

<P> </P>

<P>Direct Memory Access (DMA). A process element that can independently read and write system memory. </P>

<P> </P>

<P>Distributed memory. System memory that is distributed throughout the system, as opposed to being centrally located. </P>

<P> </P>

<P>Double word. An eight byte quantity, aligned on eight byte boundaries. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1339.jpg"/>
</Figure>

<P>E EMI. Electromagnetic Interference. </P>

<P>End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>End point device. A processing element which contains end point functionality. </P>

<P> </P>

<P>End point free device. A processing element which does not contain end point functionality. </P>

<P> </P>

<P>Ethernet. A common local area network (LAN) technology. </P>

<P> </P>

<P>External processing element. A processing element other than the processing element in question. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1340.jpg"/>
</Figure>

<P>F Fabric. A series of interconnected switch devices, typically used in reference to a switch fabric. </P>

<P> </P>

<P>Field or Field name. A sub-unit of a register, where bits in the register are named and defined. </P>

<P> </P>

<P>FIFO. First in, first out. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Full-duplex. Data can be transmitted in both directions between connected processing elements at the same time. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1341.jpg"/>
</Figure>

<P>G Globally shared memory (GSM). Cache coherent system memory that can be shared between multiple processors in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1342.jpg"/>
</Figure>

<P>H Half-word. A two byte or 16-bit quantity, aligned on two byte boundaries. </P>

<P> </P>

<P>Header.  Typically  the  first  few  bytes  of  a  packet,  containing  control information. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1343.jpg"/>
</Figure>

<P>I Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P>I/O. Input-output. </P>

<P> </P>

<P>IP. Intellectual Property </P>

<P> </P>

<P>ITU. International Telecommunication Union. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1344.jpg"/>
</Figure>

<P>L Little-endian. A byte-ordering method in memory where the address n of a word corresponds to the least significant byte. In an addressed memory word, the bytes are ordered (left to right) 3, 2, 1, 0, with 3 </P>

<P>being the most significant byte. </P>

<P> </P>

<P>Local memory. Memory associated with the processing element in question. </P>

<P> </P>

<P>LP. Link Protocol </P>

<P> </P>

<P>LSB. Least significant byte. </P>

<P> </P>

<P>LVDS. Low voltage differential signaling. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1345.jpg"/>
</Figure>

<P>M Message passing. An application programming model that allows processing elements to communicate through special hardware instead of through memory as with the globally shared memory programming </P>

<P>model. </P>

<P> </P>

<P>MSB. Most significant byte. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1346.jpg"/>
</Figure>

<P>N Non-coherent. A transaction that does not participate in any system globally shared memory cache coherence mechanism. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1347.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1348.jpg"/>
</Figure>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>

<P>system. </P>

<P> </P>

<P>Payload. The user data embedded in the RapidIO packet. </P>

<P> </P>

<P>PCB. Printed circuit board. </P>

<P> </P>

<P>PCS. Physical Coding Sublayer. </P>

<P> </P>

<P>PMA. Physical Media Attachment. </P>

<P> </P>

<P>Port-write. An address-less write operation. </P>

<P> </P>

<P>Priority. The relative importance of a transaction or packet; in most systems a higher priority transaction or packet will be serviced or transmitted before one of lower priority. </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P>Processor. The logic circuitry that responds to and processes the basic instructions that drive a computer. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1349.jpg"/>
</Figure>

<P>R Receiver. The RapidIO interface input port on a processing element. </P>

<P> </P>

<P>Reliable Transmission (RT). A mode of operation that guarantees packet delivery by retransmitting packets when an error occurs. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1350.jpg"/>
</Figure>

<P>S Sender. The RapidIO interface output port on a processing element. </P>

<P> </P>

<P>Semaphore. A technique for coordinating activities in which multiple processing elements compete for the same resource. </P>

<P> </P>

<P>Serializer. A device which converts parallel data (such as 8-bit data) to a single bit-wide datastream. </P>

<P> </P>

<P>Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>SRAM. Static random access memory. </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on one of its input ports to one of its output ports. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1351.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P>362 RapidIO Trade Association </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Transaction request flow. A sequence of transactions between two processing elements that have a required completion order at the destination processing element. There are no ordering requirements between transaction request flows. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1352.jpg"/>
</Figure>

<P>W Word. A four byte or 32 bit quantity, aligned on four byte boundaries. </P>

<P>Write port. Hardware within a processing element that is the target of a port- write operation. </P>

<P>RapidIO Part 6: LP-Serial Physical Layer Specification Rev. 2.2 </P>

<P> </P>

<P>Blank page </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1353.jpg"/>
</Figure>

<P>RapidIOTM Interconnect Specification Part 7: System and Device Inter-operability Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1354.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.1 </P>
</TD>

<TD>
<P>First public release </P>
</TD>

<TD>
<P>04/06/2001 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.2 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev. 1.1 errata rev. 1.1.1, errata 3 </P>
</TD>

<TD>
<P>06/26/2002 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: incorporate Rev 1.2 errata 1 as applicable, the following errata showings: </P>

<P>004-05-00002.002 </P>

<P>Converted to ISO-friendly templates </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: errata showing 06-02-00001.005 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction........................................................................................................... 11 </P>

<P>1.2 Overview............................................................................................................... 11 </P>

<P> </P>

<P> </P>

<P>Chapter 2 System Exploration and Initialization </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 13 </P>

<P>2.2 Boot code access ................................................................................................... 13 </P>

<P>2.3 Exploration and initialization................................................................................ 15 </P>

<P>2.3.1 Exploration and initialization rules................................................................... 15 </P>

<P>2.3.2 Exploration and initialization algorithm ........................................................... 16 </P>

<P>2.3.3 Exploration and initialization example ............................................................. 16 </P>

<P> </P>

<P> </P>

<P>Chapter 3 RapidIO Device Class Requirements </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 21 </P>

<P>3.2 Class Partitioning .................................................................................................. 21 </P>

<P>3.2.1 Generic: All devices.......................................................................................... 21 </P>

<P>3.2.1.1 General requirements .................................................................................... 21 </P>

<P>3.2.1.2 Operation support as target ........................................................................... 22 </P>

<P>3.2.1.3 Operation support as source.......................................................................... 23 </P>

<P>3.2.2 Class 1: Simple target device............................................................................ 23 </P>

<P>3.2.2.1 General requirements .................................................................................... 23 </P>

<P>3.2.2.2 Operation support as target ........................................................................... 23 </P>

<P>3.2.2.3 Operation support as source.......................................................................... 23 </P>

<P>3.2.3 Class 2: Simple mastering device ..................................................................... 23 </P>

<P>3.2.3.1 General requirements .................................................................................... 23 </P>

<P>3.2.3.2 Operation support as target ........................................................................... 23 </P>

<P>3.2.3.3 Operation support as source.......................................................................... 24 </P>

<P>3.2.4 Class 3: Complex mastering device.................................................................. 24 </P>

<P>3.2.4.1 General requirements .................................................................................... 24 </P>

<P>3.2.4.2 Operation support as target ........................................................................... 24 </P>

<P>3.2.4.3 Operation support as source.......................................................................... 25 </P>

<P> </P>

<P> </P>

<P>Chapter 4 PCI Considerations </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 27 </P>

<P>4.2 Address Map Considerations ................................................................................ 28 </P>

<P>4.3 Transaction Flow .................................................................................................. 29 </P>

<P>4.3.1 PCI 2.2 Transaction Flow ................................................................................. 29 </P>

<P>4.3.2 PCI-X Transaction Flow ................................................................................... 32 </P>

<P> </P>

<P>RapidIO Trade Association 3 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>4.4 RapidIO to PCI Transaction Mapping .................................................................. 33 </P>

<P>4.5 Operation Ordering and Transaction Delivery ..................................................... 35 </P>

<P>4.5.1 Operation Ordering ........................................................................................... 35 </P>

<P>4.5.2 Transaction Delivery Ordering ......................................................................... 36 </P>

<P>4.5.3 PCI-X Relaxed Ordering Considerations ......................................................... 36 </P>

<P>4.6 Interactions with Globally Shared Memory.......................................................... 37 </P>

<P>4.6.1 I/O Read Operation Details............................................................................... 40 </P>

<P>4.6.1.1 Internal Request State Machine .................................................................... 40 </P>

<P>4.6.1.2 Response State Machine ............................................................................... 40 </P>

<P>4.6.2 Data Cache Flush Operation Details................................................................. 41 </P>

<P>4.6.2.1 Internal Request State Machine .................................................................... 41 </P>

<P>4.6.2.2 Response State Machine ............................................................................... 41 </P>

<P>4.7 Byte Lane and Byte Enable Usage ....................................................................... 41 </P>

<P>4.8 Error Management ................................................................................................ 41 </P>

<P> </P>

<P> </P>

<P>Chapter 5 Globally Shared Memory Devices </P>

<P> </P>

<P>5.1 Introduction........................................................................................................... 43 </P>

<P>5.2 Processing Element Behavior ............................................................................... 43 </P>

<P>5.2.1 Processor-Memory Processing Element ........................................................... 44 </P>

<P>5.2.1.1 I/O Read Operations ..................................................................................... 44 </P>

<P>5.2.1.1.1 Response State Machine ........................................................................... 44 </P>

<P>5.2.1.1.2 External Request State Machine ............................................................... 45 </P>

<P>5.2.2 Memory-only Processing Element.................................................................... 46 </P>

<P>5.2.2.1 Read Operations............................................................................................ 46 </P>

<P>5.2.2.1.1 Response State Machine ........................................................................... 46 </P>

<P>5.2.2.1.2 External Request State Machine ............................................................... 46 </P>

<P>5.2.2.2 Instruction Read Operations ......................................................................... 47 </P>

<P>5.2.2.2.1 Response State Machine ........................................................................... 47 </P>

<P>5.2.2.2.2 External Request State Machine ............................................................... 48 </P>

<P>5.2.2.3 Read for Ownership Operations ................................................................... 48 </P>

<P>5.2.2.3.1 Response State Machine ........................................................................... 48 </P>

<P>5.2.2.3.2 External Request State Machine ............................................................... 49 </P>

<P>5.2.2.4 Data Cache and Instruction Cache Invalidate Operations ............................ 50 </P>

<P>5.2.2.4.1 Response State Machine ........................................................................... 50 </P>

<P>5.2.2.4.2 External Request State Machine ............................................................... 50 </P>

<P>5.2.2.5 Castout Operations........................................................................................ 51 </P>

<P>5.2.2.5.1 External Request State Machine ............................................................... 51 </P>

<P>5.2.2.6 Data Cache Flush Operations ....................................................................... 51 </P>

<P>5.2.2.6.1 Response State Machine ........................................................................... 51 </P>

<P>5.2.2.6.2 External Request State Machine ............................................................... 52 </P>

<P>5.2.2.7 I/O Read Operations ..................................................................................... 53 </P>

<P>5.2.2.7.1 Response State Machine ........................................................................... 53 </P>

<P>5.2.2.7.2 External Request State Machine ............................................................... 53 </P>

<P>5.2.3 Processor-only Processing Element.................................................................. 55 </P>

<P>5.2.3.1 Read Operations............................................................................................ 55 </P>

<P> </P>

<P>4 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>5.2.3.1.1 Internal Request State Machine ................................................................ 55 </P>

<P>5.2.3.1.2 Response State Machine ........................................................................... 55 </P>

<P>5.2.3.1.3 External Request State Machine ............................................................... 56 </P>

<P>5.2.3.2 Instruction Read Operations ......................................................................... 56 </P>

<P>5.2.3.2.1 Internal Request State Machine ................................................................ 56 </P>

<P>5.2.3.2.2 Response State Machine ........................................................................... 56 </P>

<P>5.2.3.2.3 External Request State Machine ............................................................... 57 </P>

<P>5.2.3.3 Read for Ownership Operations ................................................................... 58 </P>

<P>5.2.3.3.1 Internal Request State Machine ................................................................ 58 </P>

<P>5.2.3.3.2 Response State Machine ........................................................................... 58 </P>

<P>5.2.3.3.3 External Request State Machine ............................................................... 58 </P>

<P>5.2.3.4 Data Cache and Instruction Cache Invalidate Operations ............................ 59 </P>

<P>5.2.3.4.1 Internal Request State Machine ................................................................ 59 </P>

<P>5.2.3.4.2 Response State Machine ........................................................................... 59 </P>

<P>5.2.3.4.3 External Request State Machine ............................................................... 60 </P>

<P>5.2.3.5 Castout Operations........................................................................................ 60 </P>

<P>5.2.3.5.1 Internal Request State Machine ................................................................ 60 </P>

<P>5.2.3.5.2 Response State Machine ........................................................................... 60 </P>

<P>5.2.3.6 TLB Invalidate Entry, TLB Invalidate Entry Synchronize Operations ........ 61 </P>

<P>5.2.3.6.1 Internal Request State Machine ................................................................ 61 </P>

<P>5.2.3.6.2 Response State Machine ........................................................................... 61 </P>

<P>5.2.3.6.3 External Request State Machine ............................................................... 61 </P>

<P>5.2.3.7 Data Cache Flush Operations ....................................................................... 61 </P>

<P>5.2.3.7.1 Internal Request State Machine ................................................................ 61 </P>

<P>5.2.3.7.2 Response State Machine ........................................................................... 62 </P>

<P>5.2.3.7.3 External Request State Machine ............................................................... 62 </P>

<P>5.2.3.8 I/O Read Operations ..................................................................................... 62 </P>

<P>5.2.3.8.1 External Request State Machine ............................................................... 62 </P>

<P>5.2.4 I/O Processing Element .................................................................................... 64 </P>

<P>5.2.4.1 I/O Read Operations ..................................................................................... 64 </P>

<P>5.2.4.1.1 Internal Request State Machine ................................................................ 64 </P>

<P>5.2.4.1.2 Response State Machine ........................................................................... 64 </P>

<P>5.2.4.2 Data Cache Flush Operations ....................................................................... 64 </P>

<P>5.2.4.2.1 Internal Request State Machine ................................................................ 65 </P>

<P>5.2.4.2.2 Response State Machine ........................................................................... 65 </P>

<P>5.2.5 Switch Processing Element............................................................................... 65 </P>

<P>5.3 Transaction to Priority Mappings ......................................................................... 65 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>2-1 Example system with boot ROM ....................................................................................14 </P>

<P>2-2 Automatically finding the boot ROM .............................................................................14 </P>

<P>2-3 Example system ..............................................................................................................16 </P>

<P>2-4 Finding the adjacent device ............................................................................................17 </P>

<P>2-5 Finding the device on switch port 0 ................................................................................18 </P>

<P>2-6 Finding the device on switch port 1 ................................................................................18 </P>

<P>2-7 Finding the device on switch port 3 ................................................................................19 </P>

<P>2-8 Final initialized system state ...........................................................................................19 </P>

<P>4-1 Example System with PCI and RapidIO.........................................................................27 </P>

<P>4-2 Host segment PCI Memory Map Example .....................................................................28 </P>

<P>4-3 AMT and Memory Mapping...........................................................................................29 </P>

<P>4-4 PCI Mastered Posted Write Transaction Flow Diagram ................................................30 </P>

<P>4-5 PCI Mastered non-posted (delayed) Transaction Flow Diagram ...................................31 </P>

<P>4-6 RapidIO Mastered Transaction .......................................................................................32 </P>

<P>4-7 PCI-X Mastered Split Response Transaction .................................................................33 </P>

<P>4-8 Traditional Non-coherent I/O Access Example ..............................................................37 </P>

<P>4-9 Traditional Globally Coherent I/O Access Example ......................................................38 </P>

<P>4-10 RapidIO Locally Coherent I/O Access Example ............................................................39 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank Page </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>4-1 PCI 2.2 to RapidIO Transaction Mapping ......................................................................33 </P>

<P>4-2 PCI-X to RapidIO Transaction Mapping ........................................................................34 </P>

<P>4-3 Packet priority assignments for PCI ordering .................................................................36 </P>

<P>4-4 Packet priority assignments for PCI-X ordering.............................................................37 </P>

<P>5-1 Transaction to Priority Mapping ....................................................................................66 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank Page </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>This chapter provides an overview of the RapidIO Part 7: System and Device Inter-operability Specification document. This document assumes that the reader is familiar with the RapidIO specifications, conventions, and terminology. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>The RapidIO Architectural specifications set a framework to allow a wide variety of implementations. This document provides a standard set of device and system design solutions to provide for inter-operability. </P>

<P> </P>

<P>Each chapter addresses a different design topic. This revision of the system and device inter-operability specification document covers the following issues: </P>

<P> </P>

<P>Chapter 2, &#8220;System Exploration and Initialization&#8221; Chapter 3, &#8220;RapidIO Device Class Requirements&#8221; Chapter 4, &#8220;PCI Considerations&#8221; </P>

<P>Chapter 5, &#8220;Globally Shared Memory Devices&#8221; </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 System Exploration and </P>

<P>Initialization </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>There are several basic ways of exploring and initializing a RapidIO system. The simplest method is to somehow define the power-up state of the system components such that all devices have adequate knowledge of the rest of the system to communicate as needed. This is frequently accomplished by shifting initialization information into all of the devices in the machine at boot time from serial ROMs or similar devices. This method is most applicable for relatively static systems and systems where boot-up time is important. A second method, having processors explore and configure the system at boot time, requires more time but is much more flexible in order to support relatively fast changing plug-and-play or hot-swap systems. This document describes a simple form of this second method. A much more detailed multiple host exploration and configuration algorithm utilizing the same system reset requirements is specified in the RapidIO Interconnect Specification Annex 1: Software/System Bring Up Specification. </P>

<P> </P>

<P> </P>

<P>2.2 Boot code access </P>

<P> </P>

<P>In most RapidIO applications system initialization requires software for exploring and initializing devices. This is typically done by a processor or set of processors in the system. The boot code for the processor(s) may reside in a ROM local to the processor(s) or on a remote RapidIO agent device. A method of accessing the boot code through an uninitialized system is required if the boot code is located on a remote RapidIO agent device. </P>

<P> </P>

<P>After resetting, a processor typically vectors to a fixed address and issues a code fetch. The agent hardware between the processor and the RapidIO fabric is required to take this read request and map it automatically to a NREAD transaction. The transaction is also mapped to a dedicated device ID at the proper address offset to find the boot code. All devices between the processor and the agent device where the boot ROM resides shall default to a state that will route the NREAD transaction to the boot ROM device and route the response back to the processor. The device ID for the agent device where the boot ROM resides is device ID=0xFE (0x00FE for </P>

<P>16-bit device IDs). The processor default device IDs are assigned sequentially starting at 0x00 (0x0000 for 16-bit device IDs). </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 13 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor device ID=0x?? </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 2 </P>

<P> </P>

<P> </P>

<P>Port 1 </P>

<P> </P>

<P>device ID=0xFE </P>

<P>Agent </P>

<P> </P>

<P>device ID=0x?? </P>

<P> </P>

<P>Port 3 </P>

<P>Switch Agent </P>

<P> </P>

<P> </P>

<P>Port 0 </P>

<P>boot ROM </P>

<P> </P>

<P> </P>

<P> </P>

<P>device ID=0x?? </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1355.jpg"/>
</Figure>

<P>Figure 2-1. Example system with boot ROM </P>

<P> </P>

<P>Figure 2-1 shows an example system with the boot ROM residing on an Agent device. The default routing state for the switch device between the processor and the agent shall allow all requests to device ID=0xFE to get to the agent device and all response packets to get from the agent device back to the processor. This means that the switch may also have to know the device ID that the processor will be using while fetching boot code (processor device IDs are assigned starting at 0x00 as described above). For the example in Figure 2-2, the system processor defaults to device ID=0x00, and the switch&#8217;s default state routes device ID=0x00 to port 2. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor device ID=0x00 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 2 </P>

<P> </P>

<P> </P>

<P>Port 1 </P>

<P> </P>

<P>device ID=0xFE </P>

<P>Agent </P>

<P> </P>

<P>device ID=0x?? </P>

<P> </P>

<P>Port 3 </P>

<P>Switch Agent </P>

<P> </P>

<P> </P>

<P>Port 0 </P>

<P>boot ROM </P>

<P> </P>

<P> </P>

<P> </P>

<P>device ID=0x?? </P>

<P> </P>

<P>Agent </P>

<P>Request </P>

<P>Response </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1356.jpg"/>
</Figure>

<P>Figure 2-2. Automatically finding the boot ROM </P>

<P> </P>

<P>Once the processor is able to begin running boot code, it can begin executing the exploration and initialization of the rest of the system. </P>

<P> </P>

<P> </P>

<P>14 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>2.3 Exploration and initialization </P>

<P> </P>

<P>This example algorithm addresses the simple case of a system with a single processor that is responsible for exploring and initializing a system, termed a Host. The exploration and initialization process starts with a number of rules that the component and system designers shall follow. </P>

<P> </P>

<P> </P>

<P>2.3.1  Exploration and initialization rules </P>

<P>1. A Host shall be able to &#8220;reach&#8221; all agent devices that it is to be responsible for. </P>

<P>This may require mechanisms to generate third party transactions to reach devices that are not transparently visible. </P>

<P>2. Maintenance responses generated by agent and switch devices shall be sent to the port that the maintenance request was received on. For example, consider a device that implements a 5 port switch. The system Host issues a maintenance read request to the switch device, which is received on input port 3. The switch, upon generating the maintenance response to the maintenance read request, must route it to output port 3 even though the switch may have been configured by default to route the response to a port other than port 3 (when the switch is configured it should also route the response to port 3). </P>

<P>3. All devices have CSRs to assist with exploration and initialization procedures. </P>

<P>The registers used in this example contain the following information: </P>

<P>&#8211; Base device ID register - This is the default device ID for the device, and it resides in a standard register in the CSR space at offset 0x60. At power-up, the base device ID defaults to logic 0xFF for all agent devices (0xFFFF for 16-bit route fields), with the exception of the boot code device and the Host device. The boot code device (if present) will have it&#8217;s device ID default to 0xFE and the Host device will have it&#8217;s device ID default to 0x00 as described in Section 2.2. A device may have multiple device IDs, but only this architecturally defined device ID is used in the exploration and initialization procedure. </P>

<P>&#8211; Master Enable bit - the Master Enable bit is reset at power-up for agent devices and set for Host devices. The Master Enable bit is located in the RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification or the RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specification Port General Control CSR at block offset 0x3C. If the Master Enable bit is clear the agent device is not allowed to issue requests and is only able to respond to received requests. This bit is used by the system Host to control when agents are allowed to issue transactions into the system. Switches are by default enabled and do not have a Master Enable bit. </P>

<P>&#8211; Discovered bit - the Discovered bit is reset at power-up for agent devices and set for the Host device, and is located in the 8/16 </P>

<P>LP-LVDS or 1x/4x LP-Serial physical layer Port General Control </P>

<P> </P>

<P>RapidIO Trade Association 15 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>CSR at block offset 0x3C. The system Host device sets this bit when the device has been discovered through the exploration mechanism. The Discovered bit is useful for detecting routing loops, and for hot plug or swap environments. </P>

<P> </P>

<P> </P>

<P>2.3.2  Exploration and initialization algorithm </P>

<P> </P>

<P>If the above rules are followed, all agent devices are now accessible either as an end point that responds to any maintenance transaction or, for switches, via the hop_count mechanism. </P>

<P> </P>

<P>The basic algorithm is to explore the system through each end point in sequence by first locating the adjacent device by sending a maintenance read to device ID=0xFF and hop count= 0x00, which is guaranteed to cause the adjacent device to respond. That device is then configured to reach the next device by assigning it a unique base device ID other than 0xFF, setting up route tables to reach the next device, etc. </P>

<P> </P>

<P>When all devices in the system have been identified and have unique base device IDs assigned (no devices have a base device ID value=0xFF), the Host can then complete the final device ID assignment and configuration required for the application and enable agent devices to issue requests. </P>

<P> </P>

<P> </P>

<P>2.3.3  Exploration and initialization example </P>

<P> </P>

<P>Figure 2-3 shows the previous example of a small single Host system. </P>

<P> </P>

<P>Following the rules defined above, the base device ID value for all devices except the Host and boot ROM device after reset is applied is 0xFF, the Host has it&#8217;s Master Enable and Discovered bits set, and the agent devices have their Master Enable and Discovered bits cleared. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P> </P>

<P>device ID=0x00 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 2 </P>

<P> </P>

<P> </P>

<P>Port 1 </P>

<P> </P>

<P>device ID=0xFE </P>

<P>Agent </P>

<P> </P>

<P>device ID=0xFF </P>

<P> </P>

<P>Port 3 </P>

<P>Switch Agent </P>

<P> </P>

<P> </P>

<P>Port 0 </P>

<P>boot ROM </P>

<P> </P>

<P> </P>

<P> </P>

<P>device ID=0xFF </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1357.jpg"/>
</Figure>

<P>Figure 2-3. Example system </P>

<P> </P>

<P>16 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>Assigning the Host&#8217;s base device ID=0x00 is the first step in the process. The next step is to find the adjacent device, so the Host sends a maintenance read of offset </P>

<P>0x00_0000 to device ID=0xFF and hop_count=0x00. The switch consumes the request because the hop_count field is equal to zero and responds by sending the contents of it&#8217;s Device Identity and Information CARs back to the port the request came from. From the returned information, the software on the Host can identify this as  a  switch. The Host  then  reads the switch port information CAR at  offset </P>

<P>0x00_0014 to find out which port it is connected to. The response indicates a 4 port switch (which the Host may have already known from the device information register), connected to port 2. </P>

<P> </P>

<P>The Host then examines the default routing tables for the switch to find the port route for the boot device ID=0xFE so it can preserve the path to the boot code (which it may still be running), and discovers that the boot device is located through port 1 of the switch. It also sets the switch&#8217;s Discovered bit. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P> </P>

<P>device ID=0x00 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 2 </P>

<P> </P>

<P>Port 1 </P>

<P>device ID=0xFE </P>

<P>Agent </P>

<P> </P>

<P>device ID=0xFF </P>

<P> </P>

<P> </P>

<P>Port 3 </P>

<P>Switch Agent </P>

<P> </P>

<P>Port 0 </P>

<P>boot ROM </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>device ID=0xFF </P>

<P> </P>

<P>Agent </P>

<P>Request </P>

<P>Response </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1358.jpg"/>
</Figure>

<P>Figure 2-4. Finding the adjacent device </P>

<P> </P>

<P>The next step is for the Host to configure the switch to route device ID=0xFF to port </P>

<P>0 and device ID=0x00 to port 2 (which it already was because of the boot device in the system) via maintenance write requests to hop_count=0x00. The Host then issues another maintenance read request, this time to device ID=0xFF and hop_count=0x01. The switch discovers that it is not the final destination of the maintenance request packet, so it decrements the hop_count and routes the packet to port 0 and on to the attached agent device. The agent device responds, and the switch routes the response packet to device ID=0x00 back through port 2 to the Host. Again, software identifies the device, sets its Discovered bit, configures it as required, and assigns the base device ID=0x01. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P> </P>

<P>base device ID=0x00 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 2 </P>

<P> </P>

<P> </P>

<P>Port 1 </P>

<P> </P>

<P>base device ID=0xFE </P>

<P>Agent </P>

<P> </P>

<P>device ID=0xFF </P>

<P> </P>

<P> </P>

<P>Port 3 </P>

<P>Switch Agent </P>

<P> </P>

<P> </P>

<P>Port 0 </P>

<P>boot ROM </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P>base device ID=0xFF </P>

<P> </P>

<P>Request </P>

<P>Response </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1359.jpg"/>
</Figure>

<P>Figure 2-5. Finding the device on switch port 0 </P>

<P> </P>

<P>The Host then modifies the routing tables to now route device ID=0x01 to port 0. Since the boot device is located through port 1, instead of modifying the routing tables to route device ID=0xFF to port 1, the Host issues a maintenance read of device ID=0xFE (the boot device) and hop_count=0x01. The response identifies the agent on port 1, sets the agent&#8217;s Discovered bit, and configures it as necessary, leaving the base device ID=0xFE so the Host can continue to execute the boot code. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P> </P>

<P>base device ID=0x00 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 2 </P>

<P> </P>

<P> </P>

<P>Port 1 </P>

<P> </P>

<P>base device ID=0xFE </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Port 3 </P>

<P>Switch Agent </P>

<P>boot ROM </P>

<P>base device ID=0xFF </P>

<P>Port 0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P>base device ID=0x01 </P>

<P> </P>

<P>Request </P>

<P>Response </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1360.jpg"/>
</Figure>

<P>Figure 2-6. Finding the device on switch port 1 </P>

<P> </P>

<P>For the next iteration, the Host sets the switch device routing table entry for device </P>

<P>ID=0xFF to route to port 3 (the Host already knows it is directly connected to port </P>

<P>2), and issues the maintenance read transaction as before. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P> </P>

<P>base device ID=0x00 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 2 </P>

<P> </P>

<P> </P>

<P>Port 1 </P>

<P> </P>

<P>base device ID=0xFE </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Port 3 </P>

<P>Switch Agent </P>

<P>boot ROM </P>

<P>base device ID=0xFF </P>

<P>Port 0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P>base device ID=0x01 </P>

<P> </P>

<P>Request </P>

<P>Response </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1361.jpg"/>
</Figure>

<P>Figure 2-7. Finding the device on switch port 3 </P>

<P> </P>

<P>When the end point only agent responds with the requested CAR information the Host now knows that exploration is completed (there are no other paths to follow through the fabric), and can finalize configuring the system as shown in Figure 2-8. The agent devices can then have their Master Enable bits set so they can begin to issue transactions into the initialized system. The boot device ID can be changed, if desired, when the Host completes executing code from the boot ROM. </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P> </P>

<P>base device ID=0x00 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 2 </P>

<P> </P>

<P> </P>

<P>Port 1 </P>

<P> </P>

<P>base device ID=0x04 </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Port 3 </P>

<P>Switch Agent </P>

<P>boot ROM </P>

<P>base device ID=0x02 </P>

<P>Port 0 </P>

<P> </P>

<P>base device ID=0x01 </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1362.jpg"/>
</Figure>

<P>Figure 2-8. Final initialized system state </P>

<P> </P>

<P>Variants to this procedure may be desirable. For example, a system may wish to enable some devices before exploration has been completed. </P>

<P> </P>

<P>More complex systems with multiple Hosts, failed Host recovery, and hot swap requirements can be addressed with more complex algorithms utilizing the Host </P>

<P> </P>

<P>RapidIO Trade Association 19 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>base device ID Lock Register and the Component Tag Register in standard registers in the CSR space at offsets 0x68 and 0x6C. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>20 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 RapidIO Device Class Requirements </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>The RapidIO Architecture specifications allow for a variety of implementations. In order to form standard points of support for RapidIO, this chapter describes the requirements for RapidIO devices adhering to the RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification or the RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specification and corresponding to different measures of functionality. Three device &#8220;classes&#8221; are defined, each with a minimum defined measure of support. The first class defines the functionality of the least capable device, with subsequent classes expanding the measure of support, in order to establish levels of inter-operability. </P>

<P> </P>

<P> </P>

<P>3.2 Class Partitioning </P>

<P> </P>

<P>Each class includes the functionality defined in all previous class devices and defines the minimum additional functionality for that class. A device is not required to comply exactly with a class, but may optionally supply additional features as a value-add for that device. All functions that are not required in any class list are also optional value-adds for a device. </P>

<P> </P>

<P>First is a set of requirements that are applicable to all RapidIO compliant devices, including switch devices without end point functionality. </P>

<P> </P>

<P> </P>

<P>3.2.1  Generic: All devices </P>

<P> </P>

<P>3.2.1.1  General requirements </P>

<P>&#8226; One or more 8/16 LP-LVDS and/or 1x/4x LP-Serial ports </P>

<P>&#8212; (refer to RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification </P>

<P>and/or RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specification) </P>

<P>&#8226; Support for small (8-bit) transport device ID fields </P>

<P>&#8212; (refer to RapidIO Part 3: Common Transport Specification, Section 2.4) </P>

<P>&#8226; Ability to accept requests with all sourceID and destinationID values on exit from reset </P>

<P>&#8212; (refer to RapidIO Part 3: Common Transport Specification, Section 2.3) </P>

<P>&#8226; Support for recovery from a single corrupt packet or control symbol </P>

<P>&#8212; (refer to RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification, </P>

<P> </P>

<P>RapidIO Trade Association 21 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Section 1.3.5) and/or RapidIO Part 6: 1x/4x LP-Serial Physical Layer </P>

<P>Specification, Section 5.10.2) </P>

<P>&#8226; Support for packet retry protocol </P>

<P>&#8212; (refer to RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification, Section 1.2.4) and/or RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specification, Section 5.6) </P>

<P>&#8226; Support for throttle based flow control on 8/16 LP-LVDS physical layer ports </P>

<P>&#8212; (refer to RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification, Section 2.3) </P>

<P>&#8226; Support for transaction ordering for flowID B </P>

<P>&#8212; (end point programmability for all flow levels is recommended) </P>

<P>&#8212; (refer to RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification, Section 1.2.2) and/or RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specification, Section 5.3.3) </P>

<P>&#8226; Switch devices maintain error coverage internally </P>

<P>&#8212; (refer to RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification, Section 1.3.6) and/or RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specification, Section 5.5) </P>

<P>&#8226; Support for maximum size (276 byte) packets for switch devices </P>

<P>&#8212; (refer to RapidIO Part 4: 8/16 LP-LVDS Physical Layer Specification, Section 1.4) and/or RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specification, Section 2.4) </P>

<P>&#8226; Support for maximum size (256 byte) data payloads for end point devices </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>3.1.2) </P>

<P>&#8226; Device must contain the following registers: </P>

<P>&#8211; Device Identity CAR </P>

<P>&#8211; Device Information CAR </P>

<P>&#8211; Assembly Identity CAR </P>

<P>&#8211; Assembly Information CAR </P>

<P>&#8211; Processing Element Features CAR </P>

<P>&#8211; Source Operations CAR </P>

<P>&#8211; Destination Operations CAR </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section 4.4) </P>

<P> </P>

<P>3.2.1.2  Operation support as target </P>

<P>&#8226; Maintenance read </P>

<P>&#8212; (switch targeted by hop_count transport field) </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P> </P>

<P> </P>

<P>22 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.1, Section 3.1.10) </P>

<P>&#8226; Maintenance write </P>

<P>&#8212; (switch targeted by hop_count transport field) </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.3.1, Section 3.1.10) </P>

<P> </P>

<P>3.2.1.3  Operation support as source </P>

<P>&#8226; &lt;none&gt; </P>

<P> </P>

<P> </P>

<P>3.2.2  Class 1: Simple target device </P>

<P> </P>

<P>3.2.2.1  General requirements </P>

<P>&#8226; all Generic requirements </P>

<P>&#8226; Support for 34-bit address packet formats </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>4.4.5) </P>

<P> </P>

<P>3.2.2.2  Operation support as target </P>

<P>&#8226; all Generic requirements </P>

<P>&#8226; Write </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.2, Section 3.1.7) </P>

<P>&#8226; Streaming-write </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.2, Section 3.1.8) </P>

<P>&#8226; Write-with-response </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.3, Section 3.1.7) </P>

<P>&#8226; Read </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.1, Section 3.1.5) </P>

<P> </P>

<P>3.2.2.3  Operation support as source </P>

<P>&#8226; all Generic requirements </P>

<P> </P>

<P> </P>

<P>3.2.3  Class 2: Simple mastering device </P>

<P> </P>

<P>3.2.3.1  General requirements </P>

<P>&#8226; all Class 1 requirements </P>

<P> </P>

<P>3.2.3.2  Operation support as target </P>

<P>&#8226; all Class 1 requirements </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 23 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.2.3.3  Operation support as source </P>

<P>&#8226; all Class 1 requirements </P>

<P>&#8226; Maintenance read </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.3.1, Section 3.1.10) </P>

<P>&#8226; Maintenance write </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.3.1, Section 3.1.10) </P>

<P>&#8226; Write </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.2, Section 3.1.7) </P>

<P>&#8226; Streaming-write </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.2, Section 3.1.8) </P>

<P>&#8226; Write-with-response </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.3, Section 3.1.7) </P>

<P>&#8226; Read </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.1, Section 3.1.5) </P>

<P> </P>

<P> </P>

<P>3.2.4  Class 3: Complex mastering device </P>

<P> </P>

<P>3.2.4.1  General requirements </P>

<P>&#8226; all Class 2 requirements </P>

<P> </P>

<P>3.2.4.2  Operation support as target </P>

<P>&#8226; all Class 2 requirements </P>

<P>&#8226; Atomic set </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.4, Section 3.1.7) </P>

<P>&#8226; Maintenance port-write </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.3.1, Section 3.1.10) </P>

<P>&#8226; Data message mailbox 0, letter 0, single segment, 8 byte payload </P>

<P>&#8212; (refer to RapidIO Part 2: Message Passing Logical Specification, Section </P>

<P>2.2.2, Section 3.1.5) </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>3.2.4.3  Operation support as source </P>

<P>&#8226; all Class 2 requirements </P>

<P>&#8226; Atomic set </P>

<P>&#8212; (refer to RapidIO Part 1: Input/Output Logical Specification, Section </P>

<P>2.2.4, Section 3.1.7) </P>

<P>&#8226; Data message mailbox 0, letter 0, single segment, 8 byte payload </P>

<P>&#8212; (refer to RapidIO Part 2: Message Passing Logical Specification, Section </P>

<P>2.2.2, Section 3.1.5) </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 PCI Considerations </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>

<P>RapidIO contains a rich enough set of operations and capabilities to allow transport of legacy interconnects such as PCI1. While RapidIO and PCI share similar functionality, the two interconnects have different protocols thus requiring a translation function to move transactions between them. A RapidIO to PCI bridge processing element is required to make the necessary translation between the two interconnects. This chapter describes architectural considerations for an implementation of a RapidIO to PCI bridge processing element. This chapter is not intended as an implementation instruction manual, rather, it is to provide direction to the bridge processing element architect and aid in the development of interoperable devices. For this chapter it is assumed that the reader has a thorough understanding of the PCI 2.2 and/or the PCI-X 1.0 specifications. </P>

<P> </P>

<P>Figure 4-1 shows a typical system with devices connected using various RapidIO and PCI bus segments. A host bridge is connected to various peripherals via a PCI bus. A RapidIO bridge is used to translate PCI formatted transactions to the equivalent RapidIO operations to allow access to the rest of the system, including additional subordinate PCI bus segments. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P>Mem </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI 0 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO </P>

<P> </P>

<P>Periph 5 </P>

<P> </P>

<P> </P>

<P>RapidIO </P>

<P>PCI 2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Host </P>

<P>to PCI bridge </P>

<P>RapidIO </P>

<P>Switch </P>

<P>to PCI bridge </P>

<P> </P>

<P>RapidIO </P>

<P>Periph 4 </P>

<P>CPU Bridge </P>

<P>Periph 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Periph 2 </P>

<P>to PCI bridge </P>

<P>Periph 3 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1363.jpg"/>
</Figure>

<P>Host Bus Segment </P>

<P> </P>

<P>PCI 1 </P>

<P> </P>

<P>Figure 4-1. Example System with PCI and RapidIO </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1364.jpg"/>
</Figure>

<P>1For additional information on the Peripheral Component Interconnect PCI refer to the PCI 2.2 and the PCI-X 1.0 specifications. </P>

<P> </P>

<P>RapidIO Trade Association 27 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Where RapidIO is introduced into a legacy system, it is desirable to limit changes to software. For transactions which must travel between RapidIO and PCI it is necessary to map address spaces defined on the PCI bus to those of RapidIO, translate PCI transaction types to RapidIO operations, and maintain the producer/consumer requirements of the PCI bus. This chapter will address each of these considerations for both PCI version 2.2 and PCI-X. </P>

<P> </P>

<P> </P>

<P>4.2 Address Map Considerations </P>

<P> </P>

<P>PCI defines three physical address spaces, specifically, the memory, I/O memory, and configuration spaces. RapidIO, on the other hand, only addresses memory and configuration space. This section discusses memory space. Configuration space is discussed in Section 4.4. Figure 4-2 shows a simple example of the PCI memory and I/O address spaces for a host bus segment. In order for devices on the PCI bus to communicate with those connected through RapidIO, it is necessary to provide a memory mapping function. The example PCI host memory map uses a 32-bit physical address space resulting in 4 Gbytes of total address space. Host memory is shown at the bottom of the address map and peripheral devices at the top. Consider that the RapidIO to PCI bridge processing element contains a specified window(s) of address space mapped to it using the PCI base address register(s)1. The example shown in Figure 4-2 illustrates the RapidIO bridge address window located in an arbitrary software defined location. Likewise, if it was desired to communicate with PCI legacy I/O devices over RapidIO an I/O window would be assigned to the RapidIO to PCI bridge as shown. </P>

<P> </P>

<P> </P>

<P>PCI Memory Space </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Host </P>

<P>Memory </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>RapidIO Bridge </P>

<P>Window </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Peripheral 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Peripheral 2 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>0 </P>

<P>PCI I/O Space </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1365.jpg"/>
</Figure>

<P>0 </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Bridge Window </P>

<P> </P>

<P>4G </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>4G </P>

<P> </P>

<P>Figure 4-2. Host segment PCI Memory Map Example </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1366.jpg"/>
</Figure>

<P>Any transactions issued to the bus segment with an address that matches the RapidIO bridge window will be captured by the RapidIO to PCI bridge for forwarding. Once the transaction has been accepted by the RapidIO to PCI bridge processing element it must be translated to the proper RapidIO context as shown in </P>

<P> </P>

<P>1Refer to the PCI 2.2 Specification Chapter 6 for a discussion on PCI address maps and configuration registers </P>

<P> </P>

<P>28 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>Figure 4-3. For the purposes of this discussion this function is called the Address Mapping and Translation function (AMT). The AMT function is responsible for translating PCI addresses to RapidIO addresses as well as the translation and assignment of the respective PCI and RapidIO transaction types. The address space defined by the RapidIO bridge window may represent more than one subordinate RapidIO target device. A device on PCI bus segment 0 shown in Figure 4-1 may require access to a peripheral on PCI bus 1, bus 2, or RapidIO Peripheral 5. Because RapidIO uses source addressing (device IDs), the AMT is responsible for translating the PCI address to both a target device ID and associated offset address. In addition to address translation, RapidIO attributes, transaction types, and other necessary delivery information are established. </P>

<P> </P>

<P>Similarly, transactions traveling from a RapidIO bus to a PCI bus must also pass through the AMT function. The address and transaction type are translated back into PCI format, and the AMT selects the appropriate address for the transaction. Memory mapping is relied upon for all transactions bridged between PCI and RapidIO. </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI Memory </P>

<P> </P>

<P>PCI Memory </P>

<P> </P>

<P> </P>

<P>RapidIO bridge </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1367.jpg"/>
</Figure>

<P>Address block </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1368.jpg"/>
</Figure>

<P> </P>

<P>P3 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1369.jpg"/>
</Figure>

<P>I/O CFG </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1370.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1371.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1372.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1373.jpg"/>
</Figure>

<P>AMT </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1374.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1375.jpg"/>
</Figure>

<P>RapidIO Device ID OxXX </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1376.jpg"/>
</Figure>

<P>Mem I/O CFG </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1377.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>AMT </P>

<P>P3 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1378.jpg"/>
</Figure>

<P>I/O CFG </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1379.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1380.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1381.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1382.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 4-3. AMT and Memory Mapping </P>

<P> </P>

<P> </P>

<P>4.3 Transaction Flow </P>

<P> </P>

<P>In considering the mapping of the PCI bus to RapidIO it is important to understand the transaction flow of PCI transactions through RapidIO. </P>

<P> </P>

<P> </P>

<P>4.3.1  PCI 2.2 Transaction Flow </P>

<P> </P>

<P>The PCI 2.2 specification defines two classes of transaction types, posted and non-posted. Figure 4-4 shows the route taken by a PCI-RapidIO posted write transaction. Once the request is sent from the PCI Master on the bus, it is claimed by </P>

<P> </P>

<P>RapidIO Trade Association 29 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>the bridge processing element which uses the AMT to translate it into a RapidIO request. Only when the transaction is in RapidIO format can it be posted to the RapidIO target. In some cases it may be desirable to guarantee end to end delivery of the posted write transaction. For this case the RapidIO NWRITE_R transaction is used which results in a response as shown in the figure. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI </P>

<P>PCI Master </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1383.jpg"/>
</Figure>

<P>PCI Bus </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1384.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1385.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1386.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1387.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1388.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1389.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1390.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1391.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1392.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1393.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1394.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1395.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1396.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1397.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1398.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1399.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1400.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>PCI Posted </P>

<P>PCI to RapidIO    Request </P>

<P>Bridge </P>

<P>Processing </P>

<P>Element </P>

<P>Translation </P>

<P>to RapidIO Request </P>

<P>RapidIO Transaction Completion </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1401.jpg"/>
</Figure>

<P>RapidIO </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1402.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1403.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1404.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1405.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1406.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1407.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1408.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1409.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1410.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1411.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1412.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1413.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1414.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1415.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1416.jpg"/>
</Figure>

<P>RapidIO Request </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1417.jpg"/>
</Figure>

<P>Optional RapidIO Response </P>

<P> </P>

<P> </P>

<P>RapidIO Target </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1418.jpg"/>
</Figure>

<P>Figure 4-4. PCI Mastered Posted Write Transaction Flow Diagram </P>

<P> </P>

<P>A non-posted PCI transaction is shown in Figure 4-5. The transaction is mastered by the PCI agent on the PCI bus and accepted by the RapidIO to PCI bridge. The transaction is retried on the PCI bus if the bridge is unable to complete it within the required timeout period. In this case the transaction is completed as a delayed transaction. The transaction is translated to the appropriate RapidIO operation and issued on the RapidIO port. At some time later a RapidIO response is received and the results are translated back to PCI format. When the PCI master subsequently retries the transaction, the delayed results are returned and the operation is completed. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI </P>

<P>PCI Master </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1419.jpg"/>
</Figure>

<P>PCI Bus </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1420.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1421.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1422.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1423.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1424.jpg"/>
</Figure>

<P>PCI Transaction </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1425.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1426.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1427.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1428.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1429.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1430.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1431.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1432.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1433.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1434.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1435.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1436.jpg"/>
</Figure>

<P>PCI to RapidIO    Request </P>

<P>Bridge Processing Element </P>

<P>(Delayed) Transaction Results </P>

<P>Translation </P>

<P>to RapidIO Request </P>

<P>RapidIO </P>

<P>to PCI </P>

<P>Translation </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1437.jpg"/>
</Figure>

<P>RapidIO </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1438.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1439.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1440.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1441.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1442.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1443.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1444.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1445.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1446.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1447.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1448.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1449.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1450.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1451.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1452.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1453.jpg"/>
</Figure>

<P>RapidIO Request </P>

<P>RapidIO Response </P>

<P> </P>

<P> </P>

<P>RapidIO Target </P>

<P> </P>

<P> </P>

<P>Figure 4-5. PCI Mastered non-posted (delayed) Transaction Flow Diagram </P>

<P> </P>

<P>Because PCI allows unbounded transaction data tenures, it may be necessary for the RapidIO to PCI bridge to break the single PCI transaction into multiple RapidIO operations. In addition, RapidIO does not have byte enables and therefore does not support sparse byte transactions. For this case the transaction must be broken into multiple operations as well. &#8220;Section 4.7, Byte Lane and Byte Enable Usage&#8221; on page 41 describes this situation in more detail. </P>

<P> </P>

<P>A RapidIO mastered operation is shown in Figure 4-6. For this case the RapidIO request transaction is received at the RapidIO to PCI bridge. The bridge translates the request into the appropriate PCI command which is then issued to the PCI bus. The PCI target may complete the transaction as a posted, non-posted, or delayed non-posted transaction depending on the command type. Once the command is successfully completed on the PCI bus the results are translated back into the RapidIO format and a response transaction is issued back to the RapidIO Master. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Master </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1454.jpg"/>
</Figure>

<P>RapidIO </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1455.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1456.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1457.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1458.jpg"/>
</Figure>

<P>RapidIO </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1459.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1460.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1461.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI to RapidIO Bridge Processing Element </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1462.jpg"/>
</Figure>

<P>PCI </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1463.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1464.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1465.jpg"/>
</Figure>

<P>Request </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1466.jpg"/>
</Figure>

<P>RapidIO </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1467.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1468.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1469.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1470.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Request Transaction RapidIO </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1471.jpg"/>
</Figure>

<P>Request Translation PCI </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1472.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1473.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1474.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1475.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1476.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1477.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1478.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1479.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1480.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1481.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Target </P>

<P>PCI </P>

<P>Response </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1482.jpg"/>
</Figure>

<P>RapidIO </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1483.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1484.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1485.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Translation to </P>

<P>RapidIO </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1486.jpg"/>
</Figure>

<P>Results Transaction (Delayed) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1487.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1488.jpg"/>
</Figure>

<P>PCI Bus </P>

<P> </P>

<P> </P>

<P>Figure 4-6. RapidIO Mastered Transaction </P>

<P> </P>

<P> </P>

<P>4.3.2  PCI-X Transaction Flow </P>

<P> </P>

<P>The flow of transactions described in the previous section applies to the PCI-X bus as well. PCI-X supports split transactions instead of delayed transactions. The example shown in Figure 4-7 illustrates a transaction completed with a PCI-X split completion. The PCI-X master issues a transaction. The RapidIO to PCI-X bridge determines that it must complete the transaction as a split transaction, and responds with a split response. The transaction is translated to RapidIO and a request is issued on the RapidIO port. The RapidIO target returns a response transaction which is translated to a PCI-X Split Completion transaction completing the operation. PCI-X allows up to a 4 Kilobyte request. Larger PCI-X requests must be broken into multiple RapidIO operations. The RapidIO to PCI-X bridge may return the results back to the PCI-X Master using multiple Split Completion transactions in a pipelined fashion. Since PCI-X only allows devices to disconnect on 128 byte boundaries it is advantageous to break the large PCI-X request into either 128 or 256 byte RapidIO operations. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>PCI </P>

<P>PCI-X Master </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1489.jpg"/>
</Figure>

<P>PCI Bus </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1490.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1491.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1492.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1493.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1494.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1495.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1496.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1497.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1498.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1499.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1500.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1501.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1502.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1503.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1504.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>PCI-X </P>

<P>Transaction </P>

<P>Request </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>PCI to RapidIO Bridge Processing Element </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Translation to RapidIO Request </P>

<P>PCI-X Split Response </P>

<P>Split Completion Transaction(s) </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO to PCI-X Translation </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1505.jpg"/>
</Figure>

<P>RapidIO </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1506.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1507.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1508.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1509.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1510.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1511.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1512.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1513.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1514.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1515.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1516.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1517.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1518.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1519.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1520.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1521.jpg"/>
</Figure>

<P>RapidIO Request(s) </P>

<P>RapidIO Response(s) </P>

<P> </P>

<P> </P>

<P>RapidIO Target </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1522.jpg"/>
</Figure>

<P>Figure 4-7. PCI-X Mastered Split Response Transaction </P>

<P> </P>

<P> </P>

<P>4.4 RapidIO to PCI Transaction Mapping </P>

<P> </P>

<P>The RapidIO I/O and GSM specifications include the necessary transactions types to map all PCI transactions. Table 4-1 lists the map of transactions between PCI and RapidIO. A mapping mechanism such as the AMT function described in Section 4.2 is necessary to assign the proper transaction type based on the address space for which the transaction is targeted. </P>

<P> </P>

<P>Table 4-1. PCI 2.2 to RapidIO Transaction Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P>PCI Command </P>
</TD>

<TD>
<P>RapidIO Transaction </P>
</TD>

<TD>
<P>Comment </P>
</TD>
</TR>

<TR>
<TD>
<P>Interrupt-acknowledge </P>
</TD>

<TD>
<P>NREAD </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Special-cycle </P>
</TD>

<TD>
<P>NWRITE </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>I/O-read </P>
</TD>

<TD>
<P>NREAD </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>I/O-write </P>
</TD>

<TD>
<P>NWRITE_R </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Memory-read, Memory-Read-Line, Memory-Read-Multiple </P>
</TD>

<TD>
<P>NREAD or </P>

<P>IO_READ_HOME </P>
</TD>

<TD>
<P>The PCI memory read transactions can be represented by the NREAD operation. If the operation is targeted to hardware maintained globally coherent memory address space then the I/O Read operation must be used (see &#8220;Section 4.6, Interactions with Globally Shared Memory&#8221; on page 37.) </P>
</TD>
</TR>

<TR>
<TD>
<P>Memory-write, Memory-write-and-&#61472; invalidate </P>
</TD>

<TD>
<P>NWRITE, NWRITE_R, or FLUSH </P>
</TD>

<TD>
<P>The PCI Memory Write and Memory-Write-and-Invalidate can be represented by the NWRITE operation. If reliable delivery of an individual write transaction is desired then the NWRITE_R is used. If the operation is targeted to hardware maintained globally coherent memory address space then the Data Cache Flush operation must be used (refer to &#8220;Section 4.6, Interactions with Globally Shared Memory&#8221; on page 37.) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-1. PCI 2.2 to RapidIO Transaction Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P>PCI Command </P>
</TD>

<TD>
<P>RapidIO Transaction </P>
</TD>

<TD>
<P>Comment </P>
</TD>
</TR>

<TR>
<TD>
<P>Configuration-read </P>
</TD>

<TD>
<P>NREAD </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Configuration-write </P>
</TD>

<TD>
<P>NWRITE_R </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>PCI 2.2 memory transactions do not specify a size. It is possible for a PCI master to read a continuous stream of data from a target or to write a continuous stream of data to a target. Because RapidIO is defined to have a maximum data payload of 256 bytes, PCI transactions that are longer than 256 bytes must be broken into multiple RapidIO operations. </P>

<P> </P>

<P>Table 4-2 shows the transaction mapping between PCI-X and RapidIO. </P>

<P>Table 4-2. PCI-X to RapidIO Transaction Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P>PCI-X Command </P>
</TD>

<TD>
<P>RapidIO Transaction </P>
</TD>

<TD>
<P>Comment </P>
</TD>
</TR>

<TR>
<TD>
<P>Interrupt-acknowledge </P>
</TD>

<TD>
<P>NREAD </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Special-cycle </P>
</TD>

<TD>
<P>NWRITE </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>I/O-read </P>
</TD>

<TD>
<P>NREAD </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>I/O-write </P>
</TD>

<TD>
<P>NWRITE_R </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Memory-read DWORD </P>
</TD>

<TD>
<P>NREAD or </P>

<P>IO_READ_HOME </P>
</TD>

<TD>
<P>The PCI-X memory read DWORD transactions can be represented by the NREAD operation. If the operation is targeted to hardware maintained coherent memory address space then the I/O Read operation must be used (refer to &#8220;Section 4.6, Interactions with Globally Shared Memory&#8221; on page 37.) This is indicated in PCI-X using the No Snoop (NS) bit described in Section 2.5 of the PCI-X 1.0 specification. </P>
</TD>
</TR>

<TR>
<TD>
<P>Memory-write </P>
</TD>

<TD>
<P>NWRITE, NWRITE_R, or FLUSH </P>
</TD>

<TD>
<P>The PCI-X Memory Write and Memory-Write-and-Invalidate can be represented by the NWRITE operation. If reliable delivery of an individual write transaction is desired then the NWRITE_R is used. If the operation is targeted to hardware maintained coherent memory address space then the Data Cache Flush operation must be used (refer to &#8220;Section 4.6, Interactions with Globally Shared Memory&#8221; on page 37.) This is indicated in PCI-X using the No Snoop (NS) bit described in Section 2.5 of the PCI-X 1.0 specification. </P>
</TD>
</TR>

<TR>
<TD>
<P>Configuration-read </P>
</TD>

<TD>
<P>NREAD </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Configuration-write </P>
</TD>

<TD>
<P>NWRITE_R </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>Split Completion </P>
</TD>

<TD>
<P>-- </P>
</TD>

<TD>
<P>The Split Completion transaction is the result of a request on the PCI-X bus that was terminated by the target with a Split Response. In the case of the RapidIO to PCI-X bridge this would be the artifact of a transaction that either the bridge mastered and received a split response or was the target and issued a split response. This command is equivalent to a RapidIO response transaction and does not traverse the bridge. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-2. PCI-X to RapidIO Transaction Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P>PCI-X Command </P>
</TD>

<TD>
<P>RapidIO Transaction </P>
</TD>

<TD>
<P>Comment </P>
</TD>
</TR>

<TR>
<TD>
<P>Memory-read-block </P>
</TD>

<TD>
<P>NREAD or </P>

<P>IO_READ_HOME </P>
</TD>

<TD>
<P>The PCI-X memory read transactions can be represented by the NREAD operation. If the operation is targeted to hardware maintained globally coherent memory address space then the I/O Read operation must be used (refer to &#8220;Section 4.6, Interactions with Globally Shared Memory&#8221; on page 37.) This is indicated in PCI-X using the No Snoop (NS) bit described in Section 2.5 of the PCI-X 1.0 specification. </P>
</TD>
</TR>

<TR>
<TD>
<P>Memory-write-block </P>
</TD>

<TD>
<P>NWRITE, NWRITE_R, or FLUSH </P>
</TD>

<TD>
<P>The PCI-X Memory Write and Memory-Write-and-Invalidate can be represented by the NWRITE operation. If reliable delivery of an individual write transaction is desired then the NWRITE_R is used. If the operation is targeted to hardware maintained globally coherent memory address space then the Data Cache Flush operation must be used (refer to &#8220;Section 4.6, Interactions with Globally Shared Memory&#8221; on page 37.) This is indicated in PCI-X using the No Snoop (NS) bit described in Section 2.5 of the PCI-X 1.0 specification. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The PCI-X addendum to the PCI specification adds the ability to do split operations. This results in an operation being broken into a Split Request and one or more Split Completions. As a target of a PCI-X Split Request, the RapidIO to PCI bridge may reply with a Split Response and complete the request using multiple RapidIO operations. The results of these operations are issued on the PCI-X bus as Split Completions. If the RapidIO to PCI-X bridge is the initiator of a Split Request, the target may also indicate that it intends to run the operation as a split transaction with a Split Response. In this case the target would send the results to the RapidIO to PCI-X bridge using Split Completions. </P>

<P> </P>

<P> </P>

<P>4.5 Operation Ordering and Transaction Delivery </P>

<P> </P>

<P>This section discusses what the RapidIO to PCI bridge must do to address the requirements of the ordering rules of the PCI specifications. </P>

<P> </P>

<P> </P>

<P>4.5.1  Operation Ordering </P>

<P> </P>

<P>Section 1.2.1 of the RapidIO Part 1: Input/Output Logical Specification describes a set of ordering rules. The rules guarantee ordered delivery of write data and that results of read operations will contain any data that was previously written to the same location. </P>

<P> </P>

<P>For bridge devices, the PCI 2.2 specification has the additional requirement that the results of a read command push ahead posted writes in both directions. </P>

<P> </P>

<P>In order for the RapidIO to PCI bridge to be consistent with the PCI 2.2 ordering rules it is necessary to follow the transaction ordering rules listed in section 1.2.1 of the I/O logical specification. In addition, the RapidIO to PCI bridge is required to adhere to the following RapidIO rule: </P>

<P> </P>

<P>Read responses must push ahead all write requests and write responses. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.5.2  Transaction Delivery Ordering </P>

<P> </P>

<P>The RapidIO 8/16 LP-LVDS and 1x/4x LP-Serial physical layer specifications describe the mechanisms by which transaction ordering and delivery occur through the system. When considering the requirements for the RapidIO to PCI bridge it is first necessary to follow the transaction delivery ordering rules in section 1.2.4.1 of the 8/16 LP-LVDS specification and/or Section 5.8 of the 1x/4x LP-Serial specification. Further, it is necessary to add additional constraints to maintain programming model compatibility with PCI. </P>

<P> </P>

<P>As described in Section 4.5.1 above, PCI has an additional transaction ordering requirement over RapidIO. In order to guarantee inter-operability, transaction ordering, and deadlock free operation, it is recommended that devices be restricted to utilizing transaction request flow level 0. In addition, it is recommended that response transactions follow a more strict priority assignment. Table 4-3 illustrates the priority assignment requirements for transactions in the PCI to RapidIO environment. </P>

<P> </P>

<P>Table 4-3. Packet priority assignments for PCI ordering </P>

<P> </P>

<Table>
<TR>
<TD>
<P>RapidIO packet type </P>
</TD>

<TD>
<P>priority </P>
</TD>

<TD>
<P>comment </P>
</TD>
</TR>

<TR>
<TD>
<P>read request </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>This will push write requests and responses ahead </P>
</TD>
</TR>

<TR>
<TD>
<P>write request </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Forces writes to complete in order, but allows write requests to bypass read requests </P>
</TD>
</TR>

<TR>
<TD>
<P>read response </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Will force completion of preceding write requests and allows bypass of read requests </P>
</TD>
</TR>

<TR>
<TD>
<P>write response </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>Will prevent NWRITE_R request based deadlocks </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The PCI transaction ordering model requires that a RapidIO device not issue a read request into the system unless it has sufficient resources available to receive and process a higher priority write or response packet in order to prevent deadlock. PCI </P>

<P>2.2 states that read responses cannot pass write transactions. The RapidIO specification provides PCI ordering by issuing priority 0 to read requests, and priority 1 to read responses and PCI writes. Since read responses and writes are issued at the same priority, the read responses will not pass writes. </P>

<P> </P>

<P> </P>

<P>4.5.3  PCI-X Relaxed Ordering Considerations </P>

<P> </P>

<P>The PCI-X specification defines an additional ordering feature called relaxed ordering. If the PCI-X relaxed ordering attribute is set for a read transaction, the results for the read transaction are allowed to pass posted write transactions. PCI-X read transactions with this bit set allow the PCI-X to RapidIO bridge to ignore the rule described in Section 4.5.1. Table 4-4 shows the results of this additional </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>function. </P>

<P> </P>

<P> </P>

<P>Table 4-4. Packet priority assignments for PCI-X ordering </P>

<P> </P>

<Table>
<TR>
<TD>
<P>RapidIO packet type </P>
</TD>

<TD>
<P>priority </P>
</TD>

<TD>
<P>comment </P>
</TD>
</TR>

<TR>
<TD>
<P>read request </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>This will push write requests and responses ahead </P>
</TD>
</TR>

<TR>
<TD>
<P>write request </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Forces writes to complete in order, but allows write requests to bypass of read requests </P>
</TD>
</TR>

<TR>
<TD>
<P>read response </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>When PCI-X Relaxed Ordering attribute is set to 0. Will force completion of preceding write requests and allows bypass of read requests </P>
</TD>
</TR>

<TR>
<TD>
<P>read response </P>
</TD>

<TD>
<P>2, 3 </P>
</TD>

<TD>
<P>When PCI-X Relaxed Ordering attribute is set to 1. The endpoint may promote the read response to higher priority to allow it to move ahead of posted writes. </P>
</TD>
</TR>

<TR>
<TD>
<P>write response </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>

<P>4.6 Interactions with Globally Shared Memory </P>

<P> </P>

<P>Traditional systems have two notions of system or subsystem cache coherence. The first, non-coherent, means that memory accesses have no effect on the caches in the system. The memory controller reads and writes memory directly, and any cached address becomes incoherent in the system. This behavior requires that all cache coherence with I/O be  managed using software mechanisms, as  illustrated in Figure 4-8. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1523.jpg"/>
</Figure>

<P>Processor cache </P>

<P>Processor cache </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1524.jpg"/>
</Figure>

<P>Local Interconnect </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1525.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1526.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Interconnect Fabric </P>

<P> </P>

<P>Request </P>

<P>Response </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1527.jpg"/>
</Figure>

<P>Figure 4-8. Traditional Non-coherent I/O Access Example </P>

<P> </P>

<P>The second notion of system cache coherence is that of global coherence. An I/O access to memory causes a snoop cycle to be issued on the processor bus, keeping all of the system caches coherent with the memory, as illustrated in Figure 4-9. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor </P>

<P>Processor </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1528.jpg"/>
</Figure>

<P>cache cache </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1529.jpg"/>
</Figure>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1530.jpg"/>
</Figure>

<P>snoop </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1531.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Local Interconnect </P>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Interconnect Fabric </P>

<P> </P>

<P> </P>

<P>Request </P>

<P>Response </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1532.jpg"/>
</Figure>

<P>Figure 4-9. Traditional Globally Coherent I/O Access Example </P>

<P> </P>

<P>With RapidIO globally shared systems, there is no common bus that can be used in order to issue the snoop, so global coherence requires special hardware support beyond simply snooping the bus. This leads to a third notion of cache coherence, termed local coherence. For local coherence, a snoop on a processor bus local to the targeted memory controller can be used to keep those caches coherent with that part of memory, but not caches associated with other memory controllers, as illustrated in Figure 4-10. Therefore, what once was regarded in a system as a &#8220;coherent access&#8221; is no longer globally coherent, but only locally coherent. Typically, deciding to snoop or not snoop the local processor caches is either determined by design or system architecture policy (always snoop or never snoop), or by an attribute associated with the physical address being accessed. In PCI-X, this attribute is the No Snoop (NS) bit described in Section 2.5 of the PCI-X 1.0 specification. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Processor cache </P>

<P> </P>

<P> </P>

<P>snoop </P>

<P>Processor cache </P>

<P> </P>

<P> </P>

<P>snoop </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Agent </P>

<P>Agent </P>

<P> </P>

<P> </P>

<P>Memory </P>

<P>Memory </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Interconnect Fabric </P>

<P> </P>

<P> </P>

<P>Request </P>

<P>Response </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1533.jpg"/>
</Figure>

<P>Figure 4-10. RapidIO Locally Coherent I/O Access Example </P>

<P> </P>

<P>In order to preserve the concept of global cache coherence for a system, the RapidIO Part 5: Globally Shared Memory Logical Specification defines several operations that allow a RapidIO to PCI bridge processing element to access data in the globally shared space without having to implement all of the cache coherence protocol. These operations are the I/O Read and Data Cache Flush operations (globally shared memory specification, sections 3.2.9 and 3.2.10). For PCI-X bridging, these operations can also be used as a way to encode the NO SNOOP attribute for locally as well as globally coherent transactions. The targeted memory controller can be designed to understand the required behavior of such a transaction. These encodings also are useful for tunneling PCI-X transactions between PCI-X bridge devices. </P>

<P> </P>

<P>The data payload for an I/O Read operation is defined as the size of the coherence granule for the targeted globally shared memory domain. However, the Data Cache Flush   operation   allows   coherence   granule,   sub-coherence   granule,   and sub-double-word writes to be performed. </P>

<P> </P>

<P>The IO_READ_HOME transaction is used to indicate to the GSM memory controller that the memory access is globally coherent, so the memory controller finds the latest copy of the requested data within the coherence domain (the requesting RapidIO to PCI bridge processing element is, by definition, not in the coherence domain) without changing the state of the participant caches. Therefore, the I/O Read operation allows the RapidIO to PCI bridge to cleanly extract data from a coherent portion of the system with minimal disruption and without having to be a full participant in the coherence domain. </P>

<P> </P>

<P>The Data Cache Flush operation has several uses in a coherent part of a system. One </P>

<P> </P>

<P>RapidIO Trade Association 39 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>such use is to allow a RapidIO to PCI bridge processing element to write to globally shared portions of the system memory. Analogous to the IO_READ_HOME transaction, the FLUSH transaction is used to indicate to the GSM memory controller that the access is globally coherent. The memory controller forces all of the caches in the coherence domain to invalidate the coherence granule if they have a shared copy (or return the data to memory if one had ownership of the data), and then writes memory with the data supplied with the FLUSH request. This behavior allows the I/O device to cleanly write data to the globally shared address space without having to be a full participant in the coherence domain. </P>

<P> </P>

<P>Since the RapidIO to PCI bridge processing element is not part of the coherence domain, it is never the target of a coherent operation. </P>

<P> </P>

<P> </P>

<P>4.6.1  I/O Read Operation Details </P>

<P> </P>

<P>Most of the complexity of the I/O Read operation resides in the memory controller. For the RapidIO to PCI Bridge processing element the I/O Read operation requires some additional attention over the non-coherent read operation. The necessary portions of the I/O Read state machine description in Section 6.10 of the globally shared memory specification are extracted below. Refer to Chapter 6 of the GSM specification for state machine definitions and conventions. The GSM specification takes precedence in the case of any discrepancies between the corresponding portions of the GSM specification and this description. </P>

<P> </P>

<P>4.6.1.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to the remote globally shared memory space. </P>

<P> </P>

<P>remote_request(IO_READ_HOME, mem_id, my_id); </P>

<P> </P>

<P>4.6.1.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect. </P>

<P> </P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case DONE_INTERVENTION: // must be from third party&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_only_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>// wait for a DATA_ONLY&#61472;&#61472;</P>

<P>case DATA_ONLY: // this is due to an intervention, a&#61472;&#61472;</P>

<P>// DONE_INTERVENTION should come&#61472;&#61472;</P>

<P>// separately&#61472;&#61472;</P>

<P>set_received_data_only_message();&#61472;&#61472;</P>

<P>if (received_done_message)&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P> </P>

<P>40 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P> </P>

<P>remote_request(IO_READ_HOME, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>4.6.2  Data Cache Flush Operation Details </P>

<P> </P>

<P>As with the I/O Read operation, the complexity for the Data Cache Flush operation resides in the memory controller. The necessary portions of the Data Cache Flush state machine description from Section 6.10 of the GSM logical specification are extracted below. Refer to Chapters 2 and 3 of the GSM specification to determine the size of data payloads for the FLUSH transaction. The GSM specification takes precedence in the case of any discrepancies between the corresponding portions of the GSM specification and this description. </P>

<P> </P>

<P>4.6.2.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to the remote globally shared memory space. </P>

<P> </P>

<P>remote_request(FLUSH, mem_id, my_id, data); </P>

<P> </P>

<P>4.6.2.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>remote_request(FLUSH, received_srcid, my_id, data);&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>4.7 Byte Lane and Byte Enable Usage </P>

<P> </P>

<P>PCI makes use of byte enables and allows combining and merging of transactions. This may have the result of write transactions with sparse valid bytes. In order to save on transaction overhead, RapidIO does not include byte enables. RapidIO does, however, support a set of byte encodings defined in Chapter 3 of the RapidIO Part </P>

<P>1: Input/Output Logical Specification. PCI to RapidIO operations may be issued with sparse bytes. Should a PCI write transaction with byte enables that do not match a RapidIO byte encoding be issued to a RapidIO to PCI bridge, that operation must be broken into multiple valid RapidIO operations. </P>

<P> </P>

<P> </P>

<P>4.8 Error Management </P>

<P> </P>

<P>Errors that are detected on a PCI bus are signaled using side band signals. The treatment of these signals is left to the system designer and is outside of the PCI specifications. Likewise, this document does not recommend any practices for the delivery of error interrupts in the system. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 Globally Shared Memory Devices </P>

<P> </P>

<P> </P>

<P>5.1 Introduction </P>

<P> </P>

<P>Different processing elements have different requirements when participating in a RapidIO GSM environment. The GSM protocols and address collision tables are written from the point of view of a fully integrated processing element comprised of a local processor, a memory controller, and an I/O controller. Obviously, the complexity and implementation requirements for this assumed device are much greater than required for a typical design. This chapter assumes that the reader is familiar with the RapidIO Part 5: Globally Shared Memory Logical Specification. </P>

<P> </P>

<P>Additionally, this chapter contains the 8/16 LP-LVDS and 1x/4x LP-Serial physical layer transaction to priority mappings to guarantee that a system maintains cache coherence and is deadlock free. </P>

<P> </P>

<P> </P>

<P>5.2 Processing Element Behavior </P>

<P> </P>

<P>In Chapter 2 of the globally shared memory specification are a number of examples of possible processing elements: </P>

<P>&#8226; A processor-memory processing element </P>

<P>&#8226; A memory-only processing element </P>

<P>&#8226; A processor-only processing element </P>

<P>&#8226; An I/O processing element </P>

<P>&#8226; A switch processing element </P>

<P> </P>

<P>Of all of these, only the switch processing element does not have to implement anything additional to exist in a GSM system or sub-system. All of the remaining processing element types are of interest, and all are likely to exist in some form in the marketplace. This chapter is intended to define the portions of the protocol necessary to implement each of these devices. Other processing elements are allowed by the globally shared memory specification, for example, a memory-I/O processing element. The portions of the protocol necessary to implement these devices are not addressed in this chapter. </P>

<P> </P>

<P>The behaviors described in this chapter have been extracted directly from revision </P>

<P>1.1 of the globally shared memory specification, and may be out of date with respect to the latest revision of that document. The GSM specification takes precedence in </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>the case that there are discrepancies between it and this chapter. </P>

<P> </P>

<P> </P>

<P>5.2.1  Processor-Memory Processing Element </P>

<P> </P>

<P>This processing element is very nearly the same as the assumed processing element used for the state machine description in Chapter 6, and requires nearly all of the described functionality. The following operation behavior is not changed from the Chapter 6 descriptions: </P>

<P>&#8226; Read </P>

<P>&#8226; Instruction read </P>

<P>&#8226; Read for ownership </P>

<P>&#8226; Data cache and instruction cache invalidate </P>

<P>&#8226; Castout </P>

<P>&#8226; TLB invalidate entry and TLB invalidate entry synchronize </P>

<P>&#8226; Data cache flush </P>

<P> </P>

<P>This leaves the I/O Read operation. Since the processor-memory processing element does not contain an I/O device, this processing element will not generate the I/O read operation, but is required to respond to it. This removes the internal request state machine and portions of the response state machine, requiring the behavior described in Section 2.1.1 below. The only exception to this is the special case where there exists multiple coherence domains. It is possible that a processor in one coherence domain may wish to read data in another coherence domain and thus would require support of the I/O Read operation. </P>

<P> </P>

<P>5.2.1.1  I/O Read Operations </P>

<P> </P>

<P>This operation is used for I/O reads of globally shared memory space. </P>

<P> </P>

<P>5.2.1.1.1  Response State Machine </P>

<P> </P>

<P>This machine handles responses to requests made to the RapidIO interconnect made on behalf of a third party. </P>

<P> </P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER,                                                                 // data comes from memory, mimic&#61472;&#61472;</P>

<P>// intervention&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // spin or wait for castout&#61472;&#61472;</P>

<P> </P>

<P>44 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>remote_request(IO_READ_OWNER, received_srcid, my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error(); </P>

<P>error();&#61472;&#61472;</P>

<P>5.2.1.1.2  External Request State Machine </P>

<P> </P>

<P>This machine handles requests from the system to the local memory or the local processor. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif (IO_READ_HOME) // remote request to our local memory&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_request(READ_LATEST);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// after push completes&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(IO_READ_OWNER, mask_id, my_id, received_srcid);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // IO_READ_OWNER request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ_LATEST); // spin until a valid response from&#61472;&#61472;</P>

<P>// the caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push;&#61472;&#61472;</P>

<P>// wait for it&#61472;&#61472;</P>

<P>if (received_srcid == received_secid)&#61472;&#61472;</P>

<P>// original requestor is also home&#61472;&#61472;</P>

<P>// module&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>remote_response(DATA_ONLY, received_secid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id);&#61472;&#61472;</P>

<P>case INVALID: // must have cast it out during&#61472;&#61472;</P>

<P>// an address collision&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 45 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.2.2  Memory-only Processing Element </P>

<P> </P>

<P>This processing element is simpler than the assumed processing element used in Chapter 6, removing all of the internal request state machines and portions of all of the external request and response state machines. A memory-only processing element does not receive TLB invalidate entry or TLB invalidate synchronize operations. The required behavior for each operation is described below. </P>

<P> </P>

<P>5.2.2.1  Read Operations </P>

<P> </P>

<P>This operation is a coherent data cache read. </P>

<P> </P>

<P>5.2.2.1.1  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of a third party. </P>

<P> </P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER,                                                                 // data comes from memory, &#61472;&#61472;</P>

<P>// mimic intervention&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>5.2.2.1.2  External Request State Machine </P>

<P> </P>

<P>This state machine handles read requests from the system to the local memory. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // READ_HOME&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_request(READ);&#61472;&#61472;</P>

<P> </P>

<P>46 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>update_state(SHARED, received_srcid);&#61472;&#61472;</P>

<P>// after possible push completes&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>update_state(SHARED, received_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>if (mask_id ~= received_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>// intervention case&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, mask_id,&#61472;&#61472;</P>

<P>my_id, received_srcid);&#61472;&#61472;</P>

<P> </P>

<P>error(); // he already owned it; &#61472;&#61472;</P>

<P>// cache paradox (or I-fetch after d-&#61472;&#61472;</P>

<P>// store if not fixed elsewhere)&#61472;&#61472;</P>

<P> </P>

<P>5.2.2.2  Instruction Read Operations </P>

<P> </P>

<P>This operation is a partially coherent instruction cache read. </P>

<P> </P>

<P>5.2.2.2.1  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of a third party. </P>

<P> </P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER, // data comes from memory, &#61472;&#61472;</P>

<P>// mimic intervention&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>update_state(SHARED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 47 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.2.2.2.2  External Request State Machine </P>

<P> </P>

<P>This state machine handles instruction read requests from the system to the local memory. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // IREAD_HOME&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_request(READ);&#61472;&#61472;</P>

<P>update_state(SHARED, received_srcid);&#61472;&#61472;</P>

<P>// after possible push completes&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>update_state(SHARED, received_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>if (mask_id ~= received_srcid) &#61472;&#61472;</P>

<P>// intervention case&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, mask_id,&#61472;&#61472;</P>

<P>my_id, received_srcid);&#61472;&#61472;</P>

<P>else // he already owned it in his &#61472;&#61472;</P>

<P>//data cache; cache paradox case&#61472;&#61472;</P>

<P>remote_request(READ_OWNER, mask_id, my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>5.2.2.3  Read for Ownership Operations </P>

<P> </P>

<P>This is the coherent cache store miss operation. </P>

<P> </P>

<P>5.2.2.3.1  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of a third party. </P>

<P> </P>

<P>switch(received_response)&#61472;&#61472;</P>

<P>case DONE: // invalidates for shared &#61472;&#61472;</P>

<P>// directory states&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P> </P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip the responder&#8217;s shared bit&#61472;&#61472;</P>

<P>endif; // and wait for next DONE&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>// remote_modified case&#61472;&#61472;</P>

<P>update_memory(); // for possible coherence error&#61472;&#61472;</P>

<P>// recovery&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_id);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_id, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER: // data comes from memory, mimic&#61472;&#61472;</P>

<P> </P>

<P>48 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>switch(directory_state)&#61472; case LOCAL_SHARED:&#61472; case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>// intervention&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, original_srcid);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // mask_id must match received_srcid&#61472;&#61472;</P>

<P>// or error condition&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, received_srcid, my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>5.2.2.3.2  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the interconnect to the local memory. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables&#61472;&#61472;</P>

<P>// in Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // READ_TO_OWN_HOME&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// after possible push&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, received_srcid);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>if (mask_id ~= received_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>//intervention case&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, mask_id, my_id,&#61472;&#61472;</P>

<P>received_srcid);&#61472;&#61472;</P>

<P> </P>

<P>error(); // he already owned it!&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P>if (mask == received_srcid)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>//requestor is only remote sharer&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, received_srcid);&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 49 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// from memory&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else //there are other remote sharers&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, (mask ~= received_srcid),&#61472;&#61472;</P>

<P>my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>5.2.2.4  Data Cache and Instruction Cache Invalidate Operations </P>

<P> </P>

<P>This operation is used with coherent cache store-hit-on-shared, cache operations. </P>

<P> </P>

<P>5.2.2.4.1  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of a third party. </P>

<P> </P>

<P>switch(received_response)&#61472;&#61472;</P>

<P>case DONE: // invalidates for shared &#61472;&#61472;</P>

<P>// directory states&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P> </P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, original_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip the responder&#8217;s shared bit&#61472;&#61472;</P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>endif; // and wait for next DONE&#61472;&#61472;</P>

<P> </P>

<P>remote_request({DKILL_SHARER, IKILL_SHARER}, received_srcid,&#61472;&#61472;</P>

<P>my_id); // retry&#61472;&#61472;</P>

<P>error(); </P>

<P>5.2.2.4.2  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // DKILL_HOME or IKILL_HOME&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>if (DKILL_HOME)&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED, // cache paradoxes; DKILL is&#61472;&#61472;</P>

<P>// write-hit-on-shared&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>error();&#61472;&#61472;</P>

<P>case SHARED: // this is the right case, send&#61472;&#61472;</P>

<P>// invalidates to the sharing list&#61472;&#61472;</P>

<P>local_request(DKILL);&#61472;&#61472;</P>

<P>if (mask == received_srcid&#61472;&#61472;</P>

<P>// requestor is only remote sharer&#61472;&#61472;</P>

<P>update_state(REMOTE_MODIFIED, received_srcid);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else // there are other remote sharers&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER,&#61472;&#61472;</P>

<P> </P>

<P>50 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>(mask ~= received_srcid), my_id, NULL);&#61472;&#61472;</P>

<P>else // IKILL goes to everyone except the&#61472;&#61472;</P>

<P>// requestor&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>remote_request(IKILL_SHARER,&#61472;&#61472;</P>

<P>(mask &lt;= (participant_list ~=&#61472;&#61472;</P>

<P>(received_srcid AND my_id), my_id);&#61472;&#61472;</P>

<P> </P>

<P>5.2.2.5  Castout Operations </P>

<P> </P>

<P>This operation is used to return ownership of a coherence granule to home memory, leaving it invalid in the cache. </P>

<P> </P>

<P>5.2.2.5.1  External Request State Machine </P>

<P> </P>

<P>This machine handles requests from the system to the local memory. This may require making further external requests. </P>

<P> </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>state_update(LOCAL_SHARED, my_id); // may be LOCAL_MODIFIED if the&#61472;&#61472;</P>

<P>// default is owned locally&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry(); </P>

<P> </P>

<P>5.2.2.6  Data Cache Flush Operations </P>

<P> </P>

<P>This operation returns ownership of a coherence granule to home memory and performs a coherent write. </P>

<P> </P>

<P>5.2.2.6.1  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of a third party. </P>

<P> </P>

<P>switch(received_response)&#61472;&#61472;</P>

<P>case DONE: // invalidates for shared directory&#61472;&#61472;</P>

<P>// states&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P> </P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id, my_id);&#61472;&#61472;</P>

<P>if (received_data)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>update_memory();&#61472;&#61472;</P>

<P>// with original request or response&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>else&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED); // or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip responder&#8217;s shared bit&#61472;&#61472;</P>

<P>endif; // and wait for next DONE&#61472;&#61472;</P>

<P>case NOT_OWNER:&#61472;&#61472;</P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_SHARED,&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>if (received_data)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>update_memory();&#61472;&#61472;</P>

<P>// with original request&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 51 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, original_srcid);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>switch(directory_state)&#61472; case LOCAL_SHARED,&#61472; case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>remote_response(DONE, original_srcid, my_id);&#61472;&#61472;</P>

<P>if (received_data)&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>update_memory();&#61472;&#61472;</P>

<P>// with original request&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, received_srcid,&#61472;&#61472;</P>

<P>my_id, original_srcid);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>5.2.2.6.2  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // FLUSH&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>// after snoop completes&#61472;&#61472;</P>

<P>if (received_data) // from request or local response&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED, my_id);&#61472;&#61472;</P>

<P>// or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>if (mask_id ~= received_srcid) // owned elsewhere&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_OWNER, mask_id, my_id,&#61472;&#61472;</P>

<P>received_srcid);&#61472;&#61472;</P>

<P>else // requestor owned it; shouldn&#8217;t &#61472;&#61472;</P>

<P>// generate a flush&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>error();&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P>if (mask == received_srcid) // requestor is only remote sharer&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>// after snoop completes&#61472;&#61472;</P>

<P>if (received_data) // from request or response&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>update_state(LOCAL_SHARED, my_id); // or LOCAL_MODIFIED&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>52 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>else //there are other remote sharers&#61472;&#61472;</P>

<P>remote_request(DKILL_SHARER, (mask ~= received_srcid), my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>5.2.2.7  I/O Read Operations </P>

<P> </P>

<P>This operation is used for I/O reads of globally shared memory space. </P>

<P> </P>

<P>5.2.2.7.1  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of a third party. </P>

<P> </P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case INTERVENTION:&#61472;&#61472;</P>

<P>update_memory();&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case NOT_OWNER, // data comes from memory, mimic&#61472;&#61472;</P>

<P>// intervention&#61472;&#61472;</P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>switch(directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED,&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, original_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(DONE_INTERVENTION, original_srcid,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED: // spin or wait for castout&#61472;&#61472;</P>

<P>remote_request(IO_READ_OWNER, received_srcid, my_id,&#61472;&#61472;</P>

<P>my_id);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>5.2.2.7.2  External Request State Machine </P>

<P> </P>

<P>This machine handles requests from the system to the local memory. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // IO_READ_HOME&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>switch (directory_state)&#61472;&#61472;</P>

<P>case LOCAL_MODIFIED:&#61472;&#61472;</P>

<P>local_request(READ_LATEST);&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// after push completes&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case LOCAL_SHARED:&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case REMOTE_MODIFIED:&#61472;&#61472;</P>

<P>remote_request(IO_READ_OWNER, mask_id, my_id, received_srcid);&#61472;&#61472;</P>

<P>case SHARED:&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 53 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>5.2.3  Processor-only Processing Element </P>

<P> </P>

<P>A processor-only processing element is much simpler than the assumed combined processing described in Chapter 6. Much of the internal request, response, and external request state machines are removed. </P>

<P> </P>

<P>5.2.3.1  Read Operations </P>

<P> </P>

<P>This operation is a coherent data cache read. </P>

<P> </P>

<P>5.2.3.1.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision)                                                                 // this is due to an external request&#61472;&#61472;</P>

<P>// in progress or a cache&#61472;&#61472;</P>

<P>local_response(RETRY); // index hazard from a previous request&#61472;&#61472;</P>

<P>else                                                                                             // remote - we&#8217;ve got to go &#61472;&#61472;</P>

<P>// to another module&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY); // can&#8217;t guarantee data before a&#61472;&#61472;</P>

<P>// snoop yet&#61472;&#61472;</P>

<P>remote_request(READ_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P>5.2.3.1.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local processor. </P>

<P> </P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>local_response(SHARED); // when processor re-requests&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case DONE_INTERVENTION: // must be from third party&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_only_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>// wait for a DATA_ONLY&#61472;&#61472;</P>

<P>case DATA_ONLY: // this is due to an intervention, a&#61472;&#61472;</P>

<P>// DONE_INTERVENTIONshould come&#61472;&#61472;</P>

<P>// separately&#61472;&#61472;</P>

<P>local_response(SHARED);&#61472;&#61472;</P>

<P>set_received_data_only_message();&#61472;&#61472;</P>

<P>if (received_done_message)&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>remote_request(READ_HOME, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.2.3.1.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles read requests from the system to the local processor. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // READ_OWNER&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ); // spin until a valid response&#61472;&#61472;</P>

<P>// from caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push;&#61472;&#61472;</P>

<P>// wait for it&#61472;&#61472;</P>

<P>cache_state(SHARED or INVALID);&#61472;&#61472;</P>

<P>// surrender ownership&#61472;&#61472;</P>

<P>if (received_srcid == received_secid)&#61472;&#61472;</P>

<P>// original requestor is also home&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>remote_response(DATA_ONLY, received_secid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>case INVALID: // must have cast it out&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>5.2.3.2  Instruction Read Operations </P>

<P> </P>

<P>This operation is a partially coherent instruction cache read. </P>

<P> </P>

<P>5.2.3.2.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external &#61472;&#61472;</P>

<P>// request in progress or a cache &#61472;&#61472;</P>

<P>local_response(RETRY); // index hazard from a previous request&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go&#61472;&#61472;</P>

<P>// to another module&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>// can&#8217;t guarantee data before a&#61472;&#61472;</P>

<P>// snoop yet&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>remote_request(IREAD_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P>5.2.3.2.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local processor. </P>

<P> </P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>local_response(SHARED); // when processor re-requests&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>56 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>case DONE_INTERVENTION: // must be from third party&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_only_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>// wait for a DATA_ONLY&#61472;&#61472;</P>

<P>case DATA_ONLY: // this is due to an intervention; a&#61472;&#61472;</P>

<P>// DONE_INTERVENTION should come&#61472;&#61472;</P>

<P>// separately&#61472;&#61472;</P>

<P>local_response(SHARED);&#61472;&#61472;</P>

<P>set_received_data_only_message();&#61472;&#61472;</P>

<P>if (received_done_message)&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>remote_request(IREAD_HOME, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P>5.2.3.2.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles instruction read requests from the system to the local processor. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // READ_OWNER request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ); // spin until a valid response&#61472;&#61472;</P>

<P>// from caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push;&#61472;&#61472;</P>

<P>// wait for it&#61472;&#61472;</P>

<P>cache_state(SHARED or INVALID);&#61472;&#61472;</P>

<P>// surrender ownership&#61472;&#61472;</P>

<P>if (received_srcid == received_secid)&#61472;&#61472;</P>

<P>// original requestor is also home&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>remote_response(DATA_ONLY, received_secid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid,&#61472;&#61472;</P>

<P>my_id, data);&#61472;&#61472;</P>

<P>case INVALID: // must have cast it out&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 57 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.2.3.3  Read for Ownership Operations </P>

<P> </P>

<P>This is the coherent cache store miss operation. </P>

<P> </P>

<P>5.2.3.3.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external request&#61472;&#61472;</P>

<P>// in progress or a cache index&#61472;&#61472;</P>

<P>local_response(RETRY); // hazard from a previous request&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go to another&#61472;&#61472;</P>

<P>// module&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472; local_response(RETRY);&#61472; remote_request(READ_TO_OWN_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P>5.2.3.3.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local processor. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case DONE_INTERVENTION:&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>case DATA_ONLY:&#61472;&#61472;</P>

<P>set_received_data_message();&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>if (received_done_message)&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>// wait for DATA_ONLY&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P>endif; // and wait for a DONE&#61472;&#61472;</P>

<P>case RETRY: // lost at remote memory so retry&#61472;&#61472;</P>

<P>remote_request(READ_TO_OWN_HOME, mem_id, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P>5.2.3.3.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the interconnect to the local processor. </P>

<P> </P>

<P>if (address_collision) // use collision tables&#61472;&#61472;</P>

<P>// in Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif(READ_TO_OWN_OWNER // request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN); // spin until a valid response from&#61472;&#61472;</P>

<P>// the caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push&#61472;&#61472;</P>

<P>cache_state(INVALID);&#61472;&#61472;</P>

<P>// surrender ownership&#61472;&#61472;</P>

<P>if (received_srcid == received_secid)&#61472;&#61472;</P>

<P> </P>

<P>58 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>//the original request is from the home&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>else // the original request is from a&#61472;&#61472;</P>

<P>// third party&#61472;&#61472;</P>

<P>remote_response(DATA_ONLY, received_secid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>endif;&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case INVALID: // castout address collision&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>else // DKILL_SHARER request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN);&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case SHARED,&#61472;&#61472;</P>

<P>// spin until a valid response from the&#61472;&#61472;</P>

<P>// caches&#61472;&#61472;</P>

<P>case INVALID: // invalidating for shared cases&#61472;&#61472;</P>

<P>cache_state(INVALID); // surrender copy&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>&#61472;&#61472;</P>

<P>endif; </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>5.2.3.4  Data Cache and Instruction Cache Invalidate Operations </P>

<P> </P>

<P>This operation is used with coherent cache store-hit-on-shared, cache operations. </P>

<P> </P>

<P>5.2.3.4.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external request in &#61472;&#61472;</P>

<P>// progress or a cache index&#61472;&#61472;</P>

<P>local_response(RETRY); // hazard from a previous request&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go to another&#61472;&#61472;</P>

<P>// module&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(RETRY);&#61472;&#61472;</P>

<P>remote_request({DKILL_HOME, IKILL_HOME}, mem_id, my_id);&#61472;&#61472;</P>

<P>5.2.3.4.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local processor. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>local_response(EXCLUSIVE);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>remote_request({DKILL_HOME, IKILL_HOME}, received_srcid,&#61472;&#61472;</P>

<P>my_id); // retry the transaction&#61472;&#61472;</P>

<P>error(); </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.2.3.4.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local processor. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution Tables&#8221;&#61472;&#61472;</P>

<P>else // DKILL_SHARER or IKILL_SHARER request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request({READ_TO_OWN, IKILL});&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case SHARED,&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>// spin until a valid response from the&#61472;&#61472;</P>

<P>// caches&#61472;&#61472;</P>

<P>case INVALID: // invalidating for shared cases&#61472;&#61472;</P>

<P>cache_state(INVALID); // surrender copy&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>5.2.3.5  Castout Operations </P>

<P> </P>

<P>This operation is used to return ownership of a coherence granule to home memory, leaving it invalid in the cache. A processor-only processing element is never the target of a castout operation. </P>

<P> </P>

<P>5.2.3.5.1  Internal Request State Machine </P>

<P> </P>

<P>A castout may require local activity to flush all caches in the hierarchy and break possible reservations. </P>

<P> </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>remote_request(CASTOUT, mem_id, my_id, data); </P>

<P>5.2.3.5.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local processor. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>5.2.3.6  TLB Invalidate Entry, TLB Invalidate Entry Synchronize </P>

<P>Operations </P>

<P> </P>

<P>These operations are used for software coherence management of the TLBs. </P>

<P> </P>

<P>5.2.3.6.1  Internal Request State Machine </P>

<P> </P>

<P>The TLBIE and TLBSYNC transactions are always sent to all domain participants except the sender and are always to the processor, not home memory. </P>

<P> </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>remote_request({TLBIE, TLBSYNC}, participant_id, my_id);&#61472;&#61472;</P>

<P>endif; </P>

<P>5.2.3.6.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local processor. The responses are always from a coherence participant, not a home memory. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>if ((mask ~= (my_id OR received_id)) == 0)&#61472;&#61472;</P>

<P> </P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>// this is the last DONE&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P>mask &lt;= (mask ~= received_srcid);&#61472;&#61472;</P>

<P>// flip the responder&#8217;s participant&#61472;&#61472;</P>

<P>// bit and wait for next DONE&#61472;&#61472;</P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>remote_request({TLBIE, TLBSYNC}, received_srcid, my_id, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P>5.2.3.6.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local memory or the local processor. The requests are always to the local caching hierarchy. </P>

<P> </P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request({TLBIE, TLBSYNC}); // spin until a valid response&#61472;&#61472;</P>

<P>// from the caches&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>free_entry(); </P>

<P> </P>

<P>5.2.3.7  Data Cache Flush Operations </P>

<P> </P>

<P>This operation returns ownership of a coherence granule to home memory and performs a coherent write. </P>

<P> </P>

<P>5.2.3.7.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to remote memory from the local processor. </P>

<P> </P>

<P>if (address_collision) // this is due to an external&#61472;&#61472;</P>

<P>// request in progress or a cache index&#61472;&#61472;</P>

<P>local_response(RETRY); // hazard from a previous request&#61472;&#61472;</P>

<P>else // remote - we&#8217;ve got to go to &#61472;&#61472;</P>

<P>// another module&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>remote_request(FLUSH, mem_id, my_id, data);&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 61 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P>endif; </P>

<P>5.2.3.7.2  Response State Machine </P>

<P>// data is optional&#61472;&#61472;</P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect on behalf of the local processor. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>remote_request(FLUSH, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>// data is optional&#61472;&#61472;</P>

<P>error(); </P>

<P>5.2.3.7.3  External Request State Machine </P>

<P> </P>

<P>This state machine handles requests from the system to the local processor. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>elseif (READ_TO_OWN_OWNER) // remote request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ_TO_OWN); // spin until a valid response &#61472;&#61472;</P>

<P>// from the caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push, &#61472;&#61472;</P>

<P>// wait for it&#61472;&#61472;</P>

<P>cache_state(INVALID); // surrender ownership&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id, data);&#61472;&#61472;</P>

<P>case INVALID:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>// must have cast it out during an&#61472;&#61472;</P>

<P>// address collision&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else // DKILL_SHARER remote request&#61472;&#61472;</P>

<P>// to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(DKILL); // spin until a valid response from&#61472;&#61472;</P>

<P>// the caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // cache paradox&#61472;&#61472;</P>

<P>remote_response(ERROR, received_srcid, my_id);&#61472;&#61472;</P>

<P>case INVALID:&#61472;&#61472;</P>

<P>remote_response(DONE, received_srcid, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>5.2.3.8  I/O Read Operations </P>

<P> </P>

<P>This  operation  is  used  for  I/O  reads  of  globally  shared  memory  space. A </P>

<P>processor-only processing element never initiates an I/O read operation. </P>

<P> </P>

<P>5.2.3.8.1  External Request State Machine </P>

<P> </P>

<P>This machine handles requests from the system to the local memory or the local </P>

<P> </P>

<P> </P>

<P>62 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>processor. This may require making further external requests. </P>

<P> </P>

<P>if (address_collision) // use collision tables in&#61472;&#61472;</P>

<P>// Chapter 7, &#8220;Address Collision Resolution </P>

<P>Tables&#8221;&#61472;&#61472;</P>

<P>else // IO_READ_OWNER request to our caches&#61472;&#61472;</P>

<P>assign_entry();&#61472;&#61472;</P>

<P>local_request(READ_LATEST); // spin until a valid response from&#61472;&#61472;</P>

<P>// the caches&#61472;&#61472;</P>

<P>switch (local_response)&#61472;&#61472;</P>

<P>case MODIFIED: // processor indicated a push;&#61472;&#61472;</P>

<P>// wait for it&#61472;&#61472;</P>

<P>if (received_srcid == received_secid)&#61472;&#61472;</P>

<P>// original requestor is also home&#61472;&#61472;</P>

<P>// module&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>remote_response(DATA_ONLY, received_secid, my_id,&#61472;&#61472;</P>

<P>data);&#61472;&#61472;</P>

<P>remote_response(INTERVENTION, received_srcid, my_id);&#61472;&#61472;</P>

<P>case INVALID: // must have cast it out during&#61472;&#61472;</P>

<P>// an address collision&#61472;&#61472;</P>

<P>remote_response(NOT_OWNER, received_srcid, my_id);&#61472;&#61472;</P>

<P>default:&#61472;&#61472;</P>

<P> </P>

<P>error();&#61472;&#61472;</P>

<P> </P>

<P>endif; </P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 63 </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.2.4  I/O Processing Element </P>

<P> </P>

<P>The simplest GSM processing element is an I/O device. A RapidIO I/O processing element does not actually participate in the globally shared memory environment (it is defined as not in the coherence domain), but is able to read and write data into the GSM address space through special I/O operations that provide for this behavior. These operations are the I/O Read and Data Cache Flush operations. Other than the ability to read and write into the GSM address space, an I/O device has no other operational requirements. Since the I/O processing element is not part of the coherence domain, it is never the target of a coherence transaction and thus does not have to implement any of the related behavior, including the address collision tables. </P>

<P> </P>

<P>Requirements for a specific I/O processing element, a RapidIO to PCI/PCI-X </P>

<P>bridge, is discussed in Chapter 4, &#8220;PCI Considerations,&#8221; on page 4-27. </P>

<P> </P>

<P>5.2.4.1  I/O Read Operations </P>

<P> </P>

<P>This operation is used for I/O reads of globally shared memory space. </P>

<P> </P>

<P>5.2.4.1.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to remote memory. </P>

<P> </P>

<P>remote_request(IO_READ_HOME, mem_id, my_id); </P>

<P>5.2.4.1.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect. </P>

<P> </P>

<P>switch(remote_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>case DONE_INTERVENTION: // must be from third party&#61472;&#61472;</P>

<P>set_received_done_message();&#61472;&#61472;</P>

<P>if (received_data_only_message)&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>// wait for a DATA_ONLY&#61472;&#61472;</P>

<P>case DATA_ONLY: // this is due to an intervention, a&#61472;&#61472;</P>

<P>// DONE_INTERVENTION should come&#61472;&#61472;</P>

<P>// separately&#61472;&#61472;</P>

<P>set_received_data_only_message();&#61472;&#61472;</P>

<P>if (received_done_message)&#61472;&#61472;</P>

<P>return_data();&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P>else&#61472;&#61472;</P>

<P> </P>

<P>endif;&#61472;&#61472;</P>

<P> </P>

<P>return_data(); // OK for weak ordering&#61472;&#61472;</P>

<P> </P>

<P>default&#61472;&#61472;</P>

<P>remote_request(IO_READ_HOME, received_srcid, my_id);&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>5.2.4.2  Data Cache Flush Operations </P>

<P> </P>

<P>This operation returns ownership of a coherence granule to home memory and performs a coherent write. </P>

<P> </P>

<P>64 RapidIO Trade Association </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>5.2.4.2.1  Internal Request State Machine </P>

<P> </P>

<P>This state machine handles requests to remote memory. </P>

<P> </P>

<P>remote_request(FLUSH, mem_id, my_id, data); </P>

<P>5.2.4.2.2  Response State Machine </P>

<P> </P>

<P>This state machine handles responses to requests made to the RapidIO interconnect. </P>

<P> </P>

<P>switch (received_response)&#61472;&#61472;</P>

<P>case DONE:&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P>case RETRY:&#61472;&#61472;</P>

<P> </P>

<P>default:&#61472;&#61472;</P>

<P>local_response(OK);&#61472;&#61472;</P>

<P>free_entry();&#61472;&#61472;</P>

<P> </P>

<P>remote_request(FLUSH, received_srcid, my_id, data);&#61472;&#61472;</P>

<P> </P>

<P>error(); </P>

<P> </P>

<P>5.2.5  Switch Processing Element </P>

<P> </P>

<P>A switch processing element is required to be able to route all defined packets. Since it is not necessary for a switch to analyze a packet in order to determine how it should be treated outside of examining the priority and the destination device ID, a switch processing element does not have any additional requirements to be used in a globally shared memory environment. </P>

<P> </P>

<P> </P>

<P>5.3 Transaction to Priority Mappings </P>

<P> </P>

<P>The Globally Shared Memory model does not have the concept of an end point to end point request transaction flow like the I/O programming model. Instead, all transaction ordering is managed by the load-store units of the processors participating in   the   globally  shared   memory  protocol.  The   GSM   logical specification  behaviors   assume   an   unordered   and   resource   unconstrained communication fabric. The ordered fabric of the 8/16 LP-LVDS and the 1x/4x LP-Serial physical layers requires the proper transaction to priority mappings to mimic the effect of an unordered fabric to suit the GSM model. These mappings leverage the physical layer ordering and deadlock avoidance rules that are required by the I/O Logical layer. In addition, it is assumed that the latency-critical GSM operations are of necessity higher priority than non-coherent I/O traffic, therefore I/O operations are recommended to be assigned to the lowest system priority flow. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-1 shows the GSM transaction to priority mappings. </P>

<P> </P>

<P>Table 5-1. Transaction to Priority Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Request transaction </P>
</TD>

<TD>
<P>Request </P>

<P>Packet Priority </P>
</TD>

<TD>
<P>Response </P>

<P>Packet Priority </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_HOME </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_HOME </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_HOME </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>IREAD_HOME </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_HOME </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_HOME </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH (without data) </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>FLUSH (with data) </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>TLBIE </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>TLBSYNC </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 or 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_OWNER </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>READ_TO_OWN_OWNER </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>IO_READ_OWNER </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>DKILL_SHARER </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>IKILL_SHARER </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>

<TR>
<TD>
<P>CASTOUT </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1534.jpg"/>
</Figure>

<P>A Agent. A processing element that provides services to a processor. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1535.jpg"/>
</Figure>

<P>B Bridge. A processing element that connects one computer bus to another, allowing a processing element on one bus to access an processing element on the other. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1536.jpg"/>
</Figure>

<P>C Cache.  High-speed  memory  containing  recently  accessed  data  and/or instructions (subset of main memory) associated with a processor. </P>

<P> </P>

<P>Cache coherence. Caches are coherent if a processor performing a read from its cache is supplied with data corresponding to the most recent value written to memory or to another processor&#8217;s cache. In other words, a write operation to an address in the system is visible to all other caches in the system. </P>

<P> </P>

<P>Capability registers (CARs). A set of read-only registers that allows a processing element to determine another processing element&#8217;s capabilities. </P>

<P> </P>

<P>Command and status registers (CSRs). A set of registers that allows a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P>Control symbol. A quantum of information transmitted between two linked devices to manage packet flow between the devices. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1537.jpg"/>
</Figure>

<P>D Deadlock. A situation in which two processing elements that are sharing resources prevent each other from accessing the resources, resulting in a halt of system operation. </P>

<P> </P>

<P>Delayed transaction. The process of the target of a transaction capturing the transaction and completing it after responding to the source with a retry. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Device ID. The identifier of an end point processing element connected to the </P>

<P>RapidIO interconnect. </P>

<P> </P>

<P>Double-word. An eight byte quantity, aligned on eight byte boundaries. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1538.jpg"/>
</Figure>

<P>E End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>End point device. A processing element which contains end point functionality. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1539.jpg"/>
</Figure>

<P>F Field or Field name. A sub-unit of a register, where bits in the register are named and defined. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1540.jpg"/>
</Figure>

<P>G Globally shared memory (GSM). Cache coherent system memory that can be shared between multiple processors in a system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1541.jpg"/>
</Figure>

<P>H Host. A processing element responsible for exploring and initializing all or a portion of a RapidIO based system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1542.jpg"/>
</Figure>

<P>I Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P>I/O. Input-output. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1543.jpg"/>
</Figure>

<P>L Local memory. Memory associated with the processing element in question. </P>

<P> </P>

<P>LVDS. Low voltage differential signaling. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1544.jpg"/>
</Figure>

<P>M Mailbox. Dedicated hardware that receives messages. </P>

<P> </P>

<P>Message passing. An application programming model that allows processing elements to communicate via messages to mailboxes instead of via GSM. Message senders do not write to a memory address in the target. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1545.jpg"/>
</Figure>

<P>N Non-coherent. A transaction that does not participate in any system globally shared memory cache coherence mechanism. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1546.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1547.jpg"/>
</Figure>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>

<P>system. </P>

<P> </P>

<P>Peripheral component interface (PCI). A bus commonly used for connecting I/O devices in a system. </P>

<P> </P>

<P>Port-write. An address-less maintenance write operation. </P>

<P> </P>

<P>Priority. The relative importance of a transaction or packet; in most systems a higher priority transaction or packet will be serviced or transmitted before one of lower priority. </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P>Processor. The logic circuitry that responds to and processes the basic instructions that drive a computer. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1548.jpg"/>
</Figure>

<P>R Remote memory. Memory associated with a processing element other than the processing element in question. </P>

<P> </P>

<P>ROM. Read-only memory. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1549.jpg"/>
</Figure>

<P>S Sender. The RapidIO interface output port on a processing element. </P>

<P> </P>

<P>Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on one of its input ports to one of its output ports. </P>

<P> </P>

<P>Symbol. A 16-bit quantity. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1550.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P>Transaction request flow. A sequence of transactions between two processing elements that have a required completion order at the destination processing element. There are no ordering requirements between transaction request flows. </P>

<P>RapidIO Part 7: System and Device Inter-operability Specification Rev. 2.2 </P>

<P> </P>

<P>Blank page </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1551.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 8: Error Management Extensions Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1552.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.2 </P>
</TD>

<TD>
<P>First public release </P>
</TD>

<TD>
<P>09/13/2002 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: the following errata showings: </P>

<P>04-02-00002.001 </P>

<P>and the following new features showings: </P>

<P>04-09-00022.002 </P>

<P>Converted to ISO-friendly templates </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: errata showing 06-02-00001.005 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Technical changes: errata showing 07-07-00000.004 </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Technical changes: errata showing 10-08-00000.003 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Error Management Extensions </P>

<P> </P>

<P>1.1 Introduction............................................................................................................. 7 </P>

<P>1.2 Physical Layer Extensions ...................................................................................... 7 </P>

<P>1.2.1 Port n Error Detect, Enable and Capture CSRs .................................................. 7 </P>

<P>1.2.2 Error Reporting Thresholds ................................................................................ 8 </P>

<P>1.2.3 Error Rate Control and Status ............................................................................. 9 </P>

<P>1.2.4 Port Behavior When Error Rate Failed Threshold is Reached ......................... 10 </P>

<P>1.2.5 Packet Timeout Mechanism in a Switch Device .............................................. 11 </P>

<P>1.3 Logical and Transport Layer Extensions .............................................................. 11 </P>

<P>1.3.1 Logical/Transport Error Detect, Enable and Capture CSRs ............................. 12 </P>

<P>1.3.2 Message Passing Error Detection ..................................................................... 12 </P>

<P>1.4 System Software Notification of Error ................................................................. 12 </P>

<P>1.5 Mechanisms for Software Debug ......................................................................... 13 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Error Management Registers </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 15 </P>

<P>2.2 Additions to Existing Registers ............................................................................ 15 </P>

<P>2.3 New Error Management Registers........................................................................ 16 </P>

<P>2.3.1 Register Map..................................................................................................... 17 </P>

<P>2.3.2 Command and Status Registers (CSRs) ........................................................... 19 </P>

<P>2.3.2.1 Error Management Extensions Block Header (Block Offset 0x0) ............... 19 </P>

<P>2.3.2.2 Logical/Transport Layer Error Detect CSR (Block Offset 0x08) ................ 20 </P>

<P>2.3.2.3 Logical/Transport Layer Error Enable CSR (Block Offset 0x0C) ............... 21 </P>

<P>2.3.2.4 Logical/Transport Layer High Address Capture CSR (Block Offset 0x10). 23 </P>

<P>2.3.2.5 Logical/Transport Layer Address Capture CSR (Block Offset 0x14).......... 24 </P>

<P>2.3.2.6 Logical/Transport Layer Device ID Capture CSR (Block Offset 0x18) ...... 25 </P>

<P>2.3.2.7 Logical/Transport Layer Control Capture CSR (Block Offset 0x1C) .......... 26 </P>

<P>2.3.2.8 Port-write Target deviceID CSR (Block Offset 0x28) ................................. 27 </P>

<P>2.3.2.9 Packet Time-to-live CSR (Block Offset 0x2C) ............................................ 28 </P>

<P>2.3.2.10 Port n Error Detect CSR (Block Offset 0x40, 80,..., 400) ............................ 29 </P>

<P>2.3.2.11 Port n Error Rate Enable CSR (Block Offset 0x44, 84,..., 404) ................... 31 </P>

<P>2.3.2.12 Port n Attributes Capture CSR (Block Offset 0x48, 88,..., 408) .................. 33 </P>

<P>2.3.2.13 Port n Packet/Control Symbol Capture 0 CSR&#61472;&#61472;</P>

<P>(Block Offset 0x4C, 8C,..., 40C) ...............................................................34 </P>

<P>2.3.2.14 Port n Packet Capture 1 CSR (Block Offset 0x50, 90,..., 410)..................... 35 </P>

<P>2.3.2.15 Port n Packet Capture 2 CSR (Block Offset 0x54, 94,..., 414)..................... 36 </P>

<P>2.3.2.16 Port n Packet Capture 3 CSR (Block Offset 0x58, 98,..., 418)..................... 37 </P>

<P>2.3.2.17 Port n Error Rate CSR (Block Offset 0x68, A8,..., 428) .............................. 38 </P>

<P>2.3.2.18 Port n Error Rate Threshold CSR (Block Offset 0x6C, AC,..., 42C) ........... 39 </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Annex A Error Management Discussion (Informative) </P>

<P> </P>

<P>A.1 Introduction........................................................................................................... 41 </P>

<P>A.2 Limitations of Error Management Discussion ...................................................... 41 </P>

<P>A.3 Hot-insertion/extraction Discussion ..................................................................... 42 </P>

<P>A.4 Port-write Discussion............................................................................................ 43 </P>

<P>A.5 Physical Layer Fatal Error Recovery Discussion ................................................. 44 </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>1-1 Port Behavior when Error Rate Failed Threshold has been hit ......................................10 </P>

<P>1-2 Port-write Packet Data Payload for Error Reporting ......................................................13 </P>

<P>2-1 Bit Settings for Port n Control CSRs ..............................................................................15 </P>

<P>2-2 Bit Settings for Port n Error and Status CSRs ................................................................16 </P>

<P>2-3 Extended Feature Space Reserved Access Behavior ......................................................16 </P>

<P>2-4 Error Management Extensions Register Map .................................................................17 </P>

<P>2-5 Bit Settings for Error Management Extensions Block Header .......................................19 </P>

<P>2-6 Bit Settings for Logical/Transport Layer Error Detect CSR ..........................................20 </P>

<P>2-7 Bit Settings for Logical/Transport Layer Error Enable CSR..........................................21 </P>

<P>2-8 Bit Settings for Logical/Transport Layer High Address Capture CSR ..........................23 </P>

<P>2-9 Bit Settings for Logical/Transport Layer Address Capture CSR ...................................24 </P>

<P>2-10 Bit Settings for Logical/Transport Layer Device ID Capture CSR ................................25 </P>

<P>2-11 Bit Settings for Logical/Transport Layer Control Capture CSR ....................................26 </P>

<P>2-12 Bit Settings for Port-write Target deviceID CSR ...........................................................27 </P>

<P>2-13 Bit Settings for Packet Time-to-live CSR.......................................................................28 </P>

<P>2-14 Bit Settings for Port n Error Detect CSR ........................................................................29 </P>

<P>2-15 Bit Settings for Port n Error Rate Enable CSR ...............................................................31 </P>

<P>2-16 Bit Settings for Port n Attributes Capture CSR ..............................................................33 </P>

<P>2-17 Bit Settings for Port n Packet/Control Symbol Capture 0 CSR......................................34 </P>

<P>2-18 Bit Settings for Port n Packet Capture 1 CSR ................................................................35 </P>

<P>2-19 Bit Settings for Port n Packet Capture 2 CSR ................................................................36 </P>

<P>2-20 Bit Settings for Port n Packet Capture 3 CSR ................................................................37 </P>

<P>2-21 Bit Settings for Port n Error Rate CSR ...........................................................................38 </P>

<P>2-22 Bit Settings for Port n Error Rate Threshold CSR ..........................................................39 </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Error Management Extensions </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>The error management extensions describe added requirements in all physical and logical layers. These extensions add definitions to bits that were previously reserved in the Port n Control CSR and add new registers that are contained within the Error Management Extended Features Block. This chapter describes the behavior of a device when an error is detected and how the new registers and bits are managed by software and hardware. Implementation of this specification is optional. </P>

<P> </P>

<P> </P>

<P>1.2 Physical Layer Extensions </P>

<P> </P>

<P>The following registers and register bit extensions allow software to monitor and control the reporting of physical layer errors: </P>

<P> </P>

<P>&#8226; (Extensions to the) Port n Control CSR defined in Section 2.2 </P>

<P>&#8226; (Extensions to the) Port n Error and Status CSR defined in Section 2.2 </P>

<P>&#8226; Port-write Target deviceID CSR defined in Section 2.3.2.8 </P>

<P>&#8226; Port n Error Detect CSR defined in Section 2.3.2.10 </P>

<P>&#8226; Port n Error Rate Enable CSR defined in Section 2.3.2.11 </P>

<P>&#8226; Port n Attributes Capture CSR defined in Section 2.3.2.12 </P>

<P>&#8226; Port n Packet/Control Symbol Capture 0 CSR defined in Section 2.3.2.13 </P>

<P>&#8226; Port n Packet Capture 1-3 CSRs defined in Section 2.3.2.14 through Section </P>

<P>2.3.2.16 </P>

<P>&#8226; Port n Error Rate CSR defined in Section 2.3.2.17 </P>

<P>&#8226; Port n Error Rate Threshold CSR defined in Section 2.3.2.18 </P>

<P> </P>

<P> </P>

<P>1.2.1  Port n Error Detect, Enable and Capture CSRs </P>

<P> </P>

<P>Each detected occurrence of a physical layer error shall be logged by hardware in the Port n Error Detect CSR by setting the appropriate error indication bit. Each detected error occurrence should set no more than one error indication bit, the bit that most specifically identifies the detected error. The Port n Error Detect CSR does not lock when an detected error bit is set allowing each subsequent detected error to also be logged in the register. By reading the register, software may see the types of physical layer errors that have occurred since the register was last cleared. </P>

<P> </P>

<P>RapidIO Trade Association 7 </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Physical layer errors are enabled for error capture and error counting when the bit corresponding to the error has been set in the Port n Error Rate Enable CSR by software. Error information is captured in the Port n Attributes Capture CSR and the Port n Packet/Control Symbol Capture 0-3 CSRs. The Capture Valid Info bit in the Port n Attributes Capture CSR indicates whether the error information in the capture CSRs is valid. </P>

<P> </P>

<P>When the Capture Valid Info status bit is not set in the Port n Attributes Capture CSR, information about the next enabled physical layer error shall be saved to the Port n Packet/Control Symbol Capture 0-3 CSRs. The Info Type and Error Type fields of the Port n Attributes Capture CSR shall be updated and the register&#8217;s Capture Valid Info status bit shall be set by hardware to lock the error capture registers. Typically, the first 16 bytes of a packet, the 4 bytes of a delimited short control symbol, or the 8 bytes of a delimited long control symbol that have a detected error are saved in the Port n Packet/Control Symbol Capture 0-3 CSRs. Packets smaller than 16 bytes are captured in their entirety. The Port n Packet/Control Symbol Capture 0-3 CSRs and the Port n Attributes Capture CSR are not overwritten by hardware with error capture information for subsequent errors until software writes a zero to the Capture Valid Info bit. </P>

<P> </P>

<P>The characters used for data transfer by the LP-Serial physical layer protocol are 9 bit entities, but the specified formats for the Port n Packet/Control Symbol Capture </P>

<P>0-3 CSRs allocate only 8 bits per character (4 characters per 32-bit CSR) for recording the characters of a corrupted control symbol or the first 16 characters of a corrupted packet. Therefore it is not possible to unambiguously capture all possible LP-Serial control symbol and packet corruptions using the specified Port n Packet/Control Symbol Capture 0-3 CSR formats. Examples of this are when a code-group encoding a data character is changed by a transmission error into a code-group encoding a special character or a code-group with no 8B/10B decoding (an invalid character). </P>

<P> </P>

<P>For compatibility with the 8/16 LP-LVDS (parallel) physical layer protocol, the 8 data bits of each captured character shall be captured in the Port n Packet/Control Symbol Capture 0-3 CSRs. The control bits of the captured characters should be captured in the &#8220;Implementation Dependent&#8221; field of the Port n Attributes Capture CSR as specified in the Description of the Implementation Dependent field. Capture of the control bits of the captured characters eliminates any ambiguity as to the code-groups that were received. </P>

<P> </P>

<P> </P>

<P>1.2.2  Error Reporting Thresholds </P>

<P> </P>

<P>Physical layer errors are normally hidden from system software since they may be recovered with no loss of data and without software intervention. Two thresholds are defined in the Port n Error Rate Threshold CSR which can be set to force a report to system software when the physical layer error rate reaches a level that is deemed by the  system  to  be  either  degraded  or  unacceptable.  The  two  thresholds  are </P>

<P> </P>

<P>8 RapidIO Trade Association </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>respectively the Degraded Threshold and the Failed Threshold. These thresholds are used as follows. </P>

<P> </P>

<P>When the error rate counter is incremented, the Error Rate Degraded Threshold Trigger provides a threshold value that, when equal to or exceeded by the value in the Error Rate Counter in the Port n Error Rate register, shall cause the error reporting logic to set the Output Degraded-encountered bit in the Port n Error and Status CSR, and notify the system software as described in Section 1.4. </P>

<P> </P>

<P>The Error Rate Failed Threshold Trigger, if enabled, shall be larger than the degraded threshold trigger. It provides a threshold value that, when equal to or exceeded by the value in the Error Rate Counter, shall trigger the error reporting logic to set the Output Failed-encountered bit in the Port n Error and Status CSR, and notify system software as described in Section 1.4. </P>

<P> </P>

<P>No action shall be taken if the Error Rate Counter continues to exceed either threshold value after initial notification when additional errors are detected. No action shall be taken when the Error Rate Counter drops below either threshold. </P>

<P> </P>

<P> </P>

<P>1.2.3  Error Rate Control and Status </P>

<P> </P>

<P>The fields in the Port n Error Rate CSR are used to monitor the error rate of the port </P>

<P>n physical layer. </P>

<P> </P>

<P>The Error Rate Counter field contains the 8-bit Error Rate Counter. The Error Rate Counter shall increment when a physical layer error is detected whose associated enable bit is set in the Port n Error Rate Enable register. The Error Rate Counter shall decrement at the rate specified by the Error Rate Bias field of the Port n Error Rate CSR. The Error Rate Counter shall not underflow (shall not decrement when equal to 0x00) and shall not overflow (shall not increment when equal to 0xFF). The incrementing and decrementing of the Error Rate Counter are in no way affected by the values in the Degraded and Failed threshold fields. Software may reset the Error Rate Counter at any time. </P>

<P> </P>

<P>The rate at which events are counted by the Error Rate Counter depends on the error rates and the bits set in the Port n Error Rate Enable CSR. If bit 11 &#8220;Received packet-not-accepted control symbol enable&#8221; of the Port n Error Rate Enable CSR is not set, only errors detected by Port n and whose counting is enabled are counted. If bit 11 is set, then errors detected by the connected port are also counted as the reception of a packet-not-accepted control symbol, while not an error in itself, is an indication that the connected port has detected a physical layer error. If in addition to bit 11 being set, one or more of virtual channels 1-8 are enabled and are operating in reliable transmission (RT) mode, packet retries requested by the connected port will also be counted because packet-not-accepted control symbols are used in this case to signal the rejection of an RT packet by the connected port due to a lack of buffer space. </P>

<P> </P>

<P>The Error Rate Bias field determines the rate at which the Error Rate Counter is </P>

<P> </P>

<P>RapidIO Trade Association 9 </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>decremented and defines the acceptable error rate of the physical layer for error reporting purposes. In the absence of additional counted physical layer errors, this mechanism allows the system to recover from both Failed and Degraded levels of operation without a software reset of the Error Rate Counter. If the error rate of the physical layer errors being counted is less than the decrement rate specified in the Error Rate Bias field, the value of the Error Rate counter will rarely be greater than </P>

<P>0x01 or 0x02. </P>

<P> </P>

<P>The Error Rate Recovery field defines how far above the Error Rate Failed Threshold Trigger in the Port n Error Rate Threshold Register the Error Rate Counter is allowed to count. In the absence of additional counted errors, this allows software to control the length of time required for the value of the Error Rate Counter to drop below both the Failed and Degraded Thresholds. </P>

<P> </P>

<P>The Peak Error Rate field shall contain the largest value encountered by the Error Rate Counter since the field was last reset. This field is loaded whenever the current value of the Peak Error Rate field is exceeded by the value of the Error Rate Counter. </P>

<P> </P>

<P> </P>

<P>1.2.4  Port Behavior When Error Rate Failed Threshold is </P>

<P>Reached </P>

<P> </P>

<P>The behavior of a port when the Error Rate Counter in the Port n Error Rate CSR reaches the Error Rate Failed Threshold and the threshold is enabled depends upon the values of the Stop on Port Failed-encountered Enable and the Drop Packet Enable bits in the Port n Control CSR. The Table 1-1 below defines the required behavior. </P>

<P> </P>

<P>Table 1-1. Port Behavior when Error Rate Failed Threshold has been hit </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Stop on Port Failed Encountered Enable </P>
</TD>

<TD>
<P> </P>

<P>Drop Packet </P>

<P>Enable </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Port Behavior </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>The port shall continue to attempt to transmit packets to the connected device if the Output Failed-encountered bit is set and/or if the Error Rate Failed threshold has been met or exceeded. </P>
</TD>

<TD>
<P>All devices </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>The port shall discard packets that receive a Packet-not-accepted control symbol when the Error Rate Failed Threshold has been met or exceeded. Upon discarding a packet, the port shall set the Output Packet-dropped bit in the Port n Error and Status CSR. If the output port &#8220;heals&#8221;, the Error Rate Counter falls below the Error Rate Failed Threshold, the output port shall continue to attempt to forward all packets. </P>
</TD>

<TD>
<P>Switch Device Only </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Table 1-1. Port Behavior when Error Rate Failed Threshold has been hit </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Stop on Port Failed Encountered Enable </P>
</TD>

<TD>
<P> </P>

<P>Drop Packet </P>

<P>Enable </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Port Behavior </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Comments </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>The port shall stop attempting to send packets to the connected device when the Output </P>

<P>Failed-encountered bit is set. The output port will </P>

<P>congest. </P>
</TD>

<TD>
<P>All devices. </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>The port shall discard all output packets without attempting to send when the port&#8217;s Output </P>

<P>Failed-encountered bit is set. Upon discarding a packet, the port shall set Output Packet-dropped bit in the Port n Error and Status CSR. </P>
</TD>

<TD>
<P>All devices. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>1.2.5  Packet Timeout Mechanism in a Switch Device </P>

<P> </P>

<P>In some systems, it is either desirable or necessary to bound the length of time a packet can remain in a switch. To enable this functionality, a switch shall monitor the length of time each packet accepted by one of its ports has been in the switch. The acceptance of a packet by a port is signaled by the port issuing a packet-accepted control symbol for the packet. The timing begins when the port accepts the packet. </P>

<P> </P>

<P>If a packet remains in a switch longer than the Time-to-Live time specified by the Time-to-Live field of the Packet Time-to-live CSR as defined in Section 2.3.2.9, the packet shall be discarded rather than forwarded, the Output Packet-Dropped bit shall be set in the Port n Error and Status CSR and the system shall be notified as described in Section 1.4. </P>

<P> </P>

<P> </P>

<P>1.3 Logical and Transport Layer Extensions </P>

<P> </P>

<P>While the RapidIO physical layer may be working properly, an end point processing element may encounter logical or transport layer errors, or other errors unrelated to its RapidIO ports, while trying to complete a transaction. The &#8220;ERROR&#8221; status response transaction is the mechanism for the target device to indicate to the source that there is a problem completing the request. Experiencing a timeout waiting for a response is also a symptom of an end point or switch fabric with a problem. These types of errors are logged and reporting enabled with a set of registers that are separate from those used for the Physical Layer errors. </P>

<P>&#8226; Logical/Transport Layer Error Detect CSR defined in Section 2.3.2.2 </P>

<P>&#8226; Logical/Transport Layer Error Enable CSR defined in Section 2.3.2.3 </P>

<P>&#8226; Logical/Transport Layer Capture CSRs defined in Section 2.3.2.4 to Section </P>

<P>2.3.2.7 </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1.3.1  Logical/Transport Error Detect, Enable and Capture </P>

<P>CSRs </P>

<P> </P>

<P>When a logical or transport layer error is detected, the appropriate error bit shall be set by the hardware in the Logical/Transport Layer Error Detect CSR. If the corresponding bit is also set in the Logical/Transport Layer Error Enable CSR, the detect register shall lock, the appropriate information is saved in the Logical/Transport Layer Capture registers, all resources held by the transaction are freed, and system software is notified of the error as described in Section 1.4. If multiple enabled errors occur during the same clock cycle, multiple bits will be set in the detect register and the contents of the Logical/Transport Layer Capture registers are implementation dependent. Once locked, subsequent errors will not set another error detect bit. The contents of the Logical/Transport Capture CSRs are valid if the bitwise AND of the Logical/Transport Layer Error Detect CSR and the Logical/Transport Layer Error Detect Enable CSR is not equal to zero (0x00000000). </P>

<P> </P>

<P>Software shall write the Logical/Transport Detect register with all logic 0s to clear the error detect bits or a corresponding enable bit to unlock the register. Any other recovery actions associated with these types of errors are system dependent and outside the scope of this specification. </P>

<P> </P>

<P> </P>

<P>1.3.2  Message Passing Error Detection </P>

<P> </P>

<P>Message passing is a special case of logical layer error recovery requiring error detection at both the source and destination ends of the message. The source of the message has the request-to-response timeout (defined in the Port Response Timeout Control CSR in the RapidIO Physical Layer specifications) to detect lost request or response packets in the switch fabric. However, in order to not hang the recipient mailbox in the case of a lost request packet for a multiple packet message, the recipient mailbox shall have an analogous response-to-request timeout. This timeout is for sending a response packet to receiving the next request packet of a given message operation, and has the same value as the request-to-response timeout that is already specified. The Logical/Transport Layer Control Capture CSR contains the </P>

<P>&#8216;msg info&#8217; field to capture the critical information of the last received (or sent) </P>

<P>message segment before timeout. </P>

<P> </P>

<P> </P>

<P>1.4 System Software Notification of Error </P>

<P> </P>

<P>System software is notified of logical, transport, and physical layer errors in two ways. An interrupt is issued to the local system by a device, the method of which is not defined in this specification, or a Maintenance port-write operation is issued by a device. Maintenance port-write operations are sent to a predetermined system host (defined in the Port-write Target deviceID CSR in Section 2.3.2.8). The sending device sets the Port-write Pending status bit in the Port n Error and Status CSR. A </P>

<P> </P>

<P> </P>

<P>12 RapidIO Trade Association </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>16 byte data payload of the Maintenance Port-write packet contains the contents of several CSRs, the port on the device that encountered the error condition (for port-based errors), and some optional implementation specific additional information as shown in Table 1-2. Software indicates that it has seen the port-write operation by clearing the Port-write Pending status bit. </P>

<P> </P>

<P>The Component Tag CSR is defined in the RapidIO Part 3: Common Transport Specification, and is used to uniquely identify the reporting device within the system. A Port ID field, the Logical/Transport Layer Detect CSR defined in Section </P>

<P>2.3.2.2, and the Port n Error Detect CSR defined in Section 2.3.2.10 are used to describe the encountered error condition. </P>

<P> </P>

<P>Table 1-2. Port-write Packet Data Payload for Error Reporting </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Data Payload Byte Offset </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Word </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0 </P>
</TD>

<TD>
<P>Component Tag CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x4 </P>
</TD>

<TD>
<P>Port n Error Detect CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x8 </P>
</TD>

<TD>
<P>Implementation specific </P>
</TD>

<TD>
<P>Port ID (byte) </P>
</TD>
</TR>

<TR>
<TD>
<P>0xC </P>
</TD>

<TD>
<P>Logical/Transport Layer Error Detect CSR </P>
</TD>
</TR>
</Table>

<P> </P>

<P>1.5 Mechanisms for Software Debug </P>

<P> </P>

<P>In most systems, it is difficult to verify the error handling software. The Error management extensions make some registers writable for easier debug. </P>

<P> </P>

<P>The Logical/Transport Layer Error Detect register and the Logical/Transport Layer Error Capture registers are writable by software to allow software debug of the system error recovery mechanisms. For software debug, software must write the Logical/Transport Layer Error capture registers with the desired address and device id information then write the Logical/Transport Layer Error Detect register to set an error bit and lock the registers. When an error detect bit is set, the hardware will inform the system software of the error using its standard error reporting mechanism. After the error has been reported, the system software may read and clear registers as necessary to complete its error handling protocol testing. </P>

<P> </P>

<P>The Port n Error Detect register and the Port n Error Capture registers are also writable by software to allow software debug of the system error recovery and thresholding mechanism. For debug, software must write the Port n Attributes Error Capture CSR to set the Capture Valid Info bit and then the packet/control symbol information in the other capture registers. Each write of a non-zero value to the Port n Error Detect CSR shall cause the Error Rate Counter to increment if the corresponding error bit is enabled in the Port n Error Rate Enable CSR. When a threshold is reached, the hardware will inform the system software of the error using its standard error reporting mechanism. After the error has been reported, the system </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 13 </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>software may read and clear registers as necessary to complete its error handling protocol testing. </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Error Management Registers </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This section describes the Error Management Extended Features block, and adds a number of new bits to the existing standard physical layer registers. &#8216;End-point only&#8217; and &#8216;switch only&#8217; register bits shall be considered reserved when the registers are implemented on devices for which these bits are not required. </P>

<P> </P>

<P> </P>

<P>2.2 Additions to Existing Registers </P>

<P> </P>

<P>The following bits are added to the parallel and serial logical layer specification Port </P>

<P>n Control CSRs. </P>

<P> </P>

<P>Table 2-1. Bit Settings for Port n Control CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Stop on Port </P>

<P>Failed-encountered </P>

<P>Enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit is used with the Drop Packet Enable bit to force certain behavior when the Error Rate Failed Threshold has been met or exceeded. See Section 1.2.4 of the Part 8: Error Management Extensions for detailed requirements. </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Drop Packet Enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit is used with the Stop on Port Failed-encountered Enable bit to force certain behavior when the Error Rate Failed Threshold has been met or exceeded. See Section 1.2.4 of the Part 8: Error Management Extensions for detailed requirements. </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Port Lockout </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>When this bit is cleared, the packets that may be received and issued are controlled by the state of the Output Port Enable and Input Port Enable bits in the Port n Control CSR.&#61472;&#61472;</P>

<P>When this bit is set, this port is stopped and is not enabled to issue or receive any packets; the input port can still follow the training procedure and can still send and respond to link-requests; all received packets return packet-not-accepted control symbols to force an error condition to be signaled by the sending device </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>The following bits are added to the parallel and serial specification Port n Error and </P>

<P>Status CSRs. </P>

<P> </P>

<P>Table 2-2. Bit Settings for Port n Error and Status CSRs </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Output Packet-dropped </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has discarded a packet. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Output </P>

<P>Failed-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered a failed condition, meaning that the port&#8217;s failed error threshold has been reached in the Port n Error Rate Threshold register. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>Output </P>

<P>Degraded-encountered </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Output port has encountered a degraded condition, meaning that the port&#8217;s degraded error threshold has been reached in the Port n Error Rate Threshold register. Once set remains set until written with a logic 1 to clear. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>2.3 New Error Management Registers </P>

<P> </P>

<P>This section describes the Extended Features block (EF_ID=0x0007) that allows an external processing element to manage the error status and reporting for a processing element. This chapter only describes registers or register bits defined by this extended features block. All registers are 32-bits and aligned to a 32-bit boundary. </P>

<P> </P>

<P>Table 2-3 describes the required behavior for accesses to reserved register bits and reserved registers for the RapidIO Extended Features register space, </P>

<P> </P>

<P>Table 2-3. Extended Feature Space Reserved Access Behavior </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P>Extended Features Space </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value1 </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value2 </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>
</Table>

<P>1Do not depend on reserved bits being a particular value; use appropriate masks to extract defined bits from the read value. </P>

<P>2All register writes shall be in the form: read the register to obtain the values of all reserved bits, merge in the desired values for defined bits to be modified, and write the register, thus preserving the value of all reserved bits. </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.1  Register Map </P>

<P> </P>

<P>The register map for the error management registers shall be as specified by </P>

<P>Table 2-4. This register map is currently only defined for devices with up to 16 </P>

<P>RapidIO ports, but can be extended or shortened if more or less port definitions are required for a device. For example, a device with four RapidIO ports is only required to use register map space corresponding to offsets [EF_PTR+0x00] through [EF_PTR+0x13C]. Register map offset [EF_PTR+0x140] can be used for another Extended Features block. </P>

<P> </P>

<P>Table 2-4. Error Management Extensions Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>General </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>Error Management Extensions Block Header </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x8 </P>
</TD>

<TD>
<P>Logical/Transport Layer Error Detect CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0xC </P>
</TD>

<TD>
<P>Logical/Transport Layer Error Enable CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x10 </P>
</TD>

<TD>
<P>Logical/Transport Layer High Address Capture CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x14 </P>
</TD>

<TD>
<P>Logical/Transport Layer Address Capture CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x18 </P>
</TD>

<TD>
<P>Logical/Transport Layer Device ID Capture CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x1C </P>
</TD>

<TD>
<P>Logical/Transport Layer Control Capture CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x20-24 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x28 </P>
</TD>

<TD>
<P>Port-write Target deviceID CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x2C </P>
</TD>

<TD>
<P>Packet Time-to-live CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x30-3C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>0x40 </P>
</TD>

<TD>
<P>Port 0 Error Detect CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x44 </P>
</TD>

<TD>
<P>Port 0 Error Rate Enable CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x48 </P>
</TD>

<TD>
<P>Port 0 Attributes Capture CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x4C </P>
</TD>

<TD>
<P>Port 0 Packet/Control Symbol Capture 0 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x50 </P>
</TD>

<TD>
<P>Port 0 Packet Capture 1 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x54 </P>
</TD>

<TD>
<P>Port 0 Packet Capture 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x58 </P>
</TD>

<TD>
<P>Port 0 Packet Capture 3 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x5C-64 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x68 </P>
</TD>

<TD>
<P>Port 0 Error Rate CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x6C </P>
</TD>

<TD>
<P>Port 0 Error Rate Threshold CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x70-7C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 2-4. Error Management Extensions Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>0x80 </P>
</TD>

<TD>
<P>Port 1 Error Detect CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x84 </P>
</TD>

<TD>
<P>Port 1 Error Rate Enable CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x88 </P>
</TD>

<TD>
<P>Port 1 Attributes Capture CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x8C </P>
</TD>

<TD>
<P>Port 1 Packet/Control Symbol Capture 0 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x90 </P>
</TD>

<TD>
<P>Port 1 Packet Capture 1 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x94 </P>
</TD>

<TD>
<P>Port 1 Packet Capture 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x98 </P>
</TD>

<TD>
<P>Port 1 Packet Capture 3 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x9C-A4 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0xA8 </P>
</TD>

<TD>
<P>Port 1 Error Rate CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0xAC </P>
</TD>

<TD>
<P>Port 1 Error Rate Threshold CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0xB0-BC </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>Ports 2-14 </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>0xC0&#8211;3FC </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P> </P>

<P>Assigned to Port 2-14 CSRs </P>
</TD>
</TR>

<TR>
<TD>
<P>Port 15 </P>
</TD>

<TD>
<P>0x400 </P>
</TD>

<TD>
<P>Port 15 Error Detect CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x404 </P>
</TD>

<TD>
<P>Port 15 Error Rate Enable CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x408 </P>
</TD>

<TD>
<P>Port 15 Attributes Capture CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x40C </P>
</TD>

<TD>
<P>Port 15 Packet/Control Symbol Capture 0 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x410 </P>
</TD>

<TD>
<P>Port 15 Packet Capture 1 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x414 </P>
</TD>

<TD>
<P>Port 15 Packet Capture 2 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x418 </P>
</TD>

<TD>
<P>Port 15 Packet Capture 3 CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x41C-424 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x428 </P>
</TD>

<TD>
<P>Port 15 Error Rate CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x42C </P>
</TD>

<TD>
<P>Port 15 Error Rate Threshold CSR </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0x430-43C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2  Command and Status Registers (CSRs) </P>

<P> </P>

<P>Refer to Table 2-3 for the required behavior for access to reserved registers and register bits. </P>

<P> </P>

<P>2.3.2.1  Error Management Extensions Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The error management extensions block header register contains the EF_PTR to the next EF_BLK and the EF_ID that identifies this as the error management extensions block header. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-5. The register is read-only. </P>

<P> </P>

<P>Table 2-5. Bit Settings for Error Management Extensions Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P>0x0007 </P>
</TD>

<TD>
<P>Hard wired Extended Features ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.3.2.2  Logical/Transport Layer Error Detect CSR&#61472;&#61472;</P>

<P>(Block Offset 0x08) </P>

<P> </P>

<P>This register indicates the error that was detected by the Logical or Transport logic layer. Multiple bits may get set in the register if simultaneous errors are detected during the same clock cycle that the errors are logged. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-6. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-6. Bit Settings for Logical/Transport Layer Error Detect CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>IO error response </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a response of &#8216;ERROR&#8217; for an IO Logical Layer Request.&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Message error response </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a response of &#8216;ERROR&#8217; for an MSG Logical Layer Request.&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>GSM error response </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a response of &#8216;ERROR&#8217; for a GSM Logical Layer Request.&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Message Format Error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received MESSAGE packet data payload with an invalid size or segment </P>

<P>(MSG logical)&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Illegal transaction decode </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a supported request/response packet with undefined field values </P>

<P>(IO/MSG/GSM logical)&#61472;&#61472;</P>

<P>(switch or endpoint device) </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Illegal transaction target error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a packet that contained a destination ID that is not defined for this processing element. End points with multiple ports and a built-in switch function may not report this as an error (Transport) (optional)&#61472;&#61472;</P>

<P>(switch or end point device) </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Message Request </P>

<P>Timeout </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>A required message request has not been received within the specified timeout interval (MSG logical)&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>Packet Response </P>

<P>Timeout </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>A required response has not been received within the specified time out interval (IO/MSG/GSM logical) &#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Unsolicited Response </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>An unsolicited/unexpected Response packet was received (IO/MSG/GSM </P>

<P>logical; only Maintenance response for switches) &#61472;&#61472;</P>

<P>(switch or endpoint device) </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Unsupported Transaction </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>A transaction is received that is not supported in the Destination Operations CAR (IO/MSG/GSM logical; only Maintenance port-write for switches)&#61472; (switch or endpoint device) </P>
</TD>
</TR>

<TR>
<TD>
<P>10-23 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>Implementation Specific error </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>An implementation specific error has occurred. &#61472;&#61472;</P>

<P>(switch or end point device) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.3  Logical/Transport Layer Error Enable CSR&#61472;&#61472;</P>

<P>(Block Offset 0x0C) </P>

<P> </P>

<P>This register contains the bits that control if an error condition locks the Logical/Transport Layer Error Detect and Capture registers and is reported to the system host. Without exception, bit &#8220;b&#8221; of this register controls the capture and reporting of the error whose occurrence is indicated by bit &#8220;b&#8221; of the Logical/Transport Layer Error Detect CSR. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-7. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-7. Bit Settings for Logical/Transport Layer Error Enable CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>IO error response enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of an IO &#8216;ERROR&#8217; response. Save and lock original request transaction information in all Logical/Transport Layer Capture CSRs. &#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Message error response enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a Message &#8216;ERROR&#8217; response. Save and lock original request transaction information in all Logical/Transport Layer Capture CSRs. &#61472; (end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>GSM error response enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a GSM &#8216;ERROR&#8217; response. Save and lock original request transaction capture information in all Logical/Transport Layer Capture CSRs. &#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Message Format Error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a MESSAGE packet data payload with an invalid size or segment (MSG logical). Save and lock transaction capture information in Logical/Transport Layer Device ID and Control Capture CSRs. &#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Illegal transaction decode enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a supported request/response packet with undefined field values (IO/MSG/GSM logical). Save and lock transaction capture information in Logical/Transport Layer Device ID and Control Capture CSRs. &#61472;&#61472;</P>

<P>(switch or end-point device) </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Illegal transaction target error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a packet that contains a destination ID that is not defined for this processing element. Save and lock transaction capture information in Logical/Transport Layer Device ID and Control Capture CSRs. (optional)&#61472; (switch or end point device) </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Message Request timeout error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a Message Request timeout error. Save and lock transaction capture information in Logical/Transport Layer Device ID and Control Capture CSRs for the last Message request segment packet received.&#61472; (end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>Packet Response </P>

<P>Timeout error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a packet response timeout error. Save and lock original request address in Logical/Transport Layer Address Capture CSRs. Save and lock original request Destination ID in Logical/Transport Layer Device ID Capture CSR.&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Unsolicited Response error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of receiving an unsolicited/unexpected Response packet (IO/MSG/GSM logical; only Maintenance responses for switches). Save and lock transaction capture information in Logical/Transport Layer Device ID and Control Capture CSRs.&#61472;&#61472;</P>

<P>(switch or end-point device) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 2-7. Bit Settings for Logical/Transport Layer Error Enable CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Unsupported Transaction error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of an unsupported transaction error. Save and lock transaction capture information in Logical/Transport Layer Device ID and Control Capture CSRs.&#61472;&#61472;</P>

<P>(switch or end-point device) </P>
</TD>
</TR>

<TR>
<TD>
<P>10-23 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>Implementation Specific error enable </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Enable reporting of an implementation specific error has occurred. Save and lock capture information in appropriate Logical/Transport Layer Capture CSRs. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.4  Logical/Transport Layer High Address Capture CSR&#61472;&#61472;</P>

<P>(Block Offset 0x10) </P>

<P> </P>

<P>This register contains error information. It is locked when a Logical/Transport error is detected and the corresponding enable bit is set. This register is only required for end point devices that support 66 or 50 bit addresses. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-8. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-8. Bit Settings for Logical/Transport Layer High Address Capture CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-31 </P>
</TD>

<TD>
<P>address[0-31] </P>
</TD>

<TD>
<P>All 0s </P>
</TD>

<TD>
<P>Most significant 32 bits of the address associated with the error (for requests, for responses if available) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.3.2.5  Logical/Transport Layer Address Capture CSR&#61472;&#61472;</P>

<P>(Block Offset 0x14) </P>

<P> </P>

<P>This register contains error information. It is locked when a Logical/Transport error is detected and the corresponding enable bit is set. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-9. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-9. Bit Settings for Logical/Transport Layer Address Capture CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-28 </P>
</TD>

<TD>
<P>address[32-60] </P>
</TD>

<TD>
<P>All 0s </P>
</TD>

<TD>
<P>Least significant 29 bits of the address associated with the error (for requests, for responses if available) </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>30-31 </P>
</TD>

<TD>
<P>xamsbs </P>
</TD>

<TD>
<P>0b00 </P>
</TD>

<TD>
<P>Extended address bits of the address associated with the error (for requests, for responses if available) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.6  Logical/Transport Layer Device ID Capture CSR&#61472;&#61472;</P>

<P>(Block Offset 0x18) </P>

<P> </P>

<P>This register contains error information. It is locked when an error is detected and the corresponding enable bit is set. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-10. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-10. Bit Settings for Logical/Transport Layer Device ID Capture CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-7 </P>
</TD>

<TD>
<P>MSB destinationID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Most significant byte of the destinationID associated with the error (large transport systems only) </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>destinationID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>The destinationID associated with the error </P>
</TD>
</TR>

<TR>
<TD>
<P>16-23 </P>
</TD>

<TD>
<P>MSB sourceID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Most significant byte of the sourceID associated with the error (large transport systems only) </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>sourceID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>The sourceID associated with the error </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.3.2.7  Logical/Transport Layer Control Capture CSR&#61472;&#61472;</P>

<P>(Block Offset 0x1C) </P>

<P> </P>

<P>This register contains error information. It is locked when a Logical/Transport error is detected and the corresponding enable bit is set. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-11. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-11. Bit Settings for Logical/Transport Layer Control Capture CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-3 </P>
</TD>

<TD>
<P>ftype </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>Format type associated with the error </P>
</TD>
</TR>

<TR>
<TD>
<P>4-7 </P>
</TD>

<TD>
<P>ttype </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>Transaction type associated with the error </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>msg info </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>letter, mbox, and msgseg for the last Message request received for the mailbox that had an error (Message errors only) </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>Implementation specific </P>
</TD>

<TD>
<P>0x0000 </P>
</TD>

<TD>
<P>Implementation specific information associated with the error </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.8  Port-write Target deviceID CSR&#61472;&#61472;</P>

<P>(Block Offset 0x28) </P>

<P> </P>

<P>This register contains the target deviceID to be used when a device generates a Maintenance port-write operation to report errors to a system host. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-12. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-12. Bit Settings for Port-write Target deviceID CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-7 </P>
</TD>

<TD>
<P>deviceID_msb </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>This is the most significant byte of the port-write target deviceID (large transport systems only) </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>deviceID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>This is the port-write target deviceID </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>large_transport </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>deviceID size to use for a port-write </P>

<P>0b0 - use the small transport deviceID&#61472;&#61472;</P>

<P>0b1 - use the large transport deviceID </P>
</TD>
</TR>

<TR>
<TD>
<P>17-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.3.2.9  Packet Time-to-live CSR&#61472;&#61472;</P>

<P>(Block Offset 0x2C) </P>

<P> </P>

<P>The Packet Time-to-live register specifies the length of time that a packet is allowed to exist within a switch device. The maximum value of the Time-to-live variable (0xFFFF) shall correspond to 100 msec. +/-34%. The resolution (minimum step size) of the Time-to-live variable shall be (maximum value of Time-to-live)/(216-1). </P>

<P>The reset value is all logic 0s, which disables the Time-to-live function so that a packet never times out. This register is not required for devices without switch functionality. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-13. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-13. Bit Settings for Packet Time-to-live CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>Time-to-live value </P>
</TD>

<TD>
<P>0x0000 </P>
</TD>

<TD>
<P>Maximum time that a packet is allowed to exist within a switch device </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.10  Port n Error Detect CSR&#61472;&#61472;</P>

<P>(Block Offset 0x40, 80,..., 400) </P>

<P> </P>

<P>The Port n Error Detect Register indicates the physical layer errors that have been detected by the Port n hardware since the register was last cleared. The register is cleared by software writing the register with the data 0x0000_0000. </P>

<P> </P>

<P>The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-14. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-14. Bit Settings for Port n Error Detect CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Implementation specific error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>An implementation specific error has been detected </P>
</TD>
</TR>

<TR>
<TD>
<P>1-7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Received S-bit error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a packet/control symbol with an S-bit parity error (parallel) </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Received corrupt control symbol </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a control symbol with a bad CRC value (serial)&#61472;&#61472;</P>

<P>or&#61472;&#61472;</P>

<P>Received a control symbol with a true/complement mismatch (parallel) </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>Received acknowledge control symbol with unexpected ackID </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a packet-accepted or packet-retry control symbol with an unexpected ackID </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Received </P>

<P>packet-not-accepted control symbol </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received packet-not-accepted control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Received packet with unexpected ackID </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received packet with unexpected ackID value - out-of-sequence ackID </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Received packet with bad CRC </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received packet with a bad CRC value </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Received packet exceeds 276 Bytes </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received packet which exceeds the maximum allowed size </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Received illegal or invalid character </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received an 8B/10B code-group that is invalid (a code-group that does not have a 8B/10B decode given the current running disparity) or illegal (a code-group that is valid, but whose use is not allowed by the LP-Serial protocol). This bit may be set in conjunction with bit 29 Delineation error. The implementation of this bit is optional, but strongly recommended. (serial) </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>Received data character in IDLE1 sequence </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a data character in an IDLE1 sequence. This bit may be set in conjunction with bit 29 Delineation error. The implementation of this bit is optional, but strongly recommended. (serial) </P>
</TD>
</TR>

<TR>
<TD>
<P>17 </P>
</TD>

<TD>
<P>Loss of descrambler synchronization </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Loss of receiver descrambler synchronization while receiving scrambled control symbol and packet data. This bit shall be implemented only if port n supports descrambling of packet and control symbol data. (serial) </P>
</TD>
</TR>

<TR>
<TD>
<P>18-25 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>26 </P>
</TD>

<TD>
<P>Non-outstanding ackID </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>When there are outstanding ackIDs, a link_response was received with an ackID that is not outstanding </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Protocol error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>An unexpected control symbol was received </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Frame toggle edge error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>FRAME signal toggled on falling edge of receive clock (parallel) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 2-14. Bit Settings for Port n Error Detect CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Delineation error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received an 8B/10B code-group that is invalid (a code-group that does not have a 8B/10B decode given the current running disparity), illegal (a </P>

<P>code-group that is valid, but whose use is not allowed by the LP-Serial </P>

<P>protocol) or that is in a position in the received code-group stream that is not allowed by the LP-Serial protocol (serial)&#61472;&#61472;</P>

<P>or&#61472;&#61472;</P>

<P>FRAME signal toggled on non-32-bit boundary (parallel) </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Unsolicited acknowledgement control symbol </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>An unsolicited packet acknowledgement control symbol was received </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Link timeout </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>A packet acknowledgement or link-response control symbol was not received within the specified timeout interval </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.11  Port n Error Rate Enable CSR&#61472;&#61472;</P>

<P>(Block Offset 0x44, 84,..., 404) </P>

<P> </P>

<P>This register contains bits that when set cause specific detected errors to increment the error rate counter in the Port n Error Rate Threshold Register and capture information about the error in and then lock the Port n Packet/Control Symbol Capture 0-3 CSRs. Without exception, bit &#8220;b&#8221; of this register controls the capture and counting of the detected error whose occurrence is indicated by bit &#8220;b&#8221; of the Port n Error Detect CSR. </P>

<P> </P>

<P>The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-15. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-15. Bit Settings for Port n Error Rate Enable CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Implementation specific error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of implementation specific errors </P>
</TD>
</TR>

<TR>
<TD>
<P>1-7 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Received S-bit error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of a packet/control symbol with an S-bit parity error (parallel) </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Received corrupt control symbol enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of a corrupt control symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>Received </P>

<P>out-of-sequence acknowledgement control symbol enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of a packet-accepted or packet-retry control symbol with an unexpected ackID </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Received </P>

<P>packet-not-accepted control symbol enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of received packet-not-accepted control symbols. </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Received packet with unexpected ackID enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of packet with unexpected ackID value - out-of-sequence ackID </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Received packet with bad CRC enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of packet with a bad CRC value </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Received packet exceeds 276 Bytes enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of packet which exceeds the maximum allowed size </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Received illegal or invalid character enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of reception of an 8B/10B code-group that is invalid or illegal. This bit shall be implemented only if bit 15 &#8220;Received illegal or invalid character&#8221; of the Port n Error Detect CSR is implemented. (serial) </P>
</TD>
</TR>

<TR>
<TD>
<P>16 </P>
</TD>

<TD>
<P>Received data character in an IDLE1 sequence enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of reception of a data character in an IDLE1 sequence. This bit shall be implemented only if bit 16 &#8220;Received data character in IDLE1 sequencer&#8221; of the Port n Error Detect CSR is implemented. (serial) </P>
</TD>
</TR>

<TR>
<TD>
<P>17 </P>
</TD>

<TD>
<P>Loss of descrambler synchronization enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of loss of receiver descrambler synchronization when scrambled control symbol and packet data is being received. This bit shall be implemented only if bit 17 &#8220;Loss of descrambler synchronization&#8221; of the Port n Error Detect CSR is implemented. (serial) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 2-15. Bit Settings for Port n Error Rate Enable CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>18-25 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>26 </P>
</TD>

<TD>
<P>Non-outstanding ackID </P>

<P>enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of link-responses received with an ackID that is not outstanding when there are outstanding ackIDs </P>
</TD>
</TR>

<TR>
<TD>
<P>27 </P>
</TD>

<TD>
<P>Protocol error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of received unexpected control symbol symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>28 </P>
</TD>

<TD>
<P>Frame toggle edge error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of frame toggle edge errors&#61472;&#61472;</P>

<P>(parallel) </P>
</TD>
</TR>

<TR>
<TD>
<P>29 </P>
</TD>

<TD>
<P>Delineation error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of </P>

<P>FRAME signal toggled on non-32-bit boundary (parallel)&#61472;&#61472;</P>

<P>or&#61472;&#61472;</P>

<P>Reception of an 8B/10B code-group that is invalid, illegal or that is in a position in the received code-group stream that is not allowed by the </P>

<P>LP-Serial protocol (serial) </P>
</TD>
</TR>

<TR>
<TD>
<P>30 </P>
</TD>

<TD>
<P>Unsolicited acknowledgement control symbol enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of received unsolicited packet acknowledgement control symbols </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Link timeout enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable error rate counting of link timeout errors </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.12  Port n Attributes Capture CSR&#61472;&#61472;</P>

<P>(Block Offset 0x48, 88,..., 408) </P>

<P> </P>

<P>The information in this register indicates the type of information captured in the Port n Packet/Control Symbol Capture 0-3 CSRs. If multiple errors are detected during the same clock cycle, one of the detected errors shall be selected for capture and the captured error shall be indicated in the Error type field. When multiple errors are detected in the same clock cycle, the error selected for capture is implementation dependent. </P>

<P> </P>

<P>The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-16. Bits 0-30 of this register shall be valid and locked when the Capture valid info bit is set. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-16. Bit Settings for Port n Attributes Capture CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-2 </P>
</TD>

<TD>
<P>Info type </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Type of information logged </P>

<P>0b000 - packet&#61472;&#61472;</P>

<P>0b001 - reserved&#61472;&#61472;</P>

<P>0b010 - short control symbol&#61472;&#61472;</P>

<P>0b011 - long control symbol&#61472;&#61472;</P>

<P>0b100 - implementation specific (capture register contents are implementation specific)&#61472;&#61472;</P>

<P>0b101 - reserved&#61472;&#61472;</P>

<P>0b110 - undefined (S-bit error), capture as if a packet (parallel physical layer only)&#61472;&#61472;</P>

<P>0b111 - reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>3-7 </P>
</TD>

<TD>
<P>Error type </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>The encoded value of the bit in the Port n Error Detect CSR that describes the error captured in the Port n Packet/Control Symbol Capture 0-3 CSRs. </P>
</TD>
</TR>

<TR>
<TD>
<P>8-27 </P>
</TD>

<TD>
<P>Implementation </P>

<P>Dependent </P>
</TD>

<TD>
<P>All 0s </P>
</TD>

<TD>
<P>Implementation specific error information. </P>

<P> </P>

<P>If port n is a serial port, the following should be implemented: </P>

<P>&#8226;  If the Info_type is &#8220;packet&#8221;, the &#8220;control&#8221; bits of packet characters 0-15 should be captured in register bits 8-23 respectively. </P>

<P>&#8226; If the Info_type is &#8220;short control symbol&#8221;, the &#8220;control&#8221; bits of delimited control symbol characters 0-3 should be captured in register bits 8-11 respectively. </P>

<P>&#8226;  If the Info_type is &#8220;long control symbol&#8221;, the &#8220;control&#8221; bits of delimited long control symbol characters 0-7 should be captured in register bits 8-15 respectively. </P>
</TD>
</TR>

<TR>
<TD>
<P>28-30 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Capture valid info </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit is set by hardware to indicate that the Port n Packet/Control Symbol Capture 0-3 CSRs and the other bits in this register contain valid information and are locked. This bit is cleared and the Port n Packet/Control Symbol Capture 0-3 CSRs and the other bits in this register are unlocked by software writing </P>

<P>0b0 to the bit. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.3.2.13  Port n Packet/Control Symbol Capture 0 CSR&#61472;&#61472;</P>

<P>(Block Offset 0x4C, 8C,..., 40C) </P>

<P> </P>

<P>The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-17. The contents of the register are valid and locked when the Capture Valid info bit of the Port n Attributes Capture SCR is set (0b1). Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-17. Bit Settings for Port n Packet/Control Symbol Capture 0 CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-31 </P>
</TD>

<TD>
<P>Capture 0 </P>
</TD>

<TD>
<P>All 0s </P>
</TD>

<TD>
<P>If the info_type field of the Port n Attributes Capture CSR is &#8220;long control symbol&#8221; or &#8220;short control symbol&#8221;, </P>

<P>True and Complement of control symbol (parallel)&#61472;&#61472;</P>

<P>or&#61472;&#61472;</P>

<P>Delimited short or long control symbol bytes 0-3 (serial). </P>

<P> </P>

<P>If the info_type field of the Port n Attributes Capture CSR is </P>

<P>&#8220;packet&#8221;, packet bytes 0-3. </P>

<P> </P>

<P>Otherwise, implementation specific. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.14  Port n Packet Capture 1 CSR&#61472;&#61472;</P>

<P>(Block Offset 0x50, 90,..., 410) </P>

<P> </P>

<P>The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-18. The contents of the register are valid and locked when the Capture Valid info bit of the Port n Attributes Capture SCR is set (0b1). Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-18. Bit Settings for Port n Packet Capture 1 CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-31 </P>
</TD>

<TD>
<P>Capture 1 </P>
</TD>

<TD>
<P>All 0s </P>
</TD>

<TD>
<P>If the info_type field of the Port n Attributes Capture CSR is &#8220;long control symbol&#8221;, delimited long control symbol Bytes 4-7 (serial). If the info_type field of the Port n Attributes Capture CSR is &#8220;packet&#8221;, packet Bytes 4-7. </P>

<P>Otherwise, implementation specific. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.3.2.15  Port n Packet Capture 2 CSR&#61472;&#61472;</P>

<P>(Block Offset 0x54, 94,..., 414) </P>

<P> </P>

<P>The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-19. The contents of the register are valid and locked when the Capture Valid info bit of the Port n Attributes Capture SCR is set (0b1). Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-19. Bit Settings for Port n Packet Capture 2 CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-31 </P>
</TD>

<TD>
<P>Capture 2 </P>
</TD>

<TD>
<P>All 0s </P>
</TD>

<TD>
<P>If the info_type field of the Port n Attributes Capture CSR is </P>

<P>&#8220;packet&#8221;, packet Bytes 8-11. Otherwise, implementation specific. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.16  Port n Packet Capture 3 CSR&#61472;&#61472;</P>

<P>(Block Offset 0x58, 98,..., 418) </P>

<P> </P>

<P>The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-20. The contents of the register are valid and locked when the Capture Valid info bit of the Port n Attributes Capture SCR is set (0b1). Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-20. Bit Settings for Port n Packet Capture 3 CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-31 </P>
</TD>

<TD>
<P>Capture 3 </P>
</TD>

<TD>
<P>All 0s </P>
</TD>

<TD>
<P>If the info_type field of the Port n Attributes Capture CSR is </P>

<P>&#8220;packet&#8221;, packet Bytes 12-15. Otherwise, implementation specific. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.3.2.17  Port n Error Rate CSR&#61472;&#61472;</P>

<P>(Block Offset 0x68, A8,..., 428) </P>

<P> </P>

<P>The Port n Error Rate register is used in conjunction with the Port n Error Rate Threshold register to monitor and control the reporting of Port n physical layer errors. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-21. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-21. Bit Settings for Port n Error Rate CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-7 </P>
</TD>

<TD>
<P>Error Rate Bias </P>
</TD>

<TD>
<P>0x80 </P>
</TD>

<TD>
<P>This field specifies the rate at which the Error Rate Counter is decremented </P>

<P>(the error rate bias value)&#61472;&#61472;</P>

<P>0x00 - do not decrement the error rate counter&#61472;&#61472;</P>

<P>0x01 - decrement every 1ms (+/-34%)&#61472;&#61472;</P>

<P>0x02 - decrement every 10ms (+/-34%)&#61472;&#61472;</P>

<P>0x04 - decrement every 100ms (+/-34%)&#61472;&#61472;</P>

<P>0x08 - decrement every 1s (+/-34%)&#61472;&#61472;</P>

<P>0x10 - decrement every 10s (+/-34%)&#61472;&#61472;</P>

<P>0x20 - decrement every 100s (+/-34%)&#61472;&#61472;</P>

<P>0x40 - decrement every 1000s (+/-34%)&#61472;&#61472;</P>

<P>0x80 - decrement every 10000s (+/-34%) </P>

<P>other values are reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>8-13 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>14-15 </P>
</TD>

<TD>
<P>Error Rate Recovery </P>
</TD>

<TD>
<P>0b00 </P>
</TD>

<TD>
<P>The value of this field limits the incrementing of the Error Rate Counter above the failed threshold trigger. </P>

<P>0b00 - only count 2 errors above&#61472;&#61472;</P>

<P>0b01 - only count 4 errors above&#61472;&#61472;</P>

<P>0b10 - only count 16 error above&#61472;&#61472;</P>

<P>0b11 - do not limit incrementing the error rate count </P>
</TD>
</TR>

<TR>
<TD>
<P>16-23 </P>
</TD>

<TD>
<P>Peak Error Rate </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>This field contains the peak value attained by the error rate counter since the field was last reset. </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>Error Rate Counter </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>This field contains a count of the number of physical layer errors that have been detected by the port, decremented by the Error Rate Bias mechanism, to create an indication of the physical layer error rate. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3.2.18  Port n Error Rate Threshold CSR&#61472;&#61472;</P>

<P>(Block Offset 0x6C, AC,..., 42C) </P>

<P> </P>

<P>The Port n Error Rate Threshold register is used to control the reporting of the link status to the system host. The use and meaning of the bits and bit fields of this register shall be as specified in Table 2-22. Unless otherwise specified, the bits and bit and bit fields in this register are read/write. </P>

<P> </P>

<P>Table 2-22. Bit Settings for Port n Error Rate Threshold CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-7 </P>
</TD>

<TD>
<P>Error Rate Failed </P>

<P>Threshold Trigger </P>
</TD>

<TD>
<P>0xFF </P>
</TD>

<TD>
<P>This field contains the threshold value for reporting an error condition due to a possibly broken link. </P>

<P>0x00 - Disable the Error Rate Failed Threshold Trigger&#61472;&#61472;</P>

<P>0x01 - Set the error reporting threshold to 1&#61472;&#61472;</P>

<P>0x02 - Set the error reporting threshold to 2&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xFF - Set the error reporting threshold to 255 </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>Error Rate Degraded </P>

<P>Threshold Trigger </P>
</TD>

<TD>
<P>0xFF </P>
</TD>

<TD>
<P>This field contains the threshold value for reporting an error condition due to a degrading link. </P>

<P>0x00 - Disable the Error Rate Degraded Threshold Trigger&#61472;&#61472;</P>

<P>0x01 - Set the error reporting threshold to 1&#61472;&#61472;</P>

<P>0x02 - Set the error reporting threshold to 2&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xFF - Set the error reporting threshold to 255 </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex A Error Management Discussion </P>

<P>(Informative) </P>

<P> </P>

<P> </P>

<P>A.1 Introduction </P>

<P> </P>

<P>This section is intended to provide useful information/background on the application of the error management capabilities. This section is a guideline, not part of the specification. </P>

<P> </P>

<P> </P>

<P>A.2 Limitations of Error Management Discussion </P>

<P> </P>

<P>The RapidIO hardware that implements the Error Management extensions is able to log physical layer errors and errors that occur at a higher level. Some error scenarios require no software intervention and recovery procedures are done totally by the hardware. </P>

<P> </P>

<P>Some error scenarios detected require fault management software for recovery to be successful. For example, some types of logical layer errors on a Read or Write operation may be recoverable by killing the software process using the affected memory space and removing the memory space from the available system resource pool. It may also be possible for software to retry the operation, possibly through a different path in the switch fabric. Since such fault management software is typically tightly coupled to a particular system and/or implementation, it is considered outside of the scope of this specification. </P>

<P> </P>

<P>Another area of fault recovery that requires fault management software to be implemented is correcting of system state after an error during an atomic operation. The swap style Atomic operations are possibly recoverable through software and require software convention to uniquely identify attempts to take locks. For example, if the request is lost and times out, software can examine the current lock value to determine if the request or the associated response was the transaction that was lost in the switch fabric. For all other Atomic operations (such as the Atomic set operation), it is impossible to correct the system state in the presence of a &#8216;lost packet&#8217; type of error. </P>

<P> </P>

<P>The use of RapidIO message packets relies on the use of higher layer protocols for error management. Since end points that communicate via messaging are typically running a variety of higher layer protocols, error reporting of both request and response timeouts is done locally by the message queue management controller. </P>

<P> </P>

<P>RapidIO Trade Association 41 </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Note that side effect errors can occur, for example, ERROR responses or RETRY responses during an active (partially completed) message, which may complicate the recovery procedure. The recovery strategies for messages lost in this manner are outside of the scope of this specification. </P>

<P> </P>

<P>Globally Shared Memory systems that encounter a logical or transport layer error are typically not recoverable by any mechanism as this usually means that the processor caches are no longer coherent with the main memory system. Historically, recovery from such errors requires a complete reboot of the machine after the component that caused the error is repaired or replaced. </P>

<P> </P>

<P> </P>

<P>A.3 Hot-insertion/extraction Discussion </P>

<P> </P>

<P>Hot-insertion can be regarded as an error condition in which a new part of the system is detected, therefore, hot-insertion of a Field Replaceable Unit (FRU) can be handled utilizing the above described mechanisms. This section describes two approaches for hot insertion. The first generally applies to high availability systems, or systems where FRUs need to brought into the system in a controlled manner. The second generally applies to systems where availability is less of a concern, for example, a trusted system or a system without a system host. </P>

<P> </P>

<P>At system boot time, the system host identifies all of the unattached links in the machine through system discovery and puts them in a locked mode, whereby all incoming packets are to be rejected, leaving the drivers and receivers enabled. This is done by setting the Discovered bit in the Port General Control CSR and the Port Lockout bit in the Port n Control CSR. Note that whenever an FRU is removed, the port lockout bit should be used to ensure that whatever new FRU is inserted cannot access the system until the system host allows it. When a FRU is hot-inserted connecting to a switch device, the now connected link will automatically start the training sequence. When training is complete (the Port OK bit in the Port n Error and Status CSR is now set), the locked port generates a Maintenance port-write operation to notify the system host of the new connection, and sets the Port-write Pending bit. </P>

<P> </P>

<P>On receipt of the port-write, the system host is responsible for bringing the inserted FRU into the system in a controlled manner. The system host can communicate with the inserted FRU using Maintenance operations after clearing all error conditions, if any, clearing the Port Lockout bit and clearing the Output and Input Port Enable bits in the Port n Control CSR. This procedure allows the system host to access the inserted FRU safely, without exposing itself to incorrect behavior by the inserted FRU. </P>

<P> </P>

<P>In order to issue Maintenance operations to the inserted FRU, the system host must first make sure that the ackID values for both ends are consistent. Since the inserted FRU has just completed a power-up reset sequence, both it&#8217;s transmit and receive ackID values are the reset value of 0x00. The system host can set the switch device&#8217;s </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>transmit and receive ackID values to also be 0x00 through the Port n Local ackID Status CSR if they are not already in that state, and can then issue packets normally. </P>

<P> </P>

<P>The second method for hot insertion would allow the replaced FRU to bring itself into the system, which is necessary for a system in which the FRU is the system host itself. In this approach, the Port Lockout bit is not set and instead the Output and Input Port Enable bits are set for any unconnected port, allowing inserted FRUs free access to the system without reliance on a system host. Also, a port-write operation is not generated when the training sequence completes and the link is active, so a host is not notified of the event. However, this method leaves the system vulnerable to corruption from a misbehaving hot-inserted FRU. </P>

<P> </P>

<P>As with the first case, the system host must make the ackID values for both link partners match in order to begin sending packets. In order to accomplish this, the system host generates a link-request/link-status to the attached device to obtain it&#8217;s expected receiver value using the Port n Link Maintenance Request and Response CSRs. It can then set its transmit ackID value to match. Next, the system host generates a Maintenance write operation to set the attached device&#8217;s Port n Local ackID Status CSR to set the transmit ackID value to match the receive ackID value in the system host. Upon receipt of the maintenance write, the attached device sets it&#8217;s transmit ackID value as instructed, and generates the maintenance response using the new value. Packet transmission can now proceed normally. </P>

<P> </P>

<P>Hot extraction from a port&#8217;s point of view behaves identically to a very rapidly failing link and therefore can utilize the above described error reporting mechanism. Hot extraction is ideally done in a controlled fashion by taking the FRU to be removed out of the system as a usable resource through the system management software so that extraction does not cause switch fabric congestion or result in a loss of data. </P>

<P> </P>

<P>The required mechanical aspects of hot-insertion and hot-extraction are not addressed in this specification. </P>

<P> </P>

<P> </P>

<P>A.4 Port-write Discussion </P>

<P> </P>

<P>The error management specification includes only one destination for port-write operations, while designers of reliable systems would assume that two is the minimum number. This section explains the rationale for only having one port-write destination. </P>

<P> </P>

<P>It is assumed that in the event of an error on a link that both ends of the link will see the error. Thus, there are two parties who can be reporting on any error. In the case that the sole link between an end point and a switch fails completely, the switch is expected to see and report the error. When one of a set of redundant links between an end point and a switch device fails, it is expected that the switch and possibly the end point will report the failure. </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>When a link between two switches fails, it is assumed that there are multiple paths to the controlling entity available for the port-write to travel. The switches will be able to send at least one, and possibly two, reports to the system host. It is assumed that it is possible to set up a switch&#8217;s routing parameters such that the traffic to the system host will follow separate paths from each switch. </P>

<P> </P>

<P>In some reliable systems, the system host is implemented as multiple redundant subsystems. It is assumed in RapidIO that only one subsystem is actually in control at any one time, and so should be the recipient of all port-writes. If the subsystem that should be in control is detected to be insane, it is the responsibility of the rest of the control subsystem to change the destination for port-writes to be the new subsystem that is in control. </P>

<P> </P>

<P> </P>

<P>A.5 Physical Layer Fatal Error Recovery Discussion </P>

<P> </P>

<P>Recovery from a fatal error under software control at the physical layer may be possible under certain circumstances. An example of this would be if the transmitter and receiver have lost synchronization of their ackIDs. This could occur if one end of the link experienced a spurious reset. In this case a loss of packets may occur as there may be outstanding unacknowledged packets between the transmitter and the receiver. </P>

<P> </P>

<P>Such an event would cause an error to be detected given the appropriate initial conditions at the transmitter, and, eventually a port-write to the system host to be generated if the system is properly configured: </P>

<P>&#8226; The reset state of the Input Port Enable bit in the Port n Control CSR set to disabled throughout the system. </P>

<P>&#8226; All defined errors in the Port n Error Detect CSRs are enabled and will increment the error rate counter throughout the system. </P>

<P> </P>

<P>If a device experiences a reset event, numerous errors will be detected by the transmitter over time, and eventually an error threshold is reached as described in Section 1.2.2, &#8220;Error Reporting Thresholds&#8221;, and the system host is notified as described in Section 1.4, &#8220;System Software Notification of Error&#8221;. The most likely errors that will be detected are bits 12 (Received packet-not-accepted control symbol) and 26 (Non-outstanding ackID) in the Port n Error Detect CSRs, but others could be encountered depending upon the state of the link at the time of the reset event. </P>

<P> </P>

<P>Re-synchronizing the ackIDs must be done from the transmitter side as it is not possible to communicate with the receiver with maintenance transactions in this situation. This can be done by resetting some of the physical layer state by writing the Port n Local ackID Status CSR with the appropriate ackID values. It may be necessary to have the transmitter drop outstanding packets using that CSR as well, depending upon the situation. It may not be desirable, or it might not be possible, to resend  the  packets,  depending  upon  the  state  of  the  overall  system  and  the </P>

<P> </P>

<P>44 RapidIO Trade Association </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>transmitter implementation. </P>

<P> </P>

<P>Therefore, the following sequence of events occur: </P>

<P> </P>

<P>1. The system is configured as described above and is operating. </P>

<P>2. The receiver of a transmitter/receiver pair experiences a reset. </P>

<P>3. The transmitter enters error recovery mode and attempts to re-train the link. </P>

<P>4. Eventually the receiver comes back and link re-training completes. </P>

<P>5. The transmitter starts the error recovery sequence and begins to encounter large numbers of errors due to a bad ackID for a link-response (which may immediately cause a port-write transaction to be sent to the system host to report the condition) or having all packets receive packet-not-accepted control symbols. As noted earlier, other errors may also be detected. </P>

<P>6. At some point, an error threshold is reached and the system host is sent a port-write maintenance transaction to report the condition, if one has not already been sent. </P>

<P>7. The system host cleans up the machine using maintenance transactions, including resetting ackIDs in the transmitter and rediscovering and reconfiguring the lost portion of the machine. This may be a very complex and time-consuming task. </P>

<P> </P>

<P>Note that it may be useful to implement resetting the ackIDs and restarting the link in hardware for lab debug or for applications where frequent resets are expected and software intervention is not required. </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1553.jpg"/>
</Figure>

<P>D Degraded threshold. Bits 8-15 of the Port n Error Rate Threshold CSR. An application-specific level that indicates an unacceptable error rate resulting in degraded throughput, when equal to the error rate count. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1554.jpg"/>
</Figure>

<P>F Failed threshold. Bits 0-7 of the Port n Error Rate Threshold CSR. An application-specific level that indicates an error rate due to a broken </P>

<P>link, when equal to the error rate count. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1555.jpg"/>
</Figure>

<P>H Hot-insertion. Hot-insertion is the insertion of a processing element into a powered-up system. </P>

<P> </P>

<P>Hot-extraction. Hot-extraction is the removal of a processing element from a powered-up system. </P>

<P> </P>

<P> </P>

<Textbox>
<P>K </P>
</Textbox>

<P>L Logical/Transport error. A logical/transport error is one that cannot be resolved using the defined transmission error recovery sequence, results  in  permanent  loss  of  data  or  causes  system  corruption. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1556.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1557.jpg"/>
</Figure>

<P>Recovery may possible under software control. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1558.jpg"/>
</Figure>

<P>N Non-reporting   processing element. A non-reporting processing element depends upon an attached device (usually a switch) to report its logged errors to the system host on its behalf. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1559.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P>Ownership. A processing element has the only valid copy of a coherence granule and is responsible for returning it to home memory. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1560.jpg"/>
</Figure>

<P>P Physical error. A physical error occurs only in the physical layer. </P>

<P>RapidIO Part 8: Error Management Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Port healing. The process whereby software resets the error rate count, or allows it to decrement as required by the error rate bias field of the Port n Error Rate CSR. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1561.jpg"/>
</Figure>

<P>R Read operation. An operation used to obtain a globally shared copy of a coherence granule. </P>

<P> </P>

<P>Reporting processing element. A reporting processing element is capable of reporting its logged errors to the system host. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1562.jpg"/>
</Figure>

<P>S Switch processing element. One of three processing elements, a switch processing element, or switch, is capable of logging and reporting errors to the host system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1563.jpg"/>
</Figure>

<P>T Transmission error. A transmission error is one that can be resolved using the defined transmission error recovery sequence, results in no permanent  loss  of  data  and  does  not  cause  system  corruption. </P>

<P>Recovery  may  also  be  possible  under  software  control  using mechanisms outside of the scope of this specification. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1564.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 9: Flow Control Logical Layer Extensions Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1565.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.0 </P>
</TD>

<TD>
<P>First release </P>
</TD>

<TD>
<P>06/18/2003 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>No technical changes, revision changed for consistency with other specifications </P>

<P>Converted to ISO-friendly templates </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: new features showing 05-07-00001.003 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Technical changes: errata showing 10-08-00000.003 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Flow Control Overview </P>

<P> </P>

<P>1.1 Congestion Management ........................................................................................ 9 </P>

<P>1.1.1 Introduction......................................................................................................... 9 </P>

<P>1.1.2 Requirements .................................................................................................... 10 </P>

<P>1.1.3 Problem Illustration .......................................................................................... 10 </P>

<P>1.2 Flow Arbitration ................................................................................................... 12 </P>

<P>1.2.1 Fixed / Static Resource Allocation ................................................................... 13 </P>

<P>1.2.2 Dynamic Resource Allocation Protocol ........................................................... 13 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Logical Layer Flow Control Operation </P>

<P> </P>

<P>2.1 Fabric Link Congestion ........................................................................................ 15 </P>

<P>2.2 Flow Arbitration ................................................................................................... 15 </P>

<P>2.2.1 Arbitration Protocol .......................................................................................... 16 </P>

<P>2.2.2 Number Of Outstanding Requests .................................................................... 18 </P>

<P>2.3 Flow Control Operation ........................................................................................ 19 </P>

<P>2.4 Physical Layer Requirements ............................................................................... 20 </P>

<P>2.4.1 Fabric Topology................................................................................................ 20 </P>

<P>2.4.2 Flow Control Transaction Transmission........................................................... 20 </P>

<P>2.4.2.1 Orphaned XOFF Mechanism........................................................................ 21 </P>

<P>2.4.2.2 Controlled Flow List ..................................................................................... 21 </P>

<P>2.4.2.3 XOFF/XON Counters ................................................................................... 22 </P>

<P>2.4.3 Priority to Transaction Request Flow Mapping................................................ 22 </P>

<P>2.4.4 Flow Control Transaction Ordering Rules........................................................ 23 </P>

<P>2.4.5 End Point Congestion Management Rules ....................................................... 23 </P>

<P>2.4.6 Switch Congestion Management Rules ............................................................ 24 </P>

<P>2.4.7 Endpoint Rules for the Arbitration Protocol..................................................... 24 </P>

<P>2.4.8 Abnormal De-allocation of Resources.............................................................. 25 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Packet Format Descriptions </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 27 </P>

<P>3.2 Logical Layer Packet Format................................................................................ 27 </P>

<P>3.3 Flow Arbitration Message Fields (FAM) ............................................................. 29 </P>

<P>3.4 Transport and Physical Layer Packet Format ....................................................... 29 </P>

<P> </P>

<P> </P>

<P>Chapter 4 Logical Layer Flow Control Extensions Register Bits </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 31 </P>

<P>4.2 Processing Elements Features CAR (Offset 0x10 Word 0).................................. 31 </P>

<P>4.3 Port n Control CSR (Block Offsets 0x5C, 7C, ... , 23C) ...................................... 32 </P>

<P> </P>

<P>RapidIO Trade Association 3 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Annex A  Flow Control Examples (Informative) </P>

<P> </P>

<P>A.1 Congestion Detection and Remediation ............................................................... 33 </P>

<P>A.2 Orphaned XOFF Mechanism Description ............................................................ 34 </P>

<P>A.3 Discussion on Flow Arbitration ............................................................................ 35 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>1-1 Interconnect Fabric Congestion Example .......................................................................11 </P>

<P>2-1 Single PDU Transfer Scenario........................................................................................16 </P>

<P>2-2 Multi-PDU Transfer Scenario.........................................................................................17 </P>

<P>2-3 Multi-PDU scenario with receiver based de-allocation scheme .....................................18 </P>

<P>2-4 Pipelined Requests ..........................................................................................................19 </P>

<P>2-5 Flow Control Operation ..................................................................................................20 </P>

<P>3-1 Type 7 Packet Bit Stream Logical Layer Format ...........................................................28 </P>

<P>3-2 1x/4x LP-Serial Flow Control Packet .............................................................................30 </P>

<P>3-3 8/16 LP-LVDS Small Transport Flow Control Packet ...................................................30 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>2-1 Prio field to flowID Mapping .........................................................................................23 </P>

<P>3-1 Specific Field Definitions and Encodings for Type 7 Packets .......................................28 </P>

<P>3-2 Flow Arbitration Protocol Commands............................................................................29 </P>

<P>4-1 Bit Settings for Processing Elements Features CAR ......................................................31 </P>

<P>4-2 Bit Settings for Port n Control CSR................................................................................32 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank Page </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Flow Control Overview </P>

<P> </P>

<P>RapidIO transacts operations in &#8220;flows&#8221;. A flow is defined as the nexus of a source, a destination, and a physical channel. The physical channel is a virtual channel and/or a priority within a virtual channel. Since a large number of simultaneous connections can exist within a fabric, resources within the fabric and at the endpoints can be a constraint. The protocols defined in this specification permit the management of resources on a flow basis. </P>

<P> </P>

<P>The protocol consists of two functions, congestion management and flow arbitration. Congestion management may be implemented by endpoints or switches independent of the flow arbitration protocol. The flow arbitration protocol only applies to endpoints. Implementation of this specification is optional. </P>

<P> </P>

<P> </P>

<P>1.1 Congestion Management </P>

<P> </P>

<P> </P>

<P>1.1.1  Introduction </P>

<P> </P>

<P>A switch fabric based system can encounter several types of congestion, differentiated by the duration of the event: </P>

<P>&#8226; Ultra short term </P>

<P>&#8226; Short term </P>

<P>&#8226; Medium term </P>

<P>&#8226; Long term </P>

<P> </P>

<P>Congestion can be detected inside a switch, at the connections between the switch, and other switches and end points. Conceptually, the congestion is detected at an output port that is trying to transmit data to the connected device, but is receiving more information than it is able to transmit. This excess data can possibly &#8220;pile up&#8221; until the switch is out of storage capacity, and then the congestion spreads to other devices that are connected to the switch&#8217;s inputs, and so on. Therefore, contention for a particular connection in the fabric can affect the ability of the fabric to transmit data unrelated to the contested connection. This is highly undesirable behavior for many applications. </P>

<P> </P>

<P>The length of time that the congestion lasts determines the magnitude of the effect the congestion has upon the system overall. </P>

<P> </P>

<P>Ultra short term congestion events are characterized as lasting a very small length of </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 9 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>time, perhaps up to 500 or so nanoseconds. In a RapidIO type system these events are adequately handled by a combination of buffering within the devices on either end of a link and the retry based link layer mechanism defined in the RapidIO Part </P>

<P>4: 8/16 LP-LVDS Physical Layer and RapidIO Part 6: 1x/4x LP-Serial Physical Layer Specifications. This combination adds &#8220;elasticity&#8221; to each link in the system. The impact of ultra short term events on the overall system is minor, if noticeable at all. </P>

<P> </P>

<P>Short term congestion events last much longer than ultra short term events, lasting up into the dozens or hundreds of microseconds. These events can be highly disruptive to the performance of the fabric (and the system overall), in both aggregate bandwidth and end to end latency. Managing this type of congestion requires some means of detecting when an ultra short term event has turned into a short term event, and then using some mechanism to reduce the amount of data being injected by the end points into the congested portion of the fabric. If this can be done in time, the congestion stays localized until it clears, and does not adversely affect other parts of the fabric. </P>

<P> </P>

<P>Medium term congestion is typically a frequent series of short term congestion events over a long period of time, such as seconds or minutes. This type of event is indicative of an unbalanced data load being sent into the fabric. Alleviating this type of congestion event requires some sort of software based load balancing mechanism to reconfigure the fabric. </P>

<P> </P>

<P>Long term congestion is a situation in which a system does not have the raw capacity to handle the demands placed upon it. This situation is corrected by upgrading (or replacing) the system itself. </P>

<P> </P>

<P>This specification addresses the problem of short term congestion. </P>

<P> </P>

<P> </P>

<P>1.1.2  Requirements </P>

<P> </P>

<P>The flow control mechanism shall fulfill the following goals: </P>

<P> </P>

<P>&#8226; Simple - excess complexity will not gain acceptance </P>

<P>&#8226; React quickly - otherwise the solution won&#8217;t work </P>

<P>&#8226; Robust - same level of protection and recovery as the rest of RapidIO </P>

<P>&#8226; Scalable - must be able to extend to multi-layer switch systems </P>

<P>&#8226; Compatibility with all physical layers </P>

<P> </P>

<P> </P>

<P>1.1.3  Problem Illustration </P>

<P> </P>

<P>The RapidIO Part 1: Input/Output Logical Specification defines a transaction request flow as a series of packets that have a common source identifier and a common destination identifier at some given priority. On a link, packets of a single transaction request flow can be interleaved with packets from one or more other </P>

<P> </P>

<P> </P>

<P>10 RapidIO Trade Association </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>transaction request flows. </P>

<P> </P>

<P>No assumptions are made on the underlying switch architecture for this discussion of the short term congestion problem. Also for the purposes of this discussion, an idealized output queued switch is assumed, which in literature is also used to compare the performance of a particular switch under study. Packet buffers are associated with the output of the switch. An example switch topology showing output buffers is illustrated in Figure 1-1 below. A point of congestion is therefore associated with an output buffer of such a switch. </P>

<P> </P>

<P>The problem that is to be addressed by this specification is caused by multiple independent transaction request flows, each with burst and spatial locality characteristics that typically do not exceed the bandwidth capacity of links or end points. Due to the statistical combination of such transaction request flows, usually in the middle of multistage topologies, the demand for bandwidth through a particular link exceeds the link&#8217;s capacity for some period of time, for example, Data Flows a, b, and c for an output port of Switch 3 as shown in Figure 1-1. As a result, the output buffer for this port will fill up, causing the link layer flow control to be activated on the links of the preceding switch stages. The output packet buffers for Switches 1 and 2 then also fill up. Packets for transaction request flows, such as data flow d, in these same output buffers not destined for the output port with the full buffer in Switch 3 are now also waiting, causing additional system performance loss. This phenomenon is known as higher order head of line blocking. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1566.jpg"/>
</Figure>

<P>flows a,b,c,d output fifo </P>

<P>a </P>

<P>congestion point </P>

<P>EP LINK </P>

<P> </P>

<P> </P>

<P>b </P>

<P>EP LINK </P>

<P> </P>

<P> </P>

<P>c </P>

<P> </P>

<P> </P>

<P> </P>

<P>Switch </P>

<P>#1 </P>

<P>LINK </P>

<P>a+b </P>

<P> </P>

<P> </P>

<P> </P>

<P>Switch </P>
<Figure Alt="LINK">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1567.jpg"/>
</Figure>

<P>#3 </P>
<Figure Alt="LINK">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1568.jpg"/>
</Figure>

<P>LINK </P>

<P>a+b+c </P>

<P> </P>

<P> </P>

<P> </P>

<P>Switch </P>

<P>#5 </P>

<P>LINK EP </P>

<P>a+b </P>

<P> </P>

<P> </P>

<P>LINK EP </P>

<P>c </P>
<Figure Alt="d">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1569.jpg"/>
</Figure>

<P>EP LINK LINK EP </P>
<Figure Alt="c+d">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1570.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>d </P>

<P>EP LINK </P>

<P> </P>

<P>Switch </P>

<P>#2 </P>

<P> </P>

<P>Switch </P>

<P>#4 </P>

<P>Switch </P>

<P>#6 </P>

<P>d </P>

<P> </P>

<P> </P>

<P>LINK EP </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1571.jpg"/>
</Figure>

<P>Figure 1-1. Interconnect Fabric Congestion Example </P>

<P> </P>

<P>A second problem, less frequently a contributor to system performance loss, occurs when an end point cannot process the incoming bandwidth and employs link layer flow control to stop packets from coming in. This results in a similar sequence of events as described above. </P>

<P> </P>

<P>The problem described in this section is very well known in the literature. The aggregate throughput of the fabric is reduced with increased load when congestion control is not applied (see reference [1]). Such non-linear behavior is known as </P>

<P> </P>

<P>RapidIO Trade Association 11 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8216;performance-collapse&#8217;. It is the objective of this specification to provide a logical layer flow control mechanism to avoid this collapse. Research also shows that relatively simple &#8220;XON/XOFF&#8221; controls on transaction request flows can be adequate to control congestion in fabrics of significant size. </P>

<P> </P>

<P>The reason for the described non-linear behavior is illustrated with a saturation tree. The point at which a single transaction request flow that causes link bandwidth to be exceeded and causes buffer overflow is referred to as the root of the saturation tree. This tree grows backward towards the sources of all transaction request flows going through these buffers, and all buffers that these transaction request flows pass through in preceding stages, causing even more transaction request flows to be affected. </P>

<P> </P>

<P>An important design factor for interconnect fabrics is the latency between a congestion control action being initiated and the transaction request flow source acting in response. This latency determines, among other factors, the required buffer sizes for the switches. To keep such buffers small, the latency of a congestion control mechanism must be minimized. For example, 10 data flows contribute to a buffer overflow (forming what is known as a &#8220;hotspot&#8221;). If it takes 10 packet transmission times for the congestion notification to reach the sources and the last packets sent from the sources to reach the point of congestion after the sources react to the congestion notification, up to 100 packets could be added to the congested buffer. The number of packets added may be much smaller depending on the rate of oversubscription of the congested port. </P>

<P> </P>

<P>Reference </P>

<P> </P>

<P>[1] &#8220;Tree saturation control in the AC3 velocity cluster interconnect&#8221;, W. Vogels et.al., Hot Interconnects 2000, Stanford. </P>

<P> </P>

<P> </P>

<P>1.2 Flow Arbitration </P>

<P> </P>

<P>Protocols such as the RapidIO Data Streaming Logical Layer are designed to carry Protocol Data Units (PDUs) of lengths greater than 256 bytes by utilizing Segmentation and Reassembly (SAR). Coherency of the segmentation and reassembly process is enforced by RapidIO&#8217;s ordering rules for a packet flow. Since a flow (the nexus of a source, destination, and physical channel) must deliver packets in order, an endpoint ensures coherency of a segmentation / reassembly process by only introducing one complete PDU into a specific flow at a time. </P>

<P> </P>

<P>However, an endpoint can potentially connect to up to 64K other endpoints, with 4 or 8 or even 16 physical channels available between each endpoint. As such, an endpoint could have to potentially support millions of dedicated SAR contexts and reassembly buffers. For large PDUs having dedicated reassembly buffers per endpoint could be costly. </P>

<P> </P>

<P>The Data Streaming Segmentation and Reassembly contexts are one example of </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>flow based resources that may be a limited resource. Other logical layer functions, like DMA contexts, can also run into resource constraints. </P>

<P> </P>

<P>Managing limited resources can be done in a variety of ways, the use of an arbitration protocol is not mandatory: </P>

<P> </P>

<P> </P>

<P>1.2.1  Fixed / Static Resource Allocation </P>

<P> </P>

<P>Fixed allocation of resources occurs by system design. Systems with smaller topologies, or with endpoint resources sufficient for all anticipated flows, do not require any specific management. In larger systems, some portion of the resources can be fixed and assumed to be always available, reducing the number of resources that might have to be further managed. </P>

<P> </P>

<P>Resources may also be statically allocated on an individual connection basis. These resources would only be allocated via the overall connection admission algorithm. This additional layer of protection prevents flows from being admitted to the fabric that do not have corresponding resources on the receiving end. </P>

<P> </P>

<P> </P>

<P>1.2.2  Dynamic Resource Allocation Protocol </P>

<P> </P>

<P>The dynamic arbitration protocol is designed to arbitrate and allocate resources to flows for short durations of time. It allows a fewer number of resources to be dynamically shared among a larger number of flows. The system may still require the use of these resources to be intelligently managed in order to achieve desired system performance. The dynamic arbitration of resources will prevent data loss caused by overrunning the receiver. </P>

<P> </P>

<P>The congestion management commands affect flows on a packet boundary basis. The arbitration protocol commands affect flows at PDU boundaries (a PDU can consist of one or more packets). Endpoints must have the same understanding of PDU boundaries. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Logical Layer Flow Control </P>

<P>Operation </P>

<P> </P>

<P>This chapter describes the logical layer flow control mechanisms. </P>

<P> </P>

<P> </P>

<P>2.1 Fabric Link Congestion </P>

<P> </P>

<P>In compliant devices, logical layer flow control methods shall be employed within a fabric or destination end point for the purpose of short term congestion abatement at the point in time and location at which excessive congestion is detected. This remediation scheme shall be enacted via explicit flow control messages referred to as transmit off (XOFF) and transmit on (XON) congestion control packets (CCPs) which, like any other packet, require link-level packet acknowledgements. The XOFF CCPs are sent to shut off select flows at their source end points. Later, when the congestion event has passed, XON CCPs are sent to the same source end points to restore those flows. </P>

<P> </P>

<P>The method used to detect congestion is implementation specific and is heavily dependent upon the internal packet buffering structure and capacity of the particular switch device. In the example output port buffered switch from &#8220;Section 1.1.3, Problem Illustration&#8221;, on page 10, congestion occurs when some output buffer watermark is exceeded, but this is not the only way of detecting congestion. Several possible implementation methods are described in Appendix A. These described methods are purely exemplary and are not intended to be an exhaustive list of possible methods. </P>

<P> </P>

<P> </P>

<P>2.2 Flow Arbitration </P>

<P> </P>

<P>The flow arbitration protocol extends the Congestion Control Packet (CCP) protocol first introduced in Revision 1.3 of this specification. In addition to the XON/XOFF congestion management functionality the arbitration protocol adds the following commands: </P>

<P>&#8226; REQUEST </P>

<P>&#8226; XOFF to indicate un-availability of resources. </P>

<P>&#8226; XON to allow and grant use of resources </P>

<P>&#8226; RELEASE </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.2.1  Arbitration Protocol </P>

<P> </P>

<P>The protocol is illustrated in the following diagrams, using Data Streaming allocation of SAR resources as examples. There are two request messages pertaining to single PDU and multi-PDU transfers. The single PDU case is illustrated in Figure 2-1. The transmitting endpoint sends a single PDU request. The receiving endpoint will respond with either a XON(ARB) or XOFF(ARB) message depending on whether it has buffer and context resources available. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1572.jpg"/>
</Figure>

<P>TX  RX </P>
<Figure Alt="Request (">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1573.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Time </P>
</Textbox>

<P>TX starts transmission of PDU segments upon receiving the Xon(ARB) </P>

<P> </P>
<Figure Alt="ingle PD">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1574.jpg"/>
</Figure>

<P>Xon(ARB) </P>

<P> </P>

<P> </P>

<P>SOM COM EOM </P>

<P>SAR Resources allocated </P>

<P> </P>

<P>SOM = Start of Msg COM = Continuation EOM = End of Msg (see Data Streaming Spec. for details) </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1575.jpg"/>
</Figure>

<P>SAR resources de-allocated </P>

<P> </P>

<P> </P>

<P>Figure 2-1. Single PDU Transfer Scenario </P>

<P> </P>

<P>In the single PDU transfer case, if the receiving endpoint responds with a XOFF(ARB), the transmitting endpoint can send a new REQUEST message to ask for resources. If the receiving endpoint responds with a XON(ARB), the transmitting endpoint can start transmitting the PDU segments once it receives the XON(ARB) message. The receiver will automatically de-allocate resources once it receives the last packet for the PDU. </P>

<P> </P>

<P>When the transmitting endpoint sends a request pertaining to the transfer of multiple PDUs the receiving endpoint, similarly to the single PDU case, shall respond with either the XON(ARB) or the XOFF(ARB) protocol depending on the availability of buffering resources. If the receiving endpoint responds with a XON(ARB) message, as shown in Figure 2-2, the transmitting endpoint can start sending the PDU segments once it receives the XON(ARB) message. The transmitter can send multiple PDUs without having to renegotiate the resources. The receiver will hold the allocated resources until it receives a RELEASE message from the transmitting endpoint. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1576.jpg"/>
</Figure>

<P>TX  RX </P>
<Figure Alt="Request (Multi-PDU)">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1577.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Time </P>
</Textbox>

<P>TX starts transmission of PDU segments upon receiving the Xon(ARB) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>TX continues to transmit PDUs without having to renegotiate SAR context </P>

<P>Xon(ARB) </P>

<P> </P>

<P>SOM COM </P>

<P> </P>

<P>EOM SOM </P>

<P> </P>

<P> </P>

<P> </P>

<P>COM EOM Release </P>

<P>SAR resources allocated </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>SAR resources de- allocated upon receiving the Release Message </P>

<P> </P>

<P>Figure 2-2. Multi-PDU Transfer Scenario </P>

<P> </P>

<P>The receiver can also inform the transmitting endpoint of its desire to de-allocate the resources, by sending a XOFF(ARB) message. The transmitting endpoint, after sending the last packet at the current PDU boundary, will send a RELEASE message. The receiver shall de-allocate the resources only when it has received the RELEASE message. This scenario is illustrated in Figure 2-3. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1578.jpg"/>
</Figure>

<P>TX  RX </P>
<Figure Alt="Requ">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1579.jpg"/>
</Figure>
<Figure Alt="st (M">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1580.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="lti-PD">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1581.jpg"/>
</Figure>

<P>TX starts transmission of PDU segments upon receiving the Xon(ARB) </P>

<Textbox>
<P>Time </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Transmitter sends the Release message as soon as it is finished sending </P>

<P>the current  PDU </P>

<P>Xon(ARB) SOM </P>

<P> </P>

<P>COM Xoff(ARB) </P>

<P> </P>

<P>COM EOM </P>

<P> </P>

<P>Release </P>

<P>Reassembly buffers and </P>
<Figure Alt=")">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1582.jpg"/>
</Figure>

<P>SAR context allocated </P>

<P> </P>

<P> </P>

<P> </P>

<P>Receiver expresses desire to de-allocate SAR resources </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Reassembly buffers and SAR context de-allocated upon receiving the Release Message </P>

<P> </P>

<P> </P>

<P>Figure 2-3. Multi-PDU scenario with receiver based de-allocation scheme </P>

<P> </P>

<P> </P>

<P>2.2.2  Number Of Outstanding Requests </P>

<P> </P>

<P>In the arbitration protocol the transmitting endpoint has to wait at least a round trip time after it has sent the request message before it can start transmitting. This delay may be undesirable in high performance systems. Therefore, in order to overlap the request phase with the data transmission phase, the transmitter is allowed to have a maximum of one outstanding request in the system, that is, it can pipeline requests to increase the efficiency of the system. The requests and the corresponding responses are identified by a 1 bit sequence number. This pipelining of requests is allowed for both single PDU and multi-PDU requests. </P>

<P> </P>

<P>Consider the exchange shown in Figure 2-4 below. The transmitting endpoint issues a request. The request is processed by the receiving endpoint and a XON issued. Once the transmitter receives the XON message, it can start transmitting the data and it may also pipeline another request. The pipelined request shall not be honored until the current transaction has been completely received and resources are available for the next transaction. In Figure 2-4 Request_1 is sent after the transmitting endpoint has received the XON_0(ARB) message for the previous request (Request_0). If the receiving endpoint for some reason cannot queue/process the requests, it can send a XOFF (ARB) message immediately to indicate lack of resources. </P>

<P> </P>

<P>The pipelining of requests is managed by the source. It only issues the next request when the   current   request   has   been   acknowledged.  The   destination   only </P>

<P> </P>

<P>18 RapidIO Trade Association </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>acknowledges the next request when the current request has completed. So, the destination only has to queue up one outstanding request per flow. This pipelining also offers the destination an opportunity to use the pending requests to get a look at the incoming traffic and make better allocation decisions should there be limited resources. </P>

<P> </P>

<P>A single level of pipelining of requests is adequate because this is on a per flow basis. flow may only have a single open context at a time, so the current context must complete before the flow can be used for another transaction. </P>

<P> </P>

<P>NOTE: Context Definition </P>

<P>As a reminder, a &#8220;context&#8221; is a group of individual transactions that must remain ordered, and may not have intervening transactions from a different context in the same flow. </P>

<P> </P>

<P> </P>

<P>TX RX </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<P>Time </P>
</Textbox>

<P>TX starts transmission of PDU segments upon receiving the Xon(ARB) and piplelines another request at the receiver </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>TX receives the response to the outstanding request and starts data transmission </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="Request_1">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1583.jpg"/>
</Figure>

<P>Xon_0 (ARB) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>SOM COM EOM </P>

<P> </P>

<P>Xon_1 (ARB) SOM </P>

<P>COM EOM </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1584.jpg"/>
</Figure>

<P>Reassembly buffers and </P>
<Figure Alt="Request_0">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1585.jpg"/>
</Figure>

<P>SAR context allocated </P>

<P> </P>

<P> </P>

<P>The receiver buffers the second request </P>

<P> </P>

<P> </P>

<P> </P>

<P>Reassembly buffers and SAR context de-allocated upon receiving the EOM Message. The receiver processes the pipelined request only when previously allocated resources have been de- allocated and sends an Xon message </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 2-4. Pipelined Requests </P>

<P> </P>

<P> </P>

<P>2.3 Flow Control Operation </P>

<P> </P>

<P>The flow control operation consists of a single FLOW CONTROL transaction as shown in Figure 2-5. The FLOW CONTROL transaction is issued by a switch or end </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 19 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>point to control the flow of data. This mechanism is backward compatible with </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1586.jpg"/>
</Figure>

<P>RapidIO legacy devices in the same system. </P>

<P> </P>

<P> </P>

<P>1  FLOW CONTROL </P>

<P> </P>

<P> </P>

<P>Requestor Destination </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 2-5. Flow Control Operation </P>

<P> </P>

<P>While FLOW CONTROL packets do not contain response packets, the arbitration protocol does consist of multiple transactions between the source of a data flow and the destination. Some of the transactions flow from the destination to the source. </P>

<P> </P>

<P> </P>

<P>2.4 Physical Layer Requirements </P>

<P> </P>

<P>This section describes requirements put upon the system physical layers in order to support efficient logical layer flow control. </P>

<P> </P>

<P> </P>

<P>2.4.1  Fabric Topology </P>

<P> </P>

<P>The interconnect fabric for a system utilizing the logical layer flow control extensions must have a topology such that a flow control transaction can be sent back to any transaction request flow source. This path through the fabric may be back along the path taken by the transaction request flow to the congestion point or it may be back along a different path, depending upon the requirements of the particular system. </P>

<P> </P>

<P> </P>

<P>2.4.2  Flow Control Transaction Transmission </P>

<P> </P>

<P>Flow control transactions are regarded as independent traffic flows. They are the most important traffic flow defined by the system. Congestion management transactions are always transmitted at the first opportunity at the expense of all other traffic flows if possible. For the 8/16 LP-LVDS and 1x/4x LP-Serial physical layer specifications, this requires marking flow control packets with a &#8220;prio&#8221; field value of 0b11, and a &#8220;CRF&#8221; bit value of 0b1, if supported. Flow arbitration has additional requirements for some transactions to be transmitted in the same flow as the data packets. All of these transactions use a normal packet format for purposes of error checking and format. </P>

<P> </P>

<P>Because an implicit method of flow restoration was simulated and found to be impractical for RapidIO fabrics due to lack of system knowledge in the end point, an explicit restart mechanism using a XON transaction is used. In the CCP flow back to the source end point, XOFF and XON CCPs may be dropped on input ports of downstream elements in the event of insufficient buffer space. </P>

<P> </P>

<P>20 RapidIO Trade Association </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.4.2.1  Orphaned XOFF Mechanism </P>

<P> </P>

<P>Due to the possibility of XON flow control packets being lost in the fabric, there shall be an orphaned XOFF mechanism for the purpose of restarting orphaned flows which were XOFF&#8217;d but never XON&#8217;d in end points. Details of this mechanism are implementation specific, however the end point shall have sufficient means to avoid abandonment of orphaned flows. A typical implementation of such a mechanism would be some sort of counter. A description of a possible implementation is given in Appendix A. The Orphaned XOFF Mechanism is intended to work with the rest of the XON/XOFF CCPs to handle the short term congestion problem as previously described, and so shall operate such that software intervention is not required or inadvertently invoked. </P>

<P> </P>

<P>Counter mechanisms for arbitrated flows are also an implementation decision, but care should be taken before just enabling transmission on a flow. Unlike the congestion management protocol, arbitrated flows are expected to remain off until explicitly enabled. Timeouts at source end points should result in retrying requests, not just arbitrarily starting a flow. </P>

<P> </P>

<P>2.4.2.2  Controlled Flow List </P>

<P> </P>

<P>It is required that elements which send XOFFs keep a list of flows they have stopped, along with whatever flow-specific information is needed to select flows for restart, such as per-flow XON watermark level, or relative shut off order. This information shall be stored along with flow identification information in a &#8220;controlled flow list&#8221;, a memory structure associated with the controlling element. It shall be permissible in the time following the sending of a XOFF CCP for the flow control -initiating element to re-evaluate system resources and modify the flow restart ordering or expected XON watermark level within the controlled flow list to better reflect current system state. It shall not however be permissible to abandon the controlled flow by &#8220;forgetting&#8221; it, either due to lack of controlled flow list resources or other factors. In the event that limited controlled flow list resources cause the congested element to have insufficient room to issue another XOFF CCP which is deemed more important than a previously-XOFF&#8217;d controlled flow, then that previously-XOFF&#8217;d controlled flow may be prematurely XON&#8217;d and removed from the controlled flow list. The new, more important flow may be XOFF&#8217;d and take its place in the controlled flow list. </P>

<P> </P>

<P>Details of the controlled flow list are implementation specific, though at the very least it shall contain entries for each currently XOFF&#8217;d flow, including flow identification information. It is likely that some state information will be required, such as expected time of flow restart, or per-flow restart watermark levels. The controlled flow list size is selected to provide coverage for short term congestion events only. Remediation for medium and greater -term congestion events is beyond the scope of logical layer flow control as these events likely indicate systemic under-provisioning in the fabric. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Arbitrated resources must also be associated with a flow list to keep track of the flow the resources are allocated to. Should the source fail to utilize the resource in an expected interval, the destination may take action to recover the resource. The arbitration protocol provides a method to attempt to deallocate the resource in concert with the source to avoid packet loss (see &#8220;Section 2.2.1, Arbitration Protocol&#8221;, on page 16). Should that fail, asynchronous de-allocation of the resource may be used, with the understanding that packet loss could result. The implementation of such a mechanism is not specified here. Care should be taken to account for fabric latencies and not cause excessive packet loss during higher latency intervals. </P>

<P> </P>

<P>2.4.2.3  XOFF/XON Counters </P>

<P> </P>

<P>XOFF/XON counters shall be instantiated for some number of output flows at the end point. Since the number of flows may be large or unpredictable, the number of counters and how flows are aggregated to a particular counter is implementation dependant. However, all flows must be associated with a counter. For simplicity, the following behavioral description assumes a single flow associated with a single counter. The counter is initialized to zero at start up or when a new DestinationID and given Priority is initialized. The counter increments by one for each associated XOFF CCP and decrements by one for each associated XON CCP, stopping at zero. Only when this counter is equal to zero is the flow enabled. In no event shall the counter wrap upon terminal count. If the orphaned XOFF mechanism activates, the counter is reset to zero and the flow is restarted. </P>

<P> </P>

<P> </P>

<P>2.4.3  Priority to Transaction Request Flow Mapping </P>

<P> </P>

<P>When a switch or end point determines that it is desirable to generate a flow control transaction, it must determine the associated flowID for the (non-maintenance and non-flow control) packet that caused the flow control event to be signalled. Maintenance and flow control transaction request flows must never cause the generation of a flow control transaction. For the 8/16 LP-LVDS and the 1x/4x LP-Serial physical layer specifications, the flowID of a transaction request flow is mapped to the &#8220;prio&#8221; bits as summarized in Table 1-3 of the 8/16 LP-LVDS specification and Table 5-1 of the 1x/4x LP-Serial specification. Determining the original transaction request flow for the offending packet requires the switch to do a reverse mapping. </P>

<P> </P>

<P>It is recognized that mapping a particular response to a particular transmission request may be inaccurate because the end point that generated the response is permitted in the physical layer to promote the response to a priority higher than would normally be assigned. Deadlock avoidance rules permit this promotion. For this reason the choice of which flow to XOFF is preferably made using request packets, not response packets, as responses release system resources, which also may help alleviate system congestion. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Additionally, the CRF bit should also be used in conjunction with flowID to decide whether or not a particular transaction request flow should be targeted with a XOFF flow control transaction. A switch may select for shut off a packet with CRF=0 over a packet with CRF=1 if there are two different flows of otherwise equal importance. Correspondingly, an end point may choose to ignore a flow control XOFF request for a transaction request flow that it regards as critical. </P>

<P> </P>

<P>The reverse mappings from the transaction request flow prio field to the CCP flowID field for the 8/16 LP-LVDS and 1x/4x LP-Serial physical layers are summarized in Table 2-1. </P>

<P> </P>

<P>Table 2-1. Prio field to flowID Mapping </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Transaction Request flow prio Field </P>
</TD>

<TD>
<P> </P>

<P>Transaction </P>

<P>Type </P>
</TD>

<TD>
<P> </P>

<P>System Priority </P>
</TD>

<TD>
<P> </P>

<P>CCP flowID </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00 </P>
</TD>

<TD>
<P>request </P>
</TD>

<TD>
<P>Lowest </P>
</TD>

<TD>
<P>A </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00 </P>
</TD>

<TD>
<P>response </P>
</TD>

<TD>
<P>Illegal </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b01 </P>
</TD>

<TD>
<P>request </P>
</TD>

<TD>
<P>Next </P>
</TD>

<TD>
<P>B </P>
</TD>
</TR>

<TR>
<TD>
<P>0b01 </P>
</TD>

<TD>
<P>response </P>
</TD>

<TD>
<P>Lowest </P>
</TD>

<TD>
<P>A </P>
</TD>
</TR>

<TR>
<TD>
<P>0b10 </P>
</TD>

<TD>
<P>request </P>
</TD>

<TD>
<P>Highest </P>
</TD>

<TD>
<P>C or higher </P>
</TD>
</TR>

<TR>
<TD>
<P>0b10 </P>
</TD>

<TD>
<P>response </P>
</TD>

<TD>
<P>Lowest or Next </P>
</TD>

<TD>
<P>A or B </P>
</TD>
</TR>

<TR>
<TD>
<P>0b11 </P>
</TD>

<TD>
<P>request </P>
</TD>

<TD>
<P>Illegal </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>0b11 </P>
</TD>

<TD>
<P>response </P>
</TD>

<TD>
<P>Lowest or Next or Highest </P>
</TD>

<TD>
<P>A, B, C or higher </P>
</TD>
</TR>
</Table>

<P> </P>

<P>2.4.4  Flow Control Transaction Ordering Rules </P>

<P> </P>

<P>The ordering rules for flow control transactions within a system are analogous to those for maintenance transactions. </P>

<P>1. Ordering rules apply only between the source (the original issuing switch device or destination end point) of flow control transactions and the destination of flow control transactions. </P>

<P>2. There are no ordering requirements between flow control transactions and maintenance or non-maintenance request transactions. </P>

<P>3. A switch processing element must pass through flow control transactions between an input and output port pair in the order they are received. </P>

<P>4. An end point processing element must process flow control transactions from the same source (the destination of the packet that caused the flow control event) in the order they are received. </P>

<P> </P>

<P> </P>

<P>2.4.5  End Point Congestion Management Rules </P>

<P> </P>

<P>There are a number of rules related to flow control that are required of an end point that supports the logical layer flow control extensions. </P>

<P> </P>

<P>RapidIO Trade Association 23 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1. A XOFF flow control transaction stops all transaction request flows of the specified priority and lower targeted to the specified destination and increments the XON/XOFF counter associated with the specified flowID. </P>

<P>2. A XON flow control transaction decrements the XON/XOFF counter associated with the specified flowID. If the resulting value is zero, the transaction request flows for that flowID and flowIDs of higher priority are restarted. </P>

<P>3. An end point must be able to identify an orphaned XOFF&#8217;d flow and restart it. </P>

<P>4. A destination end point issuing a XOFF Flow Control transaction must maintain the information necessary to restart the flow with a XON flow control transaction when congestion abates. </P>

<P>5. Upon detection of congestion within one of its ports, the destination end point shall send required CCP(s) as quickly as possible to reduce latency back to the source end point. </P>

<P> </P>

<P> </P>

<P>2.4.6  Switch Congestion Management Rules </P>

<P> </P>

<P>There are a number of rules related to flow control that are required of a switch that supports the logical layer flow control extensions. </P>

<P>1. Upon detection of congestion within a port, the switch shall send a CCP (XOFF) for each congested flow to their respective end points. </P>

<P>2. If a switch runs out of packet buffer space, it is permitted to drop CCPs. </P>

<P>3. A switch issuing a XOFF Flow Control transaction must maintain the information necessary to restart the flow with a XON flow control transaction when congestion abates. </P>

<P> </P>

<P> </P>

<P>2.4.7  Endpoint Rules for the Arbitration Protocol </P>

<P> </P>

<P>Transmitters shall not transmit on an arbitrated flow unless a resource is available for reception of the PDU. Assumption of an available resource can either be fixed, statically allocated, or dynamically allocated. If dynamically allocated, the protocol must obey the following rules: </P>

<P>1. The transmitter shall issue a REQUEST when it wishes the receiver to allocate a resource to a particular flow. Note that this does not imply a PDU is immediately ready for transmission. The algorithms for resource allocation are up to the implementation. </P>

<P>2. The receiver shall respond to all REQUEST messages with a XOFF(ARB) or XON(ARB) depending on the availability of resources and the arbitration policy at the receiver. </P>

<P>3. The transmitter may send a new REQUEST message if: 1) it did not receive a response to the previous REQUEST message and timed out, or 2) it received a XOFF(ARB) message from the receiving endpoint. </P>

<P> </P>

<P>24 RapidIO Trade Association </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>4. Sequence numbers shall remain coherent for each individual flow. The sequence number shall remain the same for REQUESTs reissued for a given flow, without having received a response. The sequence number shall advance for any new REQUESTs on a given flow. </P>

<P>5. If a single PDU request is granted, the receiver may deallocate the resources at any time after: 1) it receives the last segment for the PDU, or 2) it does not receive a packet and an idle counter for the session times out (see rule l). The transmitter shall assume the context is no longer available upon sending the last segment for the PDU. </P>

<P>6. If the resources were granted in response to a multi-PDU request the transmitter may transmit PDUs continuously on that flow until the resource is de-allocated. </P>

<P>7. The transmitter may relinquish a multi-PDU context by sending a RELEASE </P>

<P>message after completion of the current PDU. </P>

<P>8. The receiver may send a XOFF(ARB) message during the multi-PDU transfer to indicate its desire to deallocate resources. The transmitter, upon receiving a XOFF(ARB) message during the multi-PDU transfer, shall complete transmission of the current PDU and send a RELEASE message to allow the receiver to de-allocate the resources. The receiver may not deallocate the resources until the RELEASE message is received. </P>

<P>9. The receiver may delay sending responses to the REQUEST commands to consider which REQUESTs to grant or reject. There is no ordering requirement for processing requests from different flows. </P>

<P>10. Only a single instance of resources shall be allocated to a flow at any point in time. </P>

<P>11. The transmitter may issue a single additional REQUEST in advance of completion of the current PDU. However, the transmitter shall not have more than one outstanding REQUEST at any point in time. </P>

<P>12. REQUEST, XON(ARB), and XOFF(ARB) messages may be sent in any flow (such as a high priority channel). RELEASE messages shall be sent in the same flow that the context is allocated for. </P>

<P> </P>

<P> </P>

<P>2.4.8  Abnormal De-allocation of Resources </P>

<P> </P>

<P>Abnormal de-allocation of Resources will occur under the following circumstances: </P>

<P> </P>

<P>1. If the resources were allocated in response to a single PDU request: </P>

<P>&#8211;  The PDU may be aborted according to the exceptions defined in the logical layer rules for the segmentation process. An aborted PDU results in the de-allocation of the resources. </P>

<P>&#8211;  If the receiver does not receive a packet from the transmitter before the idle counter for the session times out, the resources would be de-allocated. Note that the use of a timer is implementation specific. Incorrect use of a timer may result in packet loss. </P>

<P> </P>

<P>RapidIO Trade Association 25 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2. If the resources were allocated in response to a Multi-PDU request: </P>

<P>&#8211;  A PDU may be aborted according to the exceptions defined in the logical layer. The resources will still not be de-allocated until a RELEASE message is received. </P>

<P>&#8211;  If the receiver does not receive a packet from the transmitter before the idle counter for the session times out, the receiver shall first attempt to use the XOFF(ARB) / RELEASE handshake to deallocate the context. If a subsequent timeout is encountered, the SAR resources are asynchronously de-allocated. </P>

<P> </P>

<P>NOTE: Timeouts for Arbitration Protocol are Optional </P>

<P>Use of timers with the arbitration protocol is optional. Timer intervals are specific to system implementation and performance goals. Aggressive timer intervals may result in retrying operations that were simply slowed down due to system congestion. Aggressive recovery of resources may also result in packet loss. Conservative time intervals may result in poor performance if transactions are lost or corrupted. It is up to the implementer to determine the correct behavior for the specific system environment. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Packet Format Descriptions </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This chapter contains the definition of the flow control packet format. The type 7 </P>

<P>FLOW CONTROL packets are used by the switch or the end points to signal congestion buildup within the node (switch or endpoint) or exchange flow arbitration protocol messages. </P>

<P> </P>

<P> </P>

<P>3.2 Logical Layer Packet Format </P>

<P> </P>

<P>The type 7 FLOW CONTROL packet formats (Flow Control Class) are used by a RapidIO switch or end point processing element to stop (XOFF) and start (XON) the flow of traffic to it from a targeted RapidIO end point processing element. A single transaction request flow is targeted with a CCP. Type 7 packets do not have a data payload and do not generate response packets. The origin of a flow control packet shall set the SOC (Source of Congestion) bit to (SOC=0) if it is a switch or (SOC=1) if it is an end point. The SOC bit is informational only but may be useful for system software in identifying a failing end point. </P>

<P> </P>

<P>The Flow Arbitration Message (FAM) field is used to modify the XON or XOFF </P>

<P>message for the purposes of flow arbitration. </P>

<P> </P>

<P>Definitions and encodings of fields specific to type 7 packets are provided in </P>

<P>Table 3-1. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 3-1. Specific Field Definitions and Encodings for Type 7 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Type 7 Fields </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>XON/XOFF </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>XOFF&#61472;&#61472;</P>

<P>For devices not supporting flow arbitration:&#61472;&#61472;</P>

<P>Stop issuing requests for the specified and lower priority transaction request flows </P>

<P>For devices supporting flow arbitration (see Table 3-2) </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>XON&#61472;&#61472;</P>

<P>For devices not supporting flow arbitration:&#61472;&#61472;</P>

<P>Start issuing requests for the specified and higher priority transaction request flows </P>

<P>For devices supporting flow arbitration (see Table 3-2) </P>
</TD>
</TR>

<TR>
<TD>
<P>flowID </P>
</TD>

<TD>
<P> </P>

<P>0000000 (Flow0A) </P>

<P>0000001 (Flow 0B) </P>

<P>0000010 (Flow 0C) </P>

<P>0000011 (Flow 0D) </P>

<P>0000100 (Flow 0E) </P>

<P>0000101 (Flow 0F) </P>

<P> </P>

<P> </P>

<P>1000001 (Flow 1A) </P>

<P>1000010 (Flow 2A) </P>

<P>1000011 (Flow 3A) </P>

<P>1000100 (Flow 4A) </P>

<P>1000101 (Flow 5A) </P>

<P>1000110 (Flow 6A) </P>

<P>1000111 (Flow 7A) </P>

<P>1001000 (Flow 8A) </P>
</TD>

<TD>
<P>Highest priority affected transaction request flow for VC0 transaction request flow A&#61472;&#61472;</P>

<P>transaction request flow B&#61472;&#61472;</P>

<P>transaction request flow C transaction request flow D transaction request flow E </P>

<P>transaction request flow F and higher </P>

<P> </P>

<P>For VC1-VC8 the following flow IDs will result in the VC1-VC8 flow control </P>

<P>Flow 1A and higher for VC1 </P>

<P>Flow 2A and higher for VC2 </P>

<P>Flow 3A and higher for VC3 </P>

<P>Flow 4A and higher for VC4 </P>

<P>Flow 5A and higher for VC5 </P>

<P>Flow 6A and higher for VC6 </P>

<P>Flow 7A and higher for VC7 </P>

<P>Flow 8A and higher for VC8 </P>

<P>Remaining encodings are reserved for the 8/16 LP-LVDS and the 1x/4x LP-Serial physical layers. </P>
</TD>
</TR>

<TR>
<TD>
<P>destinationID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Indicates which end point the CCP is destined for (sourceID of the packet which caused the generation of the CCP). </P>
</TD>
</TR>

<TR>
<TD>
<P>tgtdestinationID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Combined with the flowID field, indicates which transaction request flows need to be acted upon (destinationID field of the packet which caused the generation of the CCP). </P>
</TD>
</TR>

<TR>
<TD>
<P>SOC </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Source Of Congestion is a Switch </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Source Of Congestion is an End Point </P>
</TD>
</TR>

<TR>
<TD>
<P>FAM </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>See Section 3.3 </P>
</TD>
</TR>

<TR>
<TD>
<P>rsrv </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Figure 3-1 displays a CCP packet with all its fields. The field value 0b0111 in Figure 3-1 specifies that the packet format is of type 7. Small (tt=0b00) and Large (tt=0b01) Transport Formats are shown in the figure. </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>0 1 1 1 </P>
</TD>

<TD>
<P>tgtdestinationID </P>
</TD>

<TD>
<P>XON/XOFF </P>
</TD>

<TD>
<P>FAM </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>flowID </P>
</TD>

<TD>
<P>SOC </P>
</TD>
</TR>
</Table>

<P>4 8(tt=0b00),16(tt=0b01) 1 </P>

<P>3 4 7 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 3-1. Type 7 Packet Bit Stream Logical Layer Format </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>3.3 Flow Arbitration Message Fields (FAM) </P>

<P> </P>

<P>The flow arbitration protocol uses the 3 FAM bits along with the XON/XOFF bit to identify the messages. A device that does not support the SAR protocol ignores the FAM bits. It should be noted that a device which supports the flow arbitration protocol when communicating with an end point that does not support SAR protocol should default to the congestion management (XON/XOFF) functionality and not send other messages as they would be mis-interpreted. The CAR bits define whether the device supports the flow arbitration protocol or not. The bit &#8220;Y&#8221; is the sequence number bit previously described. </P>

<P> </P>

<P>Table 3-2. Flow Arbitration Protocol Commands </P>

<P> </P>

<Table>
<TR>
<TD>
<P>XON/XOFF </P>
</TD>

<TD>
<P>FAM </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>XOFF: Transmit off (Congestion management) Stop issuing requests for the specified and lower priority transaction request flows </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b010 </P>
</TD>

<TD>
<P>XOFF(ARB): Flow Request Rejected. Message with sequence number 0 (LSB) in response to REQUEST with sequence number 0. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b011 </P>
</TD>

<TD>
<P>XOFF(ARB):Flow Request Rejected. Message with sequence number 1(LSB) in response to REQUEST with sequence number 1. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b10Y </P>
</TD>

<TD>
<P>RELEASE: Release message informs the receiving endpoint to de-allocate the buffer space reserved by the receiving endpoint. The release message should be used in conjunction with the request. </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>XON: Transmit on. (Congestion management) Start issuing requests for the specified and higher priority transaction request flows </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b01Y </P>
</TD>

<TD>
<P>XON(ARB): Flow Request Granted. Reassembly buffer space is now available and allocated. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b10Y </P>
</TD>

<TD>
<P>REQUEST: Request Flow Single PDU. Buffer space will be de-allocated once the end transaction is received for that PDU. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b11Y </P>
</TD>

<TD>
<P>REQUEST: Request Flow Multi-PDU. This request message informs the receiving endpoint to reserve the buffer space until it receives the release message. The buffer space will be de-allocated once the release command is received by the receiver. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.4 Transport and Physical Layer Packet Format </P>

<P> </P>

<P>Figure 3-2 shows a complete flow control packet, including all transport and 1x/4x LP-Serial physical layer fields except for delineation characters. The destinationID field of the CCP packet is the sourceID field from packets associated with the congestion event, and is the target of the flow control transaction. The tgtdestinationID field is the destinationID field from packets associated with the congestion event, and was the target of those packets. The tgtdestinationID field is used by the target of the flow control packet to identify the transaction request flow that needs to be acted upon. For all undefined flowID encodings, there is no action required and the tgtdestinationID is ignored. Field size differences for 8 bit address Small Transport Format (tt=0b00) vs. 16 bit address Large Transport Format (tt=0b01) are shown. Note: when tt=0b01 there will be a pad after the CRC. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1587.jpg"/>
</Figure>

<P>time </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Preceding bits </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>rsrv=0 </P>
</TD>

<TD>
<P>VC </P>
</TD>

<TD>
<P>crf=1 </P>
</TD>

<TD>
<P>prio=1 1 </P>
</TD>

<TD>
<P>tt=0 m </P>
</TD>

<TD>
<P>ftype=0 1 1 1 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>5 1 1 1 2 2 4 </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>destinationID </P>

<P> </P>

<P>8 (tt=0b00) or 16 (tt=0b01) </P>

<P>tgtdestinationID </P>

<P> </P>

<P>8 (tt=0b00) or 16 (tt=0b01) </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>XON/XOFF </P>
</TD>

<TD>
<P>FAM </P>
</TD>

<TD>
<P>rsrv=0 0 0 0 </P>
</TD>

<TD>
<P>flowID </P>
</TD>

<TD>
<P>SOC </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>7 </P>
</TD>

<TD>
<P>1 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1588.jpg"/>
</Figure>

<P>CRC </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1589.jpg"/>
</Figure>

<P>16 </P>

<P>Following bits </P>

<P> </P>

<P>Figure 3-2. 1x/4x LP-Serial Flow Control Packet </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1590.jpg"/>
</Figure>

<P>Figure 3-3 shows the corresponding 8/16 LP-LVDS physical layer small transport packet. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1591.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1592.jpg"/>
</Figure>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1593.jpg"/>
</Figure>

<P>Port bit numbers </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1594.jpg"/>
</Figure>

<P>32-bit boundary, framing signal toggles </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1595.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1596.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1597.jpg"/>
</Figure>

<P>framing signal toggles </P>

<P>32-bit boundary, </P>

<P>Time </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1598.jpg"/>
</Figure>

<P>Figure 3-3. 8/16 LP-LVDS Small Transport Flow Control Packet </P>

<Textbox>
<Table>
<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>

<TR>
<TD>
<P>Preceding byte </P>
</TD>
</TR>

<TR>
<TD>
<P>S=0 </P>
</TD>

<TD>
<P>ackID </P>
</TD>

<TD>
<P>rsrv=0 </P>
</TD>

<TD>
<P>S=1 </P>
</TD>

<TD>
<P>VC </P>
</TD>

<TD>
<P>crf=1 </P>
</TD>
</TR>

<TR>
<TD>
<P>prio=1 1 </P>
</TD>

<TD>
<P>tt=0 0 </P>
</TD>

<TD>
<P>ftype=0 1 1 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>destinationID </P>
</TD>
</TR>

<TR>
<TD>
<P>tgtdestinationID </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>XON/XOF </P>
</TD>

<TD>
<P>F FAM </P>
</TD>

<TD>
<P>rsrv=0 0 0 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>flowID </P>
</TD>

<TD>
<P>SOC </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[0&#8211;7] </P>
</TD>
</TR>

<TR>
<TD>
<P>CRC[8&#8211;15] </P>
</TD>
</TR>

<TR>
<TD>
<P>Following byte </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>4 </P>
</TD>

<TD>
<P>5 </P>
</TD>

<TD>
<P>6 </P>
</TD>

<TD>
<P>7 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Logical Layer Flow Control </P>

<P>Extensions Register Bits </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>

<P>This section describes the Logical Layer Flow Control Extensions CAR and CSR bits that allow an external processing element to determine if a switch or end point device supports the flow control extensions defined in this specification, and to manage the transmission of flow control transactions for a switch processing element. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, physical, and extension specifications of interest to determine a complete list of registers and bit definitions for a device. All registers are 32-bits and aligned to a 32-bit boundary. </P>

<P> </P>

<P> </P>

<P>4.2 Processing Elements Features CAR&#61472;&#61472;</P>

<P>(Offset 0x10 Word 0) </P>

<P> </P>

<P>The Processing Elements Features CAR contains 31 processing elements features bits defined in various RapidIO specifications, as well as the Flow Control Support bit, and Flow Arbitration Participant bit are defined here. </P>

<P> </P>

<P>Table 4-1. Bit Settings for Processing Elements Features CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-19 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>

<TR>
<TD>
<P>20 </P>
</TD>

<TD>
<P>Flow Arbitration Support </P>
</TD>

<TD>
<P>* </P>
</TD>

<TD>
<P>Support for flow arbitration </P>

<P>0b0 - does not support flow arbitration </P>

<P>0b1 - supports flow arbitration </P>
</TD>
</TR>

<TR>
<TD>
<P>21-23 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>

<TR>
<TD>
<P>24 </P>
</TD>

<TD>
<P>Flow Control Support </P>
</TD>

<TD>
<P>* </P>
</TD>

<TD>
<P>Support for flow control extensions </P>

<P>0b0 - Does not support flow control extensions&#61472;&#61472;</P>

<P>0b1 - Supports flow control extensions </P>
</TD>
</TR>

<TR>
<TD>
<P>26-31 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>
</Table>

<P> </P>

<P>* Implementation dependant </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>4.3 Port n Control CSR&#61472;&#61472;</P>

<P>(Block Offsets 0x5C, 7C, ... , 23C) </P>

<P> </P>

<P>The Port n Control CSR contains 30 bits specifying individual port controls defined in various RapidIO specifications, as well as the Flow Control Participant and Flow Arbitration Participant bits. </P>

<P> </P>

<P>Table 4-2. Bit Settings for Port n Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-9 (parallel)&#61472;&#61472;</P>

<P>0-12 (serial) </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>

<TR>
<TD>
<P>10 (parallel)&#61472;&#61472;</P>

<P>13 (serial) </P>
</TD>

<TD>
<P>Flow Control Participant </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable flow control transactions </P>

<P>0b0 - Do not route or issue flow control transactions to this port&#61472;&#61472;</P>

<P>0b1 - Route or issue flow control transactions to this port </P>
</TD>
</TR>

<TR>
<TD>
<P>11 (parallel)&#61472;&#61472;</P>

<P>14 (serial </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>

<TR>
<TD>
<P>12 (parallel)&#61472;&#61472;</P>

<P>15 (serial) </P>
</TD>

<TD>
<P>Flow Arbitration </P>

<P>Participant </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable Flow Arbitration Transactions: </P>

<P>0b0 - do not route or issue flow arbitration transactions to this port </P>

<P>0b1 - route or issue flow arbitration transaction to this port </P>
</TD>
</TR>

<TR>
<TD>
<P>13-31 (parallel)&#61472;&#61472;</P>

<P>16-31 (serial </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex A Flow Control Examples (Informative) </P>

<P> </P>

<P> </P>

<P>A.1 Congestion Detection and Remediation </P>

<P> </P>

<P>The method used to detect congestion is implementation specific and is heavily dependent upon the internal packet buffering structure and capacity of the particular switch device. In the example output port buffered switch from &#8220;Section 1.1.3, Problem Illustration&#8221; on page 10, congestion occurs when some output buffer watermark is exceeded. As long as the watermark is exceeded the output port is said to be in a congested state. The watermark can have different levels when entering the congested state and leaving the congested state. </P>

<P> </P>

<P>Fabric elements should monitor their internal packet buffer levels, comparing them on a packet by packet basis to pre-established, locally-defined watermark levels. These levels likely would be configurable depending upon the local element's position within the fabric relative to source endpoints and its particular architecture. On the high watermark side, a level should be selected which is low enough that the remaining buffer space is adequate to provide ample storage for packets in-flight, given a worse-case latency for XOFF CCPs to travel back to the source endpoint and shut off the flow in the endpoint. On the low watermark side (if a watermark is used for XON), a yet-lower level should be selected which meets the following criteria; </P>

<P>a ) Provides sufficient hysteresis. When considered in context with the high watermark, it should not be so close as to provide a high flow of XON/XOFF CCP traffic back to the source endpoint. </P>

<P>b ) Is set high enough that the switch output buffer does not run dry (underflow) in the typical live-flow case (one or more packets are present in the source endpoint output buffer waiting to be sent when the flow is restarted), given the latency of XON CCP travel back to the source endpoint and restoration of the shut-off flow in the endpoint. </P>

<P> </P>

<P>The following two examples are provided to show possible methods for detecting and reacting to congestion: </P>

<P>1. Histogram analysis: </P>

<P>&#8212; The switch keeps track of packet quantities for the different transaction request flows for which packets are stored in its output buffer. </P>

<P>&#8212; The switch sorts the transaction request flows according to the number of packets. </P>

<P>&#8212; The switch selects the 1 to 5 transaction request flows with the most </P>

<P> </P>

<P>RapidIO Trade Association 33 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>packets stored in the buffers. </P>

<P>&#8212; The switch sends an XOFF flow control request to those transaction request flow sources when the watermark threshold is exceeded, as long as flow control transaction routing is enabled on that switch port. Handling of system critical flows intending to bypass the flow control operation is outside the scope of this document. </P>

<P>&#8212; The CCP-targeted sources stop transmitting packets for the indicated transaction request flow and all lower priority transaction request flows. </P>

<P>&#8212; The switch sends a flow control XON request to those transaction request flow sources when the watermark drops below the threshold. </P>

<P>&#8212; The CCP-targeted sources begin to transmit packets for the indicated transaction request flow and all higher priority transaction request flows. </P>

<P>2. Simple threshold: </P>

<P>&#8212; The switch sends an XOFF flow control to the source of every new transaction flow it receives as long as the watermark is exceeded, provided flow control transaction routing is enabled on that switch port. Handling of system critical flows intending to bypass the flow control operation is outside the scope of this document. </P>

<P>&#8212; The CCP-targeted sources stop transmitting packets for the indicated transaction request flow and all lower priority transaction request flows. </P>

<P>&#8212; The switch sends a flow control XON request to those transaction request flow sources when the watermark drops below the threshold. </P>

<P>&#8212; The CCP-targeted sources begin to transmit packets for the indicated transaction request flow and all higher priority transaction request flows. </P>

<P> </P>

<P>Note that the first method is reasonably fair in that it targets the source of the data flows that are consuming most of the link bandwidth, and that the second method is unfair in that it indiscriminately targets any source unfortunate enough to have a packet be transmitted while the link is congested. </P>

<P> </P>

<P> </P>

<P>A.2 Orphaned XOFF Mechanism Description </P>

<P> </P>

<P>This timer may take the form of a low precision counter in the end point which monitors the oldest XOFF&#8217;d flow at any given time. When a flow first becomes the oldest flow (reaches top of an XOFF&#8217;d flow FIFO list within the end point) the timer is reset to its programmed value and begins to count down with time. If it is allowed to elapse without a change to the oldest XOFF&#8217;d flow, that flow will be presumed to be orphaned due to lost XON CCP and be restarted as if an XON CCP had been received, with the orphaned flow entry removed from the top of the list and the counter reset to count down for the next oldest XOFF&#8217;d flow. The length of the count should be long enough to insure that significant degradation of the flow control function does not occur, on the order of several times the width of the fabric expressed in terms of packet transit time, yet not so large that it would fail to elapse </P>

<P> </P>

<P> </P>

<P>34 RapidIO Trade Association </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>between uncorrelated congestion events. The length of this count shall be programmable through an implementation-dependent register in the end point. The orphaned XOFF mechanism is intended solely as a last-resort mechanism for restarting orphaned flows. It will not be adequate for the purpose of implicit controlled flow reinstatement owing to inherent fairness issues as well as burstyness due to uncontrolled simultaneous multi-flow restart. </P>

<P> </P>

<P> </P>

<P>A.3 Discussion on Flow Arbitration </P>

<P> </P>

<P>The objectives of the flow arbitration protocol are: </P>

<P> </P>

<P>1) Conserve resources at the end point, and allow for limited resources to be utilized in a larger system context. </P>

<P>2) Conserve system resources, minimizing protocol overhead. </P>

<P>3) Provide robustness against failures and lost messages as well as provide for low implementation complexity. </P>

<P> </P>

<P>Flow arbitration allows for managing resources that are critical to &#8220;flows&#8221;. A flow is a nexus of a source, a destination, and a physical channel. With the priorities and virtual channels that exist at the physical layer, even a medium system with a few nodes could have 100&#8217;s or 1000&#8217;s of flows. Most RapidIO transactions are self contained (as with an IO_WRITE) and thus have a limited &#8220;context&#8221;. But the data streaming logical type can have a context that spans multiple transactions, and thus needs a persistent resource. The segmentation/reassembly resource is one example of a resource that may be in limited supply in a large system. But, SAR resource management is not the only use of this protocol. Any resource provided by the logical interface to help offload the system may use contexts that span multiple transactions. </P>

<P> </P>

<P>As described in the introduction, resources may be managed in three ways: </P>

<P> </P>

<P>&#8226; The system designer can use end points with enough resources for the worst case combination of flows (fixed) </P>

<P>&#8226; The system designer can provide enough resources for the worst case number of flows based on expected traffic, allocating them on a connection by connection basis (static) </P>

<P>&#8226; The limited resources can be shared among a larger number of connections on a PDU by PDU basis (dynamic) </P>

<P> </P>

<P>It is important to provide some management of resources because an overrun will cause packet loss, at least for the data streaming protocol. </P>

<P> </P>

<P>Dynamic allocation is what the protocol defined in this specification provides, but it is not expected to be the sole method of resource allocation. If all the contexts were to use a dynamic protocol, goals #2 and #3, as stated above, might not be met. It is expected that some number of flows will be fixed or static, and only a portion of the lower quality of service flows will arbitrate for some portion of the resources. </P>

<P> </P>

<P>RapidIO Trade Association 35 </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>System designers are responsible for selecting components that match their strategy for resource management. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1599.jpg"/>
</Figure>

<P>C Congestion. A condition found in output ports of switch and bridge elements characterized by excessive packet buildup in the buffer, when packet entry rate into the buffer exceeds packet exit rate for a long enough </P>

<P>period of time. </P>

<P> </P>

<P>CCP. (Congestion Control Packet). A packet sent from the point of congestion in the fabric back to the source endpoint of particular flows instructing the source to either turn on or off the flow. </P>

<P> </P>

<P>Controlled Flow List. A memory structure associated with controlling elements which holds a list of currently controlled flows, used by the element to turn back on controlled flows. </P>

<P> </P>

<P>CRF. Critical Request Flow. For packets or packets of a given priority, this bit further defines which packet or notice should be moved first from the input queue to the output queue (see RapidIO Part 4: 8/16 LP- LVDS Physical Layer Specification, Section 1.2.2 and RapidIO Part </P>

<P>6: 1x/4x LP-Serial Physical Layer Specification, Section 5.3.3). </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1600.jpg"/>
</Figure>

<P>F flowID.   Transaction   request   flow   indicator   (see   RapidIO   Part   1: Input/Output Logical Specification, Section 1.2.1). </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1601.jpg"/>
</Figure>

<P>L Long Term Congestion. A severe congestion event in which a system does not have the raw capacity to handle the demands placed upon it in </P>

<P>actual use. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1602.jpg"/>
</Figure>

<P>M Medium Term Congestion. A congestion event in which a frequent series of short term congestion events occur over a long period of time such as seconds   or   minutes,   handled   in   RapidIO   systems   by </P>

<P>reconfiguration of the fabric by system-level software. </P>

<P>RapidIO Part 9: Flow Control Logical Layer Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1603.jpg"/>
</Figure>

<P>O Orphaned XOFF Mechanism. A mechanism in an end point which is used to restart the oldest controlled flow within the end point after a </P>

<P>certain period of time has elapsed without the flow being XON&#8217;d. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1604.jpg"/>
</Figure>

<P>P Performance  Collapse.  Non-linear  behavior  found  in  non-  congestion controlled fabrics, whereby reduced aggregate throughput is exhibited with increased load. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1605.jpg"/>
</Figure>

<P>S Saturation Tree. A pattern of congestion identified within the fabric which grows backward from the root buffer overflow towards the sources of all transaction request flows passing through this buffer. </P>

<P> </P>

<P>Short Term Congestion. A congestion event lasting up into the dozens or hundreds of microseconds, handled in RapidIO by Logical Layer Flow Control. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1606.jpg"/>
</Figure>

<P>T Topology. The structure represented by the physical interconnections of a switch fabric. </P>

<P> </P>

<P>Transaction Request Flow. A series of packets that have a common source identifier and a common destination identifier at some given priority. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1607.jpg"/>
</Figure>

<P>U Ultra Short Term Congestion. A congestion event lasting from dozens to hundreds of nanoseconds, handled in RapidIO by Link Level Flow Control. </P>

<P> </P>

<P>Underflow. A condition within output buffers of switches in which the buffer runs dry. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1608.jpg"/>
</Figure>

<P>W Watermark. A  predetermined  buffer  occupancy  level  indicating  either congestion (high watermark) or abatement of congestion (low watermark). </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1609.jpg"/>
</Figure>

<P>X XOFF (Transmit Off). A congestion control packet sent from the point of congestion back to the source of a particular flow, telling the source endpoint to shut off the flow. </P>

<P> </P>

<P>XON (Transmit On). A congestion control packet sent from the point of congestion back to the source of a particular flow, telling the source endpoint to restart a controlled flow. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1610.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 10: Data Streaming Logical Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1611.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>First release </P>
</TD>

<TD>
<P>06/09/2004 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3.a </P>
</TD>

<TD>
<P>No technical changes </P>

<P>Converted to ISO-friendly templates </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3.a </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: errata showing 06-04-00002.004; new features showing 06-01- </P>

<P>00000.002 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Technical changes: errata showing 07-07-00000.004 </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Technical changes: errata showing 10-08-00000.003, 10-08-00001.005, Consolidated Comments on 11-01-00000.000 </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction............................................................................................................. 9 </P>

<P>1.2 Overview................................................................................................................. 9 </P>

<P>1.3 Features of the Data Streaming Specification....................................................... 10 </P>

<P>1.3.1 Functional Features........................................................................................... 10 </P>

<P>1.3.2 Physical Features .............................................................................................. 10 </P>

<P>1.3.3 Performance Features ....................................................................................... 11 </P>

<P>1.4 Contents ................................................................................................................ 11 </P>

<P>1.5 Terminology.......................................................................................................... 12 </P>

<P>1.6 Conventions .......................................................................................................... 13 </P>

<P>1.7 Useful References ................................................................................................. 13 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Data Streaming Systems </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 15 </P>

<P>2.2 System Example ................................................................................................... 15 </P>

<P>2.3 Traffic Streams ..................................................................................................... 16 </P>

<P>2.4 Operation Ordering ............................................................................................... 17 </P>

<P>2.5 Class of Service and Virtual Queues .................................................................... 19 </P>

<P>2.6 End-to-end Traffic Management .......................................................................... 20 </P>

<P>2.7 Deadlock Considerations ...................................................................................... 21 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Operation Descriptions </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 23 </P>

<P>3.2 Data Streaming Protocol ....................................................................................... 23 </P>

<P>3.2.1 Data Streaming Operation ................................................................................ 23 </P>

<P>3.2.2 Virtual Streams ................................................................................................. 24 </P>

<P>3.2.3 PDU Sequences Within Streams....................................................................... 25 </P>

<P>3.2.4 Segments within a PDU .................................................................................... 25 </P>

<P>3.2.5 Rules for Segmentation and Reassembly.......................................................... 28 </P>

<P>3.3 Class of Service and Traffic Streams.................................................................... 29 </P>

<P>3.4 Traffic Management ............................................................................................. 30 </P>

<P>3.4.1 Traffic Management Operand........................................................................... 31 </P>

<P>3.4.2 On/Off Traffic Management ............................................................................. 31 </P>

<P>3.4.3 Rate Base Traffic Management ........................................................................ 31 </P>

<P>3.4.4 Credit Based Traffic Management.................................................................... 32 </P>

<P>3.4.5 Rules for Traffic Management.......................................................................... 35 </P>

<P> </P>

<P> </P>

<P>Chapter 4 Packet Format Descriptions </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 37 </P>

<P>4.2 Type 9 Packet Format (Data-Streaming Class) .................................................... 37 </P>

<P>4.3 Type 9 Extended Packet Format ........................................................................... 40 </P>

<P>4.3.1 TM Operand...................................................................................................... 42 </P>

<P>4.3.2 Basic Traffic Management................................................................................ 42 </P>

<P>4.3.3 Rate Based Traffic Management ...................................................................... 43 </P>

<P>4.3.4 Credit Based Traffic Management.................................................................... 44 </P>

<P> </P>

<P> </P>

<P>Chapter 5 Data Streaming Registers </P>

<P> </P>

<P>5.1 Introduction........................................................................................................... 45 </P>

<P>5.2 Register Summary................................................................................................. 45 </P>

<P>5.3 Reserved Register, Bit and Bit Field Value Behavior .......................................... 46 </P>

<P>5.4 Additions to Existing Registers ............................................................................ 48 </P>

<P>5.5 Capability Registers (CARs) ................................................................................ 50 </P>

<P>5.5.1 Source Operations CAR (Configuration Space Offset 0x18) ........................... 50 </P>

<P>5.5.2 Destination Operations CAR (Configuration Space Offset 0x1C) ................... 51 </P>

<P>5.5.3 Data Streaming Information CAR (Configuration Space Offset 0x3C)........... 52 </P>

<P>5.6 Command and Status Registers (CSRs)................................................................ 53 </P>

<P>5.6.1 Data Streaming Logical Layer Control CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x48)................................................................53 </P>

<P> </P>

<P> </P>

<P>Annex A  VSID Usage Examples </P>

<P> </P>

<P>A.1 Introduction........................................................................................................... 55 </P>

<P>A.2 Background ........................................................................................................... 55 </P>

<P>A.3 Packet Classification ............................................................................................. 55 </P>

<P>A.3.1 Sub-port Addressing at the Destination ............................................................ 56 </P>

<P>A.3.1.1 DSLAM application...................................................................................... 56 </P>

<P>A.3.1.2 VOIP application .......................................................................................... 56 </P>

<P>A.3.2 Virtual Output Queueing - Fabric On-ramp ..................................................... 56 </P>

<P>A.4 System Requirements ........................................................................................... 57 </P>

<P>A.4.1 UTOPIA to RapidIO ATM bridge.................................................................... 57 </P>

<P>A.4.2 Network processor ............................................................................................ 57 </P>

<P>A.4.3 CSIX to RapidIO interface ............................................................................... 57 </P>

<P>A.4.4 10Gb Metropolitan Area Network interface ..................................................... 58 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>1-1 End to End Communication Circuit................................................................................10 </P>

<P>2-1 Example of a RapidIO-Based Networking System ........................................................15 </P>

<P>2-2 Mapping Virtual Streams at the System Ingress.............................................................19 </P>

<P>2-3 Mapping Virtual Streams at the System Egress..............................................................20 </P>

<P>2-4 Class Based and Stream Base Traffic Management .......................................................21 </P>

<P>3-1 Data Streaming Operation ..............................................................................................24 </P>

<P>3-2 Virtual Streams ...............................................................................................................24 </P>

<P>3-3 PDU Segmentation and Reassembly Example 1 ............................................................27 </P>

<P>3-4 PDU Segmentation and Reassembly Example 2 ............................................................28 </P>

<P>3-5 Traffic Sorting Based on CoS ID....................................................................................30 </P>

<P>3-6 Typical Credit Based Flow Control Example .................................................................34 </P>

<P>3-7 Credit Based Protocol Example ......................................................................................35 </P>

<P>4-1 Single Segment Type 9 Packet Bit Stream Format Example .........................................38 </P>

<P>4-2 Start Segment Type 9 Packet Bit Stream Format Example ............................................39 </P>

<P>4-3 Continuation Segment Type 9 Packet Bit Stream Format Example...............................39 </P>

<P>4-4 End Segment Type 9 Packet Bit Stream Format ............................................................40 </P>

<P>4-5 Traffic Management Bit Stream Format.........................................................................40 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>4-1 Specific Field Definitions and Encodings for Type 9 Packets .......................................37 </P>

<P>4-2 Specific Field Definitions and Encodings for Type 9 Packets .......................................38 </P>

<P>4-3 Extended Header Fields ..................................................................................................41 </P>

<P>4-4 Basic Traffic Management Message Formats ................................................................42 </P>

<P>4-5 Rate Based Traffic Management Message Formats .......................................................43 </P>

<P>4-6 Credit Based Traffic Management Message Formats.....................................................44 </P>

<P>5-1 Data Streaming Register Map .........................................................................................45 </P>

<P>5-2 Configuration Space Reserved Access Behavior............................................................46 </P>

<P>5-3 Bit Settings for Logical/Transport Layer Error Detect CSR ..........................................48 </P>

<P>5-4 Bit Settings for Logical/Transport Layer Error Enable CSR..........................................48 </P>

<P>5-5 Bit Settings for Source Operations CAR ........................................................................50 </P>

<P>5-6 Bit Settings for Destination Operations CAR .................................................................51 </P>

<P>5-7 Bit Settings for Data Streaming Information CAR.........................................................52 </P>

<P>5-8 Bit Settings for Data Streaming Logical Layer Control CSR.........................................53 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>This chapter provides an overview of the RapidIO Part 10: Data Streaming Logical Specification. The goal of the specification is to combine the need for efficiency, flexibility, and protocol independence in order to minimize the resources necessary to support a data plane interconnect fabric, and to maintain compatibility and fully inter-operate with the rest of the RapidIO specifications. Implementation of this specification is optional. </P>

<P> </P>

<P>The rationale for this optimization is based upon the assumption that platforms are expected to produce many times more revenue than the initial cost of the platform. For example, a platform is expected to produce 10 times the revenue vs. its initial capital costs. If that same platform could cost 10% more but allow 10% more resources for producing revenue rather than doing fabric support, the result would be a significant net gain on the investment. Therefore, enabling more intelligence within the system fabric and relieving the system processing resources to produce revenue, even if that fabric is more expensive, is believed to be a good trade-off. </P>

<P> </P>

<P>The features of the data streaming specification define virtual mechanisms in simple forms for building cost sensitive systems and also provides for complex high functioning fabrics for more demanding applications. </P>

<P> </P>

<P>It is assumed that the reader has a thorough understanding of the other RapidIO </P>

<P>specifications and of data plane equipment and applications in general. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>Standard encapsulation schemes have been developed for the transmission of datagrams over most popular LANs. A number of different proposals currently exist for the encapsulation of one protocol over another protocol [RFC1226, RFC1234, RFC1701]. The data streaming logical specification defines a mechanism for transporting an arbitrary protocol over a standard RapidIO interface, and addresses interconnection between elements in an end-to-end data communications circuit. The protocol has been carefully designed to provide complete compatibility and inter-operability with existing RapidIO specifications. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1612.jpg"/>
</Figure>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 1-1. End to End Communication Circuit </P>

<P> </P>

<P>The defined encapsulation methodology provides for the multiplexing of different network-layer protocols simultaneously over the same link and provides a common solution for easy connection of a wide variety of hosts, bridges and switches. It is envisioned that a RapidIO system will be capable of carrying a wide variety of data types, supporting a diverse set of protocol regimens concurrently. </P>

<P> </P>

<P>The Data Streaming Protocol also includes a methodology for end-to-end traffic management. Loosely coupled systems with individual traffic managers admitting traffic to a fabric have to rely on statistical performance and back pressure to try and optimize use of the fabric resources. End-to-end traffic management allows traffic mangers at the ingress endpoints to work in concert with egress endpoints to coordinate traffic flows. </P>

<P> </P>

<P> </P>

<P>1.3 Features of the Data Streaming Specification </P>

<P> </P>

<P>The following are features of the RapidIO data streaming specification designed to satisfy the needs of various applications and systems: </P>

<P> </P>

<P> </P>

<P>1.3.1  Functional Features </P>

<P>&#8226; Protocol encapsulation, independent of the protocol being encapsulated. </P>

<P>&#8226; Support for Protocol Data Units (PDUs) of up to 64k bytes through </P>

<P>Segmentation and Reassembly (SAR). </P>

<P>&#8226; Support for hundreds of traffic classes. </P>

<P>&#8226; Support for thousands of data streams between end points. </P>

<P>&#8226; Support for concurrent interleaved PDUs between end points. </P>

<P>&#8226; Seamless inter-operability with other RapidIO specifications. </P>

<P> </P>

<P> </P>

<P>1.3.2  Physical Features </P>

<P>&#8226; Packet definition is independent of the choice of physical layer interconnection to other devices on the interconnect fabric. </P>

<P> </P>

<P>10 RapidIO Trade Association </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; The protocols and packet formats are independent of the physical interconnect topology. The protocols work whether the physical fabric is a point-to-point ring, a bus, a switched multi-dimensional network, a duplex serial connection, and so forth. </P>

<P>&#8226; No dependencies exist on the bandwidth or latency of the physical fabric. </P>

<P>&#8226; The protocol requires in-order packet transmission and reception; out-of-order packet delivery is not tolerated. </P>

<P>&#8226; Certain devices have bandwidth and latency requirements for proper operation. </P>

<P>The data streaming logical layer specification does not preclude an implementation from imposing these constraints within the system. </P>

<P> </P>

<P> </P>

<P>1.3.3  Performance Features </P>

<P>&#8226; Packet headers are small to minimize the control overhead and be organized for fast, efficient assembly and disassembly. </P>

<P>&#8226; Multiple transactions are allowed concurrently in the system, otherwise a majority of the potential system throughput is wasted. </P>

<P>&#8226; Multiple end point to end point concurrent data streams are supported for high fabric utilization. </P>

<P>&#8226; Optional end-to-end traffic management for advanced fabric designs. </P>

<P> </P>

<P> </P>

<P>1.4 Contents </P>

<P> </P>

<P>Following are the contents of  the RapidIO Part 10: Data Streaming Logical </P>

<P>Specification: </P>

<P> </P>

<P>&#8226; Chapter 1, &#8220;Overview,&#8221; is an overview of the data streaming logical specification. </P>

<P>&#8226; Chapter 2, &#8220;Data Streaming Systems,&#8221; introduces system issues such as transaction ordering and deadlock prevention. </P>

<P>&#8226; Chapter 3, &#8220;Operation Descriptions,&#8221; describes the set of operations and transactions supported by the RapidIO data streaming protocol. </P>

<P>&#8226; Chapter 4, &#8220;Packet Format Descriptions,&#8221; contains the packet format definitions for the data streaming specification. </P>

<P>&#8226; Chapter 5, &#8220;Data Streaming Registers,&#8221; describes the visible register set that allows an external processing element to determine the data streaming capabilities, configuration, and status of a processing element using this logical specification. Only registers or register bits specific to the data streaming logical specification are explained. Refer to the other RapidIO logical, transport, and physical specifications of interest to determine a complete list of registers and bit definitions. </P>

<P>&#8226; Annex A, &#8220;VSID Usage Examples,&#8221; contains a number of examples of how the virtual stream identifier can be used in a system. </P>

<P> </P>

<P>RapidIO Trade Association 11 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1.5 Terminology </P>

<P> </P>

<P>The data streaming logical specification introduces some new terms: </P>

<P> </P>

<P>Protocol Data Unit - (PDU) A self contained unit of data transfer comprised of data and protocol information that defines the treatment of that data. </P>

<P> </P>

<P>Virtual Stream ID - (VSID) an identifier comprised of several fields in the protocol to identify individual data streams. </P>

<P> </P>

<P>Virtual input Queue (ViQ), Virtual output Queue (VoQ) - an intermediate point in the system where one or more virtual streams may be concentrated. </P>

<P> </P>

<P>Class of service - (cos) a term used to describe different treatment (quality of service) for different data streams. Support for class of service is provided by a class of service field in the data streaming protocol. The class of service field is used in the virtual stream ID and in identifying a virtual queue. </P>

<P> </P>

<P>StreamID - a specific field in the data streaming protocol that is combined with the data streams&#8217;s transaction request flow ID and the source ID or destination ID from the underlying packet transport fabric to form the virtual stream ID. </P>

<P> </P>

<P>Segment - A portion of a PDU. </P>

<P> </P>

<P>Segmentation - a process by which a PDU is transferred as a series of smaller segments. </P>

<P> </P>

<P>Segmentation context - Information that allows a receiver to associate a particular packet with the correct PDU. </P>

<P> </P>

<P>Ingress - Ingress is the device or node where traffic enters the system. The ingress node also becomes the source for traffic into the RapidIO fabric. The terms ingress and source may or may not be used interchangeably when considering a single end to end connection. </P>

<P> </P>

<P>Egress - Egress is the device or node where traffic exits the system. The egress node also becomes the destination for traffic out of the RapidIO fabric. The terms egress and destination may or may not be used interchangeably when considering a single end to end connection. </P>

<P> </P>

<P>Physical Channel ID - Identifies a physical channel using the virtual channel, critical request flow, and priority physical layer fields. The physical channel ID is used to determine how to treat a packet with respect to priority, bandwidth allocation, and transaction ordering. </P>

<P> </P>

<P>RapidIO flow - A RapidIO flow is a nexus of the source ID, destination ID and physical channel. </P>

<P> </P>

<P>Refer to the Glossary at the back of this document for additional definitions. </P>

<P> </P>

<P> </P>

<P> </P>

<P>1.6 Conventions </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P>|| Concatenation, used to indicate that two fields are physically associated as consecutive bits </P>

<P>ACTIVE_HIGHNames of active high signals are shown in uppercase text with no overbar. Active-high signals are asserted when high and not asserted when low. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1613.jpg"/>
</Figure>

<P>ACTIVE_LOWNames of active low signals are shown in uppercase text with an overbar. Active low signals are asserted when low and not asserted when high. </P>

<P>italics Book titles in text are set in italics. </P>

<P> </P>

<P>REG[FIELD]  Abbreviations or acronyms for registers are shown in uppercase text. </P>

<P>Specific bits, fields, or ranges appear in brackets. TRANSACTIONTransaction types are expressed in all caps. </P>

<P>operation Device operation types are expressed in plain text. n A decimal value. </P>

<P>[n-m] Used to express a numerical range from n to m. </P>

<P> </P>

<P>0bnn A binary value, the number of bits is determined by the number of digits. </P>

<P> </P>

<P>0xnn A hexadecimal value, the number of bits is determined by the number of digits or from the surrounding context; for example, 0xnn may be a 5, 6, 7, or 8 bit value. </P>

<P>x This value is a don&#8217;t care. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>1.7 Useful References </P>

<P>[RFC791] Postel, J., &quot;Internet Protocol&quot;, STD 5, RFC791, September 1981 [RFC1226]  Kantor,  B.  &quot;Internet  Protocol  Encapsulation  of AX.25  Frames&quot;, </P>

<P>RFC1226, University of California, San Diego, May 1991. </P>

<P> </P>

<P>[RFC1234] Provan, D. &quot;Tunneling IPX Traffic through IP Networks&quot;, RFC 1234, Novell, Inc., June 1991. </P>

<P> </P>

<P>[RFC1700] J. Reynolds and J. Postel, &quot;Assigned Numbers&quot;, RFC1700, October </P>

<P>1994. </P>

<P> </P>

<P>[RFC2460] S. Deering, R. Hinden, &quot;Internet Protocol, Version 6 (IPv6)&quot;, RFC2460, December 1998. </P>

<P> </P>

<P>[RFC1884]  Hinden,  R.,  and  S.  Deering,  Editors,  &quot;IP  Version  6 Addressing </P>

<P>Architecture&quot;, RFC1884, Ipsilon Networks, Xerox PARC, December 1995. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>[RFC2004] C. Perkins, &quot;Minimal Encapsulation within IP&quot;, RFC2004, October </P>

<P>1996. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Data Streaming Systems </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This overview introduces the role of the data streaming logical layer in an overall system. It provides some possible use examples. See Annex A, &#8220;VSID Usage Examples&#8221;, for more example details. </P>

<P> </P>

<P> </P>

<P>2.2 System Example </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1614.jpg"/>
</Figure>

<P>Figure 2-1 shows a block diagram of an example RapidIO-based networking system in which protocol encapsulation is required. A number of typical data path type devices are connected with a variety of proprietary and/or somewhat standard interfaces and the entire system is tied together with a RapidIO switching fabric of some topology. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1615.jpg"/>
</Figure>

<P>R </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1616.jpg"/>
</Figure>

<P>MAC Traffic a </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1617.jpg"/>
</Figure>

<P>XAUI xMII </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1618.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>xMII </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1619.jpg"/>
</Figure>

<P>Framer Comm </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1620.jpg"/>
</Figure>

<P>Manager p i d </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Framer </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Network </P>

<P>Processor </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>

<P> </P>

<P>Fabric </P>

<P>Interface </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>SFIx </P>
</TD>

<TD/>

<TD>
<P>SPIx </P>
</TD>

<TD/>

<TD>
<P> </P>

<P>CSIX, NPSI </P>
</TD>

<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>I O </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1621.jpg"/>
</Figure>

<P>I n t e r c o n n </P>

<P>Comm e </P>

<P>Processor c </P>

<P>t </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1622.jpg"/>
</Figure>

<P>F a b </P>

<P>Traffic r </P>

<P>SFIx SPIx </P>

<P>Processor </P>

<P>Utopia, xMII, RapidIO, Proprietary </P>

<P>Manager i </P>

<P>c </P>

<P> </P>

<P>Figure 2-1. Example of a RapidIO-Based Networking System </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Data &#8220;streams&#8221; represent logical connections between an ingress port and an egress port. A connection spans the transfer of multiple PDUs. The transfer of PDUs may be separated by discrete intervals of time, based on the arrival of data at the ingress. Transfer between an ingress process and an egress process is unidirectional. An I/O device may be bi-directional, containing both an ingress process and an egress process. These processes are usually completely independent consisting of separate streams in each direction. </P>

<P> </P>

<P>A given ingress may service hundreds, thousands, even millions of streams at any given time depending on how specifically a PDU is classified. Traffic may be lumped into a single stream, or classified by user and application to form millions of data streams. </P>

<P> </P>

<P>Data streaming transactions differ from most other RapidIO transactions in two ways: they must accommodate larger variably sized data transfers, and the transactions are not acknowledged with a response packet. The data streaming logical layer is intended to support data from a variety of hardware and processing devices. These devices have a variety of different interfaces, protocols, and degrees of sophistication. This specification is intended to enable these kinds of devices to exist on the RapidIO interconnect. </P>

<P> </P>

<P> </P>

<P>2.3 Traffic Streams </P>

<P> </P>

<P>A stream identifier identifies independent streams of traffic between the end producer (for example, a web server) and end consumer (for example, a home personal computer) of the encapsulated data. Stream identifiers vary with protocol and may include multiple fields from the various networking layers included in the protocol. A unit of data that contains a discrete identifier is called a Protocol Data Unit, or PDU. A PDU may or may not have an ordering relationship with another PDU being transmitted between that same producer and consumer, depending upon the higher layer protocol being carried. A traffic stream is a series of PDUs that have an ordering relationship between each other. A PDU has no ordering relationship with a PDU from different producers and consumers pairs. </P>

<P> </P>

<P>The data streaming logical layer uses a virtual stream identifier (VSID) to allow multiple end to end traffic streams of PDUs to be uniquely identified and managed concurrently within the RapidIO system. Creation of a VSID is done by performing a protocol specific classification process on a PDU. The complexity of the classification process is directly proportional to the sophistication of the system as required by the application. The VSID allows the traffic to be reassociated with an appropriate  application  at  the  egress  without  having  to  perform  a  second protocol-specific classification. A VSID  is  comprised  of  fields  from  the  data streaming protocol: source and destination ID from the underlying packet transport fabric, class of service, and streamID. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>2.4 Operation Ordering </P>

<P> </P>

<P>A transaction request flow is defined as an ordered sequence of request transactions comprising a specific PDU from a given source ID to a given destination ID. Each packet in a transaction request flow has the same source identifier and the same destination identifier. All traffic streams are mapped onto transaction request flows. These flows may also be shared with other RapidIO logical layers transactions, and therefore the relationship between streams, traffic classes, virtual queues, and all RapidIO transaction request flows are implementation specific. </P>

<P> </P>

<P>There may be multiple transaction request flows between a given source ID and destination ID pair. When multiple flows exist between a source ID and destination ID pair, the flows are distinguished by a flow indicator referred to as a &#8220;flowID&#8221;, introduced in the RapidIO Part 1: Input/Output Logical Specification. RapidIO allows multiple transaction request flows between any source ID and destination ID pair. Any number of transaction request flows may exist between the two IDs. The flowID represents the lowest level of traffic management in a RapidIO system as that is the construct mapped directly on to the switch fabric itself. </P>

<P> </P>

<P>The transaction request flows between each source and destination ID pair may be allocated to different virtual channels in the underlying fabric and may also be prioritized within a channel. The flows are labeled and identified alphabetically as in the other logical layer specifications, and the channels labeled and identified numerically with channel then priority, starting with 0 as first channel or lowest priority, then 1 as second channel or next lowest priority, etc. For example, flowID </P>

<P>0A is channel 0 flow A, flowID 1C is channel 1 flow C, flowID 3E is channel 3 flow E, and so on. This flow information provides class of service information when mapped by the application to the switch fabric. </P>

<P> </P>

<P>Allocation of transaction request flows to virtual channels and the relative priority within each channel is application dependent. A special case is a single virtual channel application which must follow the same prioritization of flows and labeling as the other logical layers (flowID A, flowID B, flowID C, etc.). The channel label (0) is dropped. This channel may include traffic from the other logical layers. </P>

<P> </P>

<P>At the link level, when multiple transaction request flows within the same virtual channel exist between a given connected source and destination ID pair, transactions of a higher priority flow may pass transactions of a lower priority flow, but transactions of a lower priority flow may not pass transactions of a higher priority flow. There are no ordering rules for flows in different channels. A traffic stream being transmitted between a source and a destination ID pair must utilize the same flowID value so that the ordering of the traffic stream is maintained. As a class of service indicator, the physical channel ID is used by the underlying RapidIO fabric to determine how to treat a packet with respect to other packets with respect to priority and ordering. It is expected that in a mixed control and data plane application that both I/O logical and data streaming transaction request flows will exist in a RapidIO system simultaneously, possibly between the same ID pairs. </P>

<P> </P>

<P>RapidIO Trade Association 17 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>To support transaction request flows, all devices that support the RapidIO data streaming logical specification shall comply as applicable with the following Fabric Delivering Ordering and End point Completion Ordering rules. Note that these rules are very similar and complementary to the rules specified in RapidIO Part 1: Input/Output Logical Specification. </P>

<P> </P>

<P>Fabric Delivery Ordering Rules </P>

<P> </P>

<P>1. Transactions within a transaction request flow (same source identifier, same destination identifier, same flowID, same PDU) shall be delivered to the logical layer of the destination in the same order that they were issued by the logical layer of the source. </P>

<P>2. Request transactions that have the same source (same source identifier) and the same destination (same destination identifier) within the same virtual channel but with different flowIDs shall be delivered to the logical layer of the destination as follows. </P>

<P>&#8211; A transaction of a higher priority transaction request flow that was issued by the logical layer of the source before a transaction of a lower priority transaction request flow shall be delivered to the logical layer of the destination before the lower priority transaction. </P>

<P>&#8211; A transaction of a higher priority transaction request flow that was issued by the logical layer of the source after a transaction of a lower priority transaction request flow may be delivered to the logical layer of the destination before the lower priority transaction. </P>

<P>3. Request transactions that have different sources (different source identifiers) or different destinations (different destination identifiers) or different virtual channels are unordered with respect to each other. </P>

<P> </P>

<P>End point Completion Ordering Rules </P>

<P> </P>

<P>1. Request transactions in a transaction request flow shall be completed at the logical layer of the destination in the same order that the transactions were delivered to the logical layer of the destination. </P>

<P> </P>

<P>It  may  be  necessary  to  impose  additional  rules  in  order  to  provide  for inter-operability with other interface standards or programming models. However, such additional rules are beyond the scope of this specification. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>2.5 Class of Service and Virtual Queues </P>

<P> </P>

<P>Data streaming systems may support thousands, even millions of active data streams. These streams are eventually interleaved onto the single underlying packet transport fabric. The process for deciding which streams may share common resources is sometimes referred to as virtual queueing. To facilitate virtual queueing at the ingress and/or egress of the fabric, and to provide for more sophisticated management of traffic streams, the data streaming logical layer provides a class of service (cos) identifier. The cos field exists to provide a common semantic as to how the traffic stream is to be treated. The relationship between the ingress/egress cos and the end to end flowID assigned to the traffic stream is implementation specific. </P>

<P> </P>

<P>At the ingress to the fabric, thousands of streams may be combined into fewer virtual output queues (VoQs) using just the destination ID and the class of service portions of the VSID as shown in Figure 2-2. The cos field defined by this specification is comprised of one byte. The number of bits utilized by a particular device depends upon the number of data buffering structures implemented, but are always from the most significant bit of the cos field to the least significant bit. For example, a device with two buffering structures (or &#8220;bins&#8221;) maps a packet to a bin using bit 0, a device with four bins maps a packet to a bin using bits 0 and 1, and so on. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1623.jpg"/>
</Figure>

<P>VSID = dest. ID+cos+streamID </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1624.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1625.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1626.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1627.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1628.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1629.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1630.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1631.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1632.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1633.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1634.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1635.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1636.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1637.jpg"/>
</Figure>

<P>Virtual Streams VoQs      </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1638.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1639.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1640.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1641.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1642.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1643.jpg"/>
</Figure>

<Textbox>
<P>Scheduling </P>
</Textbox>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1644.jpg"/>
</Figure>

<P>Flow A </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1645.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1646.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1647.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1648.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1649.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1650.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1651.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1652.jpg"/>
</Figure>

<P>VoQ = dest. ID+cos </P>

<P>Flow = dest. ID+transport </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1653.jpg"/>
</Figure>

<P>    D=ata Stream=ing Log=ical Layer  Other Logical Layers </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1654.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1655.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1656.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1657.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1658.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1659.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1660.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1661.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1662.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1663.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1664.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1665.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1666.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1667.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1668.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1669.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1670.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1671.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1672.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1673.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1674.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1675.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1676.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1677.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1678.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1679.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1680.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1681.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1682.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1683.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1684.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1685.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1686.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1687.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1688.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1689.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1690.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1691.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1692.jpg"/>
</Figure>

<P>Flow B </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1693.jpg"/>
</Figure>

<P>  Flow C </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1694.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1695.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1696.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1697.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1698.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1699.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1700.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1701.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1702.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1703.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1704.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1705.jpg"/>
</Figure>

<P>Transport Fabric </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1706.jpg"/>
</Figure>

<P> </P>

<P>Figure 2-2. Mapping Virtual Streams at the System Ingress </P>

<P> </P>

<P>As shown in Figure 2-2, as the virtual output queues are mapped on to the flowIDs and then on to the underlying packet transport fabric, they may be intermingled with other logical layer transactions. The use of the transport fabric must account for the needs of the total environment and is application and implementation specific. End points designed to support a wide variety of applications for data streaming should offer some flexibility in how virtual queues are mapped down on to the transport fabric in the implementation. </P>

<P> </P>

<P>A reverse process (virtual input queueing) may or may not occur at the destination. If there is a critical resource needed to process traffic on egress from the fabric, the system designer may choose to fan the traffic back out into virtual queues. This allows the fabric egress processing to re-prioritize utilization of the critical resource. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>This is illustrated in Figure 2-3. </P>

<P> </P>

<P>VSID = src. ID+cos+streamID ViQ = src. ID+cos </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1707.jpg"/>
</Figure>

<P>Flow = src. ID+transport </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1708.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1709.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1710.jpg"/>
</Figure>

<P>Flow A </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1711.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1712.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1713.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1714.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1715.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1716.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1717.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1718.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1719.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1720.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1721.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1722.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1723.jpg"/>
</Figure>

<P>ViQs </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1724.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1725.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1726.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1727.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1728.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1729.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1730.jpg"/>
</Figure>

<P>Virtual Streams </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1731.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1732.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1733.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1734.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1735.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1736.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1737.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1738.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1739.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1740.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1741.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1742.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1743.jpg"/>
</Figure>

<Textbox>
<P>Scheduling </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1744.jpg"/>
</Figure>

<P>Flow B </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1745.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1746.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1747.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1748.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1749.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1750.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1751.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1752.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1753.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1754.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1755.jpg"/>
</Figure>

<P>Transport Fabric         Flow C </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1756.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1757.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1758.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1759.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1760.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1761.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1762.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1763.jpg"/>
</Figure>

<P>    Data Streaming Logical Layer   Other Logical Layers </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1764.jpg"/>
</Figure>

<P>Figure 2-3. Mapping Virtual Streams at the System Egress </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1765.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1766.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1767.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1768.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1769.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1770.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1771.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1772.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1773.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1774.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1775.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1776.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1777.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1778.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1779.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1780.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1781.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1782.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1783.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1784.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1785.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1786.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1787.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1788.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1789.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1790.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1791.jpg"/>
</Figure>

<P> </P>

<P>A switch device may choose to utilize the information carried in the cos field by acting as a &#8220;virtual&#8221; end point, removing the traffic streams from the underlying packet transport fabric, reassembling the individual PDUs, and fanning the streams back out into some larger number of queues. It then re-injects the traffic streams back into the underlying transport fabric re-ordering the traffic using the cos. This permits intervening devices to participate in the overall assurance of quality of service in the system. </P>

<P> </P>

<P> </P>

<P>2.6 End-to-end Traffic Management </P>

<P> </P>

<P>Other RapidIO specifications provide for traffic management at the physical layer, and for flows at the logical layer. The traffic management for Data Streaming allows endpoints to coordinate traffic flows between class based queues and stream based queues. The protocol includes a hierarchy of methods and field specifiers to be adaptable to a wide variety of queueing and management designs. The use of Data Streaming&#8217;s traffic management is optional, and may be inter-operable only between endpoints with similar capabilities. Endpoints that support the same traffic management capabilities will be able to exchange traffic management packets related to those capabilities. The implementation specific nature of the algorithms which determine traffic management in different endpoints may lead to unexpected system behavior. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1792.jpg"/>
</Figure>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1793.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1794.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1795.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1796.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1797.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1798.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1799.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1800.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1801.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1802.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1803.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1804.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1805.jpg"/>
</Figure>

<P>Virtual Streams VoQs </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1806.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1807.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1808.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1809.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1810.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1811.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1812.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1813.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1814.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1815.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1816.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1817.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1818.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1819.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1820.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1821.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1822.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1823.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1824.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1825.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1826.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1827.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1828.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1829.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1830.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1831.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1832.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1833.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1834.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1835.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1836.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1837.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1838.jpg"/>
</Figure>

<Textbox>
<P>Scheduling </P>
</Textbox>

<P>ViQs </P>

<P>Virtual Streams </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1839.jpg"/>
</Figure>

<P>Data Streaming Logical Layer </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1840.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1841.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1842.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1843.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1844.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1845.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1846.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1847.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1848.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1849.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1850.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1851.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1852.jpg"/>
</Figure>

<P>Class Based TM </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1853.jpg"/>
</Figure>

<P>Data Streaming Logical Layer </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1854.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1855.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1856.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1857.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1858.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1859.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1860.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1861.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1862.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1863.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1864.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1865.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1866.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1867.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1868.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1869.jpg"/>
</Figure>

<Textbox>
<P>Scheduling </P>
</Textbox>

<P>Stream Based TM </P>

<P> </P>

<P>Figure 2-4. Class Based and Stream Base Traffic Management </P>

<P> </P>

<P> </P>

<P>2.7 Deadlock Considerations </P>

<P> </P>

<P>A deadlock can occur if a dependency loop exists. A dependency loop is a situation where a loop of buffering devices is formed, in which forward progress at each device is dependent upon progress at the next device. If no device in the loop can make progress then the system is deadlocked. </P>

<P> </P>

<P>The data streaming logical specification does not have any dependency loops since the defined operations do not require responses. However, a real RapidIO system is required to support the I/O logical maintenance operation, and will very likely require the use of other logical operations for control functions. Support for these other logical operations may have significant deadlock considerations for processing element and system designs. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Operation Descriptions </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This chapter describes the RapidIO data streaming protocol. The field encodings and packet formats are described in Chapter 4, &#8220;Packet Format Descriptions.&#8221; </P>

<P> </P>

<P>Data path data movement through a machine has requirements that are significantly different than those for control path and traditional DMA functions. Many times this data is encapsulated data, which also many times contains further encapsulated data. For example, the data moving through the system may be encapsulated Ethernet packets, which may in turn be encapsulating TCP/IP packets. </P>

<P> </P>

<P>This style of data movement is typically not address-based as with DMA type I/O, and consequently follows a queue based message passing paradigm. Data path data movement also has much more complex requirements in the area of class (or quality) of service than control path communications, and generally requires managing a number of queues at the egress of the system. There is also a need to be able to identify and manage many thousands of data traffic streams that pass through a RapidIO based data path system. The data being passed through the RapidIO system may not be directly generated or consumed by the device connected to the RapidIO portion of the machine, but instead by a distant end user, such as a personal computer attached to a LAN. This necessitates the addition of a new protocol to the RapidIO logical layers, the data streaming protocol. </P>

<P> </P>

<P>The RapidIO data streaming protocol uses request transactions through the interconnect fabric as with other RapidIO operation protocols. Since many data movement protocols guarantee data delivery in an upper layer protocol, the generation of responses indicating completion are not needed. Such upper layer protocols may also allow data to be discarded if necessary, for example, under error or fabric congestion conditions. </P>

<P> </P>

<P> </P>

<P>3.2 Data Streaming Protocol </P>

<P> </P>

<P>This section describes the RapidIO data streaming protocol. </P>

<P> </P>

<P> </P>

<P>3.2.1  Data Streaming Operation </P>

<P> </P>

<P>A data stream represents a logical connection between a source and a destination pair. A stream may consist of multiple transactions and requires the allocation of </P>

<P> </P>

<P>RapidIO Trade Association 23 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>resources at both the source and the destination. This may be done in advance of any data transfer, or in response to receiving a new transaction. Since streams are virtual constructs between source and destination pairs, they may be reused for different data transfers at any time as long as the source and destination pair are both synchronized as to the stream usage. </P>

<P> </P>

<P>A data streaming operation consists of individual data streaming transactions, as shown in Figure 3-1. A series of transactions is used to send PDUs between two end points. The data streaming protocol is completely independent of the PDU&#8217;s native protocol. </P>

<P> </P>

<P>Data streaming transactions do not receive responses, so there is no notification to the sender when the transaction has completed at the destination. </P>

<P> </P>

<P>1  DATA STREAMING, data </P>

<P> </P>

<P> </P>

<P>Source Destination </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1870.jpg"/>
</Figure>

<P>Figure 3-1. Data Streaming Operation </P>

<P> </P>

<P> </P>

<P>3.2.2  Virtual Streams </P>

<P> </P>

<P>A stream is represented by a unique virtual stream indentifier, or VSID. This identifier represents the handling of all PDUs within the stream for the duration of a PDU&#8217;s transit of the RapidIO fabric. The identifier is created by performing some form of protocol specific classification of the PDU. The classification can be as complex or as simple as the application warrants. The VSID allows this protocol specific classification to take place one time at the ingress to the fabric. After that, the handling of the PDU is protocol independent. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1871.jpg"/>
</Figure>

<P>Protocol Type A </P>

<P>FABRIC </P>

<P>Destination </P>

<P> </P>

<P> </P>

<P>Classification </P>

<P> </P>

<P>Protocol Type B </P>

<P>PDU </P>

<P>VSID </P>

<P> </P>

<P> </P>

<P> </P>

<P>Demux </P>

<P> </P>

<P> </P>

<P>Classification </P>

<P>PDU </P>

<P>VSID </P>

<P> </P>

<P>Figure 3-2. Virtual Streams </P>

<P> </P>

<P>The VSID is used at the destination to &#8220;reclassify&#8221; the PDU. This sorts the data back into contexts that can now be protocol specific again. This virtual addressing model eliminates the need for the source and the destination to align the use of buffers and other resources. Therefore, the VSID can be used to carry a wide variety of information about a stream through the system, such as the protocol being encapsulated, de-multiplexing exit port IDs instructions, very fine grained buffer </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>management, etc., as required for a specific application. </P>

<P> </P>

<P>The VSID is a &#8220;key&#8221; comprised of multiple fields. These fields are the source/destination ID, cos, and streamID. &#61472;&#61472;</P>

<P>From the source&#8217;s viewpoint: destination ID+cos+streamID represents a unique stream. &#61472;&#61472;</P>

<P>From the destination&#8217;s viewpoint: source ID+cos+streamID represents a unique stream. </P>

<P> </P>

<P>By using the complete key, each source and destination pair is free to allocate the use of these fields independently. Some examples of how the VSID may be applied in a system are described in Appendix A, &#8220;VSID Usage Examples,&#8221; on page 55. </P>

<P> </P>

<P>NOTE:VSIDs </P>

<P>Destinations are permitted to define their use of Virtual Stream IDs to pre-associate certain kinds of traffic with certain end processes. Sources shall be able to label a stream with any VSID necessary to inter-operate with the largest number of possible destination implementations. </P>

<P> </P>

<P> </P>

<P>3.2.3  PDU Sequences Within Streams </P>

<P> </P>

<P>As described earlier, a traffic stream may consist of a sequence of related PDUs that have ordering requirements between each other. A stream of PDUs is transmitted one PDU at a time to preserve the required ordering. PDUs that do not have an ordering relationship may be separated into different streams or may be interleaved in  common streams. A stream is  identified by  the  interconnect fabric by  the combination of the destination ID and either the cos field or the flowID, depending upon the complexity of the fabric, as described in &#8220;Section 2.5, Class of Service and Virtual Queues&#8221; on page 19. </P>

<P> </P>

<P>Only one PDU from any given stream will be transmitted at a time at the source, but fabric conditions may result in multiple PDUs in transit. The fabric must guarantee that delivery of PDUs (and segments of PDUs as described below) remain in order. A fabric may load balance traffic through multiple paths on a stream by stream basis. </P>

<P> </P>

<P> </P>

<P>3.2.4  Segments within a PDU </P>

<P> </P>

<P>The basic mechanism of segmentation defines a general methodology to provide for larger PDUs than are accommodated by the standard 256 byte limit on a RapidIO data payload. The standard industry term for this function is &#8220;Segmentation and Reassembly&#8221;, or SAR. A PDU that is to be transmitted from the initial producer to the final consumer is broken up (segmented) into a series of blocks of data. The consumer &#8220;reassembles&#8221; that data back into the original PDU. The maximum size of a PDU that a particular destination can accept is specified in a CAR (see Chapter 5, &#8220;Data Streaming Registers&#8221;). The system must be configured in accordance with </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>these limitations. </P>

<P> </P>

<P>The block size used for the segmentation process is specified by the Maximum Transmission Unit, or MTU, parameter. The MTU is defined in Chapter 5, &#8220;Data Streaming Registers&#8221;. The MTU is a system-wide parameter agreed to by all processing elements participating in the SAR process. By managing the MTU size for the system, the variability in latency for the system can be controlled. </P>

<P> </P>

<P>A data streaming transaction is also referred to as a segment. The transmission of a PDU for any given stream may result in one or more transactions (segments). A typical sequence is made up of three types of transactions, a start segment, some number of continuation segments, and an end segment. Start segments and continuation segments are always filled to the MTU size. End segments are variable in size containing the remainder of the PDU. If a PDU is equal to or less than the MTU size, it is carried in a single segment. A single segment may also be variable in size, matching the PDU payload. Since flowIDs and the cos are assigned on a PDU basis, all segments of a PDU must also have that same flowID and cos assignments. </P>

<P> </P>

<P>A start segment contains the necessary fields to identify the VSID and &#8220;open&#8221; a segmentation context. The segmentation context for a stream is defined as the combination of the source ID and the flowID, and is used by a receiver to reassociate the segments of a particular PDU. Using source ID+physical channel ID allows each source and destination pair to have one PDU for each physical channel ID that is explicitly supported by the system interleaved in the fabric at any one point in time. Note that for a destination device that can be a multicast target and/or supports multiple destination device IDs, the destination ID for a PDU must also be included as part of the segmentation context in order to prevent possible PDU corruption at the destination device. The VSID is used when opening a segmentation process at the destination to associate the PDU with its stream since the continuation and end segments do not carry that information. After the receipt of the end segment, the segmentation context is &#8220;closed&#8221; (the sending processing element has an analogous definition for open and closed). The stream and PDU associated with a segmentation context is not permitted to change during the time that the context is open. </P>

<P> </P>

<P>Since there may be a large number of PDU sources and concurrent contexts per source, the amount of context state that a destination may have to handle can potentially get very large. The number of contexts that can be supported by a particular destination end  point  is  specified in  a  CAR  (see  Chapter 5,  &#8220;Data Streaming Registers&#8221;). These segmentation contexts must be allocated to sources by system software. </P>

<P> </P>

<P>For efficiency, information as to which block of the PDU is contained in a specific packet is not included in the header. This requires that the transmitter issue the sequence starting with the first block of the PDU and proceeding sequentially through the PDU, and requires the underlying transport fabric to deliver the sequence to the data streaming logical layer in the issued order. </P>

<P> </P>

<P>26 RapidIO Trade Association </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Figure 3-3 shows a 24 byte PDU that is to be segmented for transmission, with an eight byte MTU (note that an eight byte MTU is not permitted in this specification; it is used to simplify the illustration). Since the PDU is divisible by the size specified as the MTU, all data payloads are exactly that size and no padding is necessary. The sender takes byte 0 (the first byte of the PDU) through byte 7 as the data payload to transmit in the start segment. The second data payload consists of bytes 8 through </P>

<P>15, which is transmitted in a continuation segment. The last data payload consists of bytes 16 through 23, which is transmitted in the end segment. Since the data payloads are required to be delivered to the receiver&#8217;s data management hardware in order of transmission, the receiver can correctly reassemble the original PDU when all three packets have arrived. </P>

<P> </P>

<P>To guarantee the packet ordering, all packets making up an individual PDU and all PDUs in a stream must be in the same transaction request flow, as described in &#8220;Section 2.4, Operation Ordering&#8221; on page 17. </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1872.jpg"/>
</Figure>

<P>First Byte of PDU </P>

<P> </P>

<P>byte 0 byte 1 byte 2 byte 3 byte 4 byte 5 byte 6 byte 7 </P>

<P>Bytes for the start segment data payload </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>byte 8 </P>
</TD>

<TD>
<P>byte 9 </P>
</TD>

<TD>
<P>byte 10 </P>
</TD>

<TD>
<P>byte 11 </P>
</TD>

<TD>
<P>byte 12 </P>
</TD>

<TD>
<P>byte 13 </P>
</TD>

<TD>
<P>byte 14 </P>
</TD>

<TD>
<P>byte 15 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Bytes 8 through 15 are the continuation segment data payload </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1873.jpg"/>
</Figure>

<P>Bytes 16 through 23 are the end segment </P>

<P>byte 16 </P>

<P>byte 17 </P>

<P>byte 18 </P>

<P>byte 19 </P>

<P>byte 20 </P>

<P>byte 21 </P>

<P>byte 22    byte 23 </P>

<P>data payload </P>

<P> </P>

<P>Last Byte of PDU </P>

<P> </P>

<P>Figure 3-3. PDU Segmentation and Reassembly Example 1 </P>

<P> </P>

<P>Figure 3-4 shows an example of a similar situation, except that this time the PDU is </P>

<P>21 bytes. In this case, the end segment has a data payload that is less than the specified MTU, and also has a pad byte to round out the data payload to be a multiple of half-words. A bit in the end segment (the &#8220;P&#8221; bit) indicates the presence of the pad byte. An additional bit (the &#8220;O&#8221; bit) indicates that the data payload has an odd number of half-words and is therefore oddly aligned. The number of half-words in the data payload as well as the presence of a pad byte can be determined from a PDU length field contained in the end segment header. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1874.jpg"/>
</Figure>

<P>First Byte of PDU </P>

<P> </P>

<P> </P>

<P>byte 0 byte 1 byte 2 byte 3 byte 4 byte 5 byte 6 byte 7 </P>

<P>Bytes for the start segment data payload </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>byte 8 </P>
</TD>

<TD>
<P>byte 9 </P>
</TD>

<TD>
<P>byte 10 </P>
</TD>

<TD>
<P>byte 11 </P>
</TD>

<TD>
<P>byte 12 </P>
</TD>

<TD>
<P>byte 13 </P>
</TD>

<TD>
<P>byte 14 </P>
</TD>

<TD>
<P>byte 15 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Bytes 8 through 15 are the continuation segment data payload </P>

<P> </P>

<P> </P>

<P> </P>

<P>byte 16 </P>

<P> </P>

<P>byte 17 </P>

<P> </P>

<P>byte 18 </P>

<P> </P>

<P>byte 19 </P>

<P> </P>

<P>byte 20 </P>

<P> </P>

<P>pad </P>

<P>Bytes 16 through 20 plus the pad byte is the end segment data </P>

<P>Last Byte of PDU </P>

<P>payload </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1875.jpg"/>
</Figure>

<P>Figure 3-4. PDU Segmentation and Reassembly Example 2 </P>

<P> </P>

<P>3.2.5  Rules for Segmentation and Reassembly </P>

<P> </P>

<P>Segmentation (source) </P>

<P> </P>

<P>1. In order to limit implementation complexity due to possible PDU ordering issues, the following conditions must be met: </P>

<P>&#8211; No more than one PDU from a given stream shall be segmented at a time </P>

<P>&#8211; No more than one PDU from a given RapidIO flow shall be segmented at a time </P>

<P>&#8211; PDUs associated with different RapidIO flows may be segmented concurrently </P>

<P>2. Segments are filled with bytes from the PDU in order as shown in Figure 3-3 and Figure 3-4. </P>

<P>3. The first segment is marked as start segment (see section 4). </P>

<P>4. The start segment is filled to the end of the PDU data or to the MTU size. </P>

<P>5. If the end of the PDU data is encountered, the start segment then re-marked as a single segment. </P>

<P>6. If the start segment reaches MTU size (and there is remaining PDU data), the start segment is encapsulated, and a continuation segment is opened. </P>

<P>7. Continuation segments are filled to MTU size from the PDU data, in order. </P>

<P>8. When the end of PDU data is encountered, the segment is marked as the end segment. The end segment data payload size may be less than or equal to the MTU size. </P>

<P>9. If the source wishes to abort a PDU transmission, it sends an end segment with no data payload and with the length field set to zero. </P>

<P> </P>

<P>Reassembly (destination) </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>1. Upon receiving a segment with a start bit, the reassembly unit opens a &#8220;context&#8221; containing the virtual stream ID and associates it with the segmentation context consisting of the source ID, the destination ID, and the physical channel ID. (The destination ID is only required for devices supporting multicast and/or multiple destination IDs.) </P>

<P>2. The reassembly process transfers the entire payload into the reassembly buffer in order. The amount of data transferred is counted for comparison to the length field. </P>

<P>3. If the packet is a single segment, the amount of payload data must be equal to or less than the MTU size or the PDU is defective. </P>

<P>4. If the packet is a start segment and the payload data does not match the MTU </P>

<P>size the PDU is defective. </P>

<P>5. Reassembly continues with continuation packets. All continuation packets must match the MTU size or the PDU is defective. All data transferred to the reassembly buffer is counted. </P>

<P>6. An end segment terminates the reassembly process. An end segment may be received immediately after a start segment. The data payload size must be less than or equal to the MTU size or the PDU is defective. The data from the end segment is transferred according to the data payload size and counted. </P>

<P>7. Once all the data has been reassembled, the length (provided by the end segment packet header) is checked against the received data count. A mismatch indicates a lost continuation segment and the PDU is defective. </P>

<P>8. Receiving a continuation or end segment on a closed context indicates a lost start segment and the PDU is defective. </P>

<P>9. Receiving a start or single segment on an open context indicates a lost end segment and the PDU is defective. The existing context is closed, and the new context is opened. </P>

<P> </P>

<P>In all cases, a defective PDU results in discarding the entire PDU. The method used for reporting the discard event is beyond the scope of this specification. It may be desirable for a destination to have a timeout as part of the lost packet detection mechanism, but the definition and time interval are also outside of the scope of this specification. </P>

<P> </P>

<P> </P>

<P>3.3 Class of Service and Traffic Streams </P>

<P> </P>

<P>A virtual stream ID is partitioned into three pieces as previously discussed: port (identified by the source/destination ID), class (the cos field), and the stream identifier (the streamID field). These fields form a specific hierarchy for transitioning packets from highly individualized streams to coarser groupings of traffic. At the fabric ingress, egress, and potentially at interim points (where competition for resources may occur) the traffic may be resegregated and queued by class. In the packet transport fabric, switching is done by destination ID and the </P>

<P> </P>

<P>RapidIO Trade Association 29 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>mapped flowID, as described in Section 2.4. The full class of service identifier (CoS ID) is a subset of the VSID. It consists of the source/destination ID (or ingress/egress port) plus the cos field.&#61472;&#61472;</P>

<P>Ingress queueing should be based on: destination ID+cos&#61472;&#61472;</P>

<P>Egress queueing should be based on: source ID+cos&#61472;&#61472;</P>

<P>as shown in Figure 3-5. </P>

<P> </P>

<P>Including the source or destination ID in the CoS ID allows the class of service to be specific to the source and destination pairing. </P>

<P> </P>

<P> </P>

<P>Streams </P>

<P>Ingress </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1876.jpg"/>
</Figure>

<P>Queues </P>

<P>Fabric </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1877.jpg"/>
</Figure>

<P>Port 2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1878.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1879.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1880.jpg"/>
</Figure>

<P>Egress Traffic Prioritized by Class </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1881.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1882.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1883.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1884.jpg"/>
</Figure>

<P>Port 4 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1885.jpg"/>
</Figure>

<P>Class </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1886.jpg"/>
</Figure>

<P>Egress </P>

<P>Queues </P>

<P> </P>

<P>Figure 3-5. Traffic Sorting Based on CoS ID </P>

<P> </P>

<P>The cos field shall be used beginning with the MSB (bit 0) using the necessary number of bits for the number of classes supported. </P>

<P> </P>

<P>Bit 0 - 2 Classes of Service </P>

<P> </P>

<P>Bits 0, 1 - 4 Classes of Service </P>

<P> </P>

<P>Bits 0, 1, 2 - 8 Classes of Service supported etc. </P>

<P> </P>

<P>3.4 Traffic Management </P>

<P> </P>

<P>Data Streaming Traffic Management (TM) supports end-to-end flow control through multiple mechanisms. The protocol includes On/Off, Rate based and Credit based schemes. There is also room in the protocol for user defined operations. Traffic Management uses the extended packet format for Type 9 (see Chapter 4 for packet definitions). The traffic management format makes up a message that contains: </P>

<P>&lt;VSID&gt;&lt;Wildcard+Mask&gt; &lt;Message XType&gt;&lt;Parameter 1&gt;&lt;Parameter 2&gt; The VSID (from the standard type 9 header) plus the wildcard and mask fields in the </P>

<P>extended packet header forms the operand (the queue or queues) for the traffic </P>

<P>management message. The message type and type specific parameters form the operation. </P>

<P> </P>

<P>30 RapidIO Trade Association </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>3.4.1  Traffic Management Operand </P>

<P> </P>

<P>All Data Streaming traffic management protocols use a common mechanism for queue designation. The message overloads the data streaming VSID fields to define the stream to which to apply the message. In addition, the extended header format includes modifiers, in the form of a wild card and a mask to expand the scope of the message beyond a single stream. The message can apply to: </P>

<P>&#8226; A single stream, identified by &lt;Dest&gt;&lt;cos&gt;&lt;streamID&gt; </P>

<P>&#8226; A group of streams in a class identified by &lt;Dest&gt;&lt;cos&gt; </P>

<P>&#8226; A group of classes, identified by &lt;Dest&gt;&lt;cos&gt;&lt;mask&gt; </P>

<P>&#8226; All classes for a given port, identified by &lt;Dest&gt; </P>

<P> </P>

<P>Note that the operand is always based on a VSID that is the target (intended destination) of the data. The egress is not responsible for knowing the mapping of queues taking place at the ingress. </P>

<P> </P>

<P>Example: Endpoint 21 sends &lt;cos 3&gt; XOFF to endpoint 6&#61472;&#61472;</P>

<P>Endpoint 6 would stop all streams to VSID: DestID 21, class 3. </P>

<P> </P>

<P> </P>

<P>3.4.2  On/Off Traffic Management </P>

<P>The messages supported are: Egress to Ingress:&#61472;&#61472;</P>

<P>&lt;Q&gt; XOFF                                    (where &lt;Q&gt; is any operand described in 3.4.1)&#61472;&#61472;</P>

<P>&lt;Q&gt; XON </P>

<P> </P>

<P>Ingress to Egress:&#61472;&#61472;</P>

<P>&lt;Q&gt; Q_STATUS &lt;Level&gt;    (see Section 4.3.2 for message and parameter formats) </P>

<P> </P>

<P>Basic On/Off traffic management consists of egress to ingress messages that direct the operand &lt;Q&gt; be stopped (XOFF) or started (XON). The ingress may signal the need for service with the Q_STATUS message, with level indicating the relative fullness of the queue. </P>

<P> </P>

<P>Ingress devices may admit traffic based on any ingress specific scheduling algorithm. This message does not modify the algorithm except to suspend/resume traffic flow. </P>

<P> </P>

<P>When traffic management is enabled and set to TM Type 0 (basic), the messages shall be supported by the egress and honored by the ingress according to the rules in Section 3.2.5. </P>

<P> </P>

<P> </P>

<P>3.4.3  Rate Base Traffic Management </P>

<P>The messages supported are: From Egress to Ingress&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 31 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; XON (where &lt;Q&gt; is any operand described in Section 3.4.1)&#61472;&#61472;</P>

<P>&lt;Q&gt; XOFF&#61472;&#61472;</P>

<P>&lt;Q&gt; INCREASE &lt;Amount&gt;&#61472;&#61472;</P>

<P>&lt;Q&gt; DECREASE &lt;Amount&gt; </P>

<P> </P>

<P>From Ingress to Egress&#61472;&#61472;</P>

<P>&lt;Q&gt; Q_STATUS &lt;Level&gt;    (see Section 4.3.3 for message and parameter formats) XON and XOFF messages are as defined in Section 3.4.2. </P>

<P>Rate based flow control is a relative control protocol. &lt;Amount&gt; is a ratio relative to the current rate of traffic flow (see Chapter 4 for field definitions). The ingress is pre-configured with a specific traffic scheduling algorithm. The egress uses the INCREASE / DECREASE mechanism to modify the ingress&#8217; scheduling process, usually based on the egress&#8217; ability to move the traffic to its next destination. </P>

<P> </P>

<P>DECREASE&lt;0&gt; is  a  special message meaning MAINTAIN current rate,  and </P>

<P>INCREASE&lt;max&gt; is a special message to DOUBLE the current rate. </P>

<P> </P>

<P>The ingress may use the Q_STATUS message to indicate the status of its queues, with level indicating the relative fullness of the queue, allowing a closed loop decision process. For example, if the ingress sends successive messages indicating rising queue levels, the egress may choose to increase the rate at which the ingress has permission to admit traffic from that queue. </P>

<P> </P>

<P>When the traffic management mode is set to TM Type 1 (rate), the XON, XOFF messages are included to carry forward the basic operation (the type 0 messages no longer need to be used). </P>

<P> </P>

<P> </P>

<P>3.4.4  Credit Based Traffic Management </P>

<P> </P>

<P>Credit based traffic management permits the egress to control traffic on a PDU by PDU basis. In this mode PDUs are only transmitted when an ingress is given an allocation of credits for a specific queue (identified by the operand &lt;Q&gt;). Traffic flow stops when the allocation of credits reaches zero. </P>

<P> </P>

<P>The basic message formats are: Egress to Ingress: </P>

<P>&lt;Q&gt; XON (where &lt;Q&gt; is any operand described in Section 3.4.1)&#61472;&#61472;</P>

<P>&lt;Q&gt; XOFF&#61472;&#61472;</P>

<P>&lt;Q&gt; ALLOCATE &lt;AU&gt; &lt;Credits&gt; </P>

<P> </P>

<P>Ingress to Egress:&#61472;&#61472;</P>

<P>&lt;Q&gt; CREDIT STATUS &lt;AU&gt; &lt;Credits&gt;&#61472;&#61472;</P>

<P>&lt;Q&gt; Q_STATUS &lt;Level&gt;    (see Section 4.3.4 for message and parameter formats) </P>

<P> </P>

<P>Allocate is used by an egress endpoint to tell an ingress endpoint that it has &lt;some number of&gt; credits available for use. The credits are assigned to an allocation unit </P>

<P> </P>

<P>32 RapidIO Trade Association </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>&lt;AU&gt;. The allocation unit allows blocks of resources to be grouped, permitting coarser management, and requiring less precision in the synchronization between an ingress and the egress. </P>

<P> </P>

<P>When the credits in an allocation unit are consumed, the ingress begins to use credits in the next allocation unit. The egress assigns credits in allocation units on a rotating basis. Allocation units have local scope. The allocation unit value has local scope to the &lt;Q&gt; designation. </P>

<P> </P>

<P>The protocol allows or pipelining up to 16 allocation units. Endpoints do not have to use 16 allocation units. The number used is a function of how far in advance credits need to be issued. The minimum implementation is 2 to ping-pong buffer groups and keep some credit available at the ingress. The egress may issue any number of allocation units (starting with 0) and rolling over at whatever limit it supports. It is up to the egress to be sure an AU is unused before reusing that number. </P>

<P> </P>

<P>&lt;Q&gt; ALLOCATE &lt;AU&gt; &lt;0&gt; is used to retire an allocation. It may be used by an egress endpoint to free a block of buffering for a number of reasons. It can be used to pause a transmission by forcing the only credits to zero. It can be used to clean up memory allocation by forcing an ingress onto the next allocation unit. </P>

<P> </P>

<P>Credit Status: is sent by the ingress to delimit the use of allocation units, and to indicate status to trigger new allocations. &lt;Q&gt; CREDIT STATUS &lt;AU&gt; &lt;nn&gt;, where nn is the number of initial credits for an AU, is sent ahead of the first packet to delimit the beginning of the use of that AU. </P>

<P> </P>

<P>&lt;Q&gt; CREDIT STATUS &lt;AU&gt; &lt;00&gt; is always sent after the last packet resulting in the number of credits going to 0 for that AU. The egress can close out that chunk of buffering, even if its notion of the number of PDUs received does not agree with the ingress (a PDU has been lost somewhere). &lt;Q&gt; CREDIT STATUS &lt;AU&gt; &lt;00&gt; is also sent in response to an &lt;Q&gt; ALLOCATE &lt;AU&gt; &lt;00&gt; acknowledging that the ingress will send no more PDUs for that allocation, delimiting any PDUs in the pipeline. </P>

<P> </P>

<P>&lt;Q&gt; CREDIT STATUS &lt;AU&gt; &lt;xx&gt;, where xx is some number of remaining credits, may be sent by an ingress to indicate a low level of credit allocation as a trigger to request more credits. The egress may also track the number of incoming PDUs from an ingress keeping a local credit balance. Either or both mechanisms can be used to sequence allocations. Note that the egress is not required to keep a specific credit balance, it can allocate and retire allocation units using the delimiting messages. </P>

<P> </P>

<P>Queue Status: provides a means to indicate the overall status of a specific queue. The source can use this message to get attention for a queue that has become active, needing credits (transitioning from empty). It can be used to indicate a queue that has gone empty, allowing the destination to deallocate the remaining credits and retire the AU. It can also be used to indicate that the current rate of credits being issued is not keeping up with incoming traffic. </P>

<P> </P>

<P>RapidIO Trade Association 33 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>XOFF and XON are used to pause / resume transmission without changing the state of credit allocation. </P>

<P> </P>

<P>In the example shown in Figure 3-6, the ingress initiates activity with queue status, indicating traffic available. The egress responds with an allocation of 16 credits. </P>

<P> </P>

<P> </P>

<P>Ingress </P>

<P>Egress </P>

<P> </P>

<P>&lt;Q&gt; QS &lt;1/8&gt; </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; CS &lt;0&gt;&lt;16&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; CS &lt;0&gt;&lt;2&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; &lt;0&gt;·&lt;1&gt; </P>

<P>&lt;Q&gt; &lt;0&gt;·&lt;14&gt; </P>

<P> </P>

<P>&lt;Q&gt; ALL &lt;0&gt; &lt;16&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P>Data Packet &lt;Q&gt; </P>

<P>&lt;AU&gt;&lt;PKT#&gt;  implied </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; CS &lt;0&gt;&lt;0&gt; </P>

<P>&lt;Q&gt; CS &lt;1&gt;&lt;16&gt; </P>

<P>&lt;Q&gt; &lt;0&gt;&lt;15&gt; </P>

<P>&lt;Q&gt; &lt;0&gt;&lt;16&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; &lt;1&gt;&lt;1&gt; </P>

<P>&lt;Q&gt; &lt;1&gt;&lt;2&gt; </P>

<P>&lt;Q&gt; ALL &lt;1&gt; &lt;16&gt; </P>

<P> </P>

<P>&lt;Q&gt; = Operand </P>

<P> </P>

<P>QS = QUEUE STATUS CS = CREDIT STATUS ALL = ALLOCATE </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1887.jpg"/>
</Figure>

<P>Figure 3-6. Typical Credit Based Flow Control Example </P>

<P> </P>

<P>At a level of 2 credits remaining, the ingress sends a credit status of &lt;2&gt; indicating a low level of credits. It proceeds with sending the last two PDUs. </P>

<P> </P>

<P>The egress responds to the request for more credits with an allocation of 16 additional PDUs. The ingress indicates the last PDU has been sent on the first allocation, and that new PDUs are being sent on the new allocation with the two sequential credit status messages. This is a &#8220;typical&#8221; scenario. </P>

<P> </P>

<P>In the scenario shown in Figure 3-7, the egress moves the traffic from AU 0 to AU </P>

<P>1 by first allocating more credits with AU 1, then terminating the credits for AU 0. </P>

<P> </P>

<P>The ingress responds by sending credit status of 0 for AU 0, and credit status to indicate the beginning of AU 1. </P>

<P> </P>

<P>There are many ways to use this protocol. An ingress may use the credit status &lt;0&gt; to asynchronously relinquish credits for a stream if an activity timer indicates that there&#8217;s been no new traffic for a period of time (or the egress may do the same). </P>

<P> </P>

<P>The size of the allocations can be varied using the Queue Status message, allocating larger blocks for fuller queues. An ingress endpoint might have prescribed thresholds for sending queue status message. </P>

<P> </P>

<P>The ingress might also have adjustable thresholds for sending Credit Status messages to adjust for pipeline delays, or algorithmically move that threshold up or down based on gaps in allocation. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Ingress </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1888.jpg"/>
</Figure>

<P>&lt;Q&gt; QS &lt;1/8&gt; </P>

<P>Egress </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; CS &lt;0&gt;&lt;16&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; CS &lt;0&gt;&lt;0&gt; </P>

<P>&lt;Q&gt; CS &lt;1&gt;&lt;16&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; &lt;0·&gt;&lt;1&gt; </P>

<P>&lt;Q&gt; &lt;0·&gt;&lt;6&gt; </P>

<P>&lt;Q&gt; &lt;0&gt;&lt;7&gt; </P>

<P>&lt;Q&gt; &lt;0&gt;&lt;8&gt; </P>

<P>&lt;Q&gt; &lt;0&gt;&lt;9&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; &lt;1&gt;&lt;1&gt; </P>

<P>&lt;Q&gt; &lt;1&gt;&lt;2&gt; </P>

<P>&lt;Q&gt; ALL &lt;0&gt; &lt;16&gt; </P>

<P> </P>

<P>Data Packet &lt;Q&gt; </P>

<P>&lt;AU&gt;&lt;PKT#&gt;  implied </P>

<P> </P>

<P>&lt;Q&gt; ALL &lt;1&gt; &lt;16&gt; </P>

<P>&lt;Q&gt; ALL &lt;0&gt; &lt;0&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;Q&gt; = Operand </P>

<P>QS = QUEUE STATUS CS = CREDIT STATUS ALL = ALLOCATE </P>

<P> </P>

<P> </P>

<P>Figure 3-7. Credit Based Protocol Example </P>

<P> </P>

<P> </P>

<P>3.4.5  Rules for Traffic Management </P>

<P> </P>

<P>Supported Functionality </P>

<P> </P>

<P>1. Supporting traffic management is entirely optional. </P>

<P>2. Any endpoint advertising support for traffic management shall support the basic mode of operation. </P>

<P>3. An endpoint may or may not support rate or credit based modes of operation. </P>

<P>4. Any supported modes shall be supported fully, incorporating all defined message formats (use of user defined fields is optional). </P>

<P> </P>

<P>Therefor the valid combinations for supporting traffic management are: </P>

<P> </P>

<P>&#8226; Basic Only </P>

<P>&#8226; Basic + Rate </P>

<P>&#8226; Basic + Credit </P>

<P>&#8226; Basic + Rate + Credit </P>

<P> </P>

<P>Protocol Rules </P>

<P> </P>

<P>1.  All TM transactions use the VSID in the type 9 header, so by definition, all TM transactions occur in the same flows as the data. When wild cards are used, the don&#8217;t care fields shall be set to values that put the message in the same flow as the affected data. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>2.  Any rules used by the ingress to associate traffic with a specific VSID shall be used in reverse to associate the VSID in the message from the egress with the at least one queue. Beyond that, any internal hierarchies of queues and relationships to different messages are up to the implementation. </P>

<P>3.  Endpoints may implement &lt;Amount&gt;, or &lt;Level&gt; with less precision than described. Receiving endpoints shall support the full range of values by rounding to the desired precision. </P>

<P>4.  An ingress shall not overrule a TM directive from the egress. The ingress may discard traffic should the egress not adequately permit that traffic onto the fabric. Any discard algorithm is implementation specific. </P>

<P> </P>

<P>Error Handling </P>

<P> </P>

<P>5.  There are no requirements for timers. An ingress may &#8220;insist&#8221; by sending repeated Q_STATUS messages. </P>

<P>6.  Lost messages are recovered by sending duplicates. Endpoints shall recognize duplicates as such and not behave inappropriately. </P>

<P> </P>

<P>An XOFF to a &lt;Q&gt; already in the off state is ignored. An XON to a &lt;Q&gt; already in the on state is ignored. </P>

<P>A lost Rate DECREASE message results in the egress sending a second </P>

<P>DECREASE with a larger requested decrease amount. </P>

<P> </P>

<P>A lost Rate INCREASE message results in the ingress issuing more urgent Q_STATUS messages and an the egress issuing additional INCREASE messages. </P>

<P> </P>

<P>7.  The exception to rule 6 is the sequencing of allocation units with the CREDIT STATUS message: </P>

<P> </P>

<P>If the &lt;Q&gt; CREDIT STATUS &lt;AU&gt; &lt;0&gt; message is lost, the allocation unit will be assumed closed when the &lt;Q&gt; CREDIT STATUS &lt;AU+1&gt; &lt;N&gt; is received opening operation on the next allocation unit. </P>

<P> </P>

<P>If the &lt;Q&gt; CREDIT STATUS &lt;AU+1&gt; &lt;N&gt; message is lost, the next allocation unit is assumed to be opened when the next PDU for that stream is received. </P>

<P> </P>

<P>Also, as an exception to rule 6, ALLOCATE messages are never duplicated. If an allocation unit message is lost, the egress may recover it with a &#61472;&#61472;</P>

<P>&lt;Q&gt; ALLOCATE &lt;AU&gt;&lt;0&gt; message, insuring it is de-allocated before reusing it. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Packet Format Descriptions </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>

<P>This chapter contains the definition of the data streaming packet format. </P>

<P> </P>

<P> </P>

<P>4.2 Type 9 Packet Format (Data-Streaming Class) </P>

<P> </P>

<P>The type 9 packet format is the DATA STREAMING transaction format. Type 9 packets always have a data payload, unless terminating the PDU. Unlike other RapidIO logical specifications, the data payload length is defined as a multiple of half-words rather than double-words. A pad bit allows a sender to transmit an odd number of bytes in a packet. An odd bit indicates that the data payload has an odd number of half-words. This bit makes it possible for the destination to determine the end of a data payload if packet padding is done by the underlying transport. An extended header bit allows future expansion of the functionality of the type 9 packet format. </P>

<P> </P>

<P>Definitions and encodings of fields specific to type 9 packets are provided in </P>

<P>Table 4-1. </P>

<P>Table 4-1. Specific Field Definitions and Encodings for Type 9 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>cos </P>
</TD>

<TD>
<P>class of service - This field defines the class of service to be applied by the destination end point </P>

<P>(and possibly intervening switch processing elements) to the specified traffic stream. </P>
</TD>
</TR>

<TR>
<TD>
<P>S </P>
</TD>

<TD>
<P>Start - If set, this packet is the first segment of a new PDU that is being transmitted. The new </P>

<P>PDU is identified by the combination of the source of the packet and the flowID. </P>
</TD>
</TR>

<TR>
<TD>
<P>E </P>
</TD>

<TD>
<P>End - If set, this packet is the last segment of a PDU that is being transmitted. Both S and E set indicates that the PDU is fully contained in a single packet. </P>
</TD>
</TR>

<TR>
<TD>
<P>rsrv </P>
</TD>

<TD>
<P>Reserved - Assigned to logic 0s by the sender, ignored by the receiver </P>
</TD>
</TR>

<TR>
<TD>
<P>xh </P>
</TD>

<TD>
<P>Extended header - There is an extended header on this packet. The extended header is used for traffic management. </P>
</TD>
</TR>

<TR>
<TD>
<P>O </P>
</TD>

<TD>
<P>Odd - If set, the data payload has an odd number of half-words </P>
</TD>
</TR>

<TR>
<TD>
<P>P </P>
</TD>

<TD>
<P>Pad - If set, a pad byte was used to pad to a half-word boundary </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-1. Specific Field Definitions and Encodings for Type 9 Packets (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Field </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>streamID </P>
</TD>

<TD>
<P>traffic stream identifier - This is an end to end (producer to consumer) traffic stream identifier. </P>
</TD>
</TR>

<TR>
<TD>
<P>length </P>
</TD>

<TD>
<P>PDU length - This is the length in bytes of the segmented PDU.&#61472;&#61472;</P>

<P>0x0000 - 64kbytes&#61472;&#61472;</P>

<P>0x0001 - 1 byte&#61472;&#61472;</P>

<P>0x0002 - 2 bytes&#61472;&#61472;</P>

<P>0x0003 - 3 bytes&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xFFFF - 64kbytes - 1 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 4-1 details the O and P bit combinations. </P>

<P>Table 4-2. Specific Field Definitions and Encodings for Type 9 Packets </P>

<P> </P>

<Table>
<TR>
<TD>
<P>O bit </P>
</TD>

<TD>
<P>P bit </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Even number of half-words and no pad byte </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Even number of half-words and a pad byte </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Odd number of half-words and no pad byte </P>
</TD>
</TR>

<TR>
<TD>
<P>0b1 </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Odd number of half-words and a pad byte </P>
</TD>
</TR>
</Table>

<P> </P>

<P>There are three type 9 packet headers, determined by the value of the Start and End bits, which determine if the header is a Start/Single header, a Continuation header, or an End header. The following set of figures shows examples of type 9 packets. Field sizes are specified in bits. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1889.jpg"/>
</Figure>

<P>Figure 4-1 is an example of a Single Segment type 9 packet with all of its fields. The data payload size may or may not match the MTU size, so n and m are determined by the size of the PDU itself. In this example, the data payload is un-padded and there are an even number of half-words. The value 0b1001 in Figure 4-1 specifies that the packet format is of type 9. This is the only type 9 packet that has the xh field. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1890.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1891.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1892.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1893.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1 0 0 1 </P>
</TD>

<TD>
<P>cos </P>
</TD>

<TD>
<P>S=1 E=1 </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>xh=0 O=0 P=0 </P>
</TD>

<TD>
<P>streamID </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>1 1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 1 1 </P>
</TD>

<TD>
<P>16 </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1894.jpg"/>
</Figure>

<P>half-word 0 (byte 0 || byte 1) </P>

<P> </P>

<P>16 </P>

<P>half-word 1 (byte 2 || byte 3) </P>

<P> </P>

<P>16 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1895.jpg"/>
</Figure>

<P>&#8226;  &#8226; &#8226; </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1896.jpg"/>
</Figure>

<P>half-word n (byte m-1 || byte m) </P>

<P> </P>

<P>16 </P>

<P> </P>

<P>Figure 4-1. Single Segment Type 9 Packet Bit Stream Format Example </P>

<P> </P>

<P>Figure 4-2 is an example of a Start Segment type 9 packet with all of its fields. The data payload that matches the MTU, so n and m are determined by the MTU size. The value 0b1001 in Figure 4-2 specifies that the packet format is of type 9. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1 0 0 1 </P>
</TD>

<TD>
<P>cos </P>
</TD>

<TD>
<P>S=1 E=0 </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>rsv </P>
</TD>

<TD>
<P>streamID </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>1 1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>16 </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1897.jpg"/>
</Figure>

<P>half-word 0 (byte 0 || byte 1) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1898.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1899.jpg"/>
</Figure>

<P> </P>

<P>16 </P>

<P>half-word 1 (byte 2 || byte 3) </P>

<P> </P>

<P>16 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1900.jpg"/>
</Figure>

<P>&#8226;  &#8226; &#8226; </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1901.jpg"/>
</Figure>

<P>half-word n (byte m-1 || byte m) </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1902.jpg"/>
</Figure>

<P>16 </P>

<P> </P>

<P>Figure 4-2. Start Segment Type 9 Packet Bit Stream Format Example </P>

<P> </P>

<P>Figure 4-3 is an example of a Continuation Segment type 9 packet with all of its fields. The size of the data payload must match the MTU size. The half-words (and correspondingly, bytes) are contiguous in the manner shown in the preceding examples. The value 0b1001 in Figure 4-3 specifies that the packet format is of type </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1903.jpg"/>
</Figure>

<P>9. </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1904.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1 0 0 1 </P>
</TD>

<TD>
<P>cos </P>
</TD>

<TD>
<P>S=0 E=0 </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>rsv </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>1 1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>2 </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1905.jpg"/>
</Figure>

<P>half-word </P>

<P> </P>

<P>16 </P>

<P>half-word </P>

<P> </P>

<P>16 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1906.jpg"/>
</Figure>

<P>&#8226; &#8226;  &#8226; </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1907.jpg"/>
</Figure>

<P>half-word </P>

<P> </P>

<P>16 </P>

<P> </P>

<P>Figure 4-3. Continuation Segment Type 9 Packet Bit Stream Format Example </P>

<P> </P>

<P>Figure 4-4 is an example of an End Segment type 9 packet with all of its fields. The size of the data payload is determined by the remainder of the size of the PDU (the length field) divided by the size of the MTU. For convenience at the destination, the O and P bits are used as they are for a single segment. In this example, the data payload size does not match the PDU size, has a pad byte, and is an odd number of half-words. The half-words (and correspondingly, bytes) are contiguous in the manner shown in the preceding examples. A length value of 0 and no data payload can be used to force the PDU to be discarded. The value 0b1001 in Figure 4-4 specifies that the packet format is of type 9. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1 0 0 1 </P>
</TD>

<TD>
<P>cos </P>
</TD>

<TD>
<P>S=0 E=1 </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>O=1 P=1 </P>
</TD>

<TD>
<P>length </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>1 1 </P>
</TD>

<TD>
<P>3 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>1 1 </P>
</TD>

<TD>
<P>16 </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1908.jpg"/>
</Figure>

<P>half-word </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1909.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1910.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1911.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1912.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1913.jpg"/>
</Figure>

<P> </P>

<P>16 </P>

<P>half-word </P>

<P> </P>

<P>16 </P>

<P>&#8226; &#8226; &#8226; </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1914.jpg"/>
</Figure>

<P>half-word (last byte || pad=0x00) </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1915.jpg"/>
</Figure>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1916.jpg"/>
</Figure>

<P>16 </P>

<P> </P>

<P>Figure 4-4. End Segment Type 9 Packet Bit Stream Format </P>

<P> </P>

<P>4.3 Type 9 Extended Packet Format </P>

<P> </P>

<P>The type 9 extended packet format for traffic management between two data streaming endpoints is shown below. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>1 0 0 1 </P>
</TD>

<TD>
<P>cos </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>Xtype = 000 xh=1 </P>
</TD>

<TD>
<P>rsrv </P>
</TD>

<TD>
<P>streamID </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>8 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>3 1 </P>
</TD>

<TD>
<P>2 </P>
</TD>

<TD>
<P>16 </P>
</TD>
</TR>
</Table>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1917.jpg"/>
</Figure>

<P>TM OP </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1918.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1919.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1920.jpg"/>
</Figure>

<P> </P>

<P>4 </P>

<P>rsrv </P>

<P> </P>

<P>1 </P>

<P>wildcard </P>

<P> </P>

<P>3 </P>

<P>mask </P>

<P> </P>

<P>8 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1921.jpg"/>
</Figure>

<P>parameter 1 </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1922.jpg"/>
</Figure>

<P>8 </P>

<P>parameter 2 </P>

<P> </P>

<P>8 </P>

<P> </P>

<P>Figure 4-5. Traffic Management Bit Stream Format </P>

<P> </P>

<P>The extended type 9 packet is identified first by the XH bit equal to 1. The Class of Service field and the StreamID are included from the data packet format. The segmentation bits, Start and End are not used, or are the Odd and Pad fields. Those are left 0&#8217;s. The 3 bit reserved field, is defined for the extended packet format as defining the type of extended packet. Type 0 is a traffic management packet. </P>

<P> </P>

<P>The TM packet adds a fixed 4 bytes to the packet as shown above and defined below: </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-3. Extended Header Fields </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Type 9 Fields </P>
</TD>

<TD>
<P>Encoding </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>cos </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Class Of Service: This field defines the class of service assigned to the stream that is being managed with this message. See Section 4.3.1. </P>
</TD>
</TR>

<TR>
<TD>
<P>rsrv </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>xtype </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Traffic Management Packet </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b001 - 0b111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>xh </P>
</TD>

<TD>
<P>0b1 </P>
</TD>

<TD>
<P>Extended Header: There is an extended header on this packet. Currently the extended header is only used for stream management messages. It is always assigned to 0b1 for type 9 extended packets. </P>
</TD>
</TR>

<TR>
<TD>
<P>streamID </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Traffic Stream Identifier: This is an end to end (producer to consumer) traffic stream identifier that is being managed with this message. See Section 4.3.1. </P>
</TD>
</TR>

<TR>
<TD>
<P>TM OP </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>Basic Stream Management Message: message specifying base level XON/XOFF </P>

<P>functionality. This message flows from one endpoint to another. See Section 4.3.2. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>Rate Control Stream Management Message: Rate flow control messages to support the rate control protocol. See Section 4.3.3. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>Credit Control Stream Management Message: Credit Control messages to support the credit based flow control protocol. Section 4.3.4 </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0011 </P>
</TD>

<TD>
<P>Application Defined Stream Management Message: A message from one end point to another end point. The use of this message is application defined. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0100-1111 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>wildcard </P>
</TD>

<TD>
<P>0bnxx </P>
</TD>

<TD>
<P>VSID dest wildcard: If this bit is set, the message applies to all destinations. If clear, the message applies to the specified destination. See Section 4.3.1. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0bxnx </P>
</TD>

<TD>
<P>VSID class wildcard: If this bit is set the message applies to all classes. If clear, the message applies to the specified class or classes as specified by the mask bits. See Section 4.3.1. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0bxxn </P>
</TD>

<TD>
<P>VSID stream wildcard: If this bit is set the message applies to all streams. If clear, the message applies to the specified stream. See Section 4.3.1. </P>
</TD>
</TR>

<TR>
<TD>
<P>mask </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Class Mask: Used to mask portions of the class of service (COS) field to allow groups of classes to be included in the message. The mask is left justified to identify specific class bits as don&#8217;t cares: </P>

<P>Mask Class&#61472;&#61472;</P>

<P>0b00000000 0bnnnnnnnn 256 classes n = valid class bits&#61472;&#61472;</P>

<P>0b00000001 0bnnnnnnnx 128 classes x = don&#8217;t cares&#61472;&#61472;</P>

<P>0b00000011 0bnnnnnnxx 64 classes&#61472;&#61472;</P>

<P>0b00000111 0bnnnnnxxx 32 classes&#61472;&#61472;</P>

<P>0b00001111 0bnnnnxxxx 16 classes&#61472;&#61472;</P>

<P>0b00011111 0bnnnxxxxx 8 classes&#61472;&#61472;</P>

<P>0b00111111 0bnnxxxxxx 4 classes&#61472;&#61472;</P>

<P>0b01111111 0bnxxxxxxx 2 classes&#61472;&#61472;</P>

<P>0b11111111 0bxxxxxxxx 1 class </P>
</TD>
</TR>

<TR>
<TD>
<P>Parameter1 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Parameter1: Argument specific to the TM message operation. See below </P>
</TD>
</TR>

<TR>
<TD>
<P>Parameter2 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Parameter2: Argument specific to the TM message operation. See below </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.1  TM Operand </P>

<P> </P>

<P>The operand for the specific TM operation is defined by the following fields: </P>

<P> </P>

<P>&lt;Source or Destination ID&gt; &lt;CoS&gt; &lt;StreamID&gt; + &lt;wild cards&gt; + &lt;Mask&gt; The follow operands are valid: </P>

<P>Specific Stream: &#61472;&#61472;</P>

<P>&lt;DestID&gt;&lt;CoS&gt;&lt;StreamID&gt; + &lt;wc=000&gt; + &lt;m = 0x00&gt; </P>

<P> </P>

<P>All Streams in a specific class:&#61472;&#61472;</P>

<P>&lt;DestID&gt;&lt;CoS&gt;&lt; xx &gt; + &lt;wc = 001&gt; + &lt;m = 0x00&gt;&#61472;&#61472;</P>

<P>where StreamID is a don&#8217;t care </P>

<P> </P>

<P>All Streams in a group of classes:&#61472;&#61472;</P>

<P>&lt;DestID&gt;&lt;CoS&gt;&lt; xx &gt; + &lt;wc = 001&gt; + &lt;m = 0xnn&gt;&#61472;&#61472;</P>

<P>where mask is one of the non-zero values identified in table 4-3 </P>

<P> </P>

<P>All Streams and Classes (all traffic) to a specific destination&#61472;&#61472;</P>

<P>&lt;DestID&gt;&lt; xx &gt;&lt; xx &gt; + &lt;wc = 011&gt; + &lt;m = xx&gt;&#61472;&#61472;</P>

<P>where CoS, StreamID and mask are don&#8217;t cares </P>

<P> </P>

<P>All traffic from this source&#61472;&#61472;</P>

<P>&lt; xx &gt;&lt; xx &gt;&lt; xx &gt; + &lt;wc = 111&gt; + &lt;m = xx&gt; No other combinations of these fields is permitted. </P>

<P> </P>

<P>4.3.2  Basic Traffic Management </P>

<P> </P>

<P>Basic traffic management message formats are as follows: </P>

<P> </P>

<P>Table 4-4. Basic Traffic Management Message Formats </P>

<P> </P>

<Table>
<TR>
<TD>
<P>TM OP </P>
</TD>

<TD>
<P>Parameter 1 </P>
</TD>

<TD>
<P>Parameter 2 </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>0b0000 0000 </P>
</TD>

<TD>
<P>0b0000 0000 </P>
</TD>

<TD>
<P>XOFF: Transmit off </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b1111 1111 </P>
</TD>

<TD>
<P>XON: Transmit on. </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b0000 0001-&#61472;&#61472;</P>

<P>0b1111 1110 </P>
</TD>

<TD>
<P>User/application defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0000 0011 </P>
</TD>

<TD>
<P>0b0000 0000 - &#61472;&#61472;</P>

<P>0b1111 1111 </P>
</TD>

<TD>
<P>Q_Status: Source queue is n/255 full (where n is parameter 2). &#61472;&#61472;</P>

<P>0 = empty, 0xFF = full </P>
</TD>
</TR>
</Table>

<P> </P>

<P>All other parameter 1 values are reserved. </P>

<P> </P>

<P>The implementer may overload the parameter 2 field (Parameter1 = 0) for other messages. Only 0x00 shall be assured to be XOFF, and 0xFF shall assured to be XON. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.3  Rate Based Traffic Management </P>

<P> </P>

<P>Rate based traffic management messages are as follows: </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table 4-5. Rate Based Traffic Management Message Formats </P>

<P> </P>

<Table>
<TR>
<TD>
<P>TM OP </P>
</TD>

<TD>
<P>Parameter 1 </P>
</TD>

<TD>
<P>Parameter 2 </P>
</TD>

<TD>
<P>Definition </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0001 </P>
</TD>

<TD>
<P>0b0000 0000 </P>
</TD>

<TD>
<P>0b0000 0000 </P>
</TD>

<TD>
<P>XOFF: Transmit off </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b1111 1111 </P>
</TD>

<TD>
<P>XON: Transmit On. Start transmitting at the rate prior to receiving the XOFF </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b0000 0001 -&#61472;&#61472;</P>

<P>0b1111 1110 </P>
</TD>

<TD>
<P>User Defined: May be overloaded with any implementation specific message. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0000 0Y01 </P>
</TD>

<TD>
<P>0b0000 0000 </P>
</TD>

<TD>
<P>Maintain_Rate: Maintain the current rate </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b0000 0001 </P>
</TD>

<TD>
<P>REDUCE: Reduce the current rate to = CurrentRate x (1-1/256) </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b0000 0010 </P>
</TD>

<TD>
<P>REDUCE: Reduce the current rate to = CurrentRate x (1-2/256) </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b0000 0011-&#61472;&#61472;</P>

<P>0b1111 1111 </P>
</TD>

<TD>
<P>REDUCE: Reduce the current rate to = CurrentRate x (1-n/256) &#61472;&#61472;</P>

<P>(where n is parameter 2) </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0000 0Y10 </P>
</TD>

<TD>
<P>0b0000 0001-&#61472;&#61472;</P>

<P>0b1111 1110 </P>
</TD>

<TD>
<P>INCREASE: Increase the current rate to = CurrentRate x (1+ n/256) (additive increase where n is parameter 2) </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b1111 1111 </P>
</TD>

<TD>
<P>DOUBLE: Double the current rate. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0000 0011 </P>
</TD>

<TD>
<P>0b0000 0001-&#61472;&#61472;</P>

<P>0b1111 1111 </P>
</TD>

<TD>
<P>Q_Status: Source queue is n/255 full (where n is parameter 2). &#61472;&#61472;</P>

<P>0x00 = Empty, 0xFF = Full </P>
</TD>
</TR>
</Table>

<P> </P>

<P>For &#8217;Y&#8217; = 0 (Param 1 = 0x01, 0x02) the messages apply to average rate. For &#8217;Y&#8217; = 1 (Param 1 = 0x05, 0x06) the messages apply to peak rate. </P>

<P>All other parameter 1 values are reserved. </P>

<P> </P>

<P>The implementer may overload the parameter 2 field (Parameter1=0) for other messages. Only 0x00 shall be assured to be XOFF, and 0xFF shall assured to be XON. </P>

<P> </P>

<P>Notes on reducing precision: </P>

<P> </P>

<P>REDUCE values should be rounded UP to the nearest precision.&#61472;&#61472;</P>

<P>Example: for n/16 precision - 0b0000 0011 would be rounded to 0b0001 xxxx </P>

<P> </P>

<P>INCREASE values should be rounded DOWN to the nearest precision.&#61472;&#61472;</P>

<P>Example for n/32 precision 0b1100 1110 would be rounded to 0b1100 1xxx </P>

<P> </P>

<P>Q_STATUS values should be rounded UP to the nearest precision. </P>

<P> </P>

<P>Whatever the minimum precision the ingress uses for rate scheduling, a decrease must never reduce the rate completely to zero. The egress must use XOFF to stop the flow completely. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.4  Credit Based Traffic Management </P>

<P> </P>

<P>The message formats for credit based traffic management are as follows: </P>

<P>Table 4-6. Credit Based Traffic Management Message Formats </P>

<P> </P>

<Table>
<TR>
<TD>
<P>TM OP </P>
</TD>

<TD>
<P>Parameter 1 </P>
</TD>

<TD>
<P>Parameter 2 </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0b0010 </P>
</TD>

<TD>
<P>0b00000000 </P>
</TD>

<TD>
<P>0b00000000 </P>
</TD>

<TD>
<P>XOFF: Transmit off </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b11111111 </P>
</TD>

<TD>
<P>XON: Transmit On. Start transmitting at the rate prior to receiving the XOFF </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>0b0000 0001 -&#61472;&#61472;</P>

<P>0b1111 1110 </P>
</TD>

<TD>
<P>User Defined: May be overloaded with any implementation specific message. </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0001 nnnn </P>
</TD>

<TD>
<P>0b0000 0000 - </P>

<P>0b1111 1111 </P>
</TD>

<TD>
<P>Allocate: nnnn - Allocation Unit </P>

<P>Parameter 2 - number of credits </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0010 nnnn </P>
</TD>

<TD>
<P>0b0000 0000 - </P>

<P>0b1111 1111 </P>
</TD>

<TD>
<P>Credit Status: nnnn - allocation Unit </P>

<P>Parameter 2 - number of Credits </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P>0b0011 0000 </P>
</TD>

<TD>
<P>0b0000 0000 - </P>

<P>0b1111 1111 </P>
</TD>

<TD>
<P>Queue Status: Source Queue is n/255 full (where n is parameter 2)&#61472;&#61472;</P>

<P>0 = Empty; 0xFF = Full </P>
</TD>
</TR>
</Table>

<P> </P>

<P>All other parameter 1 values are reserved. </P>

<P> </P>

<P>The implementer may overload the parameter 2 field (Param1=0) for other messages. Only 0x00 shall be assured to be XOFF, and 0xFF shall assured to be XON. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 Data Streaming Registers </P>

<P> </P>

<P> </P>

<P>5.1 Introduction </P>

<P> </P>

<P>This chapter describes the visible register set that allows an external processing element to determine the capabilities, configuration, and status of a processing element using this logical specification. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, physical, and extension specifications of interest to determine a complete list of registers and bit definitions. All registers are 32 bits and aligned to a 32 bit boundary. </P>

<P> </P>

<P> </P>

<P>5.2 Register Summary </P>

<P> </P>

<P>Table 5-1 shows the register map for this RapidIO specification. These capability registers (CARs) and command and status registers (CSRs) can be accessed using RapidIO Interconnect Specification Part 1: Input/Output Logical Specification maintenance operations. Any register offsets not defined are considered reserved for this specification unless otherwise stated. Other registers required for a processing element are defined in other applicable RapidIO specifications and by the requirements of the specific device and are beyond the scope of this specification. Read and write accesses to reserved register offsets shall terminate normally and not cause an error condition in the target device. Writes to CAR (read-only) space shall terminate normally and not cause an error condition in the target device. </P>

<P> </P>

<P>Register bits defined as reserved are considered reserved for this specification only. Bits that are reserved in this specification may be defined in another RapidIO specification. </P>

<P> </P>

<P>Table 5-1. Data Streaming Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0-14 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x18 </P>
</TD>

<TD>
<P>Source Operations CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x1C </P>
</TD>

<TD>
<P>Destination Operations CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x20&#8211;38 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x3C </P>
</TD>

<TD>
<P>Data Streaming Information CAR </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-1. Data Streaming Register Map (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x40&#8211;44 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x48 </P>
</TD>

<TD>
<P>Data Streaming Logical Layer Control CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x4C&#8211;FC </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P> </P>

<P>Extended Features Space </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P> </P>

<P>Implementation-defined Space </P>
</TD>
</TR>
</Table>

<P> </P>

<P>5.3 Reserved Register, Bit and Bit Field Value Behavior </P>

<P> </P>

<P>Table 5-2 describes the required behavior for accesses to reserved register bits and reserved registers for the RapidIO register space, </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0&#8211;3C </P>
</TD>

<TD>
<P>Capability Register Space (CAR Space - this space is read-only) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value1 </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x40&#8211;FC </P>
</TD>

<TD>
<P>Command and Status Register Space (CSR Space) </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value2 </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 5-2. Configuration Space Reserved Access Behavior (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Byte Offset </P>
</TD>

<TD>
<P>Space Name </P>
</TD>

<TD>
<P>Item </P>
</TD>

<TD>
<P>Initiator behavior </P>
</TD>

<TD>
<P>Target behavior </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P>Extended Features Space </P>
</TD>

<TD>
<P>Reserved bit </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0 </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Implementation- defined bit </P>
</TD>

<TD>
<P>read - ignore returned value unless </P>

<P>implementation-defined function understood </P>
</TD>

<TD>
<P>read - return </P>

<P>implementation-defined value </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - preserve current value if implementation-defined function not understood </P>
</TD>

<TD>
<P>write - </P>

<P>implementation-defined </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD>
<P>Reserved register </P>
</TD>

<TD>
<P>read - ignore returned value </P>
</TD>

<TD>
<P>read - return logic 0s </P>
</TD>
</TR>

<TR>
<TD/>

<TD/>

<TD/>

<TD>
<P>write - </P>
</TD>

<TD>
<P>write - ignored </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P>Implementation-defined </P>

<P>Space </P>
</TD>

<TD>
<P>Reserved bit and register </P>
</TD>

<TD>
<P>All behavior implementation-defined </P>
</TD>
</TR>
</Table>

<P>1Do not depend on reserved bits being a particular value; use appropriate masks to extract defined bits from the read value. </P>

<P>2All register writes shall be in the form: read the register to obtain the values of all reserved bits, merge in the desired values for defined bits to be modified, and write the register, thus preserving the value of all reserved bits. </P>

<P> </P>

<P>When  a  writable  bit  field  is  set  to  a  reserved  value,  device  behavior  is implementation specific. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.4 Additions to Existing Registers </P>

<P> </P>

<P>The following bits are added to the Logical/Transport Layer Error Detect CSR (see RapidIO Interconnect Specification Part 8: Error Management Extensions Specification). </P>

<P> </P>

<P>Table 5-3. Bit Settings for Logical/Transport Layer Error Detect CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>Missing data streaming context </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>A continuation or end data streaming segment was received for a closed or non-existent segmentation context&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Open existing data streaming context </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>A start or single data streaming segment was received for an already open segmentation context&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Long data streaming segment </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a data streaming segment with a payload size greater than the MTU&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Short data streaming segment </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Received a start or continuation data streaming segment with a payload size less than the MTU&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Data streaming PDU </P>

<P>length error </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>The length of a reassembled PDU differs from the PDU length carried in the end data streaming segment packet header&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>
</Table>

<P> </P>

<P>The following bits are added to the Logical/Transport Layer Error Enable CSR (see RapidIO Interconnect Specification Part 8: Error Management Extensions Specification). </P>

<P> </P>

<P>Table 5-4. Bit Settings for Logical/Transport Layer Error Enable CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>Missing data streaming context error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a continuation or end data streaming segment received for a closed or non-existent segmentation context. Save and lock capture information in the appropriate Logical/Transport Layer Capture CSRs.&#61472; (end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Open existing data streaming context error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a start or single data streaming segment received for an already open segmentation context. Save and lock capture information in the appropriate Logical/Transport Layer Capture CSRs.&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Long data streaming segment error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a any data streaming segment received with a payload size greater then the MTU. Save and lock capture information in the appropriate Logical/Transport Layer Capture CSRs.&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Table 5-4. Bit Settings for Logical/Transport Layer Error Enable CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Short data streaming segment error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a start or continuation data streaming segment received with a payload size less that the MTU. Save and lock capture information in the appropriate Logical/Transport Layer Capture CSRs.&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Data streaming PDU </P>

<P>length error enable </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Enable reporting of a reassembled PDU length that differs from the PDU length carried in the end data streaming segment packet header. Save and lock capture information in the appropriate Logical/Transport Layer Capture CSRs.&#61472;&#61472;</P>

<P>(end point device only) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.5 Capability Registers (CARs) </P>

<P> </P>

<P>Every processing element shall contain a set of registers that allows an external processing element to determine its capabilities through maintenance read operations. All registers are 32 bits wide and are organized and accessed in 32 bit (4 byte) quantities, although some processing elements may optionally allow larger accesses. CARs are read-only. Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P>CARs are big-endian with bit 0 and Word 0 respectively the most significant bit and word. </P>

<P> </P>

<P> </P>

<P>5.5.1  Source Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x18) </P>

<P> </P>

<P>This register defines the set of RapidIO data streaming logical operations that can be issued by this processing element; see Table 5-5. It is assumed that a processing element can generate I/O logical maintenance read and write requests if it is required to access CARs and CSRs in other processing elements. The Source Operations CAR is applicable for end point devices only. RapidIO switches shall be able to route any packet. </P>

<P> </P>

<P>Table 5-5. Bit Settings for Source Operations CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;11 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Data streaming traffic management </P>
</TD>

<TD>
<P>PE can support data streaming traffic management </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Data streaming </P>
</TD>

<TD>
<P>PE can support a data streaming operation </P>
</TD>
</TR>

<TR>
<TD>
<P>14-15 </P>
</TD>

<TD>
<P>Implementation defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>

<TR>
<TD>
<P>16-29 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>30&#8211;31 </P>
</TD>

<TD>
<P>Implementation defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.2  Destination Operations CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x1C) </P>

<P> </P>

<P>This register defines the set of RapidIO data streaming operations that can be supported by this processing element; see Table 5-6. It is required that all processing elements can respond to maintenance read and write requests in order to access these registers. The Destination Operations CAR is applicable for end point devices only. RapidIO switches shall be able to route any packet. </P>

<P> </P>

<P>Table 5-6. Bit Settings for Destination Operations CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-11 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Data streaming traffic management </P>
</TD>

<TD>
<P>PE can support data streaming traffic management </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Data streaming </P>
</TD>

<TD>
<P>PE can support a data streaming operation </P>
</TD>
</TR>

<TR>
<TD>
<P>14-15 </P>
</TD>

<TD>
<P>Implementation defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>

<TR>
<TD>
<P>16-29 </P>
</TD>

<TD>
<P>&#8212; </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>30-31 </P>
</TD>

<TD>
<P>Implementation defined </P>
</TD>

<TD>
<P>Defined by the device implementation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.5.3  Data Streaming Information CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x3C) </P>

<P> </P>

<P>This register defines the data streaming capabilities of a processing element. It is required for destination end point devices. </P>

<P> </P>

<P>Table 5-7. Bit Settings for Data Streaming Information CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0&#8211;15 </P>
</TD>

<TD>
<P>MaxPDU </P>
</TD>

<TD>
<P>Maximum PDU - The maximum PDU size in bytes supported by the destination end point </P>

<P>0x0000 - 64kbytes&#61472;&#61472;</P>

<P>0x0001 - 1 byte&#61472;&#61472;</P>

<P>0x0002 - 2 bytes&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xFFFF - 64kbytes - 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>16&#8211;31 </P>
</TD>

<TD>
<P>SegSupport </P>
</TD>

<TD>
<P>Segmentation Support - The number of segmentation contexts supported by the destination end point </P>

<P>0x0000 - 64k segmentation contexts&#61472;&#61472;</P>

<P>0x0001 - 1 segmentation context&#61472;&#61472;</P>

<P>0x0002 - 2 segmentation contexts&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xFFFF - 64k - 1 segmentation contexts </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>5.6 Command and Status Registers (CSRs) </P>

<P> </P>

<P>A processing element shall contain a set of command and status registers (CSRs) that allows an external processing element to control and determine the status of its internal hardware. All registers are 32 bits wide and are organized and accessed in the same way as the CARs. Refer to Table 5-2 for the required behavior for accesses to reserved registers and register bits. </P>

<P> </P>

<P> </P>

<P>5.6.1  Data Streaming Logical Layer Control CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x48) </P>

<P> </P>

<P>The Data Streaming Logical Layer Control CSR is used for general command and status information for the logical interface. </P>

<P> </P>

<P>Table 5-8. Bit Settings for Data Streaming Logical Layer Control CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit </P>
</TD>

<TD>
<P>Field Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-3 </P>
</TD>

<TD>
<P>TM Types Supported (read only) </P>
</TD>

<TD>
<P>Bit 0 = 1, Basic Type Supported&#61472; Bit 1 = 1, Rate Type Supported&#61472; Bit 2 = 1, Credit Type Supported&#61472; Bit 3 = Reserved </P>

<P>Valid Combinations: 0b1000, 0b1100, 0b1010, 0b1110. All others invalid </P>
</TD>
</TR>

<TR>
<TD>
<P>4 - 7 </P>
</TD>

<TD>
<P>TM Mode </P>
</TD>

<TD>
<P>Traffic Management Mode of operation&#61472;&#61472;</P>

<P>0b0000 = TM Disabled&#61472;&#61472;</P>

<P>0b0001 = Basic&#61472;&#61472;</P>

<P>0b0010 = Rate&#61472;&#61472;</P>

<P>0b0011 = Credit&#61472;&#61472;</P>

<P>0b0100 = Credit + Rate&#61472;&#61472;</P>

<P>0b0101 - 0b0111 = Reserved&#61472;&#61472;</P>

<P>0b1000 - 0b1111 = allowed for user defined modes </P>
</TD>
</TR>

<TR>
<TD>
<P>8 - 23 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>24-31 </P>
</TD>

<TD>
<P>MTU </P>
</TD>

<TD>
<P>Maximum Transmission Unit - controls the data payload size for segments of an encapsulated PDU. Only single segment PDUs and end segments are permitted to have a data payload that is less than this value. The MTU can be specified in increments of 4 bytes. Support for the entire range is required. </P>

<P>0b0000_0000 - reserved&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0b0000_0111 - reserved&#61472;&#61472;</P>

<P>0b0000_1000 - 32 byte block size&#61472;&#61472;</P>

<P>0b0000_1001 - 36 byte block size&#61472;&#61472;</P>

<P>0b0000_1010 - 40 byte block size&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0b0100_0000 - 256 byte block size&#61472;&#61472;</P>

<P>0b0100_0001 - Reserved&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0b1111_1111 - Reserved&#61472;&#61472;</P>

<P> </P>

<P>All other encodings reserved </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex A VSID Usage Examples </P>

<P> </P>

<P> </P>

<P>A.1 Introduction </P>

<P> </P>

<P>The virtual stream identification (VSID) mechanism provides multiple features condensed in a single 32 bit key. These features include: </P>

<P>&#8226; A mechanism to manage traffic for ingress to the fabric </P>

<P>&#8226; A mechanism to manage traffic in transit within the fabric </P>

<P>&#8226; A protocol independent tag to reclassify packets on fabric egress </P>

<P>&#8226; A flexible &quot;sub-port&quot; addressing mechanism </P>

<P>&#8226; Independence in buffer management </P>

<P> </P>

<P> </P>

<P>A.2 Background </P>

<P> </P>

<P>The VSID is a composite of the port, class, and streamID fields as described in Section 3.2.2. The port address used in the VSID is either the destination ID or the source ID depending on which side of the fabric the packet is on. At the ingress to the fabric (source) the destination IDs are unique. At the egress from the fabric, the source IDs are unique. </P>

<P> </P>

<P>By including the source/destination IDs in the VSID, these keys are unique for each source and destination pairing. This allows the other fields (class and streamID) to be set up independently without consideration of how these fields are used with any other port pairings. </P>

<P> </P>

<P>The usage of the VSID can vary depending on the sophistication of the fabric and the demands of the application, from very simplistic port or queue steering to conveying significant amounts of information (requiring intensive computation) as to the content of the PDU. </P>

<P> </P>

<P> </P>

<P>A.3 Packet Classification </P>

<P> </P>

<P>All PDUs require some form of classification for ingress to the fabric. Fields in the PDU specific to the protocol are examined and routing information is produced. The VSID produced is a 32 bit tag as opposed to just a port address. At the destination, this 32 bit tag can be used to re-associate the PDU with a target buffer. This can be done by direct addressing, or using a single key table lookup. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>This mechanism provides a finely grained and protocol independent way to sort traffic, and a virtual mechanism for buffer pool management. Without a virtual tag, the packet would have to undergo a re-classification based on the protocol specific portion of the PDU. In multi-service platforms, this could involve numerous and elaborate processes, duplicating what was already done at the source. </P>

<P> </P>

<P>The following sections illustrate in degrees of increasing complexity, the versatility of the VSID scheme. </P>

<P> </P>

<P> </P>

<P>A.3.1  Sub-port Addressing at the Destination </P>

<P> </P>

<P>The simplest use of the VSID is to de-multiplex the traffic into coarse sub-ports at the destination. These may be to separate traffic by protocol, or into multiple sub-ports of the same protocol. </P>

<P> </P>

<P>A.3.1.1 DSLAM application </P>

<P> </P>

<P>Assume that each line card contain 128 user ports. The system could expose each of these as independent destinations to the RapidIO fabric, requiring the use of an excessively large number of destination IDs in the system, and imposing the associated cost in overhead. Alternatively the ATM traffic can be encapsulated into </P>

<P>128 VSIDs, one for each port. The line card would then expose a single port to the RapidIO fabric. The VSID would be used as the address to fan out the traffic on various UTOPIA busses to the user ports. This also has an advantage for fault recovery. Should a line card fail, a single port entry in routing tables in the fabric needs to be updated rather than all 128 sub-ports. </P>

<P> </P>

<P>A.3.1.2 VOIP application </P>

<P> </P>

<P>The VSID can be used to separate the traffic into just 2 channels, one destined for a control processor to handle control messages and one channel that goes to a network processor to be distributed to DSPs. The VSID could contain the address of the target DSP, to further off-load the network processor on distribution. The VSID could also contain the user channel within the DSP de-multiplexing the traffic even further. </P>

<P> </P>

<P> </P>

<P>A.3.2  Virtual Output Queueing - Fabric On-ramp </P>

<P> </P>

<P>Applications involving larger numbers of flows can use the class field to regulate the ingress to the fabric (known as virtual output queueing). For example, the RapidIO fabric interface could contain 256 queues for 64 destination ports with 4 traffic classes. Traffic for each destination of the same class is fairly weighted. The weighting between classes can be application unique. </P>

<P> </P>

<P>The traffic is kept sorted by destination. If traffic was just dumped into 4 queues, and a destination port was to fail, the traffic could head of line block the traffic to the other ports, or it would have to be discarded while the port is being recovered or </P>

<P> </P>

<P>56 RapidIO Trade Association </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>re-routed. By keeping the traffic sorted by destination at the fabric ingress, that destination can be re-routed with minimal traffic loss. </P>

<P> </P>

<P>Virtual output queueing can be expanded to 2K or even 16K buffers depending on how large the fabric is, and how many different traffic classes are involved. This fabric ingress management can be a simple mechanism to add some quality of service to a system using the destination ID and the class portion of the VSID. Note that this can be done separately from the use of the streamID at the destination for de-multiplexing. </P>

<P> </P>

<P> </P>

<P>A.4 System Requirements </P>

<P> </P>

<P>The use of the VSID is determined by all three elements in a system, the source, the fabric, and the destination. This section contains descriptions of some example source devices. </P>

<P> </P>

<P> </P>

<P>A.4.1  UTOPIA to RapidIO ATM bridge </P>

<P> </P>

<P>The UTOPIA to RapidIO ATM bridge classifies traffic using the VPI field as the destination port, and the VCI as a sub-port address. It maps all (type 9) traffic to a single RapidIO flow, setting the class to 0 and the streamID to the VCI. The fabric switches on flows. The destination uses the streamID portion of the VSID as a hard-wired sub-port address. </P>

<P> </P>

<P> </P>

<P>A.4.2  Network processor </P>

<P> </P>

<P>The network processor (NP) contains a OC-48 link aggregating traffic to and from multiple 1MB/s ports distributed on line cards. The NP classifies traffic for each user into two classes: high priority for voice (using RTP) and low priority for all others. It sets the class field to 0 or 1, the port to the proper line card, and the streamID to the desired sub-port. </P>

<P> </P>

<P> </P>

<P>A.4.3  CSIX to RapidIO interface </P>

<P> </P>

<P>The CSIX packet contains the destination and class fields (the source is a preset parameter in the interface chip). The streamID is the first 16 bits of the CSIX payload. The RapidIO packet is easily constructed from this information. The fabric interface contains multiple virtual output queues, 2 per destination port. Since the CSIX to NP interface is also a segmented interface, PDUs are reassembled in the virtual queues until enough information is available to form the required MTU on the RapidIO fabric. </P>

<P> </P>

<P>The fabric maps the class to a higher or lower priority flow. The destination uses the streamID to map the traffic to the correct user sub-port. Each sub-port contains two class queues to collect traffic as it is reassembled. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>A.4.4  10Gb Metropolitan Area Network interface </P>

<P> </P>

<P>A specialized classification processor creates the 32 bit VSID based on IP, TCP/UDP, and application information. The tag is prepended to a SPI4.2 packet. The interface to the fabric is a SPI4.2 to RapidIO bridge, which contains virtual output queues. </P>

<P> </P>

<P>The destination is a processor that only supports memory and IO logical transactions. The RapidIO to processor interface bridge contains the segmentation and reassembly buffers and look up tables and associated engines that maps the VSID to a DMA buffer address (and vice-versa). </P>

<P> </P>

<P>The system contains multiple of these processing cards to support address translation, encryption, or firewall processing. The source classifies traffic based on which of these applications applies. A connection is created by allocating a buffer address in the destination, and assigning a streamID. The source table is created with the search tree requirements for the protocol, and setting up the VSID result. </P>

<P> </P>

<P>Destinations may use the VSID in a hard-wired method, or it may be a flexible mapping to virtual buffers. In either case, the source must be flexible to assign the VSID according the destination's needs. This is normally not an issue as the source needs to classify the packet to determine the destination anyway. The use of the VSID can be to separate the traffic by protocol, sub-port, service class, or into as many virtual queues as necessary. If the destination is managing a large number of buffers, the VSID allows the destination to use a single protocol independent key to re-map the traffic and completely abstract any buffer management. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1923.jpg"/>
</Figure>

<P>B Bridge. A processing element that connects one computer bus to another, allowing a processing element on one bus to access an processing element on the other. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1924.jpg"/>
</Figure>

<P>C Capability registers (CARs). A set of read-only registers that allows a processing element to determine another processing element&#8217;s capabilities. </P>

<P> </P>

<P>Class of service - (cos) a term used to describe different treatment (quality of service) for different data streams. Support for class of service is provided by a class of service field in the data streaming protocol. The class of service field is used in the virtual stream ID and in identifying a virtual queue. </P>

<P> </P>

<P>Command and status registers (CSRs). A set of registers that allows a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1925.jpg"/>
</Figure>

<P>D Deadlock. A situation in which two processing elements that are sharing resources prevent each other from accessing the resources, resulting in a halt of system operation. </P>

<P> </P>

<P>Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Direct Memory Access (DMA). The process of accessing memory in a device by specifying the memory address directly. </P>

<P> </P>

<P>Double-word. An  eight  byte  or  64  bit  quantity, aligned  on  eight  byte boundaries. </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1926.jpg"/>
</Figure>

<P>E Egress - Egress is the device or node where traffic exits the system. The egress node also becomes the destination for traffic out of the </P>

<P>RapidIO fabric. The terms egress and destination may or may not be used interchangeably when considering a single end to end connection. </P>

<P> </P>

<P>End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>End  point  device.  A  processing  element  which  contains  end  point functionality. </P>

<P> </P>

<P>Ethernet. A common local area network (LAN) technology. </P>

<P> </P>

<P>External  processing  element.  A  processing  element  other  than  the processing element in question. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1927.jpg"/>
</Figure>

<P>F Field or Field name. A sub-unit of a register, where bits in the register are named and defined. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1928.jpg"/>
</Figure>

<P>H Half-word. A two byte or 16 bit quantity, aligned on two byte boundaries. </P>

<P> </P>

<P>Host. A processing element responsible for exploring and initializing all or a portion of a RapidIO based system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1929.jpg"/>
</Figure>

<P>I Ingress - Ingress is the device or node where traffic enters the system. The ingress node also becomes the source for traffic into the RapidIO </P>

<P>fabric. The terms ingress and source may or may not be used interchangeably when considering a single end to end connection. </P>

<P> </P>

<P>Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P>I/O. Input-output. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1930.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P> </P>

<Textbox>
<P> </P>

<P>P </P>
</Textbox>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1931.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1932.jpg"/>
</Figure>

<P>system. </P>

<P> </P>

<P>PDU. Protocol Data Unit, the OSI term for a packet. </P>

<P> </P>

<P>Priority. The relative importance of a transaction or packet; in most systems a higher priority transaction or packet will be serviced or transmitted before one of lower priority. </P>

<P> </P>

<P>60 RapidIO Trade Association </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P>Processor. The logic circuitry that responds to and processes the basic instructions that drive a computer. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1933.jpg"/>
</Figure>

<P>R Receiver. The RapidIO interface input port on a processing element. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1934.jpg"/>
</Figure>

<P>S SAR. Segmentation and Reassembly, a mechanism for encapsulating a PDU </P>

<P>within multiple packets. </P>

<P> </P>

<P>Segmentation. A process by which a PDU is transferred as a series of smaller </P>

<P>segments. </P>

<P> </P>

<P>Segmentation Context. Information that allows a receiver to associate a particular packet with the correct PDU. </P>

<P> </P>

<P>Sender. The RapidIO interface output port on a processing element. </P>

<P> </P>

<P>Sequence. Sequentially ordered, uni-directional group of messages that constitute the basic unit of data delivered from one end point to another. </P>

<P> </P>

<P>StreamID. A specific field in the data streaming protocol that is combined with the data stream&#8217;s transaction request flow ID and the sourceID or destinationID from the underlying packet transport fabric to form the virtual stream ID. </P>

<P> </P>

<P>Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on one of its input ports to one of its output ports. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1935.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P>Transaction request flow. A sequence of transactions between two processing elements that have a required completion order at the destination processing element. There are no ordering requirements between transaction request flows. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1936.jpg"/>
</Figure>

<P>V Virtual Stream ID (VSID). An identifier comprised of several fields in the protocol to identify individual data streams. </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 61 </P>

<P>RapidIO Part 10: Data Streaming Logical Specification Rev. 2.2 </P>

<P> </P>

<P>Virtual input Queue (ViQ), Virtual output Queue (VoQ). An intermediate point in the system where one or more virtual streams may be concentrated. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1937.jpg"/>
</Figure>

<P>W Word. A four byte or 32 bit quantity, aligned on four byte boundaries. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>62 RapidIO Trade Association </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1938.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 11: Multicast Extensions Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1939.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>First release </P>
</TD>

<TD>
<P>06/09/2004 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3.1 </P>
</TD>

<TD>
<P>Technical changes: </P>

<P>the following new features showings: </P>

<P>04-08-00015.003 </P>

<P>Converted to ISO-friendly templates </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: errata showing 06-02-00001.005 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>MM/DD/20Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction............................................................................................................. 9 </P>

<P>1.2 Overview................................................................................................................. 9 </P>

<P>1.3 Requirements ........................................................................................................ 10 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Multicast Extensions Behavior </P>

<P> </P>

<P>2.1 Introduction........................................................................................................... 11 </P>

<P>2.2 Packet Replication ................................................................................................ 11 </P>

<P>2.3 Multicast Operation .............................................................................................. 11 </P>

<P>2.4 Multicast Transaction Ordering Requirements ..................................................... 15 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Multicast Extensions Registers </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 17 </P>

<P>3.2 Processing Elements Features CAR (Configuration Space Offset 0x10) ............. 18 </P>

<P>3.3 Switch Multicast Support CAR (Configuration Space Offset 0x30).................... 19 </P>

<P>3.4 Switch Multicast Information CAR (Configuration Space Offset 0x38) ............. 20 </P>

<P>3.5 Multicast Mask Port CSR (Configuration Space Offset 0x80)............................. 21 </P>

<P>3.6 Multicast Associate Select CSR (Configuration Space Offset 0x84) ................... 22 </P>

<P>3.7 Multicast Associate Operation CSR (Configuration Space Offset 0x88)............. 23 </P>

<P> </P>

<P> </P>

<P>Chapter 4 Configuration Examples </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 25 </P>

<P>4.2 Configuring Multicast Masks ............................................................................... 25 </P>

<P>4.2.1 Clearing Multicast Masks ................................................................................. 25 </P>

<P>4.2.2 Assigning Ports to Multicast Masks ................................................................. 26 </P>

<P>4.2.3 Removing a Port from a Multicast Mask.......................................................... 26 </P>

<P>4.2.4 Querying a Multicast Mask............................................................................... 26 </P>

<P>4.3 Simple Association ............................................................................................... 27 </P>

<P>4.3.1 Restrictions on Block Size ................................................................................ 27 </P>

<P>4.3.2 Restrictions on Block Associate ....................................................................... 28 </P>

<P>4.3.3 Restrictions on Associations ............................................................................. 28 </P>

<P>4.4 Configuring Associations ..................................................................................... 28 </P>

<P>4.4.1 Basic Association.............................................................................................. 28 </P>

<P>4.4.2 Using Per-Ingress Port Association .................................................................. 29 </P>

<P>4.4.3 Using Block Association .................................................................................. 30 </P>

<P>4.4.4 Using Per-Ingress Port and Block Association................................................. 31 </P>

<P>4.4.5 Removing a Destination ID to Multicast Mask Association ............................ 32 </P>

<P>4.4.6 Querying an Association................................................................................... 32 </P>

<P> </P>

<P>RapidIO Trade Association 3 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Annex A  End Point Considerations (Informative) </P>

<P> </P>

<P>A.1 Introduction........................................................................................................... 37 </P>

<P>A.2 Multicast Destination ID....................................................................................... 37 </P>

<P>A.3 End Point Multicast Channels............................................................................... 37 </P>

<P> </P>

<P> </P>

<P>Annex B  Multicast Applications (Informative) </P>

<P> </P>

<P>B.1 Introduction........................................................................................................... 39 </P>

<P>B.2 Example 1 - Static Multicast Masks ..................................................................... 40 </P>

<P>B.3 Example 2 - Linking Multicast Masks to Destination IDs ................................... 47 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>2-1 Multicast System Example .............................................................................................12 </P>

<P>2-2 Multicast Association Example ......................................................................................13 </P>

<P>2-3 Multicast Configuration Example...................................................................................14 </P>

<P>4-1 Example System using Multicast....................................................................................39 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>3-1 Multicast Register Map...................................................................................................17 </P>

<P>3-2 Bit Settings for Processing Elements Features CAR ......................................................18 </P>

<P>3-3 Bit Settings for Switch Multicast Support CAR .............................................................19 </P>

<P>3-4 Bit Settings for Switch Multicast Information CAR ......................................................20 </P>

<P>3-5 Bit Settings for Multicast Mask Port CSR ......................................................................21 </P>

<P>3-6 Bit Settings for Multicast Associate Select CSR ............................................................22 </P>

<P>3-7 Bit Settings for Multicast Associate Operation CSR ......................................................23 </P>

<P>4-1 Multicast Masks for Switch A1 ......................................................................................40 </P>

<P>4-2 Multicast Masks for Switch B1 ......................................................................................41 </P>

<P>4-3 Multicast Masks for Switch B2 ......................................................................................43 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>This chapter provides an overview of the RapidIO Part 11: Multicast Extensions Specification. The goal of this specification is to add a simple mechanism to the existing RapidIO specifications that provides multicast functionality to a system. This specification assumes that the reader has a working understanding of the other RapidIO specifications. Implementation of this specification is optional. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>The concept of duplicating a single message and sending it to multiple selected destinations is known as &#8216;multicast&#8217;, and is found to be useful in many computing systems. This can be accomplished by a variety of means. The most efficient and highest performance method is to have hardware support for the duplication of messages. </P>

<P> </P>

<P>Within a RapidIO system, the ability to duplicate messages should scale with the number of end points in a system. Since the number of end points scales with the number of switches in the system, the multicast extensions are defined for switches only and end points are largely unaffected. Possible end point design considerations are described in Annex A. </P>

<P> </P>

<P>The multicast specification is limited to request transactions that do not require responses, for example, RapidIO Part 1: Input/Output Logical Specification SWRITE transactions. This is because implementing support for collecting the response transactions within a switch device, which are typically not aware of RapidIO logical layer protocols, is problematic and complex. </P>

<P> </P>

<P>The ability for a switch to send a single message to a variety of destinations can be implemented in a wide variety of ways, depending on system needs. There are two reasons, however, that motivate definition of a common interface and behavior for multicast in a system. Without a standard interface and behavioral definition, the wide variety of possible implementations would not allow a common multicast software driver to exist. The second reason is that without a standard definition for interface and behavior it is impossible to guarantee inter-operability of different components which support multicast. </P>

<P> </P>

<P>In defining a common interface for a wide variety of implementations, it is necessary </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>to define the standard interface with some level of abstraction in order to avoid limiting implementation flexibility. Therefore, several examples of the use of the interface have been included. </P>

<P> </P>

<P> </P>

<P>1.3 Requirements </P>

<P> </P>

<P>The multicast mechanism shall fulfill the following goals: </P>

<P> </P>

<P>&#8226; Simple - excess complexity will not gain acceptance </P>

<P>&#8226; Compact - Does not cost excessive silicon area in a switch </P>

<P>&#8226; Robust - same level of protection and recovery as the rest of RapidIO </P>

<P>&#8226; Scalable - must be able to extend to multi-layer switch systems </P>

<P>&#8226; Compatibility with all physical layers </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Multicast Extensions Behavior </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This chapter describes the multicast extensions rules of operation in a RapidIO system. A RapidIO switch which does not support multicast can co-exist in a RapidIO fabric with other switches that do support multicast. The only requirement is that the switch be capable of routing the destination IDs used for multicast transactions. </P>

<P> </P>

<P> </P>

<P>2.2 Packet Replication </P>

<P> </P>

<P>A RapidIO multicast operation consists of the replication of a single packet so that it can be received by multiple end points. This replication is performed by the switch devices in the fabric rather than by the end point itself, so that the capability to replicate packets expands with the number of switches (and hence possible end points) in a system. Each switch may be individually programmed to control which egress ports of the switch the replicated packets are sent to, and thus indirectly which specific set of end point devices receive the replicated packet. The packets themselves are not modified by the replication process, merely transmitted out through the appropriate ports. </P>

<P> </P>

<P>This specification only addresses multicasting request packets for transactions which do not require responses. This greatly simplifies multicast support for RapidIO switches, which will therefore have no need to aggregate responses from other types of RapidIO operations. Examples of transactions which can be multicast are I/O logical specification NWRITE and SWRITE transactions. Multicasting transactions which require responses have implementation defined behavior. </P>

<P> </P>

<P> </P>

<P>2.3 Multicast Operation </P>

<P> </P>

<P>Multicast operations have two control value types - multicast masks and multicast groups. The set of target end points which all receive a particular multicast packet is known as a multicast group. Each multicast group is associated with a unique destination ID. The destination ID of a received packet allows a RapidIO switch device to determine that a packet is to be replicated for a multicast. </P>

<P> </P>

<P>A multicast mask is a value that controls which egress ports one or more multicast groups are associated with. Conceptually, a multicast mask is a register with one </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>enable bit for each possible switch egress port. There is one set of multicast masks for the entire switch. All multicast masks in a switch are assigned unique sequential ID numbers beginning with 0. Figure 2-1 shows an example of the use of multicast in a RapidIO system. </P>

<P> </P>

<P> </P>

<P> </P>

<P>End point dest. ID=0x10 </P>

<P>End point dest. ID=0x15 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>End point </P>

<P>Switch M </P>

<P>Port 1 </P>

<P>Switch N </P>

<P>Port 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>End point </P>

<P> </P>

<P>dest. ID=0x0 </P>

<P>Port 0 </P>

<P>Port 2 </P>

<P>Port 0 </P>

<P>Port 2 </P>

<P>dest. ID=0x16 </P>

<P> </P>

<P>Port 3 </P>

<P>Port 3 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>End point dest. ID=0x12 </P>

<P>End point dest. ID=0x17 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1940.jpg"/>
</Figure>

<P>Figure 2-1. Multicast System Example </P>

<P> </P>

<P>In this example, the end point assigned destination ID 0x0 uses destination ID 0x80 to perform multicast operations to the multicast group comprised of end points 0x10, </P>

<P>0x15, 0x16, and 0x17, arbitrarily called group A. Software configures the switch devices in the fabric to associate the destination IDs that represent multicast groups with multicast masks. For Figure 2-1 switch M associates destination ID 0x80 with egress ports 1 and 2, and switch N associates destination ID 0x80 with ports 1, 2, and 3. Figure 2-2 shows a possible relationship between the multicast group, the multicast masks for the switches, and the global system address map. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>

<P>Port 2 </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD/>

<TD/>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Switch M dest. ID lookup table </P>

<P>System address map </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1941.jpg"/>
</Figure>

<P>Port 1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1942.jpg"/>
</Figure>

<P> </P>

<P>dest. ID=0x10 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1943.jpg"/>
</Figure>

<P>dest. ID=0x15-17 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1944.jpg"/>
</Figure>

<P>dest. ID=0x80 </P>

<P>Group A </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1945.jpg"/>
</Figure>

<P>Switch N dest. ID lookup table </P>

<P>System address map </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>dest. ID=0x80 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Group A </P>

<P>Port 1 </P>

<P>Port 2 </P>

<P>Port 3 </P>

<P> </P>

<P>dest. ID=0x15 dest. ID=0x16 dest. ID=0x17 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 2-2. Multicast Association Example </P>

<P> </P>

<P>Configuring a RapidIO switch to replicate packets for a multicast group is a two-step process. First, a list of egress ports is set in a multicast mask list. Second, one or more destination IDs which represent the multicast groups are associated with the multicast mask in the switch. During normal system operation, any time a switch receives a packet with a destination ID which has been associated with a multicast mask it will send that packet to all egress ports enabled by that multicast mask. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1946.jpg"/>
</Figure>

<P>Multicast Group </P>

<P> </P>

<P> </P>

<P> </P>

<P>Control Unit </P>

<P>Port 0 </P>

<P>dest. ID=0x80 </P>

<P> </P>

<P>Switch </P>

<P>Destination A, Port 1 </P>

<P>Destination B, Port 2 </P>

<P>Destination C, Port 3 </P>

<P>Destination D, Port 4 </P>

<P> </P>

<P> </P>

<P> </P>

<P>Multicast Mask 2 </P>

<P>Port 0 excluded </P>

<P>Port 1,2,3,4 included </P>

<P>Associated to dest. ID 0x80 </P>

<P> </P>

<P>Figure 2-3. Multicast Configuration Example </P>

<P> </P>

<P>Figure 2-3 shows a control unit connected to switch port 0 which needs to multicast to destinations A, B, C and D. A multicast mask, in this case arbitrarily picked as multicast mask 2, is set up to select which ports in the switch are part of the multicast group of destinations A, B, C, and D. A destination ID, in this case arbitrarily assigned 0x80, is associated with multicast mask 2 as the destination ID that the control unit should use to multicast to the multicast group. The associate operation is done using the CSRs defined in Chapter 3, &#8220;Multicast Extensions Registers&#8221;. </P>

<P> </P>

<P>The defined CSRs allow a switch to associate destination IDs with multicast masks using a small number of maintenance write operations. The number of unique destination IDs that can be associated with a multicast mask is also defined in a CSR. </P>

<P> </P>

<P>While each destination ID is associated with a unique multicast group, the programming model allows a destination ID to be mapped to a different multicast mask for each port on the switch. However, for each port a destination ID can be associated with at most one multicast mask. The last association operation performed for a specific port and destination ID dictates which multicast mask the destination ID is associated with. It is also possible to map a given destination ID to the same multicast mask for all ports. </P>

<P> </P>

<P>A RapidIO switch may be capable of supporting large numbers of multicast groups by dedicating a sequential range of destination ID&#8217;s to an equal number of sequentially numbered multicast masks. A switch may also be designed which does not require all multicast destination IDs to be sequential. The programming model supports both of these implementations. </P>

<P> </P>

<P>A packet will never be multicast back out of the port it was received on even if it is included in the multicast mask for that destination ID. This allows a group of end points which need to multicast to each other to share the same multicast mask. Packets using a multicast mask which has no egress ports selected will be dropped without error notification. A device may have implementation specific error notification in this situation, depending on system requirements. </P>

<P> </P>

<P>14 RapidIO Trade Association </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>The default state after a reset for multicast masks is that all multicast masks have no ports selected. Additionally, after reset no associations exist between any multicast group/destination ID and the multicast masks. However, implementation specific capabilities may modify the multicast mask values and associations after reset without software intervention. </P>

<P> </P>

<P>For more information and examples on the use of the programming model for multicast refer to Annex B, &#8220;Multicast Applications (Informative)&#8221;. </P>

<P> </P>

<P> </P>

<P>2.4 Multicast Transaction Ordering Requirements </P>

<P> </P>

<P>RapidIO packets which are in the same multicast group (the same destination ID) with the same flowID and are received on the same ingress port must be multicast on the egress ports in the same order that they were received. There are no ordering requirements between multicast packets and non-multicast packets, or between multicast packets in different multicast groups. Maintaining ordering between transactions in the same transaction request flow for a multicast group allows an application to multicast a completion flag at the end of a potentially large data transfer which was sent to the same multicast group. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Multicast Extensions Registers </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>This section describes the Multicast Extensions CAR and CSR registers that allow an external processing element to determine if a switch supports the multicast extensions defined in this specification, and to manage the configuration of multicast groups for a switch processing element. This chapter only describes registers or register bits defined by this specification. Refer to the other RapidIO logical, transport, physical, and extension specifications of interest to determine a complete list of registers and bit definitions for a device. All registers are 32-bits and aligned to a 32-bit boundary. The behavior of reserved register bits and register offsets and access rules and requirements are described in the RapidIO Part 1: Input/Output Logical Specification. </P>

<P> </P>

<P>Table 3-1. Multicast Register Map </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Configuration Space Byte Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0-C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10 </P>
</TD>

<TD>
<P>Processing Element Features CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x14-2C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x30 </P>
</TD>

<TD>
<P>Switch Multicast Support CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x34 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x38 </P>
</TD>

<TD>
<P>Switch Multicast Information CAR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x3C-7C </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x80 </P>
</TD>

<TD>
<P>Multicast Mask Port CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x84 </P>
</TD>

<TD>
<P>Multicast Associate Select CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x88 </P>
</TD>

<TD>
<P>Multicast Associate Operation CSR </P>
</TD>
</TR>

<TR>
<TD>
<P>0x8C&#8211;FC </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>0x100&#8211;&#61472;&#61472;</P>

<P>FFFC </P>
</TD>

<TD>
<P> </P>

<P>Extended Features Space </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10000&#8211;&#61472;&#61472;</P>

<P>FFFFFC </P>
</TD>

<TD>
<P> </P>

<P>Implementation-defined Space </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>3.2 Processing Elements Features CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x10) </P>

<P> </P>

<P>The Processing Elements Features CAR contains 31 processing elements features bits defined in various RapidIO specifications, as well as the Multicast Support bit, defined here. </P>

<P> </P>

<P>Table 3-2. Bit Settings for Processing Elements Features CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-20 </P>
</TD>

<TD>
<P>- </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>

<TR>
<TD>
<P>21 </P>
</TD>

<TD>
<P>Multicast Support </P>
</TD>

<TD>
<P>* </P>
</TD>

<TD>
<P>Support for multicast extensions </P>

<P>0b0 - Does not support multicast extensions&#61472;&#61472;</P>

<P>0b1 - Supports multicast extensions </P>
</TD>
</TR>

<TR>
<TD>
<P>22-31 </P>
</TD>

<TD>
<P>- </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>
</Table>

<P> </P>

<P>* Implementation dependant </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>3.3 Switch Multicast Support CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x30) </P>

<P> </P>

<P>The Switch Multicast Support CAR defines support for a simple multicast model and the additional limits on multicast mask resources. </P>

<P> </P>

<P>Table 3-3. Bit Settings for Switch Multicast Support CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Simple_Assoc </P>
</TD>

<TD>
<P>* </P>
</TD>

<TD>
<P>Support for a simple multicast association model </P>

<P>0b0 - Does not support simple association&#61472;&#61472;</P>

<P>0b1 - Supports simple association </P>

<P>If this bit is set, the Block_Assoc bit in the Switch Multicast Information </P>

<P>CAR must also be set. </P>
</TD>
</TR>

<TR>
<TD>
<P>1-31 </P>
</TD>

<TD>
<P>- </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Reserved (defined elsewhere) </P>
</TD>
</TR>
</Table>

<P> </P>

<P>* Implementation dependant </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>3.4 Switch Multicast Information CAR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x38) </P>

<P> </P>

<P>The Switch Multicast Information CAR defines the methods for associating destination IDs with multicast masks supported by a RapidIO switch device. It also defines the limits on multicast mask resources. </P>

<P> </P>

<P>Table 3-4. Bit Settings for Switch Multicast Information CAR </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bits </P>
</TD>

<TD>
<P>Name </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>Block_Assoc </P>
</TD>

<TD>
<P>Block association support - allows equal sized blocks of destination IDs and multicast masks to be associated with each other with a single operation rather than one at a time. </P>

<P>0b0 - block association is not supported&#61472;&#61472;</P>

<P>0b1 - block association is supported </P>

<P>If the Simple_Assoc bit in the Switch Multicast Support CAR is set, this bit must also be set. </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Per_Port_Assoc </P>
</TD>

<TD>
<P>Per ingress port association support - allows a destination ID to be associated with a multicast mask on a per-ingress port basis rather than a single association for the entire switch. </P>

<P>0b0 - per port association is not supported&#61472;&#61472;</P>

<P>0b1 - per port association is supported </P>
</TD>
</TR>

<TR>
<TD>
<P>2-15 </P>
</TD>

<TD>
<P>MaxDestIDAssoc </P>
</TD>

<TD>
<P>The maximum number of destination IDs associations per multicast mask </P>

<P>0x0000 - 1 destination ID&#61472;&#61472;</P>

<P>0x0001 - 2 destination IDs&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x3FFF - 16384 destination IDs </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>MaxMcastMasks </P>
</TD>

<TD>
<P>The number of multicast egress port masks available. This field also defines the largest block of destination IDs that can be block associated. </P>

<P>0x0000 - [reserved]&#61472;&#61472;</P>

<P>0x0001 - 1 multicast mask&#61472;&#61472;</P>

<P>0x0002 - 2 multicast masks&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xFFFF - 65535 multicast masks </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>3.5 Multicast Mask Port CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x80) </P>

<P> </P>

<P>The Multicast Mask Port CSR allows configuration of the egress port list for each of the switch&#8217;s multicast masks. </P>

<P> </P>

<P>Writing the Write_to_Verify command sets up a Mcast_Mask and Egress_Port_Num pair to verify. The presence of the specified egress port in the specified multicast mask is indicated by the Port_Present bit on a subsequent read of the register. </P>

<P> </P>

<P>Writing the Add_Port or Delete_Port commands adds or deletes the specified egress port to or from the specified multicast mask. </P>

<P> </P>

<P>Writing the Add_All_Ports or Delete_All_Ports commands adds or deletes all of the egress ports in the specified multicast mask. </P>

<P> </P>

<P>The result of illegal values or combinations for an operation is implementation dependent.  For  examples  of  how  to  use  this  register,  refer  to  Section 4.2, &#8220;Configuring Multicast Masks&#8221;. </P>

<P> </P>

<P>Table 3-5. Bit Settings for Multicast Mask Port CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>Mcast_Mask </P>
</TD>

<TD>
<P>0x0000 </P>
</TD>

<TD>
<P>Specifies the multicast mask which is to be modified or queried as determined by the Mask_Cmd field. </P>
</TD>
</TR>

<TR>
<TD>
<P>16-23 </P>
</TD>

<TD>
<P>Egress_Port_Num </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Specifies the port number to be added, deleted, or queried with the Mask_Cmd field. </P>
</TD>
</TR>

<TR>
<TD>
<P>24 </P>
</TD>

<TD>
<P>- </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>25-27 </P>
</TD>

<TD>
<P>Mask_Cmd </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Specifies the mask action on a write. </P>

<P>0b000 - Write_to_Verify&#61472;&#61472;</P>

<P>0b001 - Add_Port&#61472;&#61472;</P>

<P>0b010 - Delete_Port&#61472;&#61472;</P>

<P>0b011 - reserved&#61472;&#61472;</P>

<P>0b100 - Delete_All_Ports&#61472;&#61472;</P>

<P>0b101 - Add_All_Ports&#61472;&#61472;</P>

<P>0b110 - reserved&#61472;&#61472;</P>

<P>0b111 - reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>28&#8211;30 </P>
</TD>

<TD>
<P>- </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>Reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Port_Present </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>Indicates the existence of the egress port and multicast mask pair as a result of the last preceding Write_to_Verify command. </P>

<P>0b0 - Port was not enabled as an egress port in the specified multicast mask&#61472;&#61472;</P>

<P>0b1 - Port was enabled as an egress port in the specified multicast mask. This bit is reserved on a write. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>3.6 Multicast Associate Select CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x84) </P>

<P> </P>

<P>This register specifies the destination ID and multicast mask number for a subsequent associate operation controlled with the Multicast Associate Operation CSR. If block association is supported, this register specifies the start of the block to associate.  For  examples  of  how  this  register  is  used,  refer  to  Section 4.4, &#8220;Configuring Associations&#8221;. </P>

<P> </P>

<P>Table 3-6. Bit Settings for Multicast Associate Select CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-7 </P>
</TD>

<TD>
<P>Large_DestID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Selects the most significant byte of a large transport destination ID for an association operation </P>
</TD>
</TR>

<TR>
<TD>
<P>8-15 </P>
</TD>

<TD>
<P>DestID </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>Selects the destination ID for an association operation </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>Mcast_Mask_Num </P>
</TD>

<TD>
<P>0x0000 </P>
</TD>

<TD>
<P>Selects the multicast mask number for an association operation </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>3.7 Multicast Associate Operation CSR&#61472;&#61472;</P>

<P>(Configuration Space Offset 0x88) </P>

<P> </P>

<P>The Multicast Associate Operation CSR specifies three operations for associating destination IDs with multicast masks. The affected destination ID and multicast mask is specified in the Multicast Associate Select CSR. The specified operation is executed when this register is written. When this register is read and the Assoc_Cmd field it set to Write_to_Verify the specified operation is executed and the updated register state is returned. If this register is read and the Assoc_Cmd field is not set to Write_to_Verify the resulting behavior is implementation dependent. Block association operations assign associations sequentially starting with the destination ID and multicast mask specified in the Multicast Associate Select CSR. </P>

<P> </P>

<P>Writing the Write_To_Verify command checks for an association between the destination ID and multicast mask specified in the Multicast Associate Select CSR. The result of the check is indicated by the state of the Assoc_Present bit on a read of this register. This command cannot be executed on a block. </P>

<P> </P>

<P>Writing the Add_Assoc or Delete_Assoc command adds or deletes the association between the destination ID and the multicast mask (or block of associations, if block association is supported) specified in the Multicast Associate Select CSR. </P>

<P> </P>

<P>The result of illegal values or field combinations for an association operation is implementation dependent. For examples of how this register is used, refer to Section 4.4, &#8220;Configuring Associations&#8221;. </P>

<P> </P>

<P>Table 3-7. Bit Settings for Multicast Associate Operation CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>Assoc_Blksize </P>
</TD>

<TD>
<P>0x0000 </P>
</TD>

<TD>
<P>This field specifies the number of sequential DestinationIDs to be associated with an equal number of sequential multicast mask numbers if block association is supported. This field is ignored on a Write_to_Verify command. </P>

<P>0x0000 - one association&#61472;&#61472;</P>

<P>0x0001 - two sequential associations&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0xFFFF - 65536 sequential associations </P>
</TD>
</TR>

<TR>
<TD>
<P>16-23 </P>
</TD>

<TD>
<P>Ingress_Port </P>
</TD>

<TD>
<P>0x00 </P>
</TD>

<TD>
<P>This field specifies the ingress port association to affect if per-port ingress association is supported </P>
</TD>
</TR>

<TR>
<TD>
<P>24 </P>
</TD>

<TD>
<P>Large_Transport </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0 - the association is for small transport destination IDs </P>

<P>0b1 - the association is for large transport destination IDs </P>
</TD>
</TR>

<TR>
<TD>
<P>25-26 </P>
</TD>

<TD>
<P>Assoc_Cmd </P>
</TD>

<TD>
<P>0b00 </P>
</TD>

<TD>
<P>This field specifies the command to execute when this register is written. </P>

<P>0b00 - Write_To_Verify&#61472;&#61472;</P>

<P>0b01 - reserved&#61472;&#61472;</P>

<P>0b10 - Delete_Assoc&#61472;&#61472;</P>

<P>0b11 - Add_Assoc </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 3-7. Bit Settings for Multicast Associate Operation CSR (Continued) </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bits </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>27-30 </P>
</TD>

<TD>
<P>- </P>
</TD>

<TD>
<P>0b0000 </P>
</TD>

<TD>
<P>reserved </P>
</TD>
</TR>

<TR>
<TD>
<P>31 </P>
</TD>

<TD>
<P>Assoc_Present </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>This bit contains the result of the last Write_to_Verify command executed. </P>

<P>0b0 - no association present&#61472;&#61472;</P>

<P>0b1 - association present </P>

<P>This bit is reserved on write. </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Configuration Examples </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>

<P>This chapter provides several examples of how to use the multicast programming interface. The given examples build upon each other while proceeding through the sections. References to the order of operations within the examples run from the top of a list to the bottom unless otherwise stated. </P>

<P> </P>

<P>Initially assume a switch with 8 ports which supports 4 or more multicast masks with two or more destination IDs allowed per multicast group so that a total of 8 destination IDs minimum can be associated with the multicast masks. The system has the following requirements: </P>

<P>&#8226; Three sources of traffic (ports 0, 1, and 2) must be multicast to two destinations </P>

<P>(ports 6 and 7). </P>

<P>&#8226; Three ports (ports 3, 4 and 5) need to multicast signals between each other. </P>

<P>&#8226; All ports occasionally need to multicast to every other port. </P>

<P> </P>

<P>Assume that the switch does not require any other multicast functions and therefore multicast masks 0, 1, and 2 will be used. </P>

<P> </P>

<P> </P>

<P>4.2 Configuring Multicast Masks </P>

<P> </P>

<P>This section discusses assigning an egress port list to a multicast mask. </P>

<P> </P>

<P> </P>

<P>4.2.1  Clearing Multicast Masks </P>

<P> </P>

<P>Suppose that the state of the multicast masks is unknown, and therefore the masks must be cleared before being configured. In order to clear the masks the following register accesses are made. (The accesses to the Multicast Mask Port CSR can be performed in any order.) </P>

<P>&#8226; Remove all ports from multicast mask 0 </P>

<P>&#8212; Write the value 0x0000_0040 to the Multicast Mask Port CSR </P>

<P>&#8226; Remove all ports from multicast mask 1 </P>

<P>&#8212; Write the value 0x0001_0040 to the Multicast Mask Port CSR </P>

<P>&#8226; Remove all ports from multicast mask 2 </P>

<P>&#8212; Write the value 0x0002_0040 to the Multicast Mask Port CSR </P>

<P> </P>

<P>RapidIO Trade Association 25 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.2.2  Assigning Ports to Multicast Masks </P>

<P> </P>

<P>To configure mask 0 to multicast to ports 6 and 7, mask 1 to multicast to ports 3, 4 and 5, and mask 2 to multicast to every port, requires the following series of register accesses. (The accesses to the Multicast Mask Port CSR can be performed in any order.) </P>

<P>&#8226; Add port 6 to multicast mask 0 </P>

<P>&#8212; Write the value 0x0000_0610 to the Multicast Mask Port CSR </P>

<P>&#8226; Add port 7 to multicast mask 0 </P>

<P>&#8212; Write the value 0x0000_0710 to the Multicast Mask Port CSR </P>

<P>&#8226; Add port 3 to multicast mask 1 </P>

<P>&#8212; Write the value 0x0001_0310 to the Multicast Mask Port CSR </P>

<P>&#8226; Add port 4 to multicast mask 1 </P>

<P>&#8212; Write the value 0x0001_0410 to the Multicast Mask Port CSR </P>

<P>&#8226; Add port 5 to multicast mask 1 </P>

<P>&#8212; Write the value 0x0001_0510 to the Multicast Mask Port CSR </P>

<P>&#8226; Add all ports to multicast mask 2 </P>

<P>&#8212; Write the value 0x0002_0050 to the Multicast Mask Port CSR </P>

<P> </P>

<P> </P>

<P>4.2.3  Removing a Port from a Multicast Mask </P>

<P> </P>

<P>Suppose that the device attached to port 4 needs to be removed from the system. The following register accesses are used to modify multicast masks 1 and 2 to stop port </P>

<P>4 from being a multicast destination. (The accesses may be performed in any order.) </P>

<P> </P>

<P>&#8226; Remove port 4 from multicast mask 1 </P>

<P>&#8212; Write the value 0x0001_0420 to the Multicast Mask Port CSR </P>

<P>&#8226; Remove port 4 from multicast mask 2 </P>

<P>&#8212; Write the value 0x0002_0420 to the Multicast Mask Port CSR </P>

<P> </P>

<P> </P>

<P>4.2.4  Querying a Multicast Mask </P>

<P> </P>

<P>In this section suppose that a system designer needs to determine which of the 8 ports are included in multicast mask 2. The following accesses are to be performed to provide this information. (In each case, the write operation setting up the &#8216;Write to Verify&#8217; operation must be performed before the subsequent read to check the Port Present bit status. The individual multicast masks may be queried in any order.) </P>

<P>&#8226; Verify that port 0 is included in mask 2 </P>

<P>&#8212; Write the value 0x0002_0000 to the Multicast Mask Port CSR </P>

<P>&#8212; Read the value 0x0002_0001 from the Multicast Mask Port CSR </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; Verify that port 1 is included in mask 2 </P>

<P>&#8212; Write the value 0x0002_0100 to the Multicast Mask Port CSR </P>

<P>&#8212; Read the value 0x0002_0101 from the Multicast Mask Port CSR. </P>

<P>&#8226; Verify that port 2 is included in mask 2 </P>

<P>&#8212; Write the value 0x0002_0200 to the Multicast Mask Port CSR </P>

<P>&#8212; Read the value 0x0002_0201 from the Multicast Mask Port CSR </P>

<P>&#8226; Verify that port 3 is included in mask 2 </P>

<P>&#8212; Write the value 0x0002_0300 to the Multicast Mask Port CSR </P>

<P>&#8212; Read the value 0x0002_0301 from the Multicast Mask Port CSR </P>

<P>&#8226; Verify that port 4 is not included in mask 2 </P>

<P>&#8212; Write the value 0x0002_0400 to the Multicast Mask Port CSR </P>

<P>&#8212; Read the value 0x0002_0400 from the Multicast Mask Port CSR </P>

<P>&#8226; Verify that port 5 is included in mask 2 </P>

<P>&#8212; Write the value 0x0002_0500 to the Multicast Mask Port CSR </P>

<P>&#8212; Read the value 0x0002_0501 from the Multicast Mask Port CSR </P>

<P>&#8226; Verify that port 6 is included in mask 2 </P>

<P>&#8212; Write the value 0x0002_0600 to the Multicast Mask Port CSR </P>

<P>&#8212; Read the value 0x0002_0601 from the Multicast Mask Port CSR </P>

<P>&#8226; Verify that port 7 is included in mask 2 </P>

<P>&#8212; Write the value 0x0002_0700 to the Multicast Mask Port CSR </P>

<P>&#8212; Read the value 0x0002_0701 from the Multicast Mask Port CSR </P>

<P> </P>

<P> </P>

<P>4.3 Simple Association </P>

<P> </P>

<P>If the Simple_Assoc bit is set in the Switch Multicast Support CAR, the device supports the simple multicast programming model. This model allows for basic multicast support for devices with a limited number of multicast masks, and requires a fixed relationship between those masks and sequential multicast groups. </P>

<P> </P>

<P> </P>

<P>4.3.1  Restrictions on Block Size </P>

<P> </P>

<P>If the Simple_Assoc bit is set the device has a limited number of masks. Therefore, the number of sequential associations equals the maximum number of masks. </P>

<P> </P>

<P>The Assoc_BlkSize field in the Multicast Associate Operation CSR must be set to the value of (MaxMCastMasks - 1). The MaxMCastMasks field is in the Switch Multicast Information CAR. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.2  Restrictions on Block Associate </P>

<P> </P>

<P>If the Simple_Assoc bit is set, non-block associations are precluded. </P>

<P> </P>

<P> </P>

<P>4.3.3  Restrictions on Associations </P>

<P> </P>

<P>If the Simple_Assoc bit is set the device requires a fixed relationship between the sequential mask numbers and sequential destination IDs. This must be taken into account when the masks are associated. </P>

<P> </P>

<P>The Multicast Associate Select CSR is set with the Mcast_Mask_num value set to </P>

<P>0x0000 and the Large_DestID and DestID fields set to an integer multiple of the </P>

<P>MaxMCastMasks value. </P>

<P> </P>

<P>Hardware that sets the new Simple_Assoc CAR bit could implement a single block associate for all of the masks that it supports with the requirement that they all be sequential destination IDs. </P>

<P> </P>

<P> </P>

<P>4.4 Configuring Associations </P>

<P> </P>

<P>This section describes how to associate destination IDs with multicast masks, including examples of how to use the block association and per-port association functions. </P>

<P> </P>

<P> </P>

<P>4.4.1  Basic Association </P>

<P> </P>

<P>For the assumed system it is now necessary to associate a destination ID with each multicast mask from the preceding examples. How this can be accomplished may vary depending on the capabilities of the switch. For this section, assume that neither block association nor per-ingress-port association is supported by the switch. </P>

<P> </P>

<P>Following upon the previous example, assume the following additional system requirements. </P>

<P>&#8226; the 16 bit destination ID 0x1234 needs to be associated with multicast mask 0. </P>

<P>&#8226; the 8 bit destination ID 0x44 needs to be associated with multicast mask 1. </P>

<P>&#8226; the 16 bit destination ID 0xFEED needs to be associated with multicast mask 2. </P>

<P> </P>

<P>In order to accomplished the desired associations, the following register accesses are required. (The individual association operations can be performed in any order.) </P>

<P>&#8226; Set up the operation to associate destination ID 0x1234 with multicast mask 0 </P>

<P>&#8212; Write the value 0x1234_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate destination ID 0x1234 with multicast mask 0 </P>

<P>&#8212; Write the value 0x0000_00E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Set up the operation to associate destination ID 0x44 with multicast mask 1 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>&#8212; Write the value 0x0044_0001 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate destination ID 0x44 with multicast mask 1 </P>

<P>&#8212; Write the value 0x0000_0060 to the Multicast Associate Operation CSR </P>

<P>&#8226; Set up the operation to associate destination ID 0xFEED with multicast mask 2 </P>

<P>&#8212; Write the value 0xFEED_0002 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 </P>

<P>&#8212; Write the value 0x0000_00E0 to the Multicast Associate Operation CSR </P>

<P> </P>

<P> </P>

<P>4.4.2  Using Per-Ingress Port Association </P>

<P> </P>

<P>For the associations discussed in the preceding section, if the switch supports per-ingress-port association (destination IDs are associated with multicast masks on a per ingress port basis), the required programming operations change. The associations for each multicast mask are grouped into a write to the Multicast Associate Select CSR, followed by a write to the Multicast Associate Operation CSR for each ingress port that must be aware of the association. (The writes to the Multicast Associate Operation CSR can occur in any order but must occur after the related writes to the Multicast Associate Select CSR. The individual association operations can be performed in any order.) </P>

<P>&#8226; Set up the operation to associate destination ID 0x1234 with multicast mask 0 </P>

<P>&#8212; Write the value 0x1234_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate destination ID 0x1234 with multicast mask 0 on ingress port 0 </P>

<P>&#8212; Write the value 0x0000_00E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0x1234 with multicast mask 0 on ingress port 1 </P>

<P>&#8212; Write the value 0x0000_01E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0x1234 with multicast mask 0 on ingress port 2 </P>

<P>&#8212; Write the value 0x0000_02E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Set up the operation to associate destination ID 0x44 with multicast mask 1 </P>

<P>&#8212; Write the value 0x0044_0001 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate destination ID 0x44 with multicast mask 1 on ingress port 3 </P>

<P>&#8212; Write the value 0x0000_0360 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0x44 with multicast mask 1 on ingress port 4 </P>

<P>&#8212; Write the value 0x0000_0460 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0x44 with multicast mask 1 on ingress port 5 </P>

<P>&#8212; Write the value 0x0000_0560 to the Multicast Associate Operation CSR </P>

<P>&#8226; Set up the operation to associate destination ID 0xFEED with multicast mask 2 </P>

<P>&#8212; Write the value 0xFEED_0002 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 on ingress port 0 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8212; Write the value 0x0000_00E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 on ingress port 1 </P>

<P>&#8212; Write the value 0x0000_01E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 on ingress port 2 </P>

<P>&#8212; Write the value 0x0000_02E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 on ingress port 3 </P>

<P>&#8212; Write the value 0x0000_03E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 on ingress port 4 </P>

<P>&#8212; Write the value 0x0000_04E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 on ingress port 5 </P>

<P>&#8212; Write the value 0x0000_05E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 on ingress port 6 </P>

<P>&#8212; Write the value 0x0000_06E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate destination ID 0xFEED with multicast mask 2 on ingress port 7 </P>

<P>&#8212; Write the value 0x0000_07E0 to the Multicast Associate Operation CSR </P>

<P> </P>

<P> </P>

<P>4.4.3  Using Block Association </P>

<P> </P>

<P>In  this  section assume that  the  switch supports block  association rather than per-ingress-port association. With this feature sequential destination IDs can be quickly associated to sequential multicast masks. In order to take advantage of this feature, different destination IDs assignments are required for the system than for the preceding examples. The starting destination 0xFF00 is arbitrarily selected. </P>

<P>&#8226; the 16 bit destination ID 0xFF00 is used to multicast from ports 0, 1 and 2 to ports 6 and 7, so destination ID 0xFF00 needs to be associated with multicast mask 0. </P>

<P>&#8226; the 16 bit destination ID 0xFF01 identifies the multicast group including ports </P>

<P>3, 4 and 5, so destination ID 0xFF01 needs to be associated with multicast mask 1. </P>

<P>&#8226; the 16 bit destination ID 0xFF02 identifies the multicast group that includes all ports, so destination ID 0xFF02 needs to be associated with multicast mask 2. </P>

<P> </P>

<P>Note that the number of accesses needed to accomplish the desired associations is reduced to two. (The accesses must be performed in the order given.) </P>

<P>&#8226; Set up the associate operation starting with destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF00_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate three sequential destination IDs starting at 0xFF00 with three sequential multicast masks starting at 0 </P>

<P>&#8212; Write the value 0x0002_00E0 to the Multicast Associate Operation CSR </P>

<P> </P>

<P>30 RapidIO Trade Association </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>4.4.4  Using Per-Ingress Port and Block Association </P>

<P> </P>

<P>Next, if both block association and per-ingress port association are supported by the switch, then the following sequence of operations is required. (The write to the Multicast Associate Select CSR must occur before the corresponding write to the Multicast Associate Operation CSR. The individual association operations can be performed in any order.) </P>

<P>&#8226; Set up the associate operations starting with destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF00_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 0 </P>

<P>&#8212; Write the value 0x0002_00E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 1 </P>

<P>&#8212; Write the value 0x0002_01E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 2 </P>

<P>&#8212; Write the value 0x0002_02E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 3 </P>

<P>&#8212; Write the value 0x0002_03E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 4 </P>

<P>&#8212; Write the value 0x0002_04E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 5 </P>

<P>&#8212; Write the value 0x0002_05E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 6 </P>

<P>&#8212; Write the value 0x0002_06E0 to the Multicast Associate Operation CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 7 </P>

<P>&#8212; Write the value 0x0002_07E0 to the Multicast Associate Operation CSR </P>

<P> </P>

<P>For this example, suppose that ingress port 4 needs a second destination ID to be mapped to each of the three multicast masks and the switch also has this capability. The second destination would be added to port 4 with the following association operation. (The write to the Multicast Associate Select CSR must occur before the write to the Multicast Associate Operation CSR. </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 31 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Set up the associate operations starting with destination ID 0xFF03 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF03_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Associate three sequential destination IDs with three sequential multicast masks for ingress port 4 </P>

<P>&#8212; Write the value 0x0002_04E0 to the Multicast Associate Operation CSR </P>

<P> </P>

<P> </P>

<P>4.4.5  Removing a Destination ID to Multicast Mask Association </P>

<P> </P>

<P>Now assume that packets from destination ID 0xFF02 on port 4 should no longer be allowed to multicast to all nodes (multicast mask 2). To remove destination ID </P>

<P>0xFF02 from being associated with multicast mask 2 on port 4, the following register accesses need to be performed in order. </P>

<P> </P>

<P>&#8226; Set up the operation to remove the association between destination ID 0xFF02 and multicast mask 2 </P>

<P>&#8212; Write the value 0xFF02_0002 to the Multicast Associate Select CSR </P>

<P>&#8226; Remove the association between destination ID 0xFF02 and multicast mask 2 on ingress port 4 </P>

<P>&#8212; Write the value 0x0000_04C0 to the Multicast Associate Operation CSR </P>

<P> </P>

<P> </P>

<P>4.4.6  Querying an Association </P>

<P> </P>

<P>There are three scenarios for querying destination ID to multicast mask associations in a switch. For the first scenario assume that a system designer wants to know which multicast masks are associated with destination ID 0xFF01 on port 4. Note that since a read of the Multicast Associate Operation CSR causes the last command written to be executed, that register is only written at the beginning of the sequence. (The individual associations can be queried in any order.) </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF01 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF01_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF01 is not associated with multicast mask 0 for port 4 </P>

<P>&#8212; Write the value 0x0000_0480 to the Multicast Associate Operation CSR </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF01 and multicast mask 2 </P>

<P>&#8212; Write the value 0xFF01_0002 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF01 is associated with multicast mask 2 for port 4 </P>

<P>&#8212; Read the value 0x0000_0481 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF01 and multicast mask 3 </P>

<P>&#8212; Write the value 0xFF01_0003 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF01 is not associated with multicast mask 3 for port 4 </P>

<P>&#8212; Read the value 0x0000_0480 from the Multicast Associate Operation </P>

<P>CSR </P>

<P> </P>

<P>For the second scenario assume that the system designer wants to know which destination IDs from 0xFF00 through 0xFF07 are associated with multicast mask 0 on Port 4. (The individual associations may be queried in any order.) </P>

<P> </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF00_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF00 is associated with multicast mask 0 for port 4 </P>

<P>&#8212; Write the value 0x0000_0480 to the Multicast Associate Operation CSR </P>

<P>&#8212; Read the value 0x0000_0480 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF01_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF01 is not associated with multicast mask 0 for port 4 </P>

<P>&#8212; Read the value 0x0000_0480 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF02_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF02 is not associated with multicast mask 0 for port 4 </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF04_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF04 is not associated with multicast mask 0 for port 4 </P>

<P>&#8212; Read the value 0x0000_0480 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF05_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF05 is associated with multicast mask 0 for port 4 </P>

<P>&#8212; Read the value 0x0000_0481 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF06_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF06 is not associated with multicast mask 0 for port 4 </P>

<P>&#8212; Read the value 0x0000_0480 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF00 and multicast mask 0 </P>

<P>&#8212; Write the value 0xFF07_0000 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF07 is not associated with multicast mask 0 for port 4 </P>

<P>&#8212; Read the value 0x0000_0480 from the Multicast Associate Operation </P>

<P>CSR </P>

<P> </P>

<P>For the last scenario assume that the system designer now wants to know whether or not destination ID 0xFF03 is mapped to multicast mask 3 on all ports. (The individual associations may be queried in any order.) </P>

<P>&#8226; Set up the associate operations for destination ID 0xFF03 and multicast mask 3 </P>

<P>&#8212; Write the value 0xFF03_0003 to the Multicast Associate Select CSR </P>

<P>&#8226; Verify that destination ID 0xFF03 is not associated with multicast mask 3 for port 0 </P>

<P>&#8212; Write the value 0x0000_0080 to the Multicast Associate Operation CSR </P>

<P>&#8212; Read the value 0x0000_0080 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Verify that destination ID 0xFF03 is not associated with multicast mask 3 for port 1 </P>

<P>&#8212; Write the value 0x0000_0180 to the Multicast Associate Operation CSR </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>&#8226; Verify that destination ID 0xFF03 is not associated with multicast mask 3 for port 2 </P>

<P>&#8212; Write the value 0x0000_0280 to the Multicast Associate Operation CSR </P>

<P>&#8212; Read the value 0x0000_0280 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Verify that destination ID 0xFF03 is associated with multicast mask 3 for port 3 </P>

<P>&#8212; Write the value 0x0000_0380 to the Multicast Associate Operation CSR </P>

<P>&#8212; Read the value 0x0000_0381 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Verify that destination ID 0xFF03 is not associated with multicast mask 3 for port 4 </P>

<P>&#8212; Write the value 0x0000_0480 to the Multicast Associate Operation CSR </P>

<P>&#8212; Read the value 0x0000_0480 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Verify that destination ID 0xFF03 is not associated with multicast mask 3 for port 5 </P>

<P>&#8212; Write the value 0x0000_0580 to the Multicast Associate Operation CSR </P>

<P>&#8212; Read the value 0x0000_0580 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Verify that destination ID 0xFF03 is not associated with multicast mask 3 for port 6 </P>

<P>&#8212; Write the value 0x0000_0680 to the Multicast Associate Operation CSR </P>

<P>&#8212; Read the value 0x0000_0680 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>&#8226; Verify that destination ID 0xFF03 is not associated with multicast mask 3 for port 7 </P>

<P>&#8212; Write the value 0x0000_0780 to the Multicast Associate Operation CSR </P>

<P>&#8212; Read the value 0x0000_0780 from the Multicast Associate Operation </P>

<P>CSR </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex A End Point Considerations </P>

<P>(Informative) </P>

<P> </P>

<P> </P>

<P>A.1 Introduction </P>

<P> </P>

<P>This appendix provides implementation considerations for end points that are intended to be used in a multicast RapidIO system. </P>

<P> </P>

<P> </P>

<P>A.2 Multicast Destination ID </P>

<P> </P>

<P>The transport layer requirement that processing elements be capable of accepting requests regardless of destinationID means that all end points are capable of accepting multicast   traffic   for   all   possible   multicast   destinationIDs.  The destinationID of a multicast request may be checked by implementation-specific means. </P>

<P> </P>

<P> </P>

<P>A.3 End Point Multicast Channels </P>

<P> </P>

<P>It may be valuable for an end point to have support for one or more multicast channels. Multicast channels are address ranges in RapidIO address space for which an end point may accept a multicast packet and possibly translate the RapidIO write address to another local address region. This is necessary if the recipient of a multicast transaction does not have valid address space at the address received. The size and quantity of multicast channels depend on the requirements of the application. It may also be necessary to link multicast channels to particular multicast groups. </P>

<P> </P>

<P>A multicast channel valid bit can be implemented to control whether an address out-of-range error occurs for a received address which falls inside a multicast channel address range. A multicast channel enable bit can control whether an end point silently ignores the packet when an address is received which falls inside the channel address range. The enable bit allows software finer control over which end points for a particular multicast ID will actually process the multicast write without modifying switch settings in the fabric. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Annex B Multicast Applications (Informative) </P>

<P> </P>

<P> </P>

<P>B.1 Introduction </P>

<P> </P>

<P>In a multi-switch RapidIO fabric, each switch which supports multicast in the fabric will have it&#8217;s own set of multicast masks. The particular multicast mask in each switch device associated with a multicast group is very likely to have a different egress port pattern enabled, depending upon where that switch is in the switch fabric topology. </P>

<P> </P>

<P>As an example, refer to the following system, where data streams entering switch A1 need to be sent to a set of destinations. There are several possible approaches to implementing this system. The first example is based on the number of different multicast groups that must be supported. Destinations are linked to a destination ID which in turn is associated with static multicast mask values. In the second example, a specific multicast mask in each switch is associated with each possible destination. The destinations are linked statically to destination IDs. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Switch </P>

<P>A1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 0 </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>Switch </P>

<P>B2 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD/>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Port 1 </P>

<P> </P>

<P>Switch </P>

<P>B1 </P>

<P>Port 0 - dest. A Port 1 - dest. B Port 2 - dest. C Port 3 - dest. D </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1947.jpg"/>
</Figure>

<P>Port 0 - dest. E Port 1 - dest. F Port 2 - dest. G Port 3 - dest. H </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1948.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1949.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1950.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1951.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>Figure 4-1. Example System using Multicast </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>B.2 Example 1 - Static Multicast Masks </P>

<P> </P>

<P>If there are 256 combinations of destinations to receive a data stream, multicast requires 256 multicast groups, associated with 256 destination IDs. This means that an 8 bit destination ID could be used, but then there would be no destination IDs left over for control traffic in the system. As a result, this example assumes that the system needs to use 16 bit destination IDs in order to support multicast. </P>

<P> </P>

<P>It is possible to use the least significant 4 bits of the 16 bit destination ID to identify which ports in Switch B1 need to be multicast to, and the next most significant 4 bits for the ports on B2. Arbitrarily selecting the value of 0x04 for the upper byte of the destination ID, then all multicast destination IDs have a format of 0x04XY, where X selects the ports in switch B2 and Y selects the ports in switch B1. </P>

<P> </P>

<P>Switch A1 therefore needs two multicast masks as shown in Table 4-1. </P>

<P> </P>

<P>Table 4-1. Multicast Masks for Switch A1 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Multicast Mask Index </P>
</TD>

<TD>
<P>Egress Ports </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>None </P>
</TD>

<TD>
<P>Associated with destination ID 0x0400, indicating that no destination is to receive this data stream. Packets multicast with destination ID of 0x0400 are dropped without notification. </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Port 0 and port 1 </P>
</TD>

<TD>
<P>Associated with destination IDs 0x04XY, where both X and Y is not 0. These represent all destination IDs which need only be multicast to both Switch B1 and switch B2. </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Destination IDs of the form 0x040Y, where Y is non-zero, or 0x04X0, where X is non zero, do not have to be replicated. They can be routed directly to either port 0 (for 0x040Y) or port 1 (0x04X0) using the standard switch routing tables since there is only a single egress port. </P>

<P> </P>

<P>Because Multicast Mask 1 must have 223 ((256 total) - (16 for X) - (16 for Y) - (1 for none)) destination IDs associated with it, the Switch Multicast Information CAR MaxDestIDAssociations field must contain a value of at least 222. In this particular case, the easiest internal implementation for the selection of packets to be multicast may be the use of a non-existent port in the routing table. For example, since Switch A1 has three ports, make use of a non-existent port value in the routing table to signify that the packet is subject to multicast. </P>

<P> </P>

<P>Switches B1 and B2 must have 16 multicast masks, each associated with a particular combination of their egress ports 0 through 3. Each multicast mask may have 16 destination IDs associated with it, so the Switch Multicast Information CAR MaxDestIDAssociations field must contain a value of at least 15. </P>

<P> </P>

<P>Table 4-2 describes which destination IDs must be associated with each multicast group for Switches B1. Note that for index 0, if the routing tables in Switch A1 are set up correctly, no packets with those multicast groups should reach switch B1. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-2. Multicast Masks for Switch B1 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Multicast Mask Index </P>
</TD>

<TD>
<P>Egress Ports </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>None </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0400&#61472;&#61472;</P>

<P>0x0410&#61472;&#61472;</P>

<P>0x0420&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E0&#61472;&#61472;</P>

<P>0x04F0 </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0401&#61472;&#61472;</P>

<P>0x0411&#61472;&#61472;</P>

<P>0x0421&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E1&#61472;&#61472;</P>

<P>0x04F1 </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0402&#61472;&#61472;</P>

<P>0x0412&#61472;&#61472;</P>

<P>0x0422&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E2&#61472;&#61472;</P>

<P>0x04F2 </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Ports 1and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0403&#61472;&#61472;</P>

<P>0x0413&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E3&#61472;&#61472;</P>

<P>0x04F3 </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Port 2 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0404&#61472;&#61472;</P>

<P>0x0414&#61472;&#61472;</P>

<P>0x0424&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E4&#61472;&#61472;</P>

<P>0x04F4 </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Ports2 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0405&#61472;&#61472;</P>

<P>0x0415&#61472;&#61472;</P>

<P>0x0425&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E5&#61472;&#61472;</P>

<P>0x04F5 </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Ports2 and 1 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0406&#61472;&#61472;</P>

<P>0x0416&#61472;&#61472;</P>

<P>0x0426&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E6&#61472;&#61472;</P>

<P>0x04F6 </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-2. Multicast Masks for Switch B1 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Multicast Mask Index </P>
</TD>

<TD>
<P>Egress Ports </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>Ports 2, 1 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0407&#61472;&#61472;</P>

<P>0x0417&#61472;&#61472;</P>

<P>0x0427&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E7&#61472;&#61472;</P>

<P>0x04F7 </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Port 3 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0408&#61472;&#61472;</P>

<P>0x0418&#61472;&#61472;</P>

<P>0x0428&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E8&#61472;&#61472;</P>

<P>0x04F8 </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Ports 3 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0409&#61472;&#61472;</P>

<P>0x0419&#61472;&#61472;</P>

<P>0x0429&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04E9&#61472;&#61472;</P>

<P>0x04F9 </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>Ports 3 and 1 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x040A&#61472;&#61472;</P>

<P>0x041A&#61472;&#61472;</P>

<P>0x042A&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04EA&#61472;&#61472;</P>

<P>0x04FA </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Ports 3, 1 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x040B&#61472;&#61472;</P>

<P>0x041B&#61472;&#61472;</P>

<P>0x042B&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04EB&#61472;&#61472;</P>

<P>0x04FB </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Ports3 and2 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x040C&#61472;&#61472;</P>

<P>0x041C&#61472;&#61472;</P>

<P>0x042C&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04EC&#61472;&#61472;</P>

<P>0x04FC </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Ports 3, 2 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x040D&#61472;&#61472;</P>

<P>0x041D&#61472;&#61472;</P>

<P>0x042D&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04ED&#61472;&#61472;</P>

<P>0x04FD </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-2. Multicast Masks for Switch B1 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Multicast Mask Index </P>
</TD>

<TD>
<P>Egress Ports </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Ports 3, 2 and 1 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x040E&#61472;&#61472;</P>

<P>0x041E&#61472;&#61472;</P>

<P>0x042E&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04EE&#61472;&#61472;</P>

<P>0x04FE </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Ports 3, 2, 1 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x040F&#61472;&#61472;</P>

<P>0x041F&#61472;&#61472;</P>

<P>0x042F&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04EF&#61472;&#61472;</P>

<P>0x04FF </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 4-2 describes which destination IDs must be associated with each multicast group for Switches B1. Note that for index 0, if the routing tables in Switch A1 are set up correctly, no packets with those multicast groups should reach switch B2. </P>

<P> </P>

<P>Table 4-3. Multicast Masks for Switch B2 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Multicast Mask Index </P>
</TD>

<TD>
<P>Egress Ports </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>None </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0400&#61472;&#61472;</P>

<P>0x0401&#61472;&#61472;</P>

<P>0x0402&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x040E&#61472;&#61472;</P>

<P>0x040F </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>Port 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0410&#61472;&#61472;</P>

<P>0x0411&#61472;&#61472;</P>

<P>0x0412&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x041E&#61472;&#61472;</P>

<P>0x041F </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Port 1 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0420&#61472;&#61472;</P>

<P>0x0421&#61472;&#61472;</P>

<P>0x0422&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x042E&#61472;&#61472;</P>

<P>0x042F </P>
</TD>
</TR>

<TR>
<TD>
<P>3 </P>
</TD>

<TD>
<P>Ports 1and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0430&#61472;&#61472;</P>

<P>0x0431&#61472;&#61472;</P>

<P>0x0432&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x043E&#61472;&#61472;</P>

<P>0x043F </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 4-3. Multicast Masks for Switch B2 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Multicast Mask Index </P>
</TD>

<TD>
<P>Egress Ports </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>4 </P>
</TD>

<TD>
<P>Port 2 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0440&#61472;&#61472;</P>

<P>0x0441&#61472;&#61472;</P>

<P>0x0442&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x044E&#61472;&#61472;</P>

<P>0x044F </P>
</TD>
</TR>

<TR>
<TD>
<P>5 </P>
</TD>

<TD>
<P>Ports2 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0450&#61472;&#61472;</P>

<P>0x0451&#61472;&#61472;</P>

<P>0x0452&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x045E&#61472;&#61472;</P>

<P>0x045F </P>
</TD>
</TR>

<TR>
<TD>
<P>6 </P>
</TD>

<TD>
<P>Ports2 and 1 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0460&#61472;&#61472;</P>

<P>0x0461&#61472;&#61472;</P>

<P>0x0462&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x046E&#61472;&#61472;</P>

<P>0x046F </P>
</TD>
</TR>

<TR>
<TD>
<P>7 </P>
</TD>

<TD>
<P>Ports 2, 1 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0470&#61472;&#61472;</P>

<P>0x0471&#61472;&#61472;</P>

<P>0x0472&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x047E&#61472;&#61472;</P>

<P>0x047F </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Port 3 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0480&#61472;&#61472;</P>

<P>0x0481&#61472;&#61472;</P>

<P>0x0482&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x048E&#61472;&#61472;</P>

<P>0x048F </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Ports 3 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x0490&#61472;&#61472;</P>

<P>0x0491&#61472;&#61472;</P>

<P>0x0492&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x049E&#61472;&#61472;</P>

<P>0x049F </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>Ports 3 and 1 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x04A0&#61472;&#61472;</P>

<P>0x04A1&#61472;&#61472;</P>

<P>0x04A2&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04AE&#61472;&#61472;</P>

<P>0x04AF </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Table 4-3. Multicast Masks for Switch B2 </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Multicast Mask Index </P>
</TD>

<TD>
<P>Egress Ports </P>
</TD>

<TD>
<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Ports 3, 1 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x04B0&#61472;&#61472;</P>

<P>0x04B1&#61472;&#61472;</P>

<P>0x04B2&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04BE&#61472;&#61472;</P>

<P>0x04BF </P>
</TD>
</TR>

<TR>
<TD>
<P>12 </P>
</TD>

<TD>
<P>Ports3 and2 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x04C0&#61472;&#61472;</P>

<P>0x04C1&#61472;&#61472;</P>

<P>0x04C2&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04CE&#61472;&#61472;</P>

<P>0x04CF </P>
</TD>
</TR>

<TR>
<TD>
<P>13 </P>
</TD>

<TD>
<P>Ports 3, 2 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x04D0&#61472;&#61472;</P>

<P>0x04D1&#61472;&#61472;</P>

<P>0x04D2&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04DE&#61472;&#61472;</P>

<P>0x04DF </P>
</TD>
</TR>

<TR>
<TD>
<P>14 </P>
</TD>

<TD>
<P>Ports 3, 2 and 1 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x04E0&#61472;&#61472;</P>

<P>0x04E1&#61472;&#61472;</P>

<P>0x04E2&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04EE&#61472;&#61472;</P>

<P>0x04EF </P>
</TD>
</TR>

<TR>
<TD>
<P>15 </P>
</TD>

<TD>
<P>Ports 3, 2, 1 and 0 </P>
</TD>

<TD>
<P>Associated with the following destination IDs: </P>

<P>0x04F0&#61472;&#61472;</P>

<P>0x04F1&#61472;&#61472;</P>

<P>0x04F2&#61472;&#61472;</P>

<P>...&#61472;&#61472;</P>

<P>0x04FE&#61472;&#61472;</P>

<P>0x04FF </P>
</TD>
</TR>
</Table>

<P> </P>

<P>It is up to the application whether either of the switch routing tables should be used for the destination IDs associated with multicast masks 1, 2, 4, and 8, as packets for these destination IDs do not have to be replicated. </P>

<P> </P>

<P>Configuring each of the 16 multicast masks for switches B1 and B2 should require a maximum of 2 writes to the Multicast Mask Load CSR. Multicast masks with one or two ports require a number of register writes equal to the number of ports. Multicast masks with three egress ports to be selected should add all of the ports and then remove the port which doesn&#8217;t belong in the multicast mask, thus requiring a maximum of two register writes. The multicast mask with all ports selected requires </P>

<P>1 register write. Thus, to configure all 16 of the multicast masks requires a maximum of (0 + (5*1) + (10*2))=25 register write operations. </P>

<P> </P>

<P>For the destination ID to multicast mask association operations for Switch B1, it </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>would make sense to implement block association operations since this would greatly reduce the amount of effort required to associate destination IDs with multicast masks. This feature makes possible in this example to associate a sequential block of 16 destination IDs with the 16 multicast masks with only 32 register writes. Refer to Table 4.4.3, &#8220;Using Block Association,&#8221; on page 30 for details of the pair of writes required for each block of 16 destination IDs. </P>

<P> </P>

<P>For the destination ID to multicast mask association operations for Switch B2 there is no pattern that leverages the programming model to speed the association of destination IDs to multicast masks. In Switch B2, it would make sense to use the regular switch routing tables rather than a multicast mask for the destination IDs associated with multicast masks 1, 2, 4 and 8 in order to minimize the number of writes required. The remaining 12 multicast groups each require 32 register write operations to complete their associations with the appropriate destination IDs, for a total of 384 writes. Designers who prefer speed of initialization over reliability may reduce this to 352 register writes by ignoring the destination IDs associated with multicast mask 0. </P>

<P> </P>

<P>For switch B2, it may make sense in some systems to implement application specific configuration registers to reduce the number of operations required for configuration. </P>

<P> </P>

<P>There can be significant limitations to using static multicast masks. Assume, of the </P>

<P>8 destinations, destinations A, B, C, D, and E are receiving one data stream using destination ID 0x041F, and destinations F, G, and H are receiving a second data stream using destination ID 0x0420. </P>

<P> </P>

<P>If destination E switches wishes to change to the second data stream, two things must happen. The destination ID for the first data stream must change from 0x041F to 0x040F in order to have the proper multicast mask for switches B1 and B2, and the destination ID for the second data stream must correspondingly change from </P>

<P>0x0420 to 0x0430. </P>

<P> </P>

<P>Because the destination IDs have changed, the switches are now allowed to reorder packets sent to destination IDs 0x041F, 0x040F, 0x0420 and 0x0430, which may change the behavior of the system in unexpected or undesirable ways. </P>

<P> </P>

<P>Another issue with static multicast masks is that the latency difference for a data stream between different destinations depends upon whether the data stream is routed using the regular switch routing table or multicast through a particular switch. The different destinations will see different performance characteristics. </P>

<P> </P>

<P>These characteristics could have undesirable side effects for latency and jitter sensitive applications like Voice over Internet Protocol (VoIP). </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>B.3 Example 2 - Linking Multicast Masks to Destination </P>

<P>IDs </P>

<P> </P>

<P>As an alternative implementation, again suppose that there are 256 possible destinations which need to be multicast, numbered 0 through 255. Each destination has a number of data streams it can receive, up to 256, which is always associated with a 16 bit destination ID of the form 0x04&lt;destination stream&gt;. This requires 256 multicast masks in switches A1, B1, and B2. </P>

<P> </P>

<P>When a destination changes the data stream it wants to receive, the multicast masks for that data stream need to be changed. First, the multicast mask in each switch associated with the stream currently being received needs to be modified to stop multicasting to this destination. Next, the multicast mask for the new data stream needs to be modified in each switch to enable multicast to that destination. </P>

<P> </P>

<P>Depending on system requirements, there are many ways to implement the multicast capabilities in this system. For example, switch A1 could always multicast all data streams to both switch B1 and switch B2. In this case, switch A1 would require 1 multicast mask that could have all 256 destination IDs associated with it. Switch B1 and B2 may receive a lot of undesired traffic in this case. </P>

<P> </P>

<P>Initial programming of the multicast masks is not a requirement as with example 1. No ports should be selected in any mask after reset. Multicast masks will be modified during system operation as destinations request to receive a particular data stream. Removing the data streams from one multicast mask and adding a data stream to a multicast mask can be performed in two register writes for each switch. </P>

<P> </P>

<P>The destination ID associations with multicast masks can be done far more effectively in this example if the switch devices support block associate operations. Refer to Section 3.4, &#8220;Switch Multicast Information CAR (Configuration Space Offset  0x38)&#8221;,  and  the  programming  examples  in  Section 4.4,  &#8220;Configuring Associations&#8221; for more information and examples. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1952.jpg"/>
</Figure>

<P>A Associate, Association. A defined relationship between a destination ID and a group of end point devices, or, in a switch, a defined relationship between a destination ID and a multicast mask. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1953.jpg"/>
</Figure>

<P>M Multicast. The concept of sending a single message to multiple destinations in a system. </P>

<P> </P>

<P>Multicast group. The group of end point devices in a system that is the target of a multicast operation. </P>

<P> </P>

<P>Multicast mask. The group of egress ports in a switch that are the targets of a replicated multicast packet. </P>

<P>RapidIO Part 11: Multicast Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Blank page </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1954.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Part 12: Virtual Output Queueing Extensions Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1955.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>First release </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Introduction </P>

<P> </P>

<P>1.1 Problem Illustration ................................................................................................ 9 </P>

<P>1.2 Terminology.......................................................................................................... 10 </P>

<P>1.3 Conventions .......................................................................................................... 10 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Overview </P>

<P> </P>

<P>2.1 Congestion Message ............................................................................................. 13 </P>

<P>2.2 Traffic Staging ...................................................................................................... 13 </P>

<P>2.3 Adding Device Independence ............................................................................... 15 </P>

<P>2.4 Relationship With Virtual Channels ..................................................................... 15 </P>

<P>2.5 Additional Queueing Considerations .................................................................... 16 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Control Symbol Format </P>

<P> </P>

<P>3.1 Stype2 Control Symbol......................................................................................... 17 </P>

<P>3.2 VC_Status Symbol Linking .................................................................................. 18 </P>

<P> </P>

<P> </P>

<P>Chapter 4 Rules </P>

<P> </P>

<P>4.1 Implementation Rules ........................................................................................... 21 </P>

<P>4.2 Rules for Generating Backpressure Control Symbols .......................................... 21 </P>

<P>4.3 Rules for Interpreting Backpressure Control Symbols ......................................... 22 </P>

<P> </P>

<P> </P>

<P>Chapter 5 Register Definitions </P>

<P> </P>

<P>5.1 VoQ Backpressure Extended Features Block ....................................................... 23 </P>

<P>5.1.1 Register Map..................................................................................................... 23 </P>

<P>5.1.2 VoQ Backpressure Control Block Registers .................................................... 24 </P>

<P>5.1.2.1 LP-Serial VC Register Block Header (Block Offset 0x0) ............................ 24 </P>

<P>5.1.2.2 Port n VoQ Control Status Register&#61472;&#61472;</P>

<P>(Block Offset - Variable, see Section 5.1.1) ..............................................25 </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>1-1 Basic Head-of-Line Blocking ...........................................................................................9 </P>

<P>1-2 Effective Backpressure ...................................................................................................10 </P>

<P>2-1 Congestion Message for a Group of Ports ......................................................................13 </P>

<P>2-2 Adding Egress Staging....................................................................................................14 </P>

<P>2-3 Mapping Staging Queues ................................................................................................15 </P>

<P>2-4 Linking VCs to VoQ Backpressure ................................................................................16 </P>

<P>3-1 Long Control Symbol Format .........................................................................................17 </P>

<P>3-2 Stype2 Control Symbol Format ......................................................................................17 </P>

<P>3-3 Linking VCs to VoQ Backpressure ................................................................................18 </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P> </P>

<P>3-1 Stype2 Symbol Format ...................................................................................................17 </P>

<P>3-2 VoQ Port Status Bits .......................................................................................................18 </P>

<P>3-3 Port Group Bits ...............................................................................................................18 </P>

<P>5-1 VoQ Register Block ........................................................................................................23 </P>

<P>5-2 Bit Settings for LP-Serial Register Block Header ..........................................................24 </P>

<P>5-3 Port n VoQ Backpressure CSR .......................................................................................25 </P>

<P>5-4 Port Status Control ..........................................................................................................25 </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>List of Tables </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Introduction </P>

<P> </P>

<P> </P>

<P>1.1 Problem Illustration </P>

<P> </P>

<P>In the basic switch model shown below, head-of-line blocking occurs when a packet for port 3 cannot be transmitted on the link because of congestion in port 2. The link effectively stalls causing the congestion in port 2 to spread to traffic on other ports. The backpressure method described here helps alleviate congestion spreading caused by transient blockages of queueing structures. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1956.jpg"/>
</Figure>

<P>Port 2 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1957.jpg"/>
</Figure>

<P>Egress Queue </P>

<P>(Full) </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1958.jpg"/>
</Figure>

<P>Port 1 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1959.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1960.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1961.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1962.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1963.jpg"/>
</Figure>

<Textbox>
<P>- 3 - </P>
</Textbox>

<Textbox>
<P>- 2 - </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Ingress Queue (Stopped) </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 4 </P>

<P>Port 3 </P>

<P> </P>

<P> </P>

<P>Figure 1-1. Basic Head-of-Line Blocking </P>

<P> </P>

<P>The example is simplistic, but any queueing mechanism can become congested, head-of-line block, and stall the link to the upstream device. The VoQ Backpressure Process defines a congestion message that informs the upstream port about the congestion, allowing traffic to be sidelined (in a virtual output queue) in favor of traffic with a clear path ahead. </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1964.jpg"/>
</Figure>

<P>Port 2 </P>

<P>Egress Queue </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1965.jpg"/>
</Figure>

<P>- 2 - </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1966.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1967.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1968.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1969.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1970.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1971.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1972.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1973.jpg"/>
</Figure>

<P>- 3 - </P>

<P>Port 1 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1974.jpg"/>
</Figure>

<P>Ingress </P>

<P>Queue </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port 4 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1975.jpg"/>
</Figure>

<P>Port 3 </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1976.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1977.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1978.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1979.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1980.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1981.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1982.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1983.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1984.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1985.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1986.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1987.jpg"/>
</Figure>

<P>Figure 1-2. Effective Backpressure </P>

<P> </P>

<P>Effective backpressure is achieved when the following elements exist: </P>

<P> </P>

<P>a ) The congested device can communicate congestion information to upstream devices. </P>

<P>b ) The upstream device can segregate traffic and allow traffic to re-order based on that congestion information. </P>

<P> </P>

<P>These two properties are essential. To keep the operation at the physical layer, the method described uses port identification for both the staging of traffic and the congestion status. Implementation of this specification is optional. </P>

<P> </P>

<P> </P>

<P>1.2 Terminology </P>

<P> </P>

<P>Upstream Device - A device ahead of another device in the traffic flow. The upstream device is the recipient of the backpressure messages. </P>

<P> </P>

<P>Downstream Device - The device later in the traffic flow. The downstream device is the originator of backpressure messages. </P>

<P> </P>

<P>Port - a port is a local value associated with a specific physical interface. Every device with more than 1 port is responsible for mapping the destination ID to a local port. </P>

<P> </P>

<P>Congestion Message - A bit, or group of bits indicating the congestion status of one or more ports. </P>

<P> </P>

<P>Backpressure Symbol - A specific field in a RapidIO control symbol that contains the congestion message. </P>

<P> </P>

<P> </P>

<P>1.3 Conventions </P>

<P> </P>

<P>All fields and message formats are described using big endian format. </P>

<P> </P>

<P>|| Concatenation, used to indicate that two fields are physically associated as consecutive bits </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>italics Book titles in text are set in italics. </P>

<P> </P>

<P>REG[FIELD]  Abbreviations or acronyms for registers are shown in uppercase text. </P>

<P>Specific bits, fields, or ranges appear in brackets. </P>

<P>TRANSACTIONTransaction types are expressed in all caps. operation Device operation types are expressed in plain text. n A decimal value. </P>

<P>[n-m] Used to express a numerical range from n to m. </P>

<P> </P>

<P>0bnn A binary value, the number of bits is determined by the number of digits. </P>

<P>0xnn A hexadecimal value, the number of bits is determined by the number of digits or from the surrounding context; for example, 0xnn may be a 5, 6, 7, or 8 bit value. </P>

<P>x This value is a don&#8217;t care. </P>

<P> </P>

<P>&lt;variable&gt; Identifies a logical variable that may be a specific field of a register or packet or data structure. </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Overview </P>

<P> </P>

<P>The purpose of this backpressure method is to maintain system performance during temporary congestion caused when statistical peaks in traffic flow oversubscribe the ability of a port and its associated buffering to handle the peak load. The backpressure avoids blocking of crossing traffic that competes for common resources. As such, the scope of the message is limited to a device and its immediately adjacent upstream devices. The system may be designed such that sustained congestion will cause a cascade of backpressure messages, but the ability to avoid degredation of performance drops as the radius of affected devices increases. RapidIO has other flow control methods to manage more systemic traffic impediments. Implementation of this specification is optional. </P>

<P> </P>

<P> </P>

<P>2.1 Congestion Message </P>

<P> </P>

<P>Two key considerations for the message format described here are the efficiency and latency of the message, and independence for the two devices involved in the exchange from implementation differences. The congestion message uses a packed format to convey the status of multiple ports in a single message: </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P> </P>

<P>5 </P>
</TD>

<TD>
<P> </P>

<P>4 </P>
</TD>

<TD>
<P> </P>

<P>3 </P>
</TD>

<TD>
<P> </P>

<P>2 </P>
</TD>

<TD>
<P> </P>

<P>1 </P>
</TD>

<TD>
<P> </P>

<P>0 </P>
</TD>

<TD>
<P> </P>

<P>Port Group </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Port Bits 5 </P>

<P>Port = Port Group * 6 + Offset </P>

<P>Port Bit = 1 = Congestion </P>

<P>Port Bit = 0 = No Congestion </P>

<P> </P>

<P>Figure 2-1. Congestion Message for a Group of Ports </P>

<P> </P>

<P>By combining 6 status bits with a port group, the number of total messages is reduced for larger port count devices. The format allows for devices up to 192 ports to be supported. Smaller devices my be able to communicate port status in one or two messages. A congestion message is typically transmitted when one at least of the ports&#8217; status changes. The congestion message is embedded in a field in the RapidIO control symbol. The symbol containing this message is defined as the backpressure symbol. </P>

<P> </P>

<P> </P>

<P>2.2 Traffic Staging </P>

<P> </P>

<P>For the congestion message to be useful, the upstream device must segregate or stage traffic prior to committing it to the RapidIO link to the downstream device, or any critical resource (like a buffer) that could block other traffic. To stage the </P>

<P> </P>

<P> </P>

<P>RapidIO Trade Association 13 </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>packets, the upstream device must have knowledge about the routing configuration of the downstream device. A typical RapidIO switch will lookup incoming traffic and switch it to a port based on its destination ID. To support this backpressure method, that lookup must produce the egress port for the current device as well as the egress port for the next device. It is straightforward to align the routing tables, but it does require additional entries. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table Table </P>

<P> </P>

<P> </P>

<P>&lt;DestID&gt; &lt;Port&gt; &lt;DestID&gt; &lt;Port&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table </P>

<P> </P>

<P>&lt;DestID&gt; &lt;Port&gt; &lt;Port&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Egress Port </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Egress Queue </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1988.jpg"/>
</Figure>

<P>Figure 2-2. Adding Egress Staging </P>

<P> </P>

<P>In the figure above, output staging is created by adding a second parameter to the routing table for the next hop port value. That value is the same value that has to be put in the downstream device&#8217;s routing table. In the upstream device it is used to identify what queue to stage the traffic in, and what queue to act on when a congestion    message     is     received.    The     value     is     specified     in     an implementation-dependant fashion. </P>

<P> </P>

<P>For end points, there is normally no routing table. To use this form of backpressure, the end point would need a method to associate a destination ID with the downstream egress port. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>14 RapidIO Trade Association </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>2.3 Adding Device Independence </P>

<P> </P>

<P>In the basic structure above, the traffic is staged in a queue that corresponds to a port in the downstream device. A difficulty arises to match the number of queues to the number of possible ports that might exist in the next device. It is inconsistent with RapidIO&#8217;s goals to allow devices to implement cost and complexity as needed by their market to require every device to have 192 queues to support a maximum sized device, so an additional abstraction is required. </P>

<P> </P>

<P>A device may combine traffic into fewer queues by reverse mapping the incoming port congestion message. In the figure below, the egress port supports 4 staging queues. The downstream device has 16 ports. So traffic for several ports are staged in a common queue. When a port specific message is received it is reverse mapped to the same queue that the forward lookup used to stage the data. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;destID&gt;&lt;port&gt;&lt;queue&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Port N </P>

<P>Reverse Map </P>

<P> </P>

<P> </P>

<P> </P>

<P>&lt;queue&gt; </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1989.jpg"/>
</Figure>

<P>Port Message </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Figure 2-3. Mapping Staging Queues </P>

<P> </P>

<P>In this example, as long as the forward/reverse mapping corresponds to the right downstream device&#8217;s egress port, any implementation can be used, as it is all internal to a single device. This mapping requires that only enough bits for the number of queues be added to the forward table, which can be very large. In the reverse direction, the mapping can be RAM based for maximum flexibility (in the above example requiring a 256 x 2 bit RAM), or a straight decoder. This specification does not prescribe a specific method. </P>

<P> </P>

<P>The only other requirement, when mapping multiple ports to a single queue, is that the queue must be shut down when any of those ports are congested. This will reduce the benefits of this backpressure method, but a significant amount of benefit is achieved with just a few queues. </P>

<P> </P>

<P> </P>

<P>2.4 Relationship With Virtual Channels </P>

<P> </P>

<P>The staging method illustrated above uses queues in the output stage of the upstream device. Devices implementing multiple Virtual Channels will have additional queueing structures for the VCs. The staging queues may be before the traffic is sorted into its VC, or each VC may have a set of staging queues. When the output </P>

<P> </P>

<P>RapidIO Trade Association 15 </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>queueing is not tied to the implementation of VCs, the congestion message is not linked to VC operation, and the backpressure symbol can be combined with any valid combinations of RapidIO symbols. </P>

<P> </P>

<P>If the output queueing is embedded within the VC structure, the VoQ congestion message may be linked to VC operation. Both message formats are described in the next section. The congestion message may be associated with a specific VC. A CSR bit is provided to enable or disable the linking of the VC_Status and congestion messages into a common control symbol. </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1990.jpg"/>
</Figure>

<P>VoQ Staging VC Queues </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1991.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1992.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1993.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1994.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1995.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1996.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1997.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1998.jpg"/>
</Figure>

<Textbox>
<P>VC2 </P>
</Textbox>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_1999.jpg"/>
</Figure>

<P>VoQ Staging </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2000.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2001.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2002.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2003.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2004.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2005.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2006.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2007.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2008.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2009.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2010.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2011.jpg"/>
</Figure>

<Textbox>
<P>Distribution </P>
</Textbox>

<Textbox>
<P>Scheduling </P>
</Textbox>

<Textbox>
<P>VC1 </P>
</Textbox>

<Textbox>
<P>Scheduling </P>
</Textbox>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2012.jpg"/>
</Figure>

<P>Port Based Staging </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2013.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2014.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2015.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2016.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2017.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2018.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2019.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2020.jpg"/>
</Figure>

<P>Prior to VC Scheduling </P>

<P>Port Based Staging </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2021.jpg"/>
</Figure>

<P>        Embedded in EachVC </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2022.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2023.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2024.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2025.jpg"/>
</Figure>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2026.jpg"/>
</Figure>

<Textbox>
<P>VC0 </P>
</Textbox>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2027.jpg"/>
</Figure>

<P>Figure 2-4. Linking VCs to VoQ Backpressure </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2028.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P>2.5 Additional Queueing Considerations </P>

<P> </P>

<P>If the downstream (originating) device is using queues in its output stage to determine congestion, then congestion messages will have to be sent to all ports that might be sources of incoming traffic. </P>

<P> </P>

<P>If the downstream device is using virtual output queues, presorting traffic by egress port at the input, then it has the ability to reflect congestion status on only those ports that are receiving traffic for the congested output. Input queued switches do require N2 queues (where N is the number of ports). </P>

<P> </P>

<P>Devices using some combination of input and output queueing, or shared memory architectures, may make congestion decisions based on whatever resource allocation algorithm is being employed. It is important to consider some of the following boundary conditions: </P>

<P>&#8226; If the congestion message is issued with too little room in the port&#8217;s egress to account for packets that might be in flight, head-of-line blocking can still occur. </P>

<P>&#8226; If very small queueing structures are used, a lot of on/off chatter can occur. This is not necessarily bad as long as the additional utilization of link bandwidth is accounted for. </P>

<P> </P>

<P>The generation and application of the congestion message defined in this specification will be highly dependent on the queueing and switch design of the device, and as such, is left to the implementer. </P>

<P> </P>

<P>16 RapidIO Trade Association </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Control Symbol Format </P>

<P> </P>

<P>The VoQ congestion message adds a control symbol to the RapidIO Interconnect Specification Part 6: LP-Serial Physical Layer Specification. Refer to that specification for the definitions of control symbols, packet delimiting, and the definitions of the fields not defined here. The VoQ backpressure symbol uses the extended control symbol defined for use with the 5/6G baud link speeds. This method may be used with the 1.25/2.5/3.125G baud link speeds but those links will have to be designed to support the extended control symbol. </P>

<P> </P>

<P> </P>

<P>3.1 Stype2 Control Symbol </P>

<P> </P>

<P>The  long  control  symbol  is  defined  as  follows  in  the  RapidIO  Interconnect </P>

<P>Specification Part 6: LP-Serial Physical Layer Specification: </P>

<P> </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>0 2 </P>
</TD>

<TD>
<P>3 8 </P>
</TD>

<TD>
<P>9 14   </P>
</TD>

<TD>
<P>15  17   </P>
</TD>

<TD>
<P>18  20 </P>
</TD>

<TD>
<P>21 34 </P>
</TD>

<TD>
<P>35 47 </P>
</TD>
</TR>

<TR>
<TD>
<P>stype0 </P>
</TD>

<TD>
<P>parameter0 </P>
</TD>

<TD>
<P>parameter1 </P>
</TD>

<TD>
<P>stype1 </P>
</TD>

<TD>
<P>cmd </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>CRC-13 </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>bits </P>

<P> </P>

<P> </P>

<P>3 6 6 3 3 14 13 </P>

<P> </P>

<P>Figure 3-1. Long Control Symbol Format </P>

<P> </P>

<P>The stype2 field uses the 14 reserved long control symbol bits and has an operation code (CMD) field and a parameter field. The VoQ backpressure symbol defines the follow usage for the stype2 symbol: </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2029.jpg"/>
</Figure>

<P>bits    0 </P>

<P>2   3 13 </P>

<P> </P>

<P>CMD </P>

<P>parameter </P>

<P>3 11 </P>

<P> </P>

<P>Figure 3-2. Stype2 Control Symbol Format </P>

<P> </P>

<P>Table 3-1 shows the stype2 control symbol format definitions. </P>

<P>Table 3-1. Stype2 Symbol Format </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Function </P>
</TD>

<TD>
<P>CMD </P>
</TD>

<TD>
<P>Parameter </P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>Bits 0 - 2 </P>
</TD>

<TD>
<P>Bits 3 - 13 </P>
</TD>
</TR>

<TR>
<TD>
<P>NOP </P>
</TD>

<TD>
<P>0b000 </P>
</TD>

<TD>
<P>0b000 0000 0000 </P>
</TD>
</TR>

<TR>
<TD>
<P>VoQ Backpressure </P>
</TD>

<TD>
<P>0b001 </P>
</TD>

<TD>
<P>Bits 3 - 8, Port Status Bits </P>
</TD>

<TD>
<P>Bits 9 - 13, Port Group </P>
</TD>
</TR>

<TR>
<TD>
<P>Reserved </P>
</TD>

<TD>
<P>0b010 - 0b111 </P>
</TD>

<TD>
<P>0b000 0000 0000 </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 3-2 shows the VoQ port status bit definitions. </P>

<P> </P>

<P>RapidIO Trade Association 17 </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 3-2. VoQ Port Status Bits </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Port Status Bits </P>
</TD>

<TD>
<P>Offset </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit 3 </P>
</TD>

<TD>
<P>Port Offset 5 </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit 4 </P>
</TD>

<TD>
<P>Port Offset 4 </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit 5 </P>
</TD>

<TD>
<P>Port Offset 3 </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit 6 </P>
</TD>

<TD>
<P>Port Offset 2 </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit 7 </P>
</TD>

<TD>
<P>Port Offset 1 </P>
</TD>
</TR>

<TR>
<TD>
<P>Bit 8 </P>
</TD>

<TD>
<P>Port Offset 0 </P>
</TD>
</TR>

<TR>
<TD>
<P>Status: </P>

<P>0b1 = Port is Congested </P>

<P>0b0 = Port is not Congested </P>
</TD>
</TR>
</Table>

<P> </P>

<P>Table 3-3 shows the port group bit definitions. </P>

<P> </P>

<P>Table 3-3. Port Group Bits </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Port Group </P>

<P>Bits 9 - 13 </P>
</TD>

<TD>
<P>Base </P>

<P>(Port Group * 6) </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00000 </P>
</TD>

<TD>
<P>0x00 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00001 </P>
</TD>

<TD>
<P>0x06 </P>
</TD>
</TR>

<TR>
<TD>
<P>0b00010 </P>
</TD>

<TD>
<P>0x0C </P>
</TD>
</TR>

<TR>
<TD>
<P>| </P>
</TD>

<TD>
<P>| </P>
</TD>
</TR>

<TR>
<TD>
<P>0b11111 </P>
</TD>

<TD>
<P>0xBA </P>
</TD>
</TR>

<TR>
<TD>
<P>Base = Port group x 6, &#61472;&#61472;</P>

<P>Port = Base + Offset </P>
</TD>
</TR>
</Table>

<P> </P>

<P>3.2 VC_Status Symbol Linking </P>

<P> </P>

<P>To specify a specific port within a VC for flow control, the VCID in the VC_Status symbol is used to identify the VC. This is done by combining the VoQ backpressure symbol and the VC_Status symbols in a single symbol. For VC0, the Status Symbol is used. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>3 6 6 </P>

<P> </P>

<P> </P>

<P> </P>

<P>3 6 6 </P>

<P>Linking w/ Status </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>0b100 </P>
</TD>

<TD>
<P>ACK_ID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype 1 </P>
</TD>

<TD>
<P>VoQ Backpressure </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>14 </P>

<P> </P>

<Textbox>
<Table>
<TR>
<TD>
<P>0b101 </P>
</TD>

<TD>
<P>000, VCID </P>
</TD>

<TD>
<P>buf_status </P>
</TD>

<TD>
<P>stype 1 </P>
</TD>

<TD>
<P>VoQ Backpressure </P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>Linking w/ VC_Status </P>

<P> </P>

<P>14 </P>

<P> </P>

<P>Figure 3-3. Linking VCs to VoQ Backpressure </P>

<P> </P>

<P>When VoQ Link is a 1 (in the VoQ CSR), and the stype2 field contains a VoQ Backpressure Symbol, the upstream device may flow control just the queue within the corresponding VC. When linking is enabled, the VoQ backpressure symbol may only be combined with a VC_Status or Status symbol. </P>

<P> </P>

<P> </P>

<P>18 RapidIO Trade Association </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>Linking only works if both upstream and downstream devices use port staging within VC structures. If either device does not have a corresponding capability, the linking capability shall be disabled in the CSR. A device with queueing within VCs shall flow control corresponding port queues in all VCs when linking is disabled. </P>

<P> </P>

<P>When the enable VC linking bit is not set, the VoQ backpressure symbol is not associated with any particular VC, even if the message is happens to be combined with a VC_Status or Status symbol. </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Rules </P>

<P> </P>

<P> </P>

<P>4.1 Implementation Rules </P>

<P>a ) Implementation of VoQ backpressure is entirely optional. </P>

<P>b ) Devices may implement VoQ backpressure on a port by port basis. </P>

<P>c ) Devices may support only the generation of backpressure messages without the ability to honor messages, or vice versa. </P>

<P>d ) Backpressure symbols use the stype2 region of the extended control symbol, therefore devices using this method must have the link initialize with the extended control symbol active. </P>

<P> </P>

<P> </P>

<P>4.2 Rules for Generating Backpressure Control Symbols </P>

<P>a ) The VoQ backpressure symbol shall only be transmitted to an upstream device if generation is enabled for a given port. If a congested port requests a symbol be sent to all upstream devices, only ports enabled for this feature shall actually transmit the symbol. </P>

<P>b ) The backpressure symbol may be included with any other valid combination of stype 0 and stype 1 symbols if VC linking is not enabled. </P>

<P>c ) The backpressure symbol shall only be included with a VC_status or Status control symbol to have the message linked to queues specific to VCs 0 through 8 (VC linking enabled). </P>

<P>d ) Ports shall be grouped in order, with the first 6 ports of the device occupying the first port group in the backpressure message (port group 0 encompasses ports 0 - 5, port group 1 covers ports 6 - 11, etc.). </P>

<P>e ) The backpressure symbol shall be generated anytime the status of at least one of the ports in the group changes. It is up to the implementer to define what constitutes a status change. </P>

<P>f ) The backpressure symbol may be generated at arbitrary intervals, based on a timer. The timer may be the same timer used for VC_status, or it may be a separate timer. Use of a timer is implementation specific. </P>

<P>g ) The backpressure symbol may be generated after link recovery to avoid orphaned congestion states. </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3  Rules for Interpreting Backpressure Control Symbols </P>

<P>a ) Devices shall have a mechanism to associate traffic with the downstream device&#8217;s egress port. </P>

<P>b ) Devices shall have a mechanism to associate the incoming congestion message with traffic destined for the indicated port. All traffic identified for that port shall not be committed to a critical resource when that port is identified as congested, allowing other traffic to pass. A critical resource is any resource that can block other traffic like a link or a buffer in a VC. </P>

<P>c ) Traffic that is still eligible for transmission is still subject to existing RapidIO </P>

<P>ordering rules. </P>

<P>d ) Traffic that has been segregated shall be re-introduced to the data stream with the same ordering requirements that existed when it was segregated. </P>

<P>e ) Devices may deliberately co-mingle traffic (traffic destined to different ports) to simplify implementations. When such co-mingling loses the ability to further discriminate among the ports, any congestion for any of the ports associated with the co-mingled traffic results in all that traffic being stopped. Co-mingled traffic may only be committed to the link if all ports represented by the traffic are not congested. </P>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 Register Definitions </P>

<P> </P>

<P> </P>

<P>5.1 VoQ Backpressure Extended Features Block </P>

<P> </P>

<P>This section describes the registers for all RapidIO LP-Serial devices supporting virtual channels. This Extended Features register block is assigned Extended Features block ID=0x000B. </P>

<P> </P>

<P> </P>

<P>5.1.1  Register Map </P>

<P> </P>

<P>Table 5-1 shows the VoQ backpressure register map for all RapidIO LP-Serial devices. The Block Offset is the offset relative to the 16-bit Extended Features Pointer (EF_PTR) that points to the beginning of the block. </P>

<P> </P>

<P>The address of a byte in the block is calculated by adding the block byte offset to EF_PTR that points to the beginning of the block. This is denoted as [EF_PTR+xx] where xx is the block byte offset in hexadecimal. </P>

<P> </P>

<P>Table 5-1. VoQ Register Block </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Block Byte </P>

<P>Offset </P>
</TD>

<TD>
<P> </P>

<P>Register Name </P>
</TD>
</TR>

<TR>
<TD>
<P>0x0 </P>
</TD>

<TD>
<P>LP-Serial Port - VoQ Backpressure Register Block Header </P>
</TD>
</TR>

<TR>
<TD>
<P>0xC </P>
</TD>

<TD>
<P>Port 0 VoQ Control Register </P>
</TD>
</TR>

<TR>
<TD>
<P>0x10 </P>
</TD>

<TD>
<P>Port 1 VoQ Control Register </P>
</TD>
</TR>

<TR>
<TD>
<P>0x14 </P>
</TD>

<TD>
<P>Port 2 VoQ Control Register </P>
</TD>
</TR>

<TR>
<TD>
<P>0x18 </P>
</TD>

<TD>
<P>Port 3 VoQ Control Register </P>
</TD>
</TR>

<TR>
<TD>
<P>0x1C-0x304 </P>
</TD>

<TD>
<P>Port n VoQ Control Registers </P>
</TD>
</TR>

<TR>
<TD>
<P>0x308 </P>
</TD>

<TD>
<P>Port 191 VoQ Control Register </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.1.2  VoQ Backpressure Control Block Registers </P>

<P> </P>

<P>Multiport devices implementing VoQ backpressure shall implement one register per port, even if the port does not support backpressure. Single port end points implement the port 0 register only </P>

<P> </P>

<P>5.1.2.1  LP-Serial VC Register Block Header&#61472;&#61472;</P>

<P>(Block Offset 0x0) </P>

<P> </P>

<P>The LP-Serial VC register block header register contains the EF_PTR to the next extended features block and the EF_ID that identifies this as the LP-Serial virtual channel register block header. </P>

<P> </P>

<P>Table 5-2. Bit Settings for LP-Serial Register Block Header </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0-15 </P>
</TD>

<TD>
<P>EF_PTR </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>Hard wired pointer to the next block in the data structure, if one exists </P>
</TD>
</TR>

<TR>
<TD>
<P>16-31 </P>
</TD>

<TD>
<P>EF_ID </P>
</TD>

<TD>
<P>0x000B </P>
</TD>

<TD>
<P>Hard wired Extended Features ID </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P>5.1.2.2  Port n VoQ Control Status Register&#61472;&#61472;</P>

<P>(Block Offset - Variable, see Section 5.1.1) </P>

<P> </P>

<P>This register is used by each port to set up VoQ backpressure operation. </P>

<P> </P>

<P>Table 5-3. Port n VoQ Backpressure CSR </P>

<P> </P>

<Table>
<TR>
<TD>
<P> </P>

<P>Bit </P>
</TD>

<TD>
<P> </P>

<P>Name </P>
</TD>

<TD>
<P>Reset </P>

<P>Value </P>
</TD>

<TD>
<P> </P>

<P>Description </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>VoQ Backpressure Symbol Generation Supported </P>
</TD>

<TD>
<P>see footnote1 </P>
</TD>

<TD>
<P>0b0 = generation of VoQ backpressure is not supported by this port </P>

<P>0b1 = generation of VoQ backpressure supported </P>

<P>(read-only) </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>VoQ Backpressure Symbol Reception Supported </P>
</TD>

<TD>
<P>see footnote2 </P>
</TD>

<TD>
<P>0b0 = reception of VoQ backpressure is not supported by this port </P>

<P>0b1 = reception of VoQ backpressure supported </P>

<P>(read-only) </P>
</TD>
</TR>

<TR>
<TD>
<P>2 </P>
</TD>

<TD>
<P>Linking with VCs supported </P>
</TD>

<TD>
<P>see footnote3 </P>
</TD>

<TD>
<P>0b0 = linking of VoQ backpressure with virtual channels is not supported by this port </P>

<P>0b1 = linking of VoQ backpressure with virtual channels is supported </P>

<P>(read-only) </P>
</TD>
</TR>

<TR>
<TD>
<P>3-7 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>

<TR>
<TD>
<P>8 </P>
</TD>

<TD>
<P>Enable VoQ Symbol </P>

<P>Generation </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0 = No VoQ symbols will be transmitted </P>

<P>0b1 = VoQ symbol generation is enabled </P>
</TD>
</TR>

<TR>
<TD>
<P>9 </P>
</TD>

<TD>
<P>Enable VoQ Participation </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0 = this port&#8217;s status will not be included in any VoQ symbols transmitted, nor cause symbols to be generated. (the port&#8217;s status will always be reflected as enabled). </P>

<P>0b1 = this port&#8217;s status will be reflected in VoQ backpressure symbols and will cause symbols to be generated </P>
</TD>
</TR>

<TR>
<TD>
<P>10 </P>
</TD>

<TD>
<P>Port XOFF </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0 = Port status will reflect current state of the port. </P>

<P>0b1 = Port status will always reflect congested (= 0b1) </P>
</TD>
</TR>

<TR>
<TD>
<P>11 </P>
</TD>

<TD>
<P>Enable VC linking </P>
</TD>

<TD>
<P>0b0 </P>
</TD>

<TD>
<P>0b0 = Linking VoQ backpressure with VC Status is disabled </P>

<P>0b1 = Linking VoQ backpressure with VC Status is enabled </P>
</TD>
</TR>

<TR>
<TD>
<P>12-31 </P>
</TD>

<TD>
<P>reserved </P>
</TD>

<TD>
<P>0x0_0000 </P>
</TD>

<TD>
<P> </P>
</TD>
</TR>
</Table>

<P>1The reset value is implementation dependent </P>

<P>2The reset value is implementation dependent </P>

<P>3The reset value is implementation dependent </P>

<P> </P>

<P>Symbol Generation by a port must be enabled only when the device at the other end of the link supports reception. </P>

<P> </P>

<P>VC linking should only be enabled if both connected devices support it. Support is defined as being able to both generate and receive VC linked messages. Either requires an underlying queueing structure that can segregate traffic by both VC and port. </P>

<P> </P>

<P>Bits 9 and 10 combine as shown in Table 5-4. </P>

<P> </P>

<P>Table 5-4. Port Status Control </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit 9 </P>
</TD>

<TD>
<P>Bit 10 </P>
</TD>

<TD>
<P>Status Reflected in VoQ Backpressure Messages </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>Port Status is always 0b0 (will not cause symbol to be generated) </P>
</TD>
</TR>

<TR>
<TD>
<P>0 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Port Status is always 0b1 (will not cause symbol to be generated) </P>
</TD>
</TR>
</Table>

<P>RapidIO Part 12: Virtual Output Queueing Extensions Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Table 5-4. Port Status Control </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Bit 9 </P>
</TD>

<TD>
<P>Bit 10 </P>
</TD>

<TD>
<P>Status Reflected in VoQ Backpressure Messages </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>0 </P>
</TD>

<TD>
<P>Normal operation, state transitions cause symbols to be generated and the status is reflected in the symbol </P>
</TD>
</TR>

<TR>
<TD>
<P>1 </P>
</TD>

<TD>
<P>1 </P>
</TD>

<TD>
<P>Port Status is always 0b1 (will cause a symbol to be generated if changing from normal operation causes a state change). </P>
</TD>
</TR>
</Table>

<P> </P>

<P>With bit 9 = 0b0, toggling bit 10 will change the ports reported state, but will not trigger any new symbols. With bit 9 = 0b1, changing from normal operation to congested or congested to normal operation will cause a symbol to be transmitted only if the state of the port changed. </P>

<P> </P>

<P>Note that changing the status of the port does not necessarily imply traffic will change. That depends on the configuration of the upstream device. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2030.jpg"/>
</Figure>

<P>RapidIO&#8482; Interconnect Specification Annex 1: Software/System Bring Up Specification </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Rev. 2.2, 06/2011 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_63.jpg"/>
</Figure>

<P>© Copyright RapidIO Trade Association </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2031.jpg"/>
</Figure>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Revision History </P>

<P> </P>

<P> </P>

<Table>
<TR>
<TD>
<P>Revision </P>
</TD>

<TD>
<P>Description </P>
</TD>

<TD>
<P>Date </P>
</TD>
</TR>

<TR>
<TD>
<P>1.0 </P>
</TD>

<TD>
<P>First release </P>
</TD>

<TD>
<P>12/17/2003 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Technical changes: the following errata showings: </P>

<P>04-09-00020.001, 04-09-00023.001 </P>

<P>Converted to ISO-friendly templates </P>

<P>Revision bumped to align with the rest of the specification stack </P>
</TD>

<TD>
<P>02/23/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>1.3 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/07/2005 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Technical changes: errata showing 06-02-00001.005 </P>
</TD>

<TD>
<P>06/14/2007 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.0 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>03/06/2008 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Technical changes: Errata showing 08-06-00000.000 </P>
</TD>

<TD>
<P>MM/DD/200Y </P>
</TD>
</TR>

<TR>
<TD>
<P>2.1 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>08/13/2009 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>No technical changes </P>
</TD>

<TD>
<P>05/05/2011 </P>
</TD>
</TR>

<TR>
<TD>
<P>2.2 </P>
</TD>

<TD>
<P>Removed confidentiality markings for public release </P>
</TD>

<TD>
<P>06/06/2011 </P>
</TD>
</TR>
</Table>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>NO WARRANTY.THE RAPIDIO TRADE ASSOCIATION PUBLISHES THE SPECIFICATION &#8220;AS IS&#8221;. THE RAPIDIO TRADE ASSOCIATION MAKES NO WARRANTY, REPRESENTATION OR COVENANT, EXPRESS OR IMPLIED, OF ANY KIND CONCERNING THE SPECIFICATION, INCLUDING, WITHOUT LIMITATION, NO WARRANTY OF NON INFRINGEMENT, NO WARRANTY OF MERCHANTABILITY AND NO WARRANTY OF FITNESS FOR A PARTICULAR PURPOSE. USER AGREES TO ASSUME ALL OF THE RISKS ASSOCIATED WITH ANY USE WHATSOEVER OF THE SPECIFICATION. WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, USER IS RESPONSIBLE FOR SECURING ANY INTELLECTUAL PROPERTY LICENSES OR RIGHTS WHICH MAY BE NECESSARY TO IMPLEMENT OR BUILD PRODUCTS COMPLYING WITH OR MAKING ANY OTHER SUCH USE OF THE SPECIFICATION. </P>

<P>DISCLAIMER OF LIABILITY. THE RAPIDIO TRADE ASSOCIATION SHALL NOT BE LIABLE OR RESPONSIBLE FOR ACTUAL, INDIRECT, SPECIAL, INCIDENTAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING, WITHOUT LIMITATION, LOST PROFITS) RESULTING FROM USE OR INABILITY TO USE THE SPECIFICATION, ARISING FROM ANY CAUSE OF ACTION WHATSOEVER, INCLUDING, WHETHER IN CONTRACT, WARRANTY, STRICT LIABILITY, OR NEGLIGENCE, EVEN IF THE RAPIDIO TRADE ASSOCIATION HAS BEEN NOTIFIED OF THE POSSIBILITY OF SUCH DAMAGES. </P>

<P> </P>

<P>Questions regarding the RapidIO Trade Association, specifications, or membership should be forwarded to: RapidIO Trade Association&#61472;&#61472;</P>

<P>12343 Hymeadow, Suite 2-R&#61472;&#61472;</P>

<P>(non-US mail deliveries to Suite 3-E)&#61472;&#61472;</P>

<P>Austin, TX 78750&#61472;&#61472;</P>

<P>512-401-2900 Tel.&#61472;&#61472;</P>

<P>512-401-2902 FAX. </P>

<P> </P>

<P>RapidIO and the RapidIO logo are trademarks and service marks of the RapidIO Trade Association. All other trademarks are the property of their respective owners. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P>1.1 Introduction............................................................................................................. 7 </P>

<P>1.2 Overview................................................................................................................. 7 </P>

<P>1.3 Scope....................................................................................................................... 7 </P>

<P>1.4 System Enumeration API........................................................................................ 8 </P>

<P>1.5 Terminology............................................................................................................ 8 </P>

<P>1.6 Software Conventions ............................................................................................. 8 </P>

<P> </P>

<P> </P>

<P>Chapter 2 Requirements for System Bring Up </P>

<P> </P>

<P>2.1 Introduction............................................................................................................. 9 </P>

<P>2.2 Boot Requirements ................................................................................................. 9 </P>

<P>2.3 Enumeration Completion ...................................................................................... 10 </P>

<P>2.4 Enumeration Time-Out ......................................................................................... 10 </P>

<P>2.5 Function Return Codes ......................................................................................... 11 </P>

<P> </P>

<P> </P>

<P>Chapter 3 Hardware Abstraction Layer </P>

<P> </P>

<P>3.1 Introduction........................................................................................................... 13 </P>

<P>3.2 Device Addressing ................................................................................................ 13 </P>

<P>3.3 HAL Functions ..................................................................................................... 14 </P>

<P>3.3.1 Types and Definitions ....................................................................................... 14 </P>

<P>3.3.2 rioGetNumLocalPorts ....................................................................................... 14 </P>

<P>3.3.3 rioConfigurationRead ....................................................................................... 15 </P>

<P>3.3.4 rioConfigurationWrite ...................................................................................... 16 </P>

<P> </P>

<P> </P>

<P>Chapter 4 Standard Bring Up Functions </P>

<P> </P>

<P>4.1 Introduction........................................................................................................... 17 </P>

<P>4.2 Data Structures...................................................................................................... 17 </P>

<P>4.3 Bring Up Functions............................................................................................... 18 </P>

<P>4.3.1 rioInitLib ........................................................................................................... 18 </P>

<P>4.3.2 rioGetFeatures................................................................................................... 19 </P>

<P>4.3.3 rioGetSwitchPortInfo........................................................................................ 20 </P>

<P>4.3.4 rioGetExtFeaturesPtr ........................................................................................ 21 </P>

<P>4.3.5 rioGetNextExtFeaturesPtr................................................................................. 22 </P>

<P>4.3.6 rioGetSourceOps............................................................................................... 23 </P>

<P>4.3.7 rioGetDestOps .................................................................................................. 24 </P>

<P>4.3.8 rioGetAddressMode.......................................................................................... 25 </P>

<P>4.3.9 rioGetBaseDeviceId.......................................................................................... 26 </P>

<P>4.3.10 rioSetBaseDeviceId .......................................................................................... 27 </P>

<P> </P>

<P>RapidIO Trade Association 3 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>Table of Contents </P>

<P> </P>

<P>4.3.11 rioAcquireDeviceLock...................................................................................... 28 </P>

<P>4.3.12 rioReleaseDeviceLock ...................................................................................... 29 </P>

<P>4.3.13 rioGetComponentTag ....................................................................................... 30 </P>

<P>4.3.14 rioSetComponentTag ........................................................................................ 31 </P>

<P>4.3.15 rioGetPortErrStatus........................................................................................... 32 </P>

<P> </P>

<P> </P>

<P>Chapter 5 Routing-Table Manipulation Functions </P>

<P> </P>

<P>5.1 Introduction........................................................................................................... 33 </P>

<P>5.2 Routing Table Functions....................................................................................... 34 </P>

<P>5.2.1 rioRouteAddEntry............................................................................................. 34 </P>

<P>5.2.2 rioRouteGetEntry.............................................................................................. 35 </P>

<P> </P>

<P> </P>

<P>Chapter 6 Device Access Routine Interface </P>

<P> </P>

<P>6.1 Introduction........................................................................................................... 37 </P>

<P>6.2 DAR Packaging .................................................................................................... 37 </P>

<P>6.3 Execution Environment ........................................................................................ 37 </P>

<P>6.4 Type Definitions ................................................................................................... 38 </P>

<P>6.5 DAR Functions ..................................................................................................... 39 </P>

<P>6.5.1 rioDar_nameGetFunctionTable........................................................................ 39 </P>

<P>6.5.2 rioDarInitialize.................................................................................................. 40 </P>

<P>6.5.3 rioDarTerminate................................................................................................ 41 </P>

<P>6.5.4 rioDarTestMatch ............................................................................................... 42 </P>

<P>6.5.5 rioDarRegister................................................................................................... 43 </P>

<P>6.5.6 rioDarGetMemorySize...................................................................................... 44 </P>

<P>6.5.7 rioDarGetSwitchInfo ........................................................................................ 45 </P>

<P>6.5.8 rioDarSetPortRoute........................................................................................... 46 </P>

<P>6.5.9 rioDarGetPortRoute .......................................................................................... 47 </P>

<P> </P>

<P> </P>

<P>Annex A  System Bring Up Guidelines (Informative) </P>

<P> </P>

<P>A.1 Introduction........................................................................................................... 49 </P>

<P>A.2 Overview of the System Bring Up Process .......................................................... 49 </P>

<P>A.3 System Enumeration Algorithm ........................................................................... 50 </P>

<P>A.3.1 Data Structures, Constants, and Global Variables ............................................ 51 </P>

<P>A.3.2 Pseudocode ....................................................................................................... 52 </P>

<P>A.4 System Bring Up Example ................................................................................... 56 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P> </P>

<P>A-1 Example System .............................................................................................................57 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>List of Figures </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 1 Overview </P>

<P> </P>

<P> </P>

<P>1.1 Introduction </P>

<P> </P>

<P>This chapter provides an overview of the RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 document. This document assumes that the reader is familiar with the RapidIO specifications, conventions, and terminology. </P>

<P> </P>

<P> </P>

<P>1.2 Overview </P>

<P> </P>

<P>The RapidIO Architectural specifications establish a framework that enables a wide variety of   implementations.   The   RapidIO   Part   7:   System   and   Device Inter-operability Specification provides a standard set of device and system design solutions to   support   inter-operability.   This   document   builds   upon   the inter-operability specification to define a standard set of software API functions for use in system bring up. </P>

<P> </P>

<P>Each chapter addresses a different bring up topic. This revision of the RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 document covers the following issues: </P>

<P> </P>

<P>Chapter 2, &#8220;Requirements for System Bring Up&#8221; Chapter 3, &#8220;Hardware Abstraction Layer&#8221; Chapter 4, &#8220;Standard Bring Up Functions&#8221; </P>

<P>Chapter 5, &#8220;Routing-Table Manipulation Functions&#8221; Chapter 6, &#8220;Device Access Routine Interface&#8221; </P>

<P>Annex A, &#8220;System Bring Up Guidelines (Informative)&#8221; </P>

<P> </P>

<P> </P>

<P>1.3 Scope </P>

<P> </P>

<P>Although RapidIO networks provide many features and capabilities, there are a few assumptions and restrictions that this specification relies on to simplify the bring up process and narrow the specification scope. These assumptions and restrictions are: </P>

<P>&#8226; Only two hosts may simultaneously enumerate a network. Two hosts may be needed on a network for fault tolerance purposes. System integrators must determine which hosts can perform this function. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; Only one host actually completes the network enumeration (this is referred to as the winning host). The second host must retreat and wait for the enumeration to complete or, assuming the winning host has failed, for enumeration to timeout. If a timeout occurs, the second host re-enumerates the network. </P>

<P>&#8226; After enumeration, other hosts in the system must passively discover the network to gather topology information such as routing tables and memory maps. </P>

<P> </P>

<P> </P>

<P>1.4 System Enumeration API </P>

<P> </P>

<P>System enumeration API functions may be divided into two categories: </P>

<P> </P>

<P>&#8226; Standard RapidIO functions that use hardware resources defined by the RapidIO specifications. These functions should rely on the support functions provided by the Hardware Abstraction Layer (HAL) to ensure portability between different platforms. </P>

<P>&#8226; Device-specific (vendor-specific) functions defined by a device manufacturer that use hardware resources outside of the scope of the RapidIO specifications. The main purpose of these functions is to provide Hardware Abstraction Layer (HAL) support to the standard RapidIO functions. </P>

<P> </P>

<P>An important goal of this software API specification is to minimize the number of device-specific functions required for enumeration so that the portability of the API across hardware platforms is maximized. </P>

<P> </P>

<P> </P>

<P>1.5 Terminology </P>

<P> </P>

<P>This document uses terms such as local port, local configuration registers, etc. to refer to hardware resources associated with a RapidIO end point device attached to (or combined with) the host processor that performs RapidIO system enumeration and initialization. </P>

<P> </P>

<P> </P>

<P>1.6 Software Conventions </P>

<P> </P>

<P>To describe the software API functions, this document uses syntactic and notational conventions consistent with the C programming language. The conventions for naming functions and variables used by these APIs are outside of scope of this document. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 2 Requirements for System Bring Up </P>

<P> </P>

<P> </P>

<P>2.1 Introduction </P>

<P> </P>

<P>This section describes basic requirements for system bring up and discovery. An overview of the system bring up process, including a system bring up example, is presented in Annex A, &#8220;System Bring Up Guidelines (Informative)&#8221;. </P>

<P> </P>

<P> </P>

<P>2.2 Boot Requirements </P>

<P> </P>

<P>The following system state is required for proper system bring up: </P>

<P> </P>

<P>After the system is powered on, the state necessary for system enumeration to occur using multiple host processors is automatically initialized as follows (These initial state  requirements  are  specified  in  the  RapidIO  Part  7:  System  and  Device Inter-operability Specification): </P>

<P>&#8226; System devices are initialized with the following Base Device IDs: </P>

<P>&#8212; Non-boot-code and non-host device IDs are set to 0xFF (0xFFFF for </P>

<P>16-bit deviceID systems). </P>

<P>&#8212; Boot code device IDs are set to 0xFE (0x00FE for 16-bit deviceID </P>

<P>systems). </P>

<P>&#8212; Host device IDs are set to 0x00 (0x0000 for 16-bit deviceID systems). </P>

<P>&#8226; Physical layer link initialization of end points is complete. </P>

<P>&#8226; The default routing state of all switches between the boot code device and the host device is set to route all requests for device ID 0xFE (0x00FE for 16-bit deviceID systems) to the appropriate boot code device. All response packets are routed back to the host from the boot code device. </P>

<P>&#8226; Any host that participates in discovery must change its destination ID to a unique ID value before starting the system initialization process. This value is used by a device&#8217;s Host Base Device ID Lock CSR to ensure only one host can manipulate a device at a time. The allowed ID values for a discovering host are 0x00 (0x0000) and 0x01 (0x0001). A host with an ID of 0x00 (0x0000) has a lower priority than a host with an ID of 0x01 (0x0001). Host devices must be configured to accept maintenance packets with a destination ID of 0xFF (0xFFFF for 16-bit deviceID systems) as well as the unique host ID. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; All host devices have their Master Enable bit (Port General Control CSR) set to 1. Switch devices do not have a Master enable bit. </P>

<P>&#8226; All devices will accept requests with any sourceID or destinationID value </P>

<P> </P>

<P> </P>

<P>2.3 Enumeration Completion </P>

<P> </P>

<P>One or two hosts can perform system enumeration in a RapidIO network. If two hosts are present, an algorithm is needed to determine which host has the priority to proceed with enumeration. The host with the higher priority is the winning host and the other host is the losing host. The enumeration algorithm suggested in Appendix A, &#8220;System Bring Up Guidelines (Informative),&#8221; on page 49 sets priority based on the value of the power-on device ID. </P>

<P> </P>

<P>Enumeration is complete when the winning host releases the lock on the losing host. It is the losing host&#8217;s responsibility to detect that it has been locked by the winning host and to later detect that the lock has been released by the winning host. The methods used to release locks on nodes other than the host nodes is outside the scope of this document. </P>

<P> </P>

<P> </P>

<P>2.4 Enumeration Time-Out </P>

<P> </P>

<P>As mentioned in the previous section, two hosts can be used to enumerate the RapidIO network. The algorithm in Appendix A assumes the host with the higher power-on host device ID has priority over the other host. Because of this pre-defined priority, only one host (the one with higher priority) can win the enumeration task. In this case, the losing host enters a wait state. </P>

<P> </P>

<P>If the winning host fails to enumerate the entire network, the losing host&#8217;s wait state times out. When this occurs, the losing host attempts to enumerate the network. In an open 8-bit deviceID system, the losing host must wait 15 seconds before timing out and restarting the enumeration task. The length of the time-out period in a closed or a 16-bit deviceID system may differ from that of an open system. </P>

<P> </P>

<P> </P>

<P>To develop the 15 second time-out value, the following assumptions are made about the network maximal size: </P>

<P> </P>

<P>NUMDEV     = 256 devices </P>

<P> </P>

<P>NUMSWITCHES = 256 switches </P>

<P> </P>

<P>NUMFTE     = 256 routing table entries per switch </P>

<P> </P>

<P>It is assumed that a separate maintenance write packet is required to program each routing table entry for each switch. Since we need to establish a time base for operations, we assume: </P>

<P> </P>

<P>CWTime = 100 microseconds per configuration write packet </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>Now we can estimate that the number of configuration writes it takes to program all of the switch routing table entries is (256 switches)*(256 routing table entries), or; </P>

<P> </P>

<P>=&gt; 256*256*CWTIME microsecs = </P>

<P> </P>

<P>=&gt; ~6.6 seconds. </P>

<P> </P>

<P>Given these rough approximations, a 15 second time-out value is seen as appropriate and conservative for open systems. The chosen value must be such that if a time-out were to occur, it must be guaranteed that failure HAS occurred, and hence choosing a conservative value is necessary. </P>

<P> </P>

<P> </P>

<P>2.5 Function Return Codes </P>

<P> </P>

<P>The following return codes and their constant values are defined for use by the system bring up functions. </P>

<P> </P>

<P>typedef         unsigned int                  STATUS; </P>

<P> </P>

<Table>
<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_SUCCESS </P>
</TD>

<TD>
<P>0x0 </P>
</TD>

<TD>
<P>// Success status code&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_WARN_INCONSISTENT </P>
</TD>

<TD>
<P>0x1 </P>
</TD>

<TD>
<P>// Used by&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// rioRouteGetEntry&#8212;indicates&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// that the routeportno returned is&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// not the same for all ports&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_SLAVE </P>
</TD>

<TD>
<P>0x1001 </P>
</TD>

<TD>
<P>// Another host has a higher&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// priority&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_INVALID_PARAMETER </P>
</TD>

<TD>
<P>0x1002 </P>
</TD>

<TD>
<P>// One or more input parameters&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// had an invalid value&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_RIO </P>
</TD>

<TD>
<P>0x1003 </P>
</TD>

<TD>
<P>// The RapidIO fabric returned a&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// Response Packet with ERROR&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// status reported&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_ACCESS </P>
</TD>

<TD>
<P>0x1004 </P>
</TD>

<TD>
<P>// A device-specific hardware&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// interface was unable to generate&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// a maintenance transaction and&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// reported an error&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_LOCK </P>
</TD>

<TD>
<P>0x1005 </P>
</TD>

<TD>
<P>// Another host already acquired&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// the specified processor element&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_NO_DEVICE_SUPPORT </P>
</TD>

<TD>
<P>0x1006 </P>
</TD>

<TD>
<P>// Device Access Routine does not&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// provide services for this device&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_INSUFFICIENT_RESOURCES </P>
</TD>

<TD>
<P>0x1007 </P>
</TD>

<TD>
<P>// Insufficient storage available in&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// Device Access Routine private&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// storage area&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_ROUTE_ERROR </P>
</TD>

<TD>
<P>0x1008 </P>
</TD>

<TD>
<P>// Switch cannot support&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// requested routing&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_NO_SWITCH </P>
</TD>

<TD>
<P>0x1009 </P>
</TD>

<TD>
<P>// Target device is not a switch&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>#define </P>
</TD>

<TD>
<P>RIO_ERR_FEATURE_NOT_SUPPORTED </P>
</TD>

<TD>
<P>0x100A </P>
</TD>

<TD>
<P>// Target device is not capable of&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P> </P>
</TD>

<TD>
<P>// per-input-port routing </P>
</TD>
</TR>
</Table>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 3 Hardware Abstraction Layer </P>

<P> </P>

<P> </P>

<P>3.1 Introduction </P>

<P> </P>

<P>The Hardware Abstraction Layer (HAL) provides a standard software interface to the device-specific hardware resources needed to support RapidIO system configuration transactions. Configuration read and write operations are used by the HAL functions to access RapidIO device registers. The HAL functions are accessed by the RapidIO enumeration API during system bring up. </P>

<P> </P>

<P>This section describes the HAL functions and how they can be used to access local and remote RapidIO device registers. These functions must be implemented by every new device-specific host-processing element to support RapidIO system enumeration and initialization. The HAL functions assume the following: </P>

<P>&#8226; All configuration read and write operations support only single word (4-byte) </P>

<P>accesses. </P>

<P>&#8226; As required by the device, the size of the 8-bit or 16-bit deviceID field is considered by the device implementation (see section 2.4 of the RapidIO Part </P>

<P>3: Common Transport Specification for more information). </P>

<P>&#8226; An enumerating processor device may have more than one RapidIO end point </P>

<P>(local port). </P>

<P> </P>

<P> </P>

<P>3.2 Device Addressing </P>

<P> </P>

<P>One purpose of the HAL is to provide a unified software interface to configuration registers in both local and remote RapidIO processing elements. This is done using a universal device-addressing scheme. Such a scheme enables HAL functions to distinguish between accesses to local and remote RapidIO end points without requiring an additional parameter. The result is that only one set of HAL functions must be implemented to support local and remote configuration operations. </P>

<P> </P>

<P>All HAL functions use the destid and hopcount parameters to address a RapidIO device. The HAL reserves destid=0xFFFFFFFF and hopcount of 0 for addressing configuration registers within the local RapidIO end point. A destid= 0xFFFFFFFF and hopcount of 0 value must be used to address the local processing end point regardless of the actual destination ID value. This reserved combination does not conflict with the address of other RapidIO devices. The localport parameter is used by the HAL functions to identify a specific local port within RapidIO devices containing multiple ports. </P>

<P> </P>

<P>RapidIO Trade Association 13 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.3 HAL Functions </P>

<P> </P>

<P>The  functions that  form  the  RapidIO initialization HAL are  described in  the following sections. </P>

<P> </P>

<P> </P>

<P>3.3.1  Types and Definitions </P>

<P> </P>

<P>/* The HOST_REGS value below is a destination ID used to specify that the registers of the processor/platform on which the code is running are to be accessed. </P>

<P>*/ </P>

<P> </P>

<P>#define HOST_REGS 0xFFFFFFFF </P>

<P> </P>

<P> </P>

<P>3.3.2  rioGetNumLocalPorts </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>INT32 rioGetNumLocalPorts (&#61472;&#61472;</P>

<P>void&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: None </P>

<P>Return Value: </P>

<P> </P>

<P>0 Error </P>

<P> </P>

<P>n Number of RapidIO ports supported </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetNumLocalPorts() returns the total number of local RapidIO ports supported by the HAL functions. The number n returned by this function should be equal to or greater than 1. A returned value of 0 indicates an error. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>3.3.3  rioConfigurationRead </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioConfigurationRead (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 offset,&#61472;&#61472;</P>

<P>UINT32 *readdata&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the target device [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>offset Word-aligned (four byte boundary) offset&#8212;in&#61472;&#61472;</P>

<P>bytes&#8212;of the CAR or CSR [IN] </P>

<P> </P>

<P>*readdata Pointer to storage for received data [OUT] Return Value: </P>

<P>RIO_SUCCESS The read operation completed successfully and valid&#61472;&#61472;</P>

<P>data was placed into the specified location. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioConfigurationRead() performs a configuration read transaction from CAR and/or CSR register(s) belonging to a local or remote RapidIO device. The function uses a device-specific hardware interface to generate maintenance transactions to remote devices. This hardware sends a configuration read request to the remote device (specified by destid and/or hopcount) and waits for a corresponding configuration read response. After the function receives a configuration read response it returns data and/or status to the caller. The method for accessing registers in a local device is device-specific. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>3.3.4  rioConfigurationWrite </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioConfigurationWrite (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 offset,&#61472;&#61472;</P>

<P>UINT32 *writedata&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the target device [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>offset Word-aligned (four byte boundary) offset&#8212;in&#61472;&#61472;</P>

<P>bytes&#8212;of the CAR or CSR [IN] </P>

<P> </P>

<P>*writedata Pointer to storage for data to be written [IN] Return Value: </P>

<P>RIO_SUCCESS The write operation completed successfully. RIO_ERR_INVALID_PARAMETER  One or more input parameters had an invalid value. </P>

<P>RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472; ERROR status reported. Error status returned by this&#61472; function may contain additional information from the&#61472; Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioConfigurationWrite() performs a configuration write transaction to CAR and/or CSR register(s) belonging to a local or remote RapidIO device. The function uses a device-specific hardware interface to generate maintenance transactions to remote devices. This hardware sends a configuration write request to the remote device (specified by destid and/or hopcount) and waits for a corresponding configuration write response. After the function receives a configuration write response it returns status to the caller. The method for accessing registers in a local device is device-specific. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 4 Standard Bring Up Functions </P>

<P> </P>

<P> </P>

<P>4.1 Introduction </P>

<P> </P>

<P>This section describes the RapidIO functions that must be implemented to support system bring up. Functions are defined only for device registers used during the RapidIO enumeration and initialization process, not for all possible RapidIO device registers. These functions can be implemented using the HAL functions. Many of the functions can also be implemented as macros that specify predefined parameters for the HAL functions. The standard RapidIO bring up functions can be combined into a library if they are implemented as a set of subroutines. </P>

<P> </P>

<P> </P>

<P>4.2 Data Structures </P>

<P> </P>

<P>typedef ADDR_MODE UINT32; </P>

<P> </P>

<P>#define ADDR_MODE_34BIT_SUPPORT 0x1 </P>

<P> </P>

<P>#define ADDR_MODE_50_34BIT_SUPPORT 0x3 </P>

<P> </P>

<P>#define ADDR_MODE_66_34BIT_SUPPORT 0x5 </P>

<P> </P>

<P>#define ADDR_MODE_66_50_34BIT_SUPPORT 0x7 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3 Bring Up Functions </P>

<P> </P>

<P> </P>

<P>4.3.1  rioInitLib </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioInitLib (&#61472;&#61472;</P>

<P>void&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: None </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS Initialization completed successfully. RIO_ERROR Generic error report. Unable to initialize library. </P>

<P>Synopsis: </P>

<P> </P>

<P>rioInitLib() initializes the RapidIO API library. No routines defined in this chapter may be called unless and until rioInitLib has been invoked. If rioInitLib returns RIO_ERROR, no routines defined in this chapter may be called. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.2  rioGetFeatures </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetFeatures (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 *features&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>*features Pointer to storage containing the received features&#61472;&#61472;</P>

<P>[OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The features were retrieved successfully and placed&#61472;&#61472;</P>

<P>into the location specified by *features. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetFeatures() uses the HAL rioConfigurationRead() function to read from the Processing Element Features CAR of the specified processing element. Values read are placed into the location referenced by the *features pointer. Reported status is similar to rioConfigurationRead() </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.3  rioGetSwitchPortInfo </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetSwitchPortInfo (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 *portinfo&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>*portinfo Pointer to storage containing the received port&#61472;&#61472;</P>

<P>information [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The port information was retrieved successfully and&#61472;&#61472;</P>

<P>placed into the location specified by *portinfo. </P>

<P> </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an&#61472;&#61472;</P>

<P>invalid value. </P>

<P> </P>

<P>RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472; ERROR status reported. Error status returned by this&#61472; function may contain additional information from the&#61472; Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetSwitchPortInfo() uses the HAL rioConfigurationRead() function to read from the Switch Port Information CAR of the specified processing element. Values read are placed into the location referenced by the *portinfo pointer. Reported status is similar to rioConfigurationRead(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.4  rioGetExtFeaturesPtr </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetExtFeaturesPtr (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 *extfptr&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>*extfptr Pointer to storage containing the received extended feature information [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The extended feature information was retrieved&#61472;&#61472;</P>

<P>successfully and placed into the location specified by&#61472;&#61472;</P>

<P>*extfptr. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetExtFeaturesPtr() uses the HAL rioConfigurationRead() function to read the pointer to the first entry in the extended features list from the Assembly Information CAR of the specified processing element. That pointer is placed into the location referenced by the *extfptr pointer. Reported status is similar to rioConfigurationRead(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. Note that if the EF_PTR field of *extfptr is 0, no extended features are available. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.5  rioGetNextExtFeaturesPtr </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetNextExtFeaturesPtr (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 currfptr,&#61472;&#61472;</P>

<P>UINT32 *extfptr&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>currfptr Pointer to the last reported extended feature [IN] </P>

<P> </P>

<P>*extfptr Pointer to storage containing the received extended feature information [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The extended feature information was retrieved&#61472;&#61472;</P>

<P>successfully and placed into the location specified by&#61472;&#61472;</P>

<P>*extfptr. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetNextExtFeaturesPtr() uses the HAL rioConfigurationRead() function to read the pointer to the next entry in the extended features. That pointer is placed into the location referenced by the *extfptr pointer. Reported status is similar to rioConfigurationRead(). </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. Note that if the EF_PTR field of *extfptr is 0, no further extended features are available. Invoking </P>

<P>rioGetNextExtFeaturesPtr when currfptr has an EF_PTR field value of 0 will result in a return code of </P>

<P>RIO_ERR_INVALID_PARAMETER. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.6  rioGetSourceOps </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetSourceOps (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 *srcops&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>*srcops Pointer to storage containing the received source&#61472;&#61472;</P>

<P>operation information [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The source operation information was retrieved&#61472;&#61472;</P>

<P>successfully and placed into the location specified by&#61472;&#61472;</P>

<P>*srcops. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetSourceOps() uses the HAL rioConfigurationRead() function to read from the Source Operations CAR of the specified processing element. Values read are placed into the location referenced by the *srcops pointer. Reported status is similar to rioConfigurationRead(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.7  rioGetDestOps </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetDestOps (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 *dstops&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>*dstops Pointer to storage containing the received destination&#61472;&#61472;</P>

<P>operation information [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The destination operation information was retrieved&#61472;&#61472;</P>

<P>successfully and placed into the location specified by&#61472;&#61472;</P>

<P>*dstops. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetDestOps() uses the HAL rioConfigurationRead() function to read from the Destination Operations CAR of the specified processing element. Values read are placed into the location referenced by the *dstops pointer. Reported status is similar to rioConfigurationRead(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.8  rioGetAddressMode </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetAddressMode (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>ADDR_MODE *amode&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>*amode Pointer to storage containing the received address&#61472; mode (34-bit, 50-bit, or 66-bit address) information&#61472; [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The address mode information was retrieved&#61472;&#61472;</P>

<P>successfully and placed into the location specified by&#61472;&#61472;</P>

<P>*amode. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetAddressMode() uses the HAL rioConfigurationRead() function to read from the PE Logical Layer CSR of the specified processing element. The number of address bits generated by the PE (as the source of an operation) and processed by the PE (as the target of an operation) are placed into the location referenced by the *amode pointer. Reported status is similar to rioConfigurationRead(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.9  rioGetBaseDeviceId </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetBaseDeviceId (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 *deviceid&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>*deviceid Pointer to storage containing the base device ID&#61472;&#61472;</P>

<P>[OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The base device ID information was retrieved&#61472;&#61472;</P>

<P>successfully and placed into the&#61472;&#61472;</P>

<P>location specified by *deviceid. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetBaseDeviceId() uses the HAL rioConfigurationRead() function to read from the Base Device ID CSR of the local processing element (the destid and hopcount parameters used by rioConfigurationRead() must be set to HOST_REGS and zero, respectively). Values read are placed into the location referenced by the *deviceid pointer. Reported status is similar to rioConfigurationRead(). This function is useful only for local end-point devices. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.10  rioSetBaseDeviceId </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioSetBaseDeviceId (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 newdeviceid&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>newdeviceid New base device ID to be set [IN] Return Value: </P>

<P>RIO_SUCCESS The base device ID was updated successfully. RIO_ERR_INVALID_PARAMETER  One or more input parameters had an invalid value. </P>

<P>RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472; ERROR status reported. Error status returned by this&#61472; function may contain additional information from the&#61472; Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioSetBaseDeviceId() uses the HAL rioConfigurationWrite() function to write the base device ID in the Base Device ID CSR of the specified processing element (end point devices only). Reported status is similar to rioConfigurationWrite(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.11  rioAcquireDeviceLock </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioAcquireDeviceLock (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT16 hostdeviceid,&#61472;&#61472;</P>

<P>UINT16 *hostlockid&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>hostdeviceid Host base device ID for the local processing element&#61472;&#61472;</P>

<P>[IN] </P>

<P> </P>

<P>*hostlockid Device ID of the host holding the lock if ERR_LOCK&#61472;&#61472;</P>

<P>is returned [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P>RIO_SUCCESS  The device lock was acquired successfully. RIO_ERR_LOCK Another host already acquired the specified processor&#61472;&#61472;</P>

<P>element. ID of the device holding the lock is contained&#61472;&#61472;</P>

<P>in the location referenced by the *hostlockid&#61472;&#61472;</P>

<P>parameter. </P>

<P> </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value </P>

<P> </P>

<P>RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472; ERROR status reported. Error status returned by this&#61472; function may contain additional information from the&#61472; Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioAcquireDeviceLock() tries to acquire the hardware device lock for the specified processing element on behalf of the requesting host. The function uses the HAL rioConfigurationWrite() function to write the requesting host device ID into the Host Base Lock Device ID CSR of the specified processing element. After the write completes, this function uses the HAL rioConfigurationRead() function to read the value back from the Host Base Lock Device ID CSR. The written and read values are compared. If they are equal, the lock was acquired successfully. Otherwise, another host acquired this lock and the device ID for that host is reported. </P>

<P> </P>

<P>This function assumes unique host-based device identifiers are assigned to discovering hosts. For more details, refer to </P>

<P>Annex A, &#8220;System Bring Up Guidelines (Informative)&#8221;. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.12  rioReleaseDeviceLock </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioReleaseDeviceLock (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT16 hostdeviceid,&#61472;&#61472;</P>

<P>UINT16 *hostlockid&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>hostdeviceid Host base device ID for the local processing element&#61472;&#61472;</P>

<P>[IN] </P>

<P> </P>

<P>*hostlockid Device ID of the host holding the lock if ERR_LOCK&#61472;&#61472;</P>

<P>is returned [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P>RIO_SUCCESS  The device lock was released successfully. RIO_ERR_LOCK Another host already acquired the specified processor&#61472;&#61472;</P>

<P>element. </P>

<P> </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value </P>

<P> </P>

<P>RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472; ERROR status reported. Error status returned by this&#61472; function may contain additional information from the&#61472; Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioReleaseDeviceLock() tries to release the hardware device lock for the specified processing element on behalf of the requesting host. The function uses the HAL rioConfigurationWrite() function to write the requesting host device ID into the Host Base Lock Device ID CSR of the specified processing element. After the write completes, this function uses the HAL rioConfigurationRead() function to read the value back from the Host Base Lock Device ID CSR. If the Device ID that is read back from the Host Base Device ID register is 0xFFFF then the lock has been released successfully. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.13  rioGetComponentTag </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetComponentTag (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 *componenttag&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>*componenttag Pointer to storage containing the received component&#61472;&#61472;</P>

<P>tag information [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P> </P>

<P>RIO_SUCCESS The component tag information was retrieved&#61472;&#61472;</P>

<P>successfully and placed into the location specified by&#61472;&#61472;</P>

<P>*componenttag. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetComponentTag() uses the HAL rioConfigurationRead() function to read from the Component Tag CSR of the specified processing element. Values read are placed into the location referenced by the *componenttag pointer. Reported status is similar to rioConfigurationRead(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>4.3.14  rioSetComponentTag </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioSetComponentTag (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 componenttag&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>componenttag Component tag value to be set [IN] Return Value: </P>

<P>RIO_SUCCESS The component tag was updated successfully. RIO_ERR_INVALID_PARAMETER  One or more input parameters had an invalid value. </P>

<P>RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472; ERROR status reported. Error status returned by this&#61472; function may contain additional information from the&#61472; Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioSetComponentTag() uses the HAL rioConfigurationWrite() function to write the component tag into the </P>

<P>Component Tag CSR of the specified processing element. Reported status is similar to rioConfigurationWrite(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>4.3.15  rioGetPortErrStatus </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioGetPortErrStatus (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT16 extfoffset,&#61472;&#61472;</P>

<P>UINT8 portnum,&#61472;&#61472;</P>

<P>UINT32 *porterrorstatus&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>extfoffset Offset from the previously reported extended features&#61472;&#61472;</P>

<P>pointer [IN] </P>

<P> </P>

<P>portnum Port number to be accessed [IN] </P>

<P> </P>

<P>*porterrorstatus Pointer to storage for the returned value [OUT] Return Value: </P>

<P>RIO_SUCCESS The read completed successfully and valid data was&#61472;&#61472;</P>

<P>placed into the location specified by *porterrorstatus. </P>

<P>RIO_ERR_INVALID_PARAMETER One or more input parameters had an invalid value. RIO_ERR_RIO The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioGetPortErrStatus() uses the HAL rioConfigurationRead() function to read the contents of the Port n Error and Status CSR of the specified processing element. Reported status is similar to rioConfigurationRead(). </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 5 Routing-Table Manipulation </P>

<P>Functions </P>

<P> </P>

<P> </P>

<P>5.1 Introduction </P>

<P> </P>

<P>This section describes the RapidIO functions that must be provided to support routing tables used within the switch fabric. The RapidIO common transport specification requires implementing device-identifier-based packet routing. The detailed implementation of routing tables is beyond the scope of this specification. </P>

<P> </P>

<P>The routing-table manipulation functions assume the following: </P>

<P> </P>

<P>&#8226; The destination ID of the device that receives a packet routed by the switch is the route destination ID. </P>

<P>&#8226; The specific port at the route destination ID that receives a packet routed by the switch is the route port number. </P>

<P>&#8226; The software paradigm used for routing tables is a linear routing table indexed by the route destination ID. </P>

<P>&#8226; Switches may implement a global routing table, &#8220;per port&#8221; routing tables, or a combination of both. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>5.2 Routing Table Functions </P>

<P> </P>

<P>The functions defined for RapidIO routing-table manipulation are described in the following sections. </P>

<P> </P>

<P> </P>

<P>5.2.1  rioRouteAddEntry </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioRouteAddEntry (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT8 tableidx,&#61472;&#61472;</P>

<P>UINT16 routedestid,&#61472;&#61472;</P>

<P>UINT8 routeportno&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number (RapidIO switch) [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element (RapidIO&#61472;&#61472;</P>

<P>switch) [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>tableidx Routing table index for per-port switch&#61472;&#61472;</P>

<P>implementations [IN] </P>

<P> </P>

<P>routedestid Route destination ID&#8212;used to select an entry into the&#61472;&#61472;</P>

<P>specified routing table [IN] </P>

<P> </P>

<P>routeportno Route port number&#8212;value written to the selected&#61472;&#61472;</P>

<P>routing table entry [IN] </P>

<P> </P>

<P>Return Value: </P>

<P>RIO_SUCCESS The routing table entry was added successfully. RIO_ERR_INVALID_PARAMETER  One or more input parameters had an invalid value. RIO_ERR_RIO  The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. Error status returned by this&#61472;&#61472;</P>

<P>function may contain additional information from the&#61472;&#61472;</P>

<P>Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>RIO_WARN_INCONSISTENT Used by rioRouteGetEntry&#8212;indicates that the&#61472;&#61472;</P>

<P>routeportno returned is not the same for all ports. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioRouteAddEntry() adds an entry to a routing table for the RapidIO switch specified by the destid and hopcount parameters. The tableidx parameter is used to select a specific routing table in the case of implementations with &#8220;per port&#8221; routing tables. A value of tableidx=0xFFFFFFFF specifies a global routing table for the RapidIO switch. The routeportno parameter is written to the routing table entry selected by the routedestid parameter. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>5.2.2  rioRouteGetEntry </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>STATUS rioRouteGetEntry (&#61472;&#61472;</P>

<P>UINT8 localport,&#61472;&#61472;</P>

<P>UINT32 destid,&#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT8 tableidx,&#61472;&#61472;</P>

<P>UINT16 routedestid,&#61472;&#61472;</P>

<P>UINT8 *routeportno&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>localport Local port number (RapidIO switch) [IN] </P>

<P> </P>

<P>destid Destination ID of the processing element (RapidIO&#61472;&#61472;</P>

<P>switch) [IN] </P>

<P> </P>

<P>hopcount Hop count [IN] </P>

<P> </P>

<P>tableidx Routing table index for per-port switch&#61472;&#61472;</P>

<P>implementations [IN] </P>

<P> </P>

<P>routedestid Route destination ID&#8212;used to select an entry into the&#61472;&#61472;</P>

<P>specified routing table [IN] </P>

<P> </P>

<P>*routeportno Route port number&#8212;pointer to value read from the&#61472;&#61472;</P>

<P>selected routing table entry [OUT] </P>

<P> </P>

<P>Return Value: </P>

<P>RIO_SUCCESS The routing table entry was added successfully. RIO_ERR_INVALID_PARAMETER  One or more input parameters had an invalid value. RIO_ERR_RIO  The RapidIO fabric returned a Response Packet with&#61472;&#61472;</P>

<P>ERROR status reported. &#61472;&#61472;</P>

<P>Error status returned by this function may contain&#61472;&#61472;</P>

<P>additional information from the Response Packet. </P>

<P> </P>

<P>RIO_ERR_ACCESS A device-specific hardware interface was unable to&#61472; generate a maintenance transaction and reported an&#61472; error. </P>

<P> </P>

<P>RIO_WARN_INCONSISTENT Used by rioRouteGetEntry&#8212;indicates that the&#61472;&#61472;</P>

<P>routeportno returned is not the same for all ports. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioRouteGetEntry() reads an entry from a routing table for the RapidIO switch specified by the destid and hopcount parameters. The tableidx parameter is used to select a specific routing table in the case of implementations with &#8220;per port&#8221; routing tables. A value of tableidx=0xFF specifies a global routing table for the RapidIO switch. The value in the routing table entry selected by the routedestid parameter is read from the table and placed into the location referenced by the *routeportno pointer. </P>

<P> </P>

<P>Reads from the global routing table may be undefined in the case where per-port routing tables exist. A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Chapter 6 Device Access Routine Interface </P>

<P> </P>

<P> </P>

<P>6.1 Introduction </P>

<P> </P>

<P>This section defines the device access routine (DAR) interface that must be provided for RapidIO device configuration. The client for this interface is the boot loader responsible for RapidIO network enumeration and initialization. By using a standard DAR interface, the firmware does not need to include knowledge of device-specific configuration operations. Thus, enumeration and initialization firmware can operate transparently with devices from many component vendors. </P>

<P> </P>

<P> </P>

<P>6.2 DAR Packaging </P>

<P> </P>

<P>For each processor type supported by a DAR provider, linkable object files for DARs shall be supplied using ELF format. Device-specific configuration DARs shall be supplied using C-language source code format. </P>

<P> </P>

<P> </P>

<P>6.3 Execution Environment </P>

<P> </P>

<P>The functions provided by device-specific configuration DARs must be able to link and execute within a minimal execution context (e.g., a system-boot monitor or firmware). In general, configuration DARs should not call an external function that is not implemented by the DAR, unless the external function is passed to the configuration DAR by the initialization function. Also, configuration DAR functions may not call standard C-language I/O functions (e.g., printf) or standard C-language library functions that might manipulate the execution environment (e.g., malloc or exit). </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.4 Type Definitions </P>

<P> </P>

<P>The following type definitions are to be used by the DAR functions in Section 6.5. </P>

<P> </P>

<P>typedef struct RDCDAR_PLAT_OPS_STRUCT {&#61472;&#61472;</P>

<Textbox>
<Table>
<TR>
<TD>
<P>UINT32 (*rioConfigurationRead) </P>
</TD>

<TD>
<P>( UINT8 </P>
</TD>

<TD>
<P>localport,&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>UINT16 </P>
</TD>

<TD>
<P>destid,&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>UINT8 </P>
</TD>

<TD>
<P>hopcount,&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>UINT32 </P>
</TD>

<TD>
<P>offset,&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>UINT32 </P>
</TD>

<TD>
<P>*readdata);&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P>UINT32 (*rioConfigurationWrite) </P>
</TD>

<TD>
<P>( UINT8 </P>
</TD>

<TD>
<P>localport,&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>UINT16 </P>
</TD>

<TD>
<P>destid,&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>UINT8 </P>
</TD>

<TD>
<P>hopcount,&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>UINT32 </P>
</TD>

<TD>
<P>offset,&#61472;&#61472;</P>
</TD>
</TR>

<TR>
<TD>
<P> </P>
</TD>

<TD>
<P>UINT32 </P>
</TD>

<TD>
<P>*writedata);&#61472;&#61472;</P>
</TD>
</TR>
</Table>

<P> </P>
</Textbox>

<P>UINT32 specversion;&#61472;&#61472;</P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>} RDCDAR_PLAT_OPS; </P>

<P> </P>

<P>typedef struct RDCDAR_OPS_STRUCT {&#61472;&#61472;</P>

<P>UINT32 specversion;&#61472;&#61472;</P>

<P>UINT32 (*rioDarInitialize) (...);&#61472;&#61472;</P>

<P>UINT32 (*rioDarTerminate) (...);&#61472;&#61472;</P>

<P>UINT32 (*rioDarTestMatch) (...);&#61472;&#61472;</P>

<P>UINT32 (*rioDarRegister) (...);&#61472;&#61472;</P>

<P>UINT32 (*rioDarGetSwitchInfo) (...);&#61472;&#61472;</P>

<P>UINT32 (*rioDarSetPortRoute) (...);&#61472;&#61472;</P>

<P>UINT32 (*rioDarGetPortRoute) (...);&#61472;&#61472;</P>

<P>UINT32 (*rioDarGetMemorySize) (...);&#61472;&#61472;</P>

<P>} RDCDAR_OPS </P>

<P> </P>

<P>typedef struct RDCDAR_DATA_STRUCT {&#61472;&#61472;</P>

<P>UINT32 databytesallocated;&#61472;&#61472;</P>

<P>CHAR   *data;&#61472;&#61472;</P>

<P>} RDCDAR_DATA </P>

<P> </P>

<P>typedef struct RDCDAR_SWITCH_INFO_STRUCT {&#61472;&#61472;</P>

<P>BOOL   useslutmodel;&#61472;&#61472;</P>

<P>BOOL   separatelutperinputport;&#61472;&#61472;</P>

<P>UINT32 maxlutentries;&#61472;&#61472;</P>

<P>} RDCDAR_SWITCH_INFO </P>

<P> </P>

<P> </P>

<P> </P>

<P>6.5 DAR Functions </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>The functions that must be provided for a RapidIO device-specific configuration DAR are described in the following sections. For the rioDar_nameGetFunctionTable functions, the rioDar_name portion of the function name shall be replaced by an appropriate name for the implemented driver. </P>

<P> </P>

<P> </P>

<P>6.5.1  rioDar_nameGetFunctionTable </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDar_nameGetFunctionTable(&#61472;&#61472;</P>

<P>UINT32 specversion,&#61472;&#61472;</P>

<P>RDCDAR_OPS_STRUCT *darops,&#61472;&#61472;</P>

<P>UINT32 maxdevices,&#61472;&#61472;</P>

<P>UINT32 *darspecificdatabytes&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>specversion Version number of the DAR interface specification&#61472; indicating the caller&#8217;s implementation of the type&#61472; definition structures [IN] </P>

<P> </P>

<P>*darops Pointer to a structure of DAR functions that are&#61472; allocated by the caller and filled in by the called&#61472; function (see Section 6.4) [OUT] </P>

<P> </P>

<P>maxdevices Maximum expected number of RapidIO devices that&#61472;&#61472;</P>

<P>must be serviced by this configuration DAR [IN] </P>

<P> </P>

<P>*darspecificdatabytes Number of bytes needed by the DAR for the DAR&#61472;&#61472;</P>

<P>private data storage area [OUT] </P>

<P> </P>

<P>Return value: </P>

<P> </P>

<P>RIO_SUCCESS On successful completion </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioDar_nameGetFunctionTable() is called by a client to obtain the list of functions implemented by a RapidIO </P>

<P>device-specific configuration DAR module. It shall be called once before enumerating the RapidIO network. </P>

<P> </P>

<P>The specversion parameter is the version number defined by the revision level of the specification from which the </P>

<P>DAR type definition structures are taken (see Section 6.4). </P>

<P> </P>

<P>The maxdevices parameter is an estimate of the maximum number of RapidIO devices in the network that this DAR must service. The DAR uses this estimate to determine the size required for the DAR private data storage area. The storage size is returned to the location referenced by the *darspecificdatabytes pointer. After the client calls this function, the client shall allocate a DAR private data storage area of a size no less than that indicated by </P>

<P>*darspecificdatabytes. The client shall provide that private data storage area to rioDarInitialize(). </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.5.2  rioDarInitialize </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDarInitialize (&#61472;&#61472;</P>

<P>UINT32 specversion,&#61472;&#61472;</P>

<P>UINT32 maxdevices,&#61472;&#61472;</P>

<P>RDCDAR_PLAT_OPS *platops,&#61472;&#61472;</P>

<P>RDCDAR_DATA *privdata&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>specversion Version number of the DAR interface specification&#61472; indicating the caller&#8217;s implementation of the type&#61472; definition structures [IN] </P>

<P> </P>

<P>maxdevices Maximum expected number of RapidIO devices that&#61472;&#61472;</P>

<P>must be serviced by this configuration DAR [IN] </P>

<P> </P>

<P>*platops Pointer to a structure of platform functions for use by&#61472;&#61472;</P>

<P>the DAR (see Section 6.4) [IN] </P>

<P> </P>

<P>*privdata Pointer to structure containing DAR private data area&#61472;&#61472;</P>

<P>(see Section 6.4) [IN/OUT] </P>

<P> </P>

<P>Return value: </P>

<P> </P>

<P>RIO_SUCCESS On successful completion </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioDarInitialize() is called by a client to initialize a RapidIO device-specific configuration DAR module. This function shall be called once after calling the rioDar_nameGetFunctionTable() functions and before enumerating the RapidIO network. </P>

<P> </P>

<P>The specversion parameter is the version number defined by the revision level of the specification from which the </P>

<P>DAR type definition structures are taken (see Section 6.4). </P>

<P> </P>

<P>The maxdevices parameter is an estimate of the maximum number of RapidIO devices in the network that this DAR must service. The maxdevices value must be equal to the value used in the corresponding rioDar_nameGetFunctionTable() function call. The client is responsible for allocating the structure referenced by </P>

<P>*privdata. The client is also responsible for allocating a DAR private data storage area at least as large as that specified by the rioDar_nameGetFunctionTable() call. The client must initialize the structure referenced by *privdata with the number of bytes allocated to the DAR private data storage area and with the pointer to the storage area. After calling rioDarInitialize(), the client may not deallocate the DAR private data storage area until after the rioDarTerminate() function has been called. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>6.5.3  rioDarTerminate </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDarTerminate (&#61472;&#61472;</P>

<P>RDCDAR_DATA *privdata&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>*privdata Pointer to structure containing DAR private data area&#61472;&#61472;</P>

<P>(see Section 6.4) [IN/OUT] </P>

<P> </P>

<P>Return value: </P>

<P> </P>

<P>RIO_SUCCESS On successful completion </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioDarTerminate() is invoked by a client to terminate a RapidIO device-specific configuration DAR module. This function shall be called once after all use of the DAR services is completed. After calling this function, the client may deallocate the DAR private data storage area in the structure referenced by *privdata. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.5.4  rioDarTestMatch </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDarTestMatch (&#61472;&#61472;</P>

<P>RDCDAR_DATA *privdata,&#61472;&#61472;</P>

<P>UINT8 localport, &#61472;&#61472;</P>

<P>UINT32 destid, &#61472;&#61472;</P>

<P>UINT8 hopcount&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>*privdata Pointer to structure containing DAR private data area&#61472;&#61472;</P>

<P>(see Section 6.4) [IN/OUT] </P>

<P>localport Local port number used to access the network [IN] destid Destination device ID for the target device [IN] hopcount Number of switch hops needed to reach the target&#61472;&#61472;</P>

<P>device [IN] </P>

<P> </P>

<P>Return value: </P>

<P> </P>

<P>RIO_SUCCESS Device DAR does provide services for this device </P>

<P> </P>

<P>RIO_ERR_NO_DEVICE_SUPPORT Device DAR does not provide services for this device. Synopsis: </P>

<P>rioDarTestMatch() is invoked by a client to determine whether or not a RapidIO device-specific configuration DAR module provides services for the device specified by destid. The DAR interrogates the device (using the platform functions supplied during DAR initialization), examines the device identity and any necessary device registers, and determines whether or not the device is handled by the DAR. </P>

<P> </P>

<P>The DAR does not assume that a positive match (return value of 0) means the DAR will actually provide services for the device. The client must explicitly register the device with rioDARregister() if the client will be requesting services. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>6.5.5  rioDarRegister </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDarRegister (&#61472;&#61472;</P>

<P>RDCDAR_DATA *privdata,&#61472;&#61472;</P>

<P>UINT8 localport, &#61472;&#61472;</P>

<P>UINT32 destid, &#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>*privdata Pointer to structure containing DAR private data area&#61472;&#61472;</P>

<P>(see Section 6.4) [IN/OUT] </P>

<P>localport Local port number used to access the network [IN] destid Destination device ID for the target device [IN] hopcount Number of switch hops needed to reach the target&#61472;&#61472;</P>

<P>device [IN] </P>

<P> </P>

<P>Return value: </P>

<P>RIO_SUCCESS  Device DAR successfully registered this device. RIO_ERR_NO_DEVICE_SUPPORT Device DAR does not provide services for this device. RIO_ERR_INSUFFICIENT_RESOURCES Insufficient storage available in DAR private storage&#61472;&#61472;</P>

<P>area </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioDarRegister() is invoked by a client to register a target device with a RapidIO device-specific configuration DAR. The client must call this function once for each device serviced by the DAR. The client should first use the rioDarTestMatch() function to verify that the DAR is capable of providing services to the device. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.5.6  rioDarGetMemorySize </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDarGetMemorySize (&#61472;&#61472;</P>

<P>RDCDAR_DATA *privdata,&#61472;&#61472;</P>

<P>UINT8 localport, &#61472;&#61472;</P>

<P>UINT32 destid, &#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT32 regionix,&#61472;&#61472;</P>

<P>UINT32 *nregions,&#61472;&#61472;</P>

<P>UINT32 *regbytes[2],&#61472;&#61472;</P>

<P>UINT32 *startoffset[2]&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>*privdata Pointer to structure containing DAR private data area&#61472;&#61472;</P>

<P>(see Section 6.4) [IN/OUT] </P>

<P>localport Local port number used to access the network [IN] destid Destination device ID for the target device [IN] hopcount Number of switch hops needed to reach the target&#61472;&#61472;</P>

<P>device [IN] </P>

<P> </P>

<P>regionix Index of the memory region being queried (0, 1, 2, 3,&#61472;&#61472;</P>

<P>...) [IN] </P>

<P> </P>

<P>*nregions Number of memory regions provided by the target&#61472;&#61472;</P>

<P>device [OUT] </P>

<P> </P>

<P>*regbytes Size (in bytes) of the queried memory region [OUT] </P>

<P> </P>

<P>*startoffset Starting address offset for the queried memory region&#61472;&#61472;</P>

<P>[OUT] </P>

<P> </P>

<P>Return value: </P>

<P> </P>

<P>RIO_SUCCESS Device DAR successfully returned memory size&#61472;&#61472;</P>

<P>information for the target device. </P>

<P> </P>

<P>RIO_ERR_NO_DEVICE_SUPPORT &#61472;&#61472;</P>

<P>Device DAR could not determine memory size&#61472;&#61472;</P>

<P>information for the target device. </P>

<P> </P>

<P>Synopsis: </P>

<P> </P>

<P>rioDarGetMemorySize() is invoked by a client to determine the number of, the sizes of, and the offsets for the memory regions supported by a RapidIO target device. The function is intended to support the mapping of PCI or other address windows to RapidIO devices. If the regionix parameter is greater than the number of regions provided by the device (*nregions), the DAR should return a value of zero for the *regbytes and *startoffset parameters, and indicate a &#8220;successful&#8221; (0) return code. </P>

<P> </P>

<P>rioDarGetMemorySize always returns at least one region. The first index, index 0, always refers to the region controlled by the Local Configuration Space Base Address Registers. </P>

<P> </P>

<P>The client must register the target device with the RapidIO device-specific configuration DAR before calling this function. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>6.5.7  rioDarGetSwitchInfo </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDarGetSwitchInfo (&#61472;&#61472;</P>

<P>RDCDAR_DATA *privdata,&#61472;&#61472;</P>

<P>UINT8 localport, &#61472;&#61472;</P>

<P>UINT32 destid, &#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>RDCDAR_SWITCH_INFO *info&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>*privdata Pointer to structure containing DAR private data area&#61472;&#61472;</P>

<P>(see Section 6.4) [IN/OUT] </P>

<P> </P>

<P>localport Local port number to be used to access network [IN] </P>

<P> </P>

<P>destid Destination device ID to reach target switch device&#61472;&#61472;</P>

<P>[IN] </P>

<P> </P>

<P>hopcount Number of switch hops to reach target switch device&#61472;&#61472;</P>

<P>[IN] </P>

<P> </P>

<P>*info Pointer to switch information data structure (see&#61472;&#61472;</P>

<P>Section 6.4) [OUT] </P>

<P> </P>

<P>Return value: </P>

<P> </P>

<P>RIO_SUCCESS Device DAR successfully retrieved the information&#61472;&#61472;</P>

<P>for RDCDAR_PLAT_OPS_STRUCT. </P>

<P> </P>

<P>RIO_ERR_NO_DEVICE_SUPPORT Insufficient switch routing resources available. RIO_ERR_NO_SWITCH Target device is not a switch. </P>

<P>Synopsis: </P>

<P> </P>

<P>rioDarGetSwitchInfo() is invoked by a client to retrieve the data necessary to initialize the </P>

<P>RDCDAR_SWITCH_INFO structure. </P>

<P> </P>

<P>The client must register the target device with the RapidIO device-specific configuration DAR before calling this function. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>6.5.8  rioDarSetPortRoute </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDarSetPortRoute (&#61472;&#61472;</P>

<P>RDCDAR_DATA *privdata,&#61472;&#61472;</P>

<P>UINT8 localport, &#61472;&#61472;</P>

<P>UINT32 destid, &#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT8 tableidx,&#61472;&#61472;</P>

<P>UINT16 routedestid,&#61472;&#61472;</P>

<P>UINT8 routeportno&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>*privdata Pointer to structure containing DAR private data area&#61472;&#61472;</P>

<P>(see Section 6.4) [IN/OUT] </P>

<P> </P>

<P>localport Local port number to be used to access network [IN] </P>

<P> </P>

<P>destid Destination device ID to reach target switch device&#61472;&#61472;</P>

<P>[IN] </P>

<P> </P>

<P>hopcount Number of switch hops to reach target switch device&#61472;&#61472;</P>

<P>[IN] </P>

<P> </P>

<P>inport Target switch device input port [IN] </P>

<P> </P>

<P>tableidx Routing table index for per-port switch&#61472;&#61472;</P>

<P>implementations [IN] </P>

<P> </P>

<P>routedestid Route destination ID&#8212;used to select an entry into the&#61472;&#61472;</P>

<P>specified routing table [IN] </P>

<P> </P>

<P>routeportno Route port number&#8212;value written to the selected&#61472;&#61472;</P>

<P>routing table entry [IN] </P>

<P> </P>

<P>Return value: </P>

<P> </P>

<P>RIO_SUCCESS Device DAR successfully modified the packet routing&#61472;&#61472;</P>

<P>configuration for the target switch device. </P>

<P> </P>

<P>RIO_ERR_NO_DEVICE_SUPPORT Insufficient switch routing resources available. RIO_ERR_ROUTE_ERROR Switch cannot support requested routing. RIO_ERR_NO_SWITCH Target device is not a switch. RIO_ERR_FEATURE_NOT_SUPPORTED Target device is not capable of per-input-port routing. </P>

<P>Synopsis: </P>

<P> </P>

<P>rioDarSetPortRoute() is invoked by a client to modify the packet routing configuration for a RapidIO target switch device. </P>

<P> </P>

<P>The client must register the target device with the RapidIO device-specific configuration DAR before calling this function. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>6.5.9  rioDarGetPortRoute </P>

<P> </P>

<P>Prototype: </P>

<P> </P>

<P>UINT32 rioDarGetPortRoute (&#61472;&#61472;</P>

<P>RDCDAR_DATA *privdata,&#61472;&#61472;</P>

<P>UINT8 localport, &#61472;&#61472;</P>

<P>UINT32 destid, &#61472;&#61472;</P>

<P>UINT8 hopcount,&#61472;&#61472;</P>

<P>UINT8 tableidx,&#61472;&#61472;</P>

<P>UINT16 routedestid,&#61472;&#61472;</P>

<P>UINT8 *routeportno&#61472;&#61472;</P>

<P>) </P>

<P> </P>

<P>Arguments: </P>

<P> </P>

<P>*privdata Pointer to structure containing DAR private data area&#61472;&#61472;</P>

<P>(see Section 6.4) [IN/OUT] </P>

<P> </P>

<P>localport Local port number to be used to access network [IN] </P>

<P> </P>

<P>destid Destination device ID to reach target switch device&#61472;&#61472;</P>

<P>[IN] </P>

<P> </P>

<P>hopcount Number of switch hops to reach target switch device&#61472;&#61472;</P>

<P>[IN] </P>

<P> </P>

<P>tableidx Routing table index for per-port switch&#61472;&#61472;</P>

<P>implementations [IN] </P>

<P> </P>

<P>routedestid Route destination ID&#8212;used to select an entry into the&#61472;&#61472;</P>

<P>specified routing table [IN] </P>

<P> </P>

<P>*routeportno Route port number&#8212;pointer to value read from the&#61472;&#61472;</P>

<P>selected routing table entry [OUT] </P>

<P> </P>

<P>Return value: </P>

<P> </P>

<P>RIO_SUCCESS Device DAR successfully modified the packet routing&#61472;&#61472;</P>

<P>configuration for the target switch device. </P>

<P> </P>

<P>RIO_ERR_NO_DEVICE_SUPPORT  Insufficient switch routing resources available. RIO_ERR_ROUTE_ERROR Switch cannot support requested routing. RIO_ERR_NO_SWITCH Target device is not a switch. </P>

<P>Synopsis: </P>

<P> </P>

<P>rioDarGetPortRoute() is invoked by a client to read the packet routing configuration for a RapidIO target switch device. </P>

<P> </P>

<P>The client must register the target device with the RapidIO device-specific configuration DAR before calling this function. </P>

<P> </P>

<P>A destid value of HOST_REGS and hopcount of 0 results in accesses to the local hosts RapidIO registers. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>Blank page </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>Annex A System Bring Up Guidelines </P>

<P>(Informative) </P>

<P> </P>

<P> </P>

<P>A.1 Introduction </P>

<P> </P>

<P>The RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 defines a standard set of software API functions for use in system enumeration and initialization. These API functions enable up to two RapidIO hosts to cooperatively enumerate and configure a RapidIO network. </P>

<P> </P>

<P>This appendix is provided as a reference model for the system bring up process. An algorithm is presented that enables up to two cooperating host processors in a Rapid IO system to enumerate the entire network, set up a route to every system node, and enable the booting software to start the next boot-process phase. The actual implementation of the algorithm used to bring up a RapidIO network can vary greatly from this model in both capability and complexity. </P>

<P> </P>

<P> </P>

<P>A.2 Overview of the System Bring Up Process </P>

<P> </P>

<P>This section presents a high-level overview of the system bring up process. </P>

<P> </P>

<P>1. The system is powered on. Refer to Chapter 2, &#8220;Requirements for System </P>

<P>Bring Up&#8221; for the system power-on requirements. </P>

<P>2. The host processor fetches the initial boot code (if necessary). If two processors are present, both can fetch the initial boot code. </P>

<P>3. The system exploration and enumeration algorithm is started. The algorithm for this process is outlined in Section A.3 on page 50. </P>

<P>4. All devices have been enumerated and stored in the device database, and routes have been set up between the host device and all end point devices. The enumeration process may optionally choose to do the following: </P>

<P>a) Compute and configure optimal routes between the host device and end point devices, and between different end point devices. </P>

<P>b) Configure the switch devices with the optimal route information. </P>

<P>c) Store the optimal route and alternate route information in the device database. </P>

<P>5. The address space is mapped. </P>

<P>The host may access the network across a host-RapidIO bridge or host-PCI bridge. The address-space mapping across this bridge must be done when devices are enumerated and stored in the device database. This allows the address of a found device to be retrieved later and presented to the device access routines during operating system (OS) initialization. The pseudocode for this process is as follows: </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>1 ACQUIRE the host bridge address-space requirement </P>

<P>2 MAP the address space into a host address partition X </P>

<P>3 FOR every device in the database </P>

<P>4 IF the component is a RapidIO device </P>

<P>5 ACQUIRE the device&#8217;s address-space requirement </P>

<P>6 MAP the address space into a new host address partition </P>

<P>7 EXPAND the partition X window to cover the new partition </P>

<P>8 UPDATE the device database with the new host address </P>

<P>9 ELSE IF the component is a PCI bridge </P>

<P>10 ACQUIRE the bridge&#8217;s PCI bus ID </P>

<P>11 ACQUIRE the bridge&#8217;s address-space requirement </P>

<P>12 // All devices that appear behind this PCI bridge must have their address spaces&#61472;&#61472;</P>

<P>// mapped within the region specified for this bridge. </P>

<P>13 MAP the address space into a new host address partition </P>

<P>14 EXPAND the partition X window to cover the new partition </P>

<P>15 UPDATE the device database with the new host address </P>

<P>16 ENDIF </P>

<P>17 ENDFOR </P>

<P> </P>

<P> </P>

<P>After discovery has been concluded, it is expected that the majority of systems will then attempt to load in a software image from a boot device. </P>

<P> </P>

<P> </P>

<P>A.3 System Enumeration Algorithm </P>

<P> </P>

<P>The system enumeration algorithm is designed for use by one or two host processors. The outline of the algorithm is as follows: </P>

<P>1. Access the RapidIO network. This step may involve generating special transaction cycles to ensure that the RapidIO network is accessible. </P>

<P>2. Discover the host and assign a device ID to it. </P>

<P>3. Discover the neighbor, if present. </P>

<P>4. If necessary, repeat the previous step recursively to discover additional devices. </P>

<P>5. Clear up. </P>

<P> </P>

<P>When a host begins exploring, it must acquire the Host Base Device ID Lock before it can proceed. Once acquired, it can set its device ID and discover its neighbor (if necessary). </P>

<P> </P>

<P>If two hosts are used, both can execute the enumeration algorithm. However, only one host (the one with higher priority) can win the enumeration task. The losing host enters a wait state. The guidelines for prioritizing hosts to enumerate the network and restarting enumeration should the winning host fail to complete the task are described in Chapter 2, &#8220;Requirements for System Bring Up,&#8221; on page 9. </P>

<P> </P>

<P>The enumeration algorithm described below sets priority based on the value of the power-on device ID. The winning host is the device with the higher power-on host device ID. The losing host has the lower power-on host device ID. The losing host enters a wait state until the winning host completes enumeration or until the wait </P>

<P> </P>

<P>50 RapidIO Trade Association </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>state times out. </P>

<P> </P>

<P>The prioritization mechanism never results in a deadlock if the priorities of both host processors are unique. The enumeration process is initially performed in parallel by both hosts until they meet at a device. When a meeting occurs, prioritization guarantees one winning host&#8212;the other host retreats (enters a wait state). </P>

<P> </P>

<P>The enumeration algorithm described below uses a recursive, depth-first graph traversal to discover the network. It may be possible to improve the algorithm using non-recursive or breadth-first graph traversal. However, those improvements and optimizations are implementation dependent and beyond the scope of this document. </P>

<P> </P>

<P> </P>

<P>A.3.1  Data Structures, Constants, and Global Variables </P>

<P> </P>

<P>This section outlines the data structures, constants, and global variables used by the system enumeration algorithm pseudocode. </P>

<P> </P>

<P>The example system is composed of only 8 bit capable devices. </P>

<P> </P>

<P>Data Structures </P>

<P> </P>

<P>struct rioRouteTable { </P>

<P> </P>

<P>// The switch routing table is implemented as a linear routing table for destination IDs. The table is&#61472;&#61472;</P>

<P>// indexed using the destination ID and the table index range is equal to the maximum destination ID&#61472;&#61472;</P>

<P>// value. The value of a table entry indicates the output port number used to route messages for the&#61472;&#61472;</P>

<P>// destination ID. The table entry default value is implementation dependent. Table entries must be&#61472;&#61472;</P>

<P>// initialized to support FLASH memory accesses. The algorithm pseudocode described in this&#61472;&#61472;</P>

<P>// document assumes the device ID is equal to the RapidIO protocols destination ID. This assignment&#61472;&#61472;</P>

<P>// is not a general requirement. </P>

<P> </P>

<P>UINT8  LFT[MAX_DEVICEID];&#61472;&#61472;</P>

<P>} </P>

<P> </P>

<P>struct rioSwitch { </P>

<P> </P>

<P>&#8230; </P>

<P> </P>

<P>UINT16 SwitchIdentity; // Switch Identity&#61472;&#61472;</P>

<P>UINT16 hopCount; // Hop Count to reach this switch&#61472;&#61472;</P>

<P>UINT16 DeviceID; // Associated Device ID in the path to this switch&#61472;&#61472;</P>

<P>struct rioRouteTable RouteTable; // Switch Routing Table </P>

<P> </P>

<P>&#8230; </P>

<P> </P>

<P>} </P>

<P> </P>

<P>Constants </P>

<P> </P>

<P>RIO_GEN_DFLT_DID 0x00FFFFFF // RIO_GEN_DFLT_DID is the general default device&#61472;&#61472;</P>

<P>// ID assigned to non-host and non-boot code end&#61472;&#61472;</P>

<P>// points&#61472;&#61472;</P>

<P>RIO_BOOT_DFLT_DID 0x0000FFFE // RIO_BOOT_DFLT_DID is the default device ID&#61472;&#61472;</P>

<P>// assigned to boot code devices&#61472;&#61472;</P>

<P>RIO_HOST_DFLT_DID 0x00000000 // RIO_HOST_DFLT_DID is the default device ID&#61472;&#61472;</P>

<P>// assigned to host devices </P>

<P> </P>

<P>Global Variables </P>

<P> </P>

<P>UINT16 DeviceID = 0; // Currently available Device ID to be assigned to the&#61472;&#61472;</P>

<P> </P>

<P>RapidIO Trade Association 51 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>// end point device&#61472;&#61472;</P>

<P>UINT16 SwitchID = 0; // Currently available Switch ID. This is used&#61472;&#61472;</P>

<P>// internally by the to index&#61472;&#61472;</P>

<P>// switches that have been discovered. </P>

<P> </P>

<P>// The following global arrays are used to store device&#61472;&#61472;</P>

<P>// information&#61472;&#61472;</P>

<P>// collected from rioGetFeatures and&#61472;&#61472;</P>

<P>// rioGetSwitchPortInfo. They are&#61472;&#61472;</P>

<P>// also used to store the hopCount and DeviceID&#61472;&#61472;</P>

<P>// assigned to switches. </P>

<P> </P>

<P>struct rioSwitch Switches[MAX_SWITCHES]; </P>

<P> </P>

<P>A.3.2  Pseudocode </P>

<P> </P>

<P>This section outlines the detailed pseudocode for the system enumeration algorithm. </P>

<P> </P>

<P>1 //********************************************************************** </P>

<P>2 // System enumeration and initialization using the power-on device ID as the hostDeviceID </P>

<P>3 // &#8212;Discover the host first </P>

<P>4 // &#8212;Discover the host&#8217;s neighbor recursively </P>

<P>5 </P>

<P>6 STATUS rioSystemEnumerate (hostDeviceID) </P>

<P>7 { </P>

<P>8 // Discover the host first. </P>

<P>9 status = rioEnumerateHost (hostDeviceID); </P>

<P>10 </P>

<P>11 if (status == ERR_SLAVE) { </P>

<P>12 rioClearUp (hostDeviceID); </P>

<P>13 return ERR_SLAVE; </P>

<P>14 } </P>

<P>15 </P>

<P>16 // Discover the host neighbor </P>

<P>17 status = rioEnumerateNeighbor (hostDeviceID, hopCount = 1); </P>

<P>18 </P>

<P>19 if (status == ERR_SLAVE) { </P>

<P>20 rioClearUp (hostDeviceID); </P>

<P>21 return ERR_SLAVE; </P>

<P>22 } </P>

<P>23 </P>

<P>24 // If the code advances to this point successfully, the host must acquire the </P>

<P>25 // HostBaseDeviceIdLock for all devices in the system. When this is done, the Discovered bit </P>

<P>26 // Master Enable bit, etc. can be set for all devices. </P>

<P>27 </P>

<P>28 }  // end rioSystemEnumerate </P>

<P>29 </P>

<P>30 //********************************************************************** </P>

<P>31 // System Delay </P>

<P>32 // &#8212;Wait for other host to release the lock </P>

<P>33 </P>

<P>34 rioDelay () { </P>

<P>35 }  // end rioDelay </P>

<P>36 </P>

<P>37 //********************************************************************** </P>

<P>38 // Host enumeration and initialization </P>

<P>39 </P>

<P>40 STATUS rioEnumerateHost (hostDeviceID) </P>

<P> </P>

<P>52 RapidIO Trade Association </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>41 { </P>

<P>42 // Try to acquire the lock </P>

<P>43 rioAcquireDeviceLock (0, hostDeviceID, 0, hostDeviceID); </P>

<P>44 </P>

<P>45 while (HostBaseDeviceIdLockCSR.HostBaseDeviceID &lt; hostDeviceID) { </P>

<P>46 // Delay for a while </P>

<P>47 rioDelay (); </P>

<P>48 </P>

<P>49 // Retry lock acquisition </P>

<P>50 rioAcquireDeviceLock (0, hostDeviceID, 0, hostDeviceID, &amp;lockingHost); </P>

<P>51 } </P>

<P>52 </P>

<P>53 // Check to see if there is a master with a larger host device ID </P>

<P>54 if (HostBaseDeviceIdLock.HostBaseDeviceID &gt; hostDeviceID) { </P>

<P>55 // Release the current lock </P>

<P>56 rioReleaseDeviceLock (0, hostDeviceID, 0, hostDeviceID); </P>

<P>57 </P>

<P>58 return ERR_SLAVE; </P>

<P>59 } </P>

<P>60 </P>

<P>61 // Lock has been acquired so enumeration can begin </P>

<P>62 </P>

<P>63 // Assign the default host ID to the host </P>

<P>64 rioSetBaseDeviceId (0, hostDeviceID, hostDeviceID); </P>

<P>65 </P>

<P>66 // Increment the available device ID </P>

<P>67 if (DeviceID == hostDeviceID) { </P>

<P>68 DeviceID ++; </P>

<P>69 } </P>

<P>70 </P>

<P>71 return RIO_SUCCESS; </P>

<P>72 }  // end rioEnumerateHost </P>

<P>73 </P>

<P>74 //********************************************************************** </P>

<P>75 // Neighbor enumeration </P>

<P>76 </P>

<P>77 STATUS rioEnumerateNeighbor (hostDeviceID, hopCount) </P>

<P>78 { </P>

<P>79 // The host has already discovered this node if it currently owns the lock </P>

<P>80 rioGetCurHostLock (0, 0, 0, &amp;owner_device_id); </P>

<P>81 if (owner_device_id == hostDeviceID) { </P>

<P>82 return RIO_SUCCESS; </P>

<P>83 } </P>

<P>84 </P>

<P>85 // Try to acquire the lock </P>

<P>86 rioAcquireDeviceLock (0, RIO_GEN_DFLT_DID, hopCount, hostDeviceID, &amp;lockingHost); </P>

<P>87 </P>

<P>88 while (HostBaseDeviceIdLockCSR.HostBaseDeviceID &lt; hostDeviceID) { </P>

<P>89 // Delay for a while </P>

<P>90 rioDelay (); </P>

<P>91 </P>

<P>92 // Retry lock acquisition </P>

<P>93 rioAcquireDeviceLock(0, RIO_GEN_DFLT_DID, hopCount, hostDeviceID,&#61472;&#61472;</P>

<P>&amp;lockingHost); </P>

<P>94 } </P>

<P>95 </P>

<P> </P>

<P>RapidIO Trade Association 53 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>96 // Check to see if there is a master with a larger host device ID </P>

<P>97 if (HostBaseDeviceIdLock.HostBaseDeviceID &gt; hostDeviceID) { </P>

<P>98 return ERR_SLAVE; </P>

<P>99 } </P>

<P>100 </P>

<P>101 // Lock has been acquired so enumeration can begin </P>

<P>102 </P>

<P>103 // Check Source Operation CAR and Destination Operation CAR to see if a Device ID can be </P>

<P>104 // assigned </P>

<P>105 </P>

<P>106 rioGetSourceOps (0, RIO_GEN_DFLT_DID, hopCount, &amp;SourceOperationCAR); </P>

<P>107 rioGetDestOps (0, RIO_GEN_DFLT_DID, hopCount, &amp;DestinationOperationCAR); </P>

<P>108 </P>

<P>109 if ( (SourceOperationCAR.Read || Write || Atomic) &amp;&amp; </P>

<P>110 (DestinationOperationCAR.Read || Write || Atomic)) { </P>

<P>111 </P>

<P>112 // Set the device ID </P>

<P>113 rioSetBaseDeviceId (0, RIO_GEN_DFLT_DID, DeviceID); </P>

<P>114 </P>

<P>115 // Increment the available device ID </P>

<P>116 DeviceID ++; </P>

<P>117 if (DeviceID == hostDeviceID) { </P>

<P>118 DeviceID ++; </P>

<P>119 } </P>

<P>120 } </P>

<P>121 </P>

<P>122 // Check to see if the device is a switch </P>

<P>123 rioGetFeatures (0, RIO_GEN_DFLT_DID, hopCount, &amp;ProcessingElementFeatureCAR); </P>

<P>124 if (ProcessingElementFeatureCAR.Switch == TRUE) { </P>

<P>125 </P>

<P>126 // Read the switch information </P>

<P>127 rioGetSwitchPortInfo (0, RIO_GEN_DFLT_DID, hopCount,&#61472;&#61472;</P>

<P>&amp;SwitchPortInformationCAR); </P>

<P>128 </P>

<P>129 // Record the switch device identity </P>

<P>130 Switches[SwitchID].SwitchIdentity = DeviceIdentityCAR.DeviceIdentity; </P>

<P>131 </P>

<P>132 // Bookkeeping for the current switch ID </P>

<P>133 curSwitchID = SwitchID; </P>

<P>134 </P>

<P>135 // Increment the available switch ID </P>

<P>136 SwitchID ++; </P>

<P>137 </P>

<P>138 // Initialize the current switch routing table to add entries for all previously discovered </P>

<P>139 // devices so that they are routed correctly. Start with the host device ID (0x00) and end with </P>

<P>140 // DeviceID-1. </P>

<P>141 for (each deviceID in [0..DeviceID-1]) { </P>

<P>142 rioRouteAddEntry (0, RIO_GEN_DFLT_DID, hopCount, RIO_GEN_DFLT_DID,&#61472;&#61472;</P>

<P>deviceID, </P>

<P>143 SwitchPortInformationCAR.PortNumber, NULL); </P>

<P>144 } </P>

<P>145 </P>

<P>146 // Synchronize the current switch routing table with the global table </P>

<P>147 for (each deviceID in [0.. DeviceID-1]) { </P>

<P>148 Switches[curSwitchID].RouteTable.LFT[deviceID] = </P>

<P>149 SwitchPortInformationCAR.PortNumber; </P>

<P> </P>

<P>54 RapidIO Trade Association </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>150 } </P>

<P>151 </P>

<P>152 // Update the hopCount to reach the current switch </P>

<P>153 Switches[curSwitchID].HopCount = hopCount; </P>

<P>154 </P>

<P>155 for (each portNum in SwitchPortInformationCAR.PortTotal) { </P>

<P>156 if (SwitchPortInformationCAR.PortNumber == portNum) { </P>

<P>157 continue; </P>

<P>158 } </P>

<P>159 </P>

<P>160 // Bookkeeping for the current available device ID </P>

<P>161 curDeviceID = DeviceID; </P>

<P>162 </P>

<P>163 rioGetPortErrStatus (0, RIO_GEN_DFLT_DID, hopCount,&#61472;&#61472;</P>

<P>&amp;PortErrorStatusCSR[portNum]); </P>

<P>164 </P>

<P>165 // Check if it is possible to have a neighbor </P>

<P>166 if (PortErrorStatusCSR[portNum].PortUninitialized == TRUE) { </P>

<P>167 continue; </P>

<P>168 } </P>

<P>169 </P>

<P>170 else if (PortErrorStatusCSR[portNum].PortOK == TRUE) { </P>

<P>171 </P>

<P>172 // Check if it is an enumeration boundary port </P>

<P>173 if (PortControlCSR[portNum].PortEnumerationBoundary == TRUE) { </P>

<P>174 continue; </P>

<P>175 } </P>

<P>176 rioRouteAddEntry(0, RIO_GEN_DFLT_DID, hopCount, RIO_GEN_DFLT_DID, 0,&#61472;&#61472;</P>

<P>portNumber, NULL); </P>

<P>177 </P>

<P>178 // Discover the neighbor recursively </P>

<P>179 if (status = rioEnumerateNeighbor(hopCount + 1) != RIO_SUCCESS) { </P>

<P>180 return status; </P>

<P>181 } </P>

<P>182 </P>

<P>183 // If more than one end point device was found, update the current switch routing table </P>

<P>184 // entries beginning with the curDeviceID entry and ending with the DeviceID-1 </P>

<P>185 // entry. </P>

<P>186 if (DeviceID &gt; curDeviceID) { </P>

<P>187 for (each deviceID in [curDeviceID..DeviceID-1]) { </P>

<P>188 rioRouteAddEntry(0, RIO_GEN_DFLT_DID, hopCount, deviceID,&#61472;&#61472;</P>

<P>portNumber); </P>

<P>189 } </P>

<P>190 </P>

<P>191 // Synchronize the current switch routing table with the global table </P>

<P>192 for (each deviceID in [curDeviceID..DeviceID-1]) { </P>

<P>193 Switches[curSwitchID].RouteTable.LFT[deviceID] = portNumber; </P>

<P>194 } </P>

<P>195 </P>

<P>196 // Update the associated Device ID in the path. </P>

<P>197 Switches[curSwitchID].DeviceID = curDeviceID; </P>

<P>198 }   // end if </P>

<P>199 }   // end else if </P>

<P>200 }   // end for </P>

<P>201 } // end if (ProcessingElementFeatureCAR.Switch == TRUE) </P>

<P>202 </P>

<P> </P>

<P>RapidIO Trade Association 55 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>203 return RIO_SUCCESS; </P>

<P>204 </P>

<P>205  }  // end rioEnumerateNeighbor </P>

<P>206 </P>

<P>207  // ********************************************************************** </P>

<P>208  // System clear up </P>

<P>209  // &#8212;Reset the previously acquired lock because a master exists elsewhere. Use hostDeviceID to </P>

<P>210  // reset the lock </P>

<P>211 </P>

<P>212  STATUS rioClearUp (hostDeviceID) { </P>

<P>213 </P>

<P>214 // Clear the host lock </P>

<P>215 if (hostDeviceID &gt; DeviceID &#8211;1) { </P>

<P>216 rioReleaseDeviceLock (0, hostDeviceID, 0, hostDeviceID); </P>

<P>217 } </P>

<P>218 </P>

<P>219 // Clear the discovered end point device lock </P>

<P>220 while (DeviceID &gt;= 1) { </P>

<P>221 rioReleaseDeviceLock (0, DeviceID-1, 0, hostDeviceID); </P>

<P>222 DeviceID --; </P>

<P>223 } </P>

<P>224 </P>

<P>225 // Clear the discovered switch device lock </P>

<P>226 while (SwitchID &gt;= 1) { </P>

<P>227 rioReleaseDeviceLock (0, Switches[SwitchID&#8211;1].DeviceID, </P>

<P>228 Switches[SwitchID-1].hopCount, hostDeviceID); </P>

<P>229 SwitchID --; </P>

<P>230 } </P>

<P>231 </P>

<P>232 return RIO_SUCCESS; </P>

<P>233  }  // end rioClearUp </P>

<P> </P>

<P> </P>

<P>A.4 System Bring Up Example </P>

<P> </P>

<P>This section walks-through a system bring up example. The system described in this example is shown in Figure A-1. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>56 RapidIO Trade Association </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>System </P>

<P>Host A Microprocessor </P>

<P> </P>

<P>Microprocessor </P>

<P>System </P>

<P>Host B </P>

<P> </P>

<P> </P>

<P>Host  RapidIO Bridge Board Switch </P>

<P>RapidIO Board Switch </P>

<P>Host </P>

<P>Bridge </P>

<P> </P>

<P> </P>

<P>4 0 </P>

<P> </P>

<P> </P>

<P>Board Interconnect </P>

<P>Switch </P>

<P>3 (Midplane Switch) </P>

<P> </P>

<P>2 1 </P>

<P> </P>

<P> </P>

<P>RapidIO to RapidIO to </P>

<P>PCI/X Bridge PCI/X Bridge </P>

<P>RapidIO to </P>

<P>PCI/X Bridge </P>

<P> </P>

<P>DSP </P>

<P> </P>

<P> </P>

<P> </P>

<P>Ethernet </P>

<P> </P>

<P>ATM </P>

<P>DSP </P>

<P>DSP </P>

<P> </P>

<P> </P>

<P> </P>

<P>High-Speed I/O Card </P>

<P>DSP Farm </P>

<P> </P>

<P>DSP </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2032.jpg"/>
</Figure>

<P>Figure A-1. Example System </P>

<P> </P>

<P>Referring to Figure A-1, system Host A is preloaded with device ID 0x00 and system Host B is preloaded with device ID 0x01. Host A is configured to accept maintenance packets with destination IDs of 0x00 and 0xFF. Host B is configured to accept maintenance packets with destination IDs of 0x01 and 0xFF. System Bring Up advances through time slots along the following timeline: </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2033.jpg"/>
</Figure>

<P>T+0 T+1 T+2 T+3 T+4 T+5 T+6 T+7 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>The time slots shown above are defined as follows: </P>

<P> </P>

<P>&#8226; T+0: Host A begins RapidIO enumeration. </P>

<P>&#8226; T+1: Host B begins RapidIO enumeration and Host A continues RapidIO </P>

<P>enumeration. </P>

<P>&#8226; T+2: Host B discovers another host in the system (Host A) and waits. </P>

<P>&#8226; T+3: Host A discovers a higher priority host in the system (Host B) and retreats. </P>

<P> </P>

<P>RapidIO Trade Association 57 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>&#8226; T+4: Host B assumes sole enumeration of the system. </P>

<P>&#8226; T+5: Host B enumerates the PE on switch port 1. </P>

<P>&#8226; T+6: Host B enumerates the PEs on switch ports 2, 3 and 4. </P>

<P>&#8226; T+7: System enumeration is complete. </P>

<P> </P>

<P>The following describes the actions taken during each time slot in more detail: </P>

<P> </P>

<P>Time T+0 </P>

<P> </P>

<P>Host A attempts to acquire the lock from its Host Base Device ID Lock CSR by writing 0x00 to the CSR. Host A confirms it has acquired the lock when it reads the value of 0x00 (the host device ID) from the Lock CSR. Host A continues by reading the Processing Element Features CAR and adding the information from the CAR to its RapidIO device database. Host A updates its Base Device ID CSR with the host device ID (0x00). </P>

<P> </P>

<P>Time T+1 </P>

<P> </P>

<P>Host B attempts to acquire the lock from its Host Base Device ID Lock CSR by writing 0x01 to the CSR. Host B confirms it has acquired the lock when it reads the value of 0x01 (the host device ID) from the Lock CSR. Host B continues by reading the Processing Element Features CAR and adding the information from the CAR to its RapidIO device database. Host B updates its Base Device ID CSR with the host device ID (0x01). </P>

<P> </P>

<P>Host A begins neighbor enumeration. It attempts to acquire the lock from the Host Base Device ID Lock CSR of the Board Interconnect Switch. A maintenance write of the host device ID (0x00), the destination device ID (0xFF), and the hop count (0) is issued for the Lock CSR. Host A confirms it has acquired the lock when it reads the value of 0x00 (the host device ID) from the Lock CSR. </P>

<P> </P>

<P>Time T+2 </P>

<P> </P>

<P>Host B begins neighbor enumeration. It attempts to acquire the lock from the Host Base Device ID Lock CSR of the Board Interconnect Switch. A maintenance write of the host device ID (0x01), the destination device ID (0xFF), and the hop count (0) is issued for the Lock CSR. However, after Host B issues a maintenance read from the Lock CSR it finds that the device was already locked by host device ID 0x00. Because Host B has a higher priority than the current lock holder (0x01 is greater than 0x00), Host B spins in a delay loop and repeatedly attempts to acquire the lock. </P>

<P> </P>

<P>Time T+3 </P>

<P> </P>

<P>Host A continues neighbor enumeration. It issues a maintenance read cycle to the Device Identity CAR of the Board Interconnect Switch and looks for a matching entry in the device database. Device configuration continues because no match is found (Host A has not enumerated the device). Host A reads the Source Operations and Destination Operations CARs for the device. It is determined that the device </P>

<P> </P>

<P> </P>

<P>58 RapidIO Trade Association </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>does not support read/write/atomic operations and does not require a device ID. Host A reads the Processing Element Feature CAR for the device and determines that it is a switch element. </P>

<P> </P>

<P>Because the device is a switch, Host A reads the Switch Port Information CAR and records the device identity in the switch database. Next, Host A adds a set of entries to the switch's routing table. For each previously discovered device ID, an entry is created containing a target ID (0xFF), hop count (0), and the route port number (from the Switch Port Information CAR). The switch database is updated with the same routing information. Host A reads the Port Error Status CSR for switch port 0, verifying that it is possible for the port to have a neighbor PE. An entry is created in the switch&#8217;s routing table containing target ID (0xFF), hop count (0), and the route port number (0). </P>

<P> </P>

<P>Host A continues neighbor enumeration using a hop count of 1. It attempts to acquire the lock from the Host Base Device ID Lock CSR of the neighbor PE on port </P>

<P>0. A maintenance write of the host device ID (0x00), the destination device ID (0xFF), and the hop count (1) is issued for the Lock CSR. However, after Host B issues a maintenance read from the Lock CSR it finds that the device was already locked by host device ID 0x01. Because Host A has a lower priority than the current lock holder (0x00 is less than 0x01), Host A retreats. It begins the process of backing out all enumeration and configuration changes it has made. </P>

<P> </P>

<P>Host A checks its device and switch databases to find all host locks it obtained within the system (System Host A and the Board Interconnect Switch). It issues a maintenance write transaction to their Host Base Device ID Lock CSRs to release the locks. </P>

<P> </P>

<P>Time T+4 </P>

<P> </P>

<P>As Host B spins in its delay loop, it attempts to acquire the lock from the Host Base Device ID Lock CSR of the Board Interconnect Switch. A maintenance write of the host device ID (0x01), the destination device ID (0xFF), and the hop count (0) is issued for the Lock CSR. Because Host A released the lock, Host B is able to confirm it has acquired the lock when it reads the value of 0x01 from the Lock CSR. </P>

<P> </P>

<P>Host B continues neighbor enumeration. It issues a maintenance read cycle to the Device Identity CAR of the Board Interconnect Switch and looks for a matching entry in the device database. Device configuration continues because no match is found (Host B has not enumerated the device). Host B reads the Source Operations and Destination Operations CARs for the device. It is determined that the device does not support read/write/atomic operations and does not require a device ID. Host B reads the Processing Element Feature CAR for the device and determines that it is a switch element. </P>

<P> </P>

<P>Because the device is a switch, Host B reads the Switch Port Information CAR and records the device identity in the switch database. Next, Host B adds a set of entries to the switch's routing table. For each previously discovered device ID, an entry is </P>

<P> </P>

<P>RapidIO Trade Association 59 </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P>created containing a target ID (0xFF), hop count (0), and the route port number (from the Switch Port Information CAR). The switch database is updated with the same routing information. Host B reads the Port Error Status CSR for switch port 0, verifying that it is possible for the port to have a neighbor PE. An entry is created in the switch&#8217;s routing table containing target ID (0xFF), hop count (0), and the route port number (0). Host B detects that it is attached to port 0. Because Host B has already been enumerated, neighbor enumeration continues on the next port. </P>

<P> </P>

<P>Time T+5 </P>

<P> </P>

<P>Host B reads the Port Error Status CSR for switch port 1, verifying that it is possible for the port to have a neighbor PE. An entry is created in the switch&#8217;s routing table containing target ID (0xFF), hop count (0), and the route port number (1). </P>

<P> </P>

<P>Host B continues neighbor enumeration using a hop count of 1. It attempts to acquire the lock from the Host Base Device ID Lock CSR of the neighbor PE on port 1. A maintenance write of the host device ID (0x01), the destination device ID (0xFF), and the hop count (1) is issued for the Lock CSR. Host B confirms it has acquired the lock when it reads the value of 0x01 from the Lock CSR. </P>

<P> </P>

<P>Host B issues a maintenance read cycle to the Device Identity CAR of the DSP Farm and looks for a matching entry in the device database. Device configuration continues because no match is found (Host B has not enumerated the device). Host B reads the Source Operations and Destination Operations CARs for the device. It is determined that the device supports read/write/atomic operations. A maintenance write is used to update the Base Device ID CSR with the value of 0x00 (the first available device ID). DeviceID is incremented and compared with the Host B device ID. Because they are equal, deviceID is assigned the next available device ID. </P>

<P> </P>

<P>Time T+6 </P>

<P> </P>

<P>The process described in the previous step (Time T+5) is repeated on switch ports </P>

<P>2&#8211;4. Device IDs 0x02, 0x03, and 0x04 are assigned to the PEs on switch ports 2, 3 and 4, respectively. </P>

<P> </P>

<P>Time T+7 </P>

<P> </P>

<P>Host A detects that its Host Base Device Lock CSR has been acquired by another host device, indicating it has been enumerated. Host A can initiate passive discovery to build a local system database. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P>Glossary of Terms and Abbreviations </P>

<P> </P>

<P>The glossary contains an alphabetical list of terms, phrases, and abbreviations used in this book. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2034.jpg"/>
</Figure>

<P>A Application programming interface (API.). A standard software interface that promotes portability of application programs across multiple </P>

<P>devices. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2035.jpg"/>
</Figure>

<P>C Capability  registers  (CARs).  High-speed  memory  containing  recently accessed data and/or instructions (subset of main memory) </P>

<P>associated with a processor. </P>

<P> </P>

<P>Command and status registers (CSRs). A set of registers that allows a processing element to control and determine the status of another processing element&#8217;s internal hardware. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2036.jpg"/>
</Figure>

<P>D Destination. The termination point of a packet on the RapidIO interconnect, also referred to as a target. </P>

<P> </P>

<P>Device. A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a processing element. </P>

<P> </P>

<P>Device ID. The identifier of an end point processing element connected to the </P>

<P>RapidIO interconnect. </P>

<P> </P>

<P>Discovery. The passive exploration of a RapidIO network fabric. This process involves walking an already enumerated RapidIO fabric to determine network topology and resource allocations. </P>

<P> </P>

<P>Double-word. An eight byte quantity, aligned on eight byte boundaries. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2037.jpg"/>
</Figure>

<P>E End point. A processing element which is the source or destination of transactions through a RapidIO fabric. </P>

<P> </P>

<P>End point device. A processing element which contains end point functionality. </P>

<P>RapidIO Annex 1: Software/System Bring Up Specification Rev. 2.2 </P>

<P> </P>

<P>Enumeration. The active exploration of a RapidIO network fabric. This process involves configuring device identifiers and maintaining proper host locking. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2038.jpg"/>
</Figure>

<P>H Hardware abstraction layer (HAL). A a standard software interface to device-specific hardware resources. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2039.jpg"/>
</Figure>

<P>I Initiator. The origin of a packet on the RapidIO interconnect, also referred to as a source. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2040.jpg"/>
</Figure>

<P>O Operation. A set of transactions between end point devices in a RapidIO </P>

<P>system (requests and associated responses) such as a read or a write. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2041.jpg"/>
</Figure>

<P>P Packet. A set of information transmitted between devices in a RapidIO </P>

<P>system. </P>

<P> </P>

<P>Processing Element (PE). A generic participant on the RapidIO interconnect that sends or receives RapidIO transactions, also called a device. </P>

<P> </P>

<P>Processor. The logic circuitry that responds to and processes the basic instructions that drive a computer. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2042.jpg"/>
</Figure>

<P>S Sender. The RapidIO interface output port on a processing element. </P>

<P> </P>

<P>Source. The origin of a packet on the RapidIO interconnect, also referred to as an initiator. </P>

<P> </P>

<P>Switch. A multiple port processing element that directs a packet received on one of its input ports to one of its output ports. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2043.jpg"/>
</Figure>

<P>T Target. The termination point of a packet on the RapidIO interconnect, also referred to as a destination. </P>

<P> </P>

<P>Transaction. A specific request or response packet transmitted between end point devices in a RapidIO system. </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2044.jpg"/>
</Figure>

<P>W Word. A four byte or 32 bit quantity, aligned on four byte boundaries. </P>

<P> </P>

<P>Write port. Hardware within a processing element that is the target of a port- write operation. </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>

<P> </P>
<Figure Alt="">

<ImageData src="images/Rev_2.2_specification_stack_MSWord_img_2045.jpg"/>
</Figure>
